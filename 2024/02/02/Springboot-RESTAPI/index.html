<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="y0-26jFM_8wn6Slpy1ahkB8ndR7w0OOGyAU6IaXjLUI" />














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="spring," />










<meta name="description" content="Springboot-RESTAPI现在我们来学习如何用Springboot创建Restful API 配置：  构建RESTFul Controller原理使用Spring Boot时，它会自动扫描和加载带有特定注解（如@Controller, @RestController, @Service, @Repository等）的类，这个过程称为组件扫描（Component Scanning）。Sp">
<meta property="og:type" content="article">
<meta property="og:title" content="Springboot-RESTAPI">
<meta property="og:url" content="https://jasonxqh.github.io/2024/02/02/Springboot-RESTAPI/index.html">
<meta property="og:site_name" content="Jason‘s Blog">
<meta property="og:description" content="Springboot-RESTAPI现在我们来学习如何用Springboot创建Restful API 配置：  构建RESTFul Controller原理使用Spring Boot时，它会自动扫描和加载带有特定注解（如@Controller, @RestController, @Service, @Repository等）的类，这个过程称为组件扫描（Component Scanning）。Sp">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://jasonxqh.github.io/2024/02/02/Springboot-RESTAPI/1.png">
<meta property="og:image" content="https://jasonxqh.github.io/2024/02/02/Springboot-RESTAPI/2.png">
<meta property="og:image" content="https://jasonxqh.github.io/2024/02/02/Springboot-RESTAPI/3.png">
<meta property="og:image" content="https://jasonxqh.github.io/2024/02/02/Springboot-RESTAPI/4.png">
<meta property="og:image" content="https://jasonxqh.github.io/2024/02/02/Springboot-RESTAPI/6.png">
<meta property="og:image" content="https://jasonxqh.github.io/2024/02/02/Springboot-RESTAPI/5.png">
<meta property="og:image" content="https://jasonxqh.github.io/2024/02/02/Springboot-RESTAPI/7.png">
<meta property="og:image" content="https://jasonxqh.github.io/2024/02/02/Springboot-RESTAPI/8.png">
<meta property="og:image" content="https://jasonxqh.github.io/2024/02/02/Springboot-RESTAPI/9.png">
<meta property="og:image" content="https://jasonxqh.github.io/2024/02/02/Springboot-RESTAPI/11.png">
<meta property="og:image" content="https://jasonxqh.github.io/2024/02/02/Springboot-RESTAPI/12.png">
<meta property="og:image" content="https://jasonxqh.github.io/2024/02/02/Springboot-RESTAPI/10.png">
<meta property="og:image" content="https://jasonxqh.github.io/2024/02/02/Springboot-RESTAPI/13.png">
<meta property="article:published_time" content="2024-02-02T03:07:19.000Z">
<meta property="article:modified_time" content="2024-02-15T07:44:38.840Z">
<meta property="article:author" content="Jason">
<meta property="article:tag" content="spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jasonxqh.github.io/2024/02/02/Springboot-RESTAPI/1.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://jasonxqh.github.io/2024/02/02/Springboot-RESTAPI/"/>





  <title>Springboot-RESTAPI | Jason‘s Blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-170027658-1', 'auto');
  ga('send', 'pageview');
</script>





<meta name="generator" content="Hexo 4.2.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">
  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
<a href="https://github.com/JasonXQH/JasonXQH.github.io" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jason‘s Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2024/02/02/Springboot-RESTAPI/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Springboot-RESTAPI</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-02-02T11:07:19+08:00">
                2024-02-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  13.3k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  51
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Springboot-RESTAPI"><a href="#Springboot-RESTAPI" class="headerlink" title="Springboot-RESTAPI"></a>Springboot-RESTAPI</h1><p>现在我们来学习如何用Springboot创建Restful API</p>
<p>配置：</p>
<p><img src="/2024/02/02/Springboot-RESTAPI/1.png" style="zoom:67%;"></p>
<h2 id="构建RESTFul-Controller"><a href="#构建RESTFul-Controller" class="headerlink" title="构建RESTFul Controller"></a>构建RESTFul Controller</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>使用Spring Boot时，它会自动扫描和加载带有特定注解（如<code>@Controller</code>, <code>@RestController</code>, <code>@Service</code>, <code>@Repository</code>等）的类，这个过程称为组件扫描（Component Scanning）。Spring Boot应用程序的主程序（带有<code>@SpringBootApplication</code>注解的类）通常位于顶层包中，而组件扫描默认会扫描这个类所在包以及它的子包中的所有类。</p>
<p>因此，如果在项目的某个包中添加了一个新的控制器类，并且在这个类中使用了<code>@RequestMapping</code>或者<code>@GetMapping</code>等注解定义了路由，Spring Boot会在启动时自动识别并注册这个控制器，不需要在主程序中进行任何额外的配置。</p>
<p>这个控制器中定义的路由会被加入到Spring MVC的路由表中，当你发送一个HTTP请求时，Spring MVC会根据请求的URL来匹配这个路由表中的映射，并调用相应的方法来处理请求。</p>
<p>这是Spring Boot约定优于配置的原则的一个实例，它大大简化了Web应用程序的开发。只要你遵守了这些约定（比如将控制器放在正确的包中），框架就会为你做很多工作。</p>
<h3 id="RestController"><a href="#RestController" class="headerlink" title="RestController"></a>RestController</h3><ul>
<li>我们创建REST控制器类并使用<code>@RestController</code>注解。</li>
<li>定义请求映射（如<code>@GetMapping</code>, <code>@PostMapping</code>, <code>@PutMapping</code>, <code>@DeleteMapping</code>）来处理HTTP请求。</li>
<li>控制器方法会调用服务层的方法并返回响应。</li>
</ul>
<h4 id="RequestMapping和-GetMapping"><a href="#RequestMapping和-GetMapping" class="headerlink" title="@RequestMapping和@GetMapping"></a>@RequestMapping和@GetMapping</h4><p>在Spring框架中，<code>@RequestMapping</code>和<code>@GetMapping</code>都是用来处理HTTP请求的注解, 都可以用来注释类和方法。</p>
<ol>
<li><p>@RequestMapping</p>
<ul>
<li>这是一个通用的注解，可以处理任何类型的HTTP请求。<br>默认情况下，它会处理所有的HTTP请求方法（GET, POST, PUT, DELETE等），除非你特别指定一个method属性。</li>
<li>你可以在@RequestMapping注解中通过设置method属性来限制HTTP请求的类型。</li>
<li><p>示例：<code>@RequestMapping(value = &quot;/example&quot;, method = RequestMethod.GET)</code></p>
</li>
<li><p>当<code>@RequestMapping</code>用于类级别时，它指定了一个基础的URL路径，该路径会应用到类中的所有方法上。</p>
</li>
<li>当<code>@RequestMapping</code>用于方法级别时，它指定了该方法处理的具体URL路径。这个路径是相对于类级别上的<code>@RequestMapping</code>指定的路径。</li>
</ul>
</li>
<li><code>@GetMapping</code>是一个组合注解，它是<code>@RequestMapping</code>的一个特例，专门用来处理HTTP GET请求类型。<ul>
<li>使用<code>@GetMapping</code>注解可以使得代码更清晰，更具可读性，因为它明确了处理的是GET请求。</li>
<li><code>@GetMapping</code>等同于<code>@RequestMapping(method = RequestMethod.GET)</code>。</li>
<li><code>@GetMapping</code>用于方法时，表示该方法仅处理GET类型的HTTP请求。它是<code>@RequestMapping</code>的一个特化，用于简化映射GET请求的操作。</li>
<li><code>@GetMapping</code>也可以与类级别的<code>@RequestMapping</code>配合使用。此时，<code>@GetMapping</code>指定的路径是相对于类级别上<code>@RequestMapping</code>的路径。</li>
</ul>
</li>
</ol>
<p>比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/test"</span>)</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoRestController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/hello"</span>) <span class="comment">// 完整路径为 /test/hello</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Hello"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上述两个例子中，通过类级别的<code>@RequestMapping(&quot;/test&quot;)</code>，我们定义了一个基础路径<code>/test</code>。然后在方法级别上，<code>@RequestMapping(&quot;/hello&quot;)</code>和<code>@GetMapping(&quot;/hello&quot;)</code>分别定义了一个相对路径<code>/hello</code>，所以最终的访问路径为<code>/test/hello</code>。</p>
<h2 id="数据绑定和POJO"><a href="#数据绑定和POJO" class="headerlink" title="数据绑定和POJO"></a>数据绑定和POJO</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><ol>
<li><strong>数据绑定 (Data Binding)</strong>: 数据绑定通常是指在两个数据源之间自动传递数据的过程。在这个上下文中，它<strong>特指将JSON格式的数据转换成Java对象</strong>，或者反过来，<strong>将Java对象转换成JSON格式的数据</strong>。这个过程大大简化了在Java程序中处理JSON，因为JSON通常用于前后端之间的数据交换。</li>
<li><strong>POJO (Plain Old Java Object)</strong>: POJO是“普通老式Java对象”的缩写，指的是没有遵循特定Java对象模型、约定或框架（如EJB）的简单Java对象。在Spring框架中，POJO通常用于定义数据模型，它们包含数据（通常是私有字段）和访问这些数据的方法（即getter和setter）。POJO使得对象序列化和反序列化（例如，与数据库或JSON数据绑定）更加直接和简单。</li>
<li><strong>Jackson Project</strong>: Jackson是一个流行的Java库，用于序列化Java对象为JSON，以及将JSON反序列化为Java对象。Spring框架在其底层使用Jackson来处理HTTP请求和响应中的JSON数据。当Spring应用程序接收到一个包含JSON数据的请求时，Jackson库将JSON转换成相应的Java对象；相似地，当Spring应用程序需要发送JSON响应时，它将Java对象转换成JSON格式。</li>
<li><strong>Spring Boot Starter Web</strong>: 这张幻灯片指出，Spring Boot的Starter Web依赖自动包含了Jackson库。这意味着当你创建一个Spring Boot Web应用程序时，你不需要手动添加Jackson依赖，Spring Boot已经为你准备好了。这让开发者能够更容易地在他们的应用程序中使用数据绑定功能，因为Jackson会被自动配置和集成进你的Spring应用程序。</li>
</ol>
<h3 id="利用POJO进行数据传递-以Student为例"><a href="#利用POJO进行数据传递-以Student为例" class="headerlink" title="利用POJO进行数据传递-以Student为例"></a>利用POJO进行数据传递-以Student为例</h3><ol>
<li><p><strong>创建Java POJO类</strong>:</p>
<ul>
<li><p>首先，你需要为要处理的数据创建一个POJO类。在这个例子中，我们有一个<code>Student</code>类，它是一个简单的Java类，包含学生信息的属性，如<code>firstName</code>和<code>lastName</code>。</p>
</li>
<li><p>POJO类通常包含私有属性和公开的getter和setter方法，以及任何其他需要的业务逻辑方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line">    <span class="keyword">private</span> String LastName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(String firstName, String lastName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.firstName = firstName;</span><br><span class="line">        LastName = lastName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFirstName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> firstName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFirstName</span><span class="params">(String firstName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.firstName = firstName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLastName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> LastName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastName</span><span class="params">(String lastName)</span> </span>&#123;</span><br><span class="line">        LastName = lastName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ava POJO（Plain Old Java Object）是指一个普通的Java对象，并不一定与持久化层或数据库映射相关联。因此，如果POJO只是用于在应用程序中传输数据，并不涉及数据库操作，那么不需要使用<code>@Entity</code>注解。</p>
</li>
</ul>
</li>
<li><p><strong>创建Spring REST服务</strong>:</p>
</li>
</ol>
<ul>
<li>使用<code>@RestController</code>注解来创建一个REST控制器类。这个类将负责处理进入应用程序的HTTP请求。</li>
<li><code>@RequestMapping(&quot;/api&quot;)</code>指定了一个基础的URL路径，这意味着这个控制器中定义的所有端点都会以<code>/api</code>作为前缀。</li>
</ul>
<ol>
<li><p><strong>定义处理请求的方法</strong>:</p>
<ul>
<li><code>@GetMapping(&quot;/students&quot;)</code>注解定义了一个子路径<code>/students</code>，这意味着完整的路径是<code>/api/students</code>。</li>
<li><code>getStudents()</code>方法会返回一个<code>Student</code>对象的列表。</li>
</ul>
</li>
<li><p><strong>创建和返回<code>Student</code>列表</strong>:</p>
<ul>
<li>在方法内部，创建了一个<code>ArrayList</code>，并添加了几个<code>Student</code>对象。</li>
<li>方法最后返回这个列表。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/api"</span>)</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentRestController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/students"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">getStudents</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        List&lt;Student&gt; theStudents = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        theStudents.add(<span class="keyword">new</span> Student(<span class="string">"Poornima"</span>,<span class="string">"Patel"</span>));</span><br><span class="line">        theStudents.add(<span class="keyword">new</span> Student(<span class="string">"Mario"</span>,<span class="string">"Rossi"</span>));</span><br><span class="line">        theStudents.add(<span class="keyword">new</span> Student(<span class="string">"Mary"</span>,<span class="string">"Smith"</span>));</span><br><span class="line">        <span class="keyword">return</span> theStudents;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p><strong>Jackson的作用</strong>:</p>
<ul>
<li>当<code>getStudents()</code>方法被调用时，它返回一个<code>List&lt;Student&gt;</code>对象。</li>
<li>在Spring的背后，Jackson库接管了返回的<code>List&lt;Student&gt;</code>对象，自动将其序列化为JSON格式。</li>
<li>这个JSON数组然后作为HTTP响应体发送回客户端。</li>
</ul>
</li>
<li><p><strong>客户端接收JSON数据</strong>:</p>
<ul>
<li>REST客户端（可能是Web浏览器、移动应用或其他服务）会接收到JSON格式的响应。</li>
<li>客户端可以解析这个JSON数组，并将数据展示给用户或进行进一步的处理。</li>
</ul>
</li>
</ol>
<p>结果：</p>
<p><img src="/2024/02/02/Springboot-RESTAPI/2.png" style="zoom:67%;"></p>
<h2 id="路径变量"><a href="#路径变量" class="headerlink" title="路径变量"></a>路径变量</h2><h3 id="PathVariable"><a href="#PathVariable" class="headerlink" title="@PathVariable"></a>@PathVariable</h3><p>在REST架构中，路径变量是一种常用的方式，用于在URL中嵌入变量。这样可以让你设计出能够接受动态参数的灵活API端点。</p>
<p>在Spring框架中，你可以利用<code>@PathVariable</code>注解来实现这个功能。下面是如何在Spring REST服务中使用路径变量来获取特定学生信息的步骤：</p>
<ol>
<li><p><strong>定义一个带有路径变量的请求映射</strong>:</p>
<ul>
<li>在REST控制器类中，你可以定义一个方法，并使用<code>@GetMapping</code>（或其他适当的HTTP动词注解）来映射到一个路径。在这个路径中，你可以使用花括号<code>{}</code>来指定路径变量。</li>
<li>例如：<code>@GetMapping(&quot;/students/{studentId}&quot;)</code></li>
</ul>
</li>
<li><p><strong>获取路径变量</strong>:</p>
<ul>
<li>在方法的参数中，你可以使用<code>@PathVariable</code>注解来声明一个变量，这个变量将会自动绑定到URL路径中<strong>同名的部分</strong>。</li>
<li>例如：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/students/&#123;studentID&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Student <span class="title">getStudent</span><span class="params">(@PathVariable <span class="keyword">int</span> studentID)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> theStudents.get(studentID);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>实现方法逻辑</strong>:</p>
<ul>
<li>在<code>getStudent</code>方法内部，你可以使用这个<code>studentId</code>变量来查询对应的学生信息。这可能涉及到调用一个服务层的方法，该方法会在数据库中查找并返回对应ID的学生对象。</li>
<li>之后，你可以返回这个<code>Student</code>对象。Spring框架将会利用Jackson库自动将这个Java对象转换为JSON格式，并将其作为HTTP响应返回给客户端。</li>
</ul>
</li>
</ol>
<h3 id="RequestBody"><a href="#RequestBody" class="headerlink" title="@RequestBody"></a>@RequestBody</h3><p><code>@RequestBody</code>注解用于让Spring<strong>将HTTP请求体中的内容绑定到方法参数</strong>上，通常是用来处理内容类型为<code>application/json</code>或<code>application/xml</code>的请求体。Spring会使用合适的HTTP消息转换器来解析请求体，并将其转换为相应的对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/employees"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">addEmployee</span><span class="params">(@RequestBody Employee theEmployee)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个例子中，<code>@RequestBody</code>告诉Spring，需要将请求体中的JSON或XML数据转换为<code>Employee</code>对象。所以，当一个POST请求到达<code>/employees</code>端点时，请求体中的内容会被自动转换为<code>Employee</code>类的实例。</p>
<p>使用这两个注解可以方便地处理RESTful风格的Web服务中的数据。<code>@PathVariable</code>用于处理URL中的变量，而<code>@RequestBody</code>用于处理请求体中的数据。这样使得方法的参数更直接地反映了HTTP请求的内容，使得控制器代码更清晰、更易于维护。</p>
<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2><p><img src="/2024/02/02/Springboot-RESTAPI/3.png" style="zoom:67%;"></p>
<p>处理REST服务中的错误通常涉及以下几个步骤：</p>
<ol>
<li><strong>创建自定义错误响应类</strong>: 这个类通常包含错误状态码、错误消息和错误发生的时间戳等信息。这个类将<strong>用于封装错误详情</strong>，并将其序列化为JSON响应返回给客户端。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentErrorResponse</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> status;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> timeStamp;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StudentErrorResponse</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStatus</span><span class="params">(<span class="keyword">int</span> status)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMessage</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getTimeStamp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> timeStamp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTimeStamp</span><span class="params">(<span class="keyword">long</span> timeStamp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.timeStamp = timeStamp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StudentErrorResponse</span><span class="params">(<span class="keyword">int</span> status, String message, <span class="keyword">long</span> timeStamp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">        <span class="keyword">this</span>.timeStamp = timeStamp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>创建自定义异常类</strong>: 自定义一个异常类，用于在特定的错误情况下抛出。比如，当一个指定ID的学生找不到时，你可以抛出一个<code>StudentNotFoundException</code>。自定义异常允许你为每种异常编写特定的处理逻辑。比如，在REST服务中，你可以为每种异常提供不同的HTTP状态码和错误信息，这使得前端开发者能够根据不同的错误展示不同的信息或执行不同的操作。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentNotFoundException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StudentNotFoundException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StudentNotFoundException</span><span class="params">(String message, Throwable cause)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message, cause);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StudentNotFoundException</span><span class="params">(Throwable cause)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(cause);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>更新REST服务来抛出异常</strong>: 在你的REST服务方法中，如果找不到学生，你应该抛出上一步创建的自定义异常。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/students/&#123;studentID&#125;"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Student <span class="title">getStudent</span><span class="params">(@PathVariable <span class="keyword">int</span> studentId)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 模拟查找学生的逻辑，如果找不到，则抛出异常</span></span><br><span class="line">    Student student = theStudents.get(studentId);</span><br><span class="line">    <span class="keyword">if</span> (student == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> StudentNotFoundException(<span class="string">"Student id not found - "</span> + studentId);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> student;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>添加异常处理方法</strong>: 使用<code>@ExceptionHandler</code>注解来创建一个异常处理方法。这个方法将会<strong>捕获特定</strong>的异常类型，并构建之前创建的自定义错误响应对象。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;StudentErrorResponse&gt; <span class="title">handleException</span><span class="params">(StudentNotFoundException exc)</span> </span>&#123;</span><br><span class="line">    StudentErrorResponse error = <span class="keyword">new</span> StudentErrorResponse();</span><br><span class="line"></span><br><span class="line">    error.setStatus(HttpStatus.NOT_FOUND.value());</span><br><span class="line">    error.setMessage(exc.getMessage());</span><br><span class="line">    error.setTimeStamp(System.currentTimeMillis());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(error, HttpStatus.NOT_FOUND);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="处理一般错误"><a href="#处理一般错误" class="headerlink" title="处理一般错误"></a>处理一般错误</h3><p>虽然我们可以自定义错误类型，但是不可能涵盖所有错误，因此，我们可以创建一个对一把错误的handler，用统一的错误类型回应。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ExceptionHandler</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ResponseEntity&lt;StudentErrorResponse&gt; <span class="title">handleException</span><span class="params">(Exception exc)</span></span>&#123;</span><br><span class="line">    StudentErrorResponse error = <span class="keyword">new</span> StudentErrorResponse();</span><br><span class="line"></span><br><span class="line">    error.setStatus(HttpStatus.BAD_REQUEST.value());</span><br><span class="line">    error.setMessage(exc.getMessage());</span><br><span class="line">    error.setTimeStamp(System.currentTimeMillis());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(error, HttpStatus.BAD_REQUEST);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="全局错误处理"><a href="#全局错误处理" class="headerlink" title="全局错误处理"></a>全局错误处理</h3><p>利用<code>@ControllerAdvice</code>可以实现全局的错误处理，而不是像之前那样把handler放在RestController中</p>
<p>要使用<code>@ControllerAdvice</code>来实现全局异常处理，可以按照以下步骤操作：</p>
<ol>
<li>创建一个新的类，并用<code>@ControllerAdvice</code>注解这个类。这个类将作为全局异常处理器。</li>
<li>在这个类内部，你可以定义一个或多个方法，用<code>@ExceptionHandler</code>注解来指定它们能处理的异常类型。你可以为不同类型的异常创建不同的方法。</li>
<li>在这些方法内部，你可以定义异常处理的逻辑，例如返回一个错误响应给客户端。通常，这些方法会返回<code>ResponseEntity</code>对象，它包含了错误信息和HTTP状态码。</li>
<li>重构你的REST服务。你可以移除在<code>RestController</code>类中的异常处理代码，因为现在全局异常处理器会处理这些异常。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentRestExceptionHandler</span> </span>&#123;</span><br><span class="line">     <span class="meta">@ExceptionHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;StudentErrorResponse&gt; <span class="title">handleException</span><span class="params">(StudentNotFoundException exc)</span> </span>&#123;</span><br><span class="line">        StudentErrorResponse error = <span class="keyword">new</span> StudentErrorResponse();</span><br><span class="line"></span><br><span class="line">        error.setStatus(HttpStatus.NOT_FOUND.value());</span><br><span class="line">        error.setMessage(exc.getMessage());</span><br><span class="line">        error.setTimeStamp(System.currentTimeMillis());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(error, HttpStatus.NOT_FOUND);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//add another exception handler to catchany exception(all)</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseEntity&lt;StudentErrorResponse&gt; <span class="title">handleException</span><span class="params">(Exception exc)</span></span>&#123;</span><br><span class="line">        StudentErrorResponse error = <span class="keyword">new</span> StudentErrorResponse();</span><br><span class="line"></span><br><span class="line">        error.setStatus(HttpStatus.BAD_REQUEST.value());</span><br><span class="line">        error.setMessage(exc.getMessage());</span><br><span class="line">        error.setTimeStamp(System.currentTimeMillis());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(error, HttpStatus.BAD_REQUEST);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2024/02/02/Springboot-RESTAPI/4.png" style="zoom:67%;"></p>
<p><strong>处理流程</strong></p>
<ol>
<li><strong>REST Client</strong>：REST客户端（如浏览器或其他服务）发起一个API请求，例如请求一个不存在的资源（<code>/api/students/9999</code>）。</li>
<li><strong>REST Service</strong>：REST服务接收到请求，并处理它。在处理过程中，如果请求的资源不存在或遇到其他问题，服务将抛出一个异常。</li>
<li><strong>Controller Advice</strong>：<code>@ControllerAdvice</code>注解的类将捕获抛出的异常。这个类中定义了全局异常处理器，可以包含一个或多个用<code>@ExceptionHandler</code>注解的方法。</li>
<li><strong>Exception Handler(s)</strong>：具体的异常处理方法（如上图所示的异常处理器）会处理捕获到的异常，并决定如何响应。这可能包括设置状态码、定义错误消息、记录日志等。</li>
<li><strong>Response to REST Client</strong>：一旦异常被处理，一个响应将被发送回REST客户端。这个响应通常包含错误状态码（如404）和错误消息，告知客户端发生了什么错误。</li>
</ol>
<h2 id="API设计实践"><a href="#API设计实践" class="headerlink" title="API设计实践"></a>API设计实践</h2><p>设计API的原则应该遵循RESTful架构风格，即表示状态转移（Representational State Transfer）。这种风格强调了资源的定义、资源间的关系以及资源的自描述性。在RESTful API设计中，不应该在URL中包含动词来描述操作，因为HTTP方法已经定义了行为（例如GET用于检索资源，POST用于创建资源，PUT用于更新资源，DELETE用于删除资源）。</p>
<p>例如，不应该使用如下的URLs：</p>
<ul>
<li>/api/deleteEmployee</li>
<li>/api/addEmployee</li>
<li>/api/updateEmployee</li>
</ul>
<p>这些都是REST反模式（anti-patterns），因为它们在URL中包含了动作，这是一种不佳的实践。</p>
<p>相反，应该利<strong>用HTTP方法来指定行为</strong>，并且<strong>让URLs指代资源</strong>。例如，应该使用以下URLs结构：</p>
<ul>
<li>POST /api/employees —— 创建新员工</li>
<li>GET /api/employees —— 读取员工列表</li>
<li>GET /api/employees/{employeeId} —— 读取单个员工信息</li>
<li>PUT /api/employees—— 更新员工信息</li>
<li>DELETE /api/employees—— 删除员工</li>
</ul>
<p>在这种设计中，URLs清晰地表示了资源，并且HTTP方法指明了对资源执行的操作。这是符合RESTful API设计原则的，并且能够使API更加直观和易于理解。这种设计支持API的可发现性和可扩展性，也使得API的维护和文档编制变得更加容易。</p>
<h3 id="服务层"><a href="#服务层" class="headerlink" title="服务层"></a>服务层</h3><p><img src="/2024/02/02/Springboot-RESTAPI/6.png" style="zoom:67%;"></p>
<p><strong>服务层（Service Layer）</strong>：它是应用程序架构中的一个中间层，提供了一种组织和封装业务逻辑的方式。在这个例子中，<code>EmployeeService</code>是服务层的一部分，它封装了所有与员工相关的业务逻辑。服务层的好处是它允许你将业务逻辑与其他层（如控制器或数据访问层）分离，这样可以更容易地管理代码并进行单元测试。</p>
<p><strong>控制器（Controller）</strong>：在这种架构中，<code>EmployeeRestController</code>作为控制器，它处理来自客户端的HTTP请求，并将这些请求委托给服务层处理。控制器本身不执行任何业务逻辑；它只是将请求数据传递给服务层，并将服务层的响应返回给客户端。</p>
<p><strong>数据访问对象（DAO）</strong>：<code>EmployeeDAO</code>、<code>SkillsDAO</code>和<code>PayrollDAO</code>等是数据访问层的组成部分，它们负责与数据库进行直接交互。每个DAO可能与一个特定的数据库表或集合交互，并提供了执行CRUD操作的方法。</p>
<p>在这个模型中，服务层可以与多个DAO进行交互，聚合和处理来自不同数据源的信息，并提供给控制器一个整合后的数据视图。这使得控制器可以提供更丰富的业务逻辑而无需直接与数据库交互。服务层的存在也使得如果需要更改业务逻辑，通常只需要在服务层中修改代码，而不需要触及控制器或DAO层。</p>
<h4 id="Sevice"><a href="#Sevice" class="headerlink" title="@Sevice"></a>@Sevice</h4><p>@Service注解在Spring框架中被用作声明一个类为<strong>服务层</strong>组件。</p>
<p>当你在一个类上使用@Service注解时，Spring将会在运行时自动创建该类的一个实例，并将其注册为Spring应用上下文中的一个Bean。这样，你就可以在其他组件中通过依赖注入使用该服务。</p>
<p>例如，<code>EmployeeRestController</code>直接依赖<code>EmployeeDAO</code>来获取数据。为了遵循单一责任原则和提高代码的可维护性，我们可以引入一个服务层来封装与员工相关的所有业务逻辑。</p>
<p>要抽象出一个服务层，可以创建一个新的类（例如<code>EmployeeService</code>），并使用@Service注解。然后在这个类中实现所有与员工相关的业务逻辑，并从控制器中调用这些服务方法。这样，控制器就不需要直接与DAO交互，而是通过服务层来完成这些工作。</p>
<h3 id="编写流程-DAO"><a href="#编写流程-DAO" class="headerlink" title="编写流程-DAO"></a>编写流程-DAO</h3><p>因为Entity没啥好写的，这边主要写一下DAO.</p>
<p>着重注意一下<code>entityManager.merge()</code> 方法：在JPA（Java Persistence API）中用于合并给定实体的状态到当前持久化上下文中。具体来说，此方法可以执行以下操作：</p>
<ul>
<li><strong>更新（Update）</strong>：如果给定的实体在数据库中已存在（即它有一个数据库ID），<code>merge()</code> 会更新数据库中的现有记录。这意味着它会取实体当前的状态并将其同步到数据库中的对应记录。</li>
<li><strong>保存（Save）</strong>：如果给定的实体在数据库中不存在（即它没有数据库ID或其ID在数据库中没有对应记录），那么<code>merge()</code> 可以将该实体的状态持久化到数据库中。这通常被看作是一个保存操作，因为它会导致一个新的记录被创建。</li>
</ul>
<p><code>merge()</code>方法返回的是一个持久化状态的实体的副本，而传入的实体仍然是分离状态（detached）。通常，我们会使用<code>merge()</code>方法的返回值来继续进行操作，因为它是被管理的实体的引用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeDAOImpl</span> <span class="keyword">implements</span> <span class="title">EmployeeDAO</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> EntityManager entityManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EmployeeDAOImpl</span><span class="params">(EntityManager theEntityManager)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.entityManager = theEntityManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Employee <span class="title">save</span><span class="params">(Employee theEmployee)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//save or update the employee</span></span><br><span class="line">        Employee dbEmployee = entityManager.merge(theEmployee);</span><br><span class="line">        <span class="keyword">return</span> dbEmployee;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        TypedQuery&lt;Employee&gt; theQuery = entityManager.createQuery(<span class="string">"FROM Employee"</span>,Employee<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> theQuery.getResultList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Employee <span class="title">getById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> entityManager.find(Employee<span class="class">.<span class="keyword">class</span>,<span class="title">id</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        Employee employee = entityManager.find(Employee<span class="class">.<span class="keyword">class</span>,<span class="title">id</span>)</span>;</span><br><span class="line">        entityManager.remove(employee);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="编写流程-Service"><a href="#编写流程-Service" class="headerlink" title="编写流程-Service"></a>编写流程-Service</h3><p><strong>定义服务接口（Define Service Interface）</strong>：</p>
<ul>
<li>这是定义服务操作的合同，它声明了服务层将提供的方法。例如，在员工管理系统中，一个服务接口可能包括<code>findAllEmployees</code>, <code>findEmployeeById</code>, <code>saveEmployee</code>, <code>deleteEmployee</code>等方法。</li>
<li>使用接口的好处是提供了一个清晰的API规范，并允许在不同的实现之间灵活切换，这对于测试和未来的扩展非常有用。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeService</span> </span>&#123;</span><br><span class="line">    <span class="function">Employee <span class="title">save</span><span class="params">(Employee theEmployee)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;Employee&gt; <span class="title">getAll</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">Employee <span class="title">getById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>定义服务实现（Define Service Implementation）</strong>：</p>
<ul>
<li>这是服务接口的具体实现，包含业务逻辑的实际代码。这里会实现接口中声明的所有方法，并在这些方法中编写管理员工数据的业务逻辑。</li>
<li>在服务实现中，通常需要访问数据层来进行CRUD操作，这通常通过注入相应的DAO（如<code>EmployeeDAO</code>）来实现。</li>
</ul>
<p><strong>注入EmployeeDAO（Inject the EmployeeDAO）</strong>：</p>
<ul>
<li>通过依赖注入，服务实现可以获得对<code>EmployeeDAO</code>的引用，这使得服务层能够使用DAO提供的方法来访问和修改数据库中的数据。</li>
<li>在Spring框架中，依赖注入通常是通过使用<code>@Autowired</code>注解来完成的，它可以在服务实现的构造函数、设置方法或直接在属性上使用。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeServiceImpl</span> <span class="keyword">implements</span> <span class="title">EmployeeService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> EmployeeDAO employeeDAO;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EmployeeServiceImpl</span><span class="params">(EmployeeDAO theEmployeeDAO)</span> </span>&#123;</span><br><span class="line">        employeeDAO = theEmployeeDAO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">findAllEmployees</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> employeeDAO.findAll();</span><br><span class="line">    &#125;</span><br><span class="line">  	</span><br><span class="line">  	<span class="comment">//涉及到对数据库的修改，因此要在服务层注解@Transactional</span></span><br><span class="line">  	<span class="comment">//而不再是在DAO层注解，因为DAO只负责和数据库沟通，不负责逻辑</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Employee <span class="title">save</span><span class="params">(Employee theEmployee)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> employeeDAO.save(theEmployee);</span><br><span class="line">    &#125;</span><br><span class="line">  	</span><br><span class="line">  	<span class="meta">@Transactional</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        employeeDAO.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 其他方法...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="编写流程-Controller"><a href="#编写流程-Controller" class="headerlink" title="编写流程-Controller"></a>编写流程-Controller</h3><p><strong>在Controller中注入Service</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 标记这个类为一个REST控制器，这意味着这个类会处理HTTP请求并返回HTTP响应。</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="comment">// 指定这个控制器处理的请求路径前缀。</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/api"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeRestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注入EmployeeService，这个服务将被用来处理业务逻辑。</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeService employeeService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用@Autowired来自动注入EmployeeService实例。</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EmployeeRestController</span><span class="params">(EmployeeService theEmployeeService)</span></span>&#123;</span><br><span class="line">        employeeService = theEmployeeService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理GET请求，用于获取所有员工的列表。</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/employees"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getEmployee</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> employeeService.getAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理GET请求，用于根据ID获取单个员工。&#123;employeeId&#125;是一个路径变量。</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/employees/&#123;employeeId&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Employee <span class="title">getEmployeeById</span><span class="params">(@PathVariable <span class="keyword">int</span> employeeId)</span></span>&#123;</span><br><span class="line">        Employee theEmployee =  employeeService.getById(employeeId);</span><br><span class="line">        <span class="comment">// 如果员工不存在，抛出异常。</span></span><br><span class="line">        <span class="keyword">if</span>(theEmployee == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Employee id not found -"</span>+employeeId);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> theEmployee;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理POST请求，用于添加新员工。请求体中的数据会被转换为Employee对象。</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/employees"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Employee <span class="title">addEmployee</span><span class="params">(@RequestBody Employee theEmployee)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 保存员工，并返回保存后的员工信息。</span></span><br><span class="line">        Employee dbEmployee = employeeService.save(theEmployee);</span><br><span class="line">        <span class="keyword">return</span> dbEmployee;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理DELETE请求，用于根据ID删除员工。</span></span><br><span class="line">    <span class="meta">@DeleteMapping</span>(<span class="string">"/employees/&#123;employeeId&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Employee <span class="title">deleteEmployeeById</span><span class="params">(@PathVariable <span class="keyword">int</span> employeeId)</span></span>&#123;</span><br><span class="line">        Employee theEmployee =  employeeService.getById(employeeId);</span><br><span class="line">        <span class="comment">// 如果员工不存在，抛出异常。</span></span><br><span class="line">        <span class="keyword">if</span>(theEmployee == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Employee id not found -"</span>+employeeId);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 删除员工。</span></span><br><span class="line">        employeeService.deleteById(employeeId);</span><br><span class="line">        <span class="comment">// 返回被删除的员工信息。</span></span><br><span class="line">        <span class="keyword">return</span> theEmployee;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 处理PUT请求，用于更新员工信息。请求体中的数据会被转换为Employee对象。</span></span><br><span class="line">    <span class="meta">@PutMapping</span>(<span class="string">"/employees"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Employee <span class="title">updateEmployee</span><span class="params">(@RequestBody Employee theEmployee)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 更新员工，并返回更新后的员工信息。</span></span><br><span class="line">        Employee dbEmployee = employeeService.save(theEmployee);</span><br><span class="line">        <span class="keyword">return</span> dbEmployee;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>架构：</p>
<p><img src="/2024/02/02/Springboot-RESTAPI/5.png" style="zoom:67%;"></p>
<ol>
<li>Set up Database Dev Environment</li>
<li>Create Spring Boot project using Spring Initializr</li>
<li>Get list of employees</li>
<li>Get single employee by ID</li>
<li>Add a new employee</li>
<li>Update an existing employee</li>
<li>Delete an existing employee</li>
</ol>
<h1 id="代码精简阶段"><a href="#代码精简阶段" class="headerlink" title="代码精简阶段"></a>代码精简阶段</h1><h2 id="Spring-Data-JPA"><a href="#Spring-Data-JPA" class="headerlink" title="Spring Data JPA"></a>Spring Data JPA</h2><p>Spring Data JPA是Spring提供的一个库，它简化了基于JPA（Java Persistence API）的数据访问层的实现。JPA是Java EE的一个标准规范，用于对象关系映射（ORM），它的目的是<strong>简化现有Java ORM技术</strong>，如Hibernate等。</p>
<p>Spring Data JPA的主要作用和特点包括：</p>
<ol>
<li><strong>简化数据访问层的开发</strong>: Spring Data JPA提供了一系列的模板方法，可以很容易地进行数据库的增、删、改、查操作，而<strong>无需编写大量的DAO层代码</strong>。</li>
<li><strong>仓库支持</strong>: 它允许你通过定义仓库接口直接执行数据库操作。Spring Data JPA在后台为这些接口生成代理实现。</li>
<li><strong>查询方法的自动生成</strong>: 你可以通过在仓库接口中定义查询方法的名字来直接生成查询，Spring Data JPA会根据方法名的约定来自动创建查询。</li>
<li><strong>自定义查询</strong>: 除了方法名查询，你还可以使用<code>@Query</code>注解来定义JPQL（Java Persistence Query Language）或本地SQL查询。</li>
<li><strong>分页和排序</strong>: Spring Data JPA提供了对分页和排序的内置支持，可以非常容易地实现这些功能。</li>
<li><strong>事务管理</strong>: 它与Spring的声明式事务管理完全集成，可以很方便地对事务进行控制。</li>
<li><strong>持久化对象的生命周期管理</strong>: 通过对实体类进行注解，Spring Data JPA可以管理持久化对象的整个生命周期。</li>
</ol>
<h3 id="编写步骤"><a href="#编写步骤" class="headerlink" title="编写步骤"></a>编写步骤</h3><ol>
<li><strong>定义仓库接口</strong>：创建一个接口，例如<code>EmployeeRepository</code>，并让它继承<code>JpaRepository</code>。泛型参数<code>&lt;Employee, Integer&gt;</code>指定了这个仓库管理的实体类类型和它的主键类型。在这个例子中，<code>Employee</code>是实体类，<code>Integer</code>是它的主键类型。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Employee</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// 标准的CRUD操作都已经包含在内</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>自动化的CRUD操作</strong>：继承自<code>JpaRepository</code>的接口会自动提供多种方法，包括：<ul>
<li><code>findAll()</code>：获取所有记录</li>
<li><code>findById(ID id)</code>：根据ID获取记录</li>
<li><code>save(S entity)</code>：保存或更新记录</li>
<li><code>deleteById(ID id)</code>：根据ID删除记录</li>
<li>还有更多其他的方法<br>这里对findById需要着重说一下：</li>
</ul>
</li>
</ol>
<p><img src="/2024/02/02/Springboot-RESTAPI/7.png" style="zoom:67%;"></p>
<p>在Java中，<code>Optional</code> 类型是一个容器对象，它可能包含也可能不包含非空值。如果值存在，则<code>isPresent()</code>方法会返回<code>true</code>，并且<code>get()</code>方法会返回该值。这是一种更安全的方法来处理可能为<code>null</code>的对象，因为它可以避免直接使用<code>null</code>值可能导致的<code>NullPointerException</code>。</p>
<p>因此我们要这样修改代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">findById</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">    Optional&lt;Employee&gt; result = theEmployeeRepository.findById(id);</span><br><span class="line">    Employee theEmployee = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span>(result.isPresent())&#123;</span><br><span class="line">        theEmployee = result.get();</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Did not find employe id - "</span> +id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> theEmployee;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>自定义查询</strong>：如果你需要除了标准CRUD操作之外的其他查询，你可以在仓库接口中自定义方法。Spring Data JPA支持通过解析方法名来创建查询，这种方式被称为方法名查询。这意味着你可以在你的仓库接口中声明方法，而不需要实现它们。Spring Data JPA在后台使用方法名和持久化实体的元数据来构建查询。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Employee&gt; <span class="title">findByLastName</span><span class="params">(String lastName)</span></span>;</span><br></pre></td></tr></table></figure>
<p>这是一个仓库接口中的方法签名，Spring Data JPA根据这个方法名findByLastName理解为你想执行一个查询，这个查询会返回所有lastName字段匹配给定参数的Employee实体对象列表。</p>
<p>这里的原理包括以下几个步骤：</p>
<p>方法解析：当你调用这个方法时，Spring Data JPA的基础设施会解析方法名。findBy是查询操作的前缀，LastName（注意大小写）指的是Employee实体中的lastName属性。</p>
<p>查询创建：Spring Data JPA会根据这个方法名构建一个查询，等同于SELECT e FROM Employee e WHERE e.lastName = :lastName。</p>
<p>参数绑定：方法参数lastName在运行时传入，它会被绑定到查询中lastName变量的位置。</p>
<p>执行查询：Spring Data JPA会执行这个查询并返回结果。</p>
<p>支持的查询类型：除了基本的查询（如findBy），Spring Data JPA还支持其他类型的查询，比如countBy、deleteBy和readBy等，还支持通过属性的多个条件进行查询，如findByFirstNameAndLastName。</p>
<p>复杂查询：对于更复杂的查询，你可以使用@Query注解来自定义JPQL（Java Persistence Query Language）或原生SQL查询。</p>
<ol>
<li><strong>无需实现类</strong>：最大的优势是你不需要提供这个接口的实现。Spring Data JPA会在运行时自动创建这个接口的实现，并提供必要的数据库操作。</li>
<li><strong>注入和使用</strong>：在你的服务层或控制器中，你可以通过<code>@Autowired</code>注解自动注入这个接口的实例，并使用它进行数据库操作。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeService</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeRepository employeeRepository;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getAllEmployees</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> employeeRepository.findAll();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 其他使用employeeRepository的方法...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Spring-Data-Rest"><a href="#Spring-Data-Rest" class="headerlink" title="Spring Data Rest"></a>Spring Data Rest</h2><p>Spring Data REST 是一个根据 Spring Data repositories 构建的库，它能够将 repository 自动暴露为 RESTful 资源。这可以大大减少编写和维护基于 HTTP 的 RESTful 接口的工作量。</p>
<p>利用 Spring Data REST，你可以通过简单地声明一个继承自 <code>JpaRepository</code> 的接口，<strong>无需编写控制器的代码</strong>即可获得一个完整的 CRUD（创建、读取、更新、删除）操作的 REST API。Spring Data REST 会根据你的实体类和 repository 接口，自动为你创建这些 RESTful 端点。</p>
<p>例如，如果你有一个 <code>Employee</code> 实体和一个 <code>EmployeeRepository</code> 接口，Spring Data REST 自动将实体类名字变为小写，并添加 “s” 来创建复数形式的端点，例如 <code>/employees</code>。端点会关联到 <code>EmployeeRepository</code>，可以通过 HTTP 方法（GET、POST、PUT、DELETE）对其进行操作，从而实现对 <code>Employee</code> 实体的 CRUD 操作。这样可以避免编写和维护大量的模板化的 REST 代码，从而可以专注于实现业务逻辑。</p>
<p>要使用 Spring Data REST，你需要将其添加到你的 Spring Boot 项目的依赖中，并声明 repository 接口。Spring Data REST 会在幕后为你完成剩下的工作</p>
<p>依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-rest&lt;&#x2F;artifactId&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>
<p>也就是说，架构会精简很多，<strong>不再需要RestController和Service文件了</strong>。只需要一个Entity和一个继承了JpaRepository的接口即可</p>
<p><img src="/2024/02/02/Springboot-RESTAPI/8.png" style="zoom:67%;"></p>
<h3 id="HATEOAS"><a href="#HATEOAS" class="headerlink" title="HATEOAS"></a>HATEOAS</h3><p>HATEOAS 是一个缩写，全称为 “Hypermedia as the Engine of Application State”。这是一个 REST 应用设计的约束，旨在增强服务的可发现性和自描述性。</p>
<p>在 HATEOAS 约束下，客户端不需要对服务的结构有硬编码的知识，它通过服务提供的超媒体（如链接）来发现可用的动作和资源。服务的响应将包括不仅仅是所请求数据，还包括对其他相关操作的链接。这些链接为客户端提供了可能的下一步操作，<strong>使得客户端可以根据当前资源的状态进行导航</strong>。</p>
<p>例如，如果一个客户端请求一个员工资源，服务不仅返回员工数据，还可能包括到该员工的编辑、删除或其他相关资源的链接。这意味着客户端可以通过这些链接来了解如何与资源交互，而无需预先了解服务器上的 URI 结构。</p>
<p>Spring Data REST 项目自动为 Spring Data repositories 实现了 HATEOAS，并创建了遵循这些原则的 RESTful 端点。因此，当你使用 Spring Data REST 时，你得到的不只是简单的 CRUD 端点，还有一个遵循 HATEOAS 原则的、丰富的、可以直接使用的 REST API。</p>
<p>这种方式提高了 API 的可用性和灵活性，因为 API 的使用者可以通过链接来探索和发现如何使用服务，而无需阅读大量文档或者理解复杂的 URL 结构。</p>
<p>比如，当get方法请求所有Employee时</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"_embedded"</span>: &#123;</span><br><span class="line">        <span class="attr">"employees"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"firstName"</span>: <span class="string">"Leslie"</span>,</span><br><span class="line">                <span class="attr">"lastName"</span>: <span class="string">"Andrews"</span>,</span><br><span class="line">                <span class="attr">"email"</span>: <span class="string">"leslie@luv2code.com"</span>,</span><br><span class="line">                <span class="attr">"_links"</span>: &#123;</span><br><span class="line">                    <span class="attr">"self"</span>: &#123;</span><br><span class="line">                        <span class="attr">"href"</span>: <span class="string">"http://localhost:8080/magic-api/employees/1"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">"employee"</span>: &#123;</span><br><span class="line">                        <span class="attr">"href"</span>: <span class="string">"http://localhost:8080/magic-api/employees/1"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">		<span class="comment">//...</span></span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"_links"</span>: &#123;</span><br><span class="line">        <span class="attr">"self"</span>: &#123;</span><br><span class="line">            <span class="attr">"href"</span>: <span class="string">"http://localhost:8080/magic-api/employees?page=0&amp;size=20"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"profile"</span>: &#123;</span><br><span class="line">            <span class="attr">"href"</span>: <span class="string">"http://localhost:8080/magic-api/profile/employees"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"page"</span>: &#123;</span><br><span class="line">        <span class="attr">"size"</span>: <span class="number">20</span>,</span><br><span class="line">        <span class="attr">"totalElements"</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">"totalPages"</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">"number"</span>: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>HATEOAS 风格的 RESTful API。下面是其特点的详细解释：</p>
<ol>
<li><strong><code>_embedded</code></strong>:<ul>
<li>这一部分包含了实际的资源数据数组，这里是名为 <code>employees</code> 的资源列表。</li>
<li>每个资源项包含基本属性（如 <code>firstName</code>、<code>lastName</code> 和 <code>email</code>）和 <code>_links</code>。</li>
</ul>
</li>
<li><strong>资源的链接（Resource Links）</strong>:<ul>
<li>在每个 <code>employees</code> 资源对象中，<code>_links</code> 包含了相关的超媒体链接，这些链接指向了资源的具体操作。</li>
<li><code>&quot;self&quot;</code> 链接代表了资源自身的位置，这里是 <code>http://localhost:8080/magic-api/employees/1</code>，客户端可以用它来直接访问或者修改该资源。</li>
</ul>
</li>
<li><strong>顶级链接（Top-Level Links）</strong>:<ul>
<li>在 <code>_links</code> 部分，<code>&quot;self&quot;</code> 表示当前资源集合的链接，而 <code>&quot;profile&quot;</code> 通常表示该资源的描述信息，或者说是它的元数据。</li>
</ul>
</li>
<li><strong>分页信息（Pagination）</strong>:<ul>
<li><code>page</code> 对象包含分页信息：<ul>
<li><code>size</code> 表示每页显示的条目数。</li>
<li><code>totalElements</code> 表示所有条目的总数。</li>
<li><code>totalPages</code> 表示总页数。</li>
<li><code>number</code> 表示当前页的页码。</li>
</ul>
</li>
</ul>
</li>
</ol>
<p>这种结构的特点是它允许客户端仅通过返回的 JSON 即可了解如何与 API 进行交互，包括资源的获取、分页导航、以及如何获取更多关于资源的信息。</p>
<h3 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h3><h4 id="spring-data-rest-base-path"><a href="#spring-data-rest-base-path" class="headerlink" title="spring.data.rest.base-path"></a>spring.data.rest.base-path</h4><p>在 Spring Boot 应用程序中设置 <code>spring.data.rest.base-path</code> 属性的目的是指定 Spring Data REST 暴露其 RESTful endpoints 时使用的基础路径（base path）。这意味着，所有由 Spring Data REST 自动生成的 HTTP endpoints 将会以这个基础路径作为前缀。</p>
<p>例如，如果不设置这个属性，默认情况下，如果你有一个 <code>Employee</code> 实体和相应的 <code>EmployeeRepository</code>，Spring Data REST 将会在 <code>/employees</code> 路径下创建 CRUD endpoints。</p>
<p>但是，如果你在 <code>application.properties</code> 中设置了以下属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.data.rest.base-path&#x3D;&#x2F;magic-api</span><br></pre></td></tr></table></figure>
<p>那么所有的 endpoints 将会有一个额外的 <code>/magic-api</code> 前缀，比如 <code>/magic-api/employees</code>。</p>
<p>使用基础路径的好处有：</p>
<ol>
<li><strong>命名空间隔离</strong>：它有助于将 API 与应用程序中其他的 HTTP endpoints 隔离开，特别是当你的应用程序同时服务于前端和 API 端点时，这可以帮助你避免路由冲突。</li>
<li><strong>版本控制</strong>：它可以用来为你的 API 提供版本管理，例如，你可以将基础路径设置为 <code>/api/v1</code>，未来如果有破坏性更改，你可以将新版本的 API 设置为 <code>/api/v2</code>。</li>
<li><strong>清晰性</strong>：它提供了一个明确的 API 路径前缀，使得 API 的使用者能够更清晰地识别和访问 endpoints。</li>
<li><strong>灵活性</strong>：在需要将 API 代理到另一个服务或路径时，这提供了更大的灵活性。</li>
</ol>
<h4 id="spring-data-rest-default-page-size"><a href="#spring-data-rest-default-page-size" class="headerlink" title="spring.data.rest.default-page-size"></a><code>spring.data.rest.default-page-size</code></h4><p>这个属性用于配置分页接口的默认页面大小。在不指定页面大小的请求中，返回的数据量会使用这个值。例如，如果设置为<code>10</code>，除非客户端在请求中指定了其他大小，否则所有的分页查询默认将返回每页10条记录。</p>
<h4 id="spring-data-rest-max-page-size"><a href="#spring-data-rest-max-page-size" class="headerlink" title="spring.data.rest.max-page-size"></a><code>spring.data.rest.max-page-size</code></h4><p>这个属性限制了客户端可以请求的最大页面大小。这是一个安全特性，防止客户端请求过多的数据，可能会对服务器性能造成影响。如果客户端请求的页面大小超过此限制，Spring Data REST将返回最大页面大小的数据。</p>
<p>设置这些属性可以帮助你更好地控制REST API的行为，例如</p>
<h3 id="复杂复数情况"><a href="#复杂复数情况" class="headerlink" title="复杂复数情况"></a>复杂复数情况</h3><p>在Spring Data REST中，如果实体的复数形式不规则，或者出于业务需求需要将资源的名称暴露为与实体类名不同的形式，可以使用<code>@RepositoryRestResource</code>注解来自定义路径。</p>
<p>例如，如果有一个名为<code>Person</code>的实体，但想要其REST资源的复数形式为<code>people</code>而不是默认的<code>persons</code>，可以这样定义仓库接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">javaCopy code</span><br><span class="line"><span class="meta">@RepositoryRestResource</span>(collectionResourceRel = <span class="string">"people"</span>, path = <span class="string">"people"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PersonRepository</span> <span class="keyword">extends</span> <span class="title">PagingAndSortingRepository</span>&lt;<span class="title">Person</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里的<code>collectionResourceRel</code>属性定义了资源的名称，<code>path</code>属性定义了资源的路径。在这个例子中，通过访问<code>/people</code>路径就可以访问到<code>Person</code>资源的集合。这样可以解决Spring Data REST不能自动处理复杂复数形式的问题。</p>
<h3 id="Pagination"><a href="#Pagination" class="headerlink" title="Pagination"></a>Pagination</h3><p>在Spring Data REST中，进行分页操作很简单。通过在URL请求中添加<code>page</code>和<code>size</code>参数来实现。这里是根据您提供的图片的说明：</p>
<ul>
<li>默认情况下，如果没有指定分页参数，Spring Data REST会返回第一页的数据，每页默认有20条记录。</li>
<li>页面的索引是基于零的，这意味着第一页实际上是<code>page=0</code>。</li>
</ul>
<p>如果您想要访问特定页面的数据，您可以按照以下格式构造URL：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost:8080&#x2F;employees?page&#x3D;0</span><br></pre></td></tr></table></figure>
<p>这会返回第一页的数据（考虑到页面是从0开始计数的）。</p>
<p>如果您想要改变每页显示的记录数，可以添加<code>size</code>参数，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost:8080&#x2F;employees?size&#x3D;10</span><br></pre></td></tr></table></figure>
<p>这会改变每页显示的记录数为10。</p>
<p>结合<code>page</code>和<code>size</code>参数，可以如下请求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost:8080&#x2F;employees?page&#x3D;1&amp;size&#x3D;10</span><br></pre></td></tr></table></figure>
<p>这会返回第二页的数据，并且每页显示10条记录。</p>
<h3 id="Sorting"><a href="#Sorting" class="headerlink" title="Sorting"></a>Sorting</h3><p>在Spring Data REST中，排序可以通过在URL请求中添加<code>sort</code>参数来实现。这里有几个示例展示了如何构建这样的请求：</p>
<ol>
<li><p>如果您想按姓氏升序排序（这是默认设置），您可以使用以下URL请求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost:8080&#x2F;employees?sort&#x3D;lastName</span><br></pre></td></tr></table></figure>
<p>这告诉Spring Data REST您想要按照<code>lastName</code>属性的升序排列<code>employees</code>资源。</p>
</li>
<li><p>如果您想按名字降序排序，您可以添加<code>,desc</code>到属性后面，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost:8080&#x2F;employees?sort&#x3D;firstName,desc</span><br></pre></td></tr></table></figure>
<p>在这个URL中，<code>sort=firstName,desc</code>指定了对<code>firstName</code>属性进行降序排序。</p>
</li>
<li><p>如果您想要按姓氏升序，然后按名字升序排序，可以用逗号分隔两个字段，并且可以指定排序方向（<code>asc</code>为升序，<code>desc</code>为降序），如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost:8080&#x2F;employees?sort&#x3D;lastName,asc&amp;sort&#x3D;firstName,asc</span><br></pre></td></tr></table></figure>
<p>这个请求将先按<code>lastName</code>升序排列，如果姓氏相同，则按<code>firstName</code>升序排列。</p>
</li>
</ol>
<p>请注意，排序参数遵循属性名称加上排序方向的格式，排序方向是可选的，如果省略，则默认为升序。</p>
<h1 id="Spring-Rest-API-Security"><a href="#Spring-Rest-API-Security" class="headerlink" title="Spring Rest API Security"></a>Spring Rest API Security</h1><p>参考文档：<a href="https://docs.spring.io/spring-security/reference/" target="_blank" rel="noopener">https://docs.spring.io/spring-security/reference/</a></p>
<h2 id="总览"><a href="#总览" class="headerlink" title="总览"></a>总览</h2><p>该图显示了用户与受保护的网络资源之间的交互流程。用户通过Web浏览器发出请求，这个请求会经过一系列的Spring Security过滤器。这些过滤器负责检查请求，确保它符合安全配置要求，这可能包括验证用户的身份和权限。如果请求被验证通过，用户将能够访问受保护的网络资源，例如URL路径“/mytopsecretstuff”。另外，还有一个用于存储用户信息的组件，其中包括用户的密码和角色，这对于授权检查非常关键。</p>
<p><img src="/2024/02/02/Springboot-RESTAPI/9.png" style="zoom:67%;"></p>
<p>添加 Pom,会自动为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>一旦添加了这个依赖，Spring Boot会自动配置标准的安全设置。这通常包括所有的HTTP端点都会被保护起来，要求进行身份验证才能访问。如下所示：</p>
<p><img src="/2024/02/02/Springboot-RESTAPI/11.png" style="zoom:67%;"></p>
<p><img src="/2024/02/02/Springboot-RESTAPI/12.png" style="zoom:100%;"></p>
<p>如果我们想自己设置用户名密码,需要在properties文件中设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.security.user.name&#x3D;scott</span><br><span class="line">spring.security.user.password&#x3D;test123</span><br></pre></td></tr></table></figure>
<h3 id="声明式安全性"><a href="#声明式安全性" class="headerlink" title="声明式安全性"></a>声明式安全性</h3><p>这是Spring Security提供的一个关键特性。以下是其主要点的解释：</p>
<ol>
<li><strong>在配置中定义应用程序的安全限制</strong>：<ul>
<li>这意味着安全规则和策略不是硬编码在应用程序的代码中，而是声明在外部配置文件或注解中。这使得安全策略的管理更加集中和灵活，因为可以修改这些配置而不需要改动代码本身。</li>
</ul>
</li>
<li><strong>所有Java配置：@Configuration</strong>：<ul>
<li>在Spring框架中，<code>@Configuration</code>注解标记的类会作为配置源，这些类中可以定义多个<code>@Bean</code>方法，这些方法会被Spring容器管理。在Spring Security的上下文中，这个特性被用来定义安全配置，如HTTP安全、用户详情服务和密码编码器等。</li>
</ul>
</li>
<li><strong>应用程序逻辑和安全逻辑分离</strong>：<ul>
<li>通过声明式安全性，应用程序逻辑和安全逻辑分离。开发人员可以专注于业务逻辑的开发，而安全配置可以由专门的安全专家来管理。这符合软件工程中的关注点分离（Separation of Concerns，SoC）原则，旨在降低应用程序的复杂性并提高可维护性。</li>
</ul>
</li>
</ol>
<p>总结来说，这页PPT描述了Spring Security允许开发者以声明式的方式来配置安全性，而不是将安全逻辑与业务逻辑混合在一起。</p>
<h3 id="编程式安全（Programmatic-Security）"><a href="#编程式安全（Programmatic-Security）" class="headerlink" title="编程式安全（Programmatic Security）"></a>编程式安全（Programmatic Security）</h3><p>这是Spring Security支持的另一种安全模型。以下是其核心概念的解释：</p>
<ol>
<li><strong>Spring Security提供了一个API用于自定义应用编程（Spring Security provides an API for custom application coding）</strong>：<ul>
<li>这表示开发者可以使用Spring Security提供的API直接在应用程序的代码中编写安全逻辑。与声明式安全性相比，这种方式允许在代码级别上更细粒度地控制安全行为，如在方法调用前后执行安全检查。</li>
</ul>
</li>
<li><strong>为特定应用需求提供更大的自定义化（Provides greater customization for specific app requirements）</strong>：<ul>
<li>编程式安全允许针对应用程序的具体安全需求进行定制。开发者可以根据不同的业务场景，使用Spring Security的API来编写定制的安全检查和逻辑。这种方式非常适合于需要特殊安全需求或者复杂安全逻辑的应用程序。</li>
</ul>
</li>
</ol>
<p>结合声明式安全，编程式安全为开发者提供了全面的工具，使他们可以选择最适合他们应用程序需求的安全配置方法。开发者可以只使用声明式安全来处理大部分的通用安全需求，同时也可以通过编程式安全来处理更特定或复杂的安全需求。这两种安全模型通常在同一个应用程序中并存，确保了既有灵活性又保持了安全性。</p>
<h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><p>Spring Security通过以下方式保证安全性：</p>
<ol>
<li><strong>请求拦截</strong>：当用户尝试访问一个Web资源时，Spring Security的过滤器链首先拦截这个请求。</li>
<li><strong>资源保护检查</strong>：过滤器检查这个Web资源是否受到保护。如果不受保护，请求将直接通过，资源被显示给用户。如果资源受保护，流程继续到下一步。</li>
<li><strong>身份验证检查</strong>：接下来，过滤器检查用户是否已经通过身份验证。如果用户已经登录（即身份已验证），请求将继续到授权检查。如果用户未登录，将会发生以下情况：<ul>
<li>用户被重定向到登录表单。</li>
<li>用户输入其ID和密码以进行身份验证。</li>
<li>如果身份验证失败，用户将保留在登录表单，可能会显示一个错误消息。</li>
</ul>
</li>
<li><strong>授权检查</strong>：一旦用户通过身份验证，过滤器将检查用户是否有权访问请求的资源。这通常是通过检查用户的角色和权限来实现的。</li>
<li><strong>访问控制决策</strong>：<ul>
<li>如果用户被授权访问资源，资源将被显示给用户。</li>
<li>如果用户没有被授权，将显示“访问被拒绝”的消息。</li>
</ul>
</li>
</ol>
<p>在整个过程中，Spring Security通过一系列的安全过滤器，结合定义在安全配置中的规则来执行上述检查，从而确保只有合法和授权的用户能够访问受保护的资源。这个流程涵盖了<strong>认证（用户是谁）</strong>和<strong>授权（用户能做什么）</strong>两个安全的主要方面。</p>
<p><img src="/2024/02/02/Springboot-RESTAPI/10.png" style="zoom:67%;"></p>
<h2 id="身份验证和授权管理"><a href="#身份验证和授权管理" class="headerlink" title="身份验证和授权管理"></a>身份验证和授权管理</h2><p>最简单的是把所有身份信息放在内存当中。</p>
<p>除了In-memory方法之外，还有以下几种方法可以实现身份验证和授权管理：</p>
<ol>
<li><strong>JDBC</strong>：使用Java数据库连接，可以将用户身份信息存储在关系型数据库中。</li>
<li><strong>LDAP</strong>：使用轻量级目录访问协议，可以对接到目录服务中进行身份验证和授权。</li>
<li><strong>Custom / Pluggable</strong>：实现自定义的身份验证和授权机制，或者插入第三方的安全服务。</li>
</ol>
<p>在Spring Security中，密码通常存储为编码后的字符串，遵循<code>{id}encodedPassword</code>的格式。这里的<code>{id}</code>部分是一个标识符，用于表示使用的是哪种密码编码器。编码后的密码是实际存储在数据库或内存中的密码。</p>
<ul>
<li><code>noop</code>：这是一个密码编码器的标识符，代表“NoOpPasswordEncoder”，意味着密码不进行任何编码，以明文形式存储。这通常只在测试或开发时使用，因为它不安全。</li>
<li><code>bcrypt</code>：这是另一个密码编码器的标识符，代表“BCryptPasswordEncoder”，它使用BCrypt强散列方法来加密密码。这是一种安全的存储密码的方式，因为它难以逆向工程，且每次加密都会生成一个唯一的哈希值，即使是相同的密码。</li>
</ul>
<h3 id="In-Memory"><a href="#In-Memory" class="headerlink" title="In-Memory"></a>In-Memory</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoSecurityConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> InMemoryUserDetailsManager <span class="title">userDetailsManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        UserDetails john = User.builder()</span><br><span class="line">                .username(<span class="string">"john"</span>) <span class="comment">// 设置用户名为john</span></span><br><span class="line">                .password(<span class="string">"&#123;noop&#125;test123"</span>) <span class="comment">// 设置用户密码为test123，&#123;noop&#125;表示密码不需要加密处理</span></span><br><span class="line">                .roles(<span class="string">"EMPLOYEE"</span>) </span><br><span class="line">                .build(); </span><br><span class="line"></span><br><span class="line">        UserDetails mary = User.builder()</span><br><span class="line">                .username(<span class="string">"mary"</span>)</span><br><span class="line">                .password(<span class="string">"&#123;noop&#125;test123"</span>)</span><br><span class="line">                .roles(<span class="string">"EMPLOYEE"</span>, <span class="string">"MANAGER"</span>) </span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">         UserDetails susan = User.builder()</span><br><span class="line">                .username(<span class="string">"susan"</span>)</span><br><span class="line">                .password(<span class="string">"&#123;noop&#125;test123"</span>)</span><br><span class="line">                .roles(<span class="string">"EMPLOYEE"</span>, <span class="string">"MANAGER"</span>, <span class="string">"ADMIN"</span>) </span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> InMemoryUserDetailsManager(john, mary, susan);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="根据角色限制访问"><a href="#根据角色限制访问" class="headerlink" title="根据角色限制访问"></a>根据角色限制访问</h3><p>比如我想限制的employe的端点，如下所示</p>
<ul>
<li><code>GET /api/employees</code>：读取所有员工信息，需要<code>EMPLOYEE</code>角色。</li>
<li><code>GET /api/employees/{employeeId}</code>：读取单个员工信息，需要<code>EMPLOYEE</code>角色。</li>
<li><code>POST /api/employees</code>：创建一个新员工，需要<code>MANAGER</code>角色。</li>
<li><code>PUT /api/employees</code>：更新一个员工信息，需要<code>MANAGER</code>角色。</li>
<li><code>DELETE /api/employees/{employeeId}</code>：删除一个员工，需要<code>ADMIN</code>角色。</li>
</ul>
<p>Spring Security中如何根据角色限制对特定HTTP路径的访问的两种不同的方法：</p>
<ul>
<li>使用<code>requestMatchers()</code>方法来指定匹配的HTTP方法和路径。</li>
<li>对于每个匹配的路径，使用<code>.hasRole()</code>来指定所需的角色。</li>
</ul>
<h4 id="第一种写法"><a href="#第一种写法" class="headerlink" title="第一种写法"></a>第一种写法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">requestMatchers(&lt;&lt; add path to match on &gt;&gt;)</span><br><span class="line">    .hasRole(&lt;&lt; authorized role &gt;&gt;)</span><br></pre></td></tr></table></figure>
<p>这里使用的是<code>.hasRole()</code>方法，这意味着只有被授权的<strong>单个角色</strong>可以访问匹配的路径。例如，想要只有具有<code>EMPLOYEE</code>角色的用户访问某个路径，你会使用<code>.hasRole(&quot;EMPLOYEE&quot;)</code>。</p>
<h4 id="第二种写法"><a href="#第二种写法" class="headerlink" title="第二种写法"></a>第二种写法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">requestMatchers(&lt;&lt; add path to match on &gt;&gt;)</span><br><span class="line">    .hasAnyRole(&lt;&lt; list of authorized roles &gt;&gt;)</span><br></pre></td></tr></table></figure>
<p>在这种写法中，使用的是<code>.hasAnyRole()</code>方法，它允许<strong>多个角色</strong>中的任何一个访问匹配的路径。这是逗号分隔的角色列表。例如，想要<code>EMPLOYEE</code>或<code>MANAGER</code>角色的用户都能访问同一个路径，你可以使用<code>.hasAnyRole(&quot;EMPLOYEE&quot;, &quot;MANAGER&quot;)</code>。</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span> <span class="comment">// 表明该方法返回的对象应该被注册为Spring应用上下文中的bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> SecurityFilterChain <span class="title">filterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123; <span class="comment">// 定义安全过滤链配置的方法</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置HTTP请求的安全控制</span></span><br><span class="line">    http.authorizeHttpRequests(configurer -&gt;</span><br><span class="line">        configurer</span><br><span class="line">            .requestMatchers(HttpMethod.GET, <span class="string">"/api/employees"</span>).hasRole(<span class="string">"EMPLOYEE"</span>)</span><br><span class="line">            .requestMatchers(HttpMethod.GET, <span class="string">"/api/employees/**"</span>).hasRole(<span class="string">"EMPLOYEE"</span>)</span><br><span class="line">            .requestMatchers(HttpMethod.POST, <span class="string">"/api/employees"</span>).hasRole(<span class="string">"MANAGER"</span>)</span><br><span class="line">            .requestMatchers(HttpMethod.PUT, <span class="string">"/api/employees"</span>).hasRole(<span class="string">"MANAGER"</span>)</span><br><span class="line">            .requestMatchers(HttpMethod.DELETE, <span class="string">"/api/employees/**"</span>).hasRole(<span class="string">"ADMIN"</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置HTTP Basic认证</span></span><br><span class="line">    http.httpBasic(Customizer.withDefaults());</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// 禁用跨站请求伪造（CSRF）</span></span><br><span class="line">		http.csrf(csrf -&gt; csrf.disable());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构建并返回HttpSecurity实例</span></span><br><span class="line">    <span class="keyword">return</span> http.build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这段代码中，<code>.requestMatchers()</code>方法用于指定哪些HTTP请求需要安全控制。<code>.hasRole()</code>方法接受一个角色名称，并确保只有拥有该角色的用户才能执行对应的请求。这个例子中使用的路径模式<code>/api/employees/**</code>意味着匹配<code>/api/employees</code>下的所有路径。</p>
<h4 id="跨站请求伪造（CSRF）的防护"><a href="#跨站请求伪造（CSRF）的防护" class="headerlink" title="跨站请求伪造（CSRF）的防护"></a>跨站请求伪造（CSRF）的防护</h4><p>跨站请求伪造（CSRF）是一种常见的网络攻击方式，它允许恶意网站影响用户在另一个网站上的会话，从而在用户不知情的情况下进行非法操作。Spring Security提供了强大的防护机制来防止此类攻击。</p>
<h5 id="CSRF防护的工作原理"><a href="#CSRF防护的工作原理" class="headerlink" title="CSRF防护的工作原理"></a>CSRF防护的工作原理</h5><p>Spring Security通过向HTML表单中添加一个同步的防伪标记（CSRF令牌）来防止CSRF攻击。该令牌是一个随机生成的值，服务器在生成表单时创建并发送给客户端，随后客户端提交请求时必须返回这个令牌。服务器会验证提交的令牌是否与用户会话中的令牌相匹配，从而确保请求是合法的。</p>
<h5 id="CSRF防护的应用场景"><a href="#CSRF防护的应用场景" class="headerlink" title="CSRF防护的应用场景"></a>CSRF防护的应用场景</h5><p>CSRF防护通常应用于以下情况：</p>
<ul>
<li><strong>传统Web应用程序</strong>：如果你的应用程序使用HTML表单来添加或修改数据，那么你应该启用CSRF防护。因为这些操作可能会影响服务器上的数据状态，因此需要确保请求的真实性。</li>
<li><strong>浏览器请求</strong>：对于通过常规浏览器发出的所有Web请求，Spring Security推荐启用CSRF防护。浏览器用户可能不了解他们打开的标签页或窗口的真实性，因此CSRF防护可以帮助确保用户操作的安全性。</li>
</ul>
<h5 id="禁用CSRF防护的情况"><a href="#禁用CSRF防护的情况" class="headerlink" title="禁用CSRF防护的情况"></a>禁用CSRF防护的情况</h5><p>在某些情况下，可能需要禁用CSRF防护：</p>
<ul>
<li><strong>REST API</strong>：当你构建的是面向非浏览器客户端的REST API时，可以考虑禁用CSRF防护。因为这些客户端，如移动应用或其他服务，不容易受到传统CSRF攻击的影响。</li>
<li><strong>无状态API</strong>：对于无状态的REST API，CSRF防护通常不是必需的。<strong>通常对于使用POST、PUT、DELETE和/或PATCH这些HTTP方法的无状态REST API，不需要CSRF保护</strong>。这是因为无状态API不使用cookie存储用户状态，而CSRF攻击通常是通过用户浏览器中的有效cookie来进行的。因此，如果API不依赖于浏览器cookie，它本质上对CSRF攻击就有了抵抗力。</li>
</ul>
<h5 id="实施CSRF防护"><a href="#实施CSRF防护" class="headerlink" title="实施CSRF防护"></a>实施CSRF防护</h5><p>在Spring Security中，你可以通过简单的配置启用或禁用CSRF防护。默认情况下，CSRF防护是开启的，但如果你的应用场景属于上述的特定情况，可以通过配置来关闭CSRF防护。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">http.csrf().disable(); &#x2F;&#x2F; 禁用CSRF防护</span><br></pre></td></tr></table></figure>
<p>总结来说，CSRF防护是Web安全的重要组成部分，应根据应用的特定需求来合理配置。通过Spring Security，开发人员可以轻松地为他们的应用程序实现强大的CSRF防护。</p>
<h3 id="数据库存储"><a href="#数据库存储" class="headerlink" title="数据库存储"></a>数据库存储</h3><p>Spring Security允许使用数据库来验证用户信息，这通常涉及以下步骤：</p>
<ol>
<li><strong>遵循Spring Security的预定义表架构</strong>：Spring Security定义了一些标准的表结构，用于存储用户、角色和权限信息。这些表通常包括用户表、权限表和用户权限映射表。</li>
<li><strong>在JDBC代码中使用这些表</strong>：需要编写JDBC代码来与数据库中的Spring Security表进行交互，从而验证用户信息。</li>
</ol>
<p>根据您提供的图片内容，我们可以了解到Spring Security支持数据库集成，以存储和验证用户凭据（如用户名和密码）、角色和权限等。以下是如何在Spring Security中配置数据库支持的步骤：</p>
<h3 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h3><ol>
<li><strong>开发SQL脚本来设置数据库表</strong>：编写SQL脚本来创建Spring Security预定义的表，以及可能需要的任何自定义表。</li>
<li><strong>将数据库支持添加到Maven POM文件</strong>：在项目的Maven POM文件中添加数据库驱动和Spring Security依赖。</li>
<li><strong>创建JDBC属性文件</strong>：创建一个属性文件来存储数据库连接信息，如URL、用户名、密码以及任何其他必要的配置。</li>
<li><strong>更新Spring Security配置以使用JDBC</strong>：在Spring Security配置中指定要使用JDBC认证，并提供必要的服务和数据源配置。</li>
</ol>
<p><img src="/2024/02/02/Springboot-RESTAPI/13.png" style="zoom:67%;"></p>
<p>上图是Spring Security默认使用的数据库表结构，涉及两个主要表：</p>
<ol>
<li><strong>users</strong> 表：通常用来存储用户信息，包含字段：<ul>
<li><code>username</code>: 用户名，通常作为登录凭证的一部分。</li>
<li><code>password</code>: 存储用户密码，通常是加密后的字符串。</li>
<li><code>enabled</code>: 一个标志位，表示用户账号是否启用。在Spring Security中，它通常用来判断用户是否允许登录。</li>
</ul>
</li>
<li><strong>authorities</strong> 表：用来存储用户的权限（在Spring Security中，权限通常与角色等同）：<ul>
<li><code>username</code>: 用户名，用于将权限与特定用户关联。</li>
<li><code>authority</code>: 权限或角色名称。</li>
</ul>
</li>
</ol>
<h3 id="Bcrypt"><a href="#Bcrypt" class="headerlink" title="Bcrypt"></a>Bcrypt</h3>
      
    </div>
    
    
    
    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束，感谢您的阅读-------------</div>
    
</div>

      
    </div>
    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:</strong>
    Jason
  </li>
  <li class="post-copyright-link">
    <strong>Post link:</strong>
    <a href="https://jasonxqh.github.io/2024/02/02/Springboot-RESTAPI/" title="Springboot-RESTAPI">https://jasonxqh.github.io/2024/02/02/Springboot-RESTAPI/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice: </strong>
    All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> unless stating additionally.
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/spring/" rel="tag"><i class="fa fa-tag"></i> spring</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2024/01/31/Springboot-Hibernate/" rel="next" title="Springboot-Hibernate">
                <i class="fa fa-chevron-left"></i> Springboot-Hibernate
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2024/11/11/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F-java/" rel="prev" title="设计模式-java">
                设计模式-java <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC80OTgyMC8yNjMxMQ=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Jason</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives%7C%7C%20archive">
              
                  <span class="site-state-item-count">427</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">60</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/JasonXQH" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:10195501423@stu.ecnu.edu.cn" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://yanghong.tech/" title="友链:杨弘的博客" target="_blank">友链:杨弘的博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ankate.github.io/" title="友链:赵奕轲的博客" target="_blank">友链:赵奕轲的博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://github.com/JasonXQH/JasonXQH.github.io" title="Like it, STAR ME" target="_blank">Like it, STAR ME</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Springboot-RESTAPI"><span class="nav-number">1.</span> <span class="nav-text">Springboot-RESTAPI</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#构建RESTFul-Controller"><span class="nav-number">1.1.</span> <span class="nav-text">构建RESTFul Controller</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#原理"><span class="nav-number">1.1.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RestController"><span class="nav-number">1.1.2.</span> <span class="nav-text">RestController</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RequestMapping和-GetMapping"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">@RequestMapping和@GetMapping</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据绑定和POJO"><span class="nav-number">1.2.</span> <span class="nav-text">数据绑定和POJO</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#简介"><span class="nav-number">1.2.1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#利用POJO进行数据传递-以Student为例"><span class="nav-number">1.2.2.</span> <span class="nav-text">利用POJO进行数据传递-以Student为例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#路径变量"><span class="nav-number">1.3.</span> <span class="nav-text">路径变量</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#PathVariable"><span class="nav-number">1.3.1.</span> <span class="nav-text">@PathVariable</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RequestBody"><span class="nav-number">1.3.2.</span> <span class="nav-text">@RequestBody</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#错误处理"><span class="nav-number">1.4.</span> <span class="nav-text">错误处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#处理一般错误"><span class="nav-number">1.4.1.</span> <span class="nav-text">处理一般错误</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#全局错误处理"><span class="nav-number">1.4.2.</span> <span class="nav-text">全局错误处理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#API设计实践"><span class="nav-number">1.5.</span> <span class="nav-text">API设计实践</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#服务层"><span class="nav-number">1.5.1.</span> <span class="nav-text">服务层</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Sevice"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">@Sevice</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编写流程-DAO"><span class="nav-number">1.5.2.</span> <span class="nav-text">编写流程-DAO</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编写流程-Service"><span class="nav-number">1.5.3.</span> <span class="nav-text">编写流程-Service</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编写流程-Controller"><span class="nav-number">1.5.4.</span> <span class="nav-text">编写流程-Controller</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#代码精简阶段"><span class="nav-number">2.</span> <span class="nav-text">代码精简阶段</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-Data-JPA"><span class="nav-number">2.1.</span> <span class="nav-text">Spring Data JPA</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#编写步骤"><span class="nav-number">2.1.1.</span> <span class="nav-text">编写步骤</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-Data-Rest"><span class="nav-number">2.2.</span> <span class="nav-text">Spring Data Rest</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HATEOAS"><span class="nav-number">2.2.1.</span> <span class="nav-text">HATEOAS</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Properties"><span class="nav-number">2.2.2.</span> <span class="nav-text">Properties</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#spring-data-rest-base-path"><span class="nav-number">2.2.2.1.</span> <span class="nav-text">spring.data.rest.base-path</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#spring-data-rest-default-page-size"><span class="nav-number">2.2.2.2.</span> <span class="nav-text">spring.data.rest.default-page-size</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#spring-data-rest-max-page-size"><span class="nav-number">2.2.2.3.</span> <span class="nav-text">spring.data.rest.max-page-size</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#复杂复数情况"><span class="nav-number">2.2.3.</span> <span class="nav-text">复杂复数情况</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pagination"><span class="nav-number">2.2.4.</span> <span class="nav-text">Pagination</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sorting"><span class="nav-number">2.2.5.</span> <span class="nav-text">Sorting</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Spring-Rest-API-Security"><span class="nav-number">3.</span> <span class="nav-text">Spring Rest API Security</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#总览"><span class="nav-number">3.1.</span> <span class="nav-text">总览</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#声明式安全性"><span class="nav-number">3.1.1.</span> <span class="nav-text">声明式安全性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编程式安全（Programmatic-Security）"><span class="nav-number">3.1.2.</span> <span class="nav-text">编程式安全（Programmatic Security）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#流程"><span class="nav-number">3.2.</span> <span class="nav-text">流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#身份验证和授权管理"><span class="nav-number">3.3.</span> <span class="nav-text">身份验证和授权管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#In-Memory"><span class="nav-number">3.3.1.</span> <span class="nav-text">In-Memory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#根据角色限制访问"><span class="nav-number">3.3.2.</span> <span class="nav-text">根据角色限制访问</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#第一种写法"><span class="nav-number">3.3.2.1.</span> <span class="nav-text">第一种写法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#第二种写法"><span class="nav-number">3.3.2.2.</span> <span class="nav-text">第二种写法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#代码"><span class="nav-number">3.3.3.</span> <span class="nav-text">代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#跨站请求伪造（CSRF）的防护"><span class="nav-number">3.3.3.1.</span> <span class="nav-text">跨站请求伪造（CSRF）的防护</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#CSRF防护的工作原理"><span class="nav-number">3.3.3.1.1.</span> <span class="nav-text">CSRF防护的工作原理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#CSRF防护的应用场景"><span class="nav-number">3.3.3.1.2.</span> <span class="nav-text">CSRF防护的应用场景</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#禁用CSRF防护的情况"><span class="nav-number">3.3.3.1.3.</span> <span class="nav-text">禁用CSRF防护的情况</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#实施CSRF防护"><span class="nav-number">3.3.3.1.4.</span> <span class="nav-text">实施CSRF防护</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#数据库存储"><span class="nav-number">3.3.4.</span> <span class="nav-text">数据库存储</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#开发流程"><span class="nav-number">3.3.5.</span> <span class="nav-text">开发流程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Bcrypt"><span class="nav-number">3.3.6.</span> <span class="nav-text">Bcrypt</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart" aria-hidden="true"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jason</span>
 <!--
  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">1265.2k</span>
  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>



-->
        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('-1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->


  
  

  
  


  

  

</body>
</html>
