<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="y0-26jFM_8wn6Slpy1ahkB8ndR7w0OOGyAU6IaXjLUI" />














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Java," />










<meta name="description" content="Java基础3ExceptionsWhat are Exceptions 当我们调用一个将字符串变成大写的函数、传入的却是一个空指针。运行后Java就会给我们一个报错： “name is null“ 。 Java给我们的报错信息非常有用，因为他能帮我们将发生错误的每一句代码都列出，并且一直到最深处。 Types of ExceptionsChecked exception比如说我想读取一个文件，但">
<meta property="og:type" content="article">
<meta property="og:title" content="Java基础3">
<meta property="og:url" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/index.html">
<meta property="og:site_name" content="Jason‘s Blog">
<meta property="og:description" content="Java基础3ExceptionsWhat are Exceptions 当我们调用一个将字符串变成大写的函数、传入的却是一个空指针。运行后Java就会给我们一个报错： “name is null“ 。 Java给我们的报错信息非常有用，因为他能帮我们将发生错误的每一句代码都列出，并且一直到最深处。 Types of ExceptionsChecked exception比如说我想读取一个文件，但">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/5.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/6.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/7.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/9.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/10.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/11.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/12.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/13.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/14.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/15.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/16.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/17.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/18.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/19.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/21.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/22.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/23.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/24.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/25.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/26.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/27.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/28.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/42.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/43.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/44.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/45.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/46.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/47.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/48.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/29.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/49.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/50.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/52.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/53.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/54.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/1.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/2.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/3.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/4.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/20.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/30.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/31.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/32.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/33.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/34.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/35.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/36.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/37.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/38.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/39.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/40.png">
<meta property="og:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/41.png">
<meta property="article:published_time" content="2021-03-18T16:27:30.000Z">
<meta property="article:modified_time" content="2022-08-22T03:12:54.000Z">
<meta property="article:author" content="Jason">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/5.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://jasonxqh.github.io/2021/03/19/Java基础3/"/>





  <title>Java基础3 | Jason‘s Blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-170027658-1', 'auto');
  ga('send', 'pageview');
</script>





<meta name="generator" content="Hexo 4.2.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">
  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
<a href="https://github.com/JasonXQH/JasonXQH.github.io" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jason‘s Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />
            
            Sitemap
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Java基础3</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-03-19T00:27:30+08:00">
                2021-03-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  18k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  73
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Java基础3"><a href="#Java基础3" class="headerlink" title="Java基础3"></a>Java基础3</h1><h2 id="Exceptions"><a href="#Exceptions" class="headerlink" title="Exceptions"></a>Exceptions</h2><h3 id="What-are-Exceptions"><a href="#What-are-Exceptions" class="headerlink" title="What are Exceptions"></a>What are Exceptions</h3><p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/5.png" style="zoom:67%;"></p>
<p>当我们调用一个将字符串变成大写的函数、传入的却是一个空指针。运行后Java就会给我们一个报错： “name is null“ 。</p>
<p>Java给我们的报错信息非常有用，因为他能帮我们将发生错误的每一句代码都列出，并且一直到最深处。</p>
<h3 id="Types-of-Exceptions"><a href="#Types-of-Exceptions" class="headerlink" title="Types of Exceptions"></a>Types of Exceptions</h3><h4 id="Checked-exception"><a href="#Checked-exception" class="headerlink" title="Checked exception"></a>Checked exception</h4><p>比如说我想读取一个文件，但是这个文件刚刚被删掉了，这时候就会报错。Java 强迫我们在写这类代码的时候一定要做检查，是否存在该文件。否则在编译 的时候就会报错</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/6.png" style="zoom:67%;"></p>
<p>当我们新建了一个FileReader对象、要打开一个 file.txt文件时，Java会提醒我们要为其添加一个 exception，否则连编译都过不了。包括接下来我们要学的线程中的 <code>sleep()、join()</code>函数。</p>
<h4 id="Unchecked-exception-Runtime-exception"><a href="#Unchecked-exception-Runtime-exception" class="headerlink" title="Unchecked exception/Runtime exception"></a>Unchecked exception/Runtime exception</h4><p>如同我们刚才讲的例子： <code>NullPointerException</code> 还有其他几种 <code>Runtime Exceptions</code> ，它们不会在编译前就报错。因此我们要养成良好的编程习惯以及积累经验来规避这些问题</p>
<ul>
<li>ArithmeticException</li>
<li>IllegalArgumentException</li>
<li>IndexOutOfBoundsException</li>
<li>IllegalStateException</li>
</ul>
<p>Checked 和 Unchecked Excption 主要区别在：</p>
<ul>
<li>Runtime exceptions:<ul>
<li>在定义方法时<strong>不需要声明</strong>会抛出runtime exception;</li>
<li>在调用这个方法时<strong>不需要捕获</strong>这个runtime exception;</li>
</ul>
</li>
</ul>
<p>runtime exception是从java.lang.RuntimeException或java.lang.Error类衍生出来的。</p>
<ul>
<li>Checked exceptions:<ul>
<li>定义方法时<strong>必须声明</strong>所有可能会抛出的checked exception;</li>
<li>在调用这个方法时，<strong>必须捕获</strong>它的checked exception，不然就得把它的exception传递下去;</li>
</ul>
</li>
</ul>
<p>从逻辑的角度来说，checked exceptions和runtime exception是有不同的使用目的的。checked exception用来指示一种调用方<strong>能够直接处理</strong>的异常情况。而runtime exception则用来指示一种<strong>调用方本身无法处理</strong>或恢复的程序错误</p>
<h4 id="Error"><a href="#Error" class="headerlink" title="Error"></a>Error</h4><p>第三种是我们束手无策的错误，比如写了个无限循环，或者是内存溢出了。我们必须规避这种低级错误。</p>
<h3 id="Exceptions-Hierarchy"><a href="#Exceptions-Hierarchy" class="headerlink" title="Exceptions Hierarchy"></a>Exceptions Hierarchy</h3><p>现在我们来看一下 Exception 的组织结构。首先，最上层的是 <code>Throwable Class</code> ,这个class中包含了<code>Exception class</code>和<code>Error</code>两个类。  Exception 类中又包括 <code>RuntimeException class</code> 也就是unchecked Exception</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/7.png" style="zoom:67%;"></p>
<h3 id="Catching-Exceptions"><a href="#Catching-Exceptions" class="headerlink" title="Catching Exceptions"></a>Catching Exceptions</h3><p>对于 checked exception, 我们可以用 <code>try-catch</code> 代码块来捕捉错误：</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/9.png" style="zoom:67%;"></p>
<p>这样既可以打印 StackTrace来帮助我们找到错误，又可以让整个程序正常结束。最终，问题出在 Java.io库中的open0函数。</p>
<h3 id="Catching-Multiple-Types-of-Exceptions"><a href="#Catching-Multiple-Types-of-Exceptions" class="headerlink" title="Catching Multiple Types of Exceptions"></a>Catching Multiple Types of Exceptions</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionsDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader(<span class="string">"File.txt"</span>);</span><br><span class="line">            <span class="keyword">var</span> value = reader.read();</span><br><span class="line">            <span class="keyword">new</span> SimpleDateFormat().parse(<span class="string">""</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (FileNotFoundException | ParseException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">            System.out.println(<span class="string">"Could not read data"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果我们想要捕捉多个 Exception，我们可以使用多个 catch块。如果报错的信息是一样的，我们还可以用 或 运算符将它们放在一起。</p>
<p>注意，<code>IOException</code> 这个 catch block不能放到前面，否则会报错：因为IOException 包含了所有输入输出的错误，是一个“兜底“的类，如果将其放在第一个，就导致FileNotFoundException被IOException处在的代码块率先捕捉了。</p>
<h3 id="The-finally-Block"><a href="#The-finally-Block" class="headerlink" title="The finally Block"></a>The finally Block</h3><p>如果reader成功打开、我做好处理之后，想要把文件关掉，这时候应该怎么写？</p>
<p>我们应该把 <code>reader.close()</code>放在try代码块中吗？ 显然不行，因为如果try成功打开了文件，但在<code>var value = reader.read();</code>时抛出了一个错误，会直接跳到catch块，try后面的代码就不再被执行了。</p>
<p>我们应该直接把 <code>reader.close()</code>放在catch之后吗？ 貌似也不行。因为这样如果在未来我们在try-catch 和 close两者之间插入新的代码，并抛出新的错误的时候，reader还是不会被正常关闭。</p>
<p>因此，我们应该使用 finally block.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionsDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        FileReader reader = <span class="keyword">null</span>;<span class="comment">//一定要预设为null不然finally block不好做判断</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            reader = <span class="keyword">new</span> FileReader(<span class="string">"File.txt"</span>);</span><br><span class="line">            <span class="keyword">var</span> value = reader.read();</span><br><span class="line">            <span class="keyword">new</span> SimpleDateFormat().parse(<span class="string">""</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">            System.out.println(<span class="string">"Could not read data"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(reader!=<span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    reader.close();</span><br><span class="line">                &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>finally在try代码块正常被进入执行，jvm正常执行处理的情况下，是一定会被执行的。</strong> 如果在 try block中存在return；那么finally的执行时间是：retrun表达式执行之后，在return返回操作之前。</p>
<h3 id="The-try-with-resources-Statement"><a href="#The-try-with-resources-Statement" class="headerlink" title="The try-with-resources Statement"></a>The try-with-resources Statement</h3><p>但是像刚才那样写finally block 会比较丑。我们有更好的方法来实现： 就是将申明对象、打开文件都放到 try后面的括号当中，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionsDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span>(<span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader(<span class="string">"File.txt"</span>)) &#123;</span><br><span class="line">            <span class="keyword">var</span> value = reader.read();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">            System.out.println(<span class="string">"Could not read data"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种方法叫做 <code>try-with-resources Statement</code>,这样一来，我们就不用显式地写 close() 了，jvm会自动帮我们生成和上面的finally block一样的代码。</p>
<p><a href="https://docs.oracle.com/en/java/javase/16/docs/api/index.html" target="_blank" rel="noopener">https://docs.oracle.com/en/java/javase/16/docs/api/index.html</a></p>
<p>在官方的文档中，我们可以找到AutoCloseable这个接口，这个接口下所有的子类都可以用这种<code>try-with-resources Statement</code>方法来自动关闭。比如说：FileReader、FileWriter这样的类。</p>
<h3 id="Throwing-Exceptions"><a href="#Throwing-Exceptions" class="headerlink" title="Throwing Exceptions"></a>Throwing Exceptions</h3><p>之前我们做的都是找到错误、抓住错误，但是现在我们要来主动抛出一个错误。</p>
<p>首先我们来讲 <code>defensive programming</code> ，也就是说遇到了错误，我们主动抛出并终结整个程序，如：</p>
<p> <img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/10.png" style="zoom:67%;"></p>
<p>我们新建了一个类，这里面会对value值进行一个判断，如果value小于0，就会抛出一个 <code>IllegalArgumentException()</code>错误，并结束整个程序。</p>
<p>如果我们的程序对value值得符号要求很高，如果输入不合法的值对整个程序的性能造成很大的影响(如库、框架等供多人使用的程序)，那么我们就应该适用这种 <code>defensive programming</code> 的方法，严格要求。</p>
<p>那么如果要throw一个 Checked Exception,该怎么写呢？比如说我在 Account 账户中抛出一个 IOException()这类异常，然后我必须在main函数中做一个 try-catch block 来接住这个exception</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/11.png" style="zoom:67%;"></p>
<p>注意了，在 Account 类中的 desposit 函数如果要抛出一个 <code>IOException</code>的话，必须在函数声明后面标明：<code>throws IOException</code>来告诉调用方我这个方法可能会抛出一个异常，而你调用者需要接收。</p>
<h3 id="Re-throwing-Exceptions"><a href="#Re-throwing-Exceptions" class="headerlink" title="Re-throwing Exceptions"></a>Re-throwing Exceptions</h3><p>现在我们在 ExceptionDemo 中接收 Account 抛出来的信息，然后再main函数中调用 <code>ExceptionDemo.show()</code>， 如果我现在希望ExceptionDemo收到异常信息后能将 StackTrace 记录到日志，并让main函数向用户打印一个有好的信息，应该怎么办？</p>
<p>这时候，我们应该 Re-throwing ,也就是说在收到Account  发出的异常信号的时候，ExceptionsDemo再向它的调用方(也就是main) 抛出一个错误，类似于一个接力的效果。然后在main中用<code>try-catch</code> 接收信号并打印一些信息：</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/12.png" style="zoom:67%;"></p>
<h3 id="Custom-Exceptions"><a href="#Custom-Exceptions" class="headerlink" title="Custom Exceptions"></a>Custom Exceptions</h3><p>Java已经为我们提供了很多基础异常类了，但是有些时候我们还是需要为我们的项目客制化一些异常。</p>
<p>比如说刚才那个例子，我在Account 中设立一个 withdraw(取钱的函数)，方法逻辑是：如果要取出的钱大于账户余额，那么就抛出一个异常。但这时用java提供的标准异常也不太贴切，因此我们可以自定义一个异常。</p>
<p>首先我们要创建一个自定义的异常类，异常类要以 <code>Exception</code>作为结尾，要有辨识度。然后我们要决定这个异常类是属于 <code>checked exception</code> (继承Exception类) 还是 <code>unchecked exception</code> (继承RuntimeException类)，然后</p>
<p>继承Exception 类之后，我们要自定义异常警告。因为 异常类是一个有参构造函数，因此我们还需要设置<code>super(&quot;异常信息&quot;)</code> 。这里我们也提供了两种构造函数，一种默认构造函数直接设置异常信息为 Insufficient funds in your account, 第二种则是让调用者自定义报错信息的有参构造函数。</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/13.png" style="zoom:67%;"></p>
<h3 id="Chaining-Exceptions"><a href="#Chaining-Exceptions" class="headerlink" title="Chaining Exceptions"></a>Chaining Exceptions</h3><p>Chaining Exception 就是将一个更广泛的异常包裹一个比较具体的异常。那刚才的例子来说，我们有一个比较具体的异常： <code>InsufficientFundsException()</code> 但是造成取钱失败的异常还可能有很多种，因此我们可以创建一个更加广泛地异常类 <code>AccountException()</code> :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.exceptions;</span><br><span class="line"><span class="comment">//这里我super中传入的是一个异常的原因，比如 InsufficientFundsException 这个异常类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountException</span> <span class="keyword">extends</span> <span class="title">Exception</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AccountException</span><span class="params">(Exception cause)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(cause);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在 Account 类当中，当取款大于余额的时候，我们会向上抛出一个 AccountException类，并在这个类中传入原因：InsufficientFundsException，告诉调用者这是因为余额不够导致的账户异常。这就是 chain exception</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> balance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deposit</span><span class="params">(<span class="keyword">float</span> value)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(value&lt;=<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IOException();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">withdraw</span><span class="params">(<span class="keyword">float</span> value)</span> <span class="keyword">throws</span> AccountException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(value &gt; balance)</span><br><span class="line">            <span class="keyword">throw</span>  <span class="keyword">new</span> AccountException(<span class="keyword">new</span> InsufficientFundsException());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在ExceptionsDemo类中,我们捕捉一个 AccountException类，然后通过 <code>e.getCause()</code> 获取AccountException中的异常类型并通过<code>getMessage()</code>打印出改原因的异常信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExceptionsDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> account = <span class="keyword">new</span> Account();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            account.withdraw(<span class="number">10</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (AccountException e) &#123;</span><br><span class="line">            <span class="keyword">var</span> cause = e.getCause();</span><br><span class="line">            System.out.println(cause.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Generics"><a href="#Generics" class="headerlink" title="Generics"></a>Generics</h2><p>泛型就是参数化类型</p>
<ul>
<li>适用于多种数据类型执行相同的代码</li>
<li>泛型中的类型在使用时指定</li>
<li>泛型归根到底就是C++中的“模版”</li>
</ul>
<h3 id="The-Need-for-Generics"><a href="#The-Need-for-Generics" class="headerlink" title="The Need for Generics"></a>The Need for Generics</h3><p>比如我创建了一个 <code>List()</code> 类，如下：</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/14.png"></p>
<p>那么如果我想创建一个 User 类的List，就要创建一个新的 UserList 类，久而久之，类就变得很繁杂。这时候我们就需要用到泛型了。</p>
<h3 id="A-Poor-Solution"><a href="#A-Poor-Solution" class="headerlink" title="A Poor Solution"></a>A Poor Solution</h3><p>遇到这种情况，使用 <code>Object Class</code> 是一种下策。因为虽然 所有的类都继承自Object类，但是有很多缺点</p>
<ol>
<li>比如我向Object List中存放了很多的元素(如Integer.valueOf(1)), 现在我想通过get 取出 List当中的第一个元素，但是这时候返回的类型是 Object,要得到int类型的返回结果我们必须进行强制类型转换，否则就会造成报错。</li>
<li>此外，List的管理会变得比较混乱，我们会搞不清楚 List中到底存储着什么类型的数据。</li>
</ol>
<h3 id="Generic-Classes"><a href="#Generic-Classes" class="headerlink" title="Generic Classes"></a>Generic Classes</h3><p>我们新创建一个 <code>GenericList</code> 类，需要在尖括号中一般使用 E或者T 来代表种类。</p>
<p>这里我们声明一个 类型为 T 的数组，因为我们没有办法直接 <code>new T[10]</code>，因为我们不知道传进来的是 int还是string，没办法实例化。这里我们必须创建一个 Object数组然后将其用强制类型转换变成 T 类型。</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/15.png"></p>
<p>然后 我们在main函数就可以声明各种类型的 list了,注意在声明的时候要传入数据类型，而且调用get()方法的时候也不用进行强制类型转换了。</p>
<h3 id="Generics-and-Primitive-Types"><a href="#Generics-and-Primitive-Types" class="headerlink" title="Generics and Primitive Types"></a>Generics and Primitive Types</h3><p>在声明泛型类实例的时候，我们不能穿入 Primitive Types，即 int, boolean，float 之类</p>
<p>如果我们要将这些类型的数据存入到泛型类实例当中，我们就必须要使用到 <strong>Wrapper class</strong></p>
<p>Java中每一个  <strong>Primitive Type</strong> 都有一个对应的 <strong>Wrapper class</strong>(包装类)</p>
<ul>
<li>int -&gt; Integer</li>
<li>float -&gt; Float</li>
<li>boolean -&gt; Boolean</li>
</ul>
<h3 id="Constraints"><a href="#Constraints" class="headerlink" title="Constraints"></a>Constraints</h3><p>如果我们只想让我们的泛型存储数值类型的数据，那么我们可以让 <code>&lt;T extends Number&gt;</code> </p>
<p>所有的包装类<strong>（Integer、Long、Byte、Double、Float、Short）</strong>都是抽象类 Number 的子类。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">包装类</th>
<th style="text-align:left">基本数据类型</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Boolean</td>
<td style="text-align:left">boolean</td>
</tr>
<tr>
<td style="text-align:left">Byte</td>
<td style="text-align:left">byte</td>
</tr>
<tr>
<td style="text-align:left">Short</td>
<td style="text-align:left">short</td>
</tr>
<tr>
<td style="text-align:left">Integer</td>
<td style="text-align:left">int</td>
</tr>
<tr>
<td style="text-align:left">Long</td>
<td style="text-align:left">long</td>
</tr>
<tr>
<td style="text-align:left">Float</td>
<td style="text-align:left">float</td>
</tr>
<tr>
<td style="text-align:left">Double</td>
<td style="text-align:left">Double</td>
</tr>
</tbody>
</table>
</div>
<p>这时候，我再创建一个 String 类型的泛型实例就会报错了。</p>
<p>除了<code>extends Number</code> 之外，我们还可以 <code>extends Comparable</code> ,也就是只能使用可比较的数据类型： String, Integer等，但是如果我们直接传入 User，就会报错，因为我们自己申明的User类暂时是不能比较的。</p>
<p>要想 User能够比较，我们还需要在声明 User 类的时候让其 implements Comparable,如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">User</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(User o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意了，这里要在 Comparable后面用尖括号写上User,然后让Idea自动生成一个 <code>compareTo</code> 的重写函数，这样重写函数中的参数就是User，否则就是Object，而Object范围太广，不太安全。</p>
<p>还可以是 extends Cloneable,是另外一个很有用的接口。比如:<code>&lt;T extends Comparable &amp; Cloneable &gt;</code> </p>
<h3 id="Type-Erasure"><a href="#Type-Erasure" class="headerlink" title="Type Erasure"></a>Type Erasure</h3><p>现在我们在底层看看泛型是怎么实现的。</p>
<p> 我们首先看看没有限制条件的 Generics 的 Bytecode:</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/16.png"></p>
<p>我们发现在ByteCode里面，我们声明的T类型的数组都变成了 Object数组。 也就是说和我们一开始自己写的Object数组是一样的，那么泛型和Object数组的区别在哪里呢？</p>
<p>在于编译的时候Java会帮助我们检查数据类型是否正确，而自己写的Object数组则不会判断，我们可以传入数字也可以是实例化的对象。因此，泛型更便于我们对数据进行管理。 </p>
<p>当我们对泛型做出限定的时候，如 Comparable、Number， ByteCode中数据类型也会从Object变为Number、Comparable等。</p>
<h3 id="Comparable-Interface"><a href="#Comparable-Interface" class="headerlink" title="Comparable Interface"></a>Comparable Interface</h3><p><a href="https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/lang/Comparable.html" target="_blank" rel="noopener">https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/lang/Comparable.html</a></p>
<p>我们上面说了，可以通过 User implements Comparable来把User类变成可比较的类,注意了，这里我们要传入比较的数据类型，否则Java会默认是两个Object在做比较。</p>
<p>如下面这段代码，我们在User里面创建一个points的变量，然后对其进行比较。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.generics;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">User</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> points;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(<span class="keyword">int</span> points)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.points = points;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(User other)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// this &lt; o -&gt; -1</span></span><br><span class="line">        <span class="comment">// this == o -&gt; 0</span></span><br><span class="line">        <span class="comment">// this &gt; o -&gt; 1</span></span><br><span class="line">        <span class="keyword">return</span> points- other.points;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在main函数中，我们就可以对两个User实例进行比较</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">import</span> com.company.generics.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> user1 = <span class="keyword">new</span> User(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">var</span> user2 = <span class="keyword">new</span> User(<span class="number">20</span>);</span><br><span class="line">        <span class="keyword">if</span>(user1.compareTo(user2)&lt;<span class="number">0</span>)</span><br><span class="line">            System.out.println(<span class="string">"user1&lt;user2"</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(user1.compareTo(user2)==<span class="number">0</span>)</span><br><span class="line">            System.out.println(<span class="string">"user1==user2"</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            System.out.println(<span class="string">"user1&gt;user2"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Generic-Methods"><a href="#Generic-Methods" class="headerlink" title="Generic Methods"></a>Generic Methods</h3><p>除了泛型类，还有泛型方法。 在使用限定词的时候，类是 implements， 而方法则是 extends</p>
<p>比如我创建一个 Utils 类，里面有一个max方法，用来返回两个对象中较大的那一个：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.generics;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Utils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends Comparable&lt;T&gt;&gt; <span class="function">T <span class="title">max</span><span class="params">(T first ,T second)</span></span>&#123;</span><br><span class="line">         <span class="keyword">return</span> (first.compareTo(second)&gt;<span class="number">0</span> )? first:second;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在函数定义时，需要在尖括号中写 <code>&lt;T extends Comparable&lt;T&gt;&gt;</code> 返回数据类型也为T，然后利用<code>compareTo</code> 函数来比较二者的大小：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    User max_user = Utils.max(<span class="keyword">new</span> User(<span class="number">10</span>),<span class="keyword">new</span> User(<span class="number">20</span>));</span><br><span class="line">    System.out.println(max_user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果输出的却是这样的结果：<code>com.company.generics.User@3f99bd52</code></p>
<p>是因为返回的对象调用 toString()函数，因此输出了一个hashcode，要解决这个问题，我们需要在 编写 User类的时候重写 <code>toString()</code> 函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">User</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> points;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(<span class="keyword">int</span> points)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.points = points;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(User other)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// this &lt; o -&gt; -1</span></span><br><span class="line">        <span class="comment">// this == o -&gt; 0</span></span><br><span class="line">        <span class="comment">// this &gt; o -&gt; 1</span></span><br><span class="line">        <span class="keyword">return</span> points- other.points;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"User&#123;"</span> +</span><br><span class="line">                <span class="string">"points="</span> + points +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再次运行得到： <code>User{points=20}</code> </p>
<h3 id="Multiple-Type-Parameters"><a href="#Multiple-Type-Parameters" class="headerlink" title="Multiple Type Parameters"></a>Multiple Type Parameters</h3><p>不管是泛型类还是泛型方法都可以传入多种不同类型的参数，我们各给出一个例子：</p>
<p><strong>泛型类</strong></p>
<p>这里我们创建了一个 键值对的类，K 代表key的数据类型，V代表value的数据类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.generics;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.security.Key;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KeyValuePair</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> K key;</span><br><span class="line">    <span class="keyword">private</span> V value;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">KeyValuePair</span><span class="params">(K key,V value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样的，对于方法我们也可以使用多个类型</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T,V&gt; <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(T key,V value)</span></span>&#123;</span><br><span class="line">    System.out.println(key + <span class="string">"="</span>+ value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Generic-Classes-and-Inheritance"><a href="#Generic-Classes-and-Inheritance" class="headerlink" title="Generic Classes and Inheritance"></a>Generic Classes and Inheritance</h3><p>当我们用一个类来继承泛型类的时候，关系可如下图所示：</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/17.png"></p>
<p>也就是说Integer继承了Number，在一般的实例中，Number 是可以接收 Interger类型的参数的；但是在泛型类的实例中 如<code>Box&lt;Number&gt;</code>  只能接收数据类型为Number的数据，不接受 <code>Box&lt;Integer&gt;</code> 和 <code>Box&lt;Double&gt;</code>的参数。</p>
<p>所以说在泛型类中，虽然传入的类之间存在继承关系，但是他们的泛型类是不存在继承关系的。原因在于它们都继承自Object类型，但是二者相互独立。</p>
<p>我们用刚才的例子看一下：</p>
<p>首先我们创建一个 <code>Instructor</code> 类，并让其继承自<code>User</code> 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.generics;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Instructor</span> <span class="keyword">extends</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Instructor</span><span class="params">(<span class="keyword">int</span> points)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(points);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们在Utils中声明两个方法，一个是普通的 <code>printUser</code>方法，另一个则是接收 <code>GenericList&lt;User&gt;</code> 的<code>printUsers</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printUser</span><span class="params">(User user)</span></span>&#123;</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printUsers</span><span class="params">(GenericList&lt;User&gt; users)</span></span>&#123;</span><br><span class="line">    System.out.println(users.get(<span class="number">0</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果在 main 函数当中，可以用printUser来打印一个 Instructor实例，但是不能用 printUsers来打印一个 <code>GenericList&lt;Instructor&gt;</code> 实例：</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/18.png"></p>
<p>为了解决这个问题，我们可以用Wildcards(术语叫通配符，其实就类似于扑克中的万能牌)</p>
<h3 id="Wildcards"><a href="#Wildcards" class="headerlink" title="Wildcards"></a>Wildcards</h3><p>我们可以将 printUsers方法这样写：问号就是通配符，代表着一个unknown的数据类型。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printUsers</span><span class="params">(GenericList&lt;?&gt; users)</span></span>&#123;</span><br><span class="line">    System.out.println(users.get(<span class="number">0</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样虽然解决了问题，但是这样一来，我们可以向 <code>printUsers</code>传入任何数据类型，比如Integer，String等，把他们当做Users打印出来显然是不行的。因此在使用通配符之后还需要加上限定条件</p>
<h4 id="extends"><a href="#extends" class="headerlink" title="? + extends"></a>? + extends</h4><p>当我们使用了通配符 ？之后，相当于java创建了一个我们看不见的 类叫做 <code>CAP#1</code> 用来存放未知的数据类型。 因为可能有多个通配符，所以CAP后面的编号也不同。</p>
<p>如果我们用 <code>?+extends User</code> 的话，就相当于 Class CAP#1 继承了User，而 Instructor 也是继承User的，因此这时候可以向printUsers传入 User以及它的子类，而不能传入 Integer、String这种数据类型了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printUsers</span><span class="params">(GenericList&lt;? extends User&gt; users)</span></span>&#123;</span><br><span class="line">    User x = users.get(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>比如这里我们可以用 User来接收get函数的返回值，因为User是 Cap#1的父类，但是不能用Instructor来接收，因为Instructor和Cap#1是”兄弟“关系，是独立的两个类。</p>
<p>但是，我们不能在这里使用 <code>add()</code>函数。因为CAP#1是个抽象概念，我们没有办法实例化一个CAP#1对象并将其加到Users当中去。</p>
<p>因此如果选择 <code>?+extends</code> 对象是只读不可写的</p>
<h4 id="super"><a href="#super" class="headerlink" title="? + super"></a>? + super</h4><p>super和extends则是刚好相反。只可写不可读</p>
<p>在使用了super关键词后，？相当于 User类的父类，也就是 Object Class</p>
<p>因此<code>GenericList&lt;? super User&gt; users</code> 之后,Java会把users看做是：<code>GenericList&lt;Object&gt; temp</code> 这个对象</p>
<p>这时候我们调用 add方法，因为添加的对象都是Object的子类，因此不会报错。然而我们却无法使用get方法了，因为这时候get的返回类型为Object，但是Java并不知道你用什么类型来接收。很可能两种数据类型是不兼容的，因此不能使用：</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/19.png"></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>总结：</th>
<th>可读</th>
<th>可写</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>?+extends</strong></td>
<td>√</td>
<td>×</td>
</tr>
<tr>
<td><strong>?+super</strong></td>
<td>×</td>
<td>√</td>
</tr>
</tbody>
</table>
</div>
<h2 id="Collections"><a href="#Collections" class="headerlink" title="Collections"></a>Collections</h2><p>提到集合就不得不提一下数组，好多集合底层都是依赖于数组的实现。数组一旦初始化后，长度就确定了，存储数据对象不能达到动态扩展，其次数组存储元素不便于对数组进行<code>添加</code>、<code>修改</code>、<code>删除操作</code>，而且数组可以存储重复元素。这个时候集合对作用显现出来了。集合分为<code>Collection</code>和<code>Map</code>两种体系。Collection的集合类的继承树如下图所示：</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/21.png"></p>
<p>化简可得：</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/22.png"></p>
<p>Collection 接口有 3 种子类型集合: <code>List</code>、<code>Set</code> 和 <code>Queue</code>，再下面是一些抽象类，最后是具体实现类。常用的有 <code>ArrayList</code>用来当数组用，<code>LinkedList</code>即链表；在<code>Queue</code>下常用的是<code>PriorityQueue</code>,即优先队列；在<code>Set</code>下常用 <code>Hashset</code> 用来做哈希映射。</p>
<p>简单的来说，Java中的collection类似于C++中的stl，有多种封装好的数据结构。</p>
<h3 id="The-Iterable-Interface"><a href="#The-Iterable-Interface" class="headerlink" title="The Iterable Interface"></a>The Iterable Interface</h3><p>下面是 Iterable的官方文档：</p>
<p><a href="https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/lang/Iterable.html" target="_blank" rel="noopener">https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/lang/Iterable.html</a></p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/23.png"></p>
<p>在这个接口中一共有三个函数，我们要重写iterator()这个函数，因为这个函数会返回一个迭代器对象。迭代器的数据类型取决于泛型对象的数据类型</p>
<p>当一个类继承了 Iterable之后，他就可以被迭代了。这里，我们先用自建的代码来模拟 ArratList 。这里我虽然重写了Iterator但是没有写任何代码，只是为了做个演示。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericList</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Iterable</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">private</span> T[] items = (T[])<span class="keyword">new</span> Object[<span class="number">10</span>];</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;T&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在main函数中，我们用iterator来接收迭代器，这里返回的是一个String 类型的迭代器。</p>
<p>iterator中两个内置方法很重要，一个是 hasNext()， 也就是用来判断是否存在下一个元素；还有一个是next()即让迭代器指向下一个元素。使用while循环，可以遍历对象中的所有元素。(虽然hasNext()和next()我暂时还没有重写)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> list = <span class="keyword">new</span> GenericList&lt;String&gt;();</span><br><span class="line">    <span class="keyword">var</span> iterator = list.iterator();</span><br><span class="line">    <span class="keyword">while</span>(iterator.hasNext())&#123;</span><br><span class="line">        <span class="keyword">var</span> current = iterator.next();</span><br><span class="line">        System.out.println(current);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其实，while循环可以这样来简化：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> item : list)&#123;</span><br><span class="line">     	System.out.println(item);</span><br><span class="line">   	&#125;</span><br></pre></td></tr></table></figure>
<p>在底层的bytecode都是一样的。</p>
<p>使用了Iterable接口，我们就没有必要在GenericList类中将 <code>private T[] items</code>设置成 <code>public T[] items</code>，照样可以迭代。</p>
<h3 id="The-Iterator-Interface"><a href="#The-Iterator-Interface" class="headerlink" title="The Iterator Interface"></a>The Iterator Interface</h3><p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/24.png"></p>
<p>现在我们继续实现我们自建的 GenericList，刚才只是说了我们可以实现什么功能，但并没有将方法都写出来。</p>
<p>首先我们要在 <code>GenericList</code>中创建一个新的类，叫做<code>ListIterator</code>, 这个类讲接入 <code>Iterator</code>接口并重写 <code>hasNext()</code>、<code>next()</code> 两个函数。并让<code>GenericList</code>中的 <code>iterator</code>方法的返回一个 <code>ListIterator</code>对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericList</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Iterable</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T[] items = (T[]) <span class="keyword">new</span> Object[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(T item)</span> </span>&#123;</span><br><span class="line">        items[count++] = item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> items[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;T&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">//返回一个ListIterator实例，并将自身(GenericList)当做参数传入。</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ListIterator(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// ListIterator 类是定义在Generic 里面的，因此能访问到私有变量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">ListIterator</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">      </span><br><span class="line">        <span class="keyword">private</span> GenericList&lt;T&gt; list;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">int</span> index;</span><br><span class="line"><span class="comment">//定义 ListIterator的有参构造函数，传入参数类型为 GenericList&lt;T&gt;</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ListIterator</span><span class="params">(GenericList&lt;T&gt; list)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.list = list;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//重写 hasNext()函数</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (index &lt; list.count);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//重写next函数，返回list中的下一个元素</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> T <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> list.items[index++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样，一个建议的ArrayList就做完了，我们可以测试一下让其遍历输出：</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/25.png"></p>
<h3 id="The-Collection-Interface"><a href="#The-Collection-Interface" class="headerlink" title="The Collection Interface"></a>The Collection Interface</h3><p>学会了ArrayList原理之后，我们正式来讲讲 Collection 接口, 这是官方文档</p>
<p><a href="https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/Collection.html" target="_blank" rel="noopener">https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/Collection.html</a></p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/26.png"></p>
<p>在文档中，我们看到，Collection实现了 <code>Iterable&lt;E&gt;</code> 接口，这说明 collection中的子接口以及子类都是可以迭代的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CollectionsDemo</span> </span>&#123;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">         Collection&lt;String&gt; collection = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">         collection.add(<span class="string">"a"</span>);</span><br><span class="line">         collection.add(<span class="string">"b"</span>);</span><br><span class="line">         collection.add(<span class="string">"c"</span>);</span><br><span class="line">         Collections.addAll(collection,<span class="string">"d"</span>,<span class="string">"e"</span>,<span class="string">"f"</span>);</span><br><span class="line"></span><br><span class="line">         collection.remove(<span class="string">"a"</span>);</span><br><span class="line">         System.out.println(collection);</span><br><span class="line">         System.out.println(collection.size());</span><br><span class="line"></span><br><span class="line">         <span class="keyword">var</span> objectArray = collection.toArray();</span><br><span class="line">         <span class="keyword">var</span> stringArray = collection.toArray(<span class="keyword">new</span> String[<span class="number">5</span>]);</span><br><span class="line">         System.out.println(objectArray);</span><br><span class="line">         System.out.println(stringArray);</span><br><span class="line"></span><br><span class="line">         Collection&lt;String&gt; other = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">         other.addAll(collection);</span><br><span class="line"></span><br><span class="line">         System.out.println(collection.contains(<span class="string">"a"</span>));</span><br><span class="line">         collection.clear();</span><br><span class="line">         System.out.println(collection.isEmpty());</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是要注意了， collection是不支持通过索引访问的，即我们不能使用中括号或者 <code>add(index,element)</code>这种方法来添加元素的。</p>
<h3 id="The-List-Interface"><a href="#The-List-Interface" class="headerlink" title="The List Interface"></a>The List Interface</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ListDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">//List 同样也有 add 操作，但是list可以通过index来决定插入的位置</span></span><br><span class="line">        list.add(<span class="string">"a"</span>);</span><br><span class="line">        list.add(<span class="string">"b"</span>);</span><br><span class="line">        list.add(<span class="string">"c"</span>);</span><br><span class="line">        list.add(<span class="number">0</span>,<span class="string">"!"</span>);</span><br><span class="line">        System.out.println(list);</span><br><span class="line"><span class="comment">// 打印得到： [!, a, b, c]， 同样也有 addAll 方法。</span></span><br><span class="line">        Collections.addAll(list,<span class="string">"d"</span>,<span class="string">"e"</span>,<span class="string">"f"</span>);</span><br><span class="line"><span class="comment">// set 是替换的方法，这里我们将 list中的第一个元素(!)替换成 "a+"</span></span><br><span class="line">        list.set(<span class="number">0</span>,<span class="string">"a+"</span>);</span><br><span class="line">        System.out.println(list);</span><br><span class="line"><span class="comment">//打印得到：[a+, a, b, c, d, e, f]</span></span><br><span class="line"><span class="comment">//删除第一个元素</span></span><br><span class="line">      	list.remove(<span class="number">0</span>);</span><br><span class="line">        System.out.println(list);</span><br><span class="line"><span class="comment">//打印得到：[a, b, c, d, e, f]</span></span><br><span class="line">      	</span><br><span class="line">      <span class="comment">//打印出元素的"b"的位置，打印得： 1 </span></span><br><span class="line">        System.out.println(list.indexOf(<span class="string">"b"</span>));</span><br><span class="line">      <span class="comment">//打印出元素"ss"的位置，打印得： -1 因为ss并不在list中</span></span><br><span class="line">        System.out.println(list.indexOf(<span class="string">"ss"</span>));</span><br><span class="line">			<span class="comment">// 打印出list的子列表，即[a,b],因为不包括list[2]</span></span><br><span class="line">        System.out.println(list.subList(<span class="number">0</span>,<span class="number">2</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="The-Comparable-Interface"><a href="#The-Comparable-Interface" class="headerlink" title="The Comparable Interface"></a>The Comparable Interface</h3><p>在泛型那章已经讲过 Comparable Interface了，一般来说我们自定义的类如果要实现Comparable接口的话，一般需要重写 compareTo 和 toString 两个方法，如下面这个比较字符串的 Customer类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">Customer</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Customer other)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// this &lt; other -&gt; -1</span></span><br><span class="line">        <span class="comment">// this == other -&gt; 0</span></span><br><span class="line">        <span class="comment">// this &gt; other -&gt; 1</span></span><br><span class="line">        <span class="keyword">return</span> name.compareTo(other.name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="The-Comparator-Interface"><a href="#The-Comparator-Interface" class="headerlink" title="The Comparator Interface"></a>The Comparator Interface</h3><p>现在我们虽然实现了 Customer的排名，但实现起来却比较的麻烦，需要在类内实现。这时Comparator这个接口就可以在类外实现对象的比较。</p>
<p><strong>简单来说，Comparable就是定义一个单独的对象比较器，继承自Comparator接口，实现compare（）方法</strong></p>
<p>比如现在 Customer 中多了一个 Email 参数，然后我们就新建一个 <code>EmailComparator</code>类如下：</p>
<p>在这个类中我们重写 compare方法并按照email进行排序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmailComparator</span> <span class="keyword">implements</span> <span class="title">Comparator</span>&lt;<span class="title">Customer</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Customer o1, Customer o2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> o1.getEmail().compareTo(o2.getEmail());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在main函数中我们对Customer数组进行一个排序</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    List&lt;Customer&gt; customers = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    customers.add(<span class="keyword">new</span> Customer(<span class="string">"b"</span>, <span class="string">"e3"</span>));</span><br><span class="line">    customers.add(<span class="keyword">new</span> Customer(<span class="string">"a"</span>, <span class="string">"e2"</span>));</span><br><span class="line">    customers.add(<span class="keyword">new</span> Customer(<span class="string">"c"</span>, <span class="string">"e1"</span>));</span><br><span class="line">  <span class="comment">//在调用sort的时候，将比较器放在第二个参数上</span></span><br><span class="line">    Collections.sort(customers,<span class="keyword">new</span> EmailComparator()); </span><br><span class="line">  	System.out.println(customers);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>打印得到 [c, a, b]，说明确实是按照email进行排列的</p>
<h3 id="The-Queue-Interface"><a href="#The-Queue-Interface" class="headerlink" title="The Queue Interface"></a>The Queue Interface</h3><p>现在我们来讲 队列接口，这是<code>Queue&lt;E&gt;</code> 的文档：</p>
<p><a href="https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/Queue.html" target="_blank" rel="noopener">https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/Queue.html</a></p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/27.png"></p>
<p>我们看到在 Queue接口下比较常用的就是 ArrayDeque(先进先出)、LinkedList(即继承自Queue又继承自List)、PriorityQueue等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Queue&lt;String&gt; queue  = <span class="keyword">new</span> ArrayDeque&lt;&gt;();</span><br><span class="line">  <span class="comment">//和list一样，queue也有add函数，但是加到队列的末尾</span></span><br><span class="line">  	queue.add(<span class="string">"c"</span>);</span><br><span class="line">    queue.add(<span class="string">"a"</span>);</span><br><span class="line">    queue.add(<span class="string">"b"</span>);</span><br><span class="line">  <span class="comment">// peek()就是获取队列的第一个元素</span></span><br><span class="line">    <span class="keyword">var</span> front = queue.peek();</span><br><span class="line">    System.out.println(front);<span class="comment">// c</span></span><br><span class="line">    System.out.println(queue);<span class="comment">// [c, a, b]</span></span><br><span class="line">    <span class="keyword">var</span> remove = queue.remove();<span class="comment">// 删除第一个元素</span></span><br><span class="line">    System.out.println(remove);<span class="comment">// c</span></span><br><span class="line">    System.out.println(queue);<span class="comment">// [a, b]</span></span><br><span class="line">		<span class="comment">//poll()和remove()都是删除队列第一个元素</span></span><br><span class="line">  	<span class="comment">//他们的唯一区别就是当队列为空时，poll返回null而remove会抛出异常</span></span><br><span class="line">  	System.out.println(queue.poll());<span class="comment">// a</span></span><br><span class="line">    queue.poll();</span><br><span class="line">    System.out.println(queue.poll());<span class="comment">// null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="The-Set-Interface"><a href="#The-Set-Interface" class="headerlink" title="The Set Interface"></a>The Set Interface</h3><p><a href="https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/Set.html" target="_blank" rel="noopener">https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/Set.html</a></p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/28.png"></p>
<p>和C++一样，Set 是不包含重复的元素的. 如果把一个ArrayList放到Set当中，也会将其变成一个不重复的对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Collection&lt;String&gt; collection = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    Collections.addAll(collection, <span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"c"</span>);</span><br><span class="line">    Set&lt;String&gt; set =  <span class="keyword">new</span> HashSet&lt;&gt;(collection);</span><br><span class="line">    System.out.println(set);<span class="comment">//[a, b, c]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在来介绍一些Set中的方法</p>
<p>set其实就是一个集合，数学上集合的操作在Java中都有对应的方法。</p>
<p>比如 <strong>并</strong>，就可以用 <code>addAll()</code> 方法求得</p>
<p><strong>交</strong>，可以用 <code>retainAll()</code>方法求得</p>
<p>A-B, 可以用 <code>removeAll()</code>方法求得</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; set1 = <span class="keyword">new</span> HashSet&lt;&gt;(Arrays.asList(<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>));</span><br><span class="line">  Set&lt;String&gt; set2 = <span class="keyword">new</span> HashSet&lt;&gt;(Arrays.asList(<span class="string">"d"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>));</span><br><span class="line"></span><br><span class="line">  <span class="comment">//Union</span></span><br><span class="line">  set1.addAll(set2);</span><br><span class="line">  System.out.println(set1);<span class="comment">//[a, b, c, d]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//复原</span></span><br><span class="line">  set1 = <span class="keyword">new</span> HashSet&lt;&gt;(Arrays.asList(<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>));</span><br><span class="line">  <span class="comment">// Intersection</span></span><br><span class="line">  set1.retainAll(set2);</span><br><span class="line">  System.out.println(set1);<span class="comment">//[b, c]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//复原</span></span><br><span class="line">  set1 = <span class="keyword">new</span> HashSet&lt;&gt;(Arrays.asList(<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>));</span><br><span class="line">  <span class="comment">//Difference</span></span><br><span class="line">  set1.removeAll(set2);</span><br><span class="line">  System.out.println(set1);<span class="comment">//[a]</span></span><br></pre></td></tr></table></figure>
<h3 id="The-Map-Interface"><a href="#The-Map-Interface" class="headerlink" title="The Map Interface"></a>The Map Interface</h3><p> 在Java和C++中，哈希表可以用 Map接口来实现，在C#、python中，可以用Dictionary(词典)来实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c1 = <span class="keyword">new</span> Customer(<span class="string">"a"</span>,<span class="string">"e1"</span>);</span><br><span class="line"><span class="keyword">var</span> c2 = <span class="keyword">new</span> Customer(<span class="string">"b"</span>,<span class="string">"e2"</span>);</span><br><span class="line"><span class="keyword">var</span> unknown = <span class="keyword">new</span> Customer(<span class="string">"Unknown"</span>,<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">Map&lt;String,Customer&gt;map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">map.put(c1.getEmail(),c1);<span class="comment">// email作为key，而Customer对象作为value</span></span><br><span class="line">map.put(c2.getEmail(),c2);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> customer = map.get(<span class="string">"e1"</span>);</span><br><span class="line">System.out.println(customer);<span class="comment">//a</span></span><br><span class="line"></span><br><span class="line">customer = map.get(<span class="string">"e10"</span>);<span class="comment">//如果按一个不存在的key去找，会返回10</span></span><br><span class="line">System.out.println(customer);<span class="comment">//null</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//找到就返回e10配对的对象，否则就返回unknown</span></span><br><span class="line">customer = map.getOrDefault(<span class="string">"e10"</span>,unknown);</span><br><span class="line">System.out.println(customer);<span class="comment">//Unknown</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> exists = map.containsKey(<span class="string">"e10"</span>);</span><br><span class="line">System.out.println(exists);<span class="comment">//false</span></span><br><span class="line"></span><br><span class="line">map.replace(<span class="string">"e1"</span>,<span class="keyword">new</span> Customer(<span class="string">"a++"</span>,<span class="string">"e1"</span>));</span><br><span class="line">System.out.println(map);<span class="comment">//&#123;e1=a++, e2=b&#125;</span></span><br></pre></td></tr></table></figure>
<p>但是注意了，map是不能够被迭代的，因此我们没用办法用for each loop来直接遍历map，但是我们有其他的方法：</p>
<p>我们可以使用map内置的 entrySet方法来获得每一组键值对</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> entry : map.entrySet()) &#123;</span><br><span class="line">    System.out.println(entry);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出：e1=a++  e2=b</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> entry : map.entrySet()) &#123;</span><br><span class="line">    System.out.println(entry.getValue());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出值 ：a++  b</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> entry : map.entrySet()) &#123;</span><br><span class="line">    System.out.println(entry.getKey());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出索引 key： e1  e2</span></span><br></pre></td></tr></table></figure>
<p>当然，也可以使用<code>map.values()</code>直接获得value</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (customer : map.values()) &#123;</span><br><span class="line">   	System.out.println(customer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Lambda-Expressions"><a href="#Lambda-Expressions" class="headerlink" title="Lambda Expressions"></a>Lambda Expressions</h2><h3 id="Functional-Interfaces"><a href="#Functional-Interfaces" class="headerlink" title="Functional Interfaces"></a>Functional Interfaces</h3><p>函数式接口，是指内部只有<strong>一个</strong>抽象方法的接口。注意，只能有一个，并且是抽象的方法</p>
<p>比如说我声明一个 <code>Printer</code>接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.lambda;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Printer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">(String message)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后用一个<code>ConsolePrinter</code>类来实现这个接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.lambda;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsolePrinter</span> <span class="keyword">implements</span> <span class="title">Printer</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        System.out.println(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后在LambdasDemo类中将实例传入到参数为接口的greet()方法中，完成打印。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.lambda;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdasDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        greet(<span class="keyword">new</span> ConsolePrinter());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">greet</span><span class="params">(Printer printer)</span></span>&#123;</span><br><span class="line">        printer.print(<span class="string">"Hello World!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这与我们之前<a href="https://jasonxqh.github.io/2020/07/05/Java基础2/">Java基础2</a>中关于接口的操作思路一样，但是有时候我们并不想创建这样一个功能如此特殊的类来实现接口，因为用一次以后可能再也不会使用了。因此接下来我们要来介绍匿名内部类。</p>
<h3 id="Anonymous-Inner-Classes"><a href="#Anonymous-Inner-Classes" class="headerlink" title="Anonymous Inner Classes"></a>Anonymous Inner Classes</h3><p>匿名内部类就是没有名字的、方法内部的类，通常用来简化代码的编写。</p>
<p>匿名内部类的使用场景： 我们只使用一次接口并用来实现某些特殊的功能的时候</p>
<p>匿名类是不能有名称的类，所以没办法引用它们。必须在创建时，作为new语句的一部分来声明它们。</p>
<p>比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.lambda;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdasDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        greet(<span class="keyword">new</span> Printer() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">                System.out.println(message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">greet</span><span class="params">(Printer printer)</span></span>&#123;</span><br><span class="line">        printer.print(<span class="string">"Hello World!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>匿名内部类，虽然已经方便了许多。但是更好的方法是使用 <code>Lambda Expression</code></p>
<h3 id="Lambda-Expressions-1"><a href="#Lambda-Expressions-1" class="headerlink" title="Lambda Expressions"></a>Lambda Expressions</h3><p>Lambda 表达式的作用就像是一个匿名内部类，但是又不属于类。比如说我们重写刚才的匿名内部类代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">    greet(message-&gt;&#123;</span><br><span class="line">        System.out.println(message);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也就是说使用 Lambda expression 可以代替一个类。在这里我们甚至不需要写 <code>message</code>的数据类型，因为当我们使用Lambda表达式的时候Java会根据调用它的方法(这里是<code>greet()</code>)找到对应的接口及其数据类型。</p>
<p>当我们只传入1个参数的时候，参数不需要用括号包裹。但是当我们传入0个或者多个参数的时候，需要使用小括号包裹。</p>
<p>如果这个Lambda Expression花括号中只含有一句代码，那么花括号也可以被省略，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">greet(message -&gt; System.out.println(message))</span><br></pre></td></tr></table></figure>
<h3 id="Variable-Capture"><a href="#Variable-Capture" class="headerlink" title="Variable Capture"></a>Variable Capture</h3><p>如果我们使用一个匿名内部类，我们可以在类内新建一些变量，但是在 <code>Lambda Expression</code> 中，是不能新建变量的。但是可以使用当前方法中定义的变量，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public static void show()&#123;</span><br><span class="line">    String prefix &#x3D; &quot;-&quot;;</span><br><span class="line"></span><br><span class="line">    greet((message)-&gt;&#123;</span><br><span class="line">        System.out.println(prefix+message);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也可使用当前类中定义的静态变量：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdasDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String prefix = <span class="string">"-"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        greet((message)-&gt;&#123;</span><br><span class="line">            System.out.println(prefix+message);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">greet</span><span class="params">(Printer printer)</span></span>&#123;</span><br><span class="line">        printer.print(<span class="string">"Hello World!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 当然，如果要使用非静态变量的话，需要将 show()方法也定义成非静态的。</p>
<h3 id="Method-References"><a href="#Method-References" class="headerlink" title="Method References"></a>Method References</h3><p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/42.png"></p>
<p>方法引用一共有四种，目的是用来简化Lambda表达式的。一般引用格式是： 类名+静态方法名，要求是引用的静态方法跟 Lambda表达式是客观等价的(参数值、参数类型、返回值一致)</p>
<p>比如说刚才的例子中 ，<code>println</code>方法就和Lambda表达式是客观等价的，因此我们可以直接简化为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">       greet(System.out::println);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>当然，我们也可以在类中自定义一个静态函数然后实现函数引用：</p>
<p>在这里我们定义了静态函数 <code>LambdaDemo</code> 并在 greet中引用了它</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdasDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(String message)</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        greet(LambdasDemo::print);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">greet</span><span class="params">(Printer printer)</span></span>&#123;</span><br><span class="line">        printer.print(<span class="string">"Hello World!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上图，第四种方法就是引用一个构造函数。可以使用 <code>类+new</code> 的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdasDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LambdasDemo</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        greet(LambdasDemo::<span class="keyword">new</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">greet</span><span class="params">(Printer printer)</span></span>&#123;</span><br><span class="line">        printer.print(<span class="string">"Hello World!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Built-in-Functional-Interfaces"><a href="#Built-in-Functional-Interfaces" class="headerlink" title="Built-in Functional Interfaces"></a>Built-in Functional Interfaces</h3><p>文档：<a href="https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/function/package-summary.html" target="_blank" rel="noopener">https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/function/package-summary.html</a></p>
<p>Java提供了四种内建的函数式接口：Consumer、Supplier、 Function、Predicate</p>
<p>Consumer接口的意思是它值接收一个参数，且不返回任何东西。就好像把一个值给消费掉了。</p>
<p>Supplier接口的意思是它并不接收任何参数，但返回一个值，就好像它在提供一个值。</p>
<p>Function接口的意思是它会把一个值映射到另一个值上， <code>obj map(obj)</code></p>
<p>Predicate接口的意思是判断一个对象是否符合某个条件，<code>bool test(condition)</code></p>
<p>现在我们来一一介绍四种接口</p>
<h3 id="The-Consumer-Interface"><a href="#The-Consumer-Interface" class="headerlink" title="The Consumer Interface"></a>The Consumer Interface</h3><p>文档：<a href="https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/function/Consumer.html" target="_blank" rel="noopener">https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/function/Consumer.html</a></p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/43.png"></p>
<p>此外这个接口还有几个变形，比如 <code>BiConsumer</code>也就是接收两个参数但是不返回任何值</p>
<p>这里我们引用一个例子：</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/44.png"></p>
<p>List集合中的 <code>forEach()</code>方法就实现了一个 Consumer接口，因此我们要传入一个值：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list.forEach(System.out::println);</span><br></pre></td></tr></table></figure>
<p>这就是Declarative Programming, 也就是说这句命令做了些啥。</p>
<h3 id="Chaining-Consumer"><a href="#Chaining-Consumer" class="headerlink" title="Chaining Consumer"></a>Chaining Consumer</h3><p>现在我们来说说 链式的Consumer，在这里我们定义了两个lambda函数分别实现 Consumer接口：一个是打印原来的元素，另一个打印大写后的元素。</p>
<p>然后我们使用forEach方法的时候，先调用print，在print后调用内建的 addThen,又可以调用一个 Consumer对象.可以一直这样调用下去，比如：<code>list.forEach(print.andThen(printUpperCase).andThen(print));</code></p>
<p>调用顺序是：对于每一个元素，前调用print方法，然后调用printUpperCase方法，即先打印小写字母再打印大写祖母</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/45.png"></p>
<p>我们查看Consumer的源码就能看出原理：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">default</span> Consumer&lt;T&gt; <span class="title">andThen</span><span class="params">(Consumer&lt;? <span class="keyword">super</span> T&gt; after)</span> </span>&#123;</span><br><span class="line">    Objects.requireNonNull(after);</span><br><span class="line">    <span class="keyword">return</span> (T t) -&gt; &#123; accept(t); after.accept(t); &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们发现这个函数的返回值也是一个 Consumer的对象，当一个Consumer调用<code>andThen</code>，它先执行前面的对象，再调用after执行后面的对象，这样就会使我们的传入的两个Consumer对象按照顺序执行。</p>
<h3 id="The-Supplier-Interface"><a href="#The-Supplier-Interface" class="headerlink" title="The Supplier Interface"></a>The Supplier Interface</h3><p>文档：<a href="https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/function/Consumer.html" target="_blank" rel="noopener">https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/function/Consumer.html</a></p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/46.png"></p>
<p>这个接口只有一个方法，即<code>get</code> </p>
<p>这里我们创建了一个 <code>getRandom</code> 的 Lambda 表达式，用来随机生成一个数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdasDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Supplier&lt;Double&gt; getRandom = () -&gt; Math.random();</span><br><span class="line">        <span class="keyword">var</span> random = getRandom.get();</span><br><span class="line">        System.out.println(random);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这边要注意的是，如果我们不调用 <code>getRandom.get()</code>，这个Lambda 表达式是不会执行的。这叫做：Lazy evaluation. </p>
<p>和Consumer接口一样，Supplier接口也有多种变形： <code>DoubleSupplier</code>，<code>BooleanSupplier</code>,<code>IntSupplier</code>等，这些接口只能返回特定类型的数据。</p>
<h3 id="The-Function-Interface"><a href="#The-Function-Interface" class="headerlink" title="The Function Interface"></a>The Function Interface</h3><p>文档：<a href="https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/function/Function.html" target="_blank" rel="noopener">https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/function/Function.html</a></p>
<p>基本模板：<code>Interface Function&lt;T,R&gt;</code></p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/47.png"></p>
<p>这个接口需要设置两个数据类型 T和R.文档中这么解释: </p>
<p><code>T</code> - the type of the input to the function </p>
<p><code>R</code> - the type of the result of the function</p>
<p>当然还有 Function 接口的变形如 <code>BiFunction&lt;T,U,R&gt;</code>，也就是设置三个数据类型，两个接收的和一个返回的：</p>
<p><code>T</code> - the type of the first argument to the function</p>
<p><code>U</code> - the type of the second argument to the function</p>
<p><code>R</code> - the type of the result of the function</p>
<p>还有像 <code>IntFunction&lt;R&gt;</code>这种接口，因为它已经规定了<strong>接收值得数据类型</strong>为int，因此只要确定返回值类型 R即可；和<code>IntFunction&lt;R&gt;</code>相对的是 <code>ToIntFunction&lt;T&gt;</code>接口，它规定了<strong>返回值的数据类型</strong>为int，因此我们要确定其接收值得数据类型T</p>
<p>这里我们创建了 一个 Lambda函数map，其作用就是接收一个String类型的字符串并返回Integer类型的该字符串的长度。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdasDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Function&lt;String,Integer&gt; map = str-&gt;str.length();</span><br><span class="line">        <span class="keyword">var</span> length = map.apply(<span class="string">"Sky"</span>);</span><br><span class="line">        System.out.println(length);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Composing-Functions"><a href="#Composing-Functions" class="headerlink" title="Composing Functions"></a>Composing Functions</h3><p>因为 Function接口也有 <code>andThen()</code>方法,所以我们也可以链式使用 Function接口。</p>
<p>这里我们 同样定义了两个 lambda函数，第一个是将字符串中的’:’替换成’-‘。第二个是在字符串外面添加花括号。</p>
<p>我们有两种方式实现链式Function</p>
<p>我认为第一种更加直观：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdasDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Function&lt;String,String&gt; replaceColon = str -&gt; str.replace(<span class="string">":"</span>,<span class="string">"-"</span>);</span><br><span class="line">        Function&lt;String,String&gt; addBraces = str -&gt; <span class="string">"&#123;"</span>+str+<span class="string">"&#125;"</span> ;</span><br><span class="line">        <span class="keyword">var</span> result = replaceColon</span><br><span class="line">                .andThen(addBraces)</span><br><span class="line">                .apply(<span class="string">"key:value"</span>);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二种：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result = addBraces.compose(replaceColon).apply(<span class="string">"Key:Value"</span>);</span><br></pre></td></tr></table></figure>
<p>打印后得到： {key-value}</p>
<h3 id="The-Predicate-Interface"><a href="#The-Predicate-Interface" class="headerlink" title="The Predicate Interface"></a>The Predicate Interface</h3><p><a href="https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/function/Predicate.html" target="_blank" rel="noopener">https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/function/Predicate.html</a></p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/48.png"></p>
<p>我们使用这个接口来筛选数据。最重要的就是这个 <code>test()</code>方法，它会判断t是否符合某些条件。</p>
<p>此外还有 <code>BiPredicate&lt;T,U&gt;</code>，用来检测传入的两个参数是否符合某些条件；<code>IntPredicate</code> 它只接受Integer类型的数据并返回一个布尔值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdasDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Predicate&lt;String&gt; isLongerThan5 = str -&gt; str.length() &gt;<span class="number">5</span>;</span><br><span class="line">        <span class="keyword">var</span> result = isLongerThan5.test(<span class="string">"sky"</span>);</span><br><span class="line">        System.out.println(result);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里我们设计了一个Lambda函数用来判断输入的String类型的字符串的长度是否大于5. </p>
<p>打印得到 false</p>
<h3 id="Combining-Predicates"><a href="#Combining-Predicates" class="headerlink" title="Combining Predicates"></a>Combining Predicates</h3><p>将 Predicates结合起来又有些不太一样，因为这些都是条件。因此我们可以将两个条件通过 <code>and()</code>,<code>or()</code> 变成一个新的 Predicate，比如说：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdasDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Predicate&lt;String&gt; hasLeftBrace = str-&gt;str.startsWith(<span class="string">"&#123;"</span>);</span><br><span class="line">        Predicate&lt;String&gt; hasRightBrace = str-&gt;str.endsWith(<span class="string">"&#125;"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> hasBothBrace =hasLeftBrace.and(hasRightBrace);</span><br><span class="line">        <span class="keyword">var</span> eitherOneBrace = hasLeftBrace.or(hasRightBrace);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还有一个方法，叫做 <code>negate()</code>，也就是将条件取反变成新的条件，如 <code>hasLeftBrace.negate()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(hasBothBrace.test(<span class="string">"&#123;sss"</span>));		<span class="comment">// false</span></span><br><span class="line">System.out.println(eitherOneBrace.test(<span class="string">"&#123;sss"</span>));	<span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h3 id="The-BinaryOperator-Interface"><a href="#The-BinaryOperator-Interface" class="headerlink" title="The BinaryOperator Interface"></a>The BinaryOperator Interface</h3><p>现在我们来介绍一种特殊的函数式接口： <code>BinaryOperator&lt;T&gt;</code></p>
<p><a href="https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/function/BinaryOperator.html" target="_blank" rel="noopener">https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/function/BinaryOperator.html</a></p>
<p>这个接口是一个特殊的 BiFunction()接口，即接受两个参数，并返回一个值，这三个值得类型都必须相同。</p>
<p>比如说这里我们定义一个 BinaryOperator的函数为add，作用是将两个Integer类型的整数相加。我们还可以利用 <code>andThen()</code>将BinaryOperator和Function两个类型的函数复合起来，求两数之和的平方数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdasDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// a,b -&gt; a+b -&gt; square</span></span><br><span class="line">        BinaryOperator&lt;Integer&gt; add = (a,b)-&gt;a+b;</span><br><span class="line">        Function&lt;Integer,Integer&gt; square = a-&gt;a*a;</span><br><span class="line">        <span class="keyword">var</span> result = add.andThen(square).apply(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">        System.out.println(result);</span><br><span class="line">      <span class="comment">//结果为9</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="The-UnaryOperator-Interface"><a href="#The-UnaryOperator-Interface" class="headerlink" title="The UnaryOperator Interface"></a>The UnaryOperator Interface</h3><p><a href="https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/function/UnaryOperator.html" target="_blank" rel="noopener">https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/function/UnaryOperator.html</a></p>
<p><code>UnaryOperator&lt;T&gt;</code>接口是一种特殊的 Function()接口，即接受一个参数并返回一个值，但它们的类型必须相同</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdasDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        UnaryOperator&lt;Integer&gt; square = n-&gt;n*n;</span><br><span class="line">        UnaryOperator&lt;Integer&gt; increment = n-&gt;n+<span class="number">1</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> result = increment.andThen(square).apply(<span class="number">1</span>);</span><br><span class="line">        System.out.println(result);<span class="comment">//打印的4</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里我们新建了两个 <code>UnaryOperator</code> 对象，一个用来+1，一个用来求平方，使用<code>andThen()</code>将它们复合</p>
<h2 id="Streams"><a href="#Streams" class="headerlink" title="Streams"></a>Streams</h2><p>Java8 引入了 Stream，这可以让你以一种声明的方式处理数据。也就是说，Stream使用了一种类似用SQL 语句从数据库查询数据的直观方式来提供一种对Java集合(collection)运算的表达的高阶抽象。这可以让我们写出高效率的、干净、简洁的代码。</p>
<p>比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; transactionsIds = </span><br><span class="line">widgets.stream()</span><br><span class="line">             .filter(b -&gt; b.getColor() == RED)</span><br><span class="line">             .sorted((x,y) -&gt; x.getWeight() - y.getWeight())</span><br><span class="line">             .mapToInt(Widget::getWeight)</span><br><span class="line">             .sum();</span><br></pre></td></tr></table></figure>
<h3 id="Imperative-vs-Functional-Programming"><a href="#Imperative-vs-Functional-Programming" class="headerlink" title="Imperative vs Functional Programming"></a>Imperative vs Functional Programming</h3><p>首先我们来看命令式编程和函数式编程之间的区别。</p>
<p>下面给出 Imperative Code的例子：我们看到命令式编程完全就是一步一步执行下去的，仿佛就是我们在对计算机下命令。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;Movie&gt; movies = List.of(</span><br><span class="line">            <span class="keyword">new</span> Movie(<span class="string">"a"</span>,<span class="number">10</span>),</span><br><span class="line">            <span class="keyword">new</span> Movie(<span class="string">"b"</span>,<span class="number">15</span>),</span><br><span class="line">            <span class="keyword">new</span> Movie(<span class="string">"c"</span>,<span class="number">20</span>)</span><br><span class="line">    ); </span><br><span class="line">    <span class="comment">// Imperative Programming</span></span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> movie : movies)</span><br><span class="line">        <span class="keyword">if</span>(movie.getLikes()&gt;<span class="number">10</span>)</span><br><span class="line">            count++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在我们用函数式编程来重写上面这段命令式编程的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> count2 = movies.stream()</span><br><span class="line">        .filter(movie -&gt; movie.getLikes()&gt;<span class="number">10</span>)</span><br><span class="line">        .count();</span><br></pre></td></tr></table></figure>
<p>命令式编程更像是我们告诉电脑应该怎么做:循环，判断；而stream则是直接show出来它做了什么：filter+count</p>
<p>它就好比是对Collection中的元素流通过管道，并在管道中进行筛选、分流、聚合等操作，最终得到我们想要的结果。</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/29.png"></p>
<h3 id="Creating-a-Stream"><a href="#Creating-a-Stream" class="headerlink" title="Creating a Stream"></a>Creating a Stream</h3><p>我们可以从这几处来创建流：</p>
<ul>
<li>From collections</li>
<li>From arrays</li>
<li>From an arbitrary number of objects</li>
<li>Infinite/ finite streams</li>
</ul>
<p>Stream 提供了新的方法 ‘forEach’ 来迭代流中的每个数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="comment">//从数组中创建流</span></span><br><span class="line">    <span class="keyword">int</span> [] numbers = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line">    Arrays.stream(numbers)</span><br><span class="line">            .forEach(n -&gt; System.out.println(n));</span><br><span class="line">	<span class="comment">//从随机数中创建流</span></span><br><span class="line">    <span class="keyword">var</span> stream = Stream.generate(()-&gt;Math.random());</span><br><span class="line">    stream</span><br><span class="line">            .limit(<span class="number">3</span>)<span class="comment">//这里如果不做限制，会有无限多个随机数产生</span></span><br><span class="line">            .forEach(n -&gt; System.out.println(n));</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Mapping-Elements"><a href="#Mapping-Elements" class="headerlink" title="Mapping Elements"></a>Mapping Elements</h3><p>map 方法用于映射每个元素到对应的结果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;Movie&gt; movies = List.of(</span><br><span class="line">            <span class="keyword">new</span> Movie(<span class="string">"a"</span>,<span class="number">10</span>),</span><br><span class="line">            <span class="keyword">new</span> Movie(<span class="string">"b"</span>,<span class="number">15</span>),</span><br><span class="line">            <span class="keyword">new</span> Movie(<span class="string">"c"</span>,<span class="number">20</span>)</span><br><span class="line">    );</span><br><span class="line">  <span class="comment">//最基础的就是map方法，他获取movies中的每个元素并取得他们的标题，然后输出</span></span><br><span class="line">   movies.stream()</span><br><span class="line">           .map(movie -&gt; movie.getTitle())</span><br><span class="line">           .forEach(name-&gt; System.out.println(name));</span><br><span class="line">  <span class="comment">//mapToInt则是将得到的数据全部转换为 int 类型的数据,同样还有mapToDouble</span></span><br><span class="line">   movies.stream()</span><br><span class="line">           .mapToInt(movie -&gt; movie.getLikes())</span><br><span class="line">           .forEach(likes -&gt; System.out.println(likes));</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此外还有<code>flatmap()</code>方法，The <code>flatMap()</code> operation has the effect of applying a one-to-many transformation to the elements of the stream, and then flattening the resulting elements into a new stream.</p>
<p>首先我们用 <code>of()</code>创建一个含有两个 List 集合的流，然后让其打印元素。</p>
<p>然后我们让其调用<code>flatMap</code>,让 传入的List集合扁平化。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stream = Stream.of(List.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>),List.of(<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>));</span><br><span class="line">stream.forEach(list -&gt; System.out.println(list));</span><br><span class="line"><span class="comment">/* 打印得</span></span><br><span class="line"><span class="comment">[1, 2, 3]</span></span><br><span class="line"><span class="comment">[4, 5, 6]</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">stream</span><br><span class="line">       	  .flatMap(list -&gt; list.stream())</span><br><span class="line">    	    .forEach(n -&gt; System.out.println(n));</span><br><span class="line"><span class="comment">/* 打印得</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">6</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//注意，如果我们调用的是map(),那么打印出来的是这个流对象，而不是流中的元素：</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">java.util.stream.ReferencePipeline$Head@3a71f4dd</span></span><br><span class="line"><span class="comment">java.util.stream.ReferencePipeline$Head@7adf9f5f</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="Filtering-Elements"><a href="#Filtering-Elements" class="headerlink" title="Filtering Elements"></a>Filtering Elements</h3><p>filter 方法用于通过设置的条件过滤出元素, 这里我们要分清 stream的两种类型的操作：Intermediate Operation 以及 Terminal Operation</p>
<p>Intermediate Operation 就是 <code>map()、filter()</code> 之类的操作，它们会继续返回一个stream供我们后续操作</p>
<p>Terminal Operation 的例子就是 <code>forEach()</code>，它会直接在终端输出结果</p>
<p>如果只使用 Intermidiate Operation那么终端中什么都不会输出。为了使filter更加利于理解，我们可以将筛选条件单独定义成一个变量，如下面这个例子：</p>
<p>注：<code>Predicate &lt;T&gt;</code> 接口是一个函数式接口，它接受一个输入参数，然后返回一个布尔值结果。该接口用于测试对象是 true 或 false。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">var</span> movies = List.of(</span><br><span class="line">                <span class="keyword">new</span> Movie(<span class="string">"a"</span>,<span class="number">10</span>),</span><br><span class="line">                <span class="keyword">new</span> Movie(<span class="string">"b"</span>,<span class="number">15</span>),</span><br><span class="line">                <span class="keyword">new</span> Movie(<span class="string">"c"</span>,<span class="number">20</span>)</span><br><span class="line">        );</span><br><span class="line"> <span class="comment">// m 是一个参数传递到Predicate 接口的 test 方法</span></span><br><span class="line"> <span class="comment">// 如果 m.getLikes()&gt;10,那么就会返回 true</span></span><br><span class="line">        Predicate&lt;Movie&gt; isPopular = m -&gt; m.getLikes() &gt; <span class="number">10</span>;</span><br><span class="line">        movies.stream()</span><br><span class="line">                .filter(isPopular)</span><br><span class="line">                .forEach(movie -&gt; System.out.println(movie.getTitle()));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="Slicing-Streams"><a href="#Slicing-Streams" class="headerlink" title="Slicing Streams"></a>Slicing Streams</h3><p> slicing stream是一个大类别，包含了 <code>limit(n)</code>、<code>skip(n)</code>、<code>takeWhile(predicate)</code>、<code>dropWhile(predicate)</code> 这些方法</p>
<h4 id="limit-n"><a href="#limit-n" class="headerlink" title="limit(n)"></a>limit(n)</h4><p>顾名思义，就是只限制 n 条数据，如下：</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/49.png"></p>
<h4 id="skip-n"><a href="#skip-n" class="headerlink" title="skip(n)"></a>skip(n)</h4><p>顾名思义，就是跳过前n条数据。</p>
<p>假设现在有1000条电影数据，每10条一页，我想看第三页的数据，应该怎么编写代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">movies.stream()</span><br><span class="line">			.skip(<span class="number">20</span>)</span><br><span class="line">			.limit(<span class="number">10</span>)</span><br><span class="line">			.forEach(m -&gt; System.out.println(m.getTitle()));</span><br></pre></td></tr></table></figure>
<h4 id="takeWhile-predicate"><a href="#takeWhile-predicate" class="headerlink" title="takeWhile(predicate)"></a>takeWhile(predicate)</h4><p>这个方法传入一个实现了 predicate接口的 lambda表达式，用来筛选满足条件的数据。但是注意了，这个和filter是不一样的。filter是筛选所有满足条件的数据，而takeWhile()方法则是一碰到不符合条件的数据就立即停止。</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/50.png"></p>
<p>上面的例子中，虽然第三条数据的 likes&lt;15,但是 takeWhile()在遇到第二条数据的时候就已经停止了筛选。</p>
<h4 id="dropWhile-predicate"><a href="#dropWhile-predicate" class="headerlink" title="dropWhile(predicate)"></a>dropWhile(predicate)</h4><p>dropWhile则和takeWhile恰好相反。就是去除掉那些符合条件的数据，直到遇到第一条不满足条件的数据为止。比如说刚才一模一样的代码，将takeWhile改成dropWhile，就会打印 b和c，因为会把a去除掉，而遇到b的时候就停止筛选了</p>
<h3 id="Sorting-Streams"><a href="#Sorting-Streams" class="headerlink" title="Sorting Streams"></a>Sorting Streams</h3><p>我们之前介绍了 <code>Comparable</code>和<code>Comparator</code>接口，是用来对对象进行排序的方法。</p>
<p>现在在stream中我们可以简化写法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">movies.stream()</span><br><span class="line">        .sorted((a,b)-&gt;a.getTitle().compareTo(b.getTitle()))<span class="comment">//原来我们这么写</span></span><br><span class="line">        .sorted(Comparator.comparing(Movie::getTitle))<span class="comment">//现在我们可以这么写</span></span><br><span class="line">        .forEach(System.out::println);</span><br></pre></td></tr></table></figure>
<p>如果我们要倒序排列，那么：<code>.sorted(Comparator.comparing(Movie::getTitle).reversed())</code>即可</p>
<h3 id="Getting-Unique-Elements"><a href="#Getting-Unique-Elements" class="headerlink" title="Getting Unique Elements"></a>Getting Unique Elements</h3><p>我们可以通过 stream中的 <code>distinct()</code>方法来获得集合中非重复的数据，比如说：</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/52.png"></p>
<h3 id="Peeking-Elements"><a href="#Peeking-Elements" class="headerlink" title="Peeking Elements"></a>Peeking Elements</h3><p>peek和map 有点相似，但是peek接收的是一个 Consumer，而map接受的是一个Function。</p>
<p>Consumer是没有返回值的，它只是对Stream中的元素进行某些操作，但是操作之后的数据并不返回到Stream中，所以Stream中的元素还是原来的元素。</p>
<p>而Function是有返回值的，这意味着对于Stream的元素的所有操作都会作为新的结果返回到Stream中。</p>
<p>我们常常用 <code>peek()</code>来debug我们的程序，因为它不会对Stream的元素作任何操作，又不是一个Terminal的操作会把Stream终止。</p>
<p>通过下面这个例子，我们能更深刻的理解 peek和map之间的差别了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamsDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">var</span> movies = List.of(</span><br><span class="line">                <span class="keyword">new</span> Movie(<span class="string">"a"</span>,<span class="number">10</span>),</span><br><span class="line">                <span class="keyword">new</span> Movie(<span class="string">"b"</span>,<span class="number">15</span>),</span><br><span class="line">                <span class="keyword">new</span> Movie(<span class="string">"c"</span>,<span class="number">20</span>)</span><br><span class="line">        );</span><br><span class="line">        movies.stream()</span><br><span class="line">                .filter(m-&gt;m.getLikes()&gt;<span class="number">10</span>)</span><br><span class="line">                .peek(m -&gt; System.out.println(<span class="string">"filtered: "</span>+m.getTitle()))</span><br><span class="line">                .map(m-&gt;m.getTitle())</span><br><span class="line">                .peek(t -&gt; System.out.println(<span class="string">"mapped: "</span>+t))</span><br><span class="line">                .forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一开始我们筛选出了集合中点赞数大于10的数据，这里是两个Movie对象b和c</p>
<p>然后我们通过peek对其进行了一个输出</p>
<p>之后我们通过map将对象映射成他们的名字了，因此现在stream中只有两个字符串 b和c</p>
<p>然后我们再通过peek对其进行输出，这时候我们直接打印t和上面那样调用 <code>getTitle()</code>的效果是一样的，因为map已经对流进行了映射。</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/53.png"></p>
<h3 id="Simple-Reducers"><a href="#Simple-Reducers" class="headerlink" title="Simple Reducers"></a>Simple Reducers</h3><p>刚才我们讲的一系列操作，目的是创建客制化的管道。接下来我们来讲Reducer，其目的就是将流中的元素直接变成一个对象。比如说<code>count()</code>，它直接返回集合中的元素数量；</p>
<p><code>anyMatch(predicate)</code>, 返回布尔值，只要含有符合条件的就返回true；</p>
<p><code>allMatch(predicate)</code>以及 <code>noneMatch(predicate)</code>，逻辑和 <code>anyMatch相同</code></p>
<p><code>findFirst()</code> 返回 <code>Optional</code> 类，本质上，这是一个包含有可选值的包装类，这意味着 Optional 类既可以含有对象也可以为空。我们可以通过<code>get()</code>获取Optional中的对象本体。findFirst也就是返回集合中的第一个对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> movies = List.of(</span><br><span class="line">            <span class="keyword">new</span> Movie(<span class="string">"a"</span>,<span class="number">10</span>),</span><br><span class="line">            <span class="keyword">new</span> Movie(<span class="string">"b"</span>,<span class="number">15</span>),</span><br><span class="line">            <span class="keyword">new</span> Movie(<span class="string">"c"</span>,<span class="number">20</span>)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> result= movies.stream()</span><br><span class="line">                                .findFirst()</span><br><span class="line">                                .get();</span><br><span class="line">    System.out.println(result.getTitle());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>findAny()</code>和    <code>findFirst()</code>逻辑相同，只不过是返回任意一个集合中的对象。</p>
<p><code>max(comparator)</code> 这个方法需要接受一个 comparator 对象作为比较的依据. 用来返回拥有 最大参数的对象</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/54.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result= movies.stream()</span><br><span class="line">                  .max(Comparator.comparing(Movie::getLikes))</span><br><span class="line">                  .get();</span><br><span class="line">System.out.println(result.getTitle());</span><br></pre></td></tr></table></figure>
<p><code>min(comparator)</code>和max()的逻辑相同。</p>
<h3 id="Reducing-a-Stream"><a href="#Reducing-a-Stream" class="headerlink" title="Reducing a Stream"></a>Reducing a Stream</h3><h3 id="Collectors"><a href="#Collectors" class="headerlink" title="Collectors"></a>Collectors</h3><h3 id="Grouping-Elements"><a href="#Grouping-Elements" class="headerlink" title="Grouping Elements"></a>Grouping Elements</h3><h3 id="Partitioning-Elements"><a href="#Partitioning-Elements" class="headerlink" title="Partitioning Elements"></a>Partitioning Elements</h3><h3 id="Primitive-Type-Streams"><a href="#Primitive-Type-Streams" class="headerlink" title="Primitive Type Streams"></a>Primitive Type Streams</h3><h2 id="Concurrency-and-Multi-threading"><a href="#Concurrency-and-Multi-threading" class="headerlink" title="Concurrency and Multi-threading"></a>Concurrency and Multi-threading</h2><h3 id="Processes-and-Threads"><a href="#Processes-and-Threads" class="headerlink" title="Processes and Threads"></a>Processes and Threads</h3><p>我们在CSAPP中已经了解了进程和线程的关系。在一个进程中，一定有一个主线程，还可以有其他支线程。比如说我们在迅雷中一次下载了三个文件，那么这三个文件就可以占据三个线程。</p>
<p>现在我们来看一下关于这台电脑中关于线程的信息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(Thread.activeCount());</span><br><span class="line">        System.out.println(Runtime.getRuntime().availableProcessors());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第一句是打印当前这个项目使用的进程数，下面一句打印当前电脑总的可用线程数。</p>
<p>因为 m1 是四大核四小盒，这里打印出来的是一共8个进程 。当我在 i7-9750(六核) 上运行时，打印得到12个线程。</p>
<h3 id="Starting-a-Thread"><a href="#Starting-a-Thread" class="headerlink" title="Starting a Thread"></a>Starting a Thread</h3><p>现在我们来讲怎么创建一个线程。要创建一个线程，我们首先要让一个类引入 Runnable 接口,并在其中重写 run函数。Runnable接口是Java.lang 中一个内置的接口。引入这个接口就代表着这个任务将被在一条线程中执行。这个接口中只有一个函数： <code>run()</code> , 当启动线程开始运作之后，会自动调用  <code>run()</code>函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.concurrency;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadFileTask</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Downloading a file: "</span>+Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，在 <code>ThreadDemo</code> 类中，将一个 <code>DownloadFileTask()</code> 实例传入，并调用 <code>start()</code>函数启动线程。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">            Thread thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> DownloadFileTask());</span><br><span class="line">            thread.start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/1.png" style="zoom:120%;"></p>
<p>打印结果如上图所示：首先打印的是当前所在的线程，也就是 main，然后我们进行了一个循环，调用了十个新的线程，并依次打印出他们的名字。</p>
<h3 id="Pausing-a-Thread"><a href="#Pausing-a-Thread" class="headerlink" title="Pausing a Thread"></a>Pausing a Thread</h3><p>现在我们尝试将一个线程“挂起”一段时间以模仿下载的过程。</p>
<p>要让线程挂起，我们可以使用 <code>sleep()</code> 方法，这里我选择让线程挂起5秒钟(注意，5000是以毫秒为单位，但并不是非常精确的5000毫秒，这和底层操作系统有关系) </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadFileTask</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Downloading a file: "</span>+Thread.currentThread().getName());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"Download complete: "</span>+ Thread.currentThread());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果我直接写 <code>Tread.sleep(5000)</code>，那么 idea会报错，我们需要用 try/catch 将其包裹起来。打印结果如下： </p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/2.png" style="zoom:120%;"></p>
<p>如果我们只有一个线程来下载这10个文件，那么就需要用50秒的时间，但是现在我们有10个线程，所以只需要5秒就能完成任务。</p>
<p>如果我们现在要下载成百上千的文件，但是我们电脑没有那么多线程。这时候，就要用到 JVM 中的 <code>Thread Scheduler</code>,这是用来决定 java中每条线程执行的时间。所以当任务量大于线程数的时候，JVM 会执行分时操作。也就是每一个线程都能分到一点时间，让我们用户看起来像是在并行下载。</p>
<h3 id="Joining-a-Thread"><a href="#Joining-a-Thread" class="headerlink" title="Joining a Thread"></a>Joining a Thread</h3><p><code>join()</code>方法是<code>Thread</code>类中的一个方法，该方法的定义是等待该线程终止。其实就是<code>join()</code>方法将挂起<strong>调用线程</strong>的执行，直到<strong>被调用的对象</strong>完成它的执行。</p>
<p>比如说，一开始我不使用 <code>join()</code>，这样，主线程就运行主进程自己的代码，只是开辟了一条线程运行其他的代码。因此我们看到打印出来的先是主线程的运行结果</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/3.png" style="zoom:120%;"></p>
<p>但是使用了 <code>join()</code>方法之后，主线程就会等待子线程结束后再运行。比如说：</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/4.png" style="zoom:120%;"></p>
<h3 id="Interrupting-a-Thread"><a href="#Interrupting-a-Thread" class="headerlink" title="Interrupting a Thread"></a>Interrupting a Thread</h3><p>有时候我们必须要去终止一个运行中的线程，这时候就需要用到 <code>thread.interrupt()</code> 这个函数了。通常终止一个线程的逻辑是： 调用者发出一个interrupt信号，被调用的线程将对收到的信号做一个判断，如果是interrupt信号，就终止运行中的线程。否则就“充耳不闻”。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadFileTask</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Downloading a file: "</span>+Thread.currentThread().getName());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>;i&lt; Integer.MAX_VALUE;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(Thread.currentThread().isInterrupted()) <span class="keyword">return</span>;</span><br><span class="line">            System.out.println(<span class="string">"Downloading byte"</span>+ i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这边我进行一个无限循环，然后判断主线程是否给我发送了一个 Interrupt信号，如果是就return掉，否则就继续打印。</p>
<p>注意了，如果线程正在挂起时向其发送 <code>interrupted</code> 信号，这样是会报错的。因此我们在用 <code>thread.sleep()</code> 的时候，需要用 <code>try-catch</code> 来包裹。</p>
<h3 id="Concurrency-Issues"><a href="#Concurrency-Issues" class="headerlink" title="Concurrency Issues"></a>Concurrency Issues</h3><p>在编写并行程序的时候会遇到一些问题：</p>
<ol>
<li>当很多不同的线程共用一个对象的时候，对对象的某些参数进行修改会导致“堵车”。这就好比三个人像同时吃掉一个汉堡。我们将这种情况叫做 “Race Condition”, </li>
<li>另一种情况就是，当一个线程对一个对象进行了修改，但是修改后的内容仅它自己可见，那么不同线程就会看到一个对象不同的状态。我们将这种情况叫做 ”Visibility Problem”</li>
</ol>
<p>我们必须要写出 <code>Thread-safe Code</code> 来规避这些问题。在很多Java的文档中，对一个类的描述是 <code>Thread Safe</code> 也就是这个类可以再很多并行的线程中使用。</p>
<h3 id="Race-Conditions"><a href="#Race-Conditions" class="headerlink" title="Race Conditions"></a>Race Conditions</h3><p>当很多线程都想修改一个对象的时候，就出现了竞争关系。</p>
<p>比如说我有以下代码：</p>
<p><code>ThreadDemo类</code></p>
<p>在这个调用的类当中，我们创建一个线程数组，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.concurrency;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="keyword">var</span> status = <span class="keyword">new</span> DownloadStatus();</span><br><span class="line">       List&lt;Thread&gt; threads = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">           <span class="keyword">var</span> thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> DownloadFileTask(status));</span><br><span class="line">           thread.start();</span><br><span class="line">           threads.add(thread);</span><br><span class="line">       &#125;</span><br><span class="line">      <span class="comment">//将所有的线程都打开后，我们还需要等待所有的线程都停止。这里使用一个循环来解决。</span></span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">var</span> thread : threads)&#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               thread.join();</span><br><span class="line">           &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">               e.printStackTrace();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">        System.out.println(status.getTotalBytes());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>DownloadFileTask</code>类</p>
<p>在这个Run函数当中，我们做一个10000次的循环，每一次循环都调用status对象的 <code>incrementTotalBytes()</code>函数。用来模拟下载一个 10000 bits的文件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.concurrency;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadFileTask</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> DownloadStatus status;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DownloadFileTask</span><span class="params">(DownloadStatus status)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>;i&lt; <span class="number">10_000</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(Thread.currentThread().isInterrupted()) <span class="keyword">return</span>;</span><br><span class="line">            status.incrementTotalBytes();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>DownloadStatus</code>类</p>
<p>在这个类中，有一个下载总比特数的私有变量，当有线程中的对象调用<code>incrementTotalBytes()</code>的时候，totalBytes就会自增1</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.company.concurrency;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadStatus</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> totalBytes;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalBytes</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> totalBytes;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">incrementTotalBytes</span><span class="params">()</span></span>&#123;</span><br><span class="line">        totalBytes++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在预期的情况下，我们打开了10 个线程，每个线程都会下载10_000比特的数据，那么<code>totalBytes</code>的结果应该是100_000, 但是我们多次运行之后，一直都是八九万，并没有到十万。这是因为发生了<code>Race condition</code>，线程在互相争抢修改同一个数据的时候，会发生数据丢失。</p>
<p>当我们调用 <code>incrementTotalBytes()</code> 的时候，电脑会从内存中找到totalBytes的值，然后存储至cpu，然后cpu对值进行加1操作；操作结束后，这个值会被重新存储至内存中。</p>
<p>那么现在假设两个线程同时读取了 <code>totalBytes</code>然后对其进行加1操作，这时候，CPU也只是会将<code>totalBytes</code>加上1而已，并不会加上2。这就是导致了刚才的数据丢失。</p>
<h3 id="Strategies-for-Thread-Safety"><a href="#Strategies-for-Thread-Safety" class="headerlink" title="Strategies for Thread Safety"></a>Strategies for Thread Safety</h3><p>我们有一些写出 <code>Thread Safe Code</code> 的策略：</p>
<ul>
<li>Confinement</li>
</ul>
<p>这个概念很简单，就是原本是多个线程操作一个对象，现在变成了每个线程都操作属于它自己的对象，最后将对象中的值加起来就得到最后的总值。</p>
<ul>
<li>Immutability</li>
</ul>
<p>这个操作更加直白，就是我们将要操作的对象变成不可改变的。比如说 String 对象就是 Immutable 的，因为当我们对一个 String 对象进行修改的时候会创建一个新的String，之前的String并不会遭改变</p>
<ul>
<li>Synchronization</li>
</ul>
<p>同步操作，这使得同一个对象在不同的线程之间可以协调、同步。我们可以利用<strong>lock</strong>以及<strong>Synchronize</strong>关键词来实现这个操作.</p>
<p>我们使用锁将”有争议的部分”锁起来，一次只能让一个线程来访问，这样就能做到隔离的效果。然而，这样很容易造成死锁，因此不推荐使用</p>
<ul>
<li>Atomic Object </li>
</ul>
<p>原子对象。之前 若要对<code>totalBytes</code> 进行修改需要进行3个步骤，但是当我们使用原子对象的时候，只需要一个步骤即可，这就防止两个线程同时操作一个对象的情况出现了。</p>
<ul>
<li>Partitioning  </li>
</ul>
<p>中文叫分区</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/20.png" style="zoom:120%;"></p>
<h3 id="Confinement"><a href="#Confinement" class="headerlink" title="Confinement"></a>Confinement</h3><p>现在我们重构刚才那段代码。之前发生Race condition的时候，我们只创建了一个 <code>DownloadStatus</code> 对象，十个线程都对一个 <code>totalBytes</code> 变量进行操作，因此它们开始争夺。</p>
<p>我们现在要做的就是“隔离”，简单来说就是给每一个thread都新建一个DownloadStatus，线程的操作只对它自己的DownloadStatus中的TotalBytes进行操作，最后将这十个 TotalBytes变量累加得到最后答案。</p>
<p>因为我们要对每一个线程新建一个下载任务，因此我们还要一个 列表来保存这些Tasks。并且我们不再需要向<code>DownloadFileTask</code> 构造器传入status参数了，因为我们要对每一个Task新建一个DownloadStatus对象 ,但是我们要在 <code>DownloadFileTask</code>类中为status做一个getter，方便外界获取当前的下载状态。</p>
<p> <img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/30.png" style="zoom:100%;"></p>
<p>现在我们重构 ThreadDemo 类，因为我们要为每一个线程单独设一个DownloadFileTask，因此为了方便将其中的TotalBytes相加，我们要新建一个List对其进行管理。并在创建的时候将每一个Task加入到数组当中去。最后我们用 Stream 将tasks数组中的所有任务中的totalbytes相加，得到最终结果。</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/31.png" style="zoom:100%;"></p>
<p>打印得： Optional[100000]，即10个线程的下载总和，一个Byte都没丢掉</p>
<h3 id="Locks"><a href="#Locks" class="headerlink" title="Locks"></a>Locks</h3><p>上面我们说了隔离，这里我们再提供一种方案。就是设计一个锁，使得同一个对象在同一时间只能被访问修改一次。当一个线程想要正在修改对象的时候，就把这个对象锁起来，别的线程都无法访问。</p>
<p>根据上面的信息，我们现在要在 <code>DownloadStatus</code>上加一个锁。首先我们声明一个lock：</p>
<p><code>private Lock lock = new ReentrantLock()</code> 也就是一个可重入锁对象。<em>reentrant</em> 锁意味着什么呢？简单来说，它有一个与锁相关的获取计数器，如果拥有锁的某个线程再次得到锁，那么获取计数器就加1，然后锁需要被释放两次才能获得真正释放</p>
<p>然后我们在调用 <code>incrementTotalBytes</code> 的时候先上一个锁，等自增1结束后再解锁。这就好比一个人进了酒店房间办事，然后把门给锁了，办完事后再把门打开。</p>
<p>但是为了程序的正常运行，我们需要用 <code>try-finally block</code> ，因为如果在 <code>totalBytes++</code>的时候抛出了一个异常（我们当然知道自增1不会抛出异常，但是在未来我们自己的程序中这可能是一段很复杂的代码，因此必须要try），那么这个锁就永远无法打开了，会导致死锁。因此我们要保证 <code>lock.unlock()</code> 在任何情况下都能执行。 </p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/32.png" style="zoom:100%;"></p>
<p>打印结果：100000</p>
<h3 id="The-synchronized-Keyword"><a href="#The-synchronized-Keyword" class="headerlink" title="The synchronized Keyword"></a>The synchronized Keyword</h3><p>要让线程之间同步，我们还可以使用 synchronized 关键词。这样我们就不用很麻烦的先锁住、然后再解锁了。</p>
<p>但是Java程序依靠<code>synchronized</code>对线程进行同步，使用<code>synchronized</code>的时候，锁住的是哪个对象非常重要。</p>
<p>让线程自己选择锁对象往往会使得代码逻辑混乱，也不利于封装。更好的方法是把<code>synchronized</code>逻辑封装起来。 </p>
<p>比如我们现在就要用synchronized来封装<code>totalBytes++</code> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">incrementTotalBytes</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>)&#123;</span><br><span class="line">        totalBytes++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样一来，线程调用<code>incrementTotalBytes</code>方法时，它不必关心同步逻辑，因为<code>synchronized</code>代码块在<code>incrementTotalBytes</code>方法内部。并且，我们注意到，<code>synchronized</code>锁住的对象是<code>this</code>，即当前实例，这又使得创建多个<code>DownloadStatus</code>实例的时候，它们之间互不影响，可以并发执行。</p>
<p>当我们锁住的是 <code>this</code>实例的时候，实际上可以用 <code>synchronized</code>来修饰这个方法，因此这两种方法是等价的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">incrementTotalBytes</span><span class="params">()</span></span>&#123;</span><br><span class="line">       totalBytes++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因此，用<code>synchronized</code>修饰的方法就是同步方法，它表示整个方法都必须用<code>this</code>实例加锁。不能对其他实例加锁。</p>
<p>但是，对 <code>this</code> 实例加锁也是有缺点的。比如说：我又新建了一个totalFiles变量来记录已下载完成的文件总数。因为文件一多，很可能是两个文件同时下载完成的，因此我们也需要用 <code>synchronized</code>关键字来修饰</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/33.png" style="zoom:100%;"></p>
<p>那么问题来了：<code>incrementTotalByts</code>和<code>incrementTotalFiles</code>这两个方法都给 <code>this</code>对象上了锁。那么如果存在某一个时刻，要同时调用这两个方法的时候，必须等其中一个方法运行完之后把this对象解锁了之后才可以继续执行另一个方法。如果这只是一个小型应用，也许没事；但是如果这个应用非常庞大，需要上锁的参数非常多，那么同时调用的时刻会很多，会造成不必要的等待、降低程序的性能。</p>
<p>为了解决这个问题，我们可以给每一个需要上锁的变量新建一个专属对象。并用这个对象传入<code>synchronized</code>关键字。如下图所示：</p>
<p>我们创建了两个Object类型的对象，一个叫<code>totalBytesLock</code>用来锁住<code>totalBytes</code>; 以及<code>totalFilesLock</code>用来锁住<code>totalFiles</code> 变量。</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/34.png" style="zoom:100%;"></p>
<p>在今后的开发中我们最好选择变量的专属对象来上锁，而不要一直使用<code>this</code>对象</p>
<h3 id="The-volatile-Keyword"><a href="#The-volatile-Keyword" class="headerlink" title="The volatile Keyword"></a>The volatile Keyword</h3><p><a href="https://blog.csdn.net/u012723673/article/details/80682208" target="_blank" rel="noopener">https://blog.csdn.net/u012723673/article/details/80682208</a></p>
<p>Java 语言包含两种内在的同步机制：同步块（或方法）和 volatile 变量，相比于synchronized（synchronized通常称为重量级锁），volatile更轻量级，因为它不会引起线程上下文的切换和调度。但是volatile 变量的同步性较差（有时它更简单并且开销更低），而且其使用也更容易出错。</p>
<p>在多线程环境下，一个线程对共享变量的操作对其他线程是不可见的。Java提供了volatile来保证<strong>可见性</strong>，当一个变量被volatile修饰后，表示着<strong>线程本地缓存无效</strong>，当一个线程<strong>修改共享变量</strong>后他会<strong>立即被更新到主存</strong>中，其他线程读取共享变量时，会<strong>直接从主内存中读取</strong></p>
<p>我们先来看一个没有 <code>volatile</code> 版本的代码，分析一下里面有什么错误：</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/35.png" style="zoom:100%;"></p>
<p>首先我们在 <code>DownloadStatus</code> 中新建一个 <code>isDone</code>布尔变量，来表明这个下载任务是否已经完成。并设定一个 <code>getter</code>返回<code>isDone</code> 和一个 <code>setter</code>将<code>isDown</code>设为True</p>
<p>然后在<code>DownloadFileTask</code>类中，我们在下载结束后调用 <code>status.done()</code>将<code>isDone()</code> 设置为True并输出Download complete</p>
<p>最后在<code>ThreadDemo</code>类中，新建两个线程，第一个线程传入DownloadFileTask对象，第二个线程里面是个 Lambda表达式，它会一直询问status中的变量isDone是否为True，一直到下载完成 ，isDone==True,才会跳出循环并输出<code>totalBytes</code>的值。</p>
<p>我们运行这个demo，却发现程序迟迟不打印<code>totalBytes</code>的值，事实上如果我们不关闭这个程序，它就会一直运行下去。</p>
<p>为什么会发生这种事情？原因就在于 <code>thread1</code>和<code>thread2</code>两个线程之间并没有完全同步，我们注意到虽然<code>totalBytes</code>是通过 synchronized关键字修饰的，但是 <code>isDone</code> 并没有同步。因此在thread2看来，isDone始终是False。这种不可见性要从底层的JVM优化机制<strong>cache</strong>开始说起：</p>
<p>有一个变量，存储在主存中，值为1。现在CPU的两个核分别执行一条线程，将这个变量从主存中读入到CPU当中去，存储在不同的cache中，因为从cache中读取数据要比从主存中读取快得多。但是这两个CPU之间并不知道对方的cache中存的这个变量的值。因此，当CPU1将cache中的变量从1修改到2的时候，CPU2看到的该变量仍然是1，就算CPU将该变量回写到主存当中去，CPU2的cache中因为已经存储了该变量，因此仍然看不到改变后的结果。这就是多线程的<strong>不可见性</strong></p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/36.png" style="zoom:100%;"></p>
<p>一种可行但是不建议的方法就是将 <code>DownloadStatus</code>中的<code>isDone()</code>和<code>done()</code>方法都使用<code>synchronized</code>关键字修饰。但是我们有更好的方法——volatile</p>
<p>在一开始我们也说了volatile的原理，那就是告诉JVM,我这个变量是随时会变的，是不稳定的。你每次访问必须从主存当中去读取，不能从cache中去读取。</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/37.png" style="zoom:100%;"></p>
<h3 id="Thread-Signalling-with-wait-and-notify"><a href="#Thread-Signalling-with-wait-and-notify" class="headerlink" title="Thread Signalling with wait() and notify()"></a>Thread Signalling with wait() and notify()</h3><p>有时候我们会使用无限循环询问一个变量是否发生变化，比如刚才例子中，一直询问下载完成没。但是这样是很占用CPU的资源的。它可能会重复循环上亿次才能等到结果。</p>
<p>为了优化上面这种情况，我们可以用<code>wait()</code>和<code>notify()</code>方法</p>
<p>顾名思义，调用<code>wait()</code>方法后，线程进入等待状态，<code>wait()</code>方法不会返回，直到将来某个时刻，线程从等待状态被其他线程唤醒后，<code>wait()</code>方法才会返回，然后，继续执行下一条语句。<strong>注意，只能在锁对象上调用<code>wait()</code>方法</strong> 。<code>notify()</code>则是在相同的锁对象上作用，完成某件事后发出一个信号，让<code>wait()</code>去接收</p>
<p>比如下面这个例子，当我们要用while来询问<code>isDone()</code>是否为true的时候，我们对status上了一个锁。然后在里面调用<code>wait()</code>让线程2沉睡。再跑到<code>DownloadFileTask</code>类中，当下载完成时我们在 status上锁了的情况下调用 <code>notifyAll()</code>发出讯号。<code>wait()</code>收到后就会跳出循环，执行打印命令。</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/38.png" style="zoom:100%;"></p>
<p>通过这种机制我们可以降低CPU的负荷，优化程序性能。但同时，在不正确的地方使用<code>wait()</code>和<code>notify()</code>可能会造成很多难以解决的问题，因此我们不推荐这种方法。</p>
<h3 id="Atomic-Objects"><a href="#Atomic-Objects" class="headerlink" title="Atomic Objects"></a>Atomic Objects</h3><p><a href="https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/concurrent/atomic/package-summary.html" target="_blank" rel="noopener">https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/concurrent/atomic/package-summary.html</a></p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/39.png" style="zoom:100%;"></p>
<p>Atomic object翻译过来就是原子对象，顾名思义，这个对象是不可分割的(不要用夸克抬杠) 。 我们之前做的所有努力，就是想避免多个线程<code>totalBytes++</code>产生竞争关系，因为<code>totalBytes++</code>需要进行三步操作，并不是原子化的。</p>
<p>ava的<code>java.util.concurrent</code>包除了提供底层锁、并发集合外，还提供了一组原子操作的封装类，它们位于<code>java.util.concurrent.atomic</code>包。</p>
<p>我们以<code>AtomicInteger</code>为例，它提供的主要操作有：</p>
<ul>
<li>增加值并返回新值：<code>int addAndGet(int delta)</code></li>
<li>加1后返回新值：<code>int incrementAndGet()</code></li>
<li>获取当前值：<code>int get()</code></li>
<li>用CAS方式设置：<code>int compareAndSet(int expect, int update)</code></li>
</ul>
<p>现在我们要做的就是将<code>totalBytes++</code>原子化，回到最初发生竞争状态的那段代码，我们要对<code>DownloadStatus</code>中的totalBytes进行修改，将其变成 <code>AtomicInteger</code>类型的数据。这时候就不能直接 <code>return totalBytes</code> 了，一定要调用 <code>get()</code>来获取当前的值；此外还要把++变成 <code>incrementAndGet()</code>，即自增1后返回。</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/40.png" style="zoom:100%;"></p>
<p>打印结果为： 100_000</p>
<p>原子类的实现原理就是<strong>compare and swap(CAS)</strong>, 比如说我调用 <code>incrementAndGet</code> 的时候原子类型的数据就会比较当前值和期望值，如果他们不相等，就进行交换操作。 </p>
<p>使用<code>java.util.concurrent.atomic</code>提供的原子操作可以简化多线程编程：</p>
<ul>
<li>原子操作实现了无锁的线程安全；</li>
<li>适用于计数器，累加器等。</li>
</ul>
<h3 id="Adders"><a href="#Adders" class="headerlink" title="Adders"></a>Adders</h3><p>虽然说原子类适用于计数器、累加器等，但是当有多个线程同时对一个对象进行累加操作的时候，我们更推荐使用Adder类，它同样可以实现原子化，但是在高并发的情况下，其速度会比 Atomic更快, 简单来说，Adder具有更高的吞吐量。</p>
<p>原理：<a href="https://blog.csdn.net/codingtu/article/details/89047291?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.control&amp;dist_request_id=&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.control" target="_blank" rel="noopener">参考这篇博客</a> </p>
<p>在LongAdder类中，我们使用 <code>intValue()</code>来获得当前<code>totalBytes</code>的值并返回为int 类型，同时在自增1的时候调用<code>increment()</code>方法。 总的来说和 Atomic 类是类似的。</p>
<p><img src="/2021/03/19/Java%E5%9F%BA%E7%A1%803/41.png" style="zoom:100%;"></p>
<h3 id="Synchronized-Collections"><a href="#Synchronized-Collections" class="headerlink" title="Synchronized Collections"></a>Synchronized Collections</h3><p>刚才我们讲的都是关于某一个变量的同步，现在我们来学对于一个集合的同步。</p>
<p>如果我们创建一个普通的 ArrayList集合，然后创建两个线程向集合中添加元素。有可能它们会发生 Race condition 导致数据丢失，为了规避这种情况的发生我们可以使用 Synchronized Collection:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="comment">//使用了 synchronizedCollection 能规避线程之间的进制，保持线程之间的同步</span></span><br><span class="line">        Collection&lt;Integer&gt; collection = </span><br><span class="line">          Collections.synchronizedCollection(<span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> thread1 = <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">           collection.addAll(Arrays.asList(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>));</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">var</span> thread2 = <span class="keyword">new</span> Thread(()-&gt;&#123;</span><br><span class="line">           collection.addAll(Arrays.asList(<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>));</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            thread1.join();</span><br><span class="line">            thread2.join();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(collection);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Concurrent-Collections"><a href="#Concurrent-Collections" class="headerlink" title="Concurrent Collections"></a>Concurrent Collections</h3><p>当并发高的时候，使用 Synchronized Collection 会导致CPU占用过高、性能下降。这时候我们可以用 <strong>Concurrent Collection</strong></p>
<p>在<a href="https://docs.oracle.com/en/java/javase/16/docs/api/java.base/java/util/concurrent/package-summary.html" target="_blank" rel="noopener">Concurrent官方文档</a> 中，我们看到有 <code>ConcurrentHashMap</code>,<code>ConcurrentLinkedDeque</code>等并发集合</p>
<p>以Map为例，假如我们要对一个HashMap进行高并发的操作，我们就可以使用 <code>ConcurrentHashMap</code>类。事实上，<code>ConcurrentHashMap</code>和<code>HashMap</code>都是对 <code>Map</code>接口的实现类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span></span>&#123;</span><br><span class="line">         Map&lt;Integer,String&gt;map = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line">         map.put(<span class="number">1</span>,<span class="string">"a"</span>);</span><br><span class="line">         map.get(<span class="number">1</span>);</span><br><span class="line">         map.remove(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="The-Executive-Framework"><a href="#The-Executive-Framework" class="headerlink" title="The Executive Framework"></a>The Executive Framework</h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><h3 id="Thread-Pools"><a href="#Thread-Pools" class="headerlink" title="Thread Pools"></a>Thread Pools</h3><h3 id="Executors"><a href="#Executors" class="headerlink" title="Executors"></a>Executors</h3><h3 id="Callables-and-Futures"><a href="#Callables-and-Futures" class="headerlink" title="Callables and Futures"></a>Callables and Futures</h3><h3 id="Asynchronous-Programming"><a href="#Asynchronous-Programming" class="headerlink" title="Asynchronous Programming"></a>Asynchronous Programming</h3><h3 id="Completable-Futures"><a href="#Completable-Futures" class="headerlink" title="Completable Futures"></a>Completable Futures</h3><h3 id="Creating-a-Completable-Future"><a href="#Creating-a-Completable-Future" class="headerlink" title="Creating a Completable Future"></a>Creating a Completable Future</h3><h3 id="Implementing-an-Asynchronous-API"><a href="#Implementing-an-Asynchronous-API" class="headerlink" title="Implementing an Asynchronous API"></a>Implementing an Asynchronous API</h3><h3 id="Running-Code-on-Completion"><a href="#Running-Code-on-Completion" class="headerlink" title="Running Code on Completion"></a>Running Code on Completion</h3><h3 id="Handling-Exceptions"><a href="#Handling-Exceptions" class="headerlink" title="Handling Exceptions"></a>Handling Exceptions</h3><h3 id="Transforming-a-Completable-Future"><a href="#Transforming-a-Completable-Future" class="headerlink" title="Transforming a Completable Future"></a>Transforming a Completable Future</h3><h3 id="Composing-Completable-Futures"><a href="#Composing-Completable-Futures" class="headerlink" title="Composing Completable Futures"></a>Composing Completable Futures</h3><h3 id="Combining-Completable-Futures"><a href="#Combining-Completable-Futures" class="headerlink" title="Combining Completable Futures"></a>Combining Completable Futures</h3><h3 id="Waiting-for-Many-Tasks-to-Complete"><a href="#Waiting-for-Many-Tasks-to-Complete" class="headerlink" title="Waiting for Many Tasks to Complete"></a>Waiting for Many Tasks to Complete</h3><h3 id="Waiting-for-the-First-Task"><a href="#Waiting-for-the-First-Task" class="headerlink" title="Waiting for the First Task"></a>Waiting for the First Task</h3><h3 id="Handling-timeouts"><a href="#Handling-timeouts" class="headerlink" title="Handling timeouts"></a>Handling timeouts</h3><h3 id="Project-Best-Price-Finder"><a href="#Project-Best-Price-Finder" class="headerlink" title="Project- Best Price Finder"></a>Project- Best Price Finder</h3><h3 id="Solution-Getting-a-Quote"><a href="#Solution-Getting-a-Quote" class="headerlink" title="Solution- Getting a Quote"></a>Solution- Getting a Quote</h3><h3 id="Solution-Getting-Many-Quotes"><a href="#Solution-Getting-Many-Quotes" class="headerlink" title="Solution- Getting Many Quotes"></a>Solution- Getting Many Quotes</h3><h3 id="Solution-Random-Delays"><a href="#Solution-Random-Delays" class="headerlink" title="Solution- Random Delays"></a>Solution- Random Delays</h3>
      
    </div>
    
    
    
    <div>
      
        <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束，感谢您的阅读-------------</div>
    
</div>

      
    </div>
    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:</strong>
    Jason
  </li>
  <li class="post-copyright-link">
    <strong>Post link:</strong>
    <a href="https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/" title="Java基础3">https://jasonxqh.github.io/2021/03/19/Java%E5%9F%BA%E7%A1%803/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice: </strong>
    All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> unless stating additionally.
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"><i class="fa fa-tag"></i> Java</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/03/16/%E7%A6%BB%E6%95%A3%E5%88%86%E5%B8%83%E5%92%8C%E8%BF%9E%E7%BB%AD%E5%88%86%E5%B8%83%EF%BC%882-4-2-6%EF%BC%89/" rel="next" title="离散分布和连续分布（2.4-2.6）">
                <i class="fa fa-chevron-left"></i> 离散分布和连续分布（2.4-2.6）
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/03/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A2/" rel="prev" title="计算机网络实验报告2">
                计算机网络实验报告2 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC80OTgyMC8yNjMxMQ=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Jason</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives%7C%7C%20archive">
              
                  <span class="site-state-item-count">427</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">60</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/JasonXQH" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:10195501423@stu.ecnu.edu.cn" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://yanghong.tech/" title="友链:杨弘的博客" target="_blank">友链:杨弘的博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ankate.github.io/" title="友链:赵奕轲的博客" target="_blank">友链:赵奕轲的博客</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://github.com/JasonXQH/JasonXQH.github.io" title="Like it, STAR ME" target="_blank">Like it, STAR ME</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Java基础3"><span class="nav-number">1.</span> <span class="nav-text">Java基础3</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Exceptions"><span class="nav-number">1.1.</span> <span class="nav-text">Exceptions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#What-are-Exceptions"><span class="nav-number">1.1.1.</span> <span class="nav-text">What are Exceptions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Types-of-Exceptions"><span class="nav-number">1.1.2.</span> <span class="nav-text">Types of Exceptions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Checked-exception"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">Checked exception</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Unchecked-exception-Runtime-exception"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">Unchecked exception&#x2F;Runtime exception</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Error"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">Error</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Exceptions-Hierarchy"><span class="nav-number">1.1.3.</span> <span class="nav-text">Exceptions Hierarchy</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Catching-Exceptions"><span class="nav-number">1.1.4.</span> <span class="nav-text">Catching Exceptions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Catching-Multiple-Types-of-Exceptions"><span class="nav-number">1.1.5.</span> <span class="nav-text">Catching Multiple Types of Exceptions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-finally-Block"><span class="nav-number">1.1.6.</span> <span class="nav-text">The finally Block</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-try-with-resources-Statement"><span class="nav-number">1.1.7.</span> <span class="nav-text">The try-with-resources Statement</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Throwing-Exceptions"><span class="nav-number">1.1.8.</span> <span class="nav-text">Throwing Exceptions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Re-throwing-Exceptions"><span class="nav-number">1.1.9.</span> <span class="nav-text">Re-throwing Exceptions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Custom-Exceptions"><span class="nav-number">1.1.10.</span> <span class="nav-text">Custom Exceptions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chaining-Exceptions"><span class="nav-number">1.1.11.</span> <span class="nav-text">Chaining Exceptions</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Generics"><span class="nav-number">1.2.</span> <span class="nav-text">Generics</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Need-for-Generics"><span class="nav-number">1.2.1.</span> <span class="nav-text">The Need for Generics</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#A-Poor-Solution"><span class="nav-number">1.2.2.</span> <span class="nav-text">A Poor Solution</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Generic-Classes"><span class="nav-number">1.2.3.</span> <span class="nav-text">Generic Classes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Generics-and-Primitive-Types"><span class="nav-number">1.2.4.</span> <span class="nav-text">Generics and Primitive Types</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Constraints"><span class="nav-number">1.2.5.</span> <span class="nav-text">Constraints</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Type-Erasure"><span class="nav-number">1.2.6.</span> <span class="nav-text">Type Erasure</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Comparable-Interface"><span class="nav-number">1.2.7.</span> <span class="nav-text">Comparable Interface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Generic-Methods"><span class="nav-number">1.2.8.</span> <span class="nav-text">Generic Methods</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Multiple-Type-Parameters"><span class="nav-number">1.2.9.</span> <span class="nav-text">Multiple Type Parameters</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Generic-Classes-and-Inheritance"><span class="nav-number">1.2.10.</span> <span class="nav-text">Generic Classes and Inheritance</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Wildcards"><span class="nav-number">1.2.11.</span> <span class="nav-text">Wildcards</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#extends"><span class="nav-number">1.2.11.1.</span> <span class="nav-text">? + extends</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#super"><span class="nav-number">1.2.11.2.</span> <span class="nav-text">? + super</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Collections"><span class="nav-number">1.3.</span> <span class="nav-text">Collections</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Iterable-Interface"><span class="nav-number">1.3.1.</span> <span class="nav-text">The Iterable Interface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Iterator-Interface"><span class="nav-number">1.3.2.</span> <span class="nav-text">The Iterator Interface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Collection-Interface"><span class="nav-number">1.3.3.</span> <span class="nav-text">The Collection Interface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-List-Interface"><span class="nav-number">1.3.4.</span> <span class="nav-text">The List Interface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Comparable-Interface"><span class="nav-number">1.3.5.</span> <span class="nav-text">The Comparable Interface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Comparator-Interface"><span class="nav-number">1.3.6.</span> <span class="nav-text">The Comparator Interface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Queue-Interface"><span class="nav-number">1.3.7.</span> <span class="nav-text">The Queue Interface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Set-Interface"><span class="nav-number">1.3.8.</span> <span class="nav-text">The Set Interface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Map-Interface"><span class="nav-number">1.3.9.</span> <span class="nav-text">The Map Interface</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lambda-Expressions"><span class="nav-number">1.4.</span> <span class="nav-text">Lambda Expressions</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Functional-Interfaces"><span class="nav-number">1.4.1.</span> <span class="nav-text">Functional Interfaces</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Anonymous-Inner-Classes"><span class="nav-number">1.4.2.</span> <span class="nav-text">Anonymous Inner Classes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lambda-Expressions-1"><span class="nav-number">1.4.3.</span> <span class="nav-text">Lambda Expressions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Variable-Capture"><span class="nav-number">1.4.4.</span> <span class="nav-text">Variable Capture</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Method-References"><span class="nav-number">1.4.5.</span> <span class="nav-text">Method References</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Built-in-Functional-Interfaces"><span class="nav-number">1.4.6.</span> <span class="nav-text">Built-in Functional Interfaces</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Consumer-Interface"><span class="nav-number">1.4.7.</span> <span class="nav-text">The Consumer Interface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chaining-Consumer"><span class="nav-number">1.4.8.</span> <span class="nav-text">Chaining Consumer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Supplier-Interface"><span class="nav-number">1.4.9.</span> <span class="nav-text">The Supplier Interface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Function-Interface"><span class="nav-number">1.4.10.</span> <span class="nav-text">The Function Interface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Composing-Functions"><span class="nav-number">1.4.11.</span> <span class="nav-text">Composing Functions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-Predicate-Interface"><span class="nav-number">1.4.12.</span> <span class="nav-text">The Predicate Interface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Combining-Predicates"><span class="nav-number">1.4.13.</span> <span class="nav-text">Combining Predicates</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-BinaryOperator-Interface"><span class="nav-number">1.4.14.</span> <span class="nav-text">The BinaryOperator Interface</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-UnaryOperator-Interface"><span class="nav-number">1.4.15.</span> <span class="nav-text">The UnaryOperator Interface</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Streams"><span class="nav-number">1.5.</span> <span class="nav-text">Streams</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Imperative-vs-Functional-Programming"><span class="nav-number">1.5.1.</span> <span class="nav-text">Imperative vs Functional Programming</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Creating-a-Stream"><span class="nav-number">1.5.2.</span> <span class="nav-text">Creating a Stream</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mapping-Elements"><span class="nav-number">1.5.3.</span> <span class="nav-text">Mapping Elements</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Filtering-Elements"><span class="nav-number">1.5.4.</span> <span class="nav-text">Filtering Elements</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Slicing-Streams"><span class="nav-number">1.5.5.</span> <span class="nav-text">Slicing Streams</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#limit-n"><span class="nav-number">1.5.5.1.</span> <span class="nav-text">limit(n)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#skip-n"><span class="nav-number">1.5.5.2.</span> <span class="nav-text">skip(n)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#takeWhile-predicate"><span class="nav-number">1.5.5.3.</span> <span class="nav-text">takeWhile(predicate)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#dropWhile-predicate"><span class="nav-number">1.5.5.4.</span> <span class="nav-text">dropWhile(predicate)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sorting-Streams"><span class="nav-number">1.5.6.</span> <span class="nav-text">Sorting Streams</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Getting-Unique-Elements"><span class="nav-number">1.5.7.</span> <span class="nav-text">Getting Unique Elements</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Peeking-Elements"><span class="nav-number">1.5.8.</span> <span class="nav-text">Peeking Elements</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Simple-Reducers"><span class="nav-number">1.5.9.</span> <span class="nav-text">Simple Reducers</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reducing-a-Stream"><span class="nav-number">1.5.10.</span> <span class="nav-text">Reducing a Stream</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Collectors"><span class="nav-number">1.5.11.</span> <span class="nav-text">Collectors</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Grouping-Elements"><span class="nav-number">1.5.12.</span> <span class="nav-text">Grouping Elements</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Partitioning-Elements"><span class="nav-number">1.5.13.</span> <span class="nav-text">Partitioning Elements</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Primitive-Type-Streams"><span class="nav-number">1.5.14.</span> <span class="nav-text">Primitive Type Streams</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Concurrency-and-Multi-threading"><span class="nav-number">1.6.</span> <span class="nav-text">Concurrency and Multi-threading</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Processes-and-Threads"><span class="nav-number">1.6.1.</span> <span class="nav-text">Processes and Threads</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Starting-a-Thread"><span class="nav-number">1.6.2.</span> <span class="nav-text">Starting a Thread</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pausing-a-Thread"><span class="nav-number">1.6.3.</span> <span class="nav-text">Pausing a Thread</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Joining-a-Thread"><span class="nav-number">1.6.4.</span> <span class="nav-text">Joining a Thread</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Interrupting-a-Thread"><span class="nav-number">1.6.5.</span> <span class="nav-text">Interrupting a Thread</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Concurrency-Issues"><span class="nav-number">1.6.6.</span> <span class="nav-text">Concurrency Issues</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Race-Conditions"><span class="nav-number">1.6.7.</span> <span class="nav-text">Race Conditions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Strategies-for-Thread-Safety"><span class="nav-number">1.6.8.</span> <span class="nav-text">Strategies for Thread Safety</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Confinement"><span class="nav-number">1.6.9.</span> <span class="nav-text">Confinement</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Locks"><span class="nav-number">1.6.10.</span> <span class="nav-text">Locks</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-synchronized-Keyword"><span class="nav-number">1.6.11.</span> <span class="nav-text">The synchronized Keyword</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#The-volatile-Keyword"><span class="nav-number">1.6.12.</span> <span class="nav-text">The volatile Keyword</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Thread-Signalling-with-wait-and-notify"><span class="nav-number">1.6.13.</span> <span class="nav-text">Thread Signalling with wait() and notify()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Atomic-Objects"><span class="nav-number">1.6.14.</span> <span class="nav-text">Atomic Objects</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Adders"><span class="nav-number">1.6.15.</span> <span class="nav-text">Adders</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Synchronized-Collections"><span class="nav-number">1.6.16.</span> <span class="nav-text">Synchronized Collections</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Concurrent-Collections"><span class="nav-number">1.6.17.</span> <span class="nav-text">Concurrent Collections</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#The-Executive-Framework"><span class="nav-number">1.7.</span> <span class="nav-text">The Executive Framework</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Introduction"><span class="nav-number">1.7.1.</span> <span class="nav-text">Introduction</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Thread-Pools"><span class="nav-number">1.7.2.</span> <span class="nav-text">Thread Pools</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Executors"><span class="nav-number">1.7.3.</span> <span class="nav-text">Executors</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Callables-and-Futures"><span class="nav-number">1.7.4.</span> <span class="nav-text">Callables and Futures</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Asynchronous-Programming"><span class="nav-number">1.7.5.</span> <span class="nav-text">Asynchronous Programming</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Completable-Futures"><span class="nav-number">1.7.6.</span> <span class="nav-text">Completable Futures</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Creating-a-Completable-Future"><span class="nav-number">1.7.7.</span> <span class="nav-text">Creating a Completable Future</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Implementing-an-Asynchronous-API"><span class="nav-number">1.7.8.</span> <span class="nav-text">Implementing an Asynchronous API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Running-Code-on-Completion"><span class="nav-number">1.7.9.</span> <span class="nav-text">Running Code on Completion</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Handling-Exceptions"><span class="nav-number">1.7.10.</span> <span class="nav-text">Handling Exceptions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Transforming-a-Completable-Future"><span class="nav-number">1.7.11.</span> <span class="nav-text">Transforming a Completable Future</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Composing-Completable-Futures"><span class="nav-number">1.7.12.</span> <span class="nav-text">Composing Completable Futures</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Combining-Completable-Futures"><span class="nav-number">1.7.13.</span> <span class="nav-text">Combining Completable Futures</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Waiting-for-Many-Tasks-to-Complete"><span class="nav-number">1.7.14.</span> <span class="nav-text">Waiting for Many Tasks to Complete</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Waiting-for-the-First-Task"><span class="nav-number">1.7.15.</span> <span class="nav-text">Waiting for the First Task</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Handling-timeouts"><span class="nav-number">1.7.16.</span> <span class="nav-text">Handling timeouts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Project-Best-Price-Finder"><span class="nav-number">1.7.17.</span> <span class="nav-text">Project- Best Price Finder</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-Getting-a-Quote"><span class="nav-number">1.7.18.</span> <span class="nav-text">Solution- Getting a Quote</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-Getting-Many-Quotes"><span class="nav-number">1.7.19.</span> <span class="nav-text">Solution- Getting Many Quotes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Solution-Random-Delays"><span class="nav-number">1.7.20.</span> <span class="nav-text">Solution- Random Delays</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart" aria-hidden="true"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jason</span>
 <!--
  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">1265.2k</span>
  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>



-->
        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('-1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  


  

  

</body>
</html>
