<!DOCTYPE html>
<html lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jasonxqh.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Jason‘s Blog">
<meta property="og:url" content="https://jasonxqh.github.io/page/32/index.html">
<meta property="og:site_name" content="Jason‘s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Jason">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://jasonxqh.github.io/page/32/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Jason‘s Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Jason‘s Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/06/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/06/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/" class="post-title-link" itemprop="url">归并排序</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-06 15:15:20" itemprop="dateCreated datePublished" datetime="2020-05-06T15:15:20+08:00">2020-05-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-24 14:14:26" itemprop="dateModified" datetime="2020-06-24T14:14:26+08:00">2020-06-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Rank/" itemprop="url" rel="index"><span itemprop="name">Rank</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h1><h3 id="算法设计"><a href="#算法设计" class="headerlink" title="算法设计"></a>算法设计</h3><p>归并排序采用分治策略实现对n个元素进行排序算法，是分治法的一个典型应用和完美体现，它是一种平衡，简单的二分分治策略，过程大致分为：</p>
<ol>
<li>分解——将待排序的元素分成大小大致相同的两个子序列</li>
<li>治理——对两个子序列进行合并排序</li>
<li>合并——将排好序的有序子序列进行合并，得到最终的有序列。</li>
</ol>
<p><img src="/2020/05/06/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/1.png" alt="示例">递归树高nlogn</p>
<h3 id="合并操作"><a href="#合并操作" class="headerlink" title="合并操作"></a>合并操作</h3><ul>
<li>新开辟一段数组，数组长为 $high- low +1$</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> arr[],<span class="keyword">int</span> low,<span class="keyword">int</span> mid,<span class="keyword">int</span> high)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> *temp = <span class="keyword">new</span> <span class="keyword">int</span> [high- low +<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> i = low;<span class="comment">//左序列指针</span></span><br><span class="line">    <span class="keyword">int</span> j = mid+<span class="number">1</span>;<span class="comment">//右序列指针</span></span><br><span class="line">    <span class="keyword">int</span> t = <span class="number">0</span>;<span class="comment">//临时数组指针</span></span><br><span class="line">    <span class="keyword">while</span> (i&lt;=mid &amp;&amp; j&lt;= high)&#123;</span><br><span class="line">        <span class="keyword">if</span>(arr[i]&lt;=arr[j])</span><br><span class="line">        &#123; temp[t++] = arr[i++]; &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123; temp[t++] = arr[j++]; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;=mid)&#123;<span class="comment">//将左边剩余元素填充进temp中</span></span><br><span class="line">        temp[t++] = arr[i++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(j&lt;=high)&#123;<span class="comment">//将右序列剩余元素填充进temp中</span></span><br><span class="line">        temp[t++] = arr[j++];</span><br><span class="line">    &#125;</span><br><span class="line">    t = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//将temp中的元素全部拷贝到原数组中,因为temp只是一个辅助数组</span></span><br><span class="line">    <span class="keyword">while</span>(low &lt;=  high)&#123; arr[low++] = temp[t++]; &#125;</span><br><span class="line">    <span class="keyword">delete</span> []temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="递归操作"><a href="#递归操作" class="headerlink" title="递归操作"></a>递归操作</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MergeSort</span><span class="params">(<span class="keyword">int</span> A[],<span class="keyword">int</span> low,<span class="keyword">int</span> high)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(low&lt;high)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> mid = (low+high)/<span class="number">2</span>;</span><br><span class="line">        <span class="comment">//对A[low:mid]中的元素进行合并排序</span></span><br><span class="line">        MergeSort(A,low,mid);</span><br><span class="line">        <span class="comment">//对A[mid+1:high]中的元素进行合并排序</span></span><br><span class="line">        MergeSort(A,mid+<span class="number">1</span>,high);</span><br><span class="line">        <span class="comment">//合并操作,两个有序序列的合并</span></span><br><span class="line">        merge(A,low,mid,high);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> Maxsize 10000</span></span><br><span class="line"><span class="keyword">int</span> A[Maxsize];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Merge</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> low, <span class="keyword">int</span> mid, <span class="keyword">int</span> high)</span><span class="comment">//合并函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> *B=<span class="keyword">new</span> <span class="keyword">int</span>[high-low+<span class="number">1</span>];<span class="comment">//申请一个辅助数组</span></span><br><span class="line">    <span class="keyword">int</span> i=low, j=mid+<span class="number">1</span>, k=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;=mid &amp;&amp; j&lt;=high) &#123;<span class="comment">//按从小到大存放到辅助数组B[]中</span></span><br><span class="line">        <span class="keyword">if</span>(A[i]&lt;=A[j])</span><br><span class="line">            B[k++]=A[i++];</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            B[k++]=A[j++];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;=mid) B[k++]=A[i++];<span class="comment">//将数组中剩下的元素放置B中</span></span><br><span class="line">    <span class="keyword">while</span>(j&lt;=high) B[k++]=A[j++];</span><br><span class="line">    <span class="keyword">for</span>(i=low, k=<span class="number">0</span>; i&lt;=high; i++)</span><br><span class="line">        A[i]=B[k++];</span><br><span class="line">    <span class="keyword">delete</span> []B;<span class="comment">//释放空间</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MergeSort</span><span class="params">(<span class="keyword">int</span> A[],<span class="keyword">int</span> low,<span class="keyword">int</span> high)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(low&lt;high)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> mid = (low+high)/<span class="number">2</span>;</span><br><span class="line">        <span class="comment">//对A[low:mid]中的元素进行合并排序</span></span><br><span class="line">        MergeSort(A,low,mid);</span><br><span class="line">        <span class="comment">//对A[mid+1:high]中的元素进行合并排序</span></span><br><span class="line">        MergeSort(A,mid+<span class="number">1</span>,high);</span><br><span class="line">        <span class="comment">//合并操作,两个有序序列的合并</span></span><br><span class="line">        Merge(A,low,mid,high);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n ;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"请输入数列中的元素个数"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"请依次输入数列中的元素"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cin</span>&gt;&gt;A[i];</span><br><span class="line">    &#125;</span><br><span class="line">    MergeSort(A,<span class="number">0</span>,n<span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"快速排序的结果:"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;A[i]&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="算法分析"><a href="#算法分析" class="headerlink" title="算法分析"></a>算法分析</h3><h4 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h4><ol>
<li>分解： 这一步仅仅是计算出子序列的中间位置，需要常数时间O(1)</li>
<li>解决子问题：递归求解两个规模为n/2的子问题，所需时间为2T(n/2)</li>
<li>合并： Merge算法可以在O（n)的时间完成</li>
</ol>
<p>所以运行总时间为</p>
<script type="math/tex; mode=display">T(n):\left\{ \begin{aligned} O(1),n = 1\\ T(n-1)+O(n),n>1 \end{aligned} \right.</script><h4 id="空间复杂度"><a href="#空间复杂度" class="headerlink" title="空间复杂度"></a>空间复杂度</h4><p>程序中变量占用了一些辅助空间，这些辅助空间都是常数阶的，每调用一个适当大小的缓冲去，且退出时会释放。最多分配大小为n，所以空间复杂度为O(n),递归调用所使用的栈空间是O(logn) 因为递归树高logn</p>
<p><img src="/2020/05/06/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/2.png" alt="示例"></p>
<h3 id="最后贴一段gif-便于理解"><a href="#最后贴一段gif-便于理解" class="headerlink" title="最后贴一段gif,便于理解"></a>最后贴一段gif,便于理解</h3><p><img src="/2020/05/06/%E5%BD%92%E5%B9%B6%E6%8E%92%E5%BA%8F/1.gif" alt="示例"></p>
<p>视频来自于可视化算法网站 <a href="https://visualgo.net/zh" target="_blank" rel="noopener">https://visualgo.net/zh</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/06/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/06/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/" class="post-title-link" itemprop="url">快速排序</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-06 15:14:38" itemprop="dateCreated datePublished" datetime="2020-05-06T15:14:38+08:00">2020-05-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-12-10 19:48:32" itemprop="dateModified" datetime="2022-12-10T19:48:32+08:00">2022-12-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Rank/" itemprop="url" rel="index"><span itemprop="name">Rank</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h1><p>快速排序的基本思想是基于分治策略的，其算法思想如下</p>
<ul>
<li>分解：先从数列中取出一个元素作为基准元素，以基准元素为标准，将问题分解为两个子序列，让小于或等于基准元素的子序列在左侧，让大于基准元素的子序列在右侧</li>
<li>治理：对两个子序列进行快速排序</li>
<li>合并：将排好序的两个子序列合并在一起（快速排序什么都不用做）</li>
</ul>
<h3 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h3><ul>
<li><p>如何分解是一个难题，因为如果基准元素选取不当，有可能分解成规模为0，n-1 的量的子序列，那么这样快速排序就退化为冒泡排序了。一般来说，基准元素选取有以下几种方法</p>
<ul>
<li><p>取第一个元素</p>
</li>
<li><p>取最后一个元素</p>
</li>
<li><p>取中间位置的元素</p>
</li>
<li><p>取第一个，最后一个，和中间位置元素三者中的中位数</p>
</li>
<li><p>取第一个和最后一个位置之间的随机数k,(low&lt;=k&lt;=high)选R[k]做基准元素，可以避免每次都他妈的最坏8</p>
</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">srand(time(<span class="number">0</span>));	<span class="comment">//选时间做种子</span></span><br><span class="line">rand()%(high-low+<span class="number">1</span>)+low;<span class="comment">//产生一个low-high 之间的随机下标</span></span><br></pre></td></tr></table></figure>
<h3 id="算法步骤"><a href="#算法步骤" class="headerlink" title="算法步骤"></a>算法步骤</h3><ol>
<li>首先取数组的第一个元素作为基准元素 pivot = R[low], i = low ,j = high</li>
<li>从右向左扫描，找到小于等于pivot的数，如果找到，R[i]和R[j] 交换，i++</li>
<li>从左向右扫描，找到大于等于pivot的数，如果找到，R[i]和R[j] 交换，j —</li>
<li>重复步骤2-3，直到i和j指针重合，返回该位置mid=i 该位置的数正好是pivot元素</li>
<li>至此完成一趟排序，此时mid为界，将元数据分为两个子序列，左侧子序列元素都比pivot小，右边都比pivot大，然后再分别对这两个子序列进行快排</li>
</ol>
<h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><div class="table-container">
<table>
<thead>
<tr>
<th>low,i</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th>high,j</th>
</tr>
</thead>
<tbody>
<tr>
<td>30</td>
<td>24</td>
<td>5</td>
<td>58</td>
<td>18</td>
<td>36</td>
<td>12</td>
<td>42</td>
<td>39</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>low</th>
<th>i</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th>j</th>
<th></th>
<th>high</th>
</tr>
</thead>
<tbody>
<tr>
<td>12</td>
<td>24</td>
<td>5</td>
<td>58</td>
<td>18</td>
<td>36</td>
<td>30</td>
<td>42</td>
<td>39</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>low</th>
<th></th>
<th></th>
<th>i</th>
<th></th>
<th>j</th>
<th></th>
<th></th>
<th>high</th>
</tr>
</thead>
<tbody>
<tr>
<td>12</td>
<td>24</td>
<td>5</td>
<td>30</td>
<td>18</td>
<td>36</td>
<td>58</td>
<td>42</td>
<td>39</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>low</th>
<th></th>
<th></th>
<th>mid-1</th>
<th>j,i,mid</th>
<th>mid+1</th>
<th></th>
<th></th>
<th>high</th>
</tr>
</thead>
<tbody>
<tr>
<td>12</td>
<td>24</td>
<td>5</td>
<td>18</td>
<td>30</td>
<td>36</td>
<td>58</td>
<td>42</td>
<td>39</td>
</tr>
</tbody>
</table>
</div>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> Maxsize 10000</span></span><br><span class="line"><span class="keyword">int</span> A[Maxsize];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Partition</span><span class="params">(<span class="keyword">int</span> r[],<span class="keyword">int</span> low,<span class="keyword">int</span> high)</span><span class="comment">//划分函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//设定基准元素</span></span><br><span class="line">    <span class="keyword">int</span> i = low, j = high,pivot = r[low];</span><br><span class="line">    <span class="keyword">while</span>(i&lt;j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span> (i&lt;j&amp;&amp;r[j]&gt;pivot)</span><br><span class="line">            j--;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;j)</span><br><span class="line">            swap(r[i++],r[j]);</span><br><span class="line">        <span class="comment">//r[i]和r[j]交换后，i右移一位</span></span><br><span class="line">        <span class="keyword">while</span>(i&lt;j&amp;&amp;r[i]&lt;=pivot)</span><br><span class="line">            i++;<span class="comment">//向右扫描</span></span><br><span class="line">        <span class="keyword">if</span>(i&lt;j)</span><br><span class="line">            swap(r[i],r[j--]);</span><br><span class="line">        <span class="comment">//r[i]和r[j]交换后，j左移一位</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mid = i;</span><br><span class="line">    <span class="keyword">return</span> mid;<span class="comment">//返回我们的中间界限</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">QuickSort</span><span class="params">(<span class="keyword">int</span> R[],<span class="keyword">int</span> low,<span class="keyword">int</span> high)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> mid;</span><br><span class="line">    <span class="keyword">if</span>(low&lt;high)</span><br><span class="line">    &#123;</span><br><span class="line">        mid = Partition(R,low,high);</span><br><span class="line">        QuickSort(R,low,mid<span class="number">-1</span>);</span><br><span class="line">        QuickSort(R,mid+<span class="number">1</span>,high);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n ;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"请输入数列中的元素个数"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"请依次输入数列中的元素"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cin</span>&gt;&gt;A[i];</span><br><span class="line">    &#125;</span><br><span class="line">    QuickSort(A,<span class="number">0</span>,n<span class="number">-1</span>);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"快速排序的结果:"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;A[i]&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="算法分析"><a href="#算法分析" class="headerlink" title="算法分析"></a>算法分析</h3><h4 id="最好情况"><a href="#最好情况" class="headerlink" title="最好情况"></a>最好情况</h4><h5 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h5><ul>
<li>分解：划分Partition需要扫描每个元素，每次扫描的元素个数不超过n，因此时间复杂度为O(n)</li>
<li>治理：在理想情况下，每次划分将问题分解为两个规模为n/2的子问题，递归求解连个规模为 n/2的自问题，所需的时间为 2T(n/2)</li>
<li>合并：因为是原地排序，合并操作不需要时间复杂度</li>
<li><img src="/2020/05/06/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/1.png" style="zoom:150%;"></li>
<li><script type="math/tex; mode=display">T(n):\left\{ \begin{aligned} O(1),n = 1\\2T(n/2)+O(n),n>1 \end{aligned} \right.</script></li>
<li>最终 $T(n) = 2^xT(\frac{n}{2^x})+xO(n),x = \log n$</li>
<li>所以 代入得 $T(n) = nT(1)+\log n\times O(n)= O(n\log n)$</li>
</ul>
<h5 id="空间复杂度"><a href="#空间复杂度" class="headerlink" title="空间复杂度"></a>空间复杂度</h5><ul>
<li>程序中变量占用了一些辅助空间，这些辅助空间都是常数阶的。递归调用所使用的栈空间为递归树的深度 $\log n$ ，那么空间复杂度为$ O(\log n)$</li>
</ul>
<h4 id="最坏情况"><a href="#最坏情况" class="headerlink" title="最坏情况"></a>最坏情况</h4><h5 id="时间复杂度-1"><a href="#时间复杂度-1" class="headerlink" title="时间复杂度"></a>时间复杂度</h5><ul>
<li>分解：划分Partition需要扫描每个元素，每次扫描的元素个数不超过n，因此时间复杂度为O(n)</li>
<li>治理：在最坏的情况下，每次划分将问题分解后，基准元素的左侧（或者右侧） 没有元素，基准元素的另一侧为1个规模为n-1的子问题。递归求解这个规模为n-1的子问题，所需的时间为T(n-1) </li>
<li>合并：因为是原地排序，合并操作不需要时间复杂度</li>
<li><script type="math/tex; mode=display">T(n):\left\{ \begin{aligned} O(1),n = 1\\ T(n-1)+O(n),n>1 \end{aligned} \right.</script></li>
<li>相当于冒泡排序，这种情况下最坏的时间复杂度为$O(n^2)$</li>
</ul>
<h5 id="空间复杂度-1"><a href="#空间复杂度-1" class="headerlink" title="空间复杂度"></a>空间复杂度</h5><ul>
<li>程序中变量占用了一些辅助空间，这些辅助空间都是常数阶的。递归调用所使用的栈空间为递归树的深度 n ，那么空间复杂度为 O(n),因为递归调用了n次</li>
</ul>
<h4 id="平均情况"><a href="#平均情况" class="headerlink" title="平均情况"></a>平均情况</h4><h5 id="时间复杂度-2"><a href="#时间复杂度-2" class="headerlink" title="时间复杂度"></a>时间复杂度</h5><p>假设我们划分后基准元素的位置在第k个</p>
<p>$T(n) = \frac 1{n}\sum_1^n(T(n-k)+T(n-1))+O(n)$</p>
<p>$= \frac1{n}(T(n-1)+T(0)+T(n-2)+T(1)+…+T(1)+T(n-2)+T(0)+T(n-1))+O(n)$</p>
<p>$=\frac2{n}\sum_{k=1}^{n-1}T(k)+O(n)$</p>
<p>用归纳法可得出，时间复杂度也为$O(n\log n)$</p>
<h5 id="空间复杂度-2"><a href="#空间复杂度-2" class="headerlink" title="空间复杂度"></a>空间复杂度</h5><ul>
<li>程序中变量占用了一些辅助空间，这些辅助空间都是常数阶的。递归调用所使用的栈空间为递归树的深度 logn ，那么空间复杂度为 O(logn)</li>
</ul>
<p><img src="/2020/05/06/%E5%BF%AB%E9%80%9F%E6%8E%92%E5%BA%8F/0.png" alt="示例" style="zoom:80%;"></p>
<h4 id="稳定性"><a href="#稳定性" class="headerlink" title="稳定性"></a>稳定性</h4><p>因为前后两个方向扫描并交换，相等的两个元素有可能出现排序前后位置不一样的情况，因此快速排序是不稳定的排序方法，比如题目告诉你 70 70 排序后第一个70仍然要在第二个70之前，这时候就不能用快速排序了</p>
<h3 id="算法改进"><a href="#算法改进" class="headerlink" title="算法改进"></a>算法改进</h3><ul>
<li>从上述算法可以看出，每次交换都是在和基准元素进行交换，实际上没必要这么做，我们的目的就是想把原序列分成以基准元素为界的两个子序列，左侧子序列小于等于基准元素，右侧子序列大于基准元素。</li>
<li>那么有很多方法可以实现，我们可以从右向左扫描，找到小于pivot的数R[j],让R[i]与R[j]交换，一直交替进行贸易直到i和j碰头为止，这时将基准元素与R[i]交换即可。这样完成一次划分过程交换的元素个数就少了很多</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>low,i</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th>high,j</th>
</tr>
</thead>
<tbody>
<tr>
<td>30</td>
<td>24</td>
<td>5</td>
<td>58</td>
<td>18</td>
<td>36</td>
<td>12</td>
<td>42</td>
<td>39</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>low</th>
<th></th>
<th></th>
<th>i</th>
<th></th>
<th></th>
<th>j</th>
<th></th>
<th>high</th>
</tr>
</thead>
<tbody>
<tr>
<td>30</td>
<td>24</td>
<td>5</td>
<td>12</td>
<td>18</td>
<td>36</td>
<td>58</td>
<td>42</td>
<td>39</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>low</th>
<th></th>
<th></th>
<th></th>
<th>i,j</th>
<th></th>
<th></th>
<th></th>
<th>high,j</th>
</tr>
</thead>
<tbody>
<tr>
<td>30</td>
<td>24</td>
<td>5</td>
<td>12</td>
<td>18</td>
<td>36</td>
<td>58</td>
<td>42</td>
<td>39</td>
</tr>
</tbody>
</table>
</div>
<div class="table-container">
<table>
<thead>
<tr>
<th>low</th>
<th></th>
<th></th>
<th></th>
<th>i,j</th>
<th></th>
<th></th>
<th></th>
<th>high</th>
</tr>
</thead>
<tbody>
<tr>
<td>18</td>
<td>24</td>
<td>5</td>
<td>12</td>
<td>30</td>
<td>36</td>
<td>58</td>
<td>42</td>
<td>39</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>优化算法降低时间空间复杂度是很难的，但是常数级的优化是容易的</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Partition</span><span class="params">(<span class="keyword">int</span> r[],<span class="keyword">int</span> low,<span class="keyword">int</span> high)</span><span class="comment">//划分函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//设定基准元素</span></span><br><span class="line">    <span class="keyword">int</span> i = low, j = high, pivot = r[low];</span><br><span class="line">    <span class="keyword">while</span>(i&lt;j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>( i&lt;j&amp;&amp;r[j]&gt;pivot&amp;&amp;j!=low)</span><br><span class="line">            j--;</span><br><span class="line">        <span class="keyword">while</span> ( i&lt;j&amp;&amp;r[i]&lt;=pivot&amp;&amp;i!=high)</span><br><span class="line">            i++;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;j)</span><br><span class="line">            swap(r[i],r[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    swap(r[low],r[j]);</span><br><span class="line">    <span class="keyword">int</span> mid = i;</span><br><span class="line">    <span class="keyword">return</span> mid;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="练习题"><a href="#练习题" class="headerlink" title="练习题"></a>练习题</h2><ul>
<li>设线性表中每个元素都有两个数据项$k_1$ 和 $k_2$ ，现对线性表按以下规则进行排序：先看数据项 $k_1$ ， $k_1$值小的元素在前，大的再后；在k1值相同的情况下，再看k2, k2值小的在钱，大的元素在后。满足这种要求的排序方法是：<ul>
<li>先按$k_1$ 进行直接插入排序，再按$k_2$ 进行简单选择排序</li>
<li>先按$k_2$ 进行直接插入排序，再按$k_1$ 进行简单选择排序</li>
<li>先按$k_1$ 进行简单选择排序，再按$k_2$ 进行直接插入排序</li>
<li>先按$k_2$ 进行简单选择排序，再按$k_1$ 进行直接插入排序</li>
</ul>
</li>
</ul>
<p>答案是D，由于整体按照k1顺序排列，所以要先排k2，再排k1，然后考虑稳定性，排完k2之后，排k1时不能打乱前后顺序，因此在k1的算法选择上一定要选稳定排序。</p>
<script type="math/tex; mode=display">
\lim\limits_{x\rightarrow 0}(1+x)^\frac{1}{x} = e^{\lim\limits{x\rightarrow 0}\frac{1}{x}(x)(x+1-1)}</script>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/06/%E5%88%86%E9%85%8D%E6%8E%92%E5%BA%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/06/%E5%88%86%E9%85%8D%E6%8E%92%E5%BA%8F/" class="post-title-link" itemprop="url">分配排序</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-06 11:50:52" itemprop="dateCreated datePublished" datetime="2020-05-06T11:50:52+08:00">2020-05-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-12-10 19:47:20" itemprop="dateModified" datetime="2022-12-10T19:47:20+08:00">2022-12-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Rank/" itemprop="url" rel="index"><span itemprop="name">Rank</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="分配排序"><a href="#分配排序" class="headerlink" title="分配排序"></a>分配排序</h1><h2 id="桶排序"><a href="#桶排序" class="headerlink" title="桶排序"></a>桶排序</h2><ul>
<li>分配排序不需要比较关键词的大小，根据关键词各位上的值，进行若干次分配和收集实现排序</li>
<li>桶排序将待排序序列划分成若干区间。每个区间形象的看作一个桶，如果桶中的记录多以一个则使用较快的排序方法进行排序，把每个桶中的记录收集起来，最终得到有序序列</li>
</ul>
<p><img src="/2020/05/06/%E5%88%86%E9%85%8D%E6%8E%92%E5%BA%8F/1.png" alt="示例"></p>
<h3 id="注意的问题"><a href="#注意的问题" class="headerlink" title="注意的问题"></a>注意的问题</h3><ul>
<li>桶排序的数据最好是均匀分布的，如果都在90分以上，那么都在一个桶内，那么就退化成了一般的排序。在理想的情况下，当数据均匀分布，桶的数量m足够大的时候，那么每一个桶内最多只有一个记录，不需要再进行排序，只需要O（N）的时间将所有的记录分配到桶中，再用O（N）的时间收集起来。但这样空间复杂度会很大</li>
<li>桶排序支队不同的数据选择的划分方法是不同的，例如序列（2，46，1278，89323，211，22，43，1）可以按照位数划分桶，1位数，2位数，3位数…</li>
<li>桶内排序的时候使用的比较排序算法也有可能不同，可以用插入排序，也可以用快速排序</li>
</ul>
<h2 id="基数排序"><a href="#基数排序" class="headerlink" title="基数排序"></a>基数排序</h2><ul>
<li>基数排序可以看作桶排序的一种扩展，是一种多关键词排序算法，如果记录按照多个关键词排序，则依次按照这些关键词进行排序。如果记录按照一个数值型的关键词排序，可以把该关键词看作是d位组成的多关键词排序，每一位的取值范围是[0,r)，其中r被称为基数。例如十进制数268由3位数组成，每一位取值都在[0,10)，十进制数的r为10，二进制为2，英文字母的基数为26.</li>
</ul>
<h3 id="算法步骤"><a href="#算法步骤" class="headerlink" title="算法步骤"></a>算法步骤</h3><ol>
<li>求出待排序序列中最大关键词的位数d，然后从低位到高位进行基数排序</li>
<li>按个位将关键词<strong>依次</strong>分配到桶中，然后把每个桶中的数据依次收集起来</li>
<li>将十位关键词<strong>依次</strong>分配到桶中，然后把每个桶中的数据依次收集起来</li>
<li><strong>依次</strong>下去，直到d位处理完毕，得到一个有序的序列</li>
<li>拿68，75，54，70，83，48，80，12，92为例子</li>
</ol>
<ul>
<li>先按个位排序</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr>
<td>70</td>
<td></td>
<td>12</td>
<td>83</td>
<td>54</td>
<td>75</td>
<td></td>
<td></td>
<td>68</td>
<td></td>
</tr>
<tr>
<td>80</td>
<td></td>
<td>92</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>48</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>按找桶的顺序收集，波浪化收集得到 70，80，12，92，83，54，75，68，48</li>
<li>再按照第一趟的排序结果十位排序</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>12</td>
<td></td>
<td></td>
<td>48</td>
<td>54</td>
<td>68</td>
<td>70</td>
<td>80</td>
<td>92</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>75</td>
<td>83</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>再按照桶的顺序收集，得到12，48，54，68，70，75，80，83，92</li>
</ul>
<h3 id="讨论"><a href="#讨论" class="headerlink" title="讨论"></a>讨论</h3><ul>
<li>为啥一定要依次收集？如果不依次会怎么样</li>
<li><img src="/2020/05/06/%E5%88%86%E9%85%8D%E6%8E%92%E5%BA%8F/3.png" alt="示例"></li>
<li>因为在十位相同的数字，在它们个位排序的时候，桶标号较小的肯定要比桶标号大的要小，所以在收集生成序列的时候也要先于大的，这样在按照十位排序的时候小的先于大的入桶，达到排序目的</li>
<li>所以要用一个队列，先进先出，依次进行。可以采用队列保持桶中数据的进出顺序，从而保证排序结果的正确性。也就是说每一个桶内使用一个队列存储数据，可以使用顺序队列或者链式队列</li>
</ul>
<h3 id="算法复杂度分析"><a href="#算法复杂度分析" class="headerlink" title="算法复杂度分析"></a>算法复杂度分析</h3><ul>
<li>基数排序需要进行d次排序，每一次排序包含分配和收集两个操作，分配需要O(n)的时间，收集操作如果使用顺序队列也要O(n)的时间，如果使用链式队列则只需要将r个链队首尾相连即可，需要O(r)的时间，总的时间复杂度为O(d(n+r))</li>
<li>如果使用顺序队列，需要r个大小为n的队列，空间复杂度为O(rn)。如果使用链式队列，则需要额外的指针域，那么空间复杂度O(n+r)，比顺序队列的空间要少得多</li>
<li>基数排序时按关键字出现的顺序依次进行的，是<strong>稳定</strong>的排序方法</li>
<li>桶中的多个数据元素可以采用二维数组，链式存储，也可以采用一维辅助数组进行处理。</li>
</ul>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><h5 id="二维数组代码的实现"><a href="#二维数组代码的实现" class="headerlink" title="二维数组代码的实现"></a>二维数组代码的实现</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta"># <span class="meta-keyword">define</span> Maxsize 10000</span></span><br><span class="line"><span class="keyword">int</span> A[Maxsize];</span><br><span class="line"><span class="comment">//求出待排序序列中最大的元素位数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Maxbit</span><span class="params">(<span class="keyword">int</span> A[],<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> maxvalue = A[<span class="number">0</span>],digits = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(A[i]&gt;maxvalue)</span><br><span class="line">            maxvalue = A[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(maxvalue!= <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        digits++;</span><br><span class="line">        maxvalue/=<span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> digits;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 求xbit位上的数字，如238上的第2位上的数字是3</span></span><br><span class="line"><span class="comment">// bit = 1的时候，那么就是8</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Bitnumber</span><span class="params">(<span class="keyword">int</span> x,<span class="keyword">int</span> <span class="built_in">bit</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> temp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>;i&lt;<span class="built_in">bit</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        temp*=<span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> (x/temp)%<span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 算法函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">RadixSort</span><span class="params">(<span class="keyword">int</span> A[],<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i ,j,k,<span class="built_in">bit</span>,maxbit;</span><br><span class="line">    maxbit = Maxbit(A,n);</span><br><span class="line">    <span class="comment">//构造一个动态二位数组</span></span><br><span class="line">    <span class="keyword">int</span> **B= <span class="keyword">new</span> <span class="keyword">int</span> *[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>;i&lt;<span class="number">10</span>;i++)</span><br><span class="line">        B[i] = <span class="keyword">new</span> <span class="keyword">int</span>[n+<span class="number">1</span>];<span class="comment">//第0位存储元素个数</span></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>;i&lt;<span class="number">10</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        B[i][<span class="number">0</span>] = <span class="number">0</span>;<span class="comment">//先把元素个数默认为0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//这里开始进行分配收集操作，一共进行maxbit次</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">bit</span> = <span class="number">1</span>;<span class="built_in">bit</span>&lt;=maxbit;<span class="built_in">bit</span>++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//分配操作</span></span><br><span class="line">        <span class="keyword">for</span>(j = <span class="number">0</span>;j&lt;n;j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//取出位数</span></span><br><span class="line">            <span class="keyword">int</span> num = Bitnumber(A[j],<span class="built_in">bit</span>);</span><br><span class="line">            <span class="comment">//然后给A[j]分配桶内位置</span></span><br><span class="line">            <span class="keyword">int</span> index = ++B[num][<span class="number">0</span>];</span><br><span class="line">            <span class="comment">//存储</span></span><br><span class="line">            B[num][index] = A[j];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//收集操作，一共有10个桶，那么一一串连</span></span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>,j = <span class="number">0</span>;i&lt;<span class="number">10</span>;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(k=<span class="number">1</span>;k&lt;=B[i][<span class="number">0</span>];k++)</span><br><span class="line">                A[j++] = B[i][k];</span><br><span class="line">            <span class="comment">//更新原来序列，因为j一直在加，最后会把原来的序列全更新一遍</span></span><br><span class="line">            B[i][<span class="number">0</span>]=<span class="number">0</span>;<span class="comment">//收集完这个桶后元素置0</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//销毁数组</span></span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>;i&lt;<span class="number">10</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> []B[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">delete</span> B;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n ;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"请输入数列中的元素个数"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"请依次输入数列中的元素"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cin</span>&gt;&gt;A[i];</span><br><span class="line">    &#125;</span><br><span class="line">    RadixSort(A,n);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"基数排序的结果:"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;A[i]&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="一维数组实现"><a href="#一维数组实现" class="headerlink" title="一维数组实现"></a>一维数组实现</h5><ul>
<li>利用计数器数组计数</li>
<li>计数器累加</li>
<li>把数据反向遍历存储到临时数组中，这里如果用正向遍历，就不能正确输入数据了，在每次输入的时候，计数器相应元素-1，这样能实现巧妙地映射。最后会变成上一格的计数器的数字</li>
<li><img src="/2020/05/06/%E5%88%86%E9%85%8D%E6%8E%92%E5%BA%8F/4.png" alt="示例"></li>
<li>临时数组对原数组实现覆盖</li>
</ul>
<p>拿68，75，54，70，83，48，80，12，75*，92举例</p>
<p>第一次循环</p>
<ul>
<li>先计数</li>
<li><img src="/2020/05/06/%E5%88%86%E9%85%8D%E6%8E%92%E5%BA%8F/7.png" alt="示例"></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>0</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>count数组累加<br>| 0    | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 8    | 9    |<br>| —— | —— | —— | —— | —— | —— | —— | —— | —— | —— |<br>| 2    | 2    | 3    | 5    | 6    | 8    | 8    | 8    | 10   | 10   |</li>
<li>68，75，54，70，83，48，80，12，75*，92 反向遍历，放入temp数组</li>
<li>拿到92，个位数是2，那么看到2的count数组对应4，因为我们是从0开始计数的，所以92放到temp[3]中，同时count[2]—</li>
</ul>
<p>count</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr>
<td>2</td>
<td>2</td>
<td>3</td>
<td>5</td>
<td>6</td>
<td>8</td>
<td>8</td>
<td>8</td>
<td>10</td>
<td>10</td>
</tr>
</tbody>
</table>
</div>
<p>temp</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
<td>92</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>以此类推，那么最后的结果就是这样</li>
</ul>
<p>count</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>2</td>
<td>2</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td>8</td>
<td>8</td>
<td>8</td>
<td>10</td>
</tr>
</tbody>
</table>
</div>
<p>temp</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr>
<td>70</td>
<td>80</td>
<td>12</td>
<td>92</td>
<td>83</td>
<td>54</td>
<td>75</td>
<td>75*</td>
<td>68</td>
<td>48</td>
</tr>
</tbody>
</table>
</div>
<p>第二次循环<br> 70   ， 80   ， 12   ， 92   ， 83   ， 54   ， 75   ， 75*  ， 68   ， 48</p>
<ul>
<li>先计数</li>
<li><img src="/2020/05/06/%E5%88%86%E9%85%8D%E6%8E%92%E5%BA%8F/8.png" alt="示例"></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>3</td>
<td>2</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>count累加<br>| 0    | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 8    | 9    |<br>| —— | —— | —— | —— | —— | —— | —— | —— | —— | —— |<br>| 0    | 1    | 1    | 1    | 2   | 3   | 4    | 7    | 9    | 10    |</li>
<li>以此类推，那么最后的结果就是这样</li>
</ul>
<p>count</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>7</td>
<td>9</td>
</tr>
</tbody>
</table>
</div>
<p>temp</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr>
<td>12</td>
<td>48</td>
<td>54</td>
<td>68</td>
<td>70</td>
<td>75</td>
<td>75*</td>
<td>80</td>
<td>83</td>
<td>92</td>
</tr>
</tbody>
</table>
</div>
<p><img src="/2020/05/06/%E5%88%86%E9%85%8D%E6%8E%92%E5%BA%8F/2.gif" alt="示例" style="zoom:250%;"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">1000</span>;</span><br><span class="line"><span class="keyword">int</span> a[maxn],n;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">maxbit</span><span class="params">(<span class="keyword">int</span> data[], <span class="keyword">int</span> n)</span> <span class="comment">//辅助函数，求数据的最大位数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//扫描一遍就可以了，判断是不是比10，1000大</span></span><br><span class="line">    <span class="keyword">int</span> d=<span class="number">1</span>;<span class="comment">//统计最大的位数</span></span><br><span class="line">    <span class="keyword">int</span> p=<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">while</span>(data[i]&gt;=p)</span><br><span class="line">        &#123;</span><br><span class="line">            p*=<span class="number">10</span>;</span><br><span class="line">            ++d;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> d;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">radixsort</span><span class="params">(<span class="keyword">int</span> data[], <span class="keyword">int</span> n)</span> <span class="comment">//基数排序</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> d=maxbit(data,n); <span class="comment">//求最大位数</span></span><br><span class="line">    <span class="keyword">int</span> *tmp=<span class="keyword">new</span> <span class="keyword">int</span>[n]; <span class="comment">//辅助数组</span></span><br><span class="line">    <span class="keyword">int</span> *count=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>]; <span class="comment">//计数器</span></span><br><span class="line">    <span class="keyword">int</span> i,j,k;</span><br><span class="line">    <span class="keyword">int</span> radix=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">1</span>;i&lt;=d;i++) <span class="comment">//进行d次排序</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;<span class="number">10</span>;j++)</span><br><span class="line">            count[j]=<span class="number">0</span>; <span class="comment">//每次分配前清空计数器</span></span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;n;j++)</span><br><span class="line">        &#123;</span><br><span class="line">            k=(data[j]/radix)%<span class="number">10</span>; <span class="comment">//取出个位数，然后是十位数，...</span></span><br><span class="line">            count[k]++; <span class="comment">//统计每个桶中的记录数</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">1</span>;j&lt;<span class="number">10</span>;j++)</span><br><span class="line">            count[j]+=count[j<span class="number">-1</span>]; <span class="comment">//将tmp中的位置依次分配给每个桶</span></span><br><span class="line">        <span class="keyword">for</span>(j=n<span class="number">-1</span>;j&gt;=<span class="number">0</span>;j--) <span class="comment">//将所有桶中记录依次收集到tmp中</span></span><br><span class="line">        &#123;</span><br><span class="line">            k=(data[j]/radix)%<span class="number">10</span>;</span><br><span class="line">            tmp[--count[k]]=data[j];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;n;j++) <span class="comment">//将临时数组的内容复制到data中</span></span><br><span class="line">            data[j]=tmp[j];</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"第"</span>&lt;&lt;i&lt;&lt;<span class="string">"次排序结果："</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;data[i]&lt;&lt;<span class="string">"\t"</span>;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        radix=radix*<span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">delete</span>[]tmp;</span><br><span class="line">    <span class="keyword">delete</span>[]count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">        <span class="built_in">cin</span>&gt;&gt;a[i];</span><br><span class="line">    radixsort(a,n);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="加一段基数排序的gif，更容易理解"><a href="#加一段基数排序的gif，更容易理解" class="headerlink" title="加一段基数排序的gif，更容易理解"></a>加一段基数排序的gif，更容易理解</h3><p><img src="/2020/05/06/%E5%88%86%E9%85%8D%E6%8E%92%E5%BA%8F/1.gif" alt="示例"></p>
<p>视频来自可视化算法网站<a href="https://visualgo.net/zh" target="_blank" rel="noopener">https://visualgo.net/zh</a></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><img src="/2020/05/06/%E5%88%86%E9%85%8D%E6%8E%92%E5%BA%8F/6.png" alt="示例"></p>
<p><img src="/2020/05/06/%E5%88%86%E9%85%8D%E6%8E%92%E5%BA%8F/5.png" alt="示例"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">高等数学多元微积分总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-05 09:45:03" itemprop="dateCreated datePublished" datetime="2020-05-05T09:45:03+08:00">2020-05-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-08 20:45:26" itemprop="dateModified" datetime="2020-08-08T20:45:26+08:00">2020-08-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="高等数学多元微分总结"><a href="#高等数学多元微分总结" class="headerlink" title="高等数学多元微分总结"></a>高等数学多元微分总结</h1><h3 id="二元函数的极限"><a href="#二元函数的极限" class="headerlink" title="二元函数的极限"></a>二元函数的极限</h3><p>我们还是要去寻找无穷小代换。这里列出一二</p>
<p>$e^{xy}-1 \sim  xy((x,y)\rightarrow(0,0))$ </p>
<p>$tan xy\sim xy((x,y)\rightarrow(0,0))$</p>
<p>$1-cos(x) \sim \frac{1}{2}x^2$ </p>
<p>$sin(xy)\sim xy$ </p>
<h3 id="全微分"><a href="#全微分" class="headerlink" title="全微分"></a>全微分</h3><p>全微分：$dz = \frac{\partial z}{\partial z}dx+\frac{\partial z}{\partial y}dy$ </p>
<p>全增量： $\Delta z =  f(x+Δx,y+Δy)−f(x,y)$ </p>
<h3 id="（偏）导数，连续函数，全微分之间的关系"><a href="#（偏）导数，连续函数，全微分之间的关系" class="headerlink" title="（偏）导数，连续函数，全微分之间的关系"></a>（偏）导数，连续函数，全微分之间的关系</h3><p><img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/1.png" alt="示例"></p>
<h4 id="证明"><a href="#证明" class="headerlink" title="证明"></a>证明</h4><h5 id="函数的连续证明："><a href="#函数的连续证明：" class="headerlink" title="函数的连续证明："></a>函数的连续证明：</h5><ol>
<li>$f(x)$在$x_0$处有定义​</li>
<li>极限$\lim\limits_{x\rightarrow x_0}f(x)$存在</li>
<li>$\lim\limits_{x\rightarrow x_0}f(x)=f(x_0)$</li>
</ol>
<p>三个条件都满足的时候，说明函数连续</p>
<p>偏导数连续是什么意思？</p>
<p>先用定义求出该点的偏导数值c,再用求导公式求出不在该点时的偏导数$f<em>x(x,y)$,最后求$f_x(x,y)$当(x,y)趋于$(x_0,y_0)$点时的极限,如果$\lim\limits</em>{x,y\rightarrow x_0,y_0}(x,y)=c$,即偏导数连续,否则不连续.</p>
<h5 id="偏-导数存在的证明"><a href="#偏-导数存在的证明" class="headerlink" title="(偏)导数存在的证明"></a>(偏)导数存在的证明</h5><p>初等函数都是可导的，导数在$x_0$处的定义如下</p>
<p>$f^{‘}(x<em>0)=\frac{\lim\limits</em>{Δx→0}f(x_0+Δx)−f(x_0)}{Δx}$</p>
<p>那么以此类推，偏导数的定义就可以给出了</p>
<ul>
<li><p>在$(x_0,y_0)$这个点的偏导数定义</p>
<p>$f<em>x(x_0,y_0)=\frac{\lim\limits</em>{Δx→0}f(x_0+Δx,y_0)−f(x_0,y_0)}{Δx}$</p>
</li>
</ul>
<p>如果上面的式子存在，那么说明关于x的偏导数存在。否则就不存在</p>
<p><strong>偏导数存在并不能证明函数可微分，和函数可导一样</strong></p>
<h5 id="函数可微的判断"><a href="#函数可微的判断" class="headerlink" title="函数可微的判断"></a>函数可微的判断</h5><p>$ρ=\sqrt{Δx^2+Δy^2}$</p>
<p>判断 $Δz−AΔx−BΔy=o(ρ)$</p>
<p>即$\lim\limits_{Δx→0,Δy→0}\frac{f(x+Δx,y+Δy)−f(x,y)−\frac{∂z}{∂x}Δx−\frac{∂z}{∂y}Δy}ρ=0$</p>
<ul>
<li>当函数可微，全微分自然存在</li>
</ul>
<p>$dz=AΔx+BΔy+o(ρ)$</p>
<p>如果可微，则$A=\frac{∂z}{∂x}$,$B=\frac{∂z}{∂y}$</p>
<h3 id="多元复合函数求导的注意点"><a href="#多元复合函数求导的注意点" class="headerlink" title="多元复合函数求导的注意点"></a>多元复合函数求导的注意点</h3><ul>
<li>当出现二阶甚至高阶偏导数的时候，我们会感到异常头疼 ，时常漏乘或者漏考虑一些状况，对此我有两点要说</li>
<li>一：在求二阶偏导数时，先求一次导数项，再求二次导数项</li>
<li>二:  再求二阶偏导数的时候，原来的系数放左边，导数符号放中间，新导出的系数放右边</li>
</ul>
<p>求偏导结束的时候，我们还可以自己做一遍检查，主要检查有没有一次导函数，两次导函数($f<em>{11},f</em>{22},f<em>{12}$)等等，$f</em>{12}$前后保持一致，所以是双倍。</p>
<ul>
<li>多元复合函数常常会考一些证明题</li>
<li><img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/2.png" alt="示例" style="zoom:150%;"></li>
<li>证明题不难，只要把能化开的全部展开，再合并同类项就行，但是要细，要慢</li>
</ul>
<h3 id="隐函数求导"><a href="#隐函数求导" class="headerlink" title="隐函数求导"></a>隐函数求导</h3><h4 id="当目标函数为F-x-y-z-0时"><a href="#当目标函数为F-x-y-z-0时" class="headerlink" title="当目标函数为F(x,y,z)=0时"></a>当目标函数为F(x,y,z)=0时</h4><h5 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h5><p>$\frac{∂y}{∂x}=−\frac{F_x}{F_y}$</p>
<p>以此类推</p>
<p>在做题的时候不要囫囵吞枣，要细嚼慢咽</p>
<ul>
<li>先求出Fx,Fy</li>
<li>再写上当Fy 不为0 的时候，成立，这样更严谨</li>
<li>最后根据公式计算</li>
</ul>
<h5 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h5><p>对两边求全微分,对dz,dx,dy全部求偏导</p>
<p>获得 $Adz=Bdx+Cdy$</p>
<p>那么 $\frac{dz}{dx} = \frac{B}{A},\frac{dz}{dy} = \frac{C}{A}$</p>
<ul>
<li>注意，在求隐函数二阶偏导的时候，比较复杂。下面是一个例子</li>
</ul>
<p><img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/3.png" alt="示例"></p>
<p>我们看到在虽然表面上没有x，但是z包含了x，所以对z求导以后还要乘上偏导$\frac{dz}{dx}$并展开</p>
<h5 id="方法三"><a href="#方法三" class="headerlink" title="方法三"></a>方法三</h5><p>方程两边同时对某个量求偏导数。比如对于 $\frac{\partial  z}{\partial x}$ 那就等式两边同时对x求偏导数。对$\frac{\partial  z}{\partial y}$ 则同时对y求偏导数。然后合并同类项。把$\frac{\partial  z}{\partial x}$ 放在一起，即可获得答案。</p>
<p>例题：</p>
<p>$x+2y+z-2\sqrt{xyz}$ 求 $\frac{\partial  z}{\partial x}$ </p>
<p>在所给方程两端对x求偏导数，并注意 $z = z(x,y)$ 得到 $1+\frac{\partial  z}{\partial x}-\frac{1}{\sqrt{xyz}}(yz+xy\frac{\partial  z}{\partial x}) = 0$  </p>
<p>当 $1-\frac{xy}{\sqrt{xyz}}\neq 0$ 时，解得 $\frac{\partial  z}{\partial x} = \frac{yz-\sqrt{xyz}}{\sqrt{xyz}-xy }$ </p>
<h4 id="当目标函数为方程组，但不是隐函数时"><a href="#当目标函数为方程组，但不是隐函数时" class="headerlink" title="当目标函数为方程组，但不是隐函数时"></a>当目标函数为方程组，但不是隐函数时</h4><ul>
<li>利用线性代数中的克莱默法则求解</li>
<li>克莱默法则，就是把x1，x2….放在左边，常数项放到右边</li>
<li>先求出D，D就是左边未知数的系数组成的行列式。当D=0的时候，只有唯一解，D不等于0的时候，有多解</li>
<li>一次求出D1，D2…D1行列式就是x1的系数替换成右边的常数，以此类推</li>
<li>最后 $x_1=\frac{D1}{D},x_2=\frac{D2}{D}…..$</li>
</ul>
<p><img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/4.png" alt="示例" style="zoom:150%;"></p>
<p>我们可以拿第一个方程组为例</p>
<ol>
<li>因为要求$\frac{dy}{dx},\frac{dz}{dx}$所以我们知道要两边关于x求导才能出这两个未知数</li>
<li>然后整理过后得到了<img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/5.png" alt="示例"></li>
<li>求出它的系数行列式，也就是<script type="math/tex">\begin{bmatrix} 2y&-1 \\ 2y&3z \end{bmatrix}</script></li>
<li>依次求出D1,D2，对应$\frac{dy}{dx},\frac{dz}{dx}$</li>
<li>D1= <script type="math/tex">\begin{bmatrix} -2x&-1 \\ -x&3z \end{bmatrix}</script> D2 = <script type="math/tex">\begin{bmatrix} 2y&-2x \\ 2y&-x \end{bmatrix}</script></li>
<li>相除即得我们要的结果</li>
</ol>
<ul>
<li>请读者自证第二小题</li>
</ul>
<h4 id="当目标函数为D-left-begin-aligned-F-x-y-u-v-0-G-x-y-u-v-0-end-aligned-right-时"><a href="#当目标函数为D-left-begin-aligned-F-x-y-u-v-0-G-x-y-u-v-0-end-aligned-right-时" class="headerlink" title="当目标函数为D:\left\{ \begin{aligned} F(x,y,u,v)=0 \\G(x,y,u,v)=0 \end{aligned} \right. 时"></a>当目标函数为<script type="math/tex">D:\left\{ \begin{aligned} F(x,y,u,v)=0 \\G(x,y,u,v)=0 \end{aligned} \right.</script> 时</h4><ul>
<li><p>利用两边对x求导，像上面那种方法做</p>
</li>
<li><p>利用雅可比行列式，本质上还是克莱默行列式的变形</p>
<ul>
<li>首先求出行列式  J  <img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/9.png" alt="示例"></li>
<li>其次开始替换，要求$\frac{du}{dx}$ 那么把u的位置替换成x求行列式的值，要求$\frac{du}{dy}$ 那么就把u的位置换成y，然后乘以 -1 / J</li>
<li>如图 <img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/10.png" alt="示例"></li>
<li>此外，对于$\frac{dv}{dx},\frac{dv}{dy}$也是一样的道理</li>
<li>所以为了方便起见，我们需要先对方程组<script type="math/tex">D:\left\{ \begin{aligned} F(x,y,u,v)=0 \\G(x,y,u,v)=0 \end{aligned} \right.</script> 做一个拆分，分别求出$F_x,F_y,F_u,F_v,G_x,G_y,G_u,G_v$排列整齐就可以一目了然</li>
</ul>
</li>
</ul>
<p><img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/6.png" alt="示例"></p>
<p>拿第一个方程组举例</p>
<ol>
<li>此方程组可以确定两个二元隐函数 u= u( x , y );v=v( x , y )</li>
<li>要求$\frac{du}{dx},\frac{dv}{dx}$ 所以我们先要对两端关于x求偏导数</li>
<li>整理得到<img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/7.png" alt="示例"></li>
<li>解出D,D1,D2 那么就解出了最后的答案</li>
</ol>
<p>拿第二个方程组举例</p>
<ol>
<li>当然，这一题也可以向上面那样，两边先对x求导，根据D，D1，D2求解，但是比较繁琐。所以这里用雅可比行列式</li>
<li>首先把它们列成<script type="math/tex">D:\left\{ \begin{aligned} F(x,y,u,v)=0 \\G(x,y,u,v)=0 \end{aligned} \right.</script>的形式<img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/8.png" alt="示例"></li>
<li>然后，我们要求出<img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/11.png" alt="示例"></li>
<li>最后根据题目需求，求出J和一堆行列式<img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/12.png" alt="示例"></li>
</ol>
<h3 id="多元函数的几何应用"><a href="#多元函数的几何应用" class="headerlink" title="多元函数的几何应用"></a>多元函数的几何应用</h3><h4 id="一元向量值函数及其导数"><a href="#一元向量值函数及其导数" class="headerlink" title="一元向量值函数及其导数"></a>一元向量值函数及其导数</h4><p><img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/23.png" alt="示例"></p>
<p><img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/24.png" alt="示例"></p>
<h4 id="空间间曲线的切线与法平面"><a href="#空间间曲线的切线与法平面" class="headerlink" title="空间间曲线的切线与法平面"></a>空间间曲线的切线与法平面</h4><h5 id="当曲线为向量形式-Gamma-x-varphi-t-y-psi-t-z-omega-t-t-in-a-b-的时候"><a href="#当曲线为向量形式-Gamma-x-varphi-t-y-psi-t-z-omega-t-t-in-a-b-的时候" class="headerlink" title="当曲线为向量形式$\Gamma: x = \varphi(t) ,y = \psi(t),z=\omega(t),t\in [a,b]$的时候"></a>当曲线为向量形式$\Gamma: x = \varphi(t) ,y = \psi(t),z=\omega(t),t\in [a,b]$的时候</h5><p>根据一元向量值函数的结论，我们知道切向量就是在该点的导数</p>
<p>$\vec{f^{‘}(t)} = (\varphi^{‘}(t),\psi^{‘}(t),\omega^{‘}(t))$</p>
<p>又因为法平面的法向量和该点的切向量平行，那么我们就知道了两者形态是一样的</p>
<p>利用点向量式建立切线方程，利用点法式建立曲线的法平面方程如下</p>
<p><img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/14.png" alt="示例"></p>
<p><strong>那么如果是光滑曲线 </strong>$\Gamma: y = \psi(x),z=\omega(x)$呢？</p>
<p>我们把曲线看成 $\Gamma:x=x,y = \psi(x),z=\omega(x)$</p>
<p>然后按照上面的方法可得</p>
<p>$\vec{f^{‘}(t)} = (1,\psi^{‘}(x),\omega^{‘}(x))$ </p>
<p>那么出现$y^2 = 2mx,z^2 = m-x $在点$(x_0,y_0,z_0)$处的切线及法平面方程这种题目怎么解决呢？用全微分的方法来做。</p>
<p>$\vec{T} = (1,\frac{dy}{dx}|_M,\frac{dz}{dx}|_M)$ </p>
<h5 id="当曲线为一般形式的时候-Gamma-left-begin-aligned-F-x-y-z-0-G-x-y-z-0-end-aligned-right-的时候"><a href="#当曲线为一般形式的时候-Gamma-left-begin-aligned-F-x-y-z-0-G-x-y-z-0-end-aligned-right-的时候" class="headerlink" title="当曲线为一般形式的时候\Gamma:\left\{ \begin{aligned} F(x,y,z)=0 \\G(x,y,z)=0 \end{aligned} \right.的时候"></a>当曲线为一般形式的时候<script type="math/tex">\Gamma:\left\{ \begin{aligned} F(x,y,z)=0 \\G(x,y,z)=0 \end{aligned} \right.</script>的时候</h5><p>在点$M(x_0,y_0,z_0)$处的切向量为，记住后面那个</p>
<p> $\vec T= J(1,\frac{1}{J}\frac{∂(F,G)}{∂(z,x)}∣_M,\frac{1}{J}\frac{∂(F,G)}{∂(x,y)}∣_M)=(\frac{∂(F,G)}{∂(y,z)}|_M,\frac{∂(F,G)}{∂(z,x)}∣_M,\frac{∂(F,G)}{∂(x,y)}|_M)$</p>
<p>这是记忆方法，如果求x处的坐标，那么就转两位 <img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/18.png" alt="示例"></p>
<p>所以根据切向量，可以得到斜线方程和法平面方程</p>
<p><img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/17.png" alt="示例"></p>
<p><strong>两者可以用全微分的方法来做，也可以得到切向量</strong></p>
<p>具体的做法，和隐函数求导一样，两边对x求导，然后根据D，D1，D2解出$\frac{dy}{dx},\frac{dz}{dx}$ 切向量$\vec{T} = (1,\frac{dy}{dx}|_M,\frac{dz}{dx}|_M)$ </p>
<h4 id="曲面的切平面与法线"><a href="#曲面的切平面与法线" class="headerlink" title="曲面的切平面与法线"></a>曲面的切平面与法线</h4><p>曲面$\Sigma$在点M在的法向量，就是法线的线向量和切平面的法向量</p>
<p>求x处法向量，就是曲面$\Sigma$对x的偏导，以此类推</p>
<p>$\vec n = (F_x(x_0,y_0,z_0),F_y(x_0,y_0,z_0),F_z(x_0,y_0,z_0))$</p>
<p>于是可以求出法线方程和切平面方程</p>
<p><img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/21.png" alt="示例"></p>
<h4 id="几何问题中的几类题"><a href="#几何问题中的几类题" class="headerlink" title="几何问题中的几类题"></a>几何问题中的几类题</h4><ul>
<li>归根到底就是1.找出法向量 2.找向量之间的关系</li>
</ul>
<ol>
<li>告诉你曲线方程，让你求某点的切线和法平面<ol>
<li>$\vec{f^{‘}(t)} = (\varphi^{‘}(t),\psi^{‘}(t),\omega^{‘}(t))$或者$\vec{T} = (1,\frac{dy}{dx}|_M,\frac{dz}{dx}|_M)$ </li>
</ol>
</li>
<li>告诉你曲面方程，让你求某点的切平面和法线<ol>
<li>$\vec n = (F_x(x_0,y_0,z_0),F_y(x_0,y_0,z_0),F_z(x_0,y_0,z_0))$</li>
</ol>
</li>
<li>告诉你曲面方程，让你求某点的切平面与某个面的夹角的余弦值<ol>
<li>找到曲面在该点的法向量</li>
<li>找到某个面的法向量</li>
<li>求这两个法向量的余弦值，就是我们所要的余弦值</li>
</ol>
</li>
<li>让你求一条曲线上平行于某平面的切线，求出该点和该线<ol>
<li>找到曲线一般的切向量</li>
<li>通过该向量*某平面的法向量 = 0 构造方程</li>
<li>解出该方程或者拿到变量之间的关系，回代曲线方程求解</li>
</ol>
</li>
<li>让你求一条曲线上平行于某平面的法平面，求出该点和该面<ol>
<li>找到曲线的一般切向量，也就是该点出法平面的法向量</li>
<li>该切向量和目标平面的法向量平行，得到一个方程</li>
<li>解方程或者回代</li>
</ol>
</li>
<li>让你求一个曲面上平行于某平面的切平面，求出该点和该面<ol>
<li>找到曲面的一般法向量，那么这个就是切平面的法向量</li>
<li>该法向量与目标平面的法向量平行，得到方程</li>
<li>解方程或者回代</li>
</ol>
</li>
<li>让你求一个曲面上平行于某平面的法线，求出该点和该面<ol>
<li>找到曲面的一般法向量，那么这个就是切线的向量</li>
<li>该向量与目标平面的法向量垂直，得到方程</li>
<li>解方程或者回代</li>
</ol>
</li>
<li>或者和某直线平行或者垂直，归根到底就是找向量之间的关系</li>
</ol>
<h3 id="方向导数与梯度"><a href="#方向导数与梯度" class="headerlink" title="方向导数与梯度"></a>方向导数与梯度</h3><h4 id="方向导数"><a href="#方向导数" class="headerlink" title="方向导数"></a>方向导数</h4><ul>
<li>对于三元函数，如果在点P(x,y,z)处可微，则函数在该店沿任意方向l的方向导数都存在</li>
<li>$\frac{∂f}{∂l}=\frac{∂f}{∂x}\cos\alpha+\frac{∂f}{∂y}\cos\beta+\frac{∂f}{∂z}\cos\gamma$</li>
<li>对于二元函数，在点P(x,y)处沿方向l 的方向导数是</li>
<li>$\frac{∂f}{∂l}=\frac{∂f}{∂x}\cos\alpha+\frac{∂f}{∂y}\cos\beta$</li>
<li>特别的：当l与x轴同向有 $\frac{∂f}{∂l}=\frac{∂f}{∂x}$ </li>
<li>当l与x轴反向向有 $\frac{∂f}{∂l}=-\frac{∂f}{∂x}$ </li>
<li>外法线是正的，内法线为负</li>
</ul>
<h5 id="题形"><a href="#题形" class="headerlink" title="题形"></a>题形</h5><ul>
<li><p>给你一个函数，让你求在某点沿着一个向量的方向导数</p>
<ul>
<li>先计算 向量的方向余弦</li>
<li>把方向余弦分别乘以函数对x,y,z的偏导数</li>
<li>把P点带入后相加</li>
</ul>
</li>
<li><p>给你一个函数，让你求在某点沿着某一条曲线朝着某个方向增大的方向导数</p>
<ul>
<li>先计算某条曲线在该点处的方向向量</li>
<li>计算该方向向量的方向余弦</li>
<li>方向余弦与偏导对应相乘</li>
<li>把P点带入后相加</li>
</ul>
</li>
<li><p>总之，计算方向导数的题目，我们要找到三个信息</p>
<ul>
<li><ol>
<li>就是方向向量，依次求出方向余弦</li>
<li>找到目标函数，对变量求偏导</li>
<li>找到该点，带入</li>
</ol>
</li>
</ul>
</li>
<li><p>计算时要规范，否则容易代入时出错：</p>
<ul>
<li>$\frac{\partial u}{\partial x}= \cdots ,\frac{\partial u}{\partial y} = \cdots,\frac{\partial u}{\partial z}=\cdots$</li>
<li>$\dfrac{\partial u}{\partial x}|<em>{( x_0,y_0,z_0)}=\cdots , \dfrac{\partial u}{\partial y}|</em>{( x<em>0,y_0,z_0)}=\cdots , \dfrac{\partial u}{\partial z}|</em>{( x_0,y_0,z_0)}=\cdots$ </li>
<li>$e_1$代表方向向量，$|e_1| = 1，\Rightarrow e_1 =(cos\alpha,cos\beta,cos\gamma)$  </li>
<li>所以:$\frac{\partial u}{\partial l}|_{(x_0,y_0,z_0)} =  \frac{∂f}{∂x}\cos\alpha+\frac{∂f}{∂y}\cos\beta+\frac{∂f}{∂z}\cos\gamma = \cdots$ </li>
</ul>
</li>
</ul>
<h4 id="梯度"><a href="#梯度" class="headerlink" title="梯度"></a>梯度</h4><p><img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/26.png" alt="示例"></p>
<p>那么，向量$\vec G$被称为函数 f(P)在P处的梯度，记作grad f(P)  </p>
<p>$gradf(P) = \nabla f(P) = (f_x(P),f_y(P),f_z(P))$</p>
<p>当函数为二元函数f(x,y)在 P（x,y) 处的梯度</p>
<p>$grad f(P) = \nabla f(P) = (f_x(P),f_y(P))$</p>
<h5 id="几何意义"><a href="#几何意义" class="headerlink" title="几何意义"></a>几何意义</h5><p>函数在同一点的梯度垂直于该点的等值线，指向函数增大的方向</p>
<h5 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h5><ol>
<li>方向： f变化率最快的方向</li>
<li>模： f的最大变化率的值</li>
</ol>
<h5 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h5><p>所以，函数的方向导数为梯度在该方向上的投影：</p>
<p>$\frac{∂f}{∂l} = grad f\cdot\vec {e_l}$</p>
<p><img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/28.png" alt="示例"></p>
<h5 id="运算"><a href="#运算" class="headerlink" title="运算"></a>运算</h5><p><img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/27.png" alt="示例"></p>
<h5 id="题形-1"><a href="#题形-1" class="headerlink" title="题形"></a>题形</h5><ul>
<li>给你一个函数，要你求出在某点沿增加最快方向的方向导数<ul>
<li>最快方向就是该点的梯度向量</li>
<li>此时方向导数就是该向量的模</li>
<li>特别要注意的是，要你求梯度，求的是一个向量而不是一个模</li>
</ul>
</li>
<li>值得注意的是，变化最快包含了<strong>增加最快</strong>和<strong>减少最快</strong>，但是我们常常忽略负的那个在答题的时候一定要全写</li>
</ul>
<h4 id="物理意义"><a href="#物理意义" class="headerlink" title="物理意义"></a>物理意义</h4><h3 id="多元函数的极值"><a href="#多元函数的极值" class="headerlink" title="多元函数的极值"></a>多元函数的极值</h3><h4 id="多元函数的极值-1"><a href="#多元函数的极值-1" class="headerlink" title="多元函数的极值"></a>多元函数的极值</h4><ul>
<li>必要条件： 函数 z = f(x,y) 在点$(x_0,y_0)$存在偏导数，且在该点取极值那么我们一定可以得到 $f^{‘}_x(x_0,y_0)= 0,f^{‘}_y(x_0,y_0)= 0$<ul>
<li>需要注意的是， 让偏导数都为0的点被称为驻点，但是驻点不一定是极值点</li>
<li>如 z = xy 有驻点（0，0）但是（0，0) 不是一个极值点</li>
</ul>
</li>
<li>充分条件: 如果函数z =f(x,y)在点$(x<em>0,y_0)$的某个邻域内具有一阶和二阶连续偏导数，且$f^{‘}_x(x_0,y_0)= 0,f^{‘}_y(x_0,y_0)= 0$ 那么，我们再进一步令$A = f</em>{xx}(x<em>0,y_0),B = f</em>{xy}(x<em>0,y_0),C = f</em>{yy}(x_0,y_0)$<ul>
<li>当 $AC-B^2&gt;0$时，具有极值<script type="math/tex">D:\left\{ \begin{aligned} A<0  时取极大值 \\A>0  时取极小值 \end{aligned} \right.</script></li>
<li>当$AC-B^2&lt;0$时，没有极值</li>
<li>当$AC-B^2=0$时，不能确定，需要另行讨论</li>
</ul>
</li>
</ul>
<h5 id="题型"><a href="#题型" class="headerlink" title="题型"></a>题型</h5><ul>
<li>这类考察基本概念和定义</li>
</ul>
<p><img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/29.png" alt="示例"></p>
<ul>
<li>求函数 f(x,y)的极值<ul>
<li>先求出驻点</li>
<li>求出二阶偏导数</li>
<li>判断驻点是否符合极值点条件</li>
</ul>
</li>
</ul>
<h4 id="最值应用问题"><a href="#最值应用问题" class="headerlink" title="最值应用问题"></a>最值应用问题</h4><h4 id="条件极值"><a href="#条件极值" class="headerlink" title="条件极值"></a>条件极值</h4><ul>
<li>对自变量除了定义域的限制之外，还有其它条件的限制</li>
</ul>
<h5 id="方法1：代入法"><a href="#方法1：代入法" class="headerlink" title="方法1：代入法"></a>方法1：代入法</h5><p>在条件$\varphi(x,y) = 0$下，求出z = f(x,y)的极值 </p>
<ul>
<li>先从条件$\varphi(x,y) = 0$中解处 $y = \psi(x)$</li>
<li>带入函数z = f(x,y)当中</li>
<li>解决一元函数 $z = f(x,\psi(x))$的无条件极值问题</li>
</ul>
<h5 id="方法2-拉格朗日乘数法"><a href="#方法2-拉格朗日乘数法" class="headerlink" title="方法2 : 拉格朗日乘数法"></a>方法2 : 拉格朗日乘数法</h5><p>在条件$\varphi(x,y) = 0$下，求出z = f(x,y)的极值 </p>
<p><img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/31.png" alt="示例"></p>
<p>所以极值点必然满足<script type="math/tex">D:\left\{ \begin{aligned} f_x+\lambda\varphi_x=0 \\f_y+\lambda\varphi_y=0 \\\varphi (x,y)= 0 \end{aligned} \right.</script></p>
<p>引入辅助函数 $F = f(x,y)+\lambda\varphi(x,y)$</p>
<p>那么极值点满足 <script type="math/tex">\left\{ \begin{aligned} F_x = f_x+\lambda\varphi_x=0 \\ F_y=f_y+\lambda\varphi_y=0 \\F_\lambda=\varphi (x,y)= 0 \end{aligned} \right.</script></p>
<p>可以看见下面的关系式就是上面的关系式，于是，辅助函数F的极值点就是 z = f(x,y)的极值点，辅助函数被称为拉格朗日函数。</p>
<p>然后。根据这几个方程找出可疑的极值点，再加以验证</p>
<ul>
<li>推广：<img src="/2020/05/05/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E5%A4%9A%E5%85%83%E5%BE%AE%E7%A7%AF%E5%88%86%E6%80%BB%E7%BB%93/30.png" alt="示例"></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/04/739%E6%AF%8F%E6%97%A5%E6%B8%A9%E5%BA%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/04/739%E6%AF%8F%E6%97%A5%E6%B8%A9%E5%BA%A6/" class="post-title-link" itemprop="url">739每日温度</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-04 13:58:44" itemprop="dateCreated datePublished" datetime="2020-05-04T13:58:44+08:00">2020-05-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-09 23:39:32" itemprop="dateModified" datetime="2020-05-09T23:39:32+08:00">2020-05-09</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="739每日温度"><a href="#739每日温度" class="headerlink" title="739每日温度"></a>739每日温度</h1><p><img src="/2020/05/04/739%E6%AF%8F%E6%97%A5%E6%B8%A9%E5%BA%A6/1.png" alt></p>
<h2 id="下面是给出的代码"><a href="#下面是给出的代码" class="headerlink" title="下面是给出的代码"></a>下面是给出的代码</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">dailyTemperatures</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; T)</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="我拿到必用BF"><a href="#我拿到必用BF" class="headerlink" title="我拿到必用BF"></a>我拿到必用BF</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">dailyTemperatures</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; T)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = T.<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;v(n,<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt;st;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">        &#123; </span><br><span class="line">            <span class="comment">//每次拿到一个i，往后遍历找到比它大的值，然后记录</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = i;j&lt;n;j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(T[j]&gt;T[i])</span><br><span class="line">                &#123;</span><br><span class="line">           		     v[i] = j-i;</span><br><span class="line">              		 <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">     <span class="keyword">return</span> v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<ul>
<li>但是很可惜，超出了时间限制</li>
</ul>
<h4 id="所以用递减栈来试试"><a href="#所以用递减栈来试试" class="headerlink" title="所以用递减栈来试试"></a>所以用递减栈来试试</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">dailyTemperatures</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; T)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = T.<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;v(n,<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt;s;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i= <span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//栈内存储的是序号，做差获得答案</span></span><br><span class="line">            <span class="keyword">while</span>(!s.empty()&amp;&amp;T[i]&gt;T[s.top()])</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">int</span> temp = s.top();</span><br><span class="line">                s.pop();</span><br><span class="line">                v[temp] = i-temp;</span><br><span class="line">            &#125;</span><br><span class="line">            s.push(i);</span><br><span class="line">        &#125;</span><br><span class="line">     <span class="keyword">return</span> v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/04/59-2%E9%98%9F%E5%88%97%E7%9A%84%E6%9C%80%E5%A4%A7%E5%80%BC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/04/59-2%E9%98%9F%E5%88%97%E7%9A%84%E6%9C%80%E5%A4%A7%E5%80%BC/" class="post-title-link" itemprop="url">59-2队列的最大值</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-04 12:38:39" itemprop="dateCreated datePublished" datetime="2020-05-04T12:38:39+08:00">2020-05-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-08 17:48:06" itemprop="dateModified" datetime="2020-05-08T17:48:06+08:00">2020-05-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="59-2队列的最大值"><a href="#59-2队列的最大值" class="headerlink" title="59-2队列的最大值"></a>59-2队列的最大值</h1><h2 id="下面是题目"><a href="#下面是题目" class="headerlink" title="下面是题目"></a>下面是题目</h2><p><img src="/2020/05/04/59-2%E9%98%9F%E5%88%97%E7%9A%84%E6%9C%80%E5%A4%A7%E5%80%BC/1.png" alt></p>
<h3 id="下面是题目给出的代码"><a href="#下面是题目给出的代码" class="headerlink" title="下面是题目给出的代码"></a>下面是题目给出的代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MaxQueue</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    MaxQueue() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">max_value</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push_back</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">pop_front</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="最简单的暴力搜索"><a href="#最简单的暴力搜索" class="headerlink" title="最简单的暴力搜索"></a>最简单的暴力搜索</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MaxQueue</span> &#123;</span></span><br><span class="line">    <span class="comment">//用数组模拟队列</span></span><br><span class="line">    <span class="keyword">int</span> q[<span class="number">20000</span>];</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">begin</span> = <span class="number">0</span>, <span class="built_in">end</span> = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    MaxQueue() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">max_value</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="built_in">begin</span>; i != <span class="built_in">end</span>; ++i)</span><br><span class="line">            ans = <span class="built_in">max</span>(ans, q[i]);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push_back</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        q[<span class="built_in">end</span>++] = value;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">pop_front</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">begin</span> == <span class="built_in">end</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> q[<span class="built_in">begin</span>++];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="与155-最小栈不同，我们如果要维护一个最大队列，很难用pair实现"><a href="#与155-最小栈不同，我们如果要维护一个最大队列，很难用pair实现" class="headerlink" title="与155 最小栈不同，我们如果要维护一个最大队列，很难用pair实现"></a>与155 最小栈不同，我们如果要维护一个最大队列，很难用pair实现</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MaxQueue</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    MaxQueue() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">max_value</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> que.empty()?<span class="number">-1</span>:dq.front();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push_back</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        que.push(value);</span><br><span class="line"><span class="comment">//更新deque双端队列，把比value小的全部pop，就是在queue队列中的第一大，第二大。。。</span></span><br><span class="line">        <span class="keyword">while</span>(!dq.empty()&amp;&amp;dq.back()&lt;value)</span><br><span class="line">            dq.pop_back();</span><br><span class="line">        dq.push_back(value);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">pop_front</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(que.empty())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">int</span> t=que.front();</span><br><span class="line">        que.pop();</span><br><span class="line"><span class="comment">//出队列的时候要判断一下是不是把当前的最大值给pop掉了，如果是，那么更新deque</span></span><br><span class="line">        <span class="keyword">if</span>(t==dq.front())</span><br><span class="line">            dq.pop_front();</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">    <span class="built_in">deque</span>&lt;<span class="keyword">int</span>&gt; dq;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/04/1410HTML%E5%AE%9E%E4%BD%93%E8%A7%A3%E6%9E%90%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/04/1410HTML%E5%AE%9E%E4%BD%93%E8%A7%A3%E6%9E%90%E5%99%A8/" class="post-title-link" itemprop="url">1410HTML实体解析器</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-04 10:20:37" itemprop="dateCreated datePublished" datetime="2020-05-04T10:20:37+08:00">2020-05-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-10 00:02:58" itemprop="dateModified" datetime="2020-05-10T00:02:58+08:00">2020-05-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1410HTML实体解析器"><a href="#1410HTML实体解析器" class="headerlink" title="1410HTML实体解析器"></a>1410HTML实体解析器</h1><h2 id="下面是题目"><a href="#下面是题目" class="headerlink" title="下面是题目"></a>下面是题目</h2><p><img src="/2020/05/04/1410HTML%E5%AE%9E%E4%BD%93%E8%A7%A3%E6%9E%90%E5%99%A8/1.png" alt></p>
<h3 id="下面是题目给出的代码"><a href="#下面是题目给出的代码" class="headerlink" title="下面是题目给出的代码"></a>下面是题目给出的代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">entityParser</span><span class="params">(<span class="built_in">string</span> <span class="built_in">text</span>)</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="我最先想到的就是图存储"><a href="#我最先想到的就是图存储" class="headerlink" title="我最先想到的就是图存储"></a>我最先想到的就是图存储</h4><ul>
<li>先把元素一一对应</li>
<li>然后遍历text字符串</li>
<li>如果正常，就直接加在答案上</li>
<li>如果出现了&amp;,那么把从&amp;开始到; 的字符串交给新的字符串</li>
<li>判断字符串是否在map中存储<ul>
<li>如果发现了，那么改成对应的符号</li>
<li>否则保持原样，加在答案上</li>
</ul>
</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">entityParser</span><span class="params">(<span class="built_in">string</span> <span class="built_in">text</span>)</span></span>&#123;</span><br><span class="line">    <span class="built_in">string</span> result=<span class="string">""</span>;</span><br><span class="line">    <span class="built_in">string</span> temp=<span class="string">""</span>;</span><br><span class="line">    <span class="built_in">unordered_map</span>&lt;<span class="built_in">string</span>,<span class="built_in">string</span>&gt;mp;</span><br><span class="line">    mp[<span class="string">"&amp;quot;"</span>]=<span class="string">"\""</span>;<span class="comment">//有个转移符号，很骚</span></span><br><span class="line">    mp[<span class="string">"&amp;apos;"</span>]=<span class="string">"'"</span>;</span><br><span class="line">    mp[<span class="string">"&amp;amp;"</span>]=<span class="string">"&amp;"</span>;</span><br><span class="line">    mp[<span class="string">"&amp;gt;"</span>]=<span class="string">"&gt;"</span>;</span><br><span class="line">    mp[<span class="string">"&amp;lt;"</span>]=<span class="string">"&lt;"</span>;</span><br><span class="line">    mp[<span class="string">"&amp;frasl;"</span>]=<span class="string">"/"</span>;</span><br><span class="line">    <span class="comment">//通过一个flag判断从&amp;开始到;结束中的字符串</span></span><br><span class="line">    <span class="keyword">bool</span> flag = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> c:<span class="built_in">text</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(!flag &amp;&amp; c!=<span class="string">'&amp;'</span>)</span><br><span class="line">            result += c ;</span><br><span class="line">        <span class="comment">//如果没到底，那么继续加</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(flag &amp;&amp; c!=<span class="string">';'</span>)</span><br><span class="line">            temp += c;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(c==<span class="string">'&amp;'</span>)</span><br><span class="line">            flag=<span class="literal">true</span>,temp+=c;</span><br><span class="line">        <span class="comment">//加到底了，进行一个判断</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(c==<span class="string">';'</span>&amp;&amp; flag) &#123;</span><br><span class="line">            temp += c;</span><br><span class="line">            <span class="keyword">if</span> (mp.<span class="built_in">find</span>(temp) != mp.<span class="built_in">end</span>())</span><br><span class="line">                result += mp[temp];</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                result += temp;</span><br><span class="line">            flag = <span class="literal">false</span>;</span><br><span class="line">            temp = <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/" class="post-title-link" itemprop="url">高等数学重积分</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-01 17:07:05" itemprop="dateCreated datePublished" datetime="2020-05-01T17:07:05+08:00">2020-05-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-08 13:28:30" itemprop="dateModified" datetime="2020-09-08T13:28:30+08:00">2020-09-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="重积分"><a href="#重积分" class="headerlink" title="重积分"></a>重积分</h1><h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><ul>
<li>终于等到这一天了，想到几天之后就要quiz的我头皮发麻</li>
<li>本来的笔记再oneNote上，但都是图片之类的。。煞是难看</li>
<li>只保存一些图片根本起不到学习的效果</li>
<li>算了，还是手敲公式⑧</li>
<li>五一结束希望能够写完，只写最重要的公式和例子，废话少说</li>
</ul>
<h3 id="二重积分的计算"><a href="#二重积分的计算" class="headerlink" title="二重积分的计算"></a>二重积分的计算</h3><h4 id="利用直角坐标计算二重积分"><a href="#利用直角坐标计算二重积分" class="headerlink" title="利用直角坐标计算二重积分"></a>利用直角坐标计算二重积分</h4><h5 id="当被积函数-f-x-y-geq0-​且在D上连续时，若D为X型区域"><a href="#当被积函数-f-x-y-geq0-​且在D上连续时，若D为X型区域" class="headerlink" title="当被积函数$f(x,y)\geq0$​且在D上连续时，若D为X型区域"></a><strong>当被积函数$f(x,y)\geq0$​且在D上连续时，若D为X型区域</strong></h5><p>$ D:\left{ \begin{aligned} \varphi_1(x)\leq y\leq \varphi_2(x)\a\leq x\leq b \end{aligned} \right. $ </p>
<p><img src="/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/1.png" alt="示例" style="zoom:150%;"></p>
<p>则</p>
<p> $\iint<em>D f(x,y)dxdy = \int_a^bdx \int</em>{\varphi_1(x)}^{\varphi_2(x)}f(x,y)dy$</p>
<h5 id="若D-为Y-形区域"><a href="#若D-为Y-形区域" class="headerlink" title="若D 为Y-形区域"></a><strong>若D 为Y-形区域</strong></h5><script type="math/tex; mode=display">D:\left\{ \begin{aligned} \psi_1(x)\leq x\leq \psi_2(x)\\c\leq y\leq d \end{aligned} \right.</script><p>则</p>
<p> $\iint<em>D f(x,y)dxdy = \int_c^ddy \int</em>{\psi_1(x)}^{\psi_2(x)}f(x,y)dx$\</p>
<h4 id="利用极坐标计算二重积分"><a href="#利用极坐标计算二重积分" class="headerlink" title="利用极坐标计算二重积分"></a>利用极坐标计算二重积分</h4><p>用 $ x = rcos\theta和y =r\sin\theta$ 带入原方程 </p>
<script type="math/tex; mode=display">D:\left\{ \begin{aligned} \varphi_1(\theta)\leq r\leq \varphi_2(\theta)\\\alpha\leq \theta\leq \beta \end{aligned} \right.</script><p>则</p>
<p> $\iint<em>D f(rcos\theta,rsin\theta)rdrd\theta = \int</em>\alpha^\beta d\theta \int_{\varphi_1(\theta)}^{\varphi_2(\theta)}f(rcos\theta,rsin\theta)rdr$</p>
<p>特别的，对D：<script type="math/tex">D:\left\{ \begin{aligned} 0\leq r\leq \varphi(\theta)\\0\leq \theta\leq 2\pi \end{aligned} \right.</script> </p>
<p>$\iint_D f(rcos\theta,rsin\theta)rdrd\theta = \int_0^{2\pi} d\theta \int_0^{\varphi(\theta)}f(rcos\theta,rsin\theta)rdr$</p>
<h4 id="交换积分次序"><a href="#交换积分次序" class="headerlink" title="交换积分次序"></a>交换积分次序</h4><ul>
<li>有些积分是超越函数，并没有对应的原函数 。这是交换积分次序显得额外重要！</li>
</ul>
<p>$\int<em>1^3dx\int</em>{x-1}^2 \sin y^2 dy$</p>
<p>交换机分次序的方法：<strong>先画出积分域</strong>，然后根据区域的形状来交换.有时交换积分域后编程了分段积分。这时候就更加依赖画图了。</p>
<p>交换 $\int<em>0^\pi dx\int</em>{-sin\frac{x}{2}}^{sinx}f(x,y)dy$ 的积分区域</p>
<p>画图得出区域需要分为 $D_1\cup D_2$,其中 </p>
<p>$D_1 = {(x,y)|arcsin(y)\leq x\leq\pi-arcsin(y),0\leq y\leq 1}$ </p>
<p>$D_2 = {(x,y)|-2arcsin(y)\leq x\leq\pi,-1\leq y\leq 0}$</p>
<p>所以 原式：$\int<em>{0}^1dy\int</em>{arcsin(y)}^{\pi-arcsin(y)}f(x,y)dx+\int<em>{-1}^0dy\int</em>{-2arcsin(y)}^\pi f(x,y)dx$</p>
<h4 id="别忘了代换"><a href="#别忘了代换" class="headerlink" title="别忘了代换"></a>别忘了代换</h4><p><img src="/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/20.png" alt="示例" style="zoom:150%;"></p>
<h4 id="二重积分对称性的重要结论"><a href="#二重积分对称性的重要结论" class="headerlink" title="二重积分对称性的重要结论"></a>二重积分对称性的重要结论</h4><ol>
<li>若D关于y轴对称，那么<br>1） 当f(x,y) 在D上为x的奇函数，有 $I = 0$ ;<br>2)   当f(x,y) 在D上为x的偶函数，则有 $I = 2\iint_{D_1}f(x,y)d\sigma$,</li>
<li>若D关于x轴对称，那么<br>1） 当f(x,y) 在D上为x的奇函数，有 $I = 0$ ;<br>2)   当f(x,y) 在D上为x的偶函数，则有 $I = 2\iint_{D_1}f(x,y)d\sigma$,</li>
</ol>
<p>所以在展开的时候，我们先要把能化成0 的全部化成0，比如对于D为一个以原点为圆心的圆的时候，$\iint<em>{\Sigma} (x+y-2)^2dS$ , 我们就可以先把其展开成$\iint</em>\Sigma (x^2+y^2+4-4x-4y+2xy)~dS$ ,因为D关于x轴，y轴都对称。而 -4x，-4y，2xy都是关于x或y的基函数，所以他们的积分都是0，原式就可以简化为 $\iint_\Sigma(x^2+y^2+4)dS$ </p>
<h4 id="课本解答"><a href="#课本解答" class="headerlink" title="课本解答"></a>课本解答</h4><p><img src="/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/1.jpg" alt="示例"></p>
<p><img src="/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/2.jpg" alt="示例"></p>
<p><img src="/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/3.jpg" alt="示例"></p>
<p><img src="/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/4.jpg" alt="示例"></p>
<h3 id="三重积分的计算"><a href="#三重积分的计算" class="headerlink" title="三重积分的计算"></a>三重积分的计算</h3><ul>
<li>先看看概念吧</li>
</ul>
<p><img src="/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/2.png" alt="示例"></p>
<h4 id="利用直角坐标计算三重积分"><a href="#利用直角坐标计算三重积分" class="headerlink" title="利用直角坐标计算三重积分"></a>利用直角坐标计算三重积分</h4><h5 id="投影法（“先1后2”）"><a href="#投影法（“先1后2”）" class="headerlink" title="投影法（“先1后2”）"></a>投影法（“先1后2”）</h5><p>$\Omega:\left{ \begin{aligned} z_1(x.y)\leq r\leq z_2(x,y)\0\leq \theta\leq 2\pi \end{aligned} \right.$</p>
<p><img src="/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/3.png" alt="示例"></p>
<p>那么细长柱体微元的质量为</p>
<p>$(\int_{z_1(z,y)}^{z_2(x,y)}f(x,y,z)dz)dxdy$</p>
<p>该物体的质量就是：</p>
<p>$\iiint<em>\Omega f(x,y,z)dv = \iint_D(\int</em>{z_1(z,y)}^{z_2(x,y)}f(x,y,z)dz)dxdy$</p>
<p>就等于 </p>
<p>$\iint<em>Ddxdy\int</em>{z_1(z,y)}^{z_2(x,y)}f(x,y,z)dz$</p>
<h5 id="截面法（“先2后1”）"><a href="#截面法（“先2后1”）" class="headerlink" title="截面法（“先2后1”）"></a>截面法（“先2后1”）</h5><p><img src="/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/4.png" alt="示例"></p>
<p>$\Omega:\left{ \begin{aligned}(x,y)\in D_z\0\leq \theta\leq 2\pi \end{aligned} \right.$</p>
<p>以$D_z $为底，dz为高的柱形薄片的质量为</p>
<p>$(\iint_{D_z}f(x,y,z)dxdy)dz$</p>
<p>那么该物体的质量就是</p>
<p>$\int<em>a^b(\iint</em>{D<em>z}f(x,y,z)dxdy)dz = \int_a^bdz\iint</em>{D_z}f(x,y,z)dxdy$</p>
<h5 id="三次积分法"><a href="#三次积分法" class="headerlink" title="三次积分法"></a>三次积分法</h5><p>区域 $\Omega:\left{ \begin{aligned} z_1(x.y)\leq z\leq z_2(x,y)\D:\left{ \begin{aligned}y_1(x)\leq y \leq y_2(x)\a\leq x\leq b \end{aligned} \right. \end{aligned} \right.$</p>
<p>利用投影法结果，把二重积分转化成二次积分得</p>
<p>$\iiint<em>\Omega f(x,y,z)dv = \int_a^bdx\int</em>{y<em>1(x)}^{y_2(x)}dy\int</em>{z_1(x,y)}^{z_2(x,y)}f(x,y,z)dz$</p>
<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><p><img src="/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/5.png" alt="示例"></p>
<p>如果已经知道区域在平面上的投影，那么先一后二或者先二后一的方法更加方便。</p>
<p>比如求上下分别为球面$x^2+y^2+z^2=2$ 和抛物面 $z=x^2+y^2$ 所围的立体的体积。我们就可以用 $V=\iint dxdy\int_{x^2+y^2}^{\sqrt{2-x^2-y^2}}dz $ </p>
<h4 id="利用柱坐标计算三重积分"><a href="#利用柱坐标计算三重积分" class="headerlink" title="利用柱坐标计算三重积分"></a>利用柱坐标计算三重积分</h4><p><img src="/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/6.png" alt="示例"></p>
<p>在柱面坐标系中得体积元素为</p>
<p><img src="/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/7.png" alt="示例"></p>
<p>$dv = \rho d\rho d\theta dz $</p>
<p>因此 $\iiint<em>\Omega f(x,y,z)dxdydz =\iiint</em>\Omega F(\rho,\theta,z)\rho d\rho d\theta dz$</p>
<p><strong>$\theta$摆在前，r摆中间, z 摆最后面</strong></p>
<p>其中，$F(\rho,\theta,z)=f(\rho cos\theta ,\rho sin\theta,z)$</p>
<p>适用范围</p>
<ul>
<li>积分域表面用柱面坐标表示时方程简单</li>
<li>被积函数用柱面坐标表示时变量相互分离</li>
</ul>
<h4 id="利用球坐标计算三重积分"><a href="#利用球坐标计算三重积分" class="headerlink" title="利用球坐标计算三重积分"></a>利用球坐标计算三重积分</h4><p><img src="/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/8.png" alt="示例" style="zoom:80%;"></p>
<p>如图所示，在球面坐标系中的体积元素为<img src="/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/9.png" alt="示例" style="zoom:80%;"></p>
<p>$dv = r^2 sin\varphi dr d\varphi d\theta$</p>
<p>因此有 $\iiint<em>\Omega f(x,y,z)dxdydz =\iiint</em>\Omega F(r,\rho,\varphi)r^2sin\varphi d\varphi d\theta dr$</p>
<p><strong>$\theta$摆在前，$\varphi$摆中间,r 摆最后面</strong></p>
<p>其中，$F(r,\theta,\varphi) = f(rsin\varphi cos\theta,rsin\varphi sin\theta,rcos\varphi)$</p>
<p>适用范围</p>
<ul>
<li>积分域表面用球面坐标表示时方程简单</li>
<li>被积函数用球面坐标表示时变量相互分离</li>
</ul>
<h3 id="三重积分对称性的重要结论"><a href="#三重积分对称性的重要结论" class="headerlink" title="三重积分对称性的重要结论"></a>三重积分对称性的重要结论</h3><p>1） 若积分区域 $\Omega$ 关于xOy 坐标面对称，且 $f(x,y,z)$ 是关于z的奇函数，则 $\iiint_\Omega f(x,y,z) dv = 0$ </p>
<p>2）   若积分区域 $\Omega$ 关于xOy 坐标面对称，且 $f(x,y,z)$ 是关于z的偶函数，则 $\iiint<em>\Omega f(x,y,z) dv = 2\iiint</em>\Omega f(x,y,z) dv $</p>
<p>仿照上述结论，不难得出积分区域关于另外两个坐标面对称，以及被积函数关于另外两个变量的奇偶性的相关结论。</p>
<h3 id="重积分应用"><a href="#重积分应用" class="headerlink" title="重积分应用"></a>重积分应用</h3><ol>
<li>能运用重积分解决的实际问题的特点<ul>
<li>所求量分布在有界闭区域上的整体量</li>
<li>对区域具有可加性</li>
</ul>
</li>
<li>能用重积分解决问题的方法<ul>
<li>用微元分析法建立积分式</li>
</ul>
</li>
<li>解题要点<ul>
<li>画出积分域</li>
<li>选择坐标系</li>
<li>确定积分序</li>
<li>定出积分限</li>
<li>计算要简便</li>
</ul>
</li>
</ol>
<h4 id="立体体积"><a href="#立体体积" class="headerlink" title="立体体积"></a>立体体积</h4><h5 id="曲顶柱体"><a href="#曲顶柱体" class="headerlink" title="曲顶柱体"></a>曲顶柱体</h5><p>曲顶柱体的顶为连续曲面 $z = f(x,y),(x,y)\in D$</p>
<p>其体积为 $V = \iint_Df(x,y)dxdy$</p>
<h5 id="占有空间有界域-Omega-的立体的体积为"><a href="#占有空间有界域-Omega-的立体的体积为" class="headerlink" title="占有空间有界域$\Omega$的立体的体积为"></a>占有空间有界域$\Omega$的立体的体积为</h5><p>$V = \iiint_\Omega dxdydz$</p>
<h4 id="曲面面积"><a href="#曲面面积" class="headerlink" title="曲面面积"></a>曲面面积</h4><p><img src="/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/10.png" alt="示例"></p>
<p>所以曲面面积公式</p>
<p>$A = \iint<em>{D</em>{xy}} \sqrt{1+f_x^2(x,y)+f_y^2(x,y)}d\sigma  $</p>
<p><strong>当光滑曲面的方程为</strong>$z = f(x,y)$ $(x,y) \in D_{xy} $</p>
<p> $A = \iint<em>{D</em>{xy}}   \sqrt{1+(\frac{\delta z}{\delta x})^2+(\frac{\delta z}{\delta y})^2}dxdy$</p>
<p><strong>光滑曲面的方程为</strong> $y = f(z,x)$ $(z,x) \in D_{zx} $</p>
<p> $A = \iint<em>{D</em>{zx}} \sqrt{1+(\frac{\delta y}{\delta z})^2+(\frac{\delta y}{\delta x})^2}dzdx$</p>
<p><strong>光滑曲面的方程为</strong> $x = f(z,y)$ $(z,y) \in D_{zy} $</p>
<p> $A = \iint<em>{D</em>{zy}} \sqrt{1+(\frac{\delta x}{\delta z})^2+(\frac{\delta x}{\delta y})^2}dzdy$</p>
<p><strong>当光滑曲面方程为隐式 </strong>$F(x,y,z)=0,F_z \neq 0 $</p>
<p>$\frac{\delta z}{\delta x}=-\frac{F<em>x}{F_z},\frac{\delta z}{\delta y}=-\frac{F_y}{F_z},(x,y)\in D</em>{xy}$</p>
<p><img src="/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/15.png" alt="示例"></p>
<h4 id="物体的质心"><a href="#物体的质心" class="headerlink" title="物体的质心"></a>物体的质心</h4><p><img src="/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/11.png" alt="示例"></p>
<p><img src="/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/12.png" alt="示例"></p>
<h5 id="当所求对象是三维立体时"><a href="#当所求对象是三维立体时" class="headerlink" title="当所求对象是三维立体时"></a>当所求对象是三维立体时</h5><p>密度为$\rho(x,y,z)$时</p>
<p>令每个个小区域的最大直径$\lambda \rightarrow 0$</p>
<ul>
<li><p>一般不会让我们全部求。先考虑从对称性出发，把能变成0的都变成0</p>
<p>$ \overline{x} = \frac{\iiint<em>\Omega x\rho(x,y,z)dxdydz}{\iiint</em>\Omega \rho(x,y,z)dxdydz}$</p>
<p>$ \overline{y} = \frac{\iiint<em>\Omega y\rho(x,y,z)dxdydz}{\iiint</em>\Omega \rho(x,y,z)dxdydz}$</p>
<p>$ \overline{z} = \frac{\iiint<em>\Omega z\rho(x,y,z)dxdydz}{\iiint</em>\Omega \rho(x,y,z)dxdydz}$</p>
</li>
</ul>
<p><strong>形心坐标：</strong></p>
<p>当  $\rho = 常数$</p>
<p> $ \overline{x} = \frac{\iiint<em>\Omega x dxdydz}{\iiint</em>\Omega  dxdydz}$</p>
<p> $ \overline{y} = \frac{\iiint<em>\Omega y dxdydz}{\iiint</em>\Omega  dxdydz}$</p>
<p> $ \overline{z} = \frac{\iiint<em>\Omega z dxdydz}{\iiint</em>\Omega  dxdydz}$</p>
<p>$ V = \iiint_\Omega dxdydz$</p>
<h5 id="当物体时平面薄片时"><a href="#当物体时平面薄片时" class="headerlink" title="当物体时平面薄片时"></a>当物体时平面薄片时</h5><p><strong>密度为$\mu(x,y)$时</strong></p>
<p> $ \overline{x} = \frac{\iint_D x\mu(x,y)dxdy }{\iint_D\mu(x,y)dxdy }=\frac{M_y}{M}$</p>
<p>$ \overline{y} = \frac{\iint_D x\mu(x,y)dxdy }{\iint_D\mu(x,y)dxdy }=\frac{M_x}{M}$</p>
<p><strong>$M_x和M_y$分别时对x轴和对y轴的静矩</strong></p>
<p><strong><em>形心坐标 当 $\mu=常数$时</em></strong></p>
<p> $ \overline{x} = \frac{\iint_D x dxdy }{\iint_D dxdy } $</p>
<p>$ \overline{y} = \frac{\iint_D x dxdy }{\iint_D dxdy } $</p>
<p>A = ${\iint_D dxdy }$ A是D的面积</p>
<p>我们要先求出A或者V ，再分别求出  $\iint_D xdxdy,\iint_D ydxdy$</p>
<h4 id="物体的转动惯量"><a href="#物体的转动惯量" class="headerlink" title="物体的转动惯量"></a>物体的转动惯量</h4><p><img src="/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/13.png" alt="示例"></p>
<h5 id="当对象是三维立体时"><a href="#当对象是三维立体时" class="headerlink" title="当对象是三维立体时"></a>当对象是三维立体时</h5><p>密度为$\rho(x,y,z)$时</p>
<p><strong>因此物体对z轴的转动惯量：</strong></p>
<p>$I<em>z = \iiint</em>\Omega(x^2+y^2)\rho(x,y,z)dxdydz$</p>
<p><strong>因此物体对x轴的转动惯量：</strong></p>
<p>$I<em>x = \iiint</em>\Omega(z^2+y^2)\rho(x,y,z)dxdydz$ </p>
<p><strong>因此物体对y轴的转动惯量：</strong></p>
<p>$I<em>y = \iiint</em>\Omega(x^2+z^2)\rho(x,y,z)dxdydz$</p>
<p><strong>因此物体原点的转动惯量：</strong></p>
<p>$I<em>O = \iiint</em>\Omega(x^2+z^2+z^2)\rho(x,y,z)dxdydz$</p>
<h5 id="如果对象是平面薄片时"><a href="#如果对象是平面薄片时" class="headerlink" title="如果对象是平面薄片时"></a>如果对象是平面薄片时</h5><p>密度为$\mu(x,y)$时</p>
<p><strong>物体对x轴的转动惯量：</strong></p>
<p>$I_x = \iint_Dy^2\rho(x,y)dxdy$</p>
<p><strong>物体对y轴的转动惯量</strong></p>
<p>$I_y = \iint_Dx^2\rho(x,y)dxdy$ </p>
<p><strong>物体原点的转动惯量</strong></p>
<p>$I_y = \iint_D(x^2+y^2)\rho(x,y)dxdy$</p>
<h5 id="物体的引力"><a href="#物体的引力" class="headerlink" title="物体的引力"></a>物体的引力</h5><p><img src="/2020/05/01/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%E9%87%8D%E7%A7%AF%E5%88%86/14.png" alt="示例"></p>
<p><strong>因此立体对象的引力分量 </strong></p>
<p>密度为$\rho(x,y,z)$</p>
<p>$F<em>x = G\iiint</em>\Omega \frac{\rho(x,y,z)(x-x_0)}{r^3}dv$</p>
<p>$F<em>y = G\iiint</em>\Omega \frac{\rho(x,y,z)(y-y_0)}{r^3}dv$</p>
<p>$F<em>z = G\iiint</em>\Omega \frac{\rho(x,y,z)(z-z_0)}{r^3}dv$</p>
<p><strong>求平面薄片D 的引力分量</strong></p>
<p>密度为$\mu(x,y)$</p>
<p> $F_x = G\iint_D\frac{\mu(x,y)(x-x_0)}{r^3}d\sigma$</p>
<p> $F_y = G\iint_D\frac{\mu(x,y)(y-y_0)}{r^3}d\sigma$</p>
<p> $F_z = G\iint_D \frac{\mu(x,y)(z-z_0)}{r^3}d\sigma$  假设薄片在xOy平面上</p>
<p><strong>其中G是引力常数，r 是点与点之间的距离</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/" class="post-title-link" itemprop="url">从-1开始的python爬虫</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-30 23:07:36" itemprop="dateCreated datePublished" datetime="2020-04-30T23:07:36+08:00">2020-04-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-08 17:11:56" itemprop="dateModified" datetime="2020-05-08T17:11:56+08:00">2020-05-08</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="从-1开始的python爬虫"><a href="#从-1开始的python爬虫" class="headerlink" title="从-1开始的python爬虫"></a>从-1开始的python爬虫</h1><h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><ul>
<li>这篇长博客主要记录了我跟着一个公开课的内容从-1开始的爬虫经验，为什么是从-1呢，就是说我对python刚刚上手没几天，就开始学爬虫了QAQ</li>
<li>假设我们都已经安装了pycharm并配置好了所有库</li>
<li>我们要用的库是：pip3  install  requests  selenium beautifulsoup4 pyquery pymysql pymongo redis flask django jupyter</li>
<li>除了pyquery这类的包需要网上下载，其他都用pip3 install 包名解决，但是有时候很慢，有时候失败 ，多试几次8</li>
<li>谁能想到,仅仅安装这个包我就装了一个下午？？？</li>
</ul>
<h2 id="爬虫原理的讲解"><a href="#爬虫原理的讲解" class="headerlink" title="爬虫原理的讲解"></a>爬虫原理的讲解</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/1.png" alt="示例"></p>
<h4 id="什么是Request和Response？"><a href="#什么是Request和Response？" class="headerlink" title="什么是Request和Response？"></a>什么是Request和Response？</h4><p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/2.png" alt="示例"></p>
<ul>
<li>浏览器就发送消息给该网址所在的服务器，这个过程叫做HTTP Request</li>
<li>服务器收到浏览器发送的消息后，能够根据浏览器发送的内容做相应处理，然后把消息回传给浏览器。这个过程叫做HTTP Response</li>
</ul>
<h5 id="Request包含哪些方法？"><a href="#Request包含哪些方法？" class="headerlink" title="Request包含哪些方法？"></a>Request包含哪些方法？</h5><p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/3.png" alt="示例"></p>
<h5 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h5><p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/4.png" alt="示例"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response = requests.get(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">print(response.text)</span><br><span class="line">print(response.status_code)<span class="comment">#200 说明请求成功</span></span><br></pre></td></tr></table></figure>
<ul>
<li>这三行代码就是我向百度发送了一个请求，然后把response返回给我们命名的response</li>
<li><p>然后打印出网页源代码</p>
</li>
<li><p>注意，这样的请求不能请求知乎这样的网站</p>
</li>
</ul>
<h4 id="能抓取怎样的数据"><a href="#能抓取怎样的数据" class="headerlink" title="能抓取怎样的数据"></a>能抓取怎样的数据</h4><p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/5.png" alt="示例"></p>
<h4 id="解析方式"><a href="#解析方式" class="headerlink" title="解析方式"></a>解析方式</h4><p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/6.png" alt="示例"></p>
<ul>
<li>request请求只会请求第一个html网页，而不会加载后面的Js文件，但是我们在dev-tool的Elements中看到的源代码是已经经过js渲染过后的，体量很大，行数很多，和一开始拿到的源代码完全不一样</li>
</ul>
<h4 id="那么，如何解决JavaScript渲染的问题"><a href="#那么，如何解决JavaScript渲染的问题" class="headerlink" title="那么，如何解决JavaScript渲染的问题"></a>那么，如何解决JavaScript渲染的问题</h4><p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/7.png" alt="示例"></p>
<ul>
<li>我们在python中引入了selenium库</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> selenium</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line"><span class="comment">#driver.get('http://www.zhihu.com')</span></span><br><span class="line">driver.get(<span class="string">'http://www.taobao.com'</span>)</span><br></pre></td></tr></table></figure>
<p>效果如下</p>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/8.png" alt="示例"></p>
<p>用库不能获得js渲染后的源代码，但是driver.page_source 可以</p>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/9.png" alt="示例"></p>
<h4 id="如何存储文件"><a href="#如何存储文件" class="headerlink" title="如何存储文件"></a>如何存储文件</h4><p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/10.png" alt="示例"></p>
<h2 id="Urllib-库的基本使用"><a href="#Urllib-库的基本使用" class="headerlink" title="Urllib 库的基本使用"></a>Urllib 库的基本使用</h2><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><p><a href="https://www.cnblogs.com/Caiyundo/p/12448948.html" target="_blank" rel="noopener">https://www.cnblogs.com/Caiyundo/p/12448948.html</a></p>
<h5 id="urlopen"><a href="#urlopen" class="headerlink" title="urlopen"></a>urlopen</h5><h6 id="get-类型请求"><a href="#get-类型请求" class="headerlink" title="get 类型请求"></a>get 类型请求</h6><p>返回源代码的所有内容，完成了爬虫的第一步，就是把网页给请求下来了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line">response = urllib.request.urlopen(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">print(response.read().decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>
<h6 id="post类型请求-加了data就是以post方式"><a href="#post类型请求-加了data就是以post方式" class="headerlink" title="post类型请求,加了data就是以post方式"></a>post类型请求,加了data就是以post方式</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line">data = bytes(urllib.parse.urlencode(&#123;<span class="string">'word'</span>:<span class="string">'hello'</span>&#125;),encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">response = urllib.request.urlopen(<span class="string">'http://httpbin.org/post'</span>,data=data)</span><br><span class="line">print(response.read())</span><br></pre></td></tr></table></figure>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/12.png" alt="示例"></p>
<h6 id="timeout-参数-超时就报错，否则就返回"><a href="#timeout-参数-超时就报错，否则就返回" class="headerlink" title="timeout 参数:超时就报错，否则就返回"></a>timeout 参数:超时就报错，否则就返回</h6><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line">response = urllib.request.urlopen(<span class="string">'http://httpbin.org/get'</span>,timeout=<span class="number">1</span>)</span><br><span class="line">print(response.read())</span><br></pre></td></tr></table></figure>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/13.png" alt="示例"></p>
<h6 id="调用urllib-error判断原因"><a href="#调用urllib-error判断原因" class="headerlink" title="调用urllib.error判断原因"></a>调用urllib.error判断原因</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> urllib.error</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = urllib.request.urlopen(<span class="string">'http://httpbin.org/get'</span>,timeout = <span class="number">0.1</span>)</span><br><span class="line"><span class="keyword">except</span> urllib.error.URLError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">if</span> isinstance(e.reason,socket.timeout):</span><br><span class="line">        print(<span class="string">'Time Out!'</span>)</span><br><span class="line"><span class="comment"># 最后就返回Time Out</span></span><br></pre></td></tr></table></figure>
<h5 id="Response-1"><a href="#Response-1" class="headerlink" title="Response"></a>Response</h5><h6 id="响应类型"><a href="#响应类型" class="headerlink" title="响应类型"></a>响应类型</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line">response = urllib.request.urlopen(<span class="string">'http://www.python.org'</span>)</span><br><span class="line">print(type(response))</span><br><span class="line"><span class="comment"># 显示 &lt;class 'http.client.HTTPResponse'&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="状态码，响应头"><a href="#状态码，响应头" class="headerlink" title="状态码，响应头"></a>状态码，响应头</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line">response = urllib.request.urlopen(<span class="string">'http://www.python.org'</span>)</span><br><span class="line">print(response.status) <span class="comment"># 200</span></span><br><span class="line">print(response.getheaders()) <span class="comment"># 响应头</span></span><br><span class="line">print(response.getheader(<span class="string">'Server'</span>)) <span class="comment">#nginx</span></span><br><span class="line"><span class="string">""" 响应头如下，getheader是具体获得某个属性，比如这里('Server', 'nginx')</span></span><br><span class="line"><span class="string">[('Connection', 'close'), ('Content-Length', '48894'), ('Server', 'nginx'),</span></span><br><span class="line"><span class="string">('Content-Type', 'text/html; charset=utf-8'), ('X-Frame-Options', 'DENY'), </span></span><br><span class="line"><span class="string">('Via', '1.1 vegur'), ('Via', '1.1 varnish'), ('Accept-Ranges', 'bytes'), </span></span><br><span class="line"><span class="string">('Date', 'Fri, 01 May 2020 02:10:29 GMT'), ('Via', '1.1 varnish'), </span></span><br><span class="line"><span class="string">('Age', '2038'), ('X-Served-By', 'cache-bwi5143-BWI, cache-hkg17922-HKG'),</span></span><br><span class="line"><span class="string">('X-Cache', 'HIT, HIT'), ('X-Cache-Hits', '2, 1537'), </span></span><br><span class="line"><span class="string">('X-Timer', 'S1588299030.614786,VS0,VE0'), ('Vary', 'Cookie'), </span></span><br><span class="line"><span class="string">('Strict-Transport-Security', 'max-age=63072000; includeSubDomains')]</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
<h6 id="read方法，返回响应的内容"><a href="#read方法，返回响应的内容" class="headerlink" title="read方法，返回响应的内容"></a>read方法，返回响应的内容</h6><ul>
<li>就是网页的源代码（js渲染之后）</li>
<li><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/14.png" alt="示例"></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line">response = urllib.request.urlopen(<span class="string">'http://www.python.org'</span>)</span><br><span class="line">print(response.read(),decode=(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>
<h5 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h5><h6 id="发送request对象-获得response的内容"><a href="#发送request对象-获得response的内容" class="headerlink" title="发送request对象 获得response的内容"></a>发送request对象 获得response的内容</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line">request = urllib.request.Request(<span class="string">'http://www.python.org'</span>)</span><br><span class="line">response = urllib.request.urlopen(request)</span><br><span class="line">print(response.read().decode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="comment"># 和上面的一样，返回网页源代码</span></span><br></pre></td></tr></table></figure>
<h6 id="加入headers的参数"><a href="#加入headers的参数" class="headerlink" title="加入headers的参数"></a>加入headers的参数</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request,parse</span><br><span class="line">url = <span class="string">'http://httpbin.org/post'</span><span class="comment"># 构造一个post请求</span></span><br><span class="line"><span class="comment"># 把headers加进来</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (compatible;MSIE 5.5;Windows NT)'</span>,</span><br><span class="line">    <span class="string">'Host'</span>:<span class="string">'httpbin.org'</span></span><br><span class="line">&#125;</span><br><span class="line">dict = &#123;</span><br><span class="line">    <span class="string">'name'</span> : <span class="string">'Jason'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 把data用bytes编码</span></span><br><span class="line">data = bytes(parse.urlencode(dict),encoding=<span class="string">'utf-8'</span>)</span><br><span class="line"><span class="comment"># 利用Request方法，传入url，data，headers，method这些参数</span></span><br><span class="line">req = request.Request(url=url,data = data,headers=headers,method=<span class="string">'POST'</span>)</span><br><span class="line">response = request.urlopen(req)</span><br><span class="line">print(response.read().decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>
<p>下面是返回的内容</p>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/15.png" alt="示例"></p>
<h6 id="通过add-headers传入参数"><a href="#通过add-headers传入参数" class="headerlink" title="通过add_headers传入参数"></a>通过add_headers传入参数</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request,parse</span><br><span class="line">url = <span class="string">'http://httpbin.org/post'</span></span><br><span class="line">dict = &#123;</span><br><span class="line">    <span class="string">'name'</span> : <span class="string">'Jason'</span></span><br><span class="line">&#125;</span><br><span class="line">data = bytes(parse.urlencode(dict),encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">req = request.Request(url=url,data = data,method=<span class="string">'POST'</span>)</span><br><span class="line"><span class="comment"># 通过add_headers 传入我们设定的headers</span></span><br><span class="line">req.add_header(<span class="string">'User-Agent'</span>,<span class="string">'Mozilla/5.0 (compatible;MSIE 5.5;Windows NT)'</span>)</span><br><span class="line">response = request.urlopen(req)</span><br><span class="line">print(response.read().decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>
<p>内容和上图一样</p>
<h5 id="Handler"><a href="#Handler" class="headerlink" title="Handler"></a>Handler</h5><p>handler就是辅助的工具，用来做更高级的操作</p>
<p><a href="https://docs.python.org/3/library/urllib.html" target="_blank" rel="noopener">官方文档</a></p>
<h6 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line">proxy_handler = urllib.request.ProxyHandler(&#123;</span><br><span class="line">    <span class="comment"># 这是我现在的代理（vpn）</span></span><br><span class="line">    <span class="string">'http'</span>:<span class="string">'http://127.0.0.1:1080'</span></span><br><span class="line">&#125;)</span><br><span class="line">opener = urllib.request.build_opener(proxy_handler)</span><br><span class="line">response = opener.open(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">print(response.read())</span><br></pre></td></tr></table></figure>
<ul>
<li>传回来一堆东西,就是百度的源代码</li>
</ul>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/16.png" alt="示例"></p>
<ul>
<li>如果换成httpbin.org,会返回一个ip地址</li>
</ul>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/17.png" alt="示例"></p>
<p>稍做查询，我们可以知道这个199.193.124.87来自美国加利福尼亚洛杉矶</p>
<p>使用代理ip地址，可以伪装自己的ip地址，并保持切换，这样服务器就不会屏蔽我们这个爬虫</p>
<h6 id="Coockie"><a href="#Coockie" class="headerlink" title="Coockie"></a>Coockie</h6><ul>
<li><p>cookie 是保存用户信息的文件，在爬虫中可以用来维持用户登陆状态。在dev-tools中清楚coockie，再次刷新浏览器，就需要重新登陆了</p>
</li>
<li><p>利用cookie可以爬取一些需要认证的网页</p>
</li>
<li></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http.cookiejar,urllib.request</span><br><span class="line"><span class="comment"># 首先把cookie声明为一个cookieJar的对象</span></span><br><span class="line">cookie = http.cookiejar.CookieJar()</span><br><span class="line"><span class="comment"># 借助handler 处理cookie</span></span><br><span class="line">handler = urllib.request.HTTPCookieProcessor(cookie)</span><br><span class="line"><span class="comment"># build_opener把handler传过来</span></span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line"><span class="comment"># 最后用opener打开网站</span></span><br><span class="line">response = opener.open(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line"><span class="comment"># 遍历打印出cookie中的内容</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> cookie:</span><br><span class="line">    print(item.name + <span class="string">'='</span>+item.value)</span><br><span class="line"></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">BAIDUID=2D4FA5F4570DED9E85DFD1316A950B5A:FG=1</span></span><br><span class="line"><span class="string">BIDUPSID=2D4FA5F4570DED9E52F2D6C2838FE7A0</span></span><br><span class="line"><span class="string">H_PS_PSSID=1442_31325_21078_31423_31341_31463_30824_31163</span></span><br><span class="line"><span class="string">PSTM=1588302459</span></span><br><span class="line"><span class="string">BDSVRTM=0</span></span><br><span class="line"><span class="string">BD_HOME=1</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<ul>
<li>如果cookie没有失效，那么可以一直使用这个cookie维持登录状态</li>
</ul>
<h6 id="利用MozillaCookieJar保存我们的cookie文件"><a href="#利用MozillaCookieJar保存我们的cookie文件" class="headerlink" title="利用MozillaCookieJar保存我们的cookie文件"></a>利用MozillaCookieJar保存我们的cookie文件</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http.cookiejar,urllib.request</span><br><span class="line">filename = <span class="string">"cookie.txt"</span></span><br><span class="line">cookie = http.cookiejar.MozillaCookieJar(filename)</span><br><span class="line">handler = urllib.request.HTTPCookieProcessor(cookie)</span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line">response = opener.open(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">cookie.save(ignore_discard=<span class="literal">True</span>,ignore_expires=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>运行之后，文件夹里多出了一个cookie.txt 文件</p>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/18.png" alt="示例"></p>
<h6 id="也可以用LWPcookieJar保存我们的cookie，只是格式不同"><a href="#也可以用LWPcookieJar保存我们的cookie，只是格式不同" class="headerlink" title="也可以用LWPcookieJar保存我们的cookie，只是格式不同"></a>也可以用LWPcookieJar保存我们的cookie，只是格式不同</h6><p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/19.png" alt="示例"></p>
<h6 id="用load方法来把文件中的cookie赋值给新的cookie"><a href="#用load方法来把文件中的cookie赋值给新的cookie" class="headerlink" title="用load方法来把文件中的cookie赋值给新的cookie"></a>用load方法来把文件中的cookie赋值给新的cookie</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http.cookiejar,urllib.request</span><br><span class="line">cookie = http.cookiejar.LWPCookieJar()</span><br><span class="line"><span class="comment"># 这里我们已经把cookie文件保存下来，下面只是读取文本文件，赋值</span></span><br><span class="line">cookie.load(<span class="string">'cookie.txt'</span>,ignore_expires=<span class="literal">True</span>,ignore_discard=<span class="literal">True</span>)</span><br><span class="line">handler = urllib.request.HTTPCookieProcessor(cookie)</span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line"><span class="comment"># cookie没有过期的话，可以再次爬取我们的网页</span></span><br><span class="line"><span class="comment"># 如果网页是要登录才能看到的，那么这样就能保持我们的登陆状态</span></span><br><span class="line">response = opener.open(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">print(response.read().decode(<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="comment"># 最后打印的内容就是我们的网页源码</span></span><br></pre></td></tr></table></figure>
<h5 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h5><p><a href="https://docs.python.org/3/library/urllib.error.html" target="_blank" rel="noopener">官方文档</a></p>
<h6 id="URLError"><a href="#URLError" class="headerlink" title="URLError"></a>URLError</h6><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request,error</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = request.urlopen(<span class="string">'http://cuiqingcai.com/index.html'</span>)</span><br><span class="line"><span class="keyword">except</span> error.URLError <span class="keyword">as</span> e:</span><br><span class="line">    print(e.reason)</span><br><span class="line"><span class="comment"># 打印 Not Found</span></span><br><span class="line"><span class="comment"># 改成 http://jasonxqh.github.io 不显示错误，因为请求成功</span></span><br></pre></td></tr></table></figure>
<h6 id="HTTPError"><a href="#HTTPError" class="headerlink" title="HTTPError"></a>HTTPError</h6><p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/20.png" alt="示例"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> urllib.error</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = urllib.request.urlopen(<span class="string">'http://www.baidu.com'</span>,timeout=<span class="number">0.01</span>)</span><br><span class="line"><span class="keyword">except</span> urllib.error.URLError <span class="keyword">as</span> e:</span><br><span class="line">     print(type(e.reason))</span><br><span class="line">    <span class="keyword">if</span> isinstance(e.reason,socket.timeout):</span><br><span class="line">        print(<span class="string">'Time Out'</span>)</span><br><span class="line">      <span class="comment">#打印&lt;class 'socket.timeout'&gt;</span></span><br><span class="line">	  <span class="comment">#    Time Out</span></span><br></pre></td></tr></table></figure>
<h5 id="URL解析"><a href="#URL解析" class="headerlink" title="URL解析"></a>URL解析</h5><h6 id="urlparse"><a href="#urlparse" class="headerlink" title="urlparse"></a>urlparse</h6><ul>
<li>把URL拆分成几个标准的部分</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line">result = urlparse(<span class="string">'http://www.baidu.com/index.html;user?id=5#comment'</span>)</span><br><span class="line">print(type(result),result)</span><br><span class="line"><span class="comment"># 打印内容如下，</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">urllib</span>.<span class="title">parse</span>.<span class="title">ParseResult</span>'&gt; <span class="title">ParseResult</span><span class="params">(scheme=<span class="string">'http'</span>, netloc=<span class="string">'www.baidu.com'</span>,</span></span></span><br><span class="line"><span class="class"><span class="params"> path=<span class="string">'/index.html'</span>, params=<span class="string">'user'</span>, query=<span class="string">'id=5'</span>, fragment=<span class="string">'comment'</span>)</span></span></span><br></pre></td></tr></table></figure>
<ul>
<li>加上协议参数，如果本来就有http开头，那么第二个参数是不会生效的</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line">result = urlparse(<span class="string">'www.baidu.com/index.html;user?id=5#comment'</span>,scheme=<span class="string">'https'</span>)</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># 打印内容如下</span></span><br><span class="line">ParseResult(scheme=<span class="string">'https'</span>, netloc=<span class="string">''</span>, path=<span class="string">'www.baidu.com/index.html'</span>, params=<span class="string">'user'</span>, query=<span class="string">'id=5'</span>, fragment=<span class="string">'comment'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>allow_fragments参数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line">result=urlparse(<span class="string">'http://www.baidu.com/index.html;user id=5#comment'</span>,allow_fragments=<span class="literal">False</span>)</span><br><span class="line">print(result)</span><br><span class="line"><span class="comment"># 打印内容如下 fragment 置空，拼接到上面一个非空参数中，如果query也为空，那么再拼到params中</span></span><br><span class="line">ParseResult(scheme=<span class="string">'http'</span>, netloc=<span class="string">'www.baidu.com'</span>, path=<span class="string">'/index.html'</span>, params=<span class="string">'user'</span>, </span><br><span class="line">query=<span class="string">'id=5#comment'</span>, fragment=<span class="string">''</span>)</span><br></pre></td></tr></table></figure>
<h6 id="urlunprse"><a href="#urlunprse" class="headerlink" title="urlunprse"></a>urlunprse</h6><ul>
<li>拼接url，就是urlparse的反函数</li>
</ul>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/21.png" alt="示例"></p>
<h6 id="urljoin"><a href="#urljoin" class="headerlink" title="urljoin"></a>urljoin</h6><p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/22.png" alt="示例"></p>
<p>拼接两个字符串，因为一个url可以分成很多部分，如果后面的字符串的部分未出现，前面的来补，后面的出现了，那么以后面的为准</p>
<h6 id="urlencode"><a href="#urlencode" class="headerlink" title="urlencode"></a>urlencode</h6><p>把字典对象转换成get请求参数</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span>  urlencode</span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">'name'</span>:<span class="string">'Jason'</span>,</span><br><span class="line">    <span class="string">'age'</span> :<span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line">base_url = <span class="string">'http://www.baidu.com?'</span></span><br><span class="line">url = base_url+urlencode(params)</span><br><span class="line">print(url)</span><br><span class="line"><span class="comment"># 打印内容</span></span><br><span class="line"> http://www.baidu.com?name=Jason&amp;age=18</span><br></pre></td></tr></table></figure>
<h2 id="Requests库详解"><a href="#Requests库详解" class="headerlink" title="Requests库详解"></a>Requests库详解</h2><ul>
<li>requests库的代码量相较于urllib更为简单，而且是基于urllib3编写的库。所以在写爬虫代码的时候建议用Requests库</li>
</ul>
<h3 id="实例引入"><a href="#实例引入" class="headerlink" title="实例引入"></a>实例引入</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response = requests.get(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">print(type(response))</span><br><span class="line">print(response.status_code)</span><br><span class="line">print(type(response.text))</span><br><span class="line">print(response.text)<span class="comment">#和urllib中的read()方法的功能相同</span></span><br><span class="line">print(response.cookies)<span class="comment">#不需要像urllib一样先声明一个cookie对象和handler</span></span><br><span class="line"><span class="comment"># 可以把我们想要的信息迅速打印出来</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/23.png" alt="示例"></p>
<h3 id="各种请求方式"><a href="#各种请求方式" class="headerlink" title="各种请求方式"></a>各种请求方式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">requests.post(<span class="string">'http://httpbin.org/post'</span>)</span><br><span class="line">requests.put(<span class="string">'http://httpbin.org/put'</span>)</span><br><span class="line">requests.delete(<span class="string">'http://httpbin.org/delete'</span>)</span><br><span class="line">requests.options(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">requests.head(<span class="string">'http://httpbin.org/get'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="基本get请求"><a href="#基本get请求" class="headerlink" title="基本get请求"></a>基本get请求</h3><h4 id="基本写法"><a href="#基本写法" class="headerlink" title="基本写法"></a>基本写法</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response = requests.get(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>
<h4 id="带参数的Get请求"><a href="#带参数的Get请求" class="headerlink" title="带参数的Get请求"></a>带参数的Get请求</h4><h5 id="原来这么写"><a href="#原来这么写" class="headerlink" title="原来这么写"></a>原来这么写</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response = requests.get(<span class="string">'http://httpbin.org/get?name=Jason&amp;age=19'</span>)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>
<h5 id="现在这么写"><a href="#现在这么写" class="headerlink" title="现在这么写"></a>现在这么写</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'name'</span>:<span class="string">'Jason'</span>,</span><br><span class="line">     <span class="string">'age'</span>:<span class="number">22</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(<span class="string">'http://httpbin.org/get'</span>,params=data)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>
<ul>
<li>返回内容都是一样的。但是后面的更加直观易懂，不需要自己编码</li>
</ul>
<h4 id="解析json"><a href="#解析json" class="headerlink" title="解析json"></a>解析json</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response = requests.get(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">print(type(response.text))</span><br><span class="line">print(response.json())</span><br><span class="line">print(type(response.json()))</span><br></pre></td></tr></table></figure>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/24.png" alt="示例"></p>
<ul>
<li>response.json()相当于json库中的json.loads(response.txt)的用法</li>
</ul>
<h3 id="获取二进制数据"><a href="#获取二进制数据" class="headerlink" title="获取二进制数据"></a>获取二进制数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response = requests.get(<span class="string">'http://github.com/favicon.ico'</span>)</span><br><span class="line">print(type(response.text),type(response.content))</span><br><span class="line">print(response.text)</span><br><span class="line">print(response.content)</span><br></pre></td></tr></table></figure>
<h5 id="保存数据"><a href="#保存数据" class="headerlink" title="保存数据"></a>保存数据</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response = requests.get(<span class="string">'http://github.com/favicon.ico'</span>)</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'favicon.ico'</span>,<span class="string">'wb'</span>)<span class="keyword">as</span> f:<span class="comment"># wb是写入模式</span></span><br><span class="line">    f.write(response.content)</span><br><span class="line">    f.close()</span><br></pre></td></tr></table></figure>
<ul>
<li>我们看到图片就这样被下载了</li>
</ul>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/25.png" alt="示例"></p>
<h3 id="添加headers"><a href="#添加headers" class="headerlink" title="添加headers"></a>添加headers</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response = requests.get(<span class="string">'https://www.zhihu.com/explore'</span>)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>
<p>不加headers，会被某些网站ban掉</p>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/26.png" alt="示例"></p>
<ul>
<li>添加了headers后，好起来了</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">headers = &#123;</span><br><span class="line">     <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.65 Safari/537.36'</span>,</span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(<span class="string">'https://www.zhihu.com/explore'</span>,headers=headers)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>
<h3 id="基本post请求"><a href="#基本post请求" class="headerlink" title="基本post请求"></a>基本post请求</h3><p>可以非常方便的传入一个字典，在urllib还要转码，配置，比较繁琐</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">data = &#123;<span class="string">'name'</span>:<span class="string">'jason'</span>,<span class="string">'age'</span>:<span class="number">22</span>&#125;</span><br><span class="line">response = requests.post(<span class="string">"http://httpbin.org/post"</span>,data=data)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/28.png" alt="示例"></p>
<ul>
<li>加入一个headers</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">data = &#123;<span class="string">'name'</span>:<span class="string">'jason'</span>,<span class="string">'age'</span>:<span class="number">22</span>&#125;</span><br><span class="line">headers = &#123;</span><br><span class="line">     <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) </span></span><br><span class="line"><span class="string">AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.65 </span></span><br><span class="line"><span class="string">Safari/537.36'</span>,</span><br><span class="line">&#125;</span><br><span class="line">response = </span><br><span class="line">requests.post(<span class="string">"http://httpbin.org/post"</span>,data=data,headers=headers)</span><br><span class="line">print(response.json())</span><br><span class="line"><span class="comment"># 打印json文件格式</span></span><br></pre></td></tr></table></figure>
<h3 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h3><h4 id="response属性"><a href="#response属性" class="headerlink" title="response属性"></a>response属性</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response = requests.get(<span class="string">'http://www.jianshu.com'</span>)</span><br><span class="line">print(type(response.status_code),response.status_code)</span><br><span class="line">print(type(response.headers),response.headers)</span><br><span class="line">print(type(response.cookies),response.cookies)</span><br><span class="line">print(type(response.url),response.url)</span><br><span class="line">print(type(response.history),response.history)</span><br></pre></td></tr></table></figure>
<h3 id="状态码判断"><a href="#状态码判断" class="headerlink" title="状态码判断"></a>状态码判断</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response = requests.get(<span class="string">'http://www.jianshu.com'</span>)</span><br><span class="line">exit()<span class="keyword">if</span> <span class="keyword">not</span> response.status_code==requests.codes.not_found <span class="keyword">else</span> print(<span class="string">'Request Not Found'</span>)</span><br><span class="line"><span class="comment"># not_found 可以更改为任何一个状态码后的文字内容</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/30.png" alt="示例"></p>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/31.png" alt="示例"></p>
<h3 id="高级操作"><a href="#高级操作" class="headerlink" title="高级操作"></a>高级操作</h3><h4 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment"># 把这个文件读取出来</span></span><br><span class="line">files = &#123;<span class="string">'file'</span>:open(<span class="string">'favicon.ico'</span>,<span class="string">'rb'</span>)&#125;</span><br><span class="line"><span class="comment"># 利用post操作实现文件的上传</span></span><br><span class="line">response = requests.post(<span class="string">'http://httpbin.org/post'</span>,files=files)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/32.png" alt="示例"></p>
<h4 id="获取cookie"><a href="#获取cookie" class="headerlink" title="获取cookie"></a>获取cookie</h4><p>不用像urllib一样，用一个cookiejar然后再用handler获取cookie了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response = requests.get(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">print(response.cookies)</span><br><span class="line"><span class="keyword">for</span> key,value <span class="keyword">in</span> response.cookies.items():</span><br><span class="line">    print(key+<span class="string">'='</span>+value)</span><br><span class="line"><span class="string">'''  &lt;RequestsCookieJar[&lt;Cookie BDORZ=27315 for .baidu.com/&gt;]&gt;</span></span><br><span class="line"><span class="string">BDORZ=27315</span></span><br><span class="line"><span class="string">    '''</span></span><br></pre></td></tr></table></figure>
<h4 id="会话维持"><a href="#会话维持" class="headerlink" title="会话维持"></a>会话维持</h4><p>模拟登陆</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment"># Session()方法是实现在同一个浏览器实现get和set</span></span><br><span class="line">s = requests.Session()</span><br><span class="line"><span class="comment"># 用sesson对象发起两次请求</span></span><br><span class="line">s.get(<span class="string">'http://httpbin.org/cookies/set/number/123456789'</span>)</span><br><span class="line">response = s.get(<span class="string">'http://httpbin.org/cookies'</span>)</span><br><span class="line">print(response.text)</span><br><span class="line">```</span><br><span class="line">输出内容如下，说明第二次访问的时候cookies已经保存下来了，说明会话维持住了</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"cookies"</span>: &#123;</span><br><span class="line">    <span class="string">"number"</span>: <span class="string">"123456789"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">```</span><br></pre></td></tr></table></figure>
<h3 id="证书验证"><a href="#证书验证" class="headerlink" title="证书验证"></a>证书验证</h3><ul>
<li>如果要访问的网站的证书是不合法的，就会抛出一个错误，要避免这个错误就要设定一个verify参数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response = requests.get(<span class="string">'http://www.12306.cn'</span>,verify=<span class="literal">False</span>)<span class="comment">#会warning</span></span><br><span class="line">print(response.status_code)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="comment"># 通过这样引入一个原生包可以避免warning的发生</span></span><br><span class="line"><span class="keyword">from</span> requests.packages <span class="keyword">import</span> urllib3</span><br><span class="line">urllib3.disable_warnings()</span><br><span class="line">response = requests.get(<span class="string">'http://www.12306.cn'</span>,verify=<span class="literal">False</span>)</span><br><span class="line">print(response.status_code)</span><br></pre></td></tr></table></figure>
<h3 id="代理设置"><a href="#代理设置" class="headerlink" title="代理设置"></a>代理设置</h3><p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/33.png" alt="示例"></p>
<p>第一种是普通的，第二种是需要密码的，第三种是用socks代理的，需要pip一下socks包</p>
<h3 id="超时设置"><a href="#超时设置" class="headerlink" title="超时设置"></a>超时设置</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response = requests.get(<span class="string">'http://www.taobao.com'</span>,timeout=<span class="number">0.01</span>)</span><br><span class="line">print(response.status_code)</span><br><span class="line"><span class="comment"># 会报错</span></span><br></pre></td></tr></table></figure>
<h3 id="认证设置"><a href="#认证设置" class="headerlink" title="认证设置"></a>认证设置</h3><p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/34.png" alt="示例"></p>
<h3 id="异常处理-1"><a href="#异常处理-1" class="headerlink" title="异常处理"></a>异常处理</h3><p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/35.png" alt="示例"></p>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/36.png" alt="示例"></p>
<p><a href="https://requests.readthedocs.io/en/master/_modules/requests/exceptions/#RequestException" target="_blank" rel="noopener">官方文档</a></p>
<h2 id="BeautifulSoup-的基本用法"><a href="#BeautifulSoup-的基本用法" class="headerlink" title="BeautifulSoup 的基本用法"></a>BeautifulSoup 的基本用法</h2><ul>
<li>灵活又方便的网页解析库，处理高效，支持多种解析器。利用它不用编写正则表达式即可方便地实现网页信息的爬取</li>
</ul>
<h3 id="解析库"><a href="#解析库" class="headerlink" title="解析库"></a>解析库</h3><p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/37.png" alt="示例"></p>
<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">html = <span class="string">"""</span></span><br><span class="line"><span class="string">&lt;!doctype html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang="zh" data-hairline="true" data-theme="light"&gt;&lt;head&gt;&lt;meta charSet="utf-8"/&gt;&lt;title data-react-helmet="true"&gt;请问心脏线r=a(1+ cosθ)的图像怎么画，和a有什么关系？ - 知乎&lt;/title&gt;&lt;meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/&gt;&lt;meta name="renderer" content="webkit"/&gt; </span></span><br><span class="line"><span class="string">  height: env(safe-area-inset-top) !important;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">.u-safeAreaInset-bottom &#123;</span></span><br><span class="line"><span class="string">  height: constant(safe-area-inset-bottom) !important;</span></span><br><span class="line"><span class="string">  height: env(safe-area-inset-bottom) !important;</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.prettify())<span class="comment"># 就可以梅花我们残缺的html文件</span></span><br><span class="line">print(soup.title.string)<span class="comment"># 获取到我们html中的title</span></span><br></pre></td></tr></table></figure>
<ul>
<li>我们看到这就是结果</li>
</ul>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/39.png" alt="示例"></p>
<ul>
<li>如果没有title标签，那么就会报错</li>
</ul>
<h3 id="标签选择器"><a href="#标签选择器" class="headerlink" title="标签选择器"></a>标签选择器</h3><ul>
<li>这种选择器的选择速度是非常快的，根据标签的名字来选择</li>
<li>但是不能满足我们的一些需求，单纯用标签来选择是远远不够的</li>
</ul>
<h4 id="选择元素-标签"><a href="#选择元素-标签" class="headerlink" title="选择元素/标签"></a>选择元素/标签</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.title)</span><br><span class="line">print(type(soup.title))</span><br><span class="line">print(soup.head)</span><br><span class="line">print(soup.p)</span><br></pre></td></tr></table></figure>
<ul>
<li>我们很简单的把知乎的源代码当作html文件，这样我们看到打印出来的内容：</li>
</ul>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/40.png" alt="示例"></p>
<h4 id="获取名称：返回最外层标签的名称"><a href="#获取名称：返回最外层标签的名称" class="headerlink" title="获取名称：返回最外层标签的名称"></a>获取名称：返回最外层标签的名称</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.title.name)</span><br></pre></td></tr></table></figure>
<h4 id="获取属性"><a href="#获取属性" class="headerlink" title="获取属性"></a>获取属性</h4><p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/38.png" alt="示例"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.p.attr(<span class="string">'name'</span>))</span><br><span class="line">print(soup.p(<span class="string">'name'</span>))</span><br><span class="line"><span class="comment"># 输出dromouse</span></span><br></pre></td></tr></table></figure>
<h4 id="获取内容"><a href="#获取内容" class="headerlink" title="获取内容"></a>获取内容</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.title.string)<span class="comment"># 获取到我们html中的title中的内容</span></span><br></pre></td></tr></table></figure>
<h4 id="嵌套选择"><a href="#嵌套选择" class="headerlink" title="嵌套选择"></a>嵌套选择</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line"><span class="comment"># 获取head中的title标签的string属性</span></span><br><span class="line">print(soup.head.title.string)</span><br></pre></td></tr></table></figure>
<h4 id="子节点和子孙节点"><a href="#子节点和子孙节点" class="headerlink" title="子节点和子孙节点"></a>子节点和子孙节点</h4><ul>
<li>对子节点输出 ： child</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.p.child)</span><br><span class="line"><span class="comment"># child 会输出所有的子节点，返回的是迭代器</span></span><br><span class="line"><span class="keyword">for</span> l,child <span class="keyword">in</span> enumerate(soup.p.child):</span><br><span class="line">    print(l,child)</span><br></pre></td></tr></table></figure>
<ul>
<li>对所有子孙节点输出： descendants</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.p.descendants)</span><br><span class="line"><span class="comment"># descendants 会把子节点子孙节点全部打印出来，返回迭代器</span></span><br><span class="line"><span class="keyword">for</span> l,child <span class="keyword">in</span> enumerate(soup.p.descendants):</span><br><span class="line">    print(l,child)</span><br></pre></td></tr></table></figure>
<h4 id="父节点和祖先节点"><a href="#父节点和祖先节点" class="headerlink" title="父节点和祖先节点"></a>父节点和祖先节点</h4><ul>
<li>对指定标签的父节点进行输出：parent</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.a.parent)<span class="comment"># 对a标签的父节点进行输出</span></span><br></pre></td></tr></table></figure>
<ul>
<li>对指定标签的父节点和祖父节点进行输出：parents</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.a.parents)</span><br><span class="line">print(list(enumerate(soup.a.parents)))</span><br></pre></td></tr></table></figure>
<h4 id="兄弟节点"><a href="#兄弟节点" class="headerlink" title="兄弟节点"></a>兄弟节点</h4><ul>
<li>next_siblings 和 previous_siblings</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(list(enumerate(soup.a.next_siblings)))<span class="comment"># 后面的兄弟节点</span></span><br><span class="line">print(list(enumerate(soup.a.previous_siblings)))<span class="comment"># 前面的兄弟节点</span></span><br></pre></td></tr></table></figure>
<h3 id="标准选择器-find-和-find-all"><a href="#标准选择器-find-和-find-all" class="headerlink" title="标准选择器 find 和 find_all"></a>标准选择器 find 和 find_all</h3><h4 id="find-all-name-attrs-recursive-text-kwargs"><a href="#find-all-name-attrs-recursive-text-kwargs" class="headerlink" title="find_all(name,attrs,recursive,text,**kwargs)"></a>find_all(name,attrs,recursive,text,**kwargs)</h4><h5 id="name"><a href="#name" class="headerlink" title="name"></a>name</h5><ul>
<li>这里是找标签为ul的代码，并且返回一个迭代器</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.find_all(<span class="string">'ul'</span>))</span><br><span class="line">print(type(soup.find_all(<span class="string">'ul'</span>)[<span class="number">0</span>]))</span><br></pre></td></tr></table></figure>
<ul>
<li>先把每一个ul拿出来，再嵌套一层遍历</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line"><span class="keyword">for</span> ul <span class="keyword">in</span> soup.find_all(<span class="string">'ul'</span>):</span><br><span class="line">	print(ul.find_all(<span class="string">'li'</span>))</span><br></pre></td></tr></table></figure>
<h5 id="attrs"><a href="#attrs" class="headerlink" title="attrs"></a>attrs</h5><ul>
<li>传入一个字典，键名是属性名，键值是属性值</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.find_all(attrs=(<span class="string">'id'</span>:<span class="string">'list-1'</span>)))</span><br></pre></td></tr></table></figure>
<ul>
<li>直接用等于会更加方便，也不会用到attrs了</li>
<li>class比较特殊，需要用class_</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.find_all(id=<span class="string">'list-1'</span>))</span><br><span class="line">print(soup.find_all(class_=<span class="string">'element'</span>))</span><br></pre></td></tr></table></figure>
<h5 id="text"><a href="#text" class="headerlink" title="text"></a>text</h5><ul>
<li>对文本的内容进行选择</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.find_all(text=<span class="string">'Foo'</span>))<span class="comment"># 直接返回里面的name，可以做内容匹配</span></span><br></pre></td></tr></table></figure>
<h4 id="find-name-attrs-recursive-text-kwargs"><a href="#find-name-attrs-recursive-text-kwargs" class="headerlink" title="find(name,attrs,recursive,text,**kwargs)"></a>find(name,attrs,recursive,text,**kwargs)</h4><ul>
<li><p>find返回单个元素，find_all 返回所有元素</p>
</li>
<li><p>find_parents() 和find_parents()</p>
<ul>
<li>前者返回所有祖先节点，后者返回父节点</li>
</ul>
</li>
<li>find_previous_siblings()和find_previous_sibling ()<ul>
<li>前者返回所有的前面的兄弟节点，后者只返回前面的第一个兄弟节点</li>
</ul>
</li>
<li>find_next_siblings()和find_next_sibling ()<ul>
<li>前者返回所有的后面的兄弟节点，后者只返回后面的第一个兄弟节点</li>
</ul>
</li>
<li>find_all_next{} 和 find_next()<ul>
<li>前者返回节点后所有符合条件的节点，后面返回第一个符合条件的节点</li>
</ul>
</li>
<li>find_all_previous{}和find_previous()<ul>
<li>同理</li>
</ul>
</li>
</ul>
<h3 id="css-选择器-select"><a href="#css-选择器-select" class="headerlink" title="css 选择器 select()"></a>css 选择器 select()</h3><ul>
<li>通过select()直接传入CSS选择器即可完成选择</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line"><span class="comment"># 如果标签中又class，那么选择器前面要加 . 查找panel里面的panel-heading</span></span><br><span class="line"><span class="comment"># 如&lt;div class = "panel"&gt;&lt;div class = "panel-heading"&gt;</span></span><br><span class="line">print(soup.select(<span class="string">'.panel .panel-heading'</span>))</span><br><span class="line"><span class="comment"># 选择ul中的li</span></span><br><span class="line">print(soup.select(<span class="string">'ul li'</span>))</span><br><span class="line"><span class="comment"># 选择id中的内容，那么要加#</span></span><br><span class="line"><span class="comment">#如 &lt;ul class = "xxx" id ="list-2"&gt;</span></span><br><span class="line">print(soup.select(<span class="string">'#list-2 .element'</span>))</span><br><span class="line">print(type(soup.select(<span class="string">'ul'</span>)[<span class="number">0</span>]))</span><br></pre></td></tr></table></figure>
<ul>
<li>层层迭代</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line"><span class="keyword">for</span> ul <span class="keyword">in</span> soup.select(<span class="string">'ul'</span>):</span><br><span class="line">	print(ul.select(<span class="string">'li'</span>))</span><br></pre></td></tr></table></figure>
<h4 id="获取属性-1"><a href="#获取属性-1" class="headerlink" title="获取属性"></a>获取属性</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line"><span class="keyword">for</span> ul <span class="keyword">in</span> soup.select(<span class="string">'ul'</span>):</span><br><span class="line">	print(ul(<span class="string">'id'</span>))</span><br><span class="line">	print(ul.attr[<span class="string">'id'</span>])</span><br></pre></td></tr></table></figure>
<h4 id="获取内容-1"><a href="#获取内容-1" class="headerlink" title="获取内容"></a>获取内容</h4><ul>
<li>把所有指定的标签中的内容进行输出</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line"><span class="keyword">for</span> li <span class="keyword">in</span> soup.select(<span class="string">'li'</span>):</span><br><span class="line">	print(li.get_text())</span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li>推荐使用lxml解析库，必要时使用html.parser</li>
<li>标签选择筛选功能弱但是速度快</li>
<li>建议使用find()或者find_all()来匹配结果</li>
<li>如果对CSS选择器熟悉用 select()</li>
<li>记住常用的获取属性和文本值的方法</li>
</ul>
<h2 id="pyquery-的基本用法"><a href="#pyquery-的基本用法" class="headerlink" title="pyquery 的基本用法"></a>pyquery 的基本用法</h2><ul>
<li>强大灵活的网页解析库。熟悉jQuery的语法乐意选择PyQuery</li>
</ul>
<h2 id="Selenium的基本用法"><a href="#Selenium的基本用法" class="headerlink" title="Selenium的基本用法"></a>Selenium的基本用法</h2><ul>
<li><p>自动化测试工具，支持多种浏览器，爬虫中主要用来解决JavaScript渲染的问题</p>
</li>
<li><p>当urllib，requests无法获得渲染之后的源代码的时候，selenium可以派上用场</p>
</li>
</ul>
<h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.wait <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="comment"># 声明浏览器的一个对象</span></span><br><span class="line">browser= webdriver.Chrome()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># 传入网址</span></span><br><span class="line">    browser.get(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">    <span class="comment"># 把id=kw的内容赋值给input，这里就是搜索框</span></span><br><span class="line">    input = browser.find_element_by_id(<span class="string">'kw'</span>)</span><br><span class="line">    <span class="comment"># 在搜索框中敲入Python</span></span><br><span class="line">    input.send_keys(<span class="string">'Python'</span>)</span><br><span class="line">    <span class="comment"># 点击回车</span></span><br><span class="line">    input.send_keys(Keys.ENTER)</span><br><span class="line">    <span class="comment"># 等待浏览器，知道content_left被加载出来</span></span><br><span class="line">    wait = WebDriverWait(browser,<span class="number">10</span>)   wait.until(EC.presence_of_all_elements_located((By.ID,<span class="string">'content_left'</span>)))</span><br><span class="line">    <span class="comment"># 打印url</span></span><br><span class="line">    print(browser.current_url)</span><br><span class="line">    <span class="comment"># 打印cookies</span></span><br><span class="line">    print(browser.get_cookies())</span><br><span class="line">    <span class="comment"># 打印网页源代码</span></span><br><span class="line">    print(browser.page_source)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="comment"># 关闭网页</span></span><br><span class="line">    browser.close()</span><br></pre></td></tr></table></figure>
<h3 id="声明浏览器对象"><a href="#声明浏览器对象" class="headerlink" title="声明浏览器对象"></a>声明浏览器对象</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="comment"># 只有安装了该浏览器，才能运行，建议使用chrome，因为会直接弹出，比较直观</span></span><br><span class="line">browser= webdriver.Chrome()</span><br><span class="line">browser= webdriver.Firefox()</span><br><span class="line">browser= webdriver.Edge()</span><br><span class="line">browser= webdriver.Safari()</span><br><span class="line">browser= webdriver.PhantomJS()</span><br></pre></td></tr></table></figure>
<h3 id="访问页面"><a href="#访问页面" class="headerlink" title="访问页面"></a>访问页面</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">from selenium import webdriver</span><br><span class="line">browser&#x3D; webdriver.Chrome()</span><br><span class="line">browser.get(&#39;http:&#x2F;&#x2F;www.taobao.com&#39;)</span><br><span class="line">print(browser.page_source)</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure>
<h3 id="查找元素"><a href="#查找元素" class="headerlink" title="查找元素"></a>查找元素</h3><h4 id="单个元素。find-element"><a href="#单个元素。find-element" class="headerlink" title="单个元素。find_element"></a>单个元素。find_element</h4><ul>
<li>找到输入框，输入信息。找到一些按钮，进行一些操作等等</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">browser= webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'http://www.taobao.com'</span>)</span><br><span class="line"><span class="comment"># 通过id选择</span></span><br><span class="line">input_first = browser.find_element_by_id(<span class="string">'q'</span>)</span><br><span class="line"><span class="comment"># 通过css_selector选择</span></span><br><span class="line">input_second = browser.find_element_by_css_selector(<span class="string">'#q'</span>)</span><br><span class="line"><span class="comment"># 通过xpath选择</span></span><br><span class="line">input_third = browser.find_element_by_xpath(<span class="string">'//*[@id="q"]'</span>)</span><br><span class="line">print(input_first)</span><br><span class="line">print(input_second)</span><br><span class="line">print(input_third)</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure>
<p>可以看到这三种查询结果是一样的</p>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/46.png" alt="示例"></p>
<ul>
<li>常见的查找方式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">browser.find_element_by_xpath()</span><br><span class="line">browser.find_element_by_name()</span><br><span class="line">browser.find_element_by_link_text()</span><br><span class="line">browser.find_element_by_partial_link_text()</span><br><span class="line">browser.find_element_by_tag_name()</span><br><span class="line">browser.find_element_by_class_name()</span><br><span class="line">browser.find_element_by_css_selector()</span><br></pre></td></tr></table></figure>
<ul>
<li>通用查找方式</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line">browser= webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'http://www.taobao.com'</span>)</span><br><span class="line"><span class="comment"># 直接调用find_element,第一个参数是By.查找类型，第二个就是查找内容</span></span><br><span class="line">input_first = browser.find_element(By.ID,<span class="string">'q'</span>)</span><br><span class="line">print(input_first)</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure>
<h4 id="多个元素-find-elements"><a href="#多个元素-find-elements" class="headerlink" title="多个元素 find_elements"></a>多个元素 find_elements</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">browser= webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'http://www.taobao.com'</span>)</span><br><span class="line">lis = browser.find_elements_by_css_selector(<span class="string">'.service-bd li'</span>)</span><br><span class="line">print(lis)</span><br><span class="line"><span class="comment"># 最后输出一个元组</span></span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure>
<ul>
<li>搜索的就是淘宝网的一些分类</li>
</ul>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/47.png" alt="示例"></p>
<ul>
<li>通用查找方式</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line">browser= webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'http://www.taobao.com'</span>)</span><br><span class="line">lis = browser.find_elements(By.CSS_SELECTOR,<span class="string">'.service-bd li'</span>)</span><br><span class="line">print(lis)</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure>
<h3 id="元素交互操作"><a href="#元素交互操作" class="headerlink" title="元素交互操作"></a>元素交互操作</h3><ul>
<li>对获取的元素调用交互方法</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'http://www.taobao.com'</span>)</span><br><span class="line"><span class="comment"># 找到浏览框</span></span><br><span class="line">input = browser.find_element_by_id(<span class="string">'q'</span>)</span><br><span class="line"><span class="comment"># 输入iPhone</span></span><br><span class="line">input.send_keys(<span class="string">'iPhone'</span>)</span><br><span class="line"><span class="comment"># 保持一秒</span></span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 清空</span></span><br><span class="line">input.clear()</span><br><span class="line"><span class="comment"># 输入iPad</span></span><br><span class="line">input.send_keys(<span class="string">'iPad'</span>)</span><br><span class="line"><span class="comment"># 找到搜索按钮</span></span><br><span class="line">button = browser.find_element_by_class_name(<span class="string">'btn-search'</span>)</span><br><span class="line"><span class="comment"># 点击搜索按钮</span></span><br><span class="line">button.click()</span><br></pre></td></tr></table></figure>
<h3 id="交互动作"><a href="#交互动作" class="headerlink" title="交互动作"></a>交互动作</h3><ul>
<li>把动作附加到动作链中串行执行</li>
</ul>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/48.png" alt="示例"></p>
<h3 id="执行JavaScript"><a href="#执行JavaScript" class="headerlink" title="执行JavaScript"></a>执行JavaScript</h3><ul>
<li>有些动作没有分装成api，所以我们传入JavaScript语句实现这个动作</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'http://www.zhihu.com/explore'</span>)</span><br><span class="line"><span class="comment"># 把页面下拉到底部</span></span><br><span class="line">browser.execute_script(<span class="string">'window.scrollTo(0,document.body.scrollHeight)'</span>)</span><br><span class="line"><span class="comment"># 显示内容</span></span><br><span class="line">browser.execute_script(<span class="string">'alert("To Bottom")'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="获取元素信息"><a href="#获取元素信息" class="headerlink" title="获取元素信息"></a>获取元素信息</h3><h4 id="获取属性-2"><a href="#获取属性-2" class="headerlink" title="获取属性"></a>获取属性</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">url = <span class="string">'http://www.zhihu.com/explore'</span></span><br><span class="line">browser.get(url)</span><br><span class="line">logo = browser.find_element_by_id(<span class="string">'zh-top-link-logo'</span>)</span><br><span class="line">print(logo)</span><br><span class="line">print(logo.get_attribute(<span class="string">'class'</span>))</span><br></pre></td></tr></table></figure>
<h4 id="获取文本值"><a href="#获取文本值" class="headerlink" title="获取文本值"></a>获取文本值</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">url = <span class="string">'http://www.zhihu.com/explore'</span></span><br><span class="line">browser.get(url)</span><br><span class="line">input = browser.find_element_by_class_name(<span class="string">'zu-top-add-question'</span>)</span><br><span class="line">print(input.text)</span><br></pre></td></tr></table></figure>
<h4 id="获取ID，位置，标签名，大小"><a href="#获取ID，位置，标签名，大小" class="headerlink" title="获取ID，位置，标签名，大小"></a>获取ID，位置，标签名，大小</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">url = <span class="string">'http://www.zhihu.com/explore'</span></span><br><span class="line">browser.get(url)</span><br><span class="line">input = browser.find_element_by_class_name(<span class="string">'zu-top-add-question'</span>)</span><br><span class="line">print(input.id)</span><br><span class="line">print(input.location)</span><br><span class="line">print(input.tag_name)</span><br><span class="line">print(input.size)<span class="comment"># 宽高</span></span><br></pre></td></tr></table></figure>
<h3 id="Frame"><a href="#Frame" class="headerlink" title="Frame"></a>Frame</h3><ul>
<li>在父级frame中查找子级内容，必须实现frame切换</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> NoSuchElementException</span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">url= <span class="string">'http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'</span></span><br><span class="line"><span class="comment">#请求</span></span><br><span class="line">browser.get(url)</span><br><span class="line"><span class="comment"># 传入frame id 实现切换</span></span><br><span class="line">browser.switch_to.frame(<span class="string">'iframeResult'</span>)</span><br><span class="line"><span class="comment"># 找到拖拽的对象并打印</span></span><br><span class="line">source = browser.find_element_by_css_selector(<span class="string">'#draggable'</span>)</span><br><span class="line">print(source)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># 尝试在子级frame中查找父frame</span></span><br><span class="line">    logo = browser.find_element_by_class_name(<span class="string">'logo'</span>)</span><br><span class="line"><span class="keyword">except</span> NoSuchElementException:</span><br><span class="line">    print(<span class="string">'No Logo'</span>)</span><br><span class="line"><span class="comment"># 切换到父frame</span></span><br><span class="line">browser.switch_to.parent_frame()</span><br><span class="line"><span class="comment"># 再次查找logo</span></span><br><span class="line">logo= browser.find_element_by_class_name(<span class="string">'logo'</span>)</span><br><span class="line">print(logo)</span><br><span class="line">print(logo.text)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/49.png" alt="示例"></p>
<h3 id="等待"><a href="#等待" class="headerlink" title="等待"></a>等待</h3><h4 id="隐式等待"><a href="#隐式等待" class="headerlink" title="隐式等待"></a>隐式等待</h4><ul>
<li>当使用了隐式等待执行测试的时候，如果WebDriver没有在Dom中找到元素，将继续等待，超出设定时间后抛出找不到元素的异常，换句话说，当查找元素或元素并没有立即出现的时候，隐式等待将等待一段时间再查找DOM，默认时间为0</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.implicitly_wait(<span class="number">10</span>)</span><br><span class="line">browser.get(<span class="string">'http://www.zhihu.com/explore'</span>)</span><br><span class="line">input = browser.find_element_by_class_name(<span class="string">'zu-top-add-question'</span>)</span><br><span class="line">print(input)</span><br></pre></td></tr></table></figure>
<h4 id="显示等待"><a href="#显示等待" class="headerlink" title="显示等待"></a>显示等待</h4><ul>
<li>指定一个等待条件</li>
<li>指定一个最长等待时间</li>
<li>如果在等待时间内符合等待条件，那么继续等待，等待到超出等待时间为止</li>
</ul>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/50.png" alt="示例"></p>
<p>下面是我们的等待条件，非常灵活可变</p>
<h3 id="前进后退"><a href="#前进后退" class="headerlink" title="前进后退"></a>前进后退</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"><span class="comment"># 依次打开以下网站</span></span><br><span class="line">browser.get(<span class="string">'http://www.baidu.com/'</span>)</span><br><span class="line">browser.get(<span class="string">'http://www.taobao.com/'</span>)</span><br><span class="line">browser.get(<span class="string">'http://www.python.org/'</span>)</span><br><span class="line"><span class="comment"># 退回上一个网站</span></span><br><span class="line">browser.back()</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 前进到下一个网站</span></span><br><span class="line">browser.forward()</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure>
<h3 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"></span><br><span class="line">browser.get(<span class="string">'http://www.zhihu.com/explore'</span>)</span><br><span class="line">print(browser.get_cookies())</span><br><span class="line">browser.add_cookie(&#123;<span class="string">'name'</span>:<span class="string">'name'</span>,<span class="string">'domain'</span>:<span class="string">'www.zhihu.com'</span>,<span class="string">'value'</span>:<span class="string">'jason'</span>&#125;)</span><br><span class="line">print(browser.get_cookies())</span><br><span class="line">browser.delete_all_cookies()</span><br><span class="line">print(browser.get_cookies())</span><br></pre></td></tr></table></figure>
<ul>
<li>我们看到第二次打印的时候我们加上去的cookie已经出现了</li>
</ul>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/51.png" alt="示例"></p>
<h3 id="选项卡（窗口）管理"><a href="#选项卡（窗口）管理" class="headerlink" title="选项卡（窗口）管理"></a>选项卡（窗口）管理</h3><ul>
<li>通过执行一个js代码，打开一个新窗口</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"></span><br><span class="line">browser.get(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line"><span class="comment"># 新建一个窗口</span></span><br><span class="line">browser.execute_script(<span class="string">'window.open()'</span>)</span><br><span class="line"><span class="comment">#打印选项卡代号</span></span><br><span class="line">print(browser.window_handles)</span><br><span class="line"><span class="comment"># 切换窗口</span></span><br><span class="line">browser.switch_to.window(browser.window_handles[<span class="number">1</span>])</span><br><span class="line">browser.get(<span class="string">'http://www.taobao.com'</span>)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 回切</span></span><br><span class="line">browser.switch_to.window(browser.window_handles[<span class="number">0</span>])</span><br><span class="line">browser.get(<span class="string">'http://python.org'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="异常处理-2"><a href="#异常处理-2" class="headerlink" title="异常处理"></a>异常处理</h3><p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/52.png" alt="示例"></p>
<h2 id="用Requests-正则表达式爬取猫眼电影Top100"><a href="#用Requests-正则表达式爬取猫眼电影Top100" class="headerlink" title="用Requests+正则表达式爬取猫眼电影Top100"></a>用Requests+正则表达式爬取猫眼电影Top100</h2><ul>
<li>流程框架</li>
</ul>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/41.png" alt="示例"></p>
<h3 id="源码一览"><a href="#源码一览" class="headerlink" title="源码一览"></a>源码一览</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> RequestException</span><br><span class="line"><span class="comment"># 猫眼电影直接爬不了，我伪装了一个headers和一个代理</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36 SE 2.X MetaSr 1.0"</span>&#125;</span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">"http"</span>: <span class="string">"http://127.0.0.1:1080"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 写这个get函数还需要进行一个错误判断，否则容易中断</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_one_page</span><span class="params">(url)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url,proxies = proxies,headers=headers)</span><br><span class="line">        response.encoding = <span class="string">'utf-8'</span></span><br><span class="line">        <span class="keyword">if</span> response.status_code ==<span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> response.text</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> RequestException:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"><span class="comment"># 利用正则表达式，筛选出满足我们正则表达式的内容，</span></span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_one_page</span><span class="params">(html)</span>:</span></span><br><span class="line">    pattern = re.compile(<span class="string">'&lt;dd&gt;.*?board-index.*?&gt;(\d*)&lt;/i&gt;.*?data-src="(.*?)".*?name"&gt;&lt;a'</span>+<span class="string">'.*?&gt;(.*?)&lt;/a&gt;.*?star"&gt;(.*?)&lt;/p&gt;.*?releasetime"(.*?)&lt;/p&gt;'</span>+<span class="string">'.*?integer"&gt;(.*?)&lt;/i&gt;.*?fraction"&gt;(.*?)&lt;/i&gt;.*?&lt;/dd&gt;'</span>,re.S)</span><br><span class="line">    items = re.findall(pattern,html)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">        <span class="keyword">yield</span> &#123;</span><br><span class="line">            <span class="string">'index'</span>: item[<span class="number">0</span>],</span><br><span class="line">            <span class="string">'image'</span>: item[<span class="number">1</span>],</span><br><span class="line">            <span class="string">'title'</span>: item[<span class="number">2</span>],</span><br><span class="line">            <span class="string">'actor'</span>: item[<span class="number">3</span>].strip()[<span class="number">3</span>:],</span><br><span class="line">            <span class="string">'time'</span>: item[<span class="number">4</span>].strip()[<span class="number">5</span>:],</span><br><span class="line">            <span class="string">'score'</span>: item[<span class="number">5</span>]+item[<span class="number">6</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"><span class="comment"># 把我们的item写入 一个txt文件       </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_file</span><span class="params">(content)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'result.txt'</span>,<span class="string">'a'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(json.dumps(content,ensure_ascii=<span class="literal">False</span>)+<span class="string">'\n'</span>)</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后用一个字符串叠加的方式，抓取1-10页的所有内容    </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(offset)</span>:</span></span><br><span class="line">    url = <span class="string">'https://maoyan.com/board/4?offset='</span>+str(offset)</span><br><span class="line">    html = get_one_page(url)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> parse_one_page(html):</span><br><span class="line">        print(item)</span><br><span class="line">        write_to_file(item)</span><br><span class="line"><span class="comment"># 用一个遍历的方式，爬取1-10张网页，相当于运行10次main函数，每次爬取一张</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">      main(i*<span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<h3 id="成果展示"><a href="#成果展示" class="headerlink" title="成果展示"></a>成果展示</h3><p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/42.png" alt="示例"></p>
<h3 id="分步解析"><a href="#分步解析" class="headerlink" title="分步解析"></a>分步解析</h3><h4 id="第一步-获取网页源代码"><a href="#第一步-获取网页源代码" class="headerlink" title="第一步:获取网页源代码"></a>第一步:获取网页源代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> RequestException</span><br><span class="line"><span class="comment"># 猫眼电影直接爬不了，我伪装了一个headers和一个代理</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36 SE 2.X MetaSr 1.0"</span>&#125;</span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">"http"</span>: <span class="string">"http://127.0.0.1:1080"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_one_page</span><span class="params">(url)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 在get()中加入proxies和headers参数</span></span><br><span class="line">        response = requests.get(url, proxies=proxies, headers=headers)</span><br><span class="line">        <span class="comment"># 注意，这里必须要设定encoding参数，否则会乱码</span></span><br><span class="line">        response.encoding = <span class="string">'utf-8'</span></span><br><span class="line">        <span class="comment"># 做一个状态码的判断</span></span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> response.text</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> RequestException:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"><span class="comment"># 最后用一个字符串叠加的方式，抓取1-10页的所有内容</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(offset)</span>:</span></span><br><span class="line">    url = <span class="string">'https://maoyan.com/board/4'</span></span><br><span class="line">    html = get_one_page(url)</span><br><span class="line"> 	print(html)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<h4 id="第二步：对目标信息编写正则表达式"><a href="#第二步：对目标信息编写正则表达式" class="headerlink" title="第二步：对目标信息编写正则表达式"></a>第二步：对目标信息编写正则表达式</h4><ul>
<li>我们可以看到，我们得信息源如下</li>
</ul>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/43.png" alt="示例"></p>
<p>括号括起来的内容，就是我们想要的结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;dd&gt; 			获取到标签 &lt;dd&gt;</span><br><span class="line">.*? 			匹配任意字符串</span><br><span class="line">board-index 	匹配 board-index </span><br><span class="line">.*?				匹配任意字符串</span><br><span class="line">&gt; 				匹配&gt;</span><br><span class="line">(\d*) 			匹配我们要的排名，即括号内的内容</span><br><span class="line">&lt;&#x2F;i&gt;			匹配标签&lt;&#x2F;i&gt;</span><br><span class="line">.*?				匹配任意字符串</span><br><span class="line">data-src&#x3D;&quot;(.*?)&quot;匹配封面图片得url，即括号内的内容</span><br><span class="line">.*?name&quot;&gt; 		匹配name标签</span><br><span class="line">&lt;a.*?&gt;		匹配a标签和后续内容</span><br><span class="line">(.*?)			匹配我们电影名字，即括号内的内容</span><br><span class="line">&lt;&#x2F;a&gt;			匹配a标签</span><br><span class="line">.*?				匹配任意字符串</span><br><span class="line">star&quot;&gt;			匹配star标签</span><br><span class="line">(.*?)			匹配我们主演人名，即括号内的内容</span><br><span class="line">&lt;&#x2F;p&gt;			匹配p标签</span><br><span class="line">.*?				匹配任意字符串</span><br><span class="line">releasetime“&gt;   匹配releasetime“&gt; </span><br><span class="line">(.*?)			匹配上映时间，即括号内的内容		</span><br><span class="line">.*?integer&quot;&gt;	匹配任意字符串和integer&quot;&gt;</span><br><span class="line">(.*?)			匹配评分中的整数内容，即括号内的内容	</span><br><span class="line">&lt;&#x2F;i&gt;			匹配&lt;&#x2F;i&gt;标签</span><br><span class="line">.*?fraction&quot;&gt;	匹配任意字符串和fraction&quot;&gt;	</span><br><span class="line">(.*?)			匹配评分中的小数内容，即括号内的内容	</span><br><span class="line">.*? 			匹配任意字符串</span><br><span class="line">,</span><br><span class="line">re.S			匹配任意字符，包括换行符</span><br><span class="line">合起来就是</span><br><span class="line">  pattern &#x3D; re.compile(&#39;&lt;dd&gt;.*?board-index.*?&gt;(\d*)&lt;&#x2F;i&gt;.*?data-src&#x3D;&quot;(.*?)&quot;.*?name&quot;&gt;&lt;a&#39;+&#39;.*?&gt;(.*?)&lt;&#x2F;a&gt;.*?star&quot;&gt;(.*?)&lt;&#x2F;p&gt;.*?releasetime&quot;(.*?)&lt;&#x2F;p&gt;&#39;+&#39;.*?integer&quot;&gt;(.*?)&lt;&#x2F;i&gt;.*?fraction&quot;&gt;(.*?)&lt;&#x2F;i&gt;.*?&lt;&#x2F;dd&gt;&#39;,re.S)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_one_page</span><span class="params">(html)</span>:</span></span><br><span class="line">	pattern = re.compile(<span class="string">'&lt;dd&gt;.*?board-index.*?&gt;(\d*)&lt;/i&gt;.*?data-src="(.*?)".*?name"&gt;&lt;a.*?&gt;(.*?)&lt;/a&gt;.*?star"&gt;(.*?)&lt;/p&gt;.*?releasetime"(.*?)&lt;/p&gt;.*?integer"&gt;(.*?)&lt;/i&gt;.*?fraction"&gt;(.*?)&lt;/i&gt;.*?&lt;/dd&gt;'</span>,re.S)</span><br><span class="line">	items = re.findall(pattern,html)</span><br><span class="line">	print(items)</span><br></pre></td></tr></table></figure>
<ul>
<li>把他们变成字典形式</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_one_page</span><span class="params">(html)</span>:</span></span><br><span class="line">	pattern = re.compile(<span class="string">'&lt;dd&gt;.*?board-index.*?&gt;(\d*)&lt;/i&gt;.*?data-src="(.*?)".*?name"&gt;&lt;a.*?&gt;(.*?)&lt;/a&gt;.*?star"&gt;(.*?)&lt;/p&gt;.*?releasetime"(.*?)&lt;/p&gt;.*?integer"&gt;(.*?)&lt;/i&gt;.*?fraction"&gt;(.*?)&lt;/i&gt;.*?&lt;/dd&gt;'</span>,re.S)</span><br><span class="line">	items = re.findall(pattern,html)</span><br><span class="line">	<span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line"> 	  	<span class="keyword">yield</span> &#123;</span><br><span class="line">           <span class="string">'index'</span>: item[<span class="number">0</span>],</span><br><span class="line">           <span class="string">'image'</span>: item[<span class="number">1</span>],</span><br><span class="line">           <span class="string">'title'</span>: item[<span class="number">2</span>],</span><br><span class="line">           <span class="string">'actor'</span>: item[<span class="number">3</span>].strip()[<span class="number">3</span>:],</span><br><span class="line">           <span class="comment"># 主演：克里斯蒂安·贝尔,希斯·莱杰,阿伦·伊克哈特</span></span><br><span class="line">           <span class="comment"># 这里直接从第三个字符冒号后开始切片截取</span></span><br><span class="line">           <span class="string">'time'</span>: item[<span class="number">4</span>].strip()[<span class="number">5</span>:],</span><br><span class="line">           <span class="comment">#上映时间：2008-07-14(阿根廷)</span></span><br><span class="line">           <span class="comment"># 这里直接从冒号后面开始切片</span></span><br><span class="line">           <span class="string">'score'</span>: item[<span class="number">5</span>]+item[<span class="number">6</span>]<span class="comment"># 把评分拼接</span></span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<h5 id="这一步的代码"><a href="#这一步的代码" class="headerlink" title="这一步的代码"></a>这一步的代码</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re <span class="comment">#即regular expression</span></span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> RequestException</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36 SE 2.X MetaSr 1.0"</span>&#125;</span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">"http"</span>: <span class="string">"http://127.0.0.1:1080"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_one_page</span><span class="params">(url)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url, proxies=proxies, headers=headers)</span><br><span class="line">        response.encoding = <span class="string">'utf-8'</span></span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> response.text</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> RequestException:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_one_page</span><span class="params">(html)</span>:</span></span><br><span class="line">    pattern = re.compile(</span><br><span class="line">        <span class="string">'&lt;dd&gt;.*?board-index.*?&gt;(\d*)&lt;/i&gt;.*?data-src="(.*?)".*?name"&gt;&lt;a'</span> + <span class="string">'.*?&gt;(.*?)&lt;/a&gt;.*?star"&gt;(.*?)&lt;/p&gt;.*?releasetime"(.*?)&lt;/p&gt;'</span> + <span class="string">'.*?integer"&gt;(.*?)&lt;/i&gt;.*?fraction"&gt;(.*?)&lt;/i&gt;.*?&lt;/dd&gt;'</span>,</span><br><span class="line">        re.S)</span><br><span class="line">    items = re.findall(pattern, html)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">        <span class="keyword">yield</span> &#123;</span><br><span class="line">            <span class="string">'index'</span>: item[<span class="number">0</span>],</span><br><span class="line">            <span class="string">'image'</span>: item[<span class="number">1</span>],</span><br><span class="line">            <span class="string">'title'</span>: item[<span class="number">2</span>],</span><br><span class="line">            <span class="string">'actor'</span>: item[<span class="number">3</span>].strip()[<span class="number">3</span>:],</span><br><span class="line">            <span class="string">'time'</span>: item[<span class="number">4</span>].strip()[<span class="number">5</span>:],</span><br><span class="line">            <span class="string">'score'</span>: item[<span class="number">5</span>] + item[<span class="number">6</span>]</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">       </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">( )</span>:</span></span><br><span class="line">    url = <span class="string">'https://maoyan.com/board/4?'</span>  </span><br><span class="line">    html = get_one_page(url)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> parse_one_page(html):</span><br><span class="line">        print(item)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">        main()</span><br></pre></td></tr></table></figure>
<h5 id="效果如图"><a href="#效果如图" class="headerlink" title="效果如图"></a>效果如图</h5><p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/44.png" alt="示例"></p>
<h4 id="第三步，把他们写入到我的文件中"><a href="#第三步，把他们写入到我的文件中" class="headerlink" title="第三步，把他们写入到我的文件中"></a>第三步，把他们写入到我的文件中</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把我们的item写入 一个txt文件       </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_file</span><span class="params">(content)</span>:</span></span><br><span class="line"><span class="comment"># 用一个with的形式，'a'代表往后追加的方式，encoding代表编码，否则就是一堆乱七八糟的</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'result.txt'</span>,<span class="string">'a'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="comment"># 使用json的api需要导入json包</span></span><br><span class="line">        <span class="comment"># 防止乱码，还需要这样，把ensure_ascii设置成False</span></span><br><span class="line">        f.write(json.dumps(content,ensure_ascii=<span class="literal">False</span>)+<span class="string">'\n'</span>)</span><br><span class="line">        f.close()</span><br></pre></td></tr></table></figure>
<h5 id="加入这个函数后，效果如图"><a href="#加入这个函数后，效果如图" class="headerlink" title="加入这个函数后，效果如图"></a>加入这个函数后，效果如图</h5><p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/45.png" alt="示例"></p>
<h4 id="第四步，通过字符串改造的方式爬取10页"><a href="#第四步，通过字符串改造的方式爬取10页" class="headerlink" title="第四步，通过字符串改造的方式爬取10页"></a>第四步，通过字符串改造的方式爬取10页</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 最后用一个字符串叠加的方式，抓取1-10页的所有内容    </span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(offset)</span>:</span></span><br><span class="line">    url = <span class="string">'https://maoyan.com/board/4?offset='</span>+str(offset)</span><br><span class="line">    html = get_one_page(url)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> parse_one_page(html):</span><br><span class="line">        print(item)</span><br><span class="line">        write_to_file(item)</span><br><span class="line"><span class="comment"># 用一个遍历的方式，爬取1-10张网页，相当于运行10次main函数，每次爬取一张</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">      main(i*<span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<h4 id="番外，利用多线程实现秒爬（但是这样Top100顺序就乱了）"><a href="#番外，利用多线程实现秒爬（但是这样Top100顺序就乱了）" class="headerlink" title="番外，利用多线程实现秒爬（但是这样Top100顺序就乱了）"></a>番外，利用多线程实现秒爬（但是这样Top100顺序就乱了）</h4><ul>
<li>开头引入</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from multiprocessing import Pool</span><br></pre></td></tr></table></figure>
<ul>
<li>对结尾进行改造</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"><span class="comment"># 这是一个进程池，池还没有满就创建进程并运行，否则就待命</span></span><br><span class="line">	pool = Pool()</span><br><span class="line">	<span class="comment"># 把map中的元素提取出来创建进程</span></span><br><span class="line">	pool.map(main, [i*<span class="number">10</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>)])</span><br></pre></td></tr></table></figure>
<h3 id="如法炮制，我也制作了一个爬取豆瓣top250的电影"><a href="#如法炮制，我也制作了一个爬取豆瓣top250的电影" class="headerlink" title="如法炮制，我也制作了一个爬取豆瓣top250的电影"></a>如法炮制，我也制作了一个爬取豆瓣top250的电影</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> RequestException</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36 SE 2.X MetaSr 1.0"</span>&#125;</span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">"http"</span>: <span class="string">"http://127.0.0.1:1080"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_one_page</span><span class="params">(url)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = requests.get(url, proxies=proxies, headers=headers)</span><br><span class="line">        <span class="comment"># 注意，这里必须要设定encoding参数，否则会乱码</span></span><br><span class="line">        response.encoding = <span class="string">'utf-8'</span></span><br><span class="line">        <span class="comment"># 做一个状态码的判断</span></span><br><span class="line">        <span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">            <span class="keyword">return</span> response.text</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">except</span> RequestException:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_one_page</span><span class="params">(html)</span>:</span></span><br><span class="line">    pattern = re.compile(<span class="string">'&lt;li&gt;.*?em.*?&gt;(\d*)&lt;/em&gt;.*?src="(.*?)".*?&lt;span class="title"&gt;(.*?)&lt;/span&gt;.*?"title"&gt;&amp;nbsp;/&amp;nbsp;(.*?)&lt;/span&gt;.*?other"&gt;&amp;nbsp;/&amp;nbsp;(.*?)&lt;/span&gt;.*?bd"&gt;.*?class=""&gt;\s(.*?)&amp;nbsp;&amp;nbsp;&amp;nbsp;(.*?)&lt;br&gt;(.*?)&amp;nbsp;/&amp;nbsp;(.*?)&amp;nbsp;/&amp;nbsp;(.*?)&lt;/p&gt;.*?average"&gt;(\d.\d).*?inq"&gt;(.*?)&lt;/span&gt;'</span>,re.S)</span><br><span class="line">    items = re.findall(pattern, html)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">        <span class="keyword">yield</span> &#123;</span><br><span class="line">            <span class="string">'index'</span>: item[<span class="number">0</span>],</span><br><span class="line">            <span class="string">'image'</span>: item[<span class="number">1</span>],</span><br><span class="line">            <span class="string">'title'</span>: item[<span class="number">2</span>],</span><br><span class="line">            <span class="string">'other title'</span>: item[<span class="number">3</span>]+item[<span class="number">4</span>],</span><br><span class="line">            <span class="string">'director'</span>: item[<span class="number">5</span>].strip()[<span class="number">3</span>:],</span><br><span class="line">            <span class="string">'actor'</span>: item[<span class="number">6</span>].strip()[<span class="number">3</span>:] ,</span><br><span class="line">            <span class="string">'time'</span>:item[<span class="number">7</span>].strip()[<span class="number">0</span>:],</span><br><span class="line">            <span class="string">'country'</span>:item[<span class="number">8</span>],</span><br><span class="line">            <span class="string">'sort'</span>:item[<span class="number">9</span>].strip()[:<span class="number">20</span>],</span><br><span class="line">            <span class="string">'score'</span>:item[<span class="number">10</span>],</span><br><span class="line">            <span class="string">'quote'</span>:item[<span class="number">11</span>]</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment"># 把我们的item写入 一个txt文件a</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_to_file</span><span class="params">(content)</span>:</span></span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'result.txt'</span>,<span class="string">'a'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(json.dumps(content,ensure_ascii=<span class="literal">False</span>)+<span class="string">'\n'</span>)</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(offset)</span>:</span></span><br><span class="line">    url = <span class="string">'https://movie.douban.com/top250?start='</span>+str(offset)+<span class="string">'&amp;filter='</span></span><br><span class="line">    html = get_one_page(url)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> parse_one_page(html):</span><br><span class="line">        print(item)</span><br><span class="line">        write_to_file(item)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">            main(i * <span class="number">25</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>结果如下</li>
</ul>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/54.png" alt="示例"></p>
<h2 id="用selenium-Chrome-爬取淘宝宝贝信息"><a href="#用selenium-Chrome-爬取淘宝宝贝信息" class="headerlink" title="用selenium + Chrome 爬取淘宝宝贝信息"></a>用selenium + Chrome 爬取淘宝宝贝信息</h2><h4 id="所用工具：-selenium包，Chrome-driver无头浏览器，pymongo-MongoDB数据库"><a href="#所用工具：-selenium包，Chrome-driver无头浏览器，pymongo-MongoDB数据库" class="headerlink" title="所用工具： selenium包，Chrome.driver无头浏览器，pymongo+MongoDB数据库"></a>所用工具： selenium包，Chrome.driver无头浏览器，pymongo+MongoDB数据库</h4><h3 id="源码一览-1"><a href="#源码一览-1" class="headerlink" title="源码一览"></a>源码一览</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> TimeoutException</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">wait = WebDriverWait(browser, <span class="number">20</span>)</span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client = pymongo.MongoClient(MONGO_URL)</span><br><span class="line">db = client[MONGO_DB]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        browser.get(<span class="string">'http://www.taobao.com'</span> )</span><br><span class="line">        input = wait.until(EC.presence_of_element_located((By.XPATH, <span class="string">'//*[@id="q"]'</span>)))</span><br><span class="line">        submit = wait.until(</span><br><span class="line">            EC.element_to_be_clickable((By.CSS_SELECTOR, <span class="string">'#J_TSearchForm &gt; div.search-button &gt; button'</span>)))</span><br><span class="line">        input.send_keys(<span class="string">'美食'</span>)</span><br><span class="line">        submit.click()</span><br><span class="line">        total = wait.until(</span><br><span class="line">            EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'#mainsrp-pager &gt; div &gt; div &gt; div &gt; div.total'</span>)))</span><br><span class="line">        get_products()</span><br><span class="line">        <span class="keyword">return</span> total.text</span><br><span class="line">    <span class="keyword">except</span> TimeoutException:</span><br><span class="line">        <span class="keyword">return</span> search()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">next_page</span><span class="params">(page_number)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        input = wait.until(</span><br><span class="line">            EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'#mainsrp-pager &gt; div &gt; div &gt; div &gt; div.form &gt; input'</span>)))</span><br><span class="line">        submit = wait.until(EC.element_to_be_clickable((By.CSS_SELECTOR, <span class="string">'#mainsrp-pager &gt; div &gt; div &gt; div &gt; div.form &gt; span.btn.J_Submit'</span>)))</span><br><span class="line">        input.clear()</span><br><span class="line">        input.send_keys(page_number)</span><br><span class="line">        submit.click()</span><br><span class="line">        wait.until(EC.text_to_be_present_in_element(</span><br><span class="line">            (By.CSS_SELECTOR, <span class="string">'#mainsrp-pager &gt; div &gt; div &gt; div &gt; ul &gt; li.item.active &gt; span'</span>),str(page_number)))</span><br><span class="line">        get_products()</span><br><span class="line">    <span class="keyword">except</span> TimeoutException:</span><br><span class="line">        next_page(page_number)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_products</span><span class="params">()</span>:</span></span><br><span class="line">    wait.until(EC.presence_of_element_located((By.CSS_SELECTOR,<span class="string">'#mainsrp-itemlist .items .item'</span>)))</span><br><span class="line">    html=browser.page_source</span><br><span class="line">    doc=pq(html)</span><br><span class="line">    items = doc(<span class="string">'#mainsrp-itemlist .items .item'</span>).items()</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">        product = &#123;</span><br><span class="line">            <span class="string">'image'</span>: item.find(<span class="string">'.pic .img'</span>).attr(<span class="string">'src'</span>),</span><br><span class="line">            <span class="string">'price'</span>: item.find(<span class="string">'.price'</span>).text(),</span><br><span class="line">            <span class="string">'deal'</span>: item.find(<span class="string">'.deal-cnt'</span>).text()[:<span class="number">-3</span>],</span><br><span class="line">            <span class="string">'title'</span>: item.find(<span class="string">'.title'</span>).text(),</span><br><span class="line">            <span class="string">'shop'</span>: item.find(<span class="string">'.shop'</span>).text(),</span><br><span class="line">            <span class="string">'location'</span>: item.find(<span class="string">'.location'</span>).text(),</span><br><span class="line">        &#125;</span><br><span class="line">        print(product)</span><br><span class="line">        save_to_mongo(product)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_to_mongo</span><span class="params">(result)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> db[MONGO_TABLE].insert(result):</span><br><span class="line">            print(<span class="string">'存储到MONGODB成功'</span>,result)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        print(<span class="string">'存储到MonGoDB失败'</span>,result)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    search()</span><br><span class="line">    total = search()</span><br><span class="line">    total = int(re.compile(<span class="string">'(\d+)'</span>).search(total).group(<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, total + <span class="number">1</span>):</span><br><span class="line">        time.sleep(<span class="number">10</span>)</span><br><span class="line">        next_page(i)</span><br><span class="line">    browser.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<h3 id="成果展示-1"><a href="#成果展示-1" class="headerlink" title="成果展示"></a>成果展示</h3><p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/55.png" alt="示例"></p>
<h3 id="分步解析-1"><a href="#分步解析-1" class="headerlink" title="分步解析"></a>分步解析</h3><h4 id="搜索关键字"><a href="#搜索关键字" class="headerlink" title="搜索关键字"></a>搜索关键字</h4><ul>
<li>我们这一步的目的就是模拟搜索关键字的操作<ul>
<li>找到搜索框</li>
<li>点击搜索</li>
</ul>
</li>
<li>我们需要判断浏览器是否已经达到了我们想要的操作，要实现这一点，selenium中的wait模块可以解决<a href="https://selenium-python.readthedocs.io/waits.html" target="_blank" rel="noopener">Selenium官方文档</a> </li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"></span><br><span class="line">driver = webdriver.Firefox()</span><br><span class="line">driver.get(<span class="string">"http://somedomain/url_that_delays_loading"</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="comment"># 设置时间</span></span><br><span class="line">    element = WebDriverWait(driver, <span class="number">10</span>).until(</span><br><span class="line">        <span class="comment"># 设置条件，设置要加载的目标</span></span><br><span class="line">        EC.presence_of_element_located((By.ID<span class="comment">#这是个选择器, "myDynamicElement"))</span></span><br><span class="line">    )</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    driver.quit()</span><br></pre></td></tr></table></figure>
<p>在我们的代码中，需要改一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">wait = WebDriverWait(browser, <span class="number">20</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        browser.get(<span class="string">'http://www.taobao.com'</span> )</span><br><span class="line">        input = </span><br><span class="line">        <span class="comment"># 只要在dev_tool中在标签点击右键copy，选择类型即可</span></span><br><span class="line">        wait.until(EC.presence_of_element_located((By.XPATH, <span class="string">'//*[@id="q"]'</span>)))<span class="comment"># 这里找的是输入框直到加载出来才完成操作</span></span><br><span class="line">        submit = wait.until(</span><br><span class="line">            <span class="comment"># 这里找的是确定按钮，这里的条件是等到按钮能够点击，才结束</span></span><br><span class="line">            EC.element_to_be_clickable((By.CSS_SELECTOR, <span class="string">'#J_TSearchForm &gt; div.search-button &gt; button'</span>)))</span><br><span class="line">        <span class="comment"># 输入美食这个关键字</span></span><br><span class="line">        input.send_keys(<span class="string">'美食'</span>)</span><br><span class="line">        submit.click()</span><br><span class="line">        total = wait.until(</span><br><span class="line">            <span class="comment"># 这里找的是一共有多少页的显示框，条件是当这个框显示出来的时候</span></span><br><span class="line">            EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'#mainsrp-pager &gt; div &gt; div &gt; div &gt; div.total'</span>)))</span><br><span class="line">        <span class="comment"># 返回我们的总页数</span></span><br><span class="line">        <span class="keyword">return</span> total.text</span><br><span class="line">    <span class="comment"># 用except捕捉这个错误</span></span><br><span class="line">    <span class="keyword">except</span> TimeoutException:</span><br><span class="line">        <span class="comment"># 如果出现了错误，我们递归一下</span></span><br><span class="line">        <span class="keyword">return</span> search()</span><br></pre></td></tr></table></figure>
<ul>
<li>在main函数中的操作</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 这里调用search</span></span><br><span class="line">    search()</span><br><span class="line">    <span class="comment"># total接受了search()返回的内容，我们要在这里提取出总页数来</span></span><br><span class="line">    total = search()</span><br><span class="line">    <span class="comment"># 利用正则表达式模块剔除汉字获得数字，在total中serach，然后类型转换为int类型</span></span><br><span class="line">    total = int(re.compile(<span class="string">'(\d+)'</span>).search(total).group(<span class="number">1</span>))</span><br><span class="line">    <span class="comment"># 通过一个循环，从第二页开始一直到最后，用range实现遍历操作</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, total + <span class="number">1</span>):</span><br><span class="line">        time.sleep(<span class="number">10</span>)</span><br><span class="line">        next_page(i)</span><br><span class="line">    browser.close()</span><br></pre></td></tr></table></figure>
<h4 id="分析页码并翻页"><a href="#分析页码并翻页" class="headerlink" title="分析页码并翻页"></a>分析页码并翻页</h4><ul>
<li><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/57.png" alt="示例"></li>
</ul>
<p>我们可以看到，要实现这个翻页，一页一页按那个高亮按钮不太实际（每一个按钮的标签可能都不一样），所以我们在搜索框中输入第几页，然后点击确定后，再做一个判断即可完成</p>
<ul>
<li>所以我们首先要拿到第几页这个输入框，然后拿到旁边的确定按钮，最后传入数字点击确认</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">next_page</span><span class="params">(page_number)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 获取到目标输入框</span></span><br><span class="line">        input = wait.until(</span><br><span class="line">            EC.presence_of_element_located((By.CSS_SELECTOR, <span class="string">'#mainsrp-pager &gt; div &gt; div &gt; div &gt; div.form &gt; input'</span>)))</span><br><span class="line">        <span class="comment"># 获取到确认提交按钮</span></span><br><span class="line">        submit = wait.until(EC.element_to_be_clickable((By.CSS_SELECTOR, <span class="string">'#mainsrp-pager &gt; div &gt; div &gt; div &gt; div.form &gt; span.btn.J_Submit'</span>)))</span><br><span class="line">        <span class="comment"># 首先清除框中内容</span></span><br><span class="line">        input.clear()</span><br><span class="line">        <span class="comment"># 然后把这个循环对应得号码传入</span></span><br><span class="line">        input.send_keys(page_number)</span><br><span class="line">        <span class="comment"># 点击确认</span></span><br><span class="line">        submit.click()</span><br><span class="line">        <span class="comment">#这里做一个text_to_be_present_in_element类型得判断，就是当高亮页面标中的内容与我们传入的页数一致的时候，说明完成操作</span></span><br><span class="line">        wait.until(EC.text_to_be_present_in_element(</span><br><span class="line">            (By.CSS_SELECTOR, <span class="string">'#mainsrp-pager &gt; div &gt; div &gt; div &gt; ul &gt; li.item.active &gt; span'</span>),str(page_number)))</span><br><span class="line">        <span class="comment"># 最后捕捉错误信息，如果出错那么重新来过</span></span><br><span class="line">    <span class="keyword">except</span> TimeoutException:</span><br><span class="line">        next_page(page_number)</span><br></pre></td></tr></table></figure>
<h4 id="分析提取商品内容"><a href="#分析提取商品内容" class="headerlink" title="分析提取商品内容"></a>分析提取商品内容</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_products</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 先做一个判断，如果这个地方通过，说明这个页面中所有的宝贝信息都已经加载好了</span></span><br><span class="line">    <span class="comment"># 这个所有的宝贝标签都是这个标签下的子标签</span></span><br><span class="line">    wait.until(EC.presence_of_element_located((By.CSS_SELECTOR,<span class="string">'#mainsrp-itemlist .items .item'</span>)))</span><br><span class="line">    <span class="comment"># 获取网页源代码信息</span></span><br><span class="line">    html=browser.page_source</span><br><span class="line">    <span class="comment"># 利用pyquery解析我们的网页源代码</span></span><br><span class="line">    doc=pq(html)</span><br><span class="line">    <span class="comment"># 然后把源代码这个标签下的所有</span></span><br><span class="line">    items = doc(<span class="string">'#mainsrp-itemlist .items .item'</span>).items()<span class="comment"># 获取所有选择的内容</span></span><br><span class="line">    <span class="comment"># 分析每个item中的内容</span></span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">        product = &#123;</span><br><span class="line">            <span class="comment"># 找到这个标签中，属性为src的内容作为我们的图片信息</span></span><br><span class="line">            <span class="string">'image'</span>: item.find(<span class="string">'.pic .img'</span>).attr(<span class="string">'src'</span>),</span><br><span class="line">            <span class="comment"># 找到这个price标签 ，提取价格</span></span><br><span class="line">            <span class="string">'price'</span>: item.find(<span class="string">'.price'</span>).text(),</span><br><span class="line">            <span class="comment"># 找到.deal-cnt这个标签，然后从开头直到倒数第三个，为了截取我们想要的成交量</span></span><br><span class="line">            <span class="string">'deal'</span>: item.find(<span class="string">'.deal-cnt'</span>).text()[:<span class="number">-3</span>],</span><br><span class="line">            <span class="comment"># 找到class为title的标签，提取标题</span></span><br><span class="line">            <span class="string">'title'</span>: item.find(<span class="string">'.title'</span>).text(),</span><br><span class="line">            <span class="comment"># 找到class= shop的标签，提取商家名字</span></span><br><span class="line">            <span class="string">'shop'</span>: item.find(<span class="string">'.shop'</span>).text(),</span><br><span class="line">            <span class="comment"># 找到class= location的标签，提取卖家地点</span></span><br><span class="line">            <span class="string">'location'</span>: item.find(<span class="string">'.location'</span>).text(),</span><br><span class="line">        &#125;</span><br><span class="line">        print(product)</span><br></pre></td></tr></table></figure>
<ul>
<li>写完get_products操作以后，需要在一开始的search函数中调用一下（因为next_page(page_number)是从第二页开始的，所以要获取第一页的宝贝信息</li>
<li>此外在next_page 这个函数中也要调用，来获得2-100页的所有宝贝信息</li>
</ul>
<h4 id="存储到MongoDB"><a href="#存储到MongoDB" class="headerlink" title="存储到MongoDB"></a>存储到MongoDB</h4><p>新建一个config文件，存储一些连接到MongoDB的基本信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 账户时localhost</span></span><br><span class="line">MONGO_URL = <span class="string">'localhost'</span></span><br><span class="line"><span class="comment"># 数据库是taobao，如果没有那么会自动新建</span></span><br><span class="line">MONGO_DB = <span class="string">'taobao'</span></span><br><span class="line"><span class="comment"># 数据表名叫做product</span></span><br><span class="line">MONGO_TABLE = <span class="string">'product'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在开头设置一下配置信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"><span class="comment"># 设定账户</span></span><br><span class="line">client = pymongo.MongoClient(MONGO_URL)</span><br><span class="line"><span class="comment"># 设定数据库</span></span><br><span class="line">db = client[MONGO_DB]</span><br></pre></td></tr></table></figure>
<ul>
<li>写一个写入函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">save_to_mongo</span><span class="params">(result)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 插入到目标数据表中，并判断成功与否</span></span><br><span class="line">        <span class="keyword">if</span> db[MONGO_TABLE].insert(result):</span><br><span class="line">            print(<span class="string">'存储到MONGODB成功'</span>,result)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        print(<span class="string">'存储到MonGoDB失败'</span>,result)</span><br></pre></td></tr></table></figure>
<ul>
<li>然后再get_product函数的item遍历中调用，把每条宝贝信息传入数据库</li>
</ul>
<h4 id="总结与反思"><a href="#总结与反思" class="headerlink" title="总结与反思"></a>总结与反思</h4><ul>
<li><p>虽然是照着视频一步一步写下来的，但是中间仍然出现了很多错误和困难</p>
</li>
<li><p>淘宝网现在出了反爬虫机制，如果爬的太快我们就会受到永远都通不过的滑块验证码，这是因为淘宝检测出了你使用的webdriver，我在晚上爬取一次后换个关键词，也仍然解决不了问题（看来有冷却时间）第二天又运行一遍后才回复正常。不过我们写爬虫只是练手，并不要求高效率。所以我把等待时间调整为每次爬取一页停留十秒，这样在第一次爬取的时候可以轻松爬完100页。（再试一次就又有问题了）</p>
</li>
<li><p>通过这个爬虫经历学会了如何把数据存储到MongoDB中，这样稍作修改，那么我先前爬取的豆瓣电影和猫眼电影都可以通过这种方式存储了</p>
</li>
<li><p>这是两张电影排行表的最终效果<img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/58.png" alt="示例"></p>
</li>
</ul>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/59.png" alt="示例"></p>
<p><img src="/2020/04/30/%E4%BB%8E-1%E5%BC%80%E5%A7%8B%E7%9A%84python%E7%88%AC%E8%99%AB/60.png" alt="示例"></p>
<h2 id="有话要说"><a href="#有话要说" class="headerlink" title="有话要说"></a>有话要说</h2><p>python爬虫的故事到这里还并没有结束，只不过下面开始要进入PySpider框架和Scrapy框架的学习了，所占用的时间和空间过于繁琐，故另起炉灶。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/04/30/946%E9%AA%8C%E8%AF%81%E6%A0%88%E5%BA%8F%E5%88%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/30/946%E9%AA%8C%E8%AF%81%E6%A0%88%E5%BA%8F%E5%88%97/" class="post-title-link" itemprop="url">946验证栈序列</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-04-30 20:35:19" itemprop="dateCreated datePublished" datetime="2020-04-30T20:35:19+08:00">2020-04-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-09 23:33:10" itemprop="dateModified" datetime="2020-05-09T23:33:10+08:00">2020-05-09</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="946验证栈序列"><a href="#946验证栈序列" class="headerlink" title="946验证栈序列"></a>946验证栈序列</h1><h2 id="下面是题目"><a href="#下面是题目" class="headerlink" title="下面是题目"></a>下面是题目</h2><p><img src="/2020/04/30/946%E9%AA%8C%E8%AF%81%E6%A0%88%E5%BA%8F%E5%88%97/2.png" alt></p>
<h3 id="下面是题目给出的代码"><a href="#下面是题目给出的代码" class="headerlink" title="下面是题目给出的代码"></a>下面是题目给出的代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">validateStackSequences</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; pushed, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; popped)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="一开始我没有考虑到出栈顺序，所以给出了这个"><a href="#一开始我没有考虑到出栈顺序，所以给出了这个" class="headerlink" title="一开始我没有考虑到出栈顺序，所以给出了这个"></a>一开始我没有考虑到出栈顺序，所以给出了这个</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">validateStackSequences</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; pushed, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; popped)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//也就是说先遍历pushed栈，匹配上了直接出栈，匹配不上再一一入栈</span></span><br><span class="line">        <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt;stk;</span><br><span class="line">        <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;pushed.<span class="built_in">size</span>();i++)</span><br><span class="line">        &#123;</span><br><span class="line">           </span><br><span class="line">            <span class="keyword">if</span>(pushed[i]==popped[j])</span><br><span class="line">                j++;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                stk.push(pushed[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//然后再和pop一一匹配</span></span><br><span class="line">        <span class="keyword">while</span>(!stk.empty())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(stk.top()==popped[j])</span><br><span class="line">            &#123;</span><br><span class="line">                 stk.pop();</span><br><span class="line">                 j++;</span><br><span class="line">            &#125;     </span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//但是这样是不科学的，push[1,2,0],pop[2,1,0]</span></span><br></pre></td></tr></table></figure>
<h3 id="但是存在-1-2-0-2-1-0-这样的数据。也就是说可能进栈又马上出栈，所以还要再判断"><a href="#但是存在-1-2-0-2-1-0-这样的数据。也就是说可能进栈又马上出栈，所以还要再判断" class="headerlink" title="但是存在[1,2,0],[2,1,0]这样的数据。也就是说可能进栈又马上出栈，所以还要再判断"></a>但是存在[1,2,0],[2,1,0]这样的数据。也就是说可能进栈又马上出栈，所以还要再判断</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">validateStackSequences</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; pushed, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; popped)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt;stk;</span><br><span class="line">        <span class="keyword">int</span> k = <span class="number">0</span>;</span><br><span class="line">         <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;popped.<span class="built_in">size</span>();i++)</span><br><span class="line">         &#123;</span><br><span class="line">             stk.push(pushed[i]);</span><br><span class="line">    <span class="comment">//每次入栈以后再判断，栈非空，pop栈为遍历完且栈顶==popped[k],而且还要循环！</span></span><br><span class="line">    <span class="keyword">while</span>((!stk.empty())&amp;&amp;k&lt;popped.<span class="built_in">size</span>()&amp;&amp;(stk.top()==popped[k]))&#123;</span><br><span class="line">                 stk.pop();</span><br><span class="line">                 k++;<span class="comment">//如果匹配成功，k移位</span></span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">        <span class="keyword">return</span> stk.empty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="当然，还有一种做法有-l’etat-c’est-moi的感觉"><a href="#当然，还有一种做法有-l’etat-c’est-moi的感觉" class="headerlink" title="当然，还有一种做法有 l’etat, c’est moi的感觉"></a>当然，还有一种做法有 l’etat, c’est moi的感觉</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">      <span class="function"><span class="keyword">bool</span> <span class="title">validateStackSequences</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; pushed, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; popped)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> <span class="built_in">size</span> = <span class="number">0</span>;</span><br><span class="line">          <span class="comment">//直接把vector看作是一个栈，直接白嫖，降低空间复杂度</span></span><br><span class="line">		 <span class="comment">// pushed[size++] = pushed[i] ，我直呼内行</span></span><br><span class="line">		<span class="comment">// pushed[i-1]现在是栈顶，size就是栈的元素，如果这个push[i]是要出栈的</span></span><br><span class="line">     	<span class="comment">// 在下一次迭代中就会被push[i+1]替代</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>; i &lt; pushed.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            pushed[<span class="built_in">size</span>++] = pushed[i];</span><br><span class="line">            <span class="keyword">while</span> (<span class="built_in">size</span> != <span class="number">0</span> &amp;&amp; pushed[<span class="built_in">size</span> - <span class="number">1</span>] == popped[j]) &#123;</span><br><span class="line">                <span class="built_in">size</span>--; j++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">size</span> == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/31/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/31/">31</a><span class="page-number current">32</span><a class="page-number" href="/page/33/">33</a><span class="space">&hellip;</span><a class="page-number" href="/page/44/">44</a><a class="extend next" rel="next" href="/page/33/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jason</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">439</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">68</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jason</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

    

  

</body>
</html>
