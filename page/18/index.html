<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=">


  <link rel="mask-icon" href="/images/logo.svg?v=" color="#222">














<meta property="og:type" content="website">
<meta property="og:title" content="Jason‘s Blog">
<meta property="og:url" content="https://jasonxqh.github.io/page/18/index.html">
<meta property="og:site_name" content="Jason‘s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Jason">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '',
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    fancybox: false,
    tabs: ,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: 'undefined',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>







  <title>Jason‘s Blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', '[object Object]', 'auto');
  ga('send', 'pageview');
</script>





<meta name="generator" content="Hexo 4.2.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">
  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
<a href="https://github.com/JasonXQH/JasonXQH.github.io" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jason‘s Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/%20" rel="section">
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/%20" rel="section">
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/%20" rel="section">
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/10/31/%E7%9F%A9%E9%98%B5%E7%9A%84%E5%AF%B9%E8%A7%92%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/31/%E7%9F%A9%E9%98%B5%E7%9A%84%E5%AF%B9%E8%A7%92%E5%8C%96/" itemprop="url">矩阵的对角化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-31T15:51:16+08:00">
                2020-10-31
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2020-11-01T13:48:38+08:00">
                2020-11-01
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="矩阵的对角化"><a href="#矩阵的对角化" class="headerlink" title="矩阵的对角化"></a>矩阵的对角化</h1><h2 id="对角矩阵"><a href="#对角矩阵" class="headerlink" title="对角矩阵"></a>对角矩阵</h2><p>假设 3阶矩阵A与对角矩阵 $\Lambda$  相似，则存在可逆矩阵P，使得 $AP=P\Lambda$ </p>
<p>令 $P=(p_1,p_2,p_3)$ </p>
<p>则 $A(p<em>1,p_2,p_3)=(p_1,p_2,p_3)\begin{pmatrix} \lambda </em>{1}  \ &amp; \lambda <em>{2} &amp; \&amp;&amp; \lambda </em>{3} \end{pmatrix}$</p>
<p>于是 ，$(Ap_1,Ap_2,Ap_3)=(\lambda_1p_1,\lambda_2p_2,\lambda_3p_3)$ </p>
<p>$\lambda_1,\lambda_2,\lambda_3$ 是A的特征值</p>
<p>$p_1,p_2,p_3$ 是A的3个先行为无关的特征向量。</p>
<p>因此，我们可以得到这样一个命题：若n阶矩阵A与对角阵 $\Lambda=\begin{pmatrix} \lambda <em>{1} &amp; &amp; \ &amp; \lambda </em>{2} &amp;&amp; \&amp; &amp; \cdots\ &amp; &amp; &amp;\lambda_n \end{pmatrix}$ 相似，则 $\lambda_1,\lambda_2,\cdots,\lambda_n$ 是A的n个特征值</p>
<h3 id="定理"><a href="#定理" class="headerlink" title="定理"></a>定理</h3><p><strong>n阶矩阵A与对角矩阵相似的充分必要条件是 A 有n个线性无关的特征向量</strong></p>
<p>因此我们可以得到一个推论：<strong>如果n阶矩阵A有n个不同的特征值，则A与对角矩阵相似</strong></p>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p>现在我们来举几个例子，已知 $p=\begin{pmatrix} 1 \ 1\-1 \end{pmatrix}$ 是矩阵 $A=\begin{pmatrix} 2 &amp; -1 &amp; 2 \ 5 &amp; a &amp; 3 \ -1 &amp; b &amp; -2 \end{pmatrix}$ 的一个特征向量</p>
<p>1） 求a,b及p所对应的特征值</p>
<p>2）问A能否对角化</p>
<p>解： $Ap=\begin{pmatrix} 2 &amp; -1 &amp; 2 \ 5 &amp; a &amp; 3 \ -1 &amp; b &amp; -2 \end{pmatrix}\begin{pmatrix} 1 \ 1\-1 \end{pmatrix}=\begin{pmatrix} -1 \ a+2 \b+1 \end{pmatrix}=\lambda\begin{pmatrix} 1 \ 1\-1 \end{pmatrix}$</p>
<p>所以 $\frac{-1}{1}=\frac{a+2}{1}=\frac{b+1}{-1}$  解得 $a=-3,b=0$ </p>
<p>$A=\begin{pmatrix} 2 &amp; -1 &amp; 2 \ 5 &amp; -3 &amp; 3 \ -1 &amp; 0 &amp; -2 \end{pmatrix}$ </p>
<p>$|A-\lambda E|=\begin{vmatrix} 2-\lambda &amp; -1 &amp; 2 \ 5 &amp; -3-\lambda &amp; 3 \ -1 &amp; 0 &amp; -2-\lambda \end{vmatrix}=-\begin{vmatrix} -1 &amp; \lambda ^{2}-2 \ -3-\lambda &amp; -5\lambda-7 \end{vmatrix}=-(\lambda+1)^3$ </p>
<p>所以 $\lambda=-1$ 是矩阵A的3重特征值</p>
<p>将$\lambda$ 带入矩阵，则 $A-(-1)E=\begin{pmatrix} 0 &amp; -1 &amp; -1 \ 0 &amp; -2 &amp; -2 \ -1 &amp; 0 &amp; -1 \end{pmatrix}=\begin{pmatrix} 0 &amp; 1 &amp;  1 \ 0 &amp; 0 &amp; 0 \ 1 &amp; 0 &amp;1 \end{pmatrix}$</p>
<p>$R(A+E)=2$ 因此只能确定1个线性无关的解，即 $p=(1,1-1)^T$，从而A对应于3重特征值-1没有3个线性无关的特征向量，所以A不能对角化</p>
<h2 id="对称矩阵的对角化"><a href="#对称矩阵的对角化" class="headerlink" title="对称矩阵的对角化"></a>对称矩阵的对角化</h2><p>我们先来讨论实对称矩阵与特征向量的一些性质</p>
<ul>
<li>实对称矩阵的特征值必为实数</li>
<li>属于实对称矩阵的不同特征值的特征向量是正交的</li>
</ul>
<h3 id="对此矩阵的对角化定理"><a href="#对此矩阵的对角化定理" class="headerlink" title="对此矩阵的对角化定理"></a>对此矩阵的对角化定理</h3><p><strong>任何实对称矩阵都可以通过正交变换将其对角化</strong></p>
<p>具体地说，设A是一个n阶实对称矩阵，则存在n阶正交矩阵P，使得 </p>
<p>$P^{-1}AP=P^TAP=\Lambda =\begin{pmatrix} \lambda <em>{1} &amp; &amp; \ &amp; \lambda </em>{2} &amp;&amp; \&amp; &amp; \cdots\ &amp; &amp; &amp;\lambda_n \end{pmatrix}$ </p>
<p>反之，设实矩阵A可以正交对角化：</p>
<p>$P^{-1}AP=P^TAP=\Lambda$ , $A=P\Lambda P^T$,则A一定是对称矩阵： $A^T=(P\Lambda P^T)^T=(P^T)^T\Lambda^TP^T=P\Lambda P^T=A$ </p>
<p>推论：<strong>n阶实对称矩阵A的每一个k重特征值恰好能确定k个线性无关的特征向量</strong>，即若$\lambda$ 是n阶矩阵A的k重特征值，则齐次线性方程组$(A-\lambda E)x=0$ 的解空间的维数是k，或者说其系数矩阵的秩 $R(A-\lambda E)=n-k$ </p>
<h3 id="将对称矩阵正交对角化的步骤"><a href="#将对称矩阵正交对角化的步骤" class="headerlink" title="将对称矩阵正交对角化的步骤"></a>将对称矩阵正交对角化的步骤</h3><p>(1) 求出A的全部互不相同的特征值 $\lambda_1,\cdots,\lambda_m$ 设它们的重数分别是 $k_1,\cdots,k_m ~ (k_1+\cdots+k_m=n)$   </p>
<p>(2) 求特征值 $\lambda<em>i$ 所对应的 $k_i$ 个线性无关的特征向量，即，齐次线性方程组 $(A-\lambda_iE)x=0$ 的基础解系 $\xi</em>{i1},\cdots,\xi_{ik}(i=1,\cdots m)$ </p>
<p>(3) 用施密特正交化过程将 $\xi<em>{i1},\cdots,\xi</em>{ik<em>i}$ 正交化，再单位化，得A得属于特征值 $\lambda_i$ 得两两正交的单位特征向量 $p</em>{i1},\cdots,p_{ik_i}$ 由</p>
<p>现在来举几个例子：</p>
<p>将对称矩阵 $A=\begin{pmatrix} 0 &amp; -1 &amp; 1 \ -1 &amp; 0 &amp; 1 \ 1 &amp; 1 &amp; 0 \end{pmatrix}$ 正交对角化</p>
<p>解： A的特征多项式</p>
<p>$|A-\lambda E|=\begin{vmatrix} -\lambda &amp; -1 &amp; 1 \ -1 &amp; -\lambda &amp; 1 \ 1 &amp; 1 &amp; -\lambda \end{vmatrix}=(\lambda+2)(\lambda-1)(1-\lambda)$</p>
<p>得到 $A$ 的特征值： $\lambda_1=\lambda_2=1,\lambda_3=-2$ </p>
<p>$\lambda=1$ 带入得到 $A-E=\begin{pmatrix} -1 &amp; -1 &amp; 1 \ -1 &amp; -1 &amp; 1 \ 1 &amp; 1 &amp; -1 \end{pmatrix}=\begin{pmatrix} -1 &amp; -1 &amp; 1 \ 0 &amp; 0 &amp; 0 \ 0 &amp; 0 &amp; 0 \end{pmatrix}$</p>
<p>$-x_1-x_2+x_3=0 ,x_3=x_1+x_2$  </p>
<p>所以 A对应的特征向量 $\xi_1=\begin{pmatrix} 1 \ 0\ 1 \end{pmatrix},\xi_2=\begin{pmatrix}0 \ 1\ 1 \end{pmatrix}$ 他们线性无关，但不正交。我们用施密特正交化过程将其正交化。</p>
<p>$\eta_1=\xi_1=\begin{pmatrix} 1 \ 0\ 1 \end{pmatrix},\eta_2=\xi_2-\frac{[\xi_1,\xi_2]}{[\xi_1,\xi_1]}=\begin{pmatrix} 0 \ 1\ 1 \end{pmatrix}-\frac{1}{2}\begin{pmatrix} 1 \ 0\ 1 \end{pmatrix}$</p>
<p>$\eta_1,\eta_2$ 是A的属于特征值 1的两个正交的特征向量</p>
<p> $\lambda<em>3=-2$ 时 $A+2E$ 最后化简得到 $\begin{pmatrix} 0 &amp; 0 &amp; 0 \ 0 &amp; 1 &amp; 1 \ 1 &amp; 0 &amp; 1 \end{pmatrix}$：$\begin{cases}x</em>{2}+x<em>{3}=0\ x</em>{1}+x_{3}=0\end{cases}$</p>
<p>对应的特征向量是 $\eta_3=\begin{pmatrix}1 \ 1\ -1 \end{pmatrix}$ $\eta_1,\eta_2,\eta_3$ 两两正交</p>
<p>现在我们将三个向量单位化 : $p_1=\frac{\eta_1}{||\eta_1||}=\frac{1}{\sqrt{2}}\begin{pmatrix}1 \ 0\ 1 \end{pmatrix} ,p_2=\frac{\eta_2}{||\eta_2||}=\frac{1}{\sqrt{6}}\begin{pmatrix}-1 \ 2\ 1 \end{pmatrix},p_3=\frac{\eta_3}{||\eta_3||}=\frac{1}{\sqrt{3}}\begin{pmatrix}1 \ 1\ -1 \end{pmatrix}$ </p>
<p>所以最后的正交矩阵：</p>
<p>$P=(p_1,p_2,p_3)=\begin{pmatrix} \frac{1}{\sqrt{2}} &amp; -\frac{1}{\sqrt{6}} &amp;\frac{1}{\sqrt{3}} \ 0 &amp; \frac{2}{\sqrt{6}} &amp; \frac{1}{\sqrt{3}} \ \frac{1}{\sqrt{2}} &amp; \frac{1}{\sqrt{6}} &amp; -\frac{1}{\sqrt{3}} \end{pmatrix}$  $\Rightarrow P^{-1}AP=P^TAP=\begin{pmatrix} 1 &amp; 0 &amp; 0 \ 0 &amp; 1 &amp; 0 \ 0 &amp; 0 &amp; -2 \end{pmatrix}$</p>
<h3 id="对称矩阵对角化的应用"><a href="#对称矩阵对角化的应用" class="headerlink" title="对称矩阵对角化的应用"></a>对称矩阵对角化的应用</h3><p>设有对称矩阵 $A=\begin{pmatrix} 2 &amp; -1 \ -1 &amp; 2 \end{pmatrix}$ 求 $A^n$ </p>
<p>思路：先将A正交对角化，设有正交矩阵P, 使得 $P^{-1}AP=\Lambda$（对角矩阵）</p>
<p>则 $A=P\Lambda P^{-1}$ 得 $A^n= P\Lambda^nP^{-1}=P\Lambda^nP^T$</p>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/10/30/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E4%B9%8B%E7%89%B9%E5%BE%81%E5%80%BC%E4%B8%8E%E5%90%91%E9%87%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/30/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E4%B9%8B%E7%89%B9%E5%BE%81%E5%80%BC%E4%B8%8E%E5%90%91%E9%87%8F/" itemprop="url">线性代数之特征值与向量</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-30T08:34:00+08:00">
                2020-10-30
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2020-10-31T15:57:40+08:00">
                2020-10-31
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="线性代数之特征值与向量"><a href="#线性代数之特征值与向量" class="headerlink" title="线性代数之特征值与向量"></a>线性代数之特征值与向量</h1><h2 id="概念与求法"><a href="#概念与求法" class="headerlink" title="概念与求法"></a>概念与求法</h2><h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>设A是n阶矩阵，如果数$\lambda$ 和n维非零向量x满足 $Ax=\lambda x$ 。则称$\lambda$ 是矩阵A的<strong>特征值</strong>。非零向量x称为矩阵A的对应于特征值 $\lambda$ 的<strong>特征向量</strong>。因为 $Ax=\lambda x$ 等价于 $Ax-\lambda x=0$ 或 $(A-\lambda E)x = 0$ </p>
<p>如果 $\lambda$ 是矩阵A的特征值，则矩阵A的对应于(属于)特征值 $\lambda$ 的<strong>特征向量x是</strong>齐次线性方程组 $(A-\lambda E)x = 0$ 的非零解，且 $(A-\lambda E)x = 0$  的解空间称为矩阵A对应于特征值 $\lambda$ 的特征空间</p>
<p>在复数范围内，我们有以下等价命题：设A是一个n阶矩阵，$\lambda$ 是一个数。则：</p>
<ul>
<li>$\lambda$ 是矩阵A的特征值</li>
<li>存在非零向量x，使得 $Ax=\lambda x$</li>
<li>齐次线性方程组 $(A-\lambda E)x=0$ 的非零解</li>
<li>行列式 $|A-\lambda E|=0$ </li>
</ul>
<h3 id="求解矩阵A的特征值与特征向量的步骤"><a href="#求解矩阵A的特征值与特征向量的步骤" class="headerlink" title="求解矩阵A的特征值与特征向量的步骤"></a>求解矩阵A的特征值与特征向量的步骤</h3><ol>
<li>解特征方程 $|A-\lambda E|=0 $ 得到 n个特征值 $\lambda_1,\lambda_2,\cdots,\lambda_n$ </li>
<li>对每个特征值 $\lambda_i$ ，解齐次线性方程组：$(A-\lambda_iE)x=0$ 。设 $\xi_1,\xi_2,\cdots,\xi_n$ 是此方程组的基础解系，则A属于特征值 $\lambda_i$ 的全部特征向量为 $p=k_1\xi_1+\cdots+k_l\xi_l$ (其中 $k_1,\cdots,k_l$ 不全为0)</li>
</ol>
<p>我们用<strong>三个例子</strong>来具体阐释这些步骤：</p>
<p><strong>第一个</strong>：$A=\begin{pmatrix} 3 &amp; -1 \ -1 &amp; 3 \end{pmatrix}$ 求这个矩阵的特征值和特征向量</p>
<p>解：A的特征方程 $|A-\lambda E|=0$</p>
<p>$|\begin{pmatrix} 3 &amp; -1 \ -1 &amp; 3 \end{pmatrix}-\begin{pmatrix} \lambda &amp; 0 \ 0 &amp; \lambda \end{pmatrix}|=|\begin{pmatrix} 3-\lambda &amp; -1 \ -1 &amp; 3-\lambda \end{pmatrix}|=(3-\lambda)^2-1$ </p>
<p>$=[(3-\lambda)+1][(3-\lambda)-1]=(4-\lambda)(2-\lambda)=0$  解得 $\lambda_1=2,\lambda_2=4$ </p>
<p>对$\lambda_1=2$  对应的齐次线性方程组为 $(A-2E)x=0$ </p>
<p>所以 $\begin{pmatrix} 3-2 &amp; -1 \ -1 &amp; 3-2 \end{pmatrix}\begin{pmatrix} x_1 \x_2 \end{pmatrix}=\begin{pmatrix} 0  \ 0 \end{pmatrix}$ </p>
<p>$\begin{pmatrix} 1 &amp; -1 \ -1 &amp; 1 \end{pmatrix}\rightarrow \begin{pmatrix} 1 &amp; -1 \ 0 &amp; 0 \end{pmatrix}$(上一行加下一行)</p>
<p>于是我们得到 $x_1-x_2=0$, $x_1=x_2$ 不妨令 $x_2=1$,则得到基础解系 $\xi_1= \begin{pmatrix} 1  \ 1 \end{pmatrix}$  则A对应于 $\lambda_1=2$ 的全部特征向量为 $p_1=k\begin{pmatrix} 1  \  1 \end{pmatrix}$ </p>
<p>对 $\lambda_2=4$ ,对应的齐次线性方程组为 :$(A-4E)x=0$ </p>
<p>同理我们可以得到 $x_1=-x_2$ ,不妨令 $x_2=-1$ ，则得到的基础解系 $\xi_2= \begin{pmatrix} 1  \-1 \end{pmatrix}$,则A对应于 $\lambda_2=4$ 的全部特征向量为 $p_2=k\begin{pmatrix} 1  \ -1 \end{pmatrix}$ </p>
<p><img src="/2020/10/30/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E4%B9%8B%E7%89%B9%E5%BE%81%E5%80%BC%E4%B8%8E%E5%90%91%E9%87%8F/3.png" style="zoom:120%;"></p>
<p><strong>第二个</strong> ：$A=\begin{pmatrix} -2 &amp; 1 &amp; 1 \ 0 &amp; 2 &amp; 0 \ -4 &amp; 1 &amp; 3 \end{pmatrix}$ 求这个矩阵的特征值和特征向量</p>
<p>解：首先求A的特征方程 $|A-\lambda E|=0$</p>
<p>则 $\begin{vmatrix} -2-\lambda &amp; 1 &amp; 1 \ 0 &amp; 2-\lambda &amp; 0 \ -4 &amp; 1 &amp; 3-\lambda \end{vmatrix}=(2-\lambda)\begin{vmatrix} -2-\lambda &amp; 1 \ -4 &amp; 3-\lambda \end{vmatrix}=(2-\lambda)(-6-\lambda+\lambda^2+4)=(2-\lambda)(\lambda-2)(\lambda+1)=0$ </p>
<p>解得 $\lambda_1=-1,\lambda_2=\lambda_3=2$ </p>
<p>那么我们依次将这些特征值带入到方程中并求出特征值对应的特征向量<br>首先我们将 $\lambda_1=-1$代入方程：</p>
<p>$\begin{pmatrix} -1 &amp; 1 &amp; 1 \ 0 &amp; 3 &amp; 0 \ -4 &amp; 1 &amp; 4 \end{pmatrix} \begin{pmatrix} x_1 \ x_2\ x_3 \end{pmatrix}=\begin{pmatrix} 0 \ 0\0 \end{pmatrix}$  化简得到  $\begin{pmatrix} 1 &amp; 0 &amp; -1 \ 0 &amp; 1 &amp; 0 \ 0 &amp; 0 &amp; 0 \end{pmatrix}$ </p>
<p>所以 $\begin{cases}x_1 =x_3\ x_2=0\end{cases}$ =&gt; $\xi_1=\begin{pmatrix} 1 \ 0\1 \end{pmatrix}$  特征向量： $p_1=k\begin{pmatrix}1 \ 0\1 \end{pmatrix}$</p>
<p>对于 $\lambda=2$ 我们带入得到</p>
<p>$\begin{pmatrix} -4 &amp; 1 &amp; 1 \ 0 &amp; 0 &amp; 0 \ -4 &amp; 1 &amp; 1 \end{pmatrix}\begin{pmatrix} x_1 \ x_2\ x_3 \end{pmatrix}=\begin{pmatrix} 0 \ 0\ 0 \end{pmatrix}$ 化简得到：  $\begin{pmatrix} -4 &amp; 1 &amp; 1 \ 0 &amp; 0 &amp; 0 \ 0 &amp; 0 &amp; 0 \end{pmatrix}$ </p>
<p>所以 $-4x_1+x_2+x_3=0 \rightarrow x_2=4x_1-x_3$ </p>
<p>对于这种情况， $x_1和x_3$ 都是随我们取0，我们一般取 0，1和1，0 两种情况</p>
<p>于是 $\xi_2= \begin{pmatrix} 1 \ 4\0 \end{pmatrix}$ ,$\xi_3 = \begin{pmatrix} 0 \ -1 \1 \end{pmatrix}$ A对应于$\lambda=2$ 得全部特征向量就是：$k_1\begin{pmatrix} 1 \ 4\0 \end{pmatrix}+k_2\begin{pmatrix} 0 \ -1 \1 \end{pmatrix}$  $k_1,k_2$不全为0</p>
<p><img src="/2020/10/30/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E4%B9%8B%E7%89%B9%E5%BE%81%E5%80%BC%E4%B8%8E%E5%90%91%E9%87%8F/1.png" style="zoom:120%;"></p>
<p><strong>第三个：</strong> $\begin{pmatrix} -1 &amp; 1 &amp; 0 \ -4 &amp; 3 &amp; 0 \ 1 &amp; 0 &amp; 2 \end{pmatrix}$求这个矩阵的特征值和特征向量</p>
<p>$|A-\lambda E|=0\Rightarrow (2-\lambda)\begin{vmatrix} 1-\lambda &amp; 1 \ -4 &amp; 2-\lambda \end{vmatrix}=(2-\lambda)(\lambda-1)^2=0$   </p>
<p>得到特征值 $\lambda_1=2,\lambda_2=\lambda_3=1$ </p>
<p>对于 $\lambda_1=2$ 我们可以得到 </p>
<p>$\begin{pmatrix} -3 &amp; 1 &amp; 0 \ -4 &amp; 1 &amp; 0 \ 1 &amp; 0 &amp; 0 \end{pmatrix}\begin{pmatrix} x_1 \ x_2\x_3 \end{pmatrix}=\begin{pmatrix}0\ 0\0 \end{pmatrix}$  化简得 $\begin{pmatrix} 1 &amp; 0 &amp; 0 \ 0 &amp; 1 &amp; 0 \ 0 &amp; 0 &amp; 0 \end{pmatrix}$ </p>
<p>于是 $\begin{cases}x<em>{1}=0\ x</em>{2}=0\end{cases}$  , $x_3$随我们取，我们可以取 1。所以 $\xi_1=\begin{pmatrix}0\ 0\0 \end{pmatrix},p_1=k\begin{pmatrix}0\ 0\1 \end{pmatrix}(k\ne 0)$</p>
<p>对于 $\lambda_2=\lambda_3=1$ </p>
<p>$\begin{pmatrix} -2 &amp; 1 &amp; 0 \ -4 &amp; 2 &amp; 0 \ 1 &amp; 0 &amp; 1 \end{pmatrix} \begin{pmatrix} x_1 \ x_2\x_3 \end{pmatrix}=\begin{pmatrix}0\ 0\0 \end{pmatrix}$   化简得到 $\begin{pmatrix} 0 &amp; 1 &amp; 2 \ 0 &amp; 0 &amp; 0 \ 1 &amp; 0 &amp;1 \end{pmatrix}$</p>
<p>所以 $\begin{cases}x<em>{1}=-x</em>{3}\ x<em>{2}=-2x</em>{3}\end{cases}$  $\xi_2=\begin{pmatrix}1\ 2 \ -1 \end{pmatrix}$  $p=k\begin{pmatrix}1\ 2\ -1 \end{pmatrix}$ </p>
<p>所以这个2重特征根只确定了一个线性无关的特征向量！</p>
<p><img src="/2020/10/30/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E4%B9%8B%E7%89%B9%E5%BE%81%E5%80%BC%E4%B8%8E%E5%90%91%E9%87%8F/2.png" style="zoom:120%;"></p>
<p>对于上面两个例子我们可以得到一些结论：</p>
<ul>
<li><p>特征方程的一个 s重根<strong>最多</strong>能确定 s 个线性无关的特征向量。即一个特征值的特征空间维数(集合重数) 不会大于该特征值的代数重数 s</p>
</li>
<li><p>因此，<strong>每一个</strong>特征单根<strong>只能确定一个</strong>线性无关的特征向量。</p>
</li>
<li>一个<strong>二重</strong>特征根<strong>最多</strong>能确定<strong>两个</strong>线性无关的特征向量</li>
<li>所以，一个<strong>n阶</strong>矩阵A<strong>最多</strong>有 <strong>n个</strong>线性无关的特征向量</li>
</ul>
<p>拓展： 矩阵A的s重特征根能否确定s个线性无关的特征向量，直接影响到矩阵 A 能否对角化。一个n阶矩阵A能对角化的条件就是它有n个线性无关的特征向量。因此，只有A的每一个s重根都能确定s个线性无关的特征向量(几何重数=代数重数) 矩阵A才能对角化</p>
<p>关于对角化，我会在下一篇博客中讲到。</p>
<h2 id="特征值和特征向量的性质"><a href="#特征值和特征向量的性质" class="headerlink" title="特征值和特征向量的性质"></a>特征值和特征向量的性质</h2><h3 id="特征值和矩阵之间巧妙的关系"><a href="#特征值和矩阵之间巧妙的关系" class="headerlink" title="特征值和矩阵之间巧妙的关系"></a>特征值和矩阵之间巧妙的关系</h3><p>矩阵的行列式等于它全体特征值之积 $\lambda_1\lambda_2\cdots\lambda_n=|A|$ </p>
<p>矩阵的特征值之和等于矩阵的迹 $a<em>{11}+a</em>{22}+\cdots+a_{nn}=\lambda_1+\lambda_2+\cdots+\lambda_n=trA$ </p>
<h3 id="性质-1"><a href="#性质-1" class="headerlink" title="性质 1"></a>性质 1</h3><p>1）设p是矩阵A的属于特征值$\lambda$ 的特征向量，则 $kp(k\ne 0)$ 也是A的属于 $\lambda$ 的特征向量</p>
<p>2）设 $p_1,\cdots,p_s$ 是方阵A的属于特征值 $\lambda$ 的特征向量，则 $p= k_1p_1+\cdots+k_sp_s \ne 0 $也是A的属于$\lambda$ 的特征向量</p>
<p>也就是说，属于同一特征值的若干个特征向量的非零线性组合仍然是属于该特征值的特征向量</p>
<h3 id="性质-2"><a href="#性质-2" class="headerlink" title="性质 2"></a>性质 2</h3><p><strong>设 $\lambda$ 是方阵 A的特征值，则$\lambda^2$ 也是$A^2$ 的特征值</strong></p>
<p>证明： $Ap=\lambda p$ , 则 $A^2p =A(Ap)=A(\lambda p)=\lambda Ap=\lambda(\lambda p)=\lambda^2 p$  所以 $\lambda^2$ 也是 $A^2$ 的特征值</p>
<p>以上证明可以看出：若p是A的属于特征值 $\lambda$ 的特征向量，则p也是 $A^2$ 的属于特征值 $\lambda^2$ 的特征向量</p>
<p>进而，我们可以推断，A的特征值的多项式 是 A 的同一个多项式的特征值 $Ap=\lambda p \Rightarrow \varphi(A)p =\varphi(\lambda)p$ </p>
<p>A的特征向量也是A的多项式的特征向量</p>
<h3 id="性质3"><a href="#性质3" class="headerlink" title="性质3"></a>性质3</h3><p><strong>设$\lambda$ 是可逆矩阵A的特征值，则 $\lambda\ne 0$ ,且 $1/\lambda $ 是矩阵 $A^{-1}$ 的特征值</strong></p>
<p>证明 设非零向量p是A的属于$\lambda$ 的特征向量：$Ap=\lambda p$</p>
<p>$p=A^{-1}\lambda p =\lambda A^{-1}p$  因为 p不是零向量，所以 $\lambda\ne 0$ </p>
<p>$A^{-1}p=\frac{1}{\lambda}p$ 所以$\lambda^{-1}$ 是矩阵$A^{-1}$ 的特征值</p>
<h3 id="性质4"><a href="#性质4" class="headerlink" title="性质4"></a>性质4</h3><p>一个矩阵A与其转置矩阵$A^T$ 有相同的特征多项式，从而有相同的特征值</p>
<p>$|A^T-\lambda E|=|(A-\lambda E)^T|=|A-\lambda E|$ </p>
<p>但是注意了 ，对于同一个特征值 $\lambda$ ,$A$ 与 $A^T$ 并<strong>不一定有</strong>相同的特征向量！</p>
<p>综上，我们可以列出一张简单的表格 </p>
<p>A* — 伴随矩阵的定义：某矩阵A各元素的代数余子式，组成一个新的矩阵后再进行一下转置，叫做A的伴随矩阵。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>矩阵</th>
<th>特征值</th>
<th>特征向量</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>$\lambda$</td>
<td>p</td>
</tr>
<tr>
<td>$A^k$</td>
<td>$\lambda^k$</td>
<td>p</td>
</tr>
<tr>
<td>$\varphi(A)$（多项式）</td>
<td>$\varphi(\lambda)$ （多项式）</td>
<td>p</td>
</tr>
<tr>
<td>$A^{-1}$</td>
<td>$\lambda^{-1}$</td>
<td>p</td>
</tr>
<tr>
<td>$A^*=</td>
<td>A</td>
<td>A^{-1}$</td>
<td>$</td>
<td>A</td>
<td>\lambda^{-1}$</td>
<td>p</td>
</tr>
<tr>
<td>$A^T$</td>
<td>$\lambda$</td>
<td>不一定是p</td>
</tr>
</tbody>
</table>
</div>
<p>下面我用三个例子来运用说明这些性质：</p>
<p><strong>第一个： </strong> 设3阶可逆矩阵A的特征值</p>
<p>$\lambda_1=1,\lambda_2=-2,\lambda_3=3$ ,求矩阵 $A^3+2(A^{-1})^2+3A^*-2E$ 的特征值</p>
<p>解： 设非零向量p是A的属于特征值 $\lambda$ 的特征向量</p>
<p>则 $Ap=\lambda p$  $A^3p= \lambda^3p$ </p>
<p>$(A^{-1})^2p =(\lambda^{-2})p $ </p>
<p>原式等于： $\lambda^3p+2(\lambda^{-1})p+3|A|\lambda^{-1} p-2p$ </p>
<p>令 $\varphi(\lambda)=\lambda^3+\frac{2}{\lambda^2}-\frac{6}{\lambda}-2$ , $\varphi(A)p=\varphi(\lambda)p$ </p>
<p>然后分别将三个$\lambda$ 的值带入即可</p>
<p><strong>第二个：</strong></p>
<p><img src="/2020/10/30/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E4%B9%8B%E7%89%B9%E5%BE%81%E5%80%BC%E4%B8%8E%E5%90%91%E9%87%8F/5.png" style="zoom:150%;"></p>
<p><strong>第三个</strong>：</p>
<p>已知 3阶矩阵A有特征值 1,2,3 ，求 $|A^3-5A^2+7A|$</p>
<p>解: 令 $\varphi(x)=x^3-5x^2+7x$</p>
<p>则 $A^3-5A^2+7A=\varphi(A)$ 有特征值 $\varphi(1)=3,\varphi(2)=2,\varphi(3)=3$ </p>
<p>由矩阵行列式的值等于其特征值之积可以得到： $|A^3-5A^2+7A|=|\varphi(A)|=3<em>2</em>3=18$ </p>
<h2 id="相似矩阵"><a href="#相似矩阵" class="headerlink" title="相似矩阵"></a>相似矩阵</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>设A和B是n阶矩阵，如果有n阶可逆矩阵P，使得 $P^{-1}AP=B$ h或者 $AP=PB$ </p>
<p>则称 A与B 相似 ，记作 $A\sim B$ , 我们也说 B是A的相似矩阵</p>
<p>$A\rightarrow P^{-1}AP=B$  称为相似变换，P就是<strong>变换矩阵</strong></p>
<p>矩阵的相似关系具有一下性质：</p>
<ul>
<li>自反性（reflexivity) :$A\sim A$</li>
<li>对称性 (symmetry) :$A\sim B \Rightarrow B\sim A$ </li>
<li>传递性 (transitivity): $A\sim B,B\sim C\Rightarrow A\sim C$ </li>
</ul>
<h3 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h3><ul>
<li>相似矩阵拥有<strong>相同的特征多项式</strong>，从而有<strong>相同的特征值</strong>、<strong>相同的行列式</strong>(全体特征值之积)和<strong>相同的迹</strong>(全体特征值之和)，相同的秩</li>
<li>相似矩阵一定是等价矩阵</li>
<li>相似变换不能保持矩阵的对称性</li>
<li><strong>相似矩阵不一定有相同的特征向量</strong></li>
<li>相似矩阵的<strong>幂</strong>，<strong>多项式</strong>，<strong>逆矩阵</strong>，<strong>转置矩阵</strong> ，<strong>伴随矩阵</strong> 都是相似的</li>
</ul>
<p>可以这样来列2张表格 </p>
<p><img src="/2020/10/30/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E4%B9%8B%E7%89%B9%E5%BE%81%E5%80%BC%E4%B8%8E%E5%90%91%E9%87%8F/6.png" style="zoom:150%;"></p>
<p><img src="/2020/10/30/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E4%B9%8B%E7%89%B9%E5%BE%81%E5%80%BC%E4%B8%8E%E5%90%91%E9%87%8F/7.png" style="zoom:150%;"></p>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/10/29/Thompson-Sampling%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/29/Thompson-Sampling%E7%AE%97%E6%B3%95/" itemprop="url">Thompson_Sampling算法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-29T15:36:10+08:00">
                2020-10-29
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2020-10-30T07:50:32+08:00">
                2020-10-30
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Thompson-Sampling-抽样算法"><a href="#Thompson-Sampling-抽样算法" class="headerlink" title="Thompson Sampling 抽样算法"></a>Thompson Sampling 抽样算法</h1><p>文章搬运、修改自博客： <a href="https://www.jianshu.com/p/b4b9f72a505f" target="_blank" rel="noopener">https://www.jianshu.com/p/b4b9f72a505f</a></p>
<p>本文继续讲一个强化学习的算法，叫做Thompson抽样算法。这个算法的数学理论基础要用到的是贝叶斯推断(Bayesian Inference)。我们先谈谈这个算法的基本原理。</p>
<h2 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h2><p>我们依然使用之前的多臂老虎机的问题。如图所示，横轴代表奖励，越往右边表示奖励越多。三条竖线代表三个不同的老虎机它们的平均奖励。</p>
<p><img src="/2020/10/29/Thompson-Sampling%E7%AE%97%E6%B3%95/1.png"></p>
<p>算法步骤：</p>
<p><img src="/2020/10/29/Thompson-Sampling%E7%AE%97%E6%B3%95/2.png"></p>
<p>我们依然使用之前的多臂老虎机的问题来介绍这个算法。如图所示，横轴代表奖励，越往右边表示奖励越多。三条竖线代表三个不同的老虎机它们的平均奖励。</p>
<p><img src="/2020/10/29/Thompson-Sampling%E7%AE%97%E6%B3%95/3.png"></p>
<p>在算法开始前，我们是什么都不知道的，因此需要得到一些基础数据。图中有四个蓝色的数据，表示按下蓝色老虎机得到的奖励，根据这几个得到的奖励，可以得到一个数学分布。同样绿色的老虎机也能得到一个分布，黄色同理。</p>
<p><img src="/2020/10/29/Thompson-Sampling%E7%AE%97%E6%B3%95/4.png"></p>
<p>这三个分布预测的是这三个机器给我们带来奖励实际上可能的数学期望的概率分布。接下来基于这三个随机分布，我们<strong>得到几个随机抽样</strong>，选择获得<strong>最大抽样值的机器</strong>按下去。但由于是随机的，虽然黄色的实际期望是最高的，但我们依然可能会选出一个绿色大于黄色数据结果。</p>
<p> <img src="/2020/10/29/Thompson-Sampling%E7%AE%97%E6%B3%95/5.png"></p>
<p>按下去后我们会得到一个新的观察到的奖励值，得到新的奖励值后就要调整绿色机器的分布。</p>
<p><img src="/2020/10/29/Thompson-Sampling%E7%AE%97%E6%B3%95/6.png"></p>
<p>显然这个绿色的分布变得更高更窄了，后面的步骤和这里其实是一样的，也是依然选择奖励值最高的机器按下去，通过得到的结果继续调整分布。</p>
<p>当这个游戏进行到很多步骤之后，这些分布都会变得非常窄，尤其是黄色的基本会和实际期望吻合</p>
<p> <img src="/2020/10/29/Thompson-Sampling%E7%AE%97%E6%B3%95/7.png"></p>
<p>这时由于我们一直选择奖励值最高的机器，因此按下黄色的概率会比较高，导致黄色的会越来越窄，而蓝色的很少玩到，因此相对要宽一点。</p>
<h2 id="Thompson抽样算法-vs-置信区间上界算法"><a href="#Thompson抽样算法-vs-置信区间上界算法" class="headerlink" title="Thompson抽样算法 vs. 置信区间上界算法"></a>Thompson抽样算法 vs. 置信区间上界算法</h2><p>我们使用Thompson抽样算法和ucb算法都处理了多臂老虎机问题，那么现在来比较下两个算法。来看看这两个算法的基本原理图。</p>
<p><img src="/2020/10/29/Thompson-Sampling%E7%AE%97%E6%B3%95/8.png" style="zoom:120%;"></p>
<p>首先这个UCB算法，它是一个确定性算法，当我们得到相同的奖励时，我们作出的决策时确定，因此我们每一轮的总收益和总收益都是确定的。每一轮中作出的决策<strong>只和置信区间的上界</strong>有关，而这个<strong>上界只和这个机器所有的观察值</strong>有关。所以说<strong>当所有机器的观察值相同时，我们永远会做相同的决策</strong>。对于Thompson算法，它是个随机性算法，它的某一步或者某几步是在一个随机函数控制下，跟运气是有关系的。它依赖于一些随机事件，就像我们上面选择点的时候，虽然黄色的实际期望大于绿色，但我们还是可能会选出绿色大于黄色的数据点。因此说它是个<strong>随机性的算法</strong>。</p>
<p>那么对于<strong>UCB</strong>，它还有个特点，就是需要<strong>实时更新上界</strong>，这个在之前的文章描述UCB算法原理的时候可以看出来。对于<strong>Thompson抽样算法</strong>，它是<strong>允许延迟更新甚至批量更新的</strong>，比如我们往网上投放一批广告，这里是允许它得到的结果是有延迟的。最后一点，在近些年的实际应用和研究中发现，Thompson抽样算法相对于置信区间算法，它是有更好的实际应用效果的。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><h3 id="Importing-the-libraries"><a href="#Importing-the-libraries" class="headerlink" title="Importing the libraries"></a>Importing the libraries</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></table></figure>
<h3 id="Importing-the-dataset"><a href="#Importing-the-dataset" class="headerlink" title="Importing the dataset"></a>Importing the dataset</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset = pd.read_csv(<span class="string">'Ads_CTR_Optimisation.csv'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Implementing-Thompson-Sampling"><a href="#Implementing-Thompson-Sampling" class="headerlink" title="Implementing Thompson Sampling"></a>Implementing Thompson Sampling</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line">N = <span class="number">10000</span></span><br><span class="line">d = <span class="number">10</span></span><br><span class="line">ads_selected = []</span><br><span class="line">numbers_of_rewards_1 = [<span class="number">0</span>] * d</span><br><span class="line">numbers_of_rewards_0 = [<span class="number">0</span>] * d</span><br><span class="line">total_reward = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">0</span>, N):</span><br><span class="line">    ad = <span class="number">0</span></span><br><span class="line">    max_random = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, d):</span><br><span class="line">        random_beta = random.betavariate(numbers_of_rewards_1[i] + <span class="number">1</span>,</span><br><span class="line">                                         numbers_of_rewards_0[i] + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> random_beta &gt; max_random:</span><br><span class="line">            max_random = random_beta</span><br><span class="line">            ad = i</span><br><span class="line">    ads_selected.append(ad)</span><br><span class="line">    reward = dataset.values[n, ad]</span><br><span class="line">    <span class="keyword">if</span> reward == <span class="number">1</span>:</span><br><span class="line">        numbers_of_rewards_1[ad] = numbers_of_rewards_1[ad] + <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        numbers_of_rewards_0[ad] = numbers_of_rewards_0[ad] + <span class="number">1</span></span><br><span class="line">    total_reward = total_reward + reward</span><br></pre></td></tr></table></figure>
<h3 id="Visualising-the-results-Histogram"><a href="#Visualising-the-results-Histogram" class="headerlink" title="Visualising the results - Histogram"></a>Visualising the results - Histogram</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">plt.hist(ads_selected)</span><br><span class="line">plt.title(<span class="string">'Histogram of ads selections'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Ads'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Number of times each ad was selected'</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/29/Thompson-Sampling%E7%AE%97%E6%B3%95/9.png" style="zoom:120%;"></p>
<p>最终得到总奖励数相对于之前的置信区间算法要高很多，为2579.而且得到的图像很明显能看到最佳的广告是ad5，因此Thompson抽样算法的实际效果的确要优于置信区间算法。</p>
<p>以上，就是强化学习中的Thompson抽样算法的基础知识。</p>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/10/29/Upper-Confidence-bound/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/29/Upper-Confidence-bound/" itemprop="url">Upper_Confidence_bound</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-29T10:29:46+08:00">
                2020-10-29
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2020-10-29T15:40:28+08:00">
                2020-10-29
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Upper-Confidence-bound"><a href="#Upper-Confidence-bound" class="headerlink" title="Upper Confidence bound"></a>Upper Confidence bound</h1><p>搬运、修改自 博客<a href="https://www.jianshu.com/p/3abeb6d4a1e5" target="_blank" rel="noopener">https://www.jianshu.com/p/3abeb6d4a1e5</a></p>
<h2 id="引入："><a href="#引入：" class="headerlink" title="引入："></a>引入：</h2><p><img src="/2020/10/29/Upper-Confidence-bound/1.png" style="zoom:80%;"></p>
<p>如图所示，我们有几个单臂老虎机，组成一起我们就称作多臂老虎机，那么我们需要制定什么样的策略才能最大化得到的奖励。这里假设每个老虎机奖励的随机分布是不一样的。</p>
<p><img src="/2020/10/29/Upper-Confidence-bound/2.png" style="zoom:80%;"></p>
<p>比如第一个分布，D1这个老虎机的分布大概率落在中间这部分，很小概率在两头的地方。假设用户是知道这些分布的，那么用户应当怎么选择？答案很简单，我们应当选择D5这个老虎机，因为它的平均值最高，而且有很大概率在靠右也就是正数范围内。但现在的问题是，用户实际上是不知道这些老虎机的概率分布的。那么我们需要一次次的尝试，尽可能快速的找到这五个老虎机的分布，并利用最佳的分布最大化收益。这个在机器学习上叫做，探索利用。</p>
<p>探索和利用这两步实际上并不是那么的兼容，为了解释这个概念，这里引入一个定义，叫做遗憾。也就是我们知道D5的分布是最高的，那么最佳策略是应对不停的选择D5这个机器，但当我们不知道的时候，可能会选择其他的机器，当没有选择最佳机器时，都会得到一个得到的奖励和最佳奖励的差，这个差就是遗憾。</p>
<p>那么现在可以解释为什么探索和利用为什么并不是那么兼容，比如我们探索很多，每个机器玩了一百次，对于每个机器都能得到很好的分布估计，但同时也会带来很多的遗憾。如果探索比较少，可能会找不到最佳的分布，探索得到的结论可能是错的。所以说，最佳的策略应该是，通过探索找到最佳分布的老虎机，并且以一种快速而高效的方法找到这个老虎机，且不断的利用它来获得最大化的奖励。</p>
<p>在实际上生活或商业案例上也有很多相似的情形。比如可口可乐公司设计出了5个不同的广告，那么现在的问题就是不知道哪个广告是最好的，能带来最佳的用户转换率，即不知道哪一个投放后会吸引用户点击或购买产品。非常传统的方式就是把每个广告都投放到市场上几天，然后看看得到的结果。但这是很消耗人力和财力的，而且这本质上只进行了探索却没进行利用。因此我们需要对此进行利用，比如其中某个广告投放第一天就显然没有任何的效果，那么后面几天的投放的意义就不是很大了，可以考虑不再投放此广告来节省人力财力。即应用强化学习可以优化成本和支出，又可以得到最高的收益。</p>
<h2 id="置信区间上界算法"><a href="#置信区间上界算法" class="headerlink" title="置信区间上界算法"></a>置信区间上界算法</h2><p><img src="/2020/10/29/Upper-Confidence-bound/3.png" style="zoom:100%;"></p>
<p>下面来描述下这个算法,现在假设我们知道五台老虎机的分布，那么我们会不断的选择D5这个老虎机。假如说不知道这几个的概率分布，那么就要开始我们的算法。</p>
<h4 id="1"><a href="#1" class="headerlink" title="1"></a>1</h4><p>在我们开始之前，假设每个老虎机的概率分布是相同的，即平均值或期望是相同的。如图红色虚线表示平均值或期望，纵轴表示老虎机可能带来的收益。这些彩色的横线代表每个老虎机实际的平均或期望，这些期望我们是不知道的，这个问题的核心就是我们要进行不断的尝试去估算出每个老虎机的平均期望。</p>
<p> <img src="/2020/10/29/Upper-Confidence-bound/4.png" style="zoom:100%;"></p>
<p>置信区间，Confidence Bound 对于每个老虎机，我们讲置信区间，用灰色的方框表示。对于每个老虎机，我们按的概率有很大的概率是在这个区间当中的。我们每一轮将要选择的就是拥有<strong>最大的区间上界</strong>的老虎机，也就是<strong>顶上的这条线最大的老虎机</strong>，我们要在每一轮中选择它并按下它。在第一轮中，他们的区间上界是一样的。</p>
<h4 id="2"><a href="#2" class="headerlink" title="2"></a>2</h4><p>现在，比如选择3号老虎机，按下去，<strong>首先</strong>会发现区间所代表的方框下降了。因为按下去后我们会发现其给予的奖励，3号老虎机的实际期望比较低，那么观察得到的奖励也是比较低，那么重新计算观察到的所有平均值时，那么这个平均值就降低了。<strong>第二点</strong>，我们会发现这个置信区间变得更小了，因为比起上一轮的游戏，我们总共的观察次数变多了，也就是<strong>信心升高</strong>了，那么这个<strong>置信区间的长度就会变小</strong>。</p>
<p> <img src="/2020/10/29/Upper-Confidence-bound/5.png" style="zoom:100%;"></p>
<h4 id="3"><a href="#3" class="headerlink" title="3"></a>3</h4><p>那么此时第三个机器的置信区间上界比其他的要低，所以下一轮要选择其他四个机器，比如选择第四个，那么它的置信区间上界会变高，区间大小会变小。</p>
<p><img src="/2020/10/29/Upper-Confidence-bound/12.png" style="zoom:100%;"></p>
<p>但是这样的话，D4的置信区间上界就高于其他所有机子。如果这是最后一次迭代的话，我们的算法就会认为D4十表现最好的机子。但是这显然并不符合实际。那么这个算法的意义就丧失了。</p>
<p>但是不要忘记，UCB的置信区间是 $[\overline r_i(n)-\Delta_i(n),\overline r_i(n)+\Delta_i(n)]$  其中 $\Delta_i(n) = \sqrt{\frac{3}{2}\cdot \frac{\log(n)}{N_i(n)}}$ ，$N_i$ 随着轮数增加会增加，所以 $\Delta_i$ 会减小，所以虽然 $\overline r_i(n)$ 增大了，但是置信区间却减少了，”资不抵债” ，最终它的置信空间上界还是变小了。</p>
<p><img src="/2020/10/29/Upper-Confidence-bound/15.png" style="zoom:120%;"></p>
<p><img src="/2020/10/29/Upper-Confidence-bound/11.png" style="zoom:100%;"></p>
<h4 id="4"><a href="#4" class="headerlink" title="4"></a>4</h4><p>下一步，125三个机器的上界时一样的，因此可以在他们三个中间选一个，比如第一个，它的实际平均值比较低，但当我们按下老虎机的时候，它实际是个随机事件，因此可能高也可能低。虽然它的平均值，但假设此时运气比较好，投下去的钱翻倍了，那么他的区间上限变高，长度变小。</p>
<p> <img src="/2020/10/29/Upper-Confidence-bound/6.png" style="zoom:100%;"></p>
<p>再然后在25中间选择一个，比如第二个，此时他的置信区间上界变低，宽度变小。</p>
<p><img src="/2020/10/29/Upper-Confidence-bound/7.png" style="zoom:100%;"></p>
<p>那么最后按下第五个机器，这时得到一个非常高的观察值，那么上限变高，宽度变小。但由于D5实际上是最佳的机器，那么<strong>就算置信区间变小了，但它的上界依然比其他的都要高</strong>。</p>
<p><img src="/2020/10/29/Upper-Confidence-bound/8.png" style="zoom:100%;"></p>
<h4 id="5"><a href="#5" class="headerlink" title="5"></a>5</h4><p>那么我接下来选择的老虎机依然是它，当我们选择了一个最佳的解时，我们可能在这个选择上停留很多轮，但由于对他的信心会越来越高，因此这个区间会越来越小，此时的区间上界可能就会变成不是最高。</p>
<p><img src="/2020/10/29/Upper-Confidence-bound/9.png" style="zoom:100%;"></p>
<p>UCB算法有一个特点，当我们选择了一个机器很多次后，他的<strong>置信区间会变得很小</strong>，要给其他的机器一些机会，看看其他机器显示的观察结果所对应的新的置信区间上界是否会更高。这样经过很多轮后，最终D5的选择次数依然会很多很多，他的置信区间会越来越扁，一直到最终轮。</p>
<p><img src="/2020/10/29/Upper-Confidence-bound/10.png" style="zoom:100%;"></p>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><p>这里用一个商业案例来做例子。假设有一个汽车公司为了一个车做了十个广告ad1-ad10，这个公司需要知道哪个广告投放后，点击率最高。这组数据集是在模拟环境得到的，若值为<strong>1则指的是这个用户点击了这个广告</strong>。总结一下问题就是，我们有十个广告，要决定哪个广告有最高的点击率，并对逐步得到的信息来决定，第n个用户投放哪个广告得到最高的点击数。我们先看看如果对于每一个用户，我们随机抽选广告，会得到怎样的点击数。</p>
<p>我们要用的数据集如下：</p>
<p><img src="/2020/10/29/Upper-Confidence-bound/13.png" style="zoom:100%;"></p>
<p>这里提供一个随机选择的算法，不是此次算法的重点。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Importing the libraries</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># Importing the dataset</span></span><br><span class="line">dataset = pd.read_csv(<span class="string">'Ads_CTR_Optimisation.csv'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Implementing Random Selection</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">N = <span class="number">10000</span></span><br><span class="line">d = <span class="number">10</span></span><br><span class="line">ads_selected = []</span><br><span class="line">total_reward = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">0</span>, N):</span><br><span class="line">    ad = random.randrange(d)</span><br><span class="line">    ads_selected.append(ad)</span><br><span class="line">    reward = dataset.values[n, ad]</span><br><span class="line">    total_reward = total_reward + reward</span><br><span class="line"></span><br><span class="line"><span class="comment"># Visualising the results</span></span><br><span class="line">plt.hist(ads_selected)</span><br><span class="line">plt.title(<span class="string">'Histogram of ads selections'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Ads'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Number of times each ad was selected'</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p>运行后得到的ads_selected代表对于每一个用户，哪一个广告被选择，total_reward指的是所有的点击数。得到的图像表示每个广告被点击的次数。每个广告的到点击次数是接近的，大致在1000左右。</p>
<p><img src="/2020/10/29/Upper-Confidence-bound/16.png" style="zoom:100%;"></p>
<p>这样，经过10000轮之后，最终得到的reward为 1257</p>
<h3 id="Importing-the-libraries"><a href="#Importing-the-libraries" class="headerlink" title="Importing the libraries"></a>Importing the libraries</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></table></figure>
<h3 id="Importing-the-dataset"><a href="#Importing-the-dataset" class="headerlink" title="Importing the dataset"></a>Importing the dataset</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dataset = pd.read_csv(<span class="string">'Ads_CTR_Optimisation.csv'</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Implementing-UCB"><a href="#Implementing-UCB" class="headerlink" title="Implementing UCB"></a>Implementing UCB</h3><p>对于UCB算法，我们没有直接的工具包来使用，因此需要自己实现，下面是算法逻辑：</p>
<p><img src="/2020/10/29/Upper-Confidence-bound/15.png" style="zoom:120%;"></p>
<p>首先我们设置 N (即用户的总数/运行轮数)，d是广告总数</p>
<p>numbers_of_selections 和 sums_of_rewards 分别是 $N_i(n)$ 和 $R_i(n)$ , [0]*d  即初始化一个长度为十，初始值都为0的列表</p>
<p>total_reward 是所有返回值的总和，当前没有任何奖励，所以设置其值为0</p>
<p>接着就是进行一个循环了，n代表轮数，在每一轮中，ad(这一轮选择的广告)设置为0(即从第一个广告开始），最大上界设为0</p>
<p>然后对于十只广告中的每一支，我们首先判断其被投放的次数是否大于0，若大于0则计算器 平均回报并计算其置信空间。如果不大于0，那么我们就先将其置信空间的上界设置为一个非常非常大的数。</p>
<p>如果得到的上界是大于最大的置信空间上界，那么就更新最大的置信空间上界，并将当前的广告赋给ad。即这个广告是这一轮我们要投放的广告。所以前两轮下来，最大上界肯定是1e400，但是第三轮之后，最大上界就在不断更新和改变。</p>
<p>跳出第二个循环，我们将本轮最终选的广告添加到ads_selected 列表当中去。并将这个广告的$N_i$ 加一。另外还要再dataset中查找这轮这条广告的reward并加到 $R_i$ 和total_reward 当中去</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line">N = <span class="number">10000</span></span><br><span class="line">d = <span class="number">10</span></span><br><span class="line">ads_selected = []</span><br><span class="line">numbers_of_selections = [<span class="number">0</span>] * d</span><br><span class="line">sums_of_rewards = [<span class="number">0</span>] * d</span><br><span class="line">total_reward = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> range(<span class="number">0</span>, N):</span><br><span class="line">    ad = <span class="number">0</span></span><br><span class="line">    max_upper_bound = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, d):</span><br><span class="line">        <span class="keyword">if</span> (numbers_of_selections[i] &gt; <span class="number">0</span>):</span><br><span class="line">            average_reward = sums_of_rewards[i] / numbers_of_selections[i]</span><br><span class="line">            delta_i = math.sqrt(<span class="number">3</span>/<span class="number">2</span> * math.log(n + <span class="number">1</span>) / numbers_of_selections[i])</span><br><span class="line">            upper_bound = average_reward + delta_i</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            upper_bound = <span class="number">1e400</span></span><br><span class="line">        <span class="keyword">if</span> upper_bound &gt; max_upper_bound:</span><br><span class="line">            max_upper_bound = upper_bound</span><br><span class="line">            ad = i</span><br><span class="line">    ads_selected.append(ad)</span><br><span class="line">    numbers_of_selections[ad] = numbers_of_selections[ad] + <span class="number">1</span></span><br><span class="line">    reward = dataset.values[n, ad]</span><br><span class="line">    sums_of_rewards[ad] = sums_of_rewards[ad] + reward</span><br><span class="line">    total_reward = total_reward + reward</span><br></pre></td></tr></table></figure>
<h3 id="Visualizing-the-results"><a href="#Visualizing-the-results" class="headerlink" title="Visualizing the results"></a>Visualizing the results</h3><p>现在 ads_selected 数组是一个</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">plt.hist(ads_selected)</span><br><span class="line">plt.title(<span class="string">'Histogram of ads selections'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Ads'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Number of times each ad was selected'</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/29/Upper-Confidence-bound/14.png" style="zoom:100%;"></p>
<p>查看ads_selected会发现编号4出现的次数最多，即第五个广告ad5。经过10000轮之后，最终的reward值为2178。和上面的随机算法相比，reward提升了很多很多</p>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/10/25/Apriori%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/25/Apriori%E7%AE%97%E6%B3%95/" itemprop="url">Apriori算法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-25T16:15:52+08:00">
                2020-10-25
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2020-10-26T19:14:30+08:00">
                2020-10-26
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Apriori算法"><a href="#Apriori算法" class="headerlink" title="Apriori算法"></a>Apriori算法</h1><p>参考博客：<a href="https://www.jianshu.com/p/ab23a7444d2a" target="_blank" rel="noopener">https://www.jianshu.com/p/ab23a7444d2a</a></p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>Apriori 是先验算法之意。简单来说就是找出不同事件之间的联系。比如一个人在超市买了产品A，他可能会买货物B。最有名的例子就是沃尔玛百货将他们的纸尿裤和啤酒并排摆在一起销售，结果纸尿裤和啤酒的销量双双增长。</p>
<p><img src="/2020/10/25/Apriori%E7%AE%97%E6%B3%95/1.png" style="zoom:80%;"></p>
<p>从这个用户喜欢的电影表分析，我们或许可以得到以上三个潜在的关系。看过Movie1的基本都会看Movie2，和Movie3之类的。这些潜在的关系可能是联系性很强的也可能是联系性很弱的。我们想要找到的就是那些关联性很强的对象来作为商业决策的依据</p>
<p>下面是另外一个例子：</p>
<p><img src="/2020/10/25/Apriori%E7%AE%97%E6%B3%95/2.png" style="zoom:80%;"></p>
<p>先验算法当中有三个核心概念，<strong>support(支持度)</strong>，<strong>confidence(信心水准)</strong>  ，<strong>lift(提升度)</strong>。</p>
<p>先来看看<strong>支持度</strong>，比如交易的例子，对于一个商品I来说，那么就是<strong>所有包含商品I的交易数目</strong>除以<strong>总的交易数目</strong>：</p>
<p><img src="/2020/10/25/Apriori%E7%AE%97%E6%B3%95/3.png" style="zoom:80%;"></p>
<p>然后我们来看看<strong>confidence(信心水准)</strong> ：</p>
<p>M1代表电影1，M2代表电影2，那么信心水准就是同时看过电影1和2的人除以看过电影1但没看过电影2的人</p>
<p>这里I1表示商品1，I2表示商品2，那么信心水准就是同时包含商品1和2的交易除以包含商品1的交易记录个数。</p>
<p><img src="/2020/10/25/Apriori%E7%AE%97%E6%B3%95/4.png" style="zoom:80%;"></p>
<p>第三个概念，<strong>提升度</strong>，这个和支持度和信心水准有关,就是<strong>configdence除以support</strong>。当这个提升度<strong>大于1</strong>时，我们可以认为商品 $I_1$对$I_2$是有提升的。</p>
<p><img src="/2020/10/25/Apriori%E7%AE%97%E6%B3%95/5.png" style="zoom:80%;"></p>
<p>那么现在做个总结，这个先验算法主要可以分为四步：</p>
<ol>
<li>设置一个最低的support和confidence</li>
<li>选择所有support比刚刚设置的要大的商品</li>
<li>根据刚刚已经选择的商品，选择所有比刚刚定义的最小confidence要高的所有规则的集合</li>
<li><p>把刚刚的规则从大到小排序，选出提升度最高的几个。</p>
<p><img src="/2020/10/25/Apriori%E7%AE%97%E6%B3%95/6.png" style="zoom:80%;"></p>
</li>
</ol>
<p>这就是基本的先验算法的步骤，他只提供了最基本、最直接的解决找出事务之间相互联系的方法。但是像谷歌、脸书这样的大公司，他们有自己的推荐算法，会比Apriori要先进、复杂很多。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>这是我们使用的数据集，每一行记录了一周以来的每一个顾客购买的所有商品，一共有7501 行</p>
<p><img src="/2020/10/25/Apriori%E7%AE%97%E6%B3%95/7.png" style="zoom:80%;"></p>
<h3 id="Importing-the-libraries"><a href="#Importing-the-libraries" class="headerlink" title="Importing the libraries"></a>Importing the libraries</h3><p>首先我们导入库并安装一下<code>apyori</code>包,这个包是独立于scikit-learn 的，所以我们要另外安装</p>
<p><code>!pip install apyori</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></table></figure>
<h3 id="Data-Preprocessing"><a href="#Data-Preprocessing" class="headerlink" title="Data Preprocessing"></a>Data Preprocessing</h3><p>然后我们导入数据集 Market_Basket_Optimisation 并对数据进行初步的处理</p>
<p>因为这张数据表没有表头，所以我们在导入的时候先要提醒pandas ： <code>header = None</code> 以免它把第一行变成列名。</p>
<p>随后我们需要把数据集整合成一个二维数组，一共有 7501行，我们就做7501次循环</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dataset = pd.read_csv(<span class="string">'Market_Basket_Optimisation.csv'</span>, header = <span class="literal">None</span>)</span><br><span class="line">transactions = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">7501</span>):</span><br><span class="line">    transactions.append([str(dataset.values[i,j]) <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">20</span>)])</span><br></pre></td></tr></table></figure>
<p>在每次循环当中，我们用append方法将一行中每一个单元格中的字符串一一串联。因为最长的一行有20个物品，所以我们要用 range(0,20) 以确保每一件商品都囊括在内。</p>
<p>最后每一个transaction的结果如下：</p>
<p><img src="/2020/10/25/Apriori%E7%AE%97%E6%B3%95/11.png"></p>
<p>没有到20个商品的行表示如下：</p>
<p><img src="/2020/10/25/Apriori%E7%AE%97%E6%B3%95/12.png"></p>
<h3 id="Training-the-Apriori-model-on-the-dataset"><a href="#Training-the-Apriori-model-on-the-dataset" class="headerlink" title="Training the Apriori model on the dataset"></a>Training the Apriori model on the dataset</h3><p>随后我们要用Apriori模型训练我们的数据集：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># WARNING: Make sure to upload the apyori.py file into this Colab notebook before running this cell</span></span><br><span class="line"><span class="keyword">from</span> apyori <span class="keyword">import</span> apriori</span><br><span class="line">rules = apriori(transactions = transactions, </span><br><span class="line">                min_support = <span class="number">0.003</span>,</span><br><span class="line">                min_confidence = <span class="number">0.2</span>,</span><br><span class="line">                min_lift = <span class="number">3</span>, </span><br><span class="line">                min_length = <span class="number">2</span>,</span><br><span class="line">                max_length = <span class="number">2</span></span><br><span class="line">               )</span><br></pre></td></tr></table></figure>
<p>在导入apyori中的apriori类之后，我们需要对这个算法制定一些规则：第一个参数存放我们的二维数组</p>
<p>min_support 即最小的支持度,通常我们这个值会设的比较低，我们就假设一件商品每天至少出现3次，那么计算<code>(3*7)/7501=0.0028</code> 后得到min_support 的值为0.003</p>
<p>min_confidence 即最小的信心水准.设置得太高会导致没有association rule，设置得太低导致association rule过多不易选择。我们可以多尝试几次，这里我们取0.2</p>
<p>min_lift 即最小的提升度，我们也可以多次尝试找到合适的最小提升度。这里我们推荐 min_lift = 3</p>
<p>min_length ,max_length 都等于2 的意思是只求一件物品和另一件物品之间的联系，而不是一件对多件/多件对多件之间的联系。这样我们可以针对某件特殊的商品给出一点优惠政策之类的销售方案。</p>
<h3 id="Visualizing-the-results"><a href="#Visualizing-the-results" class="headerlink" title="Visualizing the results"></a>Visualizing the results</h3><h4 id="Displaying-the-first-results-coming-directly-from-the-output-of-the-apriori-function"><a href="#Displaying-the-first-results-coming-directly-from-the-output-of-the-apriori-function" class="headerlink" title="Displaying the first results coming directly from the output of the apriori function"></a>Displaying the first results coming directly from the output of the apriori function</h4><p>要显示训练之后的结恶果，我们只要将rules放到一个list中即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">results = list(rules)</span><br><span class="line">print(results)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/25/Apriori%E7%AE%97%E6%B3%95/8.png"></p>
<h4 id="Putting-the-results-well-organized-into-a-Pandas-DataFrame"><a href="#Putting-the-results-well-organized-into-a-Pandas-DataFrame" class="headerlink" title="Putting the results well organized into a Pandas DataFrame"></a>Putting the results well organized into a Pandas DataFrame</h4><p>但是上面的结果毕竟可读性很差，我们需要将其改成一个DataFrame，会更直观。</p>
<p>我们发现一个 <code>RelationRecord</code> 的结构如下，分为三个部分：items，support和ordered_statistics.其中ordered_statistics是一个列表。列表中又是一个元组，元组的第一、二个元素是frozenset也就是冻结的集合(冻结后集合不能再添加或删除任何元素)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">RelationRecord(items=frozenset(&#123;<span class="string">'chicken'</span>, <span class="string">'light cream'</span>&#125;), </span><br><span class="line">			   support=<span class="number">0.004532728969470737</span>, </span><br><span class="line">			   ordered_statistics=[OrderedStatistic(</span><br><span class="line">                   									items_base=frozenset(&#123;<span class="string">'light cream'</span>&#125;), </span><br><span class="line">			  					   					items_add=frozenset(&#123;<span class="string">'chicken'</span>&#125;), </span><br><span class="line">			   										confidence=<span class="number">0.29059829059829057</span>, </span><br><span class="line">			   										lift=<span class="number">4.84395061728395</span></span><br><span class="line">                                                   )</span><br><span class="line">                                  ]</span><br><span class="line">              )</span><br></pre></td></tr></table></figure>
<p>所以 result[2]先定位到了 ordered_statistics</p>
<p>因为ordered_statistics中只有一个列表，所以定位到 result[2][0] .</p>
<p>result[2][0][0]和result[2][0][1] 则定位到了 items_base和items_add，因为这两个都是冻结集合，我们将其转换为tuple之后从中取出第一个元素(总共才一个元素)作为我们的Left Hand Side 和 Right Hand Side (我们假设这两件商品将会分别放到顾客的左手边和右手边)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inspect</span><span class="params">(results)</span>:</span></span><br><span class="line">    lhs         = [tuple(result[<span class="number">2</span>][<span class="number">0</span>][<span class="number">0</span>])[<span class="number">0</span>] <span class="keyword">for</span> result <span class="keyword">in</span> results]</span><br><span class="line">    rhs         = [tuple(result[<span class="number">2</span>][<span class="number">0</span>][<span class="number">1</span>])[<span class="number">0</span>] <span class="keyword">for</span> result <span class="keyword">in</span> results]</span><br><span class="line">    supports    = [result[<span class="number">1</span>] <span class="keyword">for</span> result <span class="keyword">in</span> results]</span><br><span class="line">    confidences = [result[<span class="number">2</span>][<span class="number">0</span>][<span class="number">2</span>] <span class="keyword">for</span> result <span class="keyword">in</span> results]</span><br><span class="line">    lifts       = [result[<span class="number">2</span>][<span class="number">0</span>][<span class="number">3</span>] <span class="keyword">for</span> result <span class="keyword">in</span> results]</span><br><span class="line">    <span class="keyword">return</span> list(zip(lhs, rhs, supports, confidences, lifts))</span><br><span class="line">resultsinDataFrame = pd.DataFrame(inspect(results),</span><br><span class="line">                                  columns = [<span class="string">'Left Hand Side'</span>, </span><br><span class="line">		                                     <span class="string">'Right Hand Side'</span>,</span><br><span class="line">        		                             <span class="string">'Support'</span>,</span><br><span class="line">                		                     <span class="string">'Confidence'</span>,</span><br><span class="line">                        		             <span class="string">'Lift'</span>]</span><br><span class="line">                                 )</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/25/Apriori%E7%AE%97%E6%B3%95/9.png" style="zoom:120%;"></p>
<p>我们看到一共有9件商品组合，于是我们可以将这九种组合打包销售或者放在货架的两边以提高两件商品的销售量。</p>
<h4 id="Displaying-the-results-sorted-by-descending-lifts"><a href="#Displaying-the-results-sorted-by-descending-lifts" class="headerlink" title="Displaying the results sorted by descending lifts"></a>Displaying the results sorted by descending lifts</h4><p>然后我们可以降序来选择相关度最高的十种商品组合(总共只有9种)。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">resultsinDataFrame.nlargest(n = <span class="number">10</span>, columns = <span class="string">'Lift'</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/25/Apriori%E7%AE%97%E6%B3%95/10.png" style="zoom: 120%;"></p>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/10/25/bomblab/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/25/bomblab/" itemprop="url">bomblab</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-25T15:48:53+08:00">
                2020-10-25
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2020-11-17T18:57:36+08:00">
                2020-11-17
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="bomblab"><a href="#bomblab" class="headerlink" title="bomblab"></a>bomblab</h1><p>炸弹人，炸弹魂，拆弹人是人下人。CSAPP 终于要我们做Lab02了。首先我们来介绍一下GDB</p>
<h2 id="GDB"><a href="#GDB" class="headerlink" title="GDB"></a>GDB</h2><p>GDB指令很多，我这里只列举一下在bomblab调试中常用的指令</p>
<p><code>gdb 文件名</code>                      调试某个文件</p>
<p><code>break+函数名/地址</code>        在某一个函数上设置断点</p>
<p><code>run</code>                                  运行程序</p>
<p><code>i r 寄存器名</code>                 查看寄存器当中的内容</p>
<p><code>ni</code>                                   单步执行(不会进入调用函数内部)</p>
<p><code>si</code>                                   单步进入(会进入调用函数内部)</p>
<p><code>display /9i $pc</code>        在每次运行一步之后会显示之后要执行的9行汇编代码，非常好用。</p>
<p><code>set var *地址 =</code>         修改某个地址上的值</p>
<p><code>x/&lt;n/f/u&gt; &lt;addr&gt;</code>      查看某个地址中的值</p>
<p>n:是正整数，<strong>表示需要显示的内存单元的个数</strong>，即从当前地址向后显示n个内存单元的内容，一个内存单元的大小由第三个参数u定义。</p>
<p>f:表示addr指向的内存内容的输出格式，s对应输出字符串</p>
<p>此处需特别注意输出整型数据的格式：</p>
<p>x 按十六进制格式显示变量。</p>
<p>d 按十进制格式显示变量。</p>
<p>u 按十六进制格式显示无符号整型。</p>
<p>o 按八进制格式显示变量。</p>
<p>t 按二进制格式显示变量。</p>
<p>a 按十六进制格式显示变量。</p>
<p>c 按字符格式显示变量。</p>
<p>f 按浮点数格式显示变量。</p>
<p>我们常用</p>
<p><code>x/s 地址</code> 来看一个地址上存储的字符串</p>
<p><code>x/wd 地址</code> 来看一个地址上存储的数字</p>
<p><code>x/x 地址</code> 来看一个地址上存储的十六进制的地址 。同理，<code>x/3x 0x54320</code> 比如说以地址0x54320为起始地址，返回3个单元的值，输出格式为十六进制。</p>
<h2 id="phase-1"><a href="#phase-1" class="headerlink" title="phase_1"></a>phase_1</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Phase_1:   </span><br><span class="line">   0x08048b33 &lt;+0&gt;:     sub    $0x14,%esp			</span><br><span class="line">   0x08048b36 &lt;+3&gt;:     push   $0x804a024</span><br><span class="line">   0x08048b3b &lt;+8&gt;:     pushl  0x1c(%esp)</span><br><span class="line">   0x08048b3f &lt;+12&gt;:    call   0x8049019 &lt;strings_not_equal&gt;</span><br><span class="line">   0x08048b44 &lt;+17&gt;:    add    $0x10,%esp</span><br><span class="line">   0x08048b47 &lt;+20&gt;:    test   %eax,%eax</span><br><span class="line">   0x08048b49 &lt;+22&gt;:    je     0x8048b50 &lt;phase_1+29&gt;</span><br><span class="line">   0x08048b4b &lt;+24&gt;:    call   0x8049110 &lt;explode_bomb&gt;</span><br><span class="line">   0x08048b50 &lt;+29&gt;:    add    $0xc,%esp</span><br><span class="line">   0x08048b53 &lt;+32&gt;:    ret</span><br></pre></td></tr></table></figure>
<p>我们首先用 <code>i r esp</code> 指令来看看当前的栈顶指针为多少：</p>
<p><code>esp            0xffffd23c       0xffffd23c</code></p>
<p>运行第一句之后，esp减去了 0x14</p>
<p><code>esp            0xffffd228       0xffffd228</code></p>
<p>运行，将地址 0x804a024 上的值压栈，用 <code>x/s 0x804a024</code> 来查看地址上的内容并用字符串的形式输出</p>
<p><code>0x804a024:      &quot;All your base are belong to us.&quot;</code></p>
<p>运行，phase_1函数调用了 strings_not_equal 函数，我们来看看在这个函数的内部逻辑：</p>
<p>strings_not_equal: 第五行、第六行是将 两个栈上的地址分别存入到 %ebx,%esi 中，</p>
<p>我们可以先用 i r esp 看看栈顶指针</p>
<p><code>esp            0xffffd210       0xffffd210</code></p>
<p>可以看看栈顶指针分别加上 0x10, 0x14  <code>p/x *0xffffd220</code>   <code>p/x *0xffffd224</code>   </p>
<p>发现值：0x804a024 和 0x804c3e0 </p>
<p>在存入寄存器后，我们发现寄存器中存入的值就是上面的两个地址，来看看这两个寄存器当中存入了什么值：</p>
<p><code>esi            0x804a024        134520868</code></p>
<p><code>ebx            0x804c3e0        134530016</code> </p>
<p>要看看这个地址上的数据, 可以用  <code>x/s 地址</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x&#x2F;s 0x804a024</span><br><span class="line">0x804a024:      &quot;All your base are belong to us.&quot;</span><br><span class="line">(gdb) x&#x2F;s  0x804c3e0</span><br><span class="line">0x804c3e0 &lt;input_strings&gt;:      &quot;xuqihang&quot;</span><br></pre></td></tr></table></figure>
<p>我们看到，ebx 中存放的是我们输入的字符串, esi 中存放我们要对比的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">strings_not_equal:</span><br><span class="line">   0x08049019 &lt;+0&gt;:     push   %edi</span><br><span class="line">   0x0804901a &lt;+1&gt;:     push   %esi</span><br><span class="line">   0x0804901b &lt;+2&gt;:     push   %ebx</span><br><span class="line">   0x0804901c &lt;+3&gt;:     mov    0x10(%esp),%ebx</span><br><span class="line">   0x08049020 &lt;+7&gt;:     mov    0x14(%esp),%esi</span><br><span class="line">   0x08049024 &lt;+11&gt;:    push   %ebx</span><br><span class="line">   0x08049025 &lt;+12&gt;:    call   0x8048ffa &lt;string_length&gt;</span><br><span class="line">   0x0804902a &lt;+17&gt;:    mov    %eax,%edi</span><br><span class="line">   0x0804902c &lt;+19&gt;:    mov    %esi,(%esp)</span><br><span class="line">   0x0804902f &lt;+22&gt;:    call   0x8048ffa &lt;string_length&gt;</span><br><span class="line">   0x08049034 &lt;+27&gt;:    add    $0x4,%esp</span><br><span class="line">   0x08049037 &lt;+30&gt;:    mov    $0x1,%edx</span><br><span class="line">   0x0804903c &lt;+35&gt;:    cmp    %eax,%edi</span><br><span class="line">   0x0804903e &lt;+37&gt;:    jne    0x8049078 &lt;strings_not_equal+95&gt;</span><br><span class="line">   0x08049040 &lt;+39&gt;:    movzbl (%ebx),%eax</span><br><span class="line">   0x08049043 &lt;+42&gt;:    test   %al,%al</span><br><span class="line">   0x08049045 &lt;+44&gt;:    je     0x8049065 &lt;strings_not_equal+76&gt;</span><br><span class="line">   0x08049047 &lt;+46&gt;:    cmp    (%esi),%al</span><br><span class="line">   0x08049049 &lt;+48&gt;:    je     0x8049051 &lt;strings_not_equal+56&gt;</span><br><span class="line">   0x0804904b &lt;+50&gt;:    jmp    0x804906c &lt;strings_not_equal+83&gt;</span><br><span class="line">   0x0804904d &lt;+52&gt;:    cmp    (%esi),%al</span><br><span class="line">   0x0804904f &lt;+54&gt;:    jne    0x8049073 &lt;strings_not_equal+90&gt;</span><br><span class="line">   0x08049051 &lt;+56&gt;:    add    $0x1,%ebx</span><br><span class="line">   0x08049054 &lt;+59&gt;:    add    $0x1,%esi</span><br><span class="line">   0x08049057 &lt;+62&gt;:    movzbl (%ebx),%eax</span><br><span class="line">   0x0804905a &lt;+65&gt;:    test   %al,%al</span><br><span class="line">   0x0804905c &lt;+67&gt;:    jne    0x804904d &lt;strings_not_equal+52&gt;</span><br><span class="line">   0x0804905e &lt;+69&gt;:    mov    $0x0,%edx</span><br><span class="line">   0x08049063 &lt;+74&gt;:    jmp    0x8049078 &lt;strings_not_equal+95&gt;</span><br><span class="line">   0x08049065 &lt;+76&gt;:    mov    $0x0,%edx</span><br><span class="line">   0x0804906a &lt;+81&gt;:    jmp    0x8049078 &lt;strings_not_equal+95&gt;</span><br><span class="line">   0x0804906c &lt;+83&gt;:    mov    $0x1,%edx</span><br><span class="line">   0x08049071 &lt;+88&gt;:    jmp    0x8049078 &lt;strings_not_equal+95&gt;</span><br><span class="line">   0x08049073 &lt;+90&gt;:    mov    $0x1,%edx</span><br><span class="line">   0x08049078 &lt;+95&gt;:    mov    %edx,%eax</span><br><span class="line">   0x0804907a &lt;+97&gt;:    pop    %ebx</span><br><span class="line">   0x0804907b &lt;+98&gt;:    pop    %esi</span><br><span class="line">   0x0804907c &lt;+99&gt;:    pop    %edi</span><br><span class="line">   0x0804907d &lt;+100&gt;:   ret</span><br></pre></td></tr></table></figure>
<p>如果相等，那么就返回1，否则返回0。 然后函数Phase_1会对返回值进行一个test，也就是按位与操作，如果返回值是1，那么就不会爆炸；如果返回值是0，那么就会爆炸。</p>
<p>于是我们知道第一关的密码是 All your base are belong to us.</p>
<h2 id="Phase-2"><a href="#Phase-2" class="headerlink" title="Phase_2"></a>Phase_2</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Phase_2   </span><br><span class="line">   0x08048b54 &lt;+0&gt;:     push   %esi</span><br><span class="line">   0x08048b55 &lt;+1&gt;:     push   %ebx</span><br><span class="line">   0x08048b56 &lt;+2&gt;:     sub    $0x2c,%esp</span><br><span class="line">   0x08048b59 &lt;+5&gt;:     mov    %gs:0x14,%eax</span><br><span class="line">   0x08048b5f &lt;+11&gt;:    mov    %eax,0x24(%esp)	</span><br><span class="line">   0x08048b63 &lt;+15&gt;:    xor    %eax,%eax 		# eax置0</span><br><span class="line">   0x08048b65 &lt;+17&gt;:    lea    0xc(%esp),%eax</span><br><span class="line">   0x08048b69 &lt;+21&gt;:    push   %eax</span><br><span class="line">   0x08048b6a &lt;+22&gt;:    pushl  0x3c(%esp)</span><br><span class="line">   0x08048b6e &lt;+26&gt;:    call   0x8049135 &lt;read_six_numbers&gt; # 读入6个数字</span><br></pre></td></tr></table></figure>
<p>我们先看看栈顶指针：<code>esp            0xffffd23c       0xffffd23c</code></p>
<p>然后push了两个寄存器，现在 esp 变成了 <code>0xffffd234</code> </p>
<p>随后栈顶指针减去了 0x2c也就是减了44个字节，这时候<code>esp        0xffffd208       0xffffd208</code></p>
<p>push %eax和0x3c(%esp) 之后，栈顶指针现在是 <code>0xffffd200</code></p>
<p>然后phase_2调用了 read_six_numbers,我们进入到函数一窥究竟</p>
<p>栈顶指针又减去了 0xc，栈顶指针现在是<code>0xffffd1f0</code></p>
<p>随后做的一系列操作就是将我们输入的六个数字的地址(这时候还未读入)压入栈中</p>
<p> 在scanf函数之前，esp 已经来到了<code>0xffffd1cc</code></p>
<p>调用scanf之后，esp现在的值是<code>0xffffd1d0</code></p>
<p>加上0x20之后，现在 esp是 <code>0xffffd1f0</code></p>
<p>然后会用 %eax和5作比较，%eax记录了scanf函数的返回值也就是输入数字的个数，这里我已经输入了6、5、4、3、2、1 一共6个数所以现在eax中的值是6.</p>
<p>最后%esp加上了0xc后返回，现在esp的值为 <code>0xffffd1fc</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">0x08049135 &lt;+0&gt;:     sub    $0xc,%esp</span><br><span class="line">0x08049138 &lt;+3&gt;:     mov    0x14(%esp),%eax</span><br><span class="line">0x0804913c &lt;+7&gt;:     lea    0x14(%eax),%edx</span><br><span class="line">0x0804913f &lt;+10&gt;:    push   %edx</span><br><span class="line">0x08049140 &lt;+11&gt;:    lea    0x10(%eax),%edx</span><br><span class="line">0x08049143 &lt;+14&gt;:    push   %edx</span><br><span class="line">0x08049144 &lt;+15&gt;:    lea    0xc(%eax),%edx</span><br><span class="line">0x08049147 &lt;+18&gt;:    push   %edx</span><br><span class="line">0x08049148 &lt;+19&gt;:    lea    0x8(%eax),%edx</span><br><span class="line">0x0804914b &lt;+22&gt;:    push   %edx</span><br><span class="line">0x0804914c &lt;+23&gt;:    lea    0x4(%eax),%edx</span><br><span class="line">0x0804914f &lt;+26&gt;:    push   %edx</span><br><span class="line">0x08049150 &lt;+27&gt;:    push   %eax</span><br><span class="line">0x08049151 &lt;+28&gt;:    push   $0x804a1e3</span><br><span class="line">0x08049156 &lt;+33&gt;:    pushl  0x2c(%esp)</span><br><span class="line">0x0804915a &lt;+37&gt;:    call   0x8048810 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">0x0804915f &lt;+42&gt;:    add    $0x20,%esp</span><br><span class="line">0x08049162 &lt;+45&gt;:    cmp    $0x5,%eax</span><br><span class="line">0x08049165 &lt;+48&gt;:    jg     0x804916c &lt;read_six_numbers+55&gt;</span><br><span class="line">0x08049167 &lt;+50&gt;:    call   0x8049110 &lt;explode_bomb&gt;</span><br><span class="line">0x0804916c &lt;+55&gt;:    add    $0xc,%esp</span><br><span class="line">0x0804916f &lt;+58&gt;:    ret</span><br></pre></td></tr></table></figure>
<p>回到phase_2,%esp又加上了0x10，现在 esp中的值为<code>0xffffd210</code> </p>
<p>接着让 %esp+4 地址上存放的东西和0去比，必须和0相等，否则就爆炸。那么我们来看看  %esp+4 地址上存放的是什么值：</p>
<p><code>p/x *0xffffd214 : $8 = 0x6</code>   发现是6，所以我们推断这个地址上存放的值是我们输入的第一个数</p>
<p>以此类推，我们看一看 <code>0xffffd218 , 0xffffd21c,0xffffd220,0xffffd224,0xffffd228</code>中得知，发现分别是：5，4，3，2，1 猜想成立。</p>
<p>所以我们直到第一个值必须要等于0，否则就爆炸。同理，第二个值必须等于1，否则就爆炸。</p>
<p>现在来到了 +53 这行指令。我们把<strong>第一个参数的地址</strong>移到 %ebx中，将第5个数字移动到%esi中</p>
<p><code>+61</code>将 0x4(%ebx) 也就是<strong>第二个参数的值</strong>移动到了%eax当中</p>
<p><code>+64</code> 并让其和 (%ebx) 也就是<strong>第一个参数的值</strong> 相加，这就让 <strong>%eax = 第二个参数的值+第一个参数的值</strong> </p>
<p><code>+66</code>让 0x8(%ebx) 也就是<strong>第三个参数</strong>和 %eax相比，不相等就爆炸。于是我们推测第三个参数应该等于前两个参数之和。</p>
<p><code>+76</code> 将 %ebx加上4，也就是现在 %ebx指向了<strong>第二个参数的地址</strong> </p>
<p><code>+81</code> 跳转回 <code>+61</code> 重复上述操作。</p>
<p>至此我们可以推断出这是一个6位数的斐波那契数列，输入的值应该为： 0 1 1 2 3  5</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Phase_2_continue:</span><br><span class="line">   0x08048b73 &lt;+31&gt;:    add    $0x10,%esp</span><br><span class="line">   0x08048b76 &lt;+34&gt;:    cmpl   $0x0,0x4(%esp)</span><br><span class="line">   0x08048b7b &lt;+39&gt;:    jne 0x8048b84 &lt;phase_2+48&gt;</span><br><span class="line">   0x08048b7d &lt;+41&gt;:    cmpl   $0x1,0x8(%esp)</span><br><span class="line">   0x08048b82 &lt;+46&gt;:    je     0x8048b89 &lt;phase_2+53&gt;</span><br><span class="line">   0x08048b84 &lt;+48&gt;:    call   0x8049110 &lt;explode_bomb&gt;</span><br><span class="line">   0x08048b89 &lt;+53&gt;:    lea    0x4(%esp),%ebx</span><br><span class="line">   0x08048b8d &lt;+57&gt;:    lea    0x14(%esp),%esi</span><br><span class="line">   0x08048b91 &lt;+61&gt;:    mov    0x4(%ebx),%eax</span><br><span class="line">   0x08048b94 &lt;+64&gt;:    add    (%ebx),%eax</span><br><span class="line">   0x08048b96 &lt;+66&gt;:    cmp    %eax,0x8(%ebx)</span><br><span class="line">   0x08048b99 &lt;+69&gt;:    je     0x8048ba0 &lt;phase_2+76&gt;</span><br><span class="line">   0x08048b9b &lt;+71&gt;:    call   0x8049110 &lt;explode_bomb&gt;</span><br><span class="line">   0x08048ba0 &lt;+76&gt;:    add    $0x4,%ebx</span><br><span class="line">   0x08048ba3 &lt;+79&gt;:    cmp    %esi,%ebx</span><br><span class="line">   0x08048ba5 &lt;+81&gt;:    jne    0x8048b91 &lt;phase_2+61&gt;</span><br><span class="line">   0x08048ba7 &lt;+83&gt;:    mov    0x1c(%esp),%eax</span><br><span class="line">   0x08048bab &lt;+87&gt;:    xor    %gs:0x14,%eax</span><br><span class="line">   0x08048bb2 &lt;+94&gt;:    je     0x8048bb9 &lt;phase_2+101&gt;</span><br><span class="line">   0x08048bb4 &lt;+96&gt;:    call   0x8048790 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">   0x08048bb9 &lt;+101&gt;:   add    $0x24,%esp</span><br><span class="line">   0x08048bbc &lt;+104&gt;:   pop    %ebx</span><br><span class="line">   0x08048bbd &lt;+105&gt;:   pop    %esi</span><br><span class="line">   0x08048bbe &lt;+106&gt;:   ret</span><br></pre></td></tr></table></figure>
<h2 id="Phase-3"><a href="#Phase-3" class="headerlink" title="Phase_3"></a>Phase_3</h2><p>首先我们设个断点 <code>b phase_3</code> ,并随便输入2个数，我输入的是 1 43</p>
<p>直接看看<code>+25</code> 处藏着什么东西。<code>0x804a1ef:      &quot;%d %d&quot;</code> ,是两个 整数，我们猜测第三关要输入两个整数。</p>
<p><code>+42</code> 中的eax存放的是 scanf的返回值，让其与1相比，一定要大于才能继续，所以更应证了我们的猜想，即输入两个整数。</p>
<p><code>+52</code>  开始，函数对输入的数字进行了一系列操作。因为首先是用  <code>0x4(%esp)</code> 和 7相比，我们就看看这个地址上存入的是什么</p>
<p><code>esp            0xffffd1c0       0xffffd1c0</code></p>
<p><code>0xffffd1c4:     1</code> <code>0xffffd1c8:     43</code></p>
<p>我们发现我们输入的两个数存放到了栈上。</p>
<p><code>+57</code> 说，如果above 0x7,那么就直接爆炸，那么我们知道了我们输入的第一个数是无符号整数，且要小于7</p>
<p><code>&lt;+171&gt;:   cmpl   $0x5,0x4(%esp)</code> 说，如果第一个参数大于5，也要爆炸，所以我们直到第一个整数是无符号的，且小于等于五。</p>
<p>因此可以取 0，1，2，3，4，5</p>
<p><code>&lt;+59&gt;</code> 是将第一个参数移到 eax中去</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Phase_3</span><br><span class="line">   0x08048bbf &lt;+0&gt;:     sub    $0x1c,%esp</span><br><span class="line">   0x08048bc2 &lt;+3&gt;:     mov    %gs:0x14,%eax</span><br><span class="line">   0x08048bc8 &lt;+9&gt;:     mov    %eax,0xc(%esp)</span><br><span class="line">   0x08048bcc &lt;+13&gt;:    xor    %eax,%eax</span><br><span class="line">   0x08048bce &lt;+15&gt;:    lea    0x8(%esp),%eax</span><br><span class="line">   0x08048bd2 &lt;+19&gt;:    push   %eax</span><br><span class="line">   0x08048bd3 &lt;+20&gt;:    lea    0x8(%esp),%eax</span><br><span class="line">   0x08048bd7 &lt;+24&gt;:    push   %eax</span><br><span class="line">   0x08048bd8 &lt;+25&gt;:    push   $0x804a1ef</span><br><span class="line">   0x08048bdd &lt;+30&gt;:    pushl  0x2c(%esp)</span><br><span class="line">   0x08048be1 &lt;+34&gt;:    call   0x8048810 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">   0x08048be6 &lt;+39&gt;:    add    $0x10,%esp</span><br><span class="line">   0x08048be9 &lt;+42&gt;:    cmp    $0x1,%eax</span><br><span class="line">   0x08048bec &lt;+45&gt;:    jg     0x8048bf3 &lt;phase_3+52&gt;</span><br><span class="line">   0x08048bee &lt;+47&gt;:    call   0x8049110 &lt;explode_bomb&gt;</span><br><span class="line">   0x08048bf3 &lt;+52&gt;:    cmpl   $0x7,0x4(%esp)</span><br><span class="line">   0x08048bf8 &lt;+57&gt;:    ja     0x8048c60 &lt;phase_3+161&gt;</span><br><span class="line">   0x08048bfa &lt;+59&gt;:    mov    0x4(%esp),%eax</span><br></pre></td></tr></table></figure>
<p><code>+63</code> 开始，是一个switch 语句,我们可以用 <code>x/x 0x804a080</code> 来查看这个地址上存放的东西。</p>
<p><code>0x804a080:      0x08048c05</code> 发现正好是 +70</p>
<p><code>0x804a084:      0x08048c0c</code>发现是+77</p>
<p><code>0x804a088:      0x08048c18</code> 发现是+89</p>
<p><code>0x804a08c:      0x08048c24</code> 发现是+101</p>
<p><code>0x804a090:      0x08048c30</code> 发现是+113</p>
<p><code>0x804a094:      0x08048c3c</code> 发现是+125</p>
<p><code>0x804a098:      0x08048c48</code> 发现是 +137</p>
<p><code>0x804a09c:      0x08048c54</code> 发现是+154</p>
<p>所以我们可以进行一个计算：</p>
<p>如果第一个参数是 0  $\rightarrow$ 跳转到 +70 </p>
<p>如果第一个参数是 1 $\rightarrow$  跳转到 +77</p>
<p>如果第一个参数是2 $\rightarrow$ 跳转到+89</p>
<p>如果第一个参数是3 $\rightarrow$ 跳转到+101</p>
<p>如果第一个参数是4$\rightarrow$ 跳转到+113</p>
<p>如果第一个参数是5$\rightarrow$ 跳转到+125</p>
<p>然后再线性运算。</p>
<p>因此我们只要看<code>+178</code>  的时候，eax中最后的数字就可以了。因为这句话的意思是让 eax和我们输入的第二个参数相比，如果不相等就爆炸；相等就成功过关</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">0x08048bfe &lt;+63&gt;:    jmp    *0x804a080(,%eax,4)</span><br><span class="line">0x08048c05 &lt;+70&gt;:    mov    $0x193,%eax</span><br><span class="line">0x08048c0a &lt;+75&gt;:    jmp    0x8048c11 &lt;phase_3+82&gt;</span><br><span class="line">0x08048c0c &lt;+77&gt;:    mov    $0x0,%eax</span><br><span class="line">0x08048c11 &lt;+82&gt;:    sub    $0x191,%eax</span><br><span class="line">0x08048c16 &lt;+87&gt;:    jmp    0x8048c1d &lt;phase_3+94&gt;</span><br><span class="line">0x08048c18 &lt;+89&gt;:    mov    $0x0,%eax</span><br><span class="line">0x08048c1d &lt;+94&gt;:    add    $0x3c8,%eax</span><br><span class="line">0x08048c22 &lt;+99&gt;:    jmp    0x8048c29 &lt;phase_3+106&gt;</span><br><span class="line">0x08048c24 &lt;+101&gt;:   mov    $0x0,%eax</span><br><span class="line">0x08048c29 &lt;+106&gt;:   sub    $0x129,%eax</span><br><span class="line">0x08048c2e &lt;+111&gt;:   jmp    0x8048c35 &lt;phase_3+118&gt;</span><br><span class="line">0x08048c30 &lt;+113&gt;:   mov    $0x0,%eax</span><br><span class="line">0x08048c35 &lt;+118&gt;:   add    $0x129,%eax</span><br><span class="line">0x08048c3a &lt;+123&gt;:   jmp    0x8048c41 &lt;phase_3+130&gt;</span><br><span class="line">0x08048c3c &lt;+125&gt;:   mov    $0x0,%eax</span><br><span class="line">0x08048c41 &lt;+130&gt;:   sub    $0x129,%eax</span><br><span class="line">0x08048c46 &lt;+135&gt;:   jmp    0x8048c4d &lt;phase_3+142&gt;</span><br><span class="line">0x08048c48 &lt;+137&gt;:   mov    $0x0,%eax</span><br><span class="line">0x08048c4d &lt;+142&gt;:   add    $0x129,%eax</span><br><span class="line">0x08048c52 &lt;+147&gt;:   jmp    0x8048c59 &lt;phase_3+154&gt;</span><br><span class="line">0x08048c54 &lt;+149&gt;:   mov    $0x0,%eax</span><br><span class="line">0x08048c59 &lt;+154&gt;:   sub    $0x129,%eax</span><br><span class="line">0x08048c5e &lt;+159&gt;:   jmp    0x8048c6a &lt;phase_3+171&gt;</span><br><span class="line">0x08048c60 &lt;+161&gt;:   call   0x8049110 &lt;explode_bomb&gt;</span><br><span class="line">0x08048c65 &lt;+166&gt;:   mov    $0x0,%eax</span><br><span class="line">0x08048c6a &lt;+171&gt;:   cmpl   $0x5,0x4(%esp)</span><br><span class="line">0x08048c6f &lt;+176&gt;:   jg     0x8048c77 &lt;phase_3+184&gt;</span><br><span class="line">0x08048c71 &lt;+178&gt;:   cmp    0x8(%esp),%eax</span><br><span class="line">0x08048c75 &lt;+182&gt;:   je     0x8048c7c &lt;phase_3+189&gt;</span><br><span class="line">0x08048c77 &lt;+184&gt;:   call   0x8049110 &lt;explode_bomb&gt;</span><br><span class="line">0x08048c7c &lt;+189&gt;:   mov    0xc(%esp),%eax</span><br><span class="line">0x08048c80 &lt;+193&gt;:   xor    %gs:0x14,%eax</span><br><span class="line">0x08048c87 &lt;+200&gt;:   je     0x8048c8e &lt;phase_3+207&gt;</span><br><span class="line">0x08048c89 &lt;+202&gt;:   call   0x8048790 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">0x08048c8e &lt;+207&gt;:   add    $0x1c,%esp</span><br><span class="line">0x08048c91 &lt;+210&gt;:   ret</span><br></pre></td></tr></table></figure>
<p>最后的结果是： 0 673 或者 1 270 或者 2 671 或者 3 -297 或者 4 0 或者 5 -297</p>
<h2 id="Phase-4"><a href="#Phase-4" class="headerlink" title="Phase_4"></a>Phase_4</h2><p>phase_4 是我认为最简单的题目了，因为好像根本用不到fun4，但是这是解题博客，所以我们还是来认真看一下</p>
<p>我输入的值是 108 ，2</p>
<p>首先看一下<code>+25</code>, 0x804a1ef:      “%d %d” 发现又是输入两个数</p>
<p>然后我们看 <code>+39</code> ,结束以后用 <code>i r esp</code> 查看当前栈指针：<code>0xffffd220</code></p>
<p><code>+42</code>中，scanf的返回值也要大于等于2，这刚好印证了<code>+25</code>的猜想</p>
<p>我们用查看一下 0x4(%esp) 和 0x8(%esp),发现刚好是 2 和 108。</p>
<p><code>+47</code> 到 <code>+59</code> 对第我们输入的第二个数字进行一个范围限定</p>
<p>首先将其减去2，然后让其于2相比，一定要比2小且是无符号整数才不会爆炸。因此我们可以得出第二个参数的值必然为2或者3</p>
<p><code>+73</code> 调用了fun4，然后<code>+81</code> 让fun4的返回值和我们输入的第一个参数相比。不相等就爆炸否则就过关。所以我看都没看就直接ni，然后看 eax中的值，发现2对应的是108而3对应的是162</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">phase_4</span><br><span class="line">   0x08048cd5 &lt;+0&gt;:     sub    $0x1c,%esp</span><br><span class="line">   0x08048cd8 &lt;+3&gt;:     mov    %gs:0x14,%eax</span><br><span class="line">   0x08048cde &lt;+9&gt;:     mov    %eax,0xc(%esp)</span><br><span class="line">   0x08048ce2 &lt;+13&gt;:    xor    %eax,%eax</span><br><span class="line">   0x08048ce4 &lt;+15&gt;:    lea    0x4(%esp),%eax</span><br><span class="line">   0x08048ce8 &lt;+19&gt;:    push   %eax</span><br><span class="line">   0x08048ce9 &lt;+20&gt;:    lea    0xc(%esp),%eax</span><br><span class="line">   0x08048ced &lt;+24&gt;:    push   %eax</span><br><span class="line">   0x08048cee &lt;+25&gt;:    push   $0x804a1ef</span><br><span class="line">   0x08048cf3 &lt;+30&gt;:    pushl  0x2c(%esp)</span><br><span class="line">   0x08048cf7 &lt;+34&gt;:    call   0x8048810 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">   0x08048cfc &lt;+39&gt;:    add    $0x10,%esp</span><br><span class="line">   0x08048cff &lt;+42&gt;:    cmp    $0x2,%eax</span><br><span class="line">   0x08048d02 &lt;+45&gt;:    jne    0x8048d10 &lt;phase_4+59&gt;</span><br><span class="line">   0x08048d04 &lt;+47&gt;:    mov    0x4(%esp),%eax</span><br><span class="line">   0x08048d08 &lt;+51&gt;:    sub    $0x2,%eax</span><br><span class="line">   0x08048d0b &lt;+54&gt;:    cmp    $0x2,%eax</span><br><span class="line">   0x08048d0e &lt;+57&gt;:    jbe    0x8048d15 &lt;phase_4+64&gt;</span><br><span class="line">   0x08048d10 &lt;+59&gt;:    call   0x8049110 &lt;explode_bomb&gt;</span><br><span class="line">   0x08048d15 &lt;+64&gt;:    sub    $0x8,%esp</span><br><span class="line">   0x08048d18 &lt;+67&gt;:    pushl  0xc(%esp)</span><br><span class="line">   0x08048d1c &lt;+71&gt;:    push   $0x8</span><br><span class="line">   0x08048d1e &lt;+73&gt;:    call   0x8048c92 &lt;func4&gt;</span><br><span class="line">   0x08048d23 &lt;+78&gt;:    add    $0x10,%esp</span><br><span class="line">   0x08048d26 &lt;+81&gt;:    cmp    0x8(%esp),%eax</span><br><span class="line">   0x08048d2a &lt;+85&gt;:    je     0x8048d31 &lt;phase_4+92&gt;</span><br><span class="line">   0x08048d2c &lt;+87&gt;:    call   0x8049110 &lt;explode_bomb&gt;</span><br><span class="line">   0x08048d31 &lt;+92&gt;:    mov    0xc(%esp),%eax</span><br><span class="line">   0x08048d35 &lt;+96&gt;:    xor    %gs:0x14,%eax</span><br><span class="line">   0x08048d3c &lt;+103&gt;:   je     0x8048d43 &lt;phase_4+110&gt;</span><br><span class="line">   0x08048d3e &lt;+105&gt;:   call   0x8048790 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">   0x08048d43 &lt;+110&gt;:   add    $0x1c,%esp</span><br><span class="line">   0x08048d46 &lt;+113&gt;:   ret</span><br></pre></td></tr></table></figure>
<p>但是作为数据学院的学子，我们必须对自己高标准严要求(不是)。现在我们来探索一哈fun4中发生了什么不可告人的秘密</p>
<p>func4是一个递归函数</p>
<p>在<code>&lt;+71&gt;</code>出我们push了一个0x8,者在后面是要用到的 </p>
<p><code>+3</code>和 <code>+7</code> 分别把 8 和我们输入的第二个数移动进了 <code>ebx</code> 和 <code>edi</code></p>
<p>然后我们判断 ebx是不是小于等于0，jle是判断$(SF)$^$(OF)|ZF$的，所以ebx=0，ZF等于1，跳转；如果ebx小于0，SF=1,OF=0,ZF=0 ,$(SF)$^$(OF)|ZF$ =1 ，跳转，如果小于0直接返回0</p>
<p><code>+15</code>,<code>+17</code> 是让 ebx中的数字和1比，如果相等就跳出func4,返回值是 eax中的值</p>
<p><code>+26</code> 的作用是将ebx(初始值为8)减去1放到eax当中，并将edi压栈</p>
<p><code>+30</code>开始是一个递归，在这个递归中，ebx更新为减去1后的ebx(第二轮中是7)，edi仍然为edi。</p>
<p>这样进行了很多次调用之后，最后当ebx=1的时候，函数调转到63并将ebx之类的pop出来，这时候ebx=2,edi=3</p>
<p><img src="/2020/10/25/bomblab/Users\Jason\AppData\Roaming\Typora\typora-user-images\image-20201117174810348.png" alt="image-20201117174810348"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">func4</span><br><span class="line">   0x08048c92 &lt;+0&gt;:     push   %edi</span><br><span class="line">   0x08048c93 &lt;+1&gt;:     push   %esi</span><br><span class="line">   0x08048c94 &lt;+2&gt;:     push   %ebx</span><br><span class="line">   0x08048c95 &lt;+3&gt;:     mov    0x10(%esp),%ebx</span><br><span class="line">   0x08048c99 &lt;+7&gt;:     mov    0x14(%esp),%edi  </span><br><span class="line">   0x08048c9d &lt;+11&gt;:    test   %ebx,%ebx</span><br><span class="line">   0x08048c9f &lt;+13&gt;:    jle    0x8048ccc &lt;func4+58&gt;</span><br><span class="line">   0x08048ca1 &lt;+15&gt;:    mov    %edi,%eax</span><br><span class="line">   0x08048ca3 &lt;+17&gt;:    cmp    $0x1,%ebx</span><br><span class="line">   0x08048ca6 &lt;+20&gt;:    je     0x8048cd1 &lt;func4+63&gt;</span><br><span class="line">   0x08048ca8 &lt;+22&gt;:    sub    $0x8,%esp</span><br><span class="line">   0x08048cab &lt;+25&gt;:    push   %edi</span><br><span class="line">   0x08048cac &lt;+26&gt;:    lea    -0x1(%ebx),%eax</span><br><span class="line">   0x08048caf &lt;+29&gt;:    push   %eax</span><br><span class="line">   0x08048cb0 &lt;+30&gt;:    call   0x8048c92 &lt;func4&gt;</span><br><span class="line">   0x08048cb5 &lt;+35&gt;:    add    $0x8,%esp</span><br><span class="line">   0x08048cb8 &lt;+38&gt;:    lea    (%edi,%eax,1),%esi</span><br><span class="line">   0x08048cbb &lt;+41&gt;:    push   %edi</span><br><span class="line">   0x08048cbc &lt;+42&gt;:    sub    $0x2,%ebx</span><br><span class="line">   0x08048cbf &lt;+45&gt;:    push   %ebx</span><br><span class="line">   0x08048cc0 &lt;+46&gt;:    call   0x8048c92 &lt;func4&gt;</span><br><span class="line">   0x08048cc5 &lt;+51&gt;:    add    $0x10,%esp</span><br><span class="line">   0x08048cc8 &lt;+54&gt;:    add    %esi,%eax</span><br><span class="line">   0x08048cca &lt;+56&gt;:    jmp    0x8048cd1 &lt;func4+63&gt;</span><br><span class="line">   0x08048ccc &lt;+58&gt;:    mov    $0x0,%eax</span><br><span class="line">   0x08048cd1 &lt;+63&gt;:    pop    %ebx</span><br><span class="line">   0x08048cd2 &lt;+64&gt;:    pop    %esi</span><br><span class="line">   0x08048cd3 &lt;+65&gt;:    pop    %edi</span><br><span class="line">   0x08048cd4 &lt;+66&gt;:    ret</span><br></pre></td></tr></table></figure>
<h2 id="Phase-5"><a href="#Phase-5" class="headerlink" title="Phase_5"></a>Phase_5</h2><p>第一阶段是读入数字，还是老样子。0x804a1ef是要我们读入 两个整数，<code>+42</code>也让scanf的返回值大于1，于是我们推断phase_5 也让我们读入两个整数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Phase_5</span><br><span class="line">   0x08048d47 &lt;+0&gt;:     sub    $0x1c,%esp</span><br><span class="line">   0x08048d4a &lt;+3&gt;:     mov    %gs:0x14,%eax</span><br><span class="line">   0x08048d50 &lt;+9&gt;:     mov    %eax,0xc(%esp)</span><br><span class="line">   0x08048d54 &lt;+13&gt;:    xor    %eax,%eax</span><br><span class="line">   0x08048d56 &lt;+15&gt;:    lea    0x8(%esp),%eax</span><br><span class="line">   0x08048d5a &lt;+19&gt;:    push   %eax</span><br><span class="line">   0x08048d5b &lt;+20&gt;:    lea    0x8(%esp),%eax</span><br><span class="line">   0x08048d5f &lt;+24&gt;:    push   %eax</span><br><span class="line">   0x08048d60 &lt;+25&gt;:    push   $0x804a1ef</span><br><span class="line">   0x08048d65 &lt;+30&gt;:    pushl  0x2c(%esp)</span><br><span class="line">   0x08048d69 &lt;+34&gt;:    call   0x8048810 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">   0x08048d6e &lt;+39&gt;:    add    $0x10,%esp</span><br><span class="line">   0x08048d71 &lt;+42&gt;:    cmp    $0x1,%eax</span><br><span class="line">   0x08048d74 &lt;+45&gt;:    jg     0x8048d7b &lt;phase_5+52&gt;</span><br><span class="line">   0x08048d76 &lt;+47&gt;:    call   0x8049110 &lt;explode_bomb&gt;</span><br></pre></td></tr></table></figure>
<p>我在phase_5输入了5 115 两个数，现在我们来找找看它们藏在哪：</p>
<p><code>i r esp</code> : 0xffffd220 </p>
<p>我们用 <code>x/d 0xffffd224</code> 和 <code>x/d 0xffffd228</code> 分别查看栈上的两个地址，发现：<br>0xffffd224:     5<br>0xffffd228:     115</p>
<p>刚好是我们输入的两个值。</p>
<p><code>+52</code> 到 <code>+66</code> 是对我们输入的第一个参数进行一系列的操作：</p>
<p>首先将其移入 eax，并让eax和 0xf 按位与。再把结果复制到第一个参数当中。最后让这个结果和0xf比较，如果相等就爆炸。我觉得这个设置就是让我们输入的第一个数的二进制表达的低四位一定不能是1111.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Phase_5_Continued</span><br><span class="line">   0x08048d7b &lt;+52&gt;:    mov    0x4(%esp),%eax</span><br><span class="line">   0x08048d7f &lt;+56&gt;:    and    $0xf,%eax</span><br><span class="line">   0x08048d82 &lt;+59&gt;:    mov    %eax,0x4(%esp)</span><br><span class="line">   0x08048d86 &lt;+63&gt;:    cmp    $0xf,%eax</span><br><span class="line">   0x08048d89 &lt;+66&gt;:    je     0x8048db9 &lt;phase_5+114&gt;</span><br></pre></td></tr></table></figure>
<p>接下来是正式操作了：首先是让 ecx=0，edx=1</p>
<p><code>+81</code>是让我们跳转到某一个地址,并将地址指向的值复制到eax。具体跳转到哪里，取什么值？<br>我们用 x/20dw 0x804a0a0一系列指令可以将这些数字都展现出来：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x&#x2F;20dw 0x804a0a0</span><br><span class="line">0x804a0a0 &lt;array.3247&gt;: 10      2       14      7</span><br><span class="line">0x804a0b0 &lt;array.3247+16&gt;:      8       12      15      11</span><br><span class="line">0x804a0c0 &lt;array.3247+32&gt;:      0       4       1       13</span><br><span class="line">0x804a0d0 &lt;array.3247+48&gt;:      3       9       6       5</span><br><span class="line">0x804a0e0:      2032168787      1948284271      1802398056      1970239776</span><br></pre></td></tr></table></figure>
<p>我们发现这个数组中一共有16个数字。</p>
<p><code>+88</code>跳完以后我们将eax加到ecx中去。并eax其和15比较。如果不相等那么跳转到78再次循环，并让edx++；如果相等那么就继续。</p>
<p><code>+103</code> 则是让edx和15比较，如果不相等就跳到115，相等就让ecx和我们输入的第2个参数相比。</p>
<p>所以这个函数可以写成这样</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a,b;<span class="comment">//输入的第一个和第二个参数</span></span><br><span class="line"><span class="keyword">int</span> <span class="built_in">array</span>[<span class="number">16</span>] = &#123;<span class="number">10</span>,<span class="number">2</span>,<span class="number">14</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">15</span>,<span class="number">11</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">13</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">5</span>&#125;</span><br><span class="line"><span class="keyword">int</span> cnt= <span class="number">0</span>;<span class="comment">//edx</span></span><br><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span>;<span class="comment">//ecx</span></span><br><span class="line"><span class="keyword">while</span>(a!=<span class="number">15</span>)</span><br><span class="line">&#123;</span><br><span class="line">    cnt++;</span><br><span class="line">    a=<span class="built_in">array</span>[a];</span><br><span class="line">    sum+=a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(cnt==<span class="number">15</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(b==sum)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> ;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        bomb!!!</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    bomb!!!!</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们的目标就是确定a选什么值，在经过15次循环后能让a=15，并让b等于循环过程中a的数值之和。</p>
<p>我们可以逆向推断。既然要输出15，那么在第十四次循环后a就要等于6，这样才能让a[6]=15</p>
<p>同理，要让a=6,那么就让第十三次循环后a=14，这样才能让 a[14]=6</p>
<p>以此类推，我们得到了一个链:</p>
<p>$15\rightarrow6\rightarrow14\rightarrow2\rightarrow1\rightarrow10\rightarrow0\rightarrow8\rightarrow4\rightarrow9\rightarrow13\rightarrow11\rightarrow7\rightarrow3\rightarrow12\rightarrow5$ </p>
<p>因为Eax是先变化之后，才被ecx累加，所以<strong>eax的初值5并没有被加到ecx中</strong>！</p>
<p>因此，ecx =12+3+7+11+13+9+4+8+0+10+1+2+14+6+15=115</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Phase_5_Continued</span><br><span class="line">   0x08048d8b &lt;+68&gt;:    mov    $0x0,%ecx</span><br><span class="line">   0x08048d90 &lt;+73&gt;:    mov    $0x0,%edx</span><br><span class="line">   0x08048d95 &lt;+78&gt;:    add    $0x1,%edx</span><br><span class="line">   0x08048d98 &lt;+81&gt;:    mov    0x804a0a0(,%eax,4),%eax</span><br><span class="line">   0x08048d9f &lt;+88&gt;:    add    %eax,%ecx</span><br><span class="line">   0x08048da1 &lt;+90&gt;:    cmp    $0xf,%eax</span><br><span class="line">   0x08048da4 &lt;+93&gt;:    jne    0x8048d95 &lt;phase_5+78&gt;</span><br><span class="line">   0x08048da6 &lt;+95&gt;:    movl   $0xf,0x4(%esp)</span><br><span class="line">   0x08048dae &lt;+103&gt;:   cmp    $0xf,%edx</span><br><span class="line">   0x08048db1 &lt;+106&gt;:   jne    0x8048db9 &lt;phase_5+114&gt;</span><br><span class="line">   0x08048db3 &lt;+108&gt;:   cmp    0x8(%esp),%ecx</span><br><span class="line">   0x08048db7 &lt;+112&gt;:   je     0x8048dbe &lt;phase_5+119&gt;</span><br><span class="line">   0x08048db9 &lt;+114&gt;:   call   0x8049110 &lt;explode_bomb&gt;</span><br><span class="line">   0x08048dbe &lt;+119&gt;:   mov    0xc(%esp),%eax</span><br><span class="line">   0x08048dc2 &lt;+123&gt;:   xor    %gs:0x14,%eax</span><br><span class="line">   0x08048dc9 &lt;+130&gt;:   je     0x8048dd0 &lt;phase_5+137&gt;</span><br><span class="line">   0x08048dcb &lt;+132&gt;:   call   0x8048790 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">   0x08048dd0 &lt;+137&gt;:   add    $0x1c,%esp</span><br><span class="line">   0x08048dd3 &lt;+140&gt;:   ret</span><br></pre></td></tr></table></figure>
<p>Phase_5的答案就是5，115.问题解决。</p>
<h2 id="Phase-6"><a href="#Phase-6" class="headerlink" title="Phase_6"></a>Phase_6</h2><p>Phase_6是整个炸弹关卡最难的一关,我们将其分为3个阶段</p>
<p>首先来看看第一个阶段: <code>+26</code>是读入6个数字</p>
<p><code>+39</code>是将当前的栈顶指针 esp+4*esi+12 地址上存储的值存放到eax当中去</p>
<p>那么我们具体来看看当前的栈上存放着哪些数字吧~，我填入的数字是：5 4 1 2 3 6</p>
<p>我们看到这6个数字，是从下到上依次存储的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(gdb) i r esp</span><br><span class="line">esp            0xffffd1f0       0xffffd1f0</span><br><span class="line">(gdb) x&#x2F;d 0xffffd1fc</span><br><span class="line">0xffffd1fc:     5</span><br><span class="line">(gdb) x&#x2F;d 0xffffd200</span><br><span class="line">0xffffd200:     4</span><br><span class="line">(gdb) x&#x2F;d 0xffffd204</span><br><span class="line">0xffffd204:     1</span><br><span class="line">(gdb) x&#x2F;d 0xffffd208</span><br><span class="line">0xffffd208:     2</span><br><span class="line">(gdb) x&#x2F;d 0xffffd20c</span><br><span class="line">0xffffd20c:     3</span><br><span class="line">(gdb) x&#x2F;d 0xffffd210</span><br><span class="line">0xffffd210:     6</span><br></pre></td></tr></table></figure>
<p><code>+43到+46</code> 是将eax中的内容减去1和5比较，如果大于5就直接爆炸，所以我们推断出所有的六个数都是无符号的且是小于等于6的。</p>
<p>esi是个计数器，初始值为0(<code>+34</code>) 每次比较成功之后会自增1，如果加到了6就跳出循环。如果没有到6的话就运行 <code>+64</code></p>
<p>从<code>+66</code> 开始，程序做的就是将我们输入的数和后面的所有数进行比较(第一个和2、3、4、5、6相比，第二个和3、4、5、6相比），如果相等就爆炸，因此我们输入的6个数字必须是两两不等的。</p>
<p>其原函数类似以下逻辑：</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i =<span class="number">0</span>;i&lt;<span class="number">6</span>;i++)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(a[i]&lt;=<span class="number">6</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> j =i;j&lt;<span class="number">6</span>;j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(a[j]==a[j+<span class="number">1</span>])</span><br><span class="line">                <span class="comment">//explode</span></span><br><span class="line">        &#125;</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="comment">//explode</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Phase_6:   </span><br><span class="line">   0x08048dd4 &lt;+0&gt;:     push   %esi</span><br><span class="line">   0x08048dd5 &lt;+1&gt;:     push   %ebx</span><br><span class="line">   0x08048dd6 &lt;+2&gt;:     sub    $0x4c,%esp</span><br><span class="line">   0x08048dd9 &lt;+5&gt;:     mov    %gs:0x14,%eax</span><br><span class="line">   0x08048ddf &lt;+11&gt;:    mov    %eax,0x44(%esp)</span><br><span class="line">   0x08048de3 &lt;+15&gt;:    xor    %eax,%eax</span><br><span class="line">   0x08048de5 &lt;+17&gt;:    lea    0x14(%esp),%eax</span><br><span class="line">   0x08048de9 &lt;+21&gt;:    push   %eax</span><br><span class="line">   0x08048dea &lt;+22&gt;:    pushl  0x5c(%esp)</span><br><span class="line">   0x08048dee &lt;+26&gt;:    call   0x8049135 &lt;read_six_numbers&gt;</span><br><span class="line">   0x08048df3 &lt;+31&gt;:    add    $0x10,%esp</span><br><span class="line">   0x08048df6 &lt;+34&gt;:    mov    $0x0,%esi</span><br><span class="line">   0x08048dfb &lt;+39&gt;:    mov    0xc(%esp,%esi,4),%eax</span><br><span class="line">   0x08048dff &lt;+43&gt;:    sub    $0x1,%eax</span><br><span class="line">   0x08048e02 &lt;+46&gt;:    cmp    $0x5,%eax</span><br><span class="line">   0x08048e05 &lt;+49&gt;:    jbe    0x8048e0c &lt;phase_6+56&gt;</span><br><span class="line">   0x08048e07 &lt;+51&gt;:    call   0x8049110 &lt;explode_bomb&gt;</span><br><span class="line">   0x08048e0c &lt;+56&gt;:    add    $0x1,%esi</span><br><span class="line">   0x08048e0f &lt;+59&gt;:    cmp    $0x6,%esi</span><br><span class="line">   0x08048e12 &lt;+62&gt;:    je     0x8048e2f &lt;phase_6+91&gt;</span><br><span class="line">   0x08048e14 &lt;+64&gt;:    mov    %esi,%ebx</span><br><span class="line">   0x08048e16 &lt;+66&gt;:    mov    0xc(%esp,%ebx,4),%eax</span><br><span class="line">   0x08048e1a &lt;+70&gt;:    cmp    %eax,0x8(%esp,%esi,4)</span><br><span class="line">   0x08048e1e &lt;+74&gt;:    jne    0x8048e25 &lt;phase_6+81&gt;</span><br><span class="line">   0x08048e20 &lt;+76&gt;:    call   0x8049110 &lt;explode_bomb&gt;</span><br><span class="line">   0x08048e25 &lt;+81&gt;:    add    $0x1,%ebx  </span><br><span class="line">   0x08048e28 &lt;+84&gt;:    cmp    $0x5,%ebx</span><br><span class="line">   0x08048e2b &lt;+87&gt;:    jle    0x8048e16 &lt;phase_6+66&gt;</span><br><span class="line">   0x08048e2d &lt;+89&gt;:    jmp    0x8048dfb &lt;phase_6+39&gt;</span><br></pre></td></tr></table></figure>
<p>我们输入的满足了条件之后，来到了第二个阶段：</p>
<p><code>+91</code> 我们将第一个参数移动到eax当中去。</p>
<p><code>+95</code> 我们将 栈顶指针加上0x24的地址中存放的内容移动到eax当中，即a[6]（超出数组空间但也可以这么写）</p>
<p><code>+99和+104</code> 我们将ecx和edx都置为7</p>
<p><code>+106</code> 让%edx(7)减去第一个数，得到某一个数。然后修改eax地址上存储的数(即变为7-a[0]) </p>
<p>然后将eax地址+4，指向数组的下一个数，现在是a[1]。然后再将其值改为(7-a[1]) 以此类推</p>
<p>等到eax的地址指向 a[6] 的时候，跳出循环。并将 ebx置为0</p>
<p><code>+122</code> 让我们跳转到 <code>+146</code> 并将当前ebx赋值给esi，即现在esi=0. 然后在<code>+148</code>第一个输入的值(本来是5，现在是7-5=2) 赋给ecx</p>
<p><code>+152</code> 是将1赋值给eax</p>
<p><code>+157</code> 是将某一个地址赋给edx</p>
<p><code>+162</code> 是将ecx也就是我(7减去输入的第一个数) 和1比较如果大于1，就跳转到<code>+124</code>.否则 (等于1) 跳转到<code>+134</code> </p>
<p>跳转到124，我们发现 <code>+124</code> 是将edx+=8,然后将edx上存放的数据取出放到edx当中去。然后让eax+1，并和我们输入的数作比较，如果相等，就将edx中存放的数存放到栈里面去。否则就edx继续加8，继续让eax+1，一直到eax=ecx。所以最后edx中存储的数取决于我输入的数。</p>
<p>现在我们来看看0x804c13c 到底是什么：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x&#x2F;3x 0x804c13c </span><br><span class="line">0x804c13c &lt;node1&gt;:      0x00000074      0x00000001      0x0804c148 116 </span><br><span class="line">(gdb) x&#x2F;3x *(0x804c13c+0x8)</span><br><span class="line">0x804c148 &lt;node2&gt;:      0x00000388      0x00000002      0x0804c154 904</span><br><span class="line">(gdb) x&#x2F;3x *(*(0x804c13c+0x8)+0x8)</span><br><span class="line">0x804c154 &lt;node3&gt;:      0x00000269      0x00000003      0x0804c160 617</span><br><span class="line">(gdb) x&#x2F;3x *(*(*(0x804c13c+0x8)+0x8)+0x8)</span><br><span class="line">0x804c160 &lt;node4&gt;:      0x00000093      0x00000004      0x0804c16c 147</span><br><span class="line">(gdb) x&#x2F;3x *(*(*(*(0x804c13c+0x8)+0x8)+0x8)+0x8)</span><br><span class="line">0x804c16c &lt;node5&gt;:      0x00000109      0x00000005      0x0804c178 265</span><br><span class="line">(gdb) x&#x2F;3x *(*(*(*(*(0x804c13c+0x8)+0x8)+0x8)+0x8)+0x8)</span><br><span class="line">0x804c178 &lt;node6&gt;:      0x000001ea      0x00000006      0x00000000 490</span><br></pre></td></tr></table></figure>
<p>我们发现0x804c13c 开始，是一个链表，比如说处理好的数是2，那么经过上面这个程序，会将0x388取出来放到栈里，同理，如果处理好的数是3，那么会将0x269压入栈中</p>
<p>这个阶段仍然是一个两层循环，目的在于将我们从链表中取到的和输入数字相应的结点地址放入栈中保存，将六个都取完之后，到下一个阶段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">0x08048e2f &lt;+91&gt;:    lea    0xc(%esp),%eax</span><br><span class="line">0x08048e33 &lt;+95&gt;:    lea    0x24(%esp),%ebx</span><br><span class="line">0x08048e37 &lt;+99&gt;:    mov    $0x7,%ecx</span><br><span class="line">0x08048e3c &lt;+104&gt;:   mov    %ecx,%edx</span><br><span class="line">0x08048e3e &lt;+106&gt;:   sub    (%eax),%edx</span><br><span class="line">0x08048e40 &lt;+108&gt;:   mov    %edx,(%eax)</span><br><span class="line">0x08048e42 &lt;+110&gt;:   add    $0x4,%eax</span><br><span class="line">0x08048e45 &lt;+113&gt;:   cmp    %eax,%ebx</span><br><span class="line">0x08048e47 &lt;+115&gt;:   jne    0x8048e3c &lt;phase_6+104&gt;</span><br><span class="line">0x08048e49 &lt;+117&gt;:   mov    $0x0,%ebx</span><br><span class="line">0x08048e4e &lt;+122&gt;:   jmp    0x8048e66 &lt;phase_6+146&gt;</span><br><span class="line">0x08048e50 &lt;+124&gt;:   mov    0x8(%edx),%edx</span><br><span class="line">0x08048e53 &lt;+127&gt;:   add    $0x1,%eax</span><br><span class="line">0x08048e56 &lt;+130&gt;:   cmp    %ecx,%eax</span><br><span class="line">0x08048e58 &lt;+132&gt;:   jne    0x8048e50 &lt;phase_6+124&gt;</span><br><span class="line">0x08048e5a &lt;+134&gt;:   mov    %edx,0x24(%esp,%esi,4)</span><br><span class="line">0x08048e5e &lt;+138&gt;:   add    $0x1,%ebx</span><br><span class="line">0x08048e61 &lt;+141&gt;:   cmp    $0x6,%ebx</span><br><span class="line">0x08048e64 &lt;+144&gt;:   je     0x8048e7d &lt;phase_6+169&gt;</span><br><span class="line">0x08048e66 &lt;+146&gt;:   mov    %ebx,%esi</span><br><span class="line">0x08048e68 &lt;+148&gt;:   mov    0xc(%esp,%ebx,4),%ecx</span><br><span class="line">0x08048e6c &lt;+152&gt;:   mov    $0x1,%eax</span><br><span class="line">0x08048e71 &lt;+157&gt;:   mov    $0x804c13c,%edx</span><br><span class="line">0x08048e76 &lt;+162&gt;:   cmp    $0x1,%ecx</span><br><span class="line">0x08048e79 &lt;+165&gt;:   jg     0x8048e50 &lt;phase_6+124&gt;</span><br><span class="line">0x08048e7b &lt;+167&gt;:   jmp    0x8048e5a &lt;phase_6+134&gt;</span><br></pre></td></tr></table></figure>
<p>上面的循环了6次，我们现在来到了第三阶段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">0x08048e7d &lt;+169&gt;:   mov    0x24(%esp),%ebx</span><br><span class="line">0x08048e81 &lt;+173&gt;:   lea    0x24(%esp),%eax</span><br><span class="line">0x08048e85 &lt;+177&gt;:   lea    0x38(%esp),%esi</span><br><span class="line">0x08048e89 &lt;+181&gt;:   mov    %ebx,%ecx</span><br><span class="line">0x08048e8b &lt;+183&gt;:   mov    0x4(%eax),%edx</span><br><span class="line">0x08048e8e &lt;+186&gt;:   mov    %edx,0x8(%ecx)</span><br><span class="line">0x08048e91 &lt;+189&gt;:   add    $0x4,%eax</span><br><span class="line">0x08048e94 &lt;+192&gt;:   mov    %edx,%ecx</span><br><span class="line">0x08048e96 &lt;+194&gt;:   cmp    %eax,%esi</span><br><span class="line">0x08048e98 &lt;+196&gt;:   jne    0x8048e8b &lt;phase_6+183&gt;</span><br><span class="line">0x08048e9a &lt;+198&gt;:   movl   $0x0,0x8(%edx)</span><br><span class="line">0x08048ea1 &lt;+205&gt;:   mov    $0x5,%esi</span><br><span class="line">0x08048ea6 &lt;+210&gt;:   mov    0x8(%ebx),%eax</span><br><span class="line">0x08048ea9 &lt;+213&gt;:   mov    (%eax),%eax</span><br><span class="line">0x08048eab &lt;+215&gt;:   cmp    %eax,(%ebx)</span><br><span class="line">0x08048ead &lt;+217&gt;:   jge    0x8048eb4 &lt;phase_6+224&gt;</span><br><span class="line">0x08048eaf &lt;+219&gt;:   call   0x8049110 &lt;explode_bomb&gt;</span><br><span class="line">0x08048eb4 &lt;+224&gt;:   mov    0x8(%ebx),%ebx</span><br><span class="line">0x08048eb7 &lt;+227&gt;:   sub    $0x1,%esi</span><br><span class="line">0x08048eba &lt;+230&gt;:   jne    0x8048ea6 &lt;phase_6+210&gt;</span><br><span class="line">0x08048ebc &lt;+232&gt;:   mov    0x3c(%esp),%eax</span><br><span class="line">0x08048ec0 &lt;+236&gt;:   xor    %gs:0x14,%eax</span><br><span class="line">0x08048ec7 &lt;+243&gt;:   je     0x8048ece &lt;phase_6+250&gt;</span><br><span class="line">0x08048ec9 &lt;+245&gt;:   call   0x8048790 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">0x08048ece &lt;+250&gt;:   add    $0x44,%esp</span><br><span class="line">0x08048ed1 &lt;+253&gt;:   pop    %ebx</span><br><span class="line">0x08048ed2 &lt;+254&gt;:   pop    %esi</span><br><span class="line">0x08048ed3 &lt;+255&gt;:   ret</span><br></pre></td></tr></table></figure>
<p>可以看出esi是循环计数变量，要对里面的的五个数进行判断，一共5轮，判断结点保存的六个数中相邻的数是不是都比后面一个数大，一言以蔽之，就是判断结点里面的值是不是非递增的！</p>
<p>所以，最后的排列数是递减的，查询链表发现：$0x388\rightarrow 0x269 \rightarrow0x1ea\rightarrow 0x93 \rightarrow 0x74$ </p>
<p>对应链表中的位置是 ：2 3 6 5 4 1</p>
<p>但是别忘了这是处理好的数据，没有处理过的数据是7-i,所以我们输入的数据应该是 5 3 1 2 3 6</p>
<h2 id="Defused-Phase-and-Secret-Phase"><a href="#Defused-Phase-and-Secret-Phase" class="headerlink" title="Defused_Phase and Secret_Phase"></a>Defused_Phase and Secret_Phase</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">phase_defused:</span><br><span class="line">   0x08049269 &lt;+0&gt;:     sub    $0x6c,%esp</span><br><span class="line">   0x0804926c &lt;+3&gt;:     mov    %gs:0x14,%eax</span><br><span class="line">   0x08049272 &lt;+9&gt;:     mov    %eax,0x5c(%esp)</span><br><span class="line">   0x08049276 &lt;+13&gt;:    xor    %eax,%eax</span><br><span class="line">   0x08049278 &lt;+15&gt;:    cmpl   $0x6,0x804c3cc</span><br><span class="line">   0x0804927f &lt;+22&gt;:    jne    0x80492f4 &lt;phase_defused+139&gt;</span><br><span class="line">   0x08049281 &lt;+24&gt;:    sub    $0xc,%esp</span><br><span class="line">   0x08049284 &lt;+27&gt;:    lea    0x18(%esp),%eax</span><br><span class="line">   0x08049288 &lt;+31&gt;:    push   %eax</span><br><span class="line">   0x08049289 &lt;+32&gt;:    lea    0x18(%esp),%eax</span><br><span class="line">   0x0804928d &lt;+36&gt;:    push   %eax</span><br><span class="line">   0x0804928e &lt;+37&gt;:    lea    0x18(%esp),%eax</span><br><span class="line">   0x08049292 &lt;+41&gt;:    push   %eax</span><br><span class="line">   0x08049293 &lt;+42&gt;:    push   $0x804a249</span><br><span class="line">   0x08049298 &lt;+47&gt;:    push   $0x804c4d0</span><br><span class="line">   0x0804929d &lt;+52&gt;:    call   0x8048810 &lt;__isoc99_sscanf@plt&gt;</span><br><span class="line">   0x080492a2 &lt;+57&gt;:    add    $0x20,%esp</span><br><span class="line">   0x080492a5 &lt;+60&gt;:    cmp    $0x3,%eax</span><br><span class="line">   0x080492a8 &lt;+63&gt;:    jne    0x80492e4 &lt;phase_defused+123&gt;</span><br><span class="line">   0x080492aa &lt;+65&gt;:    sub    $0x8,%esp</span><br><span class="line">   0x080492ad &lt;+68&gt;:    push   $0x804a252</span><br><span class="line">   0x080492b2 &lt;+73&gt;:    lea    0x18(%esp),%eax</span><br><span class="line">   0x080492b6 &lt;+77&gt;:    push   %eax</span><br><span class="line">   0x080492b7 &lt;+78&gt;:    call   0x8049019 &lt;strings_not_equal&gt;</span><br><span class="line">   0x080492bc &lt;+83&gt;:    add    $0x10,%esp</span><br><span class="line">   0x080492bf &lt;+86&gt;:    test   %eax,%eax</span><br><span class="line">   0x080492c1 &lt;+88&gt;:    jne    0x80492e4 &lt;phase_defused+123&gt;</span><br><span class="line">   0x080492c3 &lt;+90&gt;:    sub    $0xc,%esp</span><br><span class="line">   0x080492c6 &lt;+93&gt;:    push   $0x804a118</span><br><span class="line">   0x080492cb &lt;+98&gt;:    call   0x80487c0 &lt;puts@plt&gt;</span><br><span class="line">   0x080492d0 &lt;+103&gt;:   movl   $0x804a140,(%esp)</span><br><span class="line">   0x080492d7 &lt;+110&gt;:   call   0x80487c0 &lt;puts@plt&gt;</span><br><span class="line">   0x080492dc &lt;+115&gt;:   call   0x8048f25 &lt;secret_phase&gt;</span><br><span class="line">   0x080492e1 &lt;+120&gt;:   add    $0x10,%esp</span><br><span class="line">   0x080492e4 &lt;+123&gt;:   sub    $0xc,%esp</span><br><span class="line">   0x080492e7 &lt;+126&gt;:   push   $0x804a178</span><br><span class="line">   0x080492ec &lt;+131&gt;:   call   0x80487c0 &lt;puts@plt&gt;</span><br><span class="line">   0x080492f1 &lt;+136&gt;:   add    $0x10,%esp</span><br><span class="line">   0x080492f4 &lt;+139&gt;:   mov    0x5c(%esp),%eax</span><br><span class="line">   0x080492f8 &lt;+143&gt;:   xor    %gs:0x14,%eax</span><br><span class="line">   0x080492ff &lt;+150&gt;:   je     0x8049306 &lt;phase_defused+157&gt;</span><br><span class="line">   0x08049301 &lt;+152&gt;:   call   0x8048790 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">   0x08049306 &lt;+157&gt;:   add    $0x6c,%esp</span><br><span class="line">   0x08049309 &lt;+160&gt;:   ret</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">secret_phase</span><br><span class="line">   0x08048f25 &lt;+0&gt;:     push   %ebx</span><br><span class="line">   0x08048f26 &lt;+1&gt;:     sub    $0x8,%esp</span><br><span class="line">   0x08048f29 &lt;+4&gt;:     call   0x8049170 &lt;read_line&gt;</span><br><span class="line">   0x08048f2e &lt;+9&gt;:     sub    $0x4,%esp</span><br><span class="line">   0x08048f31 &lt;+12&gt;:    push   $0xa</span><br><span class="line">   0x08048f33 &lt;+14&gt;:    push   $0x0</span><br><span class="line">   0x08048f35 &lt;+16&gt;:    push   %eax</span><br><span class="line">   0x08048f36 &lt;+17&gt;:    call   0x8048880 &lt;strtol@plt&gt;</span><br><span class="line">   0x08048f3b &lt;+22&gt;:    mov    %eax,%ebx</span><br><span class="line">   0x08048f3d &lt;+24&gt;:    lea    -0x1(%eax),%eax</span><br><span class="line">   0x08048f40 &lt;+27&gt;:    add    $0x10,%esp</span><br><span class="line">   0x08048f43 &lt;+30&gt;:    cmp    $0x3e8,%eax</span><br><span class="line">   0x08048f48 &lt;+35&gt;:    jbe    0x8048f4f &lt;secret_phase+42&gt;</span><br><span class="line">   0x08048f4a &lt;+37&gt;:    call   0x8049110 &lt;explode_bomb&gt;</span><br><span class="line">   0x08048f4f &lt;+42&gt;:    sub    $0x8,%esp</span><br><span class="line">   0x08048f52 &lt;+45&gt;:    push   %ebx</span><br><span class="line">   0x08048f53 &lt;+46&gt;:    push   $0x804c088</span><br><span class="line">   0x08048f58 &lt;+51&gt;:    call   0x8048ed4 &lt;fun7&gt;</span><br><span class="line">   0x08048f5d &lt;+56&gt;:    add    $0x10,%esp</span><br><span class="line">   0x08048f60 &lt;+59&gt;:    cmp    $0x5,%eax</span><br><span class="line">   0x08048f63 &lt;+62&gt;:    je     0x8048f6a &lt;secret_phase+69&gt;</span><br><span class="line">   0x08048f65 &lt;+64&gt;:    call   0x8049110 &lt;explode_bomb&gt;</span><br><span class="line">   0x08048f6a &lt;+69&gt;:    sub    $0xc,%esp</span><br><span class="line">   0x08048f6d &lt;+72&gt;:    push   $0x804a044</span><br><span class="line">   0x08048f72 &lt;+77&gt;:    call   0x80487c0 &lt;puts@plt&gt;</span><br><span class="line">   0x08048f77 &lt;+82&gt;:    call   0x8049269 &lt;phase_defused&gt;</span><br><span class="line">   0x08048f7c &lt;+87&gt;:    add    $0x18,%esp</span><br><span class="line">   0x08048f7f &lt;+90&gt;:    pop    %ebx</span><br><span class="line">   0x08048f80 &lt;+91&gt;:    ret</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">fun7:</span><br><span class="line">   0x08048ed4 &lt;+0&gt;:     push   %ebx</span><br><span class="line">   0x08048ed5 &lt;+1&gt;:     sub    $0x8,%esp</span><br><span class="line">   0x08048ed8 &lt;+4&gt;:     mov    0x10(%esp),%edx</span><br><span class="line">   0x08048edc &lt;+8&gt;:     mov    0x14(%esp),%ecx</span><br><span class="line">   0x08048ee0 &lt;+12&gt;:    test   %edx,%edx</span><br><span class="line">   0x08048ee2 &lt;+14&gt;:    je     0x8048f1b &lt;fun7+71&gt;</span><br><span class="line">   0x08048ee4 &lt;+16&gt;:    mov    (%edx),%ebx</span><br><span class="line">   0x08048ee6 &lt;+18&gt;:    cmp    %ecx,%ebx</span><br><span class="line">   0x08048ee8 &lt;+20&gt;:    jle    0x8048efd &lt;fun7+41&gt;</span><br><span class="line">   0x08048eea &lt;+22&gt;:    sub    $0x8,%esp</span><br><span class="line">   0x08048eed &lt;+25&gt;:    push   %ecx</span><br><span class="line">   0x08048eee &lt;+26&gt;:    pushl  0x4(%edx)</span><br><span class="line">   0x08048ef1 &lt;+29&gt;:    call   0x8048ed4 &lt;fun7&gt;</span><br><span class="line">   0x08048ef6 &lt;+34&gt;:    add    $0x10,%esp</span><br><span class="line">   0x08048ef9 &lt;+37&gt;:    add    %eax,%eax</span><br><span class="line">   0x08048efb &lt;+39&gt;:    jmp    0x8048f20 &lt;fun7+76&gt;</span><br><span class="line">   0x08048efd &lt;+41&gt;:    mov    $0x0,%eax</span><br><span class="line">   0x08048f02 &lt;+46&gt;:    cmp    %ecx,%ebx</span><br><span class="line">   0x08048f04 &lt;+48&gt;:    je     0x8048f20 &lt;fun7+76&gt;</span><br><span class="line">   0x08048f06 &lt;+50&gt;:    sub    $0x8,%esp</span><br><span class="line">   0x08048f09 &lt;+53&gt;:    push   %ecx</span><br><span class="line">   0x08048f0a &lt;+54&gt;:    pushl  0x8(%edx)</span><br><span class="line">   0x08048f0d &lt;+57&gt;:    call   0x8048ed4 &lt;fun7&gt;</span><br><span class="line">   0x08048f12 &lt;+62&gt;:    add    $0x10,%esp</span><br><span class="line">   0x08048f15 &lt;+65&gt;:    lea    0x1(%eax,%eax,1),%eax</span><br><span class="line">   0x08048f19 &lt;+69&gt;:    jmp    0x8048f20 &lt;fun7+76&gt;</span><br><span class="line">   0x08048f1b &lt;+71&gt;:    mov    $0xffffffff,%eax</span><br><span class="line">   0x08048f20 &lt;+76&gt;:    add    $0x8,%esp</span><br><span class="line">   0x08048f23 &lt;+79&gt;:    pop    %ebx</span><br><span class="line">   0x08048f24 &lt;+80&gt;:    ret</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/10/25/Hierarchical-Clustering/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/25/Hierarchical-Clustering/" itemprop="url">Hierarchical_Clustering</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-25T12:42:25+08:00">
                2020-10-25
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2020-11-02T23:14:14+08:00">
                2020-11-02
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Hierarchical-Clustering-层次聚类"><a href="#Hierarchical-Clustering-层次聚类" class="headerlink" title="Hierarchical Clustering 层次聚类"></a>Hierarchical Clustering 层次聚类</h1><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>层次聚类的功能和K-Means 一样，也是将数据点进行聚类。有时候它们的结果是非常接近甚至完全相同的。</p>
<p><img src="/2020/10/25/Hierarchical-Clustering/1.png" style="zoom:80%;"></p>
<p>层次聚类分为： Agglomerative 和Divisive 两种。这篇博客要着重介绍的是 Agglomerative Hierarchical  Clustering</p>
<p>一下是层次聚类的步骤:</p>
<ul>
<li>Step1: Make each data point a single-point cluster :初始情况下，包含N个数据点的数据集就有N个类</li>
<li>Step2: Take the two closest data points and make them one cluster : 将距离最近的两个数据点合并成一个类，现在只有N-1个类了</li>
<li>Step3: Take the two closest clusters and make them one cluster :将两个距离最近的类合并成一个类，现在只有N-2个类了</li>
<li>Step4: 重复步骤3.直到只剩下一个类位置，得到最终聚类成果</li>
</ul>
<p>现在很重要的一点是怎么来计算 cluster之间的距离？</p>
<p>在点和点之间我们可以用欧几里得距离，在两个类之间我们有4种不同的距离可以选择：</p>
<p><strong>第一种：选择两个类中最近的点的距离</strong></p>
<p><img src="/2020/10/25/Hierarchical-Clustering/3.png"></p>
<p><strong>第二种：选择两个类中最远的点的距离</strong></p>
<p><img src="/2020/10/25/Hierarchical-Clustering/4.png"></p>
<p><strong>第三种：计算两个类中所有的点之间距离后取平均数</strong></p>
<p><strong>第四种： 先计算两个类的中心点，然后求中心点之间的距离：</strong></p>
<p><img src="/2020/10/25/Hierarchical-Clustering/5.png"></p>
<p>具体选择哪一种需要根据具体情况进行分析</p>
<p>现在我们对一个具体的数据集进行简单的层级聚类：</p>
<p><img src="/2020/10/25/Hierarchical-Clustering/6.png"></p>
<p>第一步，我们要将6个数据点分成6类：</p>
<p><img src="/2020/10/25/Hierarchical-Clustering/7.png"></p>
<p>第二步，选择两个最近的点，合并成一个类，现在还有5个类：</p>
<p><img src="/2020/10/25/Hierarchical-Clustering/8.png"></p>
<p>第三步，将两个最近的类合并成一个类，现在还有4 个类:</p>
<p><img src="/2020/10/25/Hierarchical-Clustering/9.png"></p>
<p>第四步，重复第三步直到只剩下一个类为止：</p>
<p><img src="/2020/10/25/Hierarchical-Clustering/10.png"></p>
<p><img src="/2020/10/25/Hierarchical-Clustering/11.png"></p>
<h2 id="Dendrograms-树枝型结构联系图"><a href="#Dendrograms-树枝型结构联系图" class="headerlink" title="Dendrograms 树枝型结构联系图"></a>Dendrograms 树枝型结构联系图</h2><p>我们可以用 树枝型结构联系图来将聚类过程形象的表示出来。</p>
<p>如下图，左边是数据点的分布，右边是树枝型结构联系图。右图的x轴是离散的类，y轴是类与类之间的距离。</p>
<p><img src="/2020/10/25/Hierarchical-Clustering/12.png"></p>
<p>比如说首先是 P2和P3 是先聚合的，那么首先在P2和P3之间建立联系：</p>
<p><img src="/2020/10/25/Hierarchical-Clustering/13.png"></p>
<p>其次是在P5和P6之间进行联系，在图上可以这样反应：</p>
<p><img src="/2020/10/25/Hierarchical-Clustering/14.png"></p>
<p>那么我们怎么利用这个 Dengrograms？我们可以划分一个距离的最大值，高于这个距离的聚类就舍弃，低于这个距离的聚类就保留：</p>
<p><img src="/2020/10/25/Hierarchical-Clustering/15.png"></p>
<p>比如上图，我在1.75的地方画了一根线，那么就说明我们不要最终的那一类了，但是我们要保留1.75以下聚合的那两类。</p>
<p><strong>简单来说，只要看看这根线穿过了多少竖线，那么就说明分成几类。</strong>比如说下面，穿过了4根竖线，那么就说明分成4类</p>
<p><img src="/2020/10/25/Hierarchical-Clustering/16.png"></p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>我们用的数据集和K-Means数据集一样</p>
<h3 id="Importing-the-libraries"><a href="#Importing-the-libraries" class="headerlink" title="Importing the libraries"></a>Importing the libraries</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></table></figure>
<h3 id="Importing-the-dataset"><a href="#Importing-the-dataset" class="headerlink" title="Importing the dataset"></a>Importing the dataset</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dataset = pd.read_csv(<span class="string">'Mall_Customers.csv'</span>)</span><br><span class="line">X = dataset.iloc[:, [<span class="number">3</span>, <span class="number">4</span>]].values</span><br></pre></td></tr></table></figure>
<h3 id="Using-the-dendrogram-to-find-the-optimal-number-of-clusters"><a href="#Using-the-dendrogram-to-find-the-optimal-number-of-clusters" class="headerlink" title="Using the dendrogram to find the optimal number of clusters"></a>Using the dendrogram to find the optimal number of clusters</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scipy.cluster.hierarchy <span class="keyword">as</span> sch</span><br><span class="line">dendrogram = sch.dendrogram(sch.linkage(X, method = <span class="string">'ward'</span>))</span><br><span class="line">plt.title(<span class="string">'Dendrogram'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Customers'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Euclidean distances'</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/25/Hierarchical-Clustering/17.png"></p>
<p>根据上图，我们可以看出选择3-5个 cluster是比较合适的</p>
<h3 id="Training-the-Hierarchical-Clustering-model-on-the-dataset"><a href="#Training-the-Hierarchical-Clustering-model-on-the-dataset" class="headerlink" title="Training the Hierarchical Clustering model on the dataset"></a>Training the Hierarchical Clustering model on the dataset</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.cluster <span class="keyword">import</span> AgglomerativeClustering</span><br><span class="line">hc = AgglomerativeClustering(n_clusters = <span class="number">5</span>, </span><br><span class="line">							affinity = <span class="string">'euclidean'</span>,</span><br><span class="line">                            linkage = <span class="string">'ward'</span>)</span><br><span class="line">y_hc = hc.fit_predict(X)</span><br></pre></td></tr></table></figure>
<p>n_clusters 代表话分类的个数</p>
<p>affinity 是以什么关系来聚合，这里选的是欧氏距离</p>
<p>linkage 是指定的算法计算生成聚类树，有好几种取值方法，推荐使用 Ward</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>字符串</th>
<th>含  义</th>
</tr>
</thead>
<tbody>
<tr>
<td>single</td>
<td>最短距离（缺省）</td>
</tr>
<tr>
<td>complete</td>
<td>最大距离</td>
</tr>
<tr>
<td>average</td>
<td>平均距离</td>
</tr>
<tr>
<td>centroid</td>
<td>重心距离</td>
</tr>
<tr>
<td>ward</td>
<td>离差平方和方法（Ward方法）</td>
</tr>
</tbody>
</table>
</div>
<h3 id="Visualising-the-clusters"><a href="#Visualising-the-clusters" class="headerlink" title="Visualising the clusters"></a>Visualising the clusters</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">plt.scatter(X[y_hc == <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">			X[y_hc == <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">            s = <span class="number">100</span>, </span><br><span class="line">            c = <span class="string">'red'</span>, </span><br><span class="line">            label = <span class="string">'Cluster 1'</span>)</span><br><span class="line">plt.scatter(X[y_hc == <span class="number">1</span>, <span class="number">0</span>],</span><br><span class="line">			X[y_hc == <span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">            s = <span class="number">100</span>, c = <span class="string">'blue'</span>,</span><br><span class="line">            label = <span class="string">'Cluster 2'</span>)</span><br><span class="line">plt.scatter(X[y_hc == <span class="number">2</span>, <span class="number">0</span>],</span><br><span class="line">			X[y_hc == <span class="number">2</span>, <span class="number">1</span>],</span><br><span class="line">            s = <span class="number">100</span>, </span><br><span class="line">            c = <span class="string">'green'</span>,</span><br><span class="line">            label = <span class="string">'Cluster 3'</span>)</span><br><span class="line">plt.scatter(X[y_hc == <span class="number">3</span>, <span class="number">0</span>],</span><br><span class="line">			X[y_hc == <span class="number">3</span>, <span class="number">1</span>],</span><br><span class="line">            s = <span class="number">100</span>,</span><br><span class="line">            c = <span class="string">'cyan'</span>,</span><br><span class="line">            label = <span class="string">'Cluster 4'</span>)</span><br><span class="line">plt.scatter(X[y_hc == <span class="number">4</span>, <span class="number">0</span>],</span><br><span class="line">			X[y_hc == <span class="number">4</span>, <span class="number">1</span>],</span><br><span class="line">            s = <span class="number">100</span>, </span><br><span class="line">            c = <span class="string">'magenta'</span>, </span><br><span class="line">            label = <span class="string">'Cluster 5'</span>)</span><br><span class="line">plt.title(<span class="string">'Clusters of customers'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Annual Income (k$)'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Spending Score (1-100)'</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/25/Hierarchical-Clustering/18.png"></p>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/10/22/K-Means%E8%81%9A%E7%B1%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/22/K-Means%E8%81%9A%E7%B1%BB/" itemprop="url">K-Means聚类</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-22T19:23:59+08:00">
                2020-10-22
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2020-10-22T22:30:34+08:00">
                2020-10-22
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="K-Means聚类"><a href="#K-Means聚类" class="headerlink" title="K-Means聚类"></a>K-Means聚类</h1><p>首先我们要来看聚类(clustering) 和 分类(classification) 的区别：</p>
<p>参考博客： <a href="https://blog.csdn.net/gdp12315_gu/article/details/49777797" target="_blank" rel="noopener">https://blog.csdn.net/gdp12315_gu/article/details/49777797</a></p>
<p><a href="https://www.jianshu.com/p/1e7ddfddf14a" target="_blank" rel="noopener">https://www.jianshu.com/p/1e7ddfddf14a</a></p>
<h4 id="聚类："><a href="#聚类：" class="headerlink" title="聚类："></a>聚类：</h4><p><strong>将</strong>物理或抽象对象的<strong>集合分成</strong>由类似的对象组成的<strong>多个类</strong>的过程被称为聚类。聚类分析的一般做法是，先确定聚类统计量，然后利用统计量对样品或者变量进行聚类。对N个样品进行聚类的方法称为Q型聚类，常用的统计量称为“距离”；对于m个变量进行聚类的方法称为R型聚类，常用的统计量称为“相似系数”。       </p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Method name</th>
<th>Parameters</th>
<th>Scalability</th>
<th>Use case</th>
<th>Geometry (metric used)</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://scikit-learn.org/stable/modules/clustering.html#k-means" target="_blank" rel="noopener">K-Means</a></td>
<td>number of clusters</td>
<td>Very large <code>n_samples</code>, medium <code>n_clusters</code> with <a href="https://scikit-learn.org/stable/modules/clustering.html#mini-batch-kmeans" target="_blank" rel="noopener">MiniBatch code</a></td>
<td>General-purpose, even cluster size, flat geometry, not too many clusters</td>
<td>Distances between points</td>
</tr>
<tr>
<td><a href="https://scikit-learn.org/stable/modules/clustering.html#affinity-propagation" target="_blank" rel="noopener">Affinity propagation</a></td>
<td>damping, sample preference</td>
<td>Not scalable with n_samples</td>
<td>Many clusters, uneven cluster size, non-flat geometry</td>
<td>Graph distance (e.g. nearest-neighbor graph)</td>
</tr>
<tr>
<td><a href="https://scikit-learn.org/stable/modules/clustering.html#mean-shift" target="_blank" rel="noopener">Mean-shift</a></td>
<td>bandwidth</td>
<td>Not scalable with <code>n_samples</code></td>
<td>Many clusters, uneven cluster size, non-flat geometry</td>
<td>Distances between points</td>
</tr>
<tr>
<td><a href="https://scikit-learn.org/stable/modules/clustering.html#spectral-clustering" target="_blank" rel="noopener">Spectral clustering</a></td>
<td>number of clusters</td>
<td>Medium <code>n_samples</code>, small <code>n_clusters</code></td>
<td>Few clusters, even cluster size, non-flat geometry</td>
<td>Graph distance (e.g. nearest-neighbor graph)</td>
</tr>
<tr>
<td><a href="https://scikit-learn.org/stable/modules/clustering.html#hierarchical-clustering" target="_blank" rel="noopener">Ward hierarchical clustering</a></td>
<td>number of clusters or distance threshold</td>
<td>Large <code>n_samples</code> and <code>n_clusters</code></td>
<td>Many clusters, possibly connectivity constraints</td>
<td>Distances between points</td>
</tr>
<tr>
<td><a href="https://scikit-learn.org/stable/modules/clustering.html#hierarchical-clustering" target="_blank" rel="noopener">Agglomerative clustering</a></td>
<td>number of clusters or distance threshold, linkage type, distance</td>
<td>Large <code>n_samples</code> and <code>n_clusters</code></td>
<td>Many clusters, possibly connectivity constraints, non Euclidean distances</td>
<td>Any pairwise distance</td>
</tr>
<tr>
<td><a href="https://scikit-learn.org/stable/modules/clustering.html#dbscan" target="_blank" rel="noopener">DBSCAN</a></td>
<td>neighborhood size</td>
<td>Very large <code>n_samples</code>, medium <code>n_clusters</code></td>
<td>Non-flat geometry, uneven cluster sizes</td>
<td>Distances between nearest points</td>
</tr>
<tr>
<td><a href="https://scikit-learn.org/stable/modules/clustering.html#optics" target="_blank" rel="noopener">OPTICS</a></td>
<td>minimum cluster membership</td>
<td>Very large <code>n_samples</code>, large <code>n_clusters</code></td>
<td>Non-flat geometry, uneven cluster sizes, variable cluster density</td>
<td>Distances between points</td>
</tr>
<tr>
<td><a href="https://scikit-learn.org/stable/modules/mixture.html#mixture" target="_blank" rel="noopener">Gaussian mixtures</a></td>
<td>many</td>
<td>Not scalable</td>
<td>Flat geometry, good for density estimation</td>
<td>Mahalanobis distances to  centers</td>
</tr>
<tr>
<td><a href="https://scikit-learn.org/stable/modules/clustering.html#birch" target="_blank" rel="noopener">Birch</a></td>
<td>branching factor, threshold, optional global clusterer.</td>
<td>Large <code>n_clusters</code> and <code>n_samples</code></td>
<td>Large dataset, outlier removal, data reduction.</td>
<td>Euclidean distance between points</td>
</tr>
</tbody>
</table>
</div>
<h4 id="分类（Classification）："><a href="#分类（Classification）：" class="headerlink" title="分类（Classification）："></a>分类（Classification）：</h4><p>在已有分类标准下，对新数据进行划分，分类。</p>
<h4 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h4><p>假设有一批人的年龄的数据，大致知道其中有一堆少年儿童，一堆青年人，一堆老年人。</p>
<p><strong>聚类</strong>就是自动发现这三堆数据，并把相似的数据聚合到同一堆中。所以对于这个例子，如果要聚成3堆的话，那么输入就是一堆年龄数据，注意，此时的年龄数据并不带有类标号，也就是说我只知道里面大致有三堆人，至于谁是哪一堆，现在是不知道的，而输出就是每个数据所属的类标号，聚类完成之后，就知道谁和谁是一堆了。</p>
<p><strong>分类</strong>就是，我事先告诉你，少年儿童、青年人及老年人的年龄是什么样的，现在新来了一个年龄，输出它的类标号，就是它是属于少年儿童、青年人、老年人的哪个类。一般来说，分类器是需要训练的，也就是要告诉你的算法，每个类的特征是什么样子，它才能识别新的数据。</p>
<p> 刚才举的是一个超级简单的例子，方便大家理解。下面再举一个实际的例子。</p>
<p>对于聚类，比如有些搜索引擎有“查看相似网页”的功能，这个就可以用聚类来做，把网页就行聚类，在聚类的结果中，每一个类中的网页看成是相似的。</p>
<p>对于分类，比如手写识别就可以看到是分类问题，比如我写了10个“我”字，然后对这10个“我”字进行特征提取，就可以告诉算法，“我”字具有什么样的特征，于是来了一个新的“我”字，虽然笔画和之前的10个“我”字不完全一样，但是特征高度相似，于是就把这个手写的字分类到“我”这个类，就识别出来了。</p>
<h2 id="K-Means-聚类算法"><a href="#K-Means-聚类算法" class="headerlink" title="K-Means 聚类算法"></a>K-Means 聚类算法</h2><p>对于这样一个二维数据集，我们可以对其进行 K-Means 聚类，结果就是原数据集被分成3类：</p>
<p><img src="/2020/10/22/K-Means%E8%81%9A%E7%B1%BB/2.png" style="zoom:80%;"></p>
<p>但是二维只是为了比较直观的展现K-Means 的功能，数据集可能是更高维度的，我们现在来看看K-Means 的内部逻辑</p>
<ul>
<li>选择我们想要的类的个数K；</li>
<li>在平面上随机选择K个点，作为初始化类的中心点，不一定在原先数据当中；</li>
<li>对于数据集中的每个点，要判断它属于我们之前K个中心点的哪一类。依据数据中的每个点对这K个点的距离的大小，找到最短的距离，那么就是每个数据点对应的类别，这一步可以称作是分配；</li>
<li>重新计算一些新的中心点，就是应用之前分配的结果重新计算分配好的每个类当中的中心点；</li>
<li><p>重新分配，如果重新分配的结果和之前分配的结果相同，则说明找到最佳的K-Means算法的结果，如果不同，那继续去第四步进行分配计算，直到找到最佳算法结果</p>
<p><img src="/2020/10/22/K-Means%E8%81%9A%E7%B1%BB/3.png" style="zoom:80%;"></p>
</li>
</ul>
<p>接下来我们具体拿一个例子来说明这些过程:</p>
<p><img src="/2020/10/22/K-Means%E8%81%9A%E7%B1%BB/4.png" style="zoom:80%;"></p>
<p>接下来我们要随机选择K=2 个点作为中心，并分别计算每个点距离这两个点的距离并进行分类。这里可以有个比较简单的计算方式，我们作出这两个点的垂直平分线，那么这个绿线上方的点都是离蓝色点比较近，下面的离红色比较近。</p>
<p>经过第一次分类，我们得到的分类如下：</p>
<p><img src="/2020/10/22/K-Means%E8%81%9A%E7%B1%BB/5.png" style="zoom:80%;"></p>
<p>然后我们要计算一些新的中心点，也就是分配好的每个类当中的中心点。找到中心点之后我们又可以去重新分配数据。一直到重新分配的结果和未分配的结果相同时，完成聚类。</p>
<p><img src="/2020/10/22/K-Means%E8%81%9A%E7%B1%BB/6.png" style="zoom:80%;"></p>
<p>再次分类之后，我们得到：</p>
<p><img src="/2020/10/22/K-Means%E8%81%9A%E7%B1%BB/7.png" style="zoom:80%;"></p>
<p>对中心点进行更新：</p>
<p><img src="/2020/10/22/K-Means%E8%81%9A%E7%B1%BB/8.png" style="zoom:80%;"></p>
<p>对数据进行分配：</p>
<p><img src="/2020/10/22/K-Means%E8%81%9A%E7%B1%BB/9.png" style="zoom:80%;"></p>
<p>对中心点进行更新：</p>
<p><img src="/2020/10/22/K-Means%E8%81%9A%E7%B1%BB/10.png" style="zoom:80%;"></p>
<p>对数据进行分类，发现和之前的一样，说明聚类已经完成了：</p>
<p><img src="/2020/10/22/K-Means%E8%81%9A%E7%B1%BB/11.png" style="zoom:80%;"></p>
<h3 id="随机初始化陷阱"><a href="#随机初始化陷阱" class="headerlink" title="随机初始化陷阱"></a>随机初始化陷阱</h3><p>现在看看初始点的选择对最终K-Means聚类结果的影响。下面有一个例子，我们需要用K-Means算法对这组数据进行聚类，选择K=3。这里很明显有三类，我们这里就直接选择最佳的中心点并标记出这三类数据。</p>
<p><img src="/2020/10/22/K-Means%E8%81%9A%E7%B1%BB/12.png" style="zoom:100%;"></p>
<p><img src="/2020/10/22/K-Means%E8%81%9A%E7%B1%BB/13.png" style="zoom:100%;"></p>
<p>但是这里是我们肉眼看出来的三个中心点，但如果我们选择的不是最佳的中心点，则需要重复上述的45步，比如选的是下面这三个中心点。</p>
<p><img src="/2020/10/22/K-Means%E8%81%9A%E7%B1%BB/14.png" style="zoom:100%;"></p>
<p>这样得到的分类结果和之前那个显然是不同的。但这样就发生了同一组数据，却产生了两个不同的分类结果。区别就在于选择了不同的初始中心点。我们不好直接说哪一个分类算法更好，需要有一个方法来判断如何选择初始中心点。也就是说初始中心点不能随机进行选择了。现在有一个K-Means算法的更新版本，叫做K-Means++，它完美的解决了初始化中心点的陷阱，数学上来讲叫做局部最小值的一个陷阱。无论在R还是Python中，这个K-Means++都已经加入了算法当中，因此不用担心之后的代码实现会不会掉入这个陷阱。</p>
<h2 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h2><h3 id="Selecting-The-Number-Of-Cluster"><a href="#Selecting-The-Number-Of-Cluster" class="headerlink" title="Selecting The Number Of Cluster"></a>Selecting The Number Of Cluster</h3><p>上文讲到的是选择中心点的陷阱，那么现在在谈谈如何选择类的个数。从直观上，上文中的图像大部分人应该很容易想到分为3组，也有的人可能想分为2组，但怎样选择才是最佳的分组方式是个需要好好研究的问题。首先来定义一个数学的量，组内平方和(WCSS)。</p>
<p><img src="/2020/10/22/K-Means%E8%81%9A%E7%B1%BB/15.png" style="zoom:100%;"></p>
<p>来看这个表达式，一共有3项，每一项代表对于每一组的平方和。比如第一项，就是对所有数据点对这一组中心点距离的平方。很显然，如果每一组的数据蜷缩的越紧，那么这个平方和就越小。</p>
<p>那么如果将这组数据分为1组，那么这个组内平方和只有一项，那么这个结果很显然会很大。如果分为2组，那么结果比1组的肯定要小，当分为3组时，得到的结果会更小。也就是说，随着分组的个数增加，这个组内平方和会逐渐变小。那么现在的问题来了，如何选择最合适的分组的个数？</p>
<p>这里要介绍一个法则，叫做手肘法则(The Elbow Method)。我们把随着分组个数的增加，WCSS的结果的图像画出来</p>
<p><img src="/2020/10/22/K-Means%E8%81%9A%E7%B1%BB/16.png" style="zoom:100%;"></p>
<p>找到最像手肘的这个点，这里就是3，那么这个点，就是最佳的分组的个数。这个曲线上可以看到，从1到2，和2到3时，下降的速率都是比较快的，但从3往后，下降的速率都是非常小的，那么我们要找的就是这样一个点，在到达这个点之前和从这个点开始的下降，速率的变化时最大的。</p>
<h3 id="Clustering"><a href="#Clustering" class="headerlink" title="Clustering"></a>Clustering</h3><p>我们这次要用到的数据集部分如下，反映的是一个购物商场的购物信息。最后一列Spending Score是购物商场根据客户的信息打出的客户的评分，分数越低意味着客户花的钱越少，越高以为着客户花的越多。商场希望通过对客户的年收入和购物指数来进行分群</p>
<p><img src="/2020/10/22/K-Means%E8%81%9A%E7%B1%BB/17.png" style="zoom:120%;"></p>
<p>首先我们进行导库和导数据集</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">dataset = pd.read_csv(<span class="string">'Mall_Customers.csv'</span>)</span><br><span class="line">X = dataset.iloc[:, [<span class="number">3</span>, <span class="number">4</span>]].values</span><br></pre></td></tr></table></figure>
<h4 id="Using-the-elbow-method-to-find-the-optimal-number-of-clusters"><a href="#Using-the-elbow-method-to-find-the-optimal-number-of-clusters" class="headerlink" title="Using the elbow method to find the optimal number of clusters"></a>Using the elbow method to find the optimal number of clusters</h4><p>那么这个问题的自变量就是第四五列，年收入和购物指数。但它是个<strong>无监督学习</strong>，因此<strong>没有因变量</strong>。我们要将其最终分为几类。这里我们要用到的工具是<code>sklearn.cluster</code>中的<code>KMeans</code>类。首先要计算各个分组的WCSS。这里我们计算组数从1到10的情况。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.cluster <span class="keyword">import</span> KMeans</span><br><span class="line">wcss = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">11</span>):</span><br><span class="line">    kmeans = KMeans(n_clusters = i, init = <span class="string">'k-means++'</span>, random_state = <span class="number">42</span>)</span><br><span class="line">    kmeans.fit(X)</span><br><span class="line">    wcss.append(kmeans.inertia_)</span><br><span class="line">plt.plot(range(<span class="number">1</span>, <span class="number">11</span>), wcss)</span><br><span class="line">plt.title(<span class="string">'The Elbow Method'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Number of clusters'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'WCSS'</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p>这里的<code>KMeans</code>中的参数也解释下，<code>n_clusters</code>指的是分组数，<code>max_iter</code>指的是每一次计算时最大的循环个数，这里使用默认值300，<code>n_init</code>代表每一个做K平均算法时，会对多少组不同的中心值进行计算。<code>init</code>这个参数非常重要，指的是我们如何选择初始值，最简单的是<code>random</code>，即随机，但为了避免掉入随机初始值陷阱，这里使用<code>k-means++</code>。</p>
<p>拟合好后得到组间距离就是<code>kmeans.inertia_</code>。这样我们就可以画出对于不同的分组数，<code>wcss</code>的图像。</p>
<p><img src="/2020/10/22/K-Means%E8%81%9A%E7%B1%BB/18.png" style="zoom:120%;"></p>
<p>那么通过手肘法则，可以得到最佳的分组个数是5组，则可以开始拟合数据。</p>
<h4 id="Training-the-K-Means-model-on-the-dataset"><a href="#Training-the-K-Means-model-on-the-dataset" class="headerlink" title="Training the K-Means model on the dataset"></a>Training the K-Means model on the dataset</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kmeans = KMeans(n_clusters = <span class="number">5</span>, init = <span class="string">'k-means++'</span>, random_state = <span class="number">42</span>)</span><br><span class="line">y_kmeans = kmeans.fit_predict(X)</span><br></pre></td></tr></table></figure>
<h4 id="Visualizing-the-clusters"><a href="#Visualizing-the-clusters" class="headerlink" title="Visualizing the clusters"></a>Visualizing the clusters</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">plt.scatter(X[y_kmeans == <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">            X[y_kmeans == <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">            s = <span class="number">100</span>, </span><br><span class="line">            c = <span class="string">'red'</span>, </span><br><span class="line">            label = <span class="string">'Cluster 1'</span>)</span><br><span class="line">plt.scatter(X[y_kmeans == <span class="number">1</span>, <span class="number">0</span>], </span><br><span class="line">            X[y_kmeans == <span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">            s = <span class="number">100</span>,</span><br><span class="line">            c = <span class="string">'blue'</span>,</span><br><span class="line">            label = <span class="string">'Cluster 2'</span>)</span><br><span class="line">plt.scatter(X[y_kmeans == <span class="number">2</span>, <span class="number">0</span>],</span><br><span class="line">            X[y_kmeans == <span class="number">2</span>, <span class="number">1</span>],</span><br><span class="line">            s = <span class="number">100</span>, c = <span class="string">'green'</span>,</span><br><span class="line">            label = <span class="string">'Cluster 3'</span>)</span><br><span class="line">plt.scatter(X[y_kmeans == <span class="number">3</span>, <span class="number">0</span>],</span><br><span class="line">            X[y_kmeans == <span class="number">3</span>, <span class="number">1</span>], </span><br><span class="line">            s = <span class="number">100</span>, c = <span class="string">'cyan'</span>,</span><br><span class="line">            label = <span class="string">'Cluster 4'</span>)</span><br><span class="line">plt.scatter(X[y_kmeans == <span class="number">4</span>, <span class="number">0</span>],</span><br><span class="line">            X[y_kmeans == <span class="number">4</span>, <span class="number">1</span>],</span><br><span class="line">            s = <span class="number">100</span>, </span><br><span class="line">            c = <span class="string">'magenta'</span>,</span><br><span class="line">            label = <span class="string">'Cluster 5'</span>)</span><br><span class="line">plt.scatter(kmeans.cluster_centers_[:, <span class="number">0</span>],</span><br><span class="line">            kmeans.cluster_centers_[:, <span class="number">1</span>],</span><br><span class="line">            s = <span class="number">300</span>, </span><br><span class="line">            c = <span class="string">'yellow'</span>,</span><br><span class="line">            label = <span class="string">'Centroids'</span>)</span><br><span class="line">plt.title(<span class="string">'Clusters of customers'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Annual Income (k$)'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Spending Score (1-100)'</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/22/K-Means%E8%81%9A%E7%B1%BB/19.png" style="zoom:120%;"></p>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/10/22/%E5%86%B3%E7%AD%96%E6%A0%91%E5%92%8C%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%E5%88%86%E7%B1%BB%E5%99%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/22/%E5%86%B3%E7%AD%96%E6%A0%91%E5%92%8C%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%E5%88%86%E7%B1%BB%E5%99%A8/" itemprop="url">决策树和随机森林分类器</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-22T18:29:56+08:00">
                2020-10-22
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2020-10-22T19:19:18+08:00">
                2020-10-22
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="决策树和随机森林分类器"><a href="#决策树和随机森林分类器" class="headerlink" title="决策树和随机森林分类器"></a>决策树和随机森林分类器</h1><h2 id="决策树"><a href="#决策树" class="headerlink" title="决策树"></a>决策树</h2><p>在之前，我们介绍了<a href="https://jasonxqh.github.io/2020/10/09/%E5%86%B3%E7%AD%96%E6%A0%91%E5%92%8C%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%E5%9B%9E%E5%BD%92/"> 回归树和随机森林回归</a> 现在我们来看看分类树</p>
<p>分类树和和回归树不同，它处理的数据都是离散的，且有分类的, 对于一个新数据的预测，我们是将其划归为哪一类中去。而回归树处理的数据则是连续的数字，对于一个新数据的预测，我们是赋给它一个值。</p>
<p>比如说下面这个例子，用分类树将其划分为几个区：</p>
<p><img src="/2020/10/22/%E5%86%B3%E7%AD%96%E6%A0%91%E5%92%8C%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%E5%88%86%E7%B1%BB%E5%99%A8/1.png" style="zoom:100%;"></p>
<p><img src="/2020/10/22/%E5%86%B3%E7%AD%96%E6%A0%91%E5%92%8C%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%E5%88%86%E7%B1%BB%E5%99%A8/2.png" style="zoom:100%;"></p>
<p>然后再对其进行决策：</p>
<p><img src="/2020/10/22/%E5%86%B3%E7%AD%96%E6%A0%91%E5%92%8C%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%E5%88%86%E7%B1%BB%E5%99%A8/3.png" style="zoom:100%;"></p>
<p>决策树和其他的分类器一样，也可以对多个维度进行训练。</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>我们同样使用之前的 年龄-薪资-购买与否 的数据集：</p>
<p>和之前的代码几乎一样，这里展示一下训练集、混淆矩阵以及可视化结果</p>
<h3 id="Training-the-Decision-Tree-Classification-model-on-the-Training-set"><a href="#Training-the-Decision-Tree-Classification-model-on-the-Training-set" class="headerlink" title="Training the Decision Tree Classification model on the Training set"></a>Training the Decision Tree Classification model on the Training set</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.tree <span class="keyword">import</span> DecisionTreeClassifier</span><br><span class="line">classifier = DecisionTreeClassifier(criterion = <span class="string">'entropy'</span>, random_state = <span class="number">0</span>)</span><br><span class="line">classifier.fit(X_train, y_train)</span><br></pre></td></tr></table></figure>
<h3 id="Making-the-Confusion-Matrix"><a href="#Making-the-Confusion-Matrix" class="headerlink" title="Making the Confusion Matrix"></a>Making the Confusion Matrix</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> confusion_matrix, accuracy_score</span><br><span class="line">cm = confusion_matrix(y_test, y_pred)</span><br><span class="line">print(cm)</span><br><span class="line">accuracy_score(y_test, y_pred)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[[62  6]</span><br><span class="line"> [ 3 29]]</span><br><span class="line"> 0.91</span><br></pre></td></tr></table></figure>
<h3 id="Visualizing-the-Training-set-results"><a href="#Visualizing-the-Training-set-results" class="headerlink" title="Visualizing the Training set results"></a>Visualizing the Training set results</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> matplotlib.colors <span class="keyword">import</span> ListedColormap</span><br><span class="line">X_set, y_set = sc.inverse_transform(X_train), y_train</span><br><span class="line">X1, X2 = np.meshgrid(np.arange(start = X_set[:, <span class="number">0</span>].min() - <span class="number">10</span>, </span><br><span class="line">							   stop = X_set[:, <span class="number">0</span>].max() + <span class="number">10</span>,</span><br><span class="line">                               step = <span class="number">0.25</span>),</span><br><span class="line">                     np.arange(start = X_set[:, <span class="number">1</span>].min() - <span class="number">1000</span>, </span><br><span class="line">                     			stop = X_set[:, <span class="number">1</span>].max() + <span class="number">1000</span>, </span><br><span class="line">                     			step = <span class="number">0.25</span>))</span><br><span class="line">plt.contourf(X1, X2, </span><br><span class="line">classifier.predict(sc.transform(np.array([X1.ravel(), X2.ravel()]).T)).reshape(X1.shape),</span><br><span class="line">             alpha = <span class="number">0.75</span>,</span><br><span class="line">             cmap = ListedColormap((<span class="string">'red'</span>, <span class="string">'green'</span>)))</span><br><span class="line">plt.xlim(X1.min(), X1.max())</span><br><span class="line">plt.ylim(X2.min(), X2.max())</span><br><span class="line"><span class="keyword">for</span> i, j <span class="keyword">in</span> enumerate(np.unique(y_set)):</span><br><span class="line">    plt.scatter(X_set[y_set == j, <span class="number">0</span>],</span><br><span class="line">    			X_set[y_set == j, <span class="number">1</span>],</span><br><span class="line">                c = ListedColormap((<span class="string">'red'</span>, <span class="string">'green'</span>))(i),</span><br><span class="line">                label = j)</span><br><span class="line">plt.title(<span class="string">'Decision Tree Classification (Training set)'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Age'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Estimated Salary'</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/22/%E5%86%B3%E7%AD%96%E6%A0%91%E5%92%8C%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%E5%88%86%E7%B1%BB%E5%99%A8/4.png" style="zoom:100%;"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> matplotlib.colors <span class="keyword">import</span> ListedColormap</span><br><span class="line">X_set, y_set = sc.inverse_transform(X_test), y_test</span><br><span class="line">X1, X2 = np.meshgrid(np.arange(start = X_set[:, <span class="number">0</span>].min() - <span class="number">10</span>,</span><br><span class="line">								stop = X_set[:, <span class="number">0</span>].max() + <span class="number">10</span>,</span><br><span class="line">                                step = <span class="number">0.25</span>),</span><br><span class="line">                     np.arange(start = X_set[:, <span class="number">1</span>].min() - <span class="number">1000</span>, </span><br><span class="line">                     			stop = X_set[:, <span class="number">1</span>].max() + <span class="number">1000</span>,</span><br><span class="line">                                step = <span class="number">0.25</span>))</span><br><span class="line">plt.contourf(X1, X2, </span><br><span class="line">classifier.predict(sc.transform(np.array([X1.ravel(), X2.ravel()]).T)).reshape(X1.shape),</span><br><span class="line">             alpha = <span class="number">0.75</span>, </span><br><span class="line">             cmap = ListedColormap((<span class="string">'red'</span>, <span class="string">'green'</span>)))</span><br><span class="line">plt.xlim(X1.min(), X1.max())</span><br><span class="line">plt.ylim(X2.min(), X2.max())</span><br><span class="line"><span class="keyword">for</span> i, j <span class="keyword">in</span> enumerate(np.unique(y_set)):</span><br><span class="line">    plt.scatter(X_set[y_set == j, <span class="number">0</span>], </span><br><span class="line">    			X_set[y_set == j, <span class="number">1</span>],</span><br><span class="line">                c = ListedColormap((<span class="string">'red'</span>, <span class="string">'green'</span>))(i), </span><br><span class="line">                label = j)</span><br><span class="line">plt.title(<span class="string">'Decision Tree Classification (Test set)'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Age'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Estimated Salary'</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/22/%E5%86%B3%E7%AD%96%E6%A0%91%E5%92%8C%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%E5%88%86%E7%B1%BB%E5%99%A8/5.png" style="zoom:100%;"></p>
<h2 id="随机森林分类器"><a href="#随机森林分类器" class="headerlink" title="随机森林分类器"></a>随机森林分类器</h2><ul>
<li>Step 1: Pick at random K data points from the Training set</li>
<li>Step 2: Build the Decision Tree associated to these K data points</li>
<li>Step 3: Choose the number Ntree of trees you want to build and repeat STEPS 1&amp;2</li>
<li>Step 4: For a new data point, make each one of your Ntree trees predict the category to which the data points belongs, and assign the new data point to the category that wins the majority vote</li>
</ul>
<h3 id="Training-the-Random-Forest-Classification-model-on-the-Training-set"><a href="#Training-the-Random-Forest-Classification-model-on-the-Training-set" class="headerlink" title="Training the Random Forest Classification model on the Training set"></a>Training the Random Forest Classification model on the Training set</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.ensemble <span class="keyword">import</span> RandomForestClassifier</span><br><span class="line">classifier = RandomForestClassifier(n_estimators = <span class="number">10</span>, criterion = <span class="string">'entropy'</span>, random_state = <span class="number">0</span>)</span><br><span class="line">classifier.fit(X_train, y_train)</span><br></pre></td></tr></table></figure>
<h3 id="Making-the-Confusion-Matrix-1"><a href="#Making-the-Confusion-Matrix-1" class="headerlink" title="Making the Confusion Matrix"></a>Making the Confusion Matrix</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> confusion_matrix, accuracy_score</span><br><span class="line">cm = confusion_matrix(y_test, y_pred)</span><br><span class="line">print(cm)</span><br><span class="line">accuracy_score(y_test, y_pred)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[[63  5]</span><br><span class="line"> [ 4 28]]</span><br><span class="line"> 0.91</span><br></pre></td></tr></table></figure>
<h3 id="Visualizing-the-Training-set-results-1"><a href="#Visualizing-the-Training-set-results-1" class="headerlink" title="Visualizing the Training set results"></a>Visualizing the Training set results</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> matplotlib.colors <span class="keyword">import</span> ListedColormap</span><br><span class="line">X_set, y_set = sc.inverse_transform(X_train), y_train</span><br><span class="line">X1, X2 = np.meshgrid(np.arange(start = X_set[:, <span class="number">0</span>].min() - <span class="number">10</span>,</span><br><span class="line">								stop = X_set[:, <span class="number">0</span>].max() + <span class="number">10</span>, </span><br><span class="line">								step = <span class="number">0.25</span>),</span><br><span class="line">                     np.arange(start = X_set[:, <span class="number">1</span>].min() - <span class="number">1000</span>,</span><br><span class="line">                     			stop = X_set[:, <span class="number">1</span>].max() + <span class="number">1000</span>,</span><br><span class="line">                                step = <span class="number">0.25</span>))</span><br><span class="line">plt.contourf(X1, X2, </span><br><span class="line">classifier.predict(sc.transform(np.array([X1.ravel(), X2.ravel()]).T)).reshape(X1.shape),</span><br><span class="line">             alpha = <span class="number">0.75</span>,</span><br><span class="line">             cmap = ListedColormap((<span class="string">'red'</span>, <span class="string">'green'</span>)))</span><br><span class="line">plt.xlim(X1.min(), X1.max())</span><br><span class="line">plt.ylim(X2.min(), X2.max())</span><br><span class="line"><span class="keyword">for</span> i, j <span class="keyword">in</span> enumerate(np.unique(y_set)):</span><br><span class="line">    plt.scatter(X_set[y_set == j, <span class="number">0</span>],</span><br><span class="line">    			X_set[y_set == j, <span class="number">1</span>], </span><br><span class="line">    			c = ListedColormap((<span class="string">'red'</span>, <span class="string">'green'</span>))(i), </span><br><span class="line">    			label = j)</span><br><span class="line">plt.title(<span class="string">'Random Forest Classification (Training set)'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Age'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Estimated Salary'</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/22/%E5%86%B3%E7%AD%96%E6%A0%91%E5%92%8C%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%E5%88%86%E7%B1%BB%E5%99%A8/6.png" style="zoom:100%;"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> matplotlib.colors <span class="keyword">import</span> ListedColormap</span><br><span class="line">X_set, y_set = sc.inverse_transform(X_test), y_test</span><br><span class="line">X1, X2 = np.meshgrid(np.arange(start = X_set[:, <span class="number">0</span>].min() - <span class="number">10</span>, </span><br><span class="line">                               	stop = X_set[:, <span class="number">0</span>].max() + <span class="number">10</span>, </span><br><span class="line">                               	step = <span class="number">0.25</span>),</span><br><span class="line">                     np.arange(start = X_set[:, <span class="number">1</span>].min() - <span class="number">1000</span>, </span><br><span class="line">                               stop = X_set[:, <span class="number">1</span>].max() + <span class="number">1000</span>,</span><br><span class="line">                               step = <span class="number">0.25</span>))</span><br><span class="line">plt.contourf(X1, X2, </span><br><span class="line">             classifier.predict(sc.transform(np.array([X1.ravel(), X2.ravel()]).T)).reshape(X1.shape),</span><br><span class="line">             alpha = <span class="number">0.75</span>, </span><br><span class="line">             cmap = ListedColormap((<span class="string">'red'</span>, <span class="string">'green'</span>)))</span><br><span class="line">plt.xlim(X1.min(), X1.max())</span><br><span class="line">plt.ylim(X2.min(), X2.max())</span><br><span class="line"><span class="keyword">for</span> i, j <span class="keyword">in</span> enumerate(np.unique(y_set)):</span><br><span class="line">    plt.scatter(X_set[y_set == j, <span class="number">0</span>],</span><br><span class="line">                X_set[y_set == j, <span class="number">1</span>],</span><br><span class="line">                c = ListedColormap((<span class="string">'red'</span>, <span class="string">'green'</span>))(i), </span><br><span class="line">                label = j)</span><br><span class="line">plt.title(<span class="string">'Random Forest Classification (Test set)'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Age'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Estimated Salary'</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/22/%E5%86%B3%E7%AD%96%E6%A0%91%E5%92%8C%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%E5%88%86%E7%B1%BB%E5%99%A8/7.png" style="zoom:100%;"></p>
<p>随机森林可以用来进行体感游戏中对人体动作的检测，判断人生上的区域的运动等等。</p>
<p><a href="https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/BodyPartRecognition.pdf" target="_blank" rel="noopener">https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/BodyPartRecognition.pdf</a></p>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/10/21/%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/10/21/%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF/" itemprop="url">朴素贝叶斯</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-10-21T21:17:28+08:00">
                2020-10-21
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2020-10-22T18:25:58+08:00">
                2020-10-22
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="朴素贝叶斯"><a href="#朴素贝叶斯" class="headerlink" title="朴素贝叶斯"></a>朴素贝叶斯</h1><p>参考博客： <a href="https://www.jianshu.com/p/456782eff870" target="_blank" rel="noopener">https://www.jianshu.com/p/456782eff870</a></p>
<p>我在离散数学的概率博客中提到了Bayes 定理，可以参考这篇博客进行学习： <a href="https://jasonxqh.github.io/2020/05/15/离散概率part2/#Bayes&#39;-Therem">Bayes‘ Therem</a></p>
<h3 id="Naive-Bayes"><a href="#Naive-Bayes" class="headerlink" title="Naïve Bayes"></a>Naïve Bayes</h3><p>现在我们着重介绍一些朴素贝叶斯分类器。  </p>
<p><img src="/2020/10/21/%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF/1.png" style="zoom:80%;"></p>
<p>这是一个年龄薪水关于上班方式的数据集，绿色代表了了开车去上班，红色代表了走路去上班。现在有一个新的点进来了，我们该怎么预测它是属于哪一类的呢？</p>
<p>我们需要用到 $P(A|B) = \frac{P(B|A)\cdot P(A)}{P(B)}$  其中P(A|B)被称作后验概率，P(B|A)和P(B)这两个概率并不完全是概率，因为朴素贝叶斯分类器中，<strong>B代表特征</strong>，所以说这两个概率我们称作<strong>似然</strong>。</p>
<h4 id="Step1"><a href="#Step1" class="headerlink" title="Step1"></a>Step1</h4><p>应用到上面这个数据集，我们就会求 $P(Walk|X)=\frac{P(X|Walk)*P(Walks)}{P(X)}$ </p>
<p>这里的X就是它的特征。对于新的点，它有对应的年纪和收入就是这个新用户的特征，我们要求的就是已知这些特征，要得到它分到红组或者绿组的概率。这里的P(Walks)就是随机抽一个人，它是走路上班的概率，这个也被称作先验概率，对应的就是后验。P(X)指的是随机抽一个人，他所显示的特征和新用户的特征的似然或者可能性。这里的似然也是个概率，它是对数据特征的概率，因此我们把它叫做似然。再然后，这里的P(X)指的是对这个数据特征的概率，因此叫做似然。接下来第三部要求的也是个似然P(X|Walks)，或者叫做边际的似然，边际的可能性。这样我们就能求出后验概率P(Walks|X)。</p>
<p><img src="/2020/10/21/%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF/2.png" style="zoom:80%;"></p>
<h4 id="Step2"><a href="#Step2" class="headerlink" title="Step2"></a>Step2</h4><p><img src="/2020/10/21/%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF/3.png" style="zoom:80%;"></p>
<p>分别计算出 Drives和Walks的概率之后，我们要比较 $P(Walks|X) ~v.s. P(Drives|X)$  谁大谁小，哪个大这个X就属于哪里</p>
<p>我们来一步一步实现这些步骤</p>
<p>首先 P(Walks) = (Number of Walkers)/ (Total Observations) = 10/30</p>
<p>接下来，计算P(X)，也就是似然。这个是朴素贝叶斯中核心的一步。这里的X指的是新用户他所代表的特征，即年纪和收入。我们可以围绕这个新用户画一个圈，那么这个圈就代表着在这个二维数据空间中的所有用户，他们的特征和新用户非常相似。要求的P(X)就是我们原先数据空间中的所有数据，它的特征坐落在这个圈中的概率。那么我们要计算的就是原先数据中与新用户拥有相似特征的个数除以总的人数。 P(X) = Number of Similar Observations/ Total Observations = 4/30</p>
<p><img src="/2020/10/21/%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF/4.png" style="zoom:90%;"></p>
<p>再然后求P(X}Walks)，也就是边际似然，那么就是如果一个人是步行上班，那么它坐落在这个圈中的概率。P(X|Walks) = Number of Similar Observations Among those who Walk / Total number of Walkers =  3/10</p>
<p><img src="/2020/10/21/%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF/5.png" style="zoom:90%;"></p>
<p>根据上面几个数据，我们可以计算出 P(Walks|X)</p>
<p><img src="/2020/10/21/%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF/6.png" style="zoom:90%;"></p>
<p>同理，我们可以得出 P(Drives|X) = 0.25</p>
<p>因为 0.75 &gt; 0.25 所以这一点应该被划分到红色，也就是走路的一边去</p>
<h2 id="朴素贝叶斯的一些补充说明"><a href="#朴素贝叶斯的一些补充说明" class="headerlink" title="朴素贝叶斯的一些补充说明"></a>朴素贝叶斯的一些补充说明</h2><p>接下来我们来看看几个问题，<strong>首先第一个</strong>，为什么把它做朴素贝叶斯？或者为什么朴素？当我们使用朴素贝叶斯方法的时候已经做过一个假设，这个假设就是数据的<strong>所有特征都是独立的</strong>。在上述的例子里的两个特征，年龄和薪水，实际上这两者是可能有关系的，一般来说年龄越大可能薪水就越大。但这里假设年龄和薪水两者没有相关性。因此在一个机器学习的问题中，我们经常会做一些假设，这些假设并不一定都是对的，但这些假设可以帮助我们更高效快捷的解决问题。我们允许有一点误差，因为我们的终极问题是解决问题。</p>
<p><strong>第二个问题</strong>，似然函数P(X)，上面计算这个函数的方法是先在新数据周围画了个圈，表示在这个圈里的数据点，都表示和这个新数据点有相似的特征，那么接下来这个似然就是指如果有一个新的点，那么它坐落在这个圈中的概率。那么这个P(X)你会发现，它跟我们想要计算的后验概率是和红组相关还是绿组相关是没有关系的。我们最后要计算的两个后验概率的公式中的分母都是P(X)，那么我们比较这两者实际上可以把这个P(X)个消掉，也就是说可以直接比较两者的分子P(X|Walks)*P(Walks)和P(X|Drives)*P(Drives)。</p>
<p><strong>最后一个问题</strong>，若我们已知的组超过两组怎么办？目前已经有两组的情况下，比较两者的后验概率，那么我们将新数据分配到更大的概率的分组中。那么同理如果有三组的话，就是比较三者的后验概率，哪个更大就分配到其分组中。</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><h3 id="Importing-the-libraries"><a href="#Importing-the-libraries" class="headerlink" title="Importing the libraries"></a>Importing the libraries</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></table></figure>
<h3 id="Importing-the-dataset"><a href="#Importing-the-dataset" class="headerlink" title="Importing the dataset"></a>Importing the dataset</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dataset = pd.read_csv(<span class="string">'Social_Network_Ads.csv'</span>)</span><br><span class="line">X = dataset.iloc[:, :<span class="number">-1</span>].values</span><br><span class="line">y = dataset.iloc[:, <span class="number">-1</span>].values</span><br></pre></td></tr></table></figure>
<h3 id="Splitting-the-dataset-into-the-Training-set-and-Test-set"><a href="#Splitting-the-dataset-into-the-Training-set-and-Test-set" class="headerlink" title="Splitting the dataset into the Training set and Test set"></a>Splitting the dataset into the Training set and Test set</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line">X_train, X_test, y_train, y_test = train_test_split(</span><br><span class="line">                                    X, </span><br><span class="line">                                    y,</span><br><span class="line">                                    test_size = <span class="number">0.25</span>,</span><br><span class="line">                                    random_state = <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Feature-Scaling"><a href="#Feature-Scaling" class="headerlink" title="Feature Scaling"></a>Feature Scaling</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line">sc = StandardScaler()</span><br><span class="line">X_train = sc.fit_transform(X_train)</span><br><span class="line">X_test = sc.transform(X_test)</span><br></pre></td></tr></table></figure>
<h3 id="Training-the-Naive-Bayes-model-on-the-Training-set"><a href="#Training-the-Naive-Bayes-model-on-the-Training-set" class="headerlink" title="Training the Naive Bayes model on the Training set"></a>Training the Naive Bayes model on the Training set</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.naive_bayes <span class="keyword">import</span> GaussianNB</span><br><span class="line">classifier = GaussianNB()</span><br><span class="line">classifier.fit(X_train, y_train)</span><br></pre></td></tr></table></figure>
<h3 id="Predicting-the-Test-set-results"><a href="#Predicting-the-Test-set-results" class="headerlink" title="Predicting the Test set results"></a>Predicting the Test set results</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">y_pred = classifier.predict(X_test)</span><br><span class="line">print(np.concatenate((y_pred.reshape(len(y_pred),<span class="number">1</span>), </span><br><span class="line">						y_test.reshape(len(y_test),<span class="number">1</span>)),<span class="number">1</span>))</span><br></pre></td></tr></table></figure>
<h3 id="Making-the-Confusion-Matrix"><a href="#Making-the-Confusion-Matrix" class="headerlink" title="Making the Confusion Matrix"></a>Making the Confusion Matrix</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.metrics <span class="keyword">import</span> confusion_matrix, accuracy_score</span><br><span class="line">cm = confusion_matrix(y_test, y_pred)</span><br><span class="line">print(cm)</span><br><span class="line">accuracy_score(y_test, y_pred)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[[65  3]</span><br><span class="line"> [ 7 25]]</span><br><span class="line">0.9</span><br></pre></td></tr></table></figure>
<h3 id="Visualising-the-Training-set-results"><a href="#Visualising-the-Training-set-results" class="headerlink" title="Visualising the Training set results"></a>Visualising the Training set results</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> matplotlib.colors <span class="keyword">import</span> ListedColormap</span><br><span class="line">X_set, y_set = sc.inverse_transform(X_train), y_train</span><br><span class="line">X1, X2 = np.meshgrid(np.arange( start = X_set[:, <span class="number">0</span>].min() - <span class="number">10</span>,</span><br><span class="line">								stop = X_set[:, <span class="number">0</span>].max() + <span class="number">10</span>,</span><br><span class="line">								step = <span class="number">0.25</span>),</span><br><span class="line">                     np.arange(start = X_set[:, <span class="number">1</span>].min() - <span class="number">1000</span>, </span><br><span class="line">                     			stop = X_set[:, <span class="number">1</span>].max() + <span class="number">1000</span>,</span><br><span class="line">                                step = <span class="number">0.25</span>))</span><br><span class="line">plt.contourf(X1,</span><br><span class="line">			X2,</span><br><span class="line">            classifier.predict(sc.transform(np.array([X1.ravel(), 	X2.ravel()]).T)).reshape(X1.shape),</span><br><span class="line">             alpha = <span class="number">0.75</span>, </span><br><span class="line">             cmap = ListedColormap((<span class="string">'red'</span>, <span class="string">'green'</span>)))</span><br><span class="line">plt.xlim(X1.min(), X1.max())</span><br><span class="line">plt.ylim(X2.min(), X2.max())</span><br><span class="line"><span class="keyword">for</span> i, j <span class="keyword">in</span> enumerate(np.unique(y_set)):</span><br><span class="line">    plt.scatter(X_set[y_set == j, <span class="number">0</span>],</span><br><span class="line">    			X_set[y_set == j, <span class="number">1</span>], </span><br><span class="line">    			c = ListedColormap((<span class="string">'red'</span>, <span class="string">'green'</span>))(i), label = j)</span><br><span class="line">plt.title(<span class="string">'Naive Bayes (Training set)'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Age'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Estimated Salary'</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/21/%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF/7.png" style="zoom:100%;"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> matplotlib.colors <span class="keyword">import</span> ListedColormap</span><br><span class="line">X_set, y_set = sc.inverse_transform(X_test), y_test</span><br><span class="line">X1, X2 = np.meshgrid(np.arange(start = X_set[:, <span class="number">0</span>].min() - <span class="number">10</span>,</span><br><span class="line">								stop = X_set[:, <span class="number">0</span>].max() + <span class="number">10</span>,</span><br><span class="line">                                step = <span class="number">0.25</span>),</span><br><span class="line">                     np.arange(start = X_set[:, <span class="number">1</span>].min() - <span class="number">1000</span>,</span><br><span class="line">                     			stop = X_set[:, <span class="number">1</span>].max() + <span class="number">1000</span>,</span><br><span class="line">                                step = <span class="number">0.25</span>))</span><br><span class="line">plt.contourf(X1, X2,</span><br><span class="line">			classifier.predict(sc.transform(np.array([X1.ravel(), X2.ravel()]).T)).reshape(X1.shape),</span><br><span class="line">             alpha = <span class="number">0.75</span>,</span><br><span class="line">             cmap = ListedColormap((<span class="string">'red'</span>, <span class="string">'green'</span>)))</span><br><span class="line">plt.xlim(X1.min(), X1.max())</span><br><span class="line">plt.ylim(X2.min(), X2.max())</span><br><span class="line"><span class="keyword">for</span> i, j <span class="keyword">in</span> enumerate(np.unique(y_set)):</span><br><span class="line">    plt.scatter(X_set[y_set == j, <span class="number">0</span>],</span><br><span class="line">                X_set[y_set == j, <span class="number">1</span>], </span><br><span class="line">                c = ListedColormap((<span class="string">'red'</span>, <span class="string">'green'</span>))(i), label = j)</span><br><span class="line">plt.title(<span class="string">'Naive Bayes (Test set)'</span>)</span><br><span class="line">plt.xlabel(<span class="string">'Age'</span>)</span><br><span class="line">plt.ylabel(<span class="string">'Estimated Salary'</span>)</span><br><span class="line">plt.legend()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/2020/10/21/%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF/8.png" style="zoom:100%;"></p>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/17/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><span class="page-number current">18</span><a class="page-number" href="/page/19/">19</a><span class="space">&hellip;</span><a class="page-number" href="/page/44/">44</a><a class="extend next" rel="next" href="/page/19/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/%5Bobject%20Object%5D"
                alt="Jason" />
            
              <p class="site-author-name" itemprop="name">Jason</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20fa%20fa-archive">
              
                  <span class="site-state-item-count">435</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">61</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart" aria-hidden="true"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jason</span>
 <!--
  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>







-->
        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>




















  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v="></script>

  <script type="text/javascript" src="/js/src/motion.js?v="></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v="></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
