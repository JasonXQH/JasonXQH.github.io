<!DOCTYPE html>
<html lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jasonxqh.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Jasonâ€˜s Blog">
<meta property="og:url" content="https://jasonxqh.github.io/page/25/index.html">
<meta property="og:site_name" content="Jasonâ€˜s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Jason">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://jasonxqh.github.io/page/25/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Jasonâ€˜s Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Jasonâ€˜s Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/15/leetcode%E6%A0%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jasonâ€˜s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/15/leetcode%E6%A0%91/" class="post-title-link" itemprop="url">leetcodeæ ‘</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-15 09:35:03" itemprop="dateCreated datePublished" datetime="2020-06-15T09:35:03+08:00">2020-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-16 10:01:24" itemprop="dateModified" datetime="2020-06-16T10:01:24+08:00">2020-06-16</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="leetcodeæ ‘"><a href="#leetcodeæ ‘" class="headerlink" title="leetcodeæ ‘"></a>leetcodeæ ‘</h1><h2 id="ç®€å•"><a href="#ç®€å•" class="headerlink" title="ç®€å•"></a>ç®€å•</h2><h3 id="100-ç›¸åŒçš„æ ‘"><a href="#100-ç›¸åŒçš„æ ‘" class="headerlink" title="100  ç›¸åŒçš„æ ‘"></a>100  ç›¸åŒçš„æ ‘</h3><p><img src="/2020/06/15/leetcode%E6%A0%91/2.png" style="zoom:80%;"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">public:</span><br><span class="line">    bool isSameTree(TreeNode* p, TreeNode* q) &#123;</span><br><span class="line">        <span class="comment">//å¦‚æœpå’Œqéƒ½ä¸ºNULLï¼Œé‚£ä¹ˆè¿”å›true</span></span><br><span class="line">        <span class="keyword">if</span>(!p &amp;&amp; !q) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		<span class="comment">// pæœ‰ä¸€ä¸ªæ˜¯NULLï¼Œä¸€ä¸ªéç©ºï¼Œé‚£ä¹ˆè¿”å›false</span></span><br><span class="line">        <span class="keyword">if</span>(!p || !q) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//åŒæ—¶æ»¡è¶³ p-&gt;val == q-&gt;val å·¦å­æ ‘å³å­æ ‘éƒ½ç›¸ç­‰ï¼Œæ‰è¿”å›true</span></span><br><span class="line">        <span class="keyword">return</span> (p-&gt;val == q-&gt;val) </span><br><span class="line">                &amp;&amp; (isSameTree(p-&gt;left,q-&gt;left) </span><br><span class="line">                &amp;&amp; isSameTree(p-&gt;right,q-&gt;right));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="101-å¯¹ç§°äºŒå‰æ ‘"><a href="#101-å¯¹ç§°äºŒå‰æ ‘" class="headerlink" title="101 å¯¹ç§°äºŒå‰æ ‘"></a>101 å¯¹ç§°äºŒå‰æ ‘</h3><h3 id="104-äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦"><a href="#104-äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦" class="headerlink" title="104 äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦"></a>104 äºŒå‰æ ‘çš„æœ€å¤§æ·±åº¦</h3><p><img src="/2020/06/15/leetcode%E6%A0%91/3.png" style="zoom:80%;"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">public:</span><br><span class="line">       int maxDepth(TreeNode* root) &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == NULL) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        int left = maxDepth(root-&gt;left);</span><br><span class="line">        int right = maxDepth(root-&gt;right);</span><br><span class="line">        <span class="keyword">return</span> max(left, right) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="é¢è¯•4-04-æ£€æŸ¥å¹³è¡¡æ€§"><a href="#é¢è¯•4-04-æ£€æŸ¥å¹³è¡¡æ€§" class="headerlink" title="é¢è¯•4.04 æ£€æŸ¥å¹³è¡¡æ€§"></a>é¢è¯•4.04 æ£€æŸ¥å¹³è¡¡æ€§</h3><p><img src="/2020/06/15/leetcode%E6%A0%91/1.png" style="zoom:80%;"></p>
<h4 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h4><p>å®šä¹‰ä¸€ä¸ªboolå€¼ï¼Œç„¶ååœ¨æ·±åº¦æœç´¢çš„æ—¶å€™æ—¶åˆ»åˆ¤æ–­å·¦å³å­æ ‘çš„é«˜åº¦å·®æ˜¯å¦è¶…è¿‡äº†1</p>
<p>å½“å·¦å³èŠ‚ç‚¹ç­‰äºnullçš„æ—¶å€™ï¼Œå°±è¿”å›0 ï¼›å½“å·¦å³å­æ ‘ä¸ç›¸ç­‰çš„æ—¶å€™ï¼Œè¿”å›å·¦å³å­æ ‘æœ€å¤§æ·±åº¦åŠ ä¸€ä½œä¸ºå½“å‰èŠ‚ç‚¹çš„æ·±åº¦ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    bool ans = <span class="literal">true</span>;</span><br><span class="line">    int maxDepth(TreeNode* root) &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == NULL) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        int left = maxDepth(root-&gt;left);</span><br><span class="line">        int right = maxDepth(root-&gt;right);</span><br><span class="line">        <span class="keyword">if</span>(abs(left - right) &gt; <span class="number">1</span>) </span><br><span class="line">            ans = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> max(left, right) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">public:</span><br><span class="line">    bool isBalanced(TreeNode* root) &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == NULL) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        maxDepth(root);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="ä¸­ç­‰"><a href="#ä¸­ç­‰" class="headerlink" title="ä¸­ç­‰"></a>ä¸­ç­‰</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jasonâ€˜s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/" class="post-title-link" itemprop="url">JavaScriptæ•°æ®å¯è§†åŒ–ä¹‹D3</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-12 01:00:54" itemprop="dateCreated datePublished" datetime="2020-06-12T01:00:54+08:00">2020-06-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-04-09 23:24:14" itemprop="dateModified" datetime="2025-04-09T23:24:14+08:00">2025-04-09</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="JavaScriptæ•°æ®å¯è§†åŒ–ä¹‹D3"><a href="#JavaScriptæ•°æ®å¯è§†åŒ–ä¹‹D3" class="headerlink" title="JavaScriptæ•°æ®å¯è§†åŒ–ä¹‹D3"></a>JavaScriptæ•°æ®å¯è§†åŒ–ä¹‹D3</h1><p>æ•™ç¨‹ï¼š</p>
<p> <a href="https://www.youtube.com/watch?v=_8V5o2UHG0E&amp;list=WL&amp;index=6&amp;t=202s" target="_blank" rel="noopener">https://www.youtube.com/watch?v=_8V5o2UHG0E&amp;list=WL&amp;index=6&amp;t=202s</a></p>
<p>ç½‘ç«™ï¼š<a href="https://vizhub.com/" target="_blank" rel="noopener">https://vizhub.com/</a></p>
<p>æ•™ç¨‹2ï¼š<a href="https://www.bilibili.com/video/BV1HK411L72d?p=1" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1HK411L72d?p=1</a></p>
<p>æºç ï¼š <a href="https://github.com/Shao-Kui/D3.js-Demos" target="_blank" rel="noopener">https://github.com/Shao-Kui/D3.js-Demos</a></p>
<p>æ–‡æ¡£ï¼š<a href="https://github.com/d3/d3/wiki" target="_blank" rel="noopener">https://github.com/d3/d3/wiki</a></p>
<p><strong>äº†è§£ä»¥ä¸‹æ ‡ç­¾å³å¯</strong></p>
<p>â€¢<code>&lt;html&gt;</code>ï¼šæœ€å¤–å±‚çš„ä¸»æ ‡ç­¾ï¼Œæ¯ä¸ªHTMLæ–‡ä»¶éƒ½éœ€è¦æœ‰ï¼</p>
<p>â€¢<code>&lt;head&gt;</code>: æ ‡é¢˜å†…å®¹ï¼ŒåŒ…å«HTMLçš„æ–‡ä»¶é“¾æ¥ã€æ ‡é¢˜ç­‰</p>
<p>â€¢<code>&lt;body&gt;</code>ï¼šHTMLçš„ä¸»ä½“ï¼ŒåŒ…æ‹¬å„ç§å…¶ä¸­çš„å„ç§å…ƒç´ </p>
<p>â€¢<code>&lt;title&gt;</code>ï¼šæ ‡é¢˜ï¼ˆæ˜¾ç¤ºåœ¨æµè§ˆå™¨çš„æ ‡ç­¾æ ï¼‰</p>
<p>â€¢<code>&lt;script&gt;</code>ï¼šJavaScriptè„šæœ¬æˆ–å¯¹äºè„šæœ¬çš„é“¾æ¥â€¢D3.jsçš„ç¼–ç¨‹ä¸»è¦å†™åœ¨æ­¤æ ‡ç­¾ä¸­</p>
<p>â€¢<code>&lt;svg&gt;</code>: å¯¹äºD3æœ€ä¸ºé‡è¦çš„æ ‡ç­¾ï¼Œä¸»è¦æ“ä½œçš„å¯¹è±¡ï¼ˆè§ä¸‹é¡µï¼‰</p>
<p>â€¢<code>&lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/style.css&quot;&gt;</code></p>
<p> â€¢<code>&lt;!DOCTYPEhtml&gt;</code></p>
<p>â€¢æ‰€æœ‰æ ‡ç­¾éƒ½éœ€è¦ä»¥<code>&lt;/tag&gt;</code>ç»“æŸ</p>
<p>D3: Data-Driven Documents</p>
<p>å’Œpython çš„æ•°æ®å¯è§†åŒ–å’ŒRè¯­è¨€ä¸åŒï¼ŒD3æ˜¯æŠŠæ•°æ®å¯è§†åŒ–å±•ç¤ºåœ¨webä¸Šçš„ï¼Œè¿˜å¯ä»¥åˆ›å»ºç”¨æˆ·äº¤äº’ç­‰ç­‰</p>
<h2 id="Loading-D3-js"><a href="#Loading-D3-js" class="headerlink" title="Loading D3.js"></a>Loading D3.js</h2><p>æˆ‘ä»¬å¯ä»¥ä¹‹é—´ åœ¨d3çš„æ–‡æ¡£ä¸Šæ‰¾ <a href="https://github.com/d3/d3/wiki/CN-Home" target="_blank" rel="noopener">https://github.com/d3/d3/wiki/CN-Home</a></p>
<p>ä¹Ÿå¯ä»¥åœ¨<a href="https://unpkg.comä¸Šæ‰¾" target="_blank" rel="noopener">https://unpkg.comä¸Šæ‰¾</a> å¼•å…¥d3 çš„script</p>
<p>ç›´æ¥<code>&lt;script src=&quot;https://d3js.org/d3.v5.min.js&quot;&gt;&lt;/script&gt;</code></p>
<p>æˆ–è€…<code>&lt;script src=&quot;https://unpkg.com/d3@5.6.0/dist/d3.min.js&quot;&gt;&lt;/script&gt;</code></p>
<p>ä¹Ÿå¯ä»¥é€šè¿‡æœ¬åœ°æœåŠ¡å™¨é“¾æ¥</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Let's make a face with D3.js<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"style.css"</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/d3@5.6.0/dist/d3.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--       &lt;script src="https://d3js.org/d3.v3.min.js"&gt;&lt;/script&gt; </span></span><br><span class="line"><span class="comment">			æ³¨æ„ï¼Œè¿™é‡Œè¦å†™httpsä¸è¦å†™http</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">"960"</span> <span class="attr">height</span> =<span class="string">"500"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">          	<span class="keyword">const</span> svg = d3.select(<span class="string">'svg'</span>);</span></span><br><span class="line"><span class="actionscript">              <span class="comment">//æˆ‘ä»¬æŠŠèƒŒæ™¯é¢œè‰²è®¾ç½®ä¸º redçœ‹çœ‹æ•ˆæœ</span></span></span><br><span class="line"><span class="actionscript">            svg.style(<span class="string">'background-color'</span>,<span class="string">'red'</span>);</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span> <span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/7.png" style="zoom:40%;"></p>
<h4 id="å¯¹D3æœ‰ä¸€ä¸ªå¤§ä½“çš„äº†è§£"><a href="#å¯¹D3æœ‰ä¸€ä¸ªå¤§ä½“çš„äº†è§£" class="headerlink" title="å¯¹D3æœ‰ä¸€ä¸ªå¤§ä½“çš„äº†è§£"></a>å¯¹D3æœ‰ä¸€ä¸ªå¤§ä½“çš„äº†è§£</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Data Visualization!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://d3js.org/d3.v5.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">"960"</span> <span class="attr">height</span>=<span class="string">"500"</span> <span class="attr">id</span>=<span class="string">"mainsvg"</span> <span class="attr">class</span>=<span class="string">"svgs"</span>&gt;</span><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">      <span class="comment">//è¿™æ®µä»£ç æ˜¯åœ¨å±å¹•ä¸Šç»˜åˆ¶ä¸€ä¸ªæœ€ç®€å•çš„åœ†</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> mainsvg = d3.select(<span class="string">'.svgs'</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> maingroup = mainsvg</span></span><br><span class="line"><span class="actionscript">      .append(<span class="string">'g'</span>)</span></span><br><span class="line"><span class="javascript">      .attr(<span class="string">'transform'</span>, <span class="string">`translate(<span class="subst">$&#123;<span class="number">100</span>&#125;</span>, <span class="subst">$&#123;<span class="number">100</span>&#125;</span>)`</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> circle = maingroup</span></span><br><span class="line"><span class="actionscript">      .append(<span class="string">'circle'</span>)</span></span><br><span class="line"><span class="actionscript">      .attr(<span class="string">'stroke'</span>, <span class="string">'black'</span>)</span></span><br><span class="line"><span class="actionscript">      .attr(<span class="string">'r'</span>, <span class="string">'66'</span>)</span></span><br><span class="line"><span class="actionscript">      .attr(<span class="string">'fill'</span>, <span class="string">'yellow'</span>);</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/8.png" style="zoom:80%;"></p>
<p>â€¢åœ¨HTMLä¸­æŸ¥æ‰¾å¹¶è·å–SVG</p>
<p>â€¢åœ¨SVGä¸­åŠ å…¥ç»„ï¼ˆGroupï¼‰<code>&lt;g&gt;</code></p>
<p>â€¢è®¾ç½®ç»„çš„å¹³ç§»ä¸ºå‘ä¸‹ã€å‘å³ä¸ª100åƒç´ </p>
<p>â€¢åœ¨ä¸»è¦ç»„ä¸­åŠ å…¥ä¸€ä¸ªåœ†</p>
<p>â€¢åœ†çš„è¾¹æ¡†ä¸ºé»‘è‰²</p>
<p>â€¢åœ†çš„åŠå¾„ä¸º66åƒç´ </p>
<p>â€¢åœ†çš„å¡«å……é¢œè‰²ä¸ºé»„è‰²</p>
<h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><h4 id="Header-Title"><a href="#Header-Title" class="headerlink" title="Header Title"></a>Header Title</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>HTML Cars Report<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="Bulleted-list"><a href="#Bulleted-list" class="headerlink" title="Bulleted list"></a>Bulleted list</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Cars Report<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"highlighted"</span>&gt;</span>2012 Nissan Leaf: $1800<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>2009 Ford F150: $1950<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>2009 Chevrolet Trailblazer: $1550<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span> <span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/1.png" style="zoom:90%;"></p>
<h3 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h3><h4 id="Customisze-Font-amp-Highlight-an-item"><a href="#Customisze-Font-amp-Highlight-an-item" class="headerlink" title="Customisze Font &amp; Highlight an item"></a>Customisze Font &amp; Highlight an item</h4><p>style.css è¿™æ˜¯cssé€‰æ‹©å™¨</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">2em</span>;</span><br><span class="line">  <span class="attribute">font-family</span>: monospace;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.highlighted</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>index.htmlä¸­å¼•å…¥ï¼Œç”¨linkæ ‡ç­¾</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>HTML Cars Report<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"style.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;body...&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span> <span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/2.png" style="zoom:90%;"></p>
<h3 id="SVG-å¯ç¼©æ”¾çŸ¢é‡å›¾å½¢"><a href="#SVG-å¯ç¼©æ”¾çŸ¢é‡å›¾å½¢" class="headerlink" title="SVG å¯ç¼©æ”¾çŸ¢é‡å›¾å½¢"></a>SVG å¯ç¼©æ”¾çŸ¢é‡å›¾å½¢</h3><h4 id="SVG-as-Image-Format"><a href="#SVG-as-Image-Format" class="headerlink" title="SVG as Image Format"></a>SVG as Image Format</h4><p>.svg ä¸ä¼šåƒç´ åŒ– æ— è®ºæ€ä¹ˆæ”¾å¤§ï¼Œéƒ½æ˜¯å¾ˆæ¸…æ™°çš„</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/3.png" style="zoom:40%;"></p>
<p>ç›¸åï¼Œpngä¼šåƒç´ åŒ–ï¼Œæ”¾å¤§ä¼šå¤±çœŸä¼šæ¨¡ç³Š</p>
<h4 id="SVG-in-HTML"><a href="#SVG-in-HTML" class="headerlink" title="SVG in HTML"></a>SVG in HTML</h4><p>coordinate system,circles,rectangles,lines, colors,groups</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Shapes with SVG and CSS<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"style.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">"960"</span> <span class="attr">height</span> =<span class="string">"500"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">æŠŠæ‰€æœ‰çš„svgæ”¾åœ¨ä¸€ä¸ªgroupä¸­ï¼Œæ•´ä½“è®¾ç½®å¤§å°ä¸ºåŸæ¥çš„1.5å€&lt;g transform = "scale(1.5)"&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">ç¬¬ä¸€è¡Œçš„åœ†å½¢æˆ‘ä»¬å¯ä»¥ç”¨cxå’Œcyç¡®å®šåœ†å¿ƒåæ ‡ï¼Œ rä»£è¡¨äº†åŠå¾„</span></span><br><span class="line"><span class="comment">ç¬¬äºŒè¡Œçš„rectangleæ˜¯æ­£æ–¹å½¢ï¼Œxï¼Œyä»£è¡¨ç€ä»–çš„å·¦ä¸Šè§’é¡¶ç‚¹åæ ‡</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">ç¬¬ä¸‰è¡Œçš„åœ†æˆ‘ä»¬æ·»åŠ äº†é¢œè‰²ï¼Œ ç”¨fill = "" æ¥å®šä¹‰é¢œè‰²</span></span><br><span class="line"><span class="comment">ç¬¬å››è¡Œç¬¬äº”è¡Œæˆ‘ä»¬å¯ä»¥åœ¨fillä¸­åŠ å…¥å¤šç§æ ¼å¼çš„é¢œè‰² rgb(),#...</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">è¿˜å¯ä»¥æŠŠå›¾ç‰‡æ”¾åˆ°ä¸€ä¸ªgroupé‡Œï¼Œé€šè¿‡groupå‚æ•°è®¾ç½® transform="translate()"ä»£è¡¨åæ ‡ï¼Œfillå¡«å……</span></span><br><span class="line"><span class="comment">å¦‚æœgroupä¸­çš„æŸä¸€ç»„ä»¶æœ¬èº«å…·æœ‰fillå¡«å……ï¼Œä¼šè¦†ç›–groupä¸­çš„fill</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">strokeä»£è¡¨è¾¹æ¡†æˆ–è€…çº¿çš„é¢œè‰²ï¼Œstroke-width ä»£è¡¨çº¿çš„ç²—ç»†</span></span><br><span class="line"><span class="comment">æˆ‘ä»¬å¯ä»¥å®šä¹‰&lt;line&gt;&lt;/line&gt;ä¸ºä¸€æ¡çº¿</span></span><br><span class="line"><span class="comment">æˆ‘ä»¬è¿˜å¯ä»¥å®šä¹‰&lt;path&gt;&lt;/path&gt; è¿™æ˜¯ä¸€æ¡è·¯çº¿</span></span><br><span class="line"><span class="comment">M300 280ä»£è¡¨æˆ‘ä»¬move to(300,280) è¿™ä¸ªç‚¹</span></span><br><span class="line"><span class="comment">L350 200ä»£è¡¨æˆ‘ä»¬ç”»ä¸€æ¡çº¿ä»(300,280)æŒ‡å‘(350,200)ä»¥æ­¤ç±»æ¨</span></span><br><span class="line"><span class="comment">--&gt;</span>            </span><br><span class="line">          <span class="tag">&lt;<span class="name">g</span> <span class="attr">transform</span> = <span class="string">"scale(1.5)"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">circle</span> <span class="attr">cx</span>=<span class="string">"50"</span> <span class="attr">cy</span>=<span class="string">"50"</span> <span class="attr">r</span>=<span class="string">"40"</span>&gt;</span><span class="tag">&lt;/<span class="name">circle</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rect</span> <span class="attr">x</span>=<span class="string">"100"</span> <span class="attr">y</span>=<span class="string">"25"</span> <span class="attr">width</span> = <span class="string">"50"</span> <span class="attr">height</span>=<span class="string">"50"</span>&gt;</span><span class="tag">&lt;/<span class="name">rect</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">circle</span> <span class="attr">cx</span>=<span class="string">"50"</span> <span class="attr">cy</span>=<span class="string">"150"</span> <span class="attr">r</span>=<span class="string">"40"</span> <span class="attr">fill</span>=<span class="string">"blue"</span>&gt;</span><span class="tag">&lt;/<span class="name">circle</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rect</span> <span class="attr">x</span>=<span class="string">"100"</span> <span class="attr">y</span>=<span class="string">"125"</span> <span class="attr">width</span> = <span class="string">"50"</span> <span class="attr">height</span>=<span class="string">"50"</span> <span class="attr">fill</span>=<span class="string">"#40b842"</span>&gt;</span><span class="tag">&lt;/<span class="name">rect</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">rect</span> <span class="attr">x</span>=<span class="string">"100"</span> <span class="attr">y</span>=<span class="string">"225"</span> <span class="attr">width</span> = <span class="string">"50"</span> <span class="attr">height</span>=<span class="string">"50"</span> <span class="attr">fill</span>=<span class="string">"rgb(33, 14, 180)"</span>&gt;</span><span class="tag">&lt;/<span class="name">rect</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">g</span> <span class="attr">transform</span>= <span class="string">"translate(0,200)"</span> <span class="attr">fill</span>=<span class="string">"pink"</span> <span class="attr">stroke</span>=<span class="string">"black"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">circle</span> <span class="attr">cx</span>=<span class="string">"50"</span> <span class="attr">cy</span>=<span class="string">"150"</span> <span class="attr">r</span>=<span class="string">"40"</span> <span class="attr">stroke-width</span>=<span class="string">"5"</span> &gt;</span><span class="tag">&lt;/<span class="name">circle</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rect</span> <span class="attr">x</span>=<span class="string">"100"</span> <span class="attr">y</span>=<span class="string">"125"</span> <span class="attr">width</span> = <span class="string">"50"</span> <span class="attr">height</span>=<span class="string">"50"</span>&gt;</span><span class="tag">&lt;/<span class="name">rect</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">g</span> <span class="attr">class</span> = <span class="string">"lines"</span> <span class="attr">transform</span>=<span class="string">"translate(50,0)"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">"200"</span> <span class="attr">y1</span>=<span class="string">"20"</span> <span class="attr">x2</span>=<span class="string">"300"</span> <span class="attr">y2</span>=<span class="string">"280"</span>&gt;</span><span class="tag">&lt;/<span class="name">line</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">path</span>  <span class="attr">fill</span>=<span class="string">"none"</span> <span class="attr">d</span>=<span class="string">"M300 280 L350 200 L450 250 L450 400"</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span> <span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>style.css æˆ‘ä»¬æŠŠlineså®šä¹‰æˆé»‘è‰²ï¼Œå®½åº¦ä¸º10ï¼Œlineä¸­çš„pathå±æ€§å®šä¹‰æˆè¿™ä¸ªé¢œè‰²ã€‚</p>
<p><strong><code>stroke-linejoin</code></strong> å±æ€§æŒ‡æ˜è·¯å¾„çš„è½¬è§’å¤„ä½¿ç”¨çš„å½¢çŠ¶æˆ–è€…ç»˜åˆ¶çš„åŸºç¡€å½¢çŠ¶ã€‚<a href="https://developer.mozilla.org/zh-CN/docs/Web/SVG/Attribute/stroke-linejoin" target="_blank" rel="noopener">developer.mozila.org</a></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123; </span><br><span class="line"> 	<span class="attribute">margin</span>:<span class="number">0px</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.highlighted</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.lines</span>&#123;</span><br><span class="line">  <span class="attribute">stroke</span>:black;</span><br><span class="line">  <span class="attribute">stroke-width</span>:<span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.lines</span> <span class="selector-tag">path</span>&#123;</span><br><span class="line">  <span class="attribute">stroke</span>: <span class="number">#25656d</span> ;</span><br><span class="line">  <span class="attribute">stroke-linejoin</span>: round;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>miter,round,bevel,miter-clip,arcs</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/4.png" style="zoom:40%;"></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/6.png" style="zoom:80%;"></p>
<h3 id="Js-D3çš„å¸¸ç”¨æ¥å£"><a href="#Js-D3çš„å¸¸ç”¨æ¥å£" class="headerlink" title="Js D3çš„å¸¸ç”¨æ¥å£"></a>Js D3çš„å¸¸ç”¨æ¥å£</h3><p>â€¢console.log(â€˜hello world! â€™);</p>
<p>â€¢æ•°ç»„a = [1, 2, 3]</p>
<p>â€¢å¯¹è±¡a = {name: â€˜Shao-Kuiâ€™, age: 24.3, lab: â€˜cscgâ€™}</p>
<p>â€¢D3æ•°æ®å¯è§†åŒ–ä¸­å¸¸è§å¯¹è±¡æ•°ç»„ï¼Œå¦‚ï¼š</p>
<p>â€‹     â€¢a = [{name: â€˜Shao-Kuiâ€™, age: 24.3, dept: â€˜csâ€™},</p>
<pre><code> â€¢{name: â€˜Wen-Yangâ€™, age: 23, dept: â€˜csâ€™},
</code></pre><p>â€‹     â€¢{name: â€˜Yunâ€™, age: 18ğŸ˜, dept: â€˜artâ€™}]</p>
<p>â€¢æ•°ç»„çš„æ’åºa.sort()</p>
<p>â€¢å¯åŠ å…¥å›è°ƒå‡½æ•°æ¥æ›¿ä»£ç¼ºçœçš„æ’åºæ–¹æ¡ˆï¼Œå¦‚å¯¹æ—¥æœŸæ’åº</p>
<p>â€¢a.sort(function(a,b){ return new Date(b.date) -new Date(a.date); }</p>
<p>â€¢æ•°ç»„çš„æŸ¥è¯¢a.find( d =&gt; d.name === â€˜Wen-Yangâ€™)</p>
<p>â€¢æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆæ•°å€¼ï¼š+(â€˜3.14â€™)</p>
<p>â€¢D3.jsç»å¸¸è¯»å–CSVæ–‡ä»¶ï¼Œå±Šæ—¶ä¼šæ¶‰åŠå¤§é‡çš„æ•°ç»„ã€å¯¹è±¡çš„æ“ä½œï¼</p>
<h3 id="Flask-Whyï¼Ÿ"><a href="#Flask-Whyï¼Ÿ" class="headerlink" title="Flask - Whyï¼Ÿ"></a>Flask - Whyï¼Ÿ</h3><p>â€¢ä¸ºä»€ä¹ˆéœ€è¦ä¸€ä¸ªåå°ï¼ˆæœåŠ¡å™¨ï¼‰ï¼Ÿ</p>
<p>â€‹    â€¢CORS (Cross Origin Resource Sharing)</p>
<p>â€¢å¯å¦ç”¨ä¸€ä¸ªå®Œæ•´çš„.htmlæ–‡ä»¶ç¼–ç¨‹</p>
<p>â€‹    â€¢å®Œå…¨å¯ä»¥ï¼Œä½†æ•°æ®å¤„ç†ã€é“¾æ¥d3.jsåº“ã€é“¾æ¥.jsã€é“¾æ¥.cssæ–‡ä»¶ä¼šéå¸¸éº»çƒ¦ï¼</p>
<p>â€¢å¯¹äºæ²¡æœ‰WEBå¼€å‘ç»éªŒçš„åŒå­¦ï¼Œæœ¬è¯¾ç¨‹å¯¹D3.jså’Œå¯è§†åŒ–ä»¥å¤–çš„å·¥ç¨‹ä¸åšè¦æ±‚ï¼š</p>
<p>â€‹    â€¢æä¾›é»˜è®¤è°ƒé€šçš„å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¡†æ¶</p>
<p>â€‹    â€¢ä»…éœ€è¦äº†è§£åç»­çš„å†…å®¹ï¼Œå¯¹æœåŠ¡å™¨è¿›è¡Œé…ç½®å¹¶è¿è¡Œå³å¯</p>
<p>â€‹    â€¢æ¨èæœ‰webç»éªŒçš„åŒå­¦æ­å»ºè‡ªå·±ç†Ÿæ‚‰çš„ç¯å¢ƒ</p>
<p>åˆ©ç”¨æœåŠ¡å™¨æˆ‘ä»¬å¯ä»¥è®¾ç½®è·¯ç”±ï¼Œç„¶åå½“æˆ‘ä»¬è¾“å…¥é“¾æ¥ä¼šæ˜¾ç¤ºç›¸åº”htmlæ–‡ä»¶</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/9.png" style="zoom:80%;"></p>
<p>æˆ‘ä»¬éœ€è¦ä¸‹è½½ flask_cors æ¶‰åŠåˆ°è·¨åŸŸè®¿é—®çš„é—®é¢˜.å¯åŠ¨äº†è¿™ä¸ªflaskåï¼Œæˆ‘ä»¬è¾“å…¥ nCovnxtï¼Œæ˜¾ç¤ºäº†è¿™æ ·ä¸€ä¸ªD3</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/10.png" style="zoom:80%;"></p>
<p>æˆ‘ä»¬å¯ä»¥å¾ˆç®€å•çš„åœ¨Flaskä¸­ç”³è¯·ä¸€ä¸ªè·¯ç”±</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/stack_histogram')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stack_histogram</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> flask.send_from_directory(<span class="string">'static'</span>, <span class="string">'stack_histogram.html'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="Hello-D3"><a href="#Hello-D3" class="headerlink" title="Hello D3"></a>Hello D3</h2><h3 id="D3è·å–ä¿®æ”¹åˆ é™¤èŠ‚ç‚¹"><a href="#D3è·å–ä¿®æ”¹åˆ é™¤èŠ‚ç‚¹" class="headerlink" title="D3è·å–ä¿®æ”¹åˆ é™¤èŠ‚ç‚¹"></a>D3è·å–ä¿®æ”¹åˆ é™¤èŠ‚ç‚¹</h3><h4 id="D3æŸ¥è¯¢SVG"><a href="#D3æŸ¥è¯¢SVG" class="headerlink" title="D3æŸ¥è¯¢SVG"></a>D3æŸ¥è¯¢SVG</h4><p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/11.png" style="zoom: 67%;"></p>
<p>æ¯”å¦‚æˆ‘ä»¬æ–°å»ºäº†è¿™ä¸ªdemoï¼Œé‡Œé¢å„ä¸ªå›¾å½¢æœ‰ä»–çš„id</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/1.jpg" style="zoom: 67%;"></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/12.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/13.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/14.png" style="zoom: 67%;"></p>
<p>é™¤äº†åŸºäºå•çº¯çš„idå’Œclassæ¥è¿›è¡Œç´¢å¼•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å±‚çº§æŸ¥è¯¢æ¥è¿›è¡Œç´¢å¼•</p>
<p>æ¯”å¦‚ä¸‹é¢æœ‰ä¸€å †çˆ¶èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…ˆç”¨ <code>#maingroup</code>æ‰¾åˆ°çˆ¶èŠ‚ç‚¹ï¼Œç„¶åå†åœ¨é‡Œé¢æ‰¾åˆ°rectå­èŠ‚ç‚¹</p>
<p>æˆ–è€…æˆ‘æ‰¾åˆ°æ‰€æœ‰ class = â€œtickâ€ çš„çˆ¶èŠ‚ç‚¹ï¼Œç„¶åå»ä¸‹é¢æ‰¾textçš„å­èŠ‚ç‚¹</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/15.png" style="zoom: 80%;"></p>
<p>classç´¢å¼•æŸä¸ªå­é›†ï¼Œidç´¢å¼•æŸä¸ªç‰¹å®šçš„å…ƒç´ </p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/16.png" style="zoom: 80%;"></p>
<p>å…ƒç´ çš„ Class ï¼šäººä¸ºèµ‹äºˆçš„â€œç±»åˆ«â€å¯ä»¥æ ‡è®°å…ƒç´ é›†åˆï¼Œ å…¶ä¸­çš„å…ƒç´ æ ‡ç­¾å¯ä»¥ä¸ç›¸åŒ ï¼</p>
<p>æ¯”å¦‚æˆ‘å¯ä»¥åˆ©ç”¨class ç­›é€‰è¿™rect1ï¼Œrect2ï¼Œcircle1 è¿™ä¸‰ä¸ªå›¾å‹ï¼Œå› ä¸ºä»–ä»¬çš„classç›¸åŒ ï¼Œidå¯ä»¥ä¸åŒ</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/17.png" style="zoom: 80%;"></p>
<h4 id="ä½¿ç”¨D3-è®¾ç½®SVGä¸­çš„å±æ€§"><a href="#ä½¿ç”¨D3-è®¾ç½®SVGä¸­çš„å±æ€§" class="headerlink" title="ä½¿ç”¨D3 è®¾ç½®SVGä¸­çš„å±æ€§"></a>ä½¿ç”¨D3 è®¾ç½®SVGä¸­çš„å±æ€§</h4><p>å°½å¯èƒ½è®°ä½å¸¸ç”¨çš„å±æ€§</p>
<p>ç°æŸ¥ç°ç”¨ï¼<a href="https://developer.mozilla.org/zh-CN/docs/Web/SVG/Attribute" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/SVG/Attribute</a></p>
<p> <img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/18.png" style="zoom: 80%;"></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/19.png" style="zoom: 80%;"></p>
<p>æ¯”å¦‚æˆ‘ä»¬åœ¨chromeä¸­ä¿®æ”¹ä¸€ä¸ªæŸ±ä½“ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…ˆ é€‰æ‹©rect2ï¼Œç„¶ååˆ©ç”¨attræŠŠæŸ±ä½“çš„é¢œè‰²æ”¹æˆé»‘è‰²</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/20.png" style="zoom: 80%;"></p>
<p>åˆ©ç”¨selectAllæŠŠä¸€ä¸ªç±»ä¸­çš„æ‰€æœ‰å¯¹è±¡å…¨éƒ¨é€‰æ‹©ï¼Œç„¶åå¡«å……é»„è‰²</p>
<h5 id="transform"><a href="#transform" class="headerlink" title="transform"></a>transform</h5><p><strong>translate</strong></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/21.png" style="zoom: 80%;"></p>
<p><strong>rotate</strong></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/22.png" style="zoom: 80%;"></p>
<p><strong>scale</strong></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/23.png" style="zoom: 80%;"></p>
<h5 id="element-attr"><a href="#element-attr" class="headerlink" title="element.attr"></a>element.attr</h5><p>å‰é¢çš„å‚æ•°æ˜¯å›¾å…ƒçš„å±æ€§åç§°ï¼Œåé¢ä¸€ä¸ªæ˜¯è¦è®¾ç½®çš„å€¼</p>
<p> <img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/24.png" style="zoom: 80%;"></p>
<h5 id="æ´»ç”¨-èŠ‚ç‚¹"><a href="#æ´»ç”¨-èŠ‚ç‚¹" class="headerlink" title="æ´»ç”¨ \èŠ‚ç‚¹"></a>æ´»ç”¨ \<g\>èŠ‚ç‚¹</g\></h5><p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/25.png" style="zoom: 80%;"></p>
<p>å­èŠ‚ç‚¹çš„å±æ€§è®¾ç½®éƒ½æ˜¯åœ¨çˆ¶èŠ‚ç‚¹çš„åŸºç¡€ä¸Šè¿›è¡Œè®¾ç½®</p>
<h4 id="æ·»åŠ å’Œåˆ é™¤å…ƒç´ "><a href="#æ·»åŠ å’Œåˆ é™¤å…ƒç´ " class="headerlink" title="æ·»åŠ å’Œåˆ é™¤å…ƒç´ "></a>æ·»åŠ å’Œåˆ é™¤å…ƒç´ </h4><p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/26.png" style="zoom: 80%;"></p>
<p>appendåé¢å†™çš„æ˜¯æ·»åŠ ä»€ä¹ˆç±»å‹çš„å›¾å…ƒ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d3.select(<span class="string">'#maingroup'</span>).append(<span class="string">'rect'</span>).attr(<span class="string">'width'</span>,<span class="number">100</span>).attr(<span class="string">'height'</span>,<span class="number">100</span>);</span><br></pre></td></tr></table></figure>
<p>æˆ‘å¦‚æœæƒ³åˆ é™¤ä¸€ä¸ªå›¾å…ƒï¼Œé‚£ä¹ˆ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d3.select(<span class="string">'#rect1'</span>).remove();</span><br></pre></td></tr></table></figure>
<p>æ— è®ºæ˜¯æ·»åŠ æˆ–è¿˜æ˜¯åˆ é™¤ï¼Œéƒ½éœ€è¦å…ˆæŸ¥è¯¢ï¼Œå†åšæ“ä½œ</p>
<h3 id="margin"><a href="#margin" class="headerlink" title="margin"></a>margin</h3><p>é¦–å…ˆè¿˜è¦äº†è§£ä¸€ä¸‹<strong>margin</strong></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/31.png" style="zoom: 50%;"></p>
<p>marginå°±æ˜¯è¾¹æ¡†</p>
<p>SVGå¯¹äºD3.jsæ˜¯ä¸€ä¸ªâ€œç”»å¸ƒâ€ï¼ŒSVGèŒƒå›´å¤–çš„ä»»ä½•å†…å®¹å±äºç”»å¸ƒä¹‹å¤–ï¼Œæµè§ˆå™¨å°†ä¸äºˆæ˜¾ç¤º</p>
<p>å®šä¹‰Margin:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> margin = &#123;<span class="attr">top</span>: <span class="number">60</span>, <span class="attr">right</span>: <span class="number">30</span>, <span class="attr">bottom</span>: <span class="number">60</span>, <span class="attr">left</span>: <span class="number">200</span>&#125;</span><br></pre></td></tr></table></figure>
<p>è®¡ç®—å®é™…æ“ä½œçš„ inner é•¿/å®½</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> innerWidth = width - margin.left - margin.right;</span><br><span class="line"><span class="keyword">const</span> innerHeight = height - margin.top - margin.bottom;</span><br></pre></td></tr></table></figure>
<p>åœ¨SVGä¸‹é¢å¤–å®šä¹‰ä¸€ä¸ªç»„ä½œä¸ºæ–°çš„æ ¹èŠ‚ç‚¹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> g = svg.append(<span class="string">'g'</span>).attr(<span class="string">'id'</span>, <span class="string">'maingroup'</span>)</span><br><span class="line">attr(<span class="string">'transform'</span>, <span class="string">`translate(<span class="subst">$&#123;margin.left&#125;</span>, <span class="subst">$&#123;margin.top&#125;</span>)`</span>);</span><br></pre></td></tr></table></figure>
<h3 id="æ¯”ä¾‹å°º"><a href="#æ¯”ä¾‹å°º" class="headerlink" title="æ¯”ä¾‹å°º"></a>æ¯”ä¾‹å°º</h3><p>â€¢    æ¯”ä¾‹å°ºç”¨äºæŠŠå®é™…çš„æ•°æ®ç©ºé—´æ˜ å°„åˆ°å±å¹•çš„ç©ºé—´<br>â€¢    æ¯”ä¾‹å°ºéå¸¸é‡è¦ï¼Œä¼šç»å¸¸åŒæ—¶ä¼ ç»™åæ ‡è½´ä¸æ•°æ®</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/27.png" style="zoom: 50%;"></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/2.jpg" style="zoom: 50%;"></p>
<p>çº¿æ€§çš„æ¯”ä¾‹å°º</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> xScale = d3.scaleLinear()</span><br><span class="line"><span class="comment">//domainå°±æ˜¯åŸæ¯”ä¾‹</span></span><br><span class="line">				 .domain([min_d, max_d]).</span><br><span class="line"><span class="comment">//rangeå°±æ˜¯ç¼©æ”¾åçš„æ¯”ä¾‹å°º</span></span><br><span class="line"><span class="comment">//rangeå’Œdomainéƒ½å¿…é¡»ä¼ å…¥ä¸€ä¸ªæ•°ç»„</span></span><br><span class="line">				 .range([min, max]);</span><br><span class="line"><span class="keyword">const</span> xScale = d3.scaleLinear()</span><br><span class="line">				 .domain([<span class="number">0</span>, d3.max(data, datum=&gt;datum.value)])</span><br><span class="line">				 .range([<span class="number">0</span>, innerWidth]);</span><br></pre></td></tr></table></figure>
<p>d3.max(æ•°æ®ï¼Œå›è°ƒï¼šå¦‚ä½•æå–æ•°æ®çš„å€¼)<br>d3.max: æ±‚å‡ºæ•°æ®æŸä¸€å±æ€§çš„æœ€å¤§å€¼ï¼Œæ¯”å¦‚å¹´é¾„çš„æœ€å¤§å€¼</p>
<p> from Data Space to Screen Space</p>
<p>â€‹                               <img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/3.jpg" style="zoom: 50%;"><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/4.jpg" style="zoom: 50%;"></p>
<p>æŸ±çŠ¶çš„æ¯”ä¾‹å°º ï¼šå¯¹åº”ç¦»æ•£çš„å˜é‡</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/29.png" style="zoom: 90%;"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> yScale = d3.scaleBand() </span><br><span class="line">				 .domain(list)</span><br><span class="line">				 .range([min, max])</span><br><span class="line">				 .padding(p);</span><br><span class="line"><span class="keyword">const</span> yScale = d3.scaleBand()</span><br><span class="line">				 .domain(data.map(<span class="function"><span class="params">datum</span> =&gt;</span> datum.name)) </span><br><span class="line">				 .range([<span class="number">0</span>, innerHeight])</span><br><span class="line">			  	 .padding(<span class="number">0.1</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>é€šè¿‡d3.scaleLinearæˆ–d3.scaleBandå¾—åˆ°çš„è¿”å›å€¼æœ¬è´¨ä¸Šæ˜¯å‡½æ•°<ul>
<li>ç»™å‡ºæ•°æ®ä¸­çš„å€¼ï¼ˆdomain)</li>
<li>è¿”å›æ˜ å°„åçš„å€¼ï¼ˆrangeï¼‰</li>
<li>.domain(â€¦)å’Œ.range(â€¦)å¯ä»¥ç†è§£ä¸ºé…ç½®è¿™ä¸ªå‡½æ•°ï¼ˆåŠŸèƒ½ï¼‰çš„è¿‡ç¨‹</li>
</ul>
</li>
<li>æ¯”ä¾‹å°ºçš„å®šä¹‰ä»é€‚ç”¨é“¾å¼è°ƒç”¨</li>
<li>åæ ‡è½´å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ˜ å°„å‡½æ•°ï¼Œæˆ‘å¯ä»¥æŠŠæˆ‘domainä¸­çš„è¿ç»­çš„æˆ–è€…ç¦»æ•£çš„æ•°æ®æ˜ å°„åˆ°å›¾æ ‡å½“ä¸­</li>
</ul>
<h3 id="åæ ‡è½´"><a href="#åæ ‡è½´" class="headerlink" title="åæ ‡è½´"></a>åæ ‡è½´</h3><h4 id="å¼•å…¥åæ ‡è½´"><a href="#å¼•å…¥åæ ‡è½´" class="headerlink" title="å¼•å…¥åæ ‡è½´"></a>å¼•å…¥åæ ‡è½´</h4><ul>
<li>ä¸€ä¸ªåæ ‡è½´ä¸ºä¸€ä¸ªgroupï¼ˆ<code>&lt;g&gt;</code>ï¼‰ï¼Œé€šå¸¸æˆ‘ä»¬éœ€è¦ä¸¤ä¸ªåæ ‡è½´</li>
<li>åæ ‡è½´ä¸­åŒ…å«ï¼š<ul>
<li>ä¸€ä¸ª <code>&lt;path&gt;</code>ç”¨äºæ¨ªè·¨åæ ‡è½´çš„è¦†ç›–èŒƒå›´</li>
<li>è‹¥å¹²ä¸ªåˆ»åº¦<ul>
<li>æ¯ä¸ªåˆ»åº¦ä¹Ÿæ˜¯ä¸€ä¸ªgroup</li>
</ul>
</li>
<li>æ¯ä¸ªåˆ»åº¦ä¸‹å±è¿˜ä¼šåŒ…å«ä¸€ä¸ª<code>&lt;line&gt;</code> å’Œä¸€ä¸ª<code>&lt;text&gt;</code> <ul>
<li><code>&lt;line&gt;</code> ç”¨äºå±•ç¤ºåæ ‡è½´çš„è½´çº¿ï¼Œå¦‚å·¦åˆ°å³æˆ–ä¸Šåˆ°ä¸‹</li>
<li>â€‹    <code>&lt;text&gt;</code> ç”¨äºå±•ç¤ºåæ ‡è½´çš„åˆ»åº¦å€¼ï¼Œå¦‚å®æ•°ã€å§“åã€æ—¥æœŸ</li>
</ul>
</li>
<li>ï¼ˆå¯é€‰ï¼‰ä¸€ä¸ªæ ‡ç­¾ç”¨ä»¥æè¿°åæ ‡è½´</li>
</ul>
</li>
<li>å®šä¹‰åæ ‡è½´ï¼ˆè·å¾—ç»“æœæ˜¯å‡½æ•°ï¼‰ï¼š<br>â€¢    const yAxis = d3.axisLeft(yScale);<br>â€¢    const xAxis = d3.axisBottom(xScale);<br>â€¢    axisLeft: å·¦ä¾§åæ ‡è½´<br>â€¢    axisBotton: å³ä¾§åæ ‡è½´</li>
<li>å®é™…é…ç½®åæ ‡è½´ï¼š<br>â€¢    const yAxisGroup = g.append(â€˜gâ€™).call(yAxis);<br>â€¢    const xAxisGroup = g.append(â€˜gâ€™).call(xAxis)</li>
<li>å®é™…é…ç½®åä¼šå‘ç° <code>&lt;g&gt;</code>ä¸­å¢æ·»äº†ä¸åæ ‡è½´ç›¸å…³çš„å…ƒç´ </li>
<li>ä»»ä½•åæ ‡è½´åœ¨åˆå§‹åŒ–ä¹‹åä¼šé»˜è®¤æ”¾ç½®åœ¨åæ ‡åŸç‚¹ï¼Œéœ€è¦è¿›ä¸€æ­¥çš„å¹³ç§»</li>
<li><p>å…³äº selection.call(â€¦)</p>
<ul>
<li>å‡½æ•°çš„è¾“å…¥ä¸ºå¦ä¸€ä¸ªå‡½æ•°</li>
<li>å¦ä¸€ä¸ªå‡½æ•°ä»¥selectionçš„å›¾å…ƒä½œä¸ºè¾“å…¥</li>
<li>å¦ä¸€ä¸ªå‡½æ•°ä¸­ä¼šæ ¹æ®å‡½æ•°ä½“çš„å†…å®¹ä¿®æ”¹selectionå¯¹åº”çš„å›¾å…ƒ</li>
</ul>
</li>
<li>ä¸‹é¢çš„ä»£ç çš„æ„æ€å°±æ˜¯å‘Šè¯‰åæ ‡è½´ä»–è¯¥æ€ä¹ˆä½¿ç”¨è¿™ä¸ªè€Œæ¯”ä¾‹å°º<br>â€¢    const yAxis = d3.axisLeft(yScale);<br>â€¢    const yAxisGroup = g.append(â€˜gâ€™).call(yAxis);</li>
<li>â€‹    å¯¹å‡½æ•°å¼ç¼–ç¨‹æ•æ„Ÿæœ‰åŠ©äºå­¦ä¹ D3 &amp; ç†è§£D3çš„ä»£ç ï¼</li>
</ul>
<h4 id="é…ç½®åæ ‡è½´"><a href="#é…ç½®åæ ‡è½´" class="headerlink" title="é…ç½®åæ ‡è½´"></a>é…ç½®åæ ‡è½´</h4><ul>
<li>å¯ä»¥å¯¹åæ ‡è½´çš„é£æ ¼è¿›è¡Œä¿®æ”¹ï¼šd3.selectAll(â€˜.tick textâ€™).attr(â€˜font-sizeâ€™, â€˜2emâ€™);</li>
<li>.tickSizeæ¥è®¾ç½®ç½‘æ ¼çº¿</li>
<li>åæ ‡è½´çš„æ ‡ç­¾åŠ å…¥ä¸åœ¨D3æ¥å£çš„è´Ÿè´£èŒƒå›´å†…ï¼š<br>â€¢    é€šè¿‡å¯¹åº”ç»„ .append(â€˜textâ€™)æ¥äººä¸ºå®ç°<br>â€¢    ï¼ˆå·¦ï¼‰çºµè½´åæ ‡éœ€è¦ .attr(â€˜transformâ€™, â€˜rotate(-90)â€™) æ¥æ—‹è½¬<br>â€¢    çºµè½´åæ ‡æ—‹è½¬åï¼Œx / y ä¼šé¢ å€’ç”šè‡³å–å€¼èŒƒå›´ç›¸å<br>â€¢    å›å¿†DOMï¼šçˆ¶èŠ‚ç‚¹çš„å±æ€§ä¼šå½±å“å­èŠ‚ç‚¹ï¼Œè€Œåæ ‡è½´é»˜è®¤çš„â€™fillâ€™å±æ€§æ˜¯ â€˜noneâ€™ï¼Œå› æ­¤è¯·ä¸€å®šæ‰‹åŠ¨è®¾ç½®æ–‡å­—é¢œè‰² .attr(â€˜fillâ€™, â€˜blackâ€™)</li>
</ul>
<h2 id="Data-Join"><a href="#Data-Join" class="headerlink" title="Data-Join"></a>Data-Join</h2><p>æˆ‘ä»¬èƒ½ä¸èƒ½æŠŠæ·»åŠ å’Œä¿®æ”¹å›¾å…ƒè‡ªåŠ¨åŒ–ï¼Ÿ</p>
<ul>
<li>Data-Join çš„æœ¬è´¨ä¸Š æ˜¯å°†æ•°æ®ä¸å›¾å…ƒè¿›è¡Œç»‘å®š<ul>
<li>æ¯ä¸ªå›½å®¶çš„äººæ•°ç»‘å®šåˆ°çŸ©å½¢çš„é•¿åº¦</li>
<li>ç–«æƒ…æ„ŸæŸ“çš„äººæ•°æ¯”ä¾‹ç»‘å®šåˆ°åœ†çš„åŠå¾„</li>
</ul>
</li>
<li><p>Why?</p>
<ul>
<li>ä½¿ç”¨Data-Joinå¯ä»¥çœå»å¤§é‡æ ¹æ®æ•°æ®è®¾ç½®å›¾å…ƒå±æ€§çš„ä»£ç é‡</li>
<li>å¯¹äº<strong>åŠ¨æ€å˜åŒ–çš„æ•°æ®</strong>æä¾›ç»Ÿä¸€æ¥å£</li>
</ul>
</li>
<li><p>ä»¥æ•°æ®ä¸ºä¸­å¿ƒçš„å¯è§†åŒ–æ“ä½œ<br>â€¢    æ ¹æ®æ•°æ®çš„æ¯ä¸ªå±æ€§è‡ªåŠ¨è°ƒæ•´ç»‘å®šå›¾å…ƒçš„å±æ€§</p>
</li>
<li>ä¸å†éœ€è¦æ‰‹åŠ¨æ·»åŠ ã€â€˜ä¿®æ”¹â€™ã€åˆ é™¤å›¾å…ƒ<br>â€¢    ä¼šæ ¹æ®Data-Joinçš„ç»‘å®šè‡ªåŠ¨æ¨æ–­</li>
<li>å¦‚æœå›¾å…ƒçš„æ•°ç›®ä¸ç­‰äºæ•°æ®çš„æ¡ç›®ï¼Ÿ<br>â€¢    æ ¹æ®æ•°æ®æ¡ç›®çš„æ•°é‡é€‰å®šç›¸åº”æ•°é‡çš„å›¾å…ƒ</li>
</ul>
<h3 id="ç”¨å‡½æ•°è®¾ç½®å›¾å…ƒå±æ€§"><a href="#ç”¨å‡½æ•°è®¾ç½®å›¾å…ƒå±æ€§" class="headerlink" title="ç”¨å‡½æ•°è®¾ç½®å›¾å…ƒå±æ€§"></a>ç”¨å‡½æ•°è®¾ç½®å›¾å…ƒå±æ€§</h3><ul>
<li>å›å¿†ä½¿ç”¨.attrè®¾ç½®å›¾å…ƒå±æ€§</li>
<li>selection.attr(â€˜attrbuteNameâ€™, â€˜valueâ€™)<br>â€¢    æ”¯æŒç›´æ¥é€šè¿‡å€¼æ¥è®¾ç½®å±æ€§<br>â€¢    æ”¯æŒé€šè¿‡å‡½æ•°æ¥è®¾ç½®å±æ€§</li>
<li>selection.attr(â€˜attrbuteNameâ€™, (d, i) =&gt; {â€¦})<br>â€¢    dä¸ºç»‘å®šç»™å›¾å…ƒçš„æ•°æ®ï¼ˆå³å°†åˆ°æ¥ï¼‰<br>â€¢    iä¸ºå›¾å…ƒçš„ç´¢å¼•ï¼Œæ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå¦‚d3.selectAll(â€˜rectâ€™)ä¸­çš„ç¬¬å‡ ä¸ªçŸ©å½¢<br>â€¢    å‡½æ•°ä¹Ÿå¯ä»¥ä»…ä½¿ç”¨ d =&gt; {â€¦}ï¼Œä½†æ­¤æ—¶å‡½æ•°ä½“æ— æ³•ä½¿ç”¨ç´¢å¼•<br>â€¢    å³ä½¿ä¸ä½¿ç”¨ç»‘å®šçš„æ•°æ®ï¼ˆå¦‚æ²¡æœ‰ç»‘å®šæ•°æ®ï¼‰ï¼Œå¦‚éœ€ä½¿ç”¨ç´¢å¼•ï¼Œä»éœ€è¦å®Œæ•´çš„å†™å‡º (d, i) =&gt; {â€¦}</li>
</ul>
<h3 id="æ•°æ®ä¸å›¾å…ƒçš„ç»‘å®š"><a href="#æ•°æ®ä¸å›¾å…ƒçš„ç»‘å®š" class="headerlink" title="æ•°æ®ä¸å›¾å…ƒçš„ç»‘å®š"></a>æ•°æ®ä¸å›¾å…ƒçš„ç»‘å®š</h3><ul>
<li>.data( dataArray )</li>
<li>dataArrayåœ¨ä¿è¯æ˜¯ä¸€ä¸ªæ•°ç»„çš„å‰æä¸‹å¯ä»¥æ˜¯ä»»ä½•å½¢å¼<br>â€¢    e.g., [0, 2, 5, 6, 233, 666, 384, 32, 18]<br>â€¢    e.g., [{name: â€˜Sebastianâ€™, value:384}, {name:â€™ Cielâ€™, value:32},{name:â€™Cai Yunâ€™, value:16}]</li>
<li>å…ˆè€ƒè™‘æ•°æ®å’Œå›¾å…ƒæ•°ç›®ç›¸åŒçš„æƒ…å†µï¼š<br>â€¢    dataArrayæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­çš„æ¯â€˜æ¡â€™æ•°æ®ä¼šä¸ä¸€ä¸ªå›¾å…ƒç»‘å®šï¼ˆåä¹‹äº¦ç„¶ï¼‰</li>
<li>ç»‘å®šç»™æ¯ä¸ªå›¾å…ƒçš„æ•°æ®å°†å¯¹åº” .attr(, (d, i) =&gt; {â€¦}) ä¸­çš„ d</li>
<li>é»˜è®¤çš„ç»‘å®šæŒ‰ç…§åŒæ–¹çš„ç´¢å¼•é¡ºåº</li>
<li>ä¸è°ƒç”¨.data(â€¦)ï¼Œåˆ™å›¾å…ƒä¸ä¼šä¸ä»»ä½•æ•°æ®ç»‘å®šï¼</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">      <span class="keyword">const</span> data = [&#123;<span class="attr">name</span>: <span class="string">'Shao-Kui'</span>, <span class="attr">value</span>:<span class="number">6</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Wen-Yang'</span>, <span class="attr">value</span>:<span class="number">6</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Cai Yun'</span>, <span class="attr">value</span>:<span class="number">16</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Liang Yuan'</span>, <span class="attr">value</span>: <span class="number">10</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Yuan-Chen'</span>, <span class="attr">value</span>:<span class="number">6</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Rui-Long'</span>, <span class="attr">value</span>:<span class="number">10</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Dong Xin'</span>, <span class="attr">value</span>:<span class="number">12</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'He Yu'</span>, <span class="attr">value</span>:<span class="number">20</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Xiang-Li'</span>, <span class="attr">value</span>:<span class="number">12</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Godness'</span>, <span class="attr">value</span>:<span class="number">20</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Wei-Yu'</span>, <span class="attr">value</span>:<span class="number">15</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Chen Zheng'</span>, <span class="attr">value</span>:<span class="number">14</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Yu Peng'</span>, <span class="attr">value</span>:<span class="number">15</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Li Jian'</span>, <span class="attr">value</span>:<span class="number">18</span>&#125;]; </span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data1 = [&#123;<span class="attr">name</span>: <span class="string">'Shao-Kui'</span>, <span class="attr">value</span>:<span class="number">12</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Wen-Yang'</span>, <span class="attr">value</span>:<span class="number">13</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Cai Yun'</span>, <span class="attr">value</span>:<span class="number">16</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Liang Yuan'</span>, <span class="attr">value</span>: <span class="number">10</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Yuan-Chen'</span>, <span class="attr">value</span>:<span class="number">6</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Rui-Long'</span>, <span class="attr">value</span>:<span class="number">10</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Dong Xin'</span>, <span class="attr">value</span>:<span class="number">12</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'He Yu'</span>, <span class="attr">value</span>:<span class="number">20</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Xiang-Li'</span>, <span class="attr">value</span>:<span class="number">12</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Godness'</span>, <span class="attr">value</span>:<span class="number">20</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Wei-Yu'</span>, <span class="attr">value</span>:<span class="number">15</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Chen Zheng'</span>, <span class="attr">value</span>:<span class="number">14</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Yu Peng'</span>, <span class="attr">value</span>:<span class="number">15</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Li Jian'</span>, <span class="attr">value</span>:<span class="number">18</span>&#125;]; </span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> data2 = [&#123;<span class="attr">name</span>: <span class="string">'Wen-Yang'</span>, <span class="attr">value</span>:<span class="number">15</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Shao-Kui'</span>, <span class="attr">value</span>:<span class="number">20</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Cai Yun'</span>, <span class="attr">value</span>:<span class="number">16</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Yuan-Chen'</span>, <span class="attr">value</span>: <span class="number">10</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Liang Yuan'</span>, <span class="attr">value</span>:<span class="number">6</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Rui-Long'</span>, <span class="attr">value</span>:<span class="number">10</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Dong Xin'</span>, <span class="attr">value</span>:<span class="number">12</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'He Yu'</span>, <span class="attr">value</span>:<span class="number">20</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Xiang-Li'</span>, <span class="attr">value</span>:<span class="number">12</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Godness'</span>, <span class="attr">value</span>:<span class="number">20</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Wei-Yu'</span>, <span class="attr">value</span>:<span class="number">15</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Chen Zheng'</span>, <span class="attr">value</span>:<span class="number">14</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Yu Peng'</span>, <span class="attr">value</span>:<span class="number">15</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Li Jian'</span>, <span class="attr">value</span>:<span class="number">18</span>&#125;];</span><br></pre></td></tr></table></figure>
<p>å¦‚ä¸Šé¢æˆ‘å®šä¹‰äº†data1ï¼Œdata2ï¼Œæˆ‘å¦‚æœæƒ³æŠŠdata1ä¸­çš„æ•°æ®æ¸²æŸ“åœ¨å›¾è¡¨ä¸Šå»æ›¿æ¢dataä¸­çš„æ•°æ®</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">'rect'</span>).data(data1).attr(<span class="string">'width'</span>,d=&gt; xScale(d.value));</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯æˆ‘å¦‚æœè¿™æ ·æ¥æ”¹ï¼Œå°±ä¼šå‡ºç°é—®é¢˜äº†ã€‚å› ä¸ºé»˜è®¤çš„dataå‡½æ•°æ ¹æ®indexæ¥ç´¢å¼•çš„ï¼Œå¦‚æœæˆ‘ç»™å‡ºçš„æ•°æ®çš„é¡ºåºå‘ç”Ÿäº†å˜åŒ–ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä»ç¬¬ä¸€ä¸ªåˆ°æœ€åä¸€ä¸ªå»ç´¢å¼•</p>
<p>é‚£ä¹ˆè¿™æ ·data2ä¸­Wen-Yangçš„æ•°æ®å°±ä¼šç»‘å®šåˆ°Shao-Kuiä¸Šå»ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">'rect'</span>).data(data1).attr(<span class="string">'width'</span>,d=&gt; xScale(d.value));</span><br></pre></td></tr></table></figure>
<h3 id="Key"><a href="#Key" class="headerlink" title="Key"></a>Key</h3><ul>
<li>.data(data, keyFunction)<br>â€¢    keyFunctionçš„è¿”å›å€¼é€šå¸¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆstringï¼‰<br>â€¢    keyFunctionçš„å®šä¹‰æ ¹æ®æ•°æ®ï¼Œæ¯”å¦‚ keyFunction = d =&gt; d.name</li>
<li>åœ¨ç»‘å®šæ•°æ®ç»™å›¾å…ƒæ—¶ï¼š<br>â€¢    keyFunctionä¸ºæ¯æ¡è¾“å…¥ç»‘å®šçš„æ•°æ®æ‰§è¡Œä¸€æ¬¡<br>â€¢    keyFunctionä¸ºæ¯ä¸ªåŒ…å«æ•°æ®çš„å›¾å…ƒæ‰§è¡Œä¸€æ¬¡</li>
<li>å¦‚æœå›¾å…ƒä¹‹å‰æ²¡æœ‰ç»‘å®šè¿‡ä»»ä½•æ•°æ®ï¼Œåˆ™keyFunctionä¼šæŠ¥é”™ï¼<br>â€¢    ç¬¬ä¸€æ¬¡ç»‘å®šæ—¶æ ¹æ®ç´¢å¼•å³å¯<br>â€¢    å®é™…çš„å¯è§†åŒ–ä»»åŠ¡ï¼Œå›¾å…ƒéƒ½æ˜¯æ ¹æ®æ•°æ®çš„â€˜æ¡â€™æ•°åŠ¨æ€æ·»åŠ ï¼ˆenterï¼‰ã€åˆ é™¤ï¼ˆexitï¼‰ï¼Œåªéœ€è¦åœ¨æ·»åŠ æ—¶æŒ‡å®šå¥½DOMçš„IDå³å¯</li>
</ul>
<p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨çš„æŠŠkeyå€¼åŠ åˆ°æ•°æ®ä¸­å»ã€‚</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/32.png" style="zoom: 100%;"></p>
<p>è¿™é‡Œï¼Œå› ä¸ºæ•°æ®ä¸­çš„nameéƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠnameè®¾ç½®ä¸ºkey :data(data2,d=&gt;d.name)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">'rect'</span>).data(data2,d=&gt;d.name).attr(<span class="string">'width'</span>,d=&gt; xScale(d.value));</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨çš„å€¼å°±å˜å¾—æ­£å¸¸äº†ã€‚</p>
<p>ä¹Ÿå°±æ˜¯ç”¨dataæ¥ç»‘å®šæ•°æ®ï¼Œç”¨keyæ¥è¿›è¡Œç´¢å¼•</p>
<h3 id="Enter-Update-Exit"><a href="#Enter-Update-Exit" class="headerlink" title="Enter Update Exit"></a>Enter Update Exit</h3><ul>
<li>D3.jsç»‘å®šæ•°æ®çš„ä¸‰ä¸ªâ€˜çŠ¶æ€â€™</li>
<li>Update<br>â€¢    å›¾å…ƒå’Œæ•°æ®æ¡ç›®ç›¸åŒï¼Œä¹‹å‰çš„ä»‹ç»å‡ä¸ºå•çº¯çš„update</li>
<li>Enter<br>â€¢    æ•°æ®çš„æ¡ç›®å¤šäºå›¾å…ƒç”šè‡³æ²¡æœ‰å›¾å…ƒï¼Œå¸¸ç”¨äºç¬¬ä¸€æ¬¡ç»‘å®šæ•°æ®</li>
<li>Exit<br>â€¢    æ•°æ®çš„æ¡ç›®å°‘äºå›¾å…ƒç”šè‡³æ²¡æœ‰æ•°æ®ï¼Œå¸¸ç”¨äºç»“æŸå¯è§†åŒ–</li>
</ul>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/33.png" style="zoom: 100%;"></p>
<h4 id="Enter"><a href="#Enter" class="headerlink" title="Enter"></a>Enter</h4><ul>
<li>æœ‰æ•°æ®æ²¡å›¾å…ƒ</li>
<li>D3.jsä¼šè‡ªåŠ¨â€˜ææ¸…æ¥šâ€™å“ªäº›æ•°æ®æ˜¯æ–°å¢çš„</li>
<li>æ ¹æ®æ–°å¢çš„æ•°æ®ç”Ÿæˆç›¸åº”çš„å›¾å…ƒ</li>
<li>ç”Ÿæˆå›¾å…ƒçš„å ä½ï¼Œå ä½çš„å†…å®¹éœ€è¦ç¼–ç¨‹è€…è‡ªè¡Œæ·»åŠ ï¼ˆappendï¼‰</li>
<li>const p = maingroup.selectAll(â€˜.classâ€™).data(data).enter().append(â€˜â€™).attr(â€¦)<ul>
<li>ç›¸å½“äºæˆ‘è°ƒç”¨dataçš„æ—¶å€™ï¼ŒselectAllä¸­çš„å†…å®¹éƒ½æ˜¯ç©ºçš„ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥å‘é‡Œé¢æ·»åŠ ä»€ä¹ˆæ ·çš„å›¾å…ƒï¼Œè®¾ç½®ä»€ä¹ˆæ ·çš„å±æ€§</li>
</ul>
</li>
<li>enteræœ¬è´¨ä¸Šç”ŸæˆæŒ‡å‘çˆ¶èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œè€Œappendæ“ä½œç›¸å½“äºåœ¨çˆ¶èŠ‚ç‚¹åæ·»åŠ æŒ‡é’ˆæ•°é‡çš„å›¾å…ƒå¹¶å°†å…¶ä¸å¤šå‡ºçš„æ•°æ®ç»‘å®š</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">g.selectAll(<span class="string">'.dataRect'</span>).data(data).enter().append(<span class="string">'rect'</span>)</span><br><span class="line">.attr(<span class="string">'class'</span>, <span class="string">'dataRect'</span>)</span><br><span class="line">.attr(<span class="string">'width'</span>, d =&gt; xScale(d.value))</span><br><span class="line">.attr(<span class="string">'height'</span>, yScale.bandwidth())</span><br><span class="line">.attr(<span class="string">'y'</span>, d =&gt; yScale(d.name))</span><br><span class="line">.attr(<span class="string">'fill'</span>, <span class="string">'green'</span>).attr(<span class="string">'opacity</span></span><br></pre></td></tr></table></figure>
<h4 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h4><ul>
<li>æœ‰å›¾å…ƒæœ‰æ•°æ®</li>
<li>const p = maingroup.selectAll(â€˜.datacurveâ€™).data(data).attr(â€¦).attr(â€¦)</li>
<li>Updateä½œä¸ºå®é™…å¯è§†åŒ–ä»»åŠ¡æœ€å¸¸ç”¨çš„çŠ¶æ€ï¼Œç»å¸¸è¢«å•ç‹¬å°è£…æˆä¸€ä¸ªå‡½æ•°</li>
<li>updateSelection.merge( enterSelection ).attr(â€¦).attr(â€¦)<br>â€¢    å°†ä¸¤ä¸ªselectionåˆå¹¶åˆ°ä¸€èµ·æ“ä½œ<br>â€¢    enterSelectionéœ€è¦è‡³å°‘append(â€¦)å›¾å…ƒ</li>
</ul>
<h4 id="Exit"><a href="#Exit" class="headerlink" title="Exit"></a>Exit</h4><ul>
<li>æœ‰å›¾å…ƒæ²¡æ•°æ®<br>D3.jsä¼šè‡ªåŠ¨â€˜ææ¸…æ¥šâ€™å“ªäº›å›¾å…ƒæ˜¯ä¸ç»‘å®šæ•°æ®çš„</li>
<li>å¼•ç”¨å®˜æ–¹æ–‡æ¡£ï¼šexisting DOM elements in the selection for which no new datum was found</li>
<li>const p = maingroup.selectAll(â€˜.classâ€™).data(data).exit().remove()</li>
</ul>
<h3 id="Animation"><a href="#Animation" class="headerlink" title="Animation"></a>Animation</h3><ul>
<li>Updateç»å¸¸ä¸D3.jsçš„åŠ¨ç”»ä¸€èµ·ä½¿ç”¨</li>
<li>.transition().duration()<ul>
<li>transitionå°±æ˜¯è¯´è¿›å…¥åŠ¨ç”»æ¨¡å¼ï¼Œ duration()æ˜¯è®¾ç½®åŠ¨ç”»æŒç»­æ—¶é—´</li>
</ul>
</li>
<li>d3.selectAll(â€˜rectâ€™).data(data2, d =&gt; d.name).transition().duration(3000).attr(â€˜widthâ€™, d =&gt; xScale(d.value))</li>
<li>.duration(â€¦)ä¸­ä¸ºæ¯«ç§’ï¼Œå³3000è¡¨ç¤º3ç§’é’Ÿ</li>
<li>.transition(â€¦)ç»è¿‡è°ƒç”¨åï¼Œåç»­çš„é“¾å¼è°ƒç”¨ä¼šå˜æˆæ•°å€¼ä¸Šçš„æ¸å˜ï¼Œæ¸å˜çš„æ—¶é—´ç”±.duration(â€¦)è®¾å®š</li>
<li>æ’å€¼çš„æ–¹å¼ç”±.ease(â€¦)è®¾å®š</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">'rect'</span>).data(data).transition().duration(<span class="number">1000</span>).attr(<span class="string">'width'</span>,d=&gt;xScale(d.value));</span><br><span class="line">d3.selectAll(<span class="string">'rect'</span>).data(data1).transition().duration(<span class="number">1000</span>).attr(<span class="string">'width'</span>,d=&gt;xScale(d.value));</span><br><span class="line">d3.selectAll(<span class="string">'rect'</span>).data(data2,d=&gt;d.name).transition().duration(<span class="number">1000</span>).attr(<span class="string">'width'</span>,d=&gt;xScale(d.value));</span><br></pre></td></tr></table></figure>
<p>ç»“æœå¦‚ä¸‹</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/1.gif" style="zoom: 130%;"></p>
<h3 id="Data-Joinç®€æ´å½¢å¼"><a href="#Data-Joinç®€æ´å½¢å¼" class="headerlink" title="Data-Joinç®€æ´å½¢å¼"></a>Data-Joinç®€æ´å½¢å¼</h3><ul>
<li>data(â€¦).join(â€˜â€¦â€™)</li>
<li>é»˜è®¤enterå’Œupdateçš„æ‰§è¡Œå½¢å¼ç›¸åŒ</li>
<li>é»˜è®¤exitæ˜¯åˆ é™¤ï¼ˆremoveï¼‰èŠ‚ç‚¹</li>
<li>é»˜è®¤data-joinå½¢å¼ç®€æ´ä½†ä¸çµæ´»<br>â€¢    å¿…é¡»éœ€è¦è®¾ç½®enteræ•°æ®çš„åˆå§‹å›¾å…ƒå±æ€§ï¼Œupdateä¼šæ¯æ¬¡é‡æ–°è®¾ç½®åˆå§‹å€¼ï¼Œä»è€Œå¯¼è‡´åŠ¨ç”»å‡ºç°â€˜å¥‡æ€ªâ€™çš„æ•ˆæœ<br>â€¢    ä»æ”¯æŒâ€˜å®šåˆ¶â€™ï¼š<br>â€¢    .join(enter =&gt; enter.append(â€œtextâ€).attr(â€œfillâ€, â€œgreenâ€).text(d =&gt; d),update =&gt; (), exit =&gt; ())</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">'rect'</span>).data(data).transition().duration(<span class="number">1000</span>).attr(<span class="string">'width'</span>,d=&gt;xScale(d.value));</span><br><span class="line">d3.selectAll(<span class="string">'rect'</span>).data(data1).join(<span class="string">'rect'</span>).transition().duration(<span class="number">1000</span>).attr(<span class="string">'width'</span>,d=&gt;xScale(d.value));</span><br></pre></td></tr></table></figure>
<h3 id="æ•°æ®çš„è¯»å–"><a href="#æ•°æ®çš„è¯»å–" class="headerlink" title="æ•°æ®çš„è¯»å–"></a>æ•°æ®çš„è¯»å–</h3><p>å¸¸è§çš„CSVæ•°æ®</p>
<ul>
<li>ç¬¬ä¸€è¡Œä¸ºå±æ€§åˆ—è¡¨</li>
<li>åç»­æ¯è¡Œå¯¹åº”ä¸€â€˜æ¡â€™æ•°æ®</li>
<li>CSVæœ¬è´¨ä¸Šæ˜¯çº¯æ–‡æœ¬ï¼ŒåŒºåˆ«äºEXCELçš„æ ¼å¼</li>
</ul>
<p>è¯»å–</p>
<ul>
<li>d3.csv(â€˜path/to/data.csvâ€™).then( data =&gt; {â€¦} ) å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†</li>
<li>.csvå‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªJSçš„â€™Promiseâ€™å¯¹è±¡<br>â€¢    â€˜Promiseâ€™å¯¹è±¡ç”¨äºæ‰§è¡Œå¼‚æ­¥æ“ä½œ</li>
<li>â€‹    .then(â€¦)çš„å‚æ•°ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå‚æ•°ä¸º.csv(â€¦)çš„è¿”å›å€¼<br>â€¢     å®é™…ä¸Šåœ¨JavaScriptå¼‚æ­¥ä¸­æ˜¯ä¸€ä¸ªresolve</li>
<li>d3.csv(â€¦)ä¼šæ­£å¸¸å‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®ï¼Œåœ¨è¯·æ±‚å¹¶å¤„ç†å¥½ä¹‹åï¼Œå°†ç»“æœæ‰”ç»™.then(â€¦)ä¸­çš„å›è°ƒå‡½æ•°</li>
</ul>
<h3 id="å®ä¾‹ï¼šç»˜åˆ¶ç¬‘è„¸"><a href="#å®ä¾‹ï¼šç»˜åˆ¶ç¬‘è„¸" class="headerlink" title="å®ä¾‹ï¼šç»˜åˆ¶ç¬‘è„¸"></a>å®ä¾‹ï¼šç»˜åˆ¶ç¬‘è„¸</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;select,arc&#125; <span class="keyword">from</span> <span class="string">'d3'</span>;</span><br><span class="line"><span class="keyword">const</span> svg = select(<span class="string">'svg'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> width = +svg.attr(<span class="string">'width'</span>);</span><br><span class="line"><span class="keyword">const</span> height = +svg.attr(<span class="string">'height'</span>);</span><br><span class="line"><span class="keyword">const</span> g = svg</span><br><span class="line">		.append(<span class="string">'g'</span>)</span><br><span class="line">			.attr(<span class="string">'transform'</span>,<span class="string">`translate(<span class="subst">$&#123;width<span class="regexp">/2&#125;,$&#123;height/</span><span class="number">2</span>&#125;</span>)`</span>)</span><br><span class="line"><span class="keyword">const</span> circle =  g</span><br><span class="line">		.append(<span class="string">'circle'</span>)</span><br><span class="line">			.attr(<span class="string">'r'</span>,height/<span class="number">2</span>)</span><br><span class="line">			.attr(<span class="string">'fill'</span>,<span class="string">'yellow'</span>)</span><br><span class="line">			.attr(<span class="string">'stroke'</span>,<span class="string">'black'</span>)</span><br><span class="line"><span class="keyword">const</span> eyeSpacing = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">const</span> eyeYOffset = <span class="number">-70</span>;</span><br><span class="line"><span class="keyword">const</span> eyeRadius = <span class="number">40</span>;</span><br><span class="line"><span class="keyword">const</span> eyebrowWidth = <span class="number">70</span>;</span><br><span class="line"><span class="keyword">const</span> eyebrowHeight =<span class="number">15</span>;</span><br><span class="line"><span class="keyword">const</span> eyebrowYOffset = <span class="number">-70</span>;</span><br><span class="line"><span class="comment">//çœ¼ç›ç»„</span></span><br><span class="line"><span class="keyword">const</span> eyesG = g</span><br><span class="line">		.append(<span class="string">'g'</span>)</span><br><span class="line">			.attr(<span class="string">'transform'</span>,<span class="string">`translate(0,<span class="subst">$&#123;eyeYOffset&#125;</span>)`</span>);</span><br><span class="line"><span class="keyword">const</span> leftEye =  eyesG</span><br><span class="line">		.append(<span class="string">'circle'</span>)</span><br><span class="line">			.attr(<span class="string">'r'</span>,eyeRadius)</span><br><span class="line">			.attr(<span class="string">'cx'</span>, -eyeSpacing)</span><br><span class="line"><span class="keyword">const</span> rightEye =  eyesG</span><br><span class="line">		.append(<span class="string">'circle'</span>)</span><br><span class="line">			.attr(<span class="string">'r'</span>,eyeRadius)</span><br><span class="line">			.attr(<span class="string">'cx'</span>, eyeSpacing)</span><br><span class="line"><span class="comment">//çœ‰æ¯›ç»„ï¼Œæˆ‘è§‰å¾—å¯ä»¥è¯´æ˜¯ä»çœ¼ç›ç»„ä¸­ç»§æ‰¿è¿‡æ¥çš„ã€‚</span></span><br><span class="line"><span class="keyword">const</span> eyebrowsG = eyesG</span><br><span class="line">		.append(<span class="string">'g'</span>)</span><br><span class="line">			.attr(<span class="string">'transform'</span>,<span class="string">`translate(0,<span class="subst">$&#123;eyeYOffset&#125;</span>)`</span>);</span><br><span class="line">eyebrowsG</span><br><span class="line">  .transition().duration(<span class="number">2000</span>)</span><br><span class="line">		.attr(<span class="string">'transform'</span>,<span class="string">`translate(0,<span class="subst">$&#123;eyebrowYOffset<span class="number">-50</span>&#125;</span>)`</span>)</span><br><span class="line">	.transition().duration(<span class="number">2000</span>)</span><br><span class="line">		.attr(<span class="string">'transform'</span>,<span class="string">`translate(0,<span class="subst">$&#123;eyebrowYOffset&#125;</span>)`</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å·¦å³çœ‰æ¯›</span></span><br><span class="line"><span class="keyword">const</span> leftEyebrow = eyebrowsG</span><br><span class="line">  .append(<span class="string">'rect'</span>)</span><br><span class="line">    .attr(<span class="string">'x'</span>, -eyeSpacing - eyebrowWidth / <span class="number">2</span>)</span><br><span class="line">    .attr(<span class="string">'width'</span>, eyebrowWidth)</span><br><span class="line">    .attr(<span class="string">'height'</span>, eyebrowHeight);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rightEyebrow = eyebrowsG</span><br><span class="line">  .append(<span class="string">'rect'</span>)</span><br><span class="line">    .attr(<span class="string">'x'</span>, eyeSpacing - eyebrowWidth / <span class="number">2</span>)</span><br><span class="line">    .attr(<span class="string">'width'</span>, eyebrowWidth)</span><br><span class="line">    .attr(<span class="string">'height'</span>, eyebrowHeight); </span><br><span class="line"></span><br><span class="line"><span class="comment">//å˜´å·´ï¼Œåˆ©ç”¨arcï¼Œæ˜¯åˆ¶ä½œå¼§çš„ä¸€ä¸ªapi			</span></span><br><span class="line"><span class="keyword">const</span> mounth = g</span><br><span class="line">	.append(<span class="string">'path'</span>)</span><br><span class="line">		.attr(<span class="string">'d'</span>,arc()(&#123;</span><br><span class="line">						innerRadius: <span class="number">150</span>,</span><br><span class="line">  					outerRadius: <span class="number">170</span>,</span><br><span class="line">  					startAngle: <span class="built_in">Math</span>.PI/<span class="number">2</span>,</span><br><span class="line">  					endAngle: <span class="built_in">Math</span>.PI*<span class="number">1.5</span> ,</span><br><span class="line">      &#125;))</span><br></pre></td></tr></table></figure>
<p> <img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/2.gif" style="zoom: 70%;"></p>
<h3 id="å®ä¾‹ï¼š-ç»˜åˆ¶æŸ±çŠ¶å›¾"><a href="#å®ä¾‹ï¼š-ç»˜åˆ¶æŸ±çŠ¶å›¾" class="headerlink" title="å®ä¾‹ï¼š ç»˜åˆ¶æŸ±çŠ¶å›¾"></a>å®ä¾‹ï¼š ç»˜åˆ¶æŸ±çŠ¶å›¾</h3><p>ç”»å¤„æŸ±å½¢å›¾éœ€è¦éµå¾ªäº”ä¸ªæ­¥éª¤</p>
<ul>
<li>Representing a data dable in JavaScript</li>
</ul>
<p>data.css</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; select, csv, max, scaleLinear, scaleBand &#125; <span class="keyword">from</span> <span class="string">"d3"</span>;</span><br><span class="line"><span class="keyword">const</span> svg = select(<span class="string">"svg"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> width = +svg.attr(<span class="string">"width"</span>);</span><br><span class="line"><span class="keyword">const</span> height = +svg.attr(<span class="string">"height"</span>);</span><br><span class="line">csv(<span class="string">"data.csv"</span>).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  data.forEach(<span class="function">(<span class="params">d</span>) =&gt;</span> &#123;</span><br><span class="line">    d.population = +d.population * <span class="number">1000</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  render(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>Creating rectangles for each row</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">const</span> render = <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> xValue = <span class="function">(<span class="params">d</span>) =&gt;</span> d.population;</span><br><span class="line">  <span class="keyword">const</span> yValue = <span class="function">(<span class="params">d</span>) =&gt;</span> d.country;</span><br><span class="line">  svg</span><br><span class="line">    .selectAll(<span class="string">"rect"</span>)</span><br><span class="line">    .data(data)</span><br><span class="line">    .enter()</span><br><span class="line">    .append(<span class="string">"rect"</span>)</span><br><span class="line">    .attr(<span class="string">"y"</span>, (d) =&gt; yScale(yValue(d)))</span><br><span class="line">    .attr(<span class="string">"width"</span>, (d) =&gt; xScale(xValue(d)))</span><br><span class="line">    .attr(<span class="string">"height"</span>, yScale.bandwidth());</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Using linear and band scales</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">const</span> render = <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> xValue = <span class="function">(<span class="params">d</span>) =&gt;</span> d.population;</span><br><span class="line">  <span class="keyword">const</span> yValue = <span class="function">(<span class="params">d</span>) =&gt;</span> d.country;</span><br><span class="line">  <span class="keyword">const</span> xScale = scaleLinear()</span><br><span class="line">    .domain([<span class="number">0</span>, max(data, xValue)])</span><br><span class="line">    .range([<span class="number">0</span>, width]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> yScale = scaleBand()</span><br><span class="line">    .domain(data.map(yValue))</span><br><span class="line">    .range([<span class="number">0</span>, height])</span><br><span class="line">    .padding(<span class="number">0.1</span>);</span><br><span class="line">  svg</span><br><span class="line">    .selectAll(<span class="string">"rect"</span>)</span><br><span class="line">    .data(data)</span><br><span class="line">    .enter()</span><br><span class="line">    .append(<span class="string">"rect"</span>)</span><br><span class="line">    .attr(<span class="string">"y"</span>, (d) =&gt; yScale(yValue(d)))</span><br><span class="line">    .attr(<span class="string">"width"</span>, (d) =&gt; xScale(xValue(d)))</span><br><span class="line">    .attr(<span class="string">"height"</span>, yScale.bandwidth());</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>The margin convention </p>
</li>
<li><p>Adding axes</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  select,</span><br><span class="line">  csv,</span><br><span class="line">  max,</span><br><span class="line">  scaleLinear,</span><br><span class="line">  scaleBand,</span><br><span class="line">  axisLeft,</span><br><span class="line">  axisBottom,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">"d3"</span>;</span><br><span class="line"><span class="keyword">const</span> svg = select(<span class="string">"svg"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> width = +svg.attr(<span class="string">"width"</span>);</span><br><span class="line"><span class="keyword">const</span> height = +svg.attr(<span class="string">"height"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> render = <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> xValue = <span class="function">(<span class="params">d</span>) =&gt;</span> d.population;</span><br><span class="line">  <span class="keyword">const</span> yValue = <span class="function">(<span class="params">d</span>) =&gt;</span> d.country;</span><br><span class="line">  <span class="keyword">const</span> margin = &#123; <span class="attr">top</span>: <span class="number">20</span>, <span class="attr">right</span>: <span class="number">40</span>, <span class="attr">bottom</span>: <span class="number">20</span>, <span class="attr">left</span>: <span class="number">100</span> &#125;;</span><br><span class="line">  <span class="keyword">const</span> innerheight = width - margin.left - margin.right;</span><br><span class="line">  <span class="keyword">const</span> innerwidth = width - margin.left - margin.right;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//æ¯”ä¾‹å°º</span></span><br><span class="line">  <span class="keyword">const</span> xScale = scaleLinear()</span><br><span class="line">    .domain([<span class="number">0</span>, max(data, xValue)])</span><br><span class="line">    .range([<span class="number">0</span>, innerwidth]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> yScale = scaleBand()</span><br><span class="line">    .domain(data.map(yValue))</span><br><span class="line">    .range([<span class="number">0</span>, innerheight])</span><br><span class="line">    .padding(<span class="number">0.1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> g = svg</span><br><span class="line">    .append(<span class="string">"g"</span>)</span><br><span class="line">    .attr(<span class="string">"transform"</span>, <span class="string">`translate(<span class="subst">$&#123;margin.left&#125;</span>,<span class="subst">$&#123;margin.top&#125;</span>)`</span>);</span><br><span class="line">	<span class="comment">//åæ ‡è½´</span></span><br><span class="line">  g.append(<span class="string">"g"</span>).call(axisLeft(yScale));</span><br><span class="line">  g.append(<span class="string">"g"</span>)</span><br><span class="line">    .call(axisBottom(xScale))</span><br><span class="line">    .attr(<span class="string">"transform"</span>, <span class="string">`translate(0,<span class="subst">$&#123;innerheight&#125;</span>)`</span>);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">  g.selectAll(<span class="string">"rect"</span>)</span><br><span class="line">    .data(data)</span><br><span class="line">    .enter()</span><br><span class="line">    .append(<span class="string">"rect"</span>)</span><br><span class="line">    .attr(<span class="string">"y"</span>, (d) =&gt; yScale(yValue(d)))</span><br><span class="line">    .attr(<span class="string">"width"</span>, (d) =&gt; xScale(xValue(d)))</span><br><span class="line">    .attr(<span class="string">"height"</span>, yScale.bandwidth());</span><br><span class="line">&#125;;</span><br><span class="line">csv(<span class="string">"data.csv"</span>).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  data.forEach(<span class="function">(<span class="params">d</span>) =&gt;</span> &#123;</span><br><span class="line">    d.population = +d.population * <span class="number">1000</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  render(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/35.png" style="zoom: 70%;"></p>
<h4 id="Customizing-Axes"><a href="#Customizing-Axes" class="headerlink" title="Customizing Axes"></a>Customizing Axes</h4><ul>
<li>Formatting numbers</li>
</ul>
<p><a href="http://bl.ocks.org/zanarmstrong/05c1e95bf7aa16c4768e" target="_blank" rel="noopener">http://bl.ocks.org/zanarmstrong/05c1e95bf7aa16c4768e</a></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/36.png" style="zoom: 80%;"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é»˜è®¤ ç™¾ä¸‡Mä¸Šé¢æ˜¯G,ä½†æ˜¯æˆ‘ä»¬è®¤ä¸ºåäº¿çº§çš„æ›´å‡†ç¡®ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨replaceå‡½æ•°æŠŠ Gæ¢æˆäº†Bã€‚ç„¶åç”¨</span></span><br><span class="line"><span class="comment">//tickFormatæ¥å¼•ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„æ ¼å¼åŒ–è§„åˆ™</span></span><br><span class="line"><span class="keyword">const</span> xAxisTickFormat = <span class="function">(<span class="params">number</span>) =&gt;</span> format(<span class="string">".3s"</span>)(number).replace(<span class="string">"G"</span>, <span class="string">"B"</span>);</span><br><span class="line">  <span class="keyword">const</span> xAxis = axisBottom(xScale).tickFormat(xAxisTickFormat);</span><br><span class="line">  g.append(<span class="string">"g"</span>).call(axisLeft(yScale));</span><br><span class="line">  g.append(<span class="string">"g"</span>).call(xAxis).attr(<span class="string">"transform"</span>, <span class="string">`translate(0,<span class="subst">$&#123;innerheight&#125;</span>)`</span>);</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/37.png" style="zoom: 90%;"></p>
<ul>
<li>Removing unnecessary lines</li>
</ul>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/38.png" style="zoom: 50%;"></p>
<p>æˆ‘ä»¬è¦å»é™¤è¿™äº›æ ¹éš¾çœ‹çš„è¾¹æ¡†çº¿å’Œå‡¸èµ·æ¥çš„ä¸œè¥¿</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">g.append(<span class="string">"g"</span>)</span><br><span class="line">	.call(axisLeft(yScale))</span><br><span class="line">	.selectAll(<span class="string">".domain,.tick line"</span>)</span><br><span class="line">	.remove();</span><br><span class="line">g.append(<span class="string">"g"</span>)</span><br><span class="line">  .call(xAxis)</span><br><span class="line">  .attr(<span class="string">"transform"</span>, <span class="string">`translate(0,<span class="subst">$&#123;innerheight&#125;</span>)`</span>)</span><br><span class="line">  .selectAll(<span class="string">".domain "</span>)</span><br><span class="line">  .remove();</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/39.png" style="zoom: 50%;"></p>
<ul>
<li>Adding a Visualization title</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g.append(<span class="string">"text"</span>).attr(<span class="string">"y"</span>, <span class="number">-10</span>).text(<span class="string">"Top 10 Most Popular Countries"</span>);</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/40.png" style="zoom: 50%;"></p>
<ul>
<li>Adding axis labels</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> xAxisG = g</span><br><span class="line">  .append(<span class="string">"g"</span>)</span><br><span class="line">  .call(xAxis)</span><br><span class="line">  .attr(<span class="string">"transform"</span>, <span class="string">`translate(0,<span class="subst">$&#123;innerheight&#125;</span>)`</span>);</span><br><span class="line">xAxisG.select(<span class="string">".domain "</span>).remove();</span><br><span class="line">xAxisG</span><br><span class="line">  .append(<span class="string">"text"</span>)</span><br><span class="line">  .attr(<span class="string">"fill"</span>, <span class="string">"black"</span>)</span><br><span class="line">  .attr(<span class="string">"y"</span>, <span class="number">60</span>)</span><br><span class="line">  .attr(<span class="string">"x"</span>, innerWidth / <span class="number">2</span> - <span class="number">100</span>)</span><br><span class="line">  .text(<span class="string">"Population"</span>);</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/41.png" style="zoom: 100%;"></p>
<ul>
<li>Making tick grid linesç½‘æ ¼çº¿</li>
</ul>
<p>css</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"> 	<span class="attribute">margin</span>:<span class="number">0px</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-tag">rect</span> &#123;</span><br><span class="line">  <span class="attribute">fill</span>: steelblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">text</span>&#123;</span><br><span class="line">  <span class="attribute">font-size </span>:<span class="number">3em</span>;</span><br><span class="line">  <span class="attribute">font-family</span>: sans-serif;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.tick</span> <span class="selector-tag">text</span> &#123;</span><br><span class="line">  <span class="attribute">font-size </span>:<span class="number">2.7em</span>;</span><br><span class="line">  <span class="attribute">fill</span>: <span class="number">#635F5D</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.tick</span> <span class="selector-tag">line</span>&#123;</span><br><span class="line">  <span class="attribute">stroke</span>: <span class="number">#C0C0BB</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.axis-label</span>&#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">5em</span>;</span><br><span class="line">  <span class="attribute">fill</span>: <span class="number">#8E8883</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.axis-title</span>&#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">3.2em</span>;</span><br><span class="line">  <span class="attribute">fill</span>:<span class="number">#635F5D</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; </span><br><span class="line">  select,</span><br><span class="line">  csv,</span><br><span class="line">  scaleLinear,</span><br><span class="line">  max,</span><br><span class="line">  scaleBand,</span><br><span class="line">  axisLeft,</span><br><span class="line">  axisBottom,</span><br><span class="line">  format</span><br><span class="line">&#125;  <span class="keyword">from</span> <span class="string">'d3'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> render = <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">const</span> svg = select(<span class="string">'svg'</span>)</span><br><span class="line">  <span class="keyword">const</span> height = +svg.attr(<span class="string">'height'</span>)</span><br><span class="line">  <span class="keyword">const</span> width = +svg.attr(<span class="string">'width'</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> countryMapping = <span class="function"><span class="params">d</span> =&gt;</span> d.country</span><br><span class="line">  <span class="keyword">const</span> populationMapping = <span class="function"><span class="params">d</span> =&gt;</span> d.population</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> countries = data.map(countryMapping)</span><br><span class="line">  <span class="keyword">const</span> populationMax = max(data, populationMapping)</span><br><span class="line">  <span class="keyword">const</span> margin = &#123;</span><br><span class="line">    top: <span class="number">45</span>,</span><br><span class="line">    bottom: <span class="number">85</span>,</span><br><span class="line">    left: <span class="number">200</span>,</span><br><span class="line">    right: <span class="number">100</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> textHeight = <span class="number">10</span></span><br><span class="line">  <span class="keyword">const</span> innerWidth = width - margin.left - margin.right</span><br><span class="line">  <span class="keyword">const</span> innerHeight = height - margin.top - margin.bottom - textHeight</span><br><span class="line">  <span class="keyword">const</span> xScale = scaleLinear().domain([<span class="number">0</span>, populationMax]).range([<span class="number">0</span>, innerWidth])</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> yBandScale = scaleBand()</span><br><span class="line">  .domain(countries)</span><br><span class="line">  .range([<span class="number">0</span>, innerHeight])</span><br><span class="line">  .padding(<span class="number">.2</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> barGroup = svg.append(<span class="string">'g'</span>).attr(<span class="string">'transform'</span>,</span><br><span class="line">                                        <span class="string">`translate(<span class="subst">$&#123;margin.left&#125;</span>, <span class="subst">$&#123;margin.top + textHeight + <span class="number">5</span>&#125;</span>)`</span>)</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> yAxis = axisLeft(yBandScale)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> xAxisTickFormat = <span class="function"><span class="params">number</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> format(<span class="string">'.3s'</span>)(number).replace(<span class="string">'G'</span>, <span class="string">'B'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">	<span class="keyword">const</span> xAxis = axisBottom(xScale)</span><br><span class="line">  								.tickFormat(xAxisTickFormat)</span><br><span class="line">  </span><br><span class="line">  barGroup.append(<span class="string">'g'</span>).call(yAxis)</span><br><span class="line">  	.selectAll(<span class="string">'.domain, .tick line'</span>)</span><br><span class="line">  	.remove();</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> xAxisG = barGroup.append(<span class="string">'g'</span>).call(xAxis)</span><br><span class="line">    .attr(<span class="string">'transform'</span>, <span class="string">`translate(<span class="subst">$&#123;<span class="number">0</span>&#125;</span>, <span class="subst">$&#123;innerHeight&#125;</span>)`</span>);</span><br><span class="line">  </span><br><span class="line">xAxisG</span><br><span class="line">  .append(<span class="string">'text'</span>)</span><br><span class="line">  .text(<span class="string">'Something is missing'</span>)</span><br><span class="line">  .attr(<span class="string">'y'</span>, <span class="number">50</span>)</span><br><span class="line">  .attr(<span class="string">'x'</span>, innerWidth / <span class="number">2</span>)</span><br><span class="line">  .attr(<span class="string">'class'</span>, <span class="string">'x-label'</span>)</span><br><span class="line">  .text(<span class="string">"Population"</span>);</span><br><span class="line">  </span><br><span class="line">xAxisG    </span><br><span class="line">    .append(<span class="string">"text"</span>)</span><br><span class="line">    .attr(<span class="string">"class"</span>, <span class="string">"axis-label"</span>)<span class="comment">//åŠ ä¸Šä¸€ä¸ªç±»æ ‡ç­¾ï¼Œä¾›cssé€‰æ‹©å™¨å»é€‰æ‹©</span></span><br><span class="line">    .attr(<span class="string">"fill"</span>, <span class="string">"black"</span>)</span><br><span class="line">    .attr(<span class="string">"y"</span>, <span class="number">75</span>)</span><br><span class="line">    .attr(<span class="string">"x"</span>, innerWidth / <span class="number">2</span>  )</span><br><span class="line">    .text(<span class="string">"Population"</span>);</span><br><span class="line">barGroup</span><br><span class="line">  	.selectAll(<span class="string">'.domain'</span>)</span><br><span class="line">  	.remove();</span><br><span class="line">  </span><br><span class="line"> barGroup</span><br><span class="line">    .append(<span class="string">"text"</span>)</span><br><span class="line">    .attr(<span class="string">"class"</span>, <span class="string">"axis-title"</span>)<span class="comment">//åŠ ä¸Šä¸€ä¸ªç±»æ ‡ç­¾ï¼Œä¾›cssé€‰æ‹©å™¨å»é€‰æ‹©</span></span><br><span class="line">    .attr(<span class="string">"y"</span>, <span class="number">-10</span>)</span><br><span class="line">    .text(<span class="string">"Top 10 Most Popular Countries"</span>);  </span><br><span class="line"></span><br><span class="line">  barGroup</span><br><span class="line">    .selectAll(<span class="string">'rect'</span>)</span><br><span class="line">  	.data(data)</span><br><span class="line">  	.enter()</span><br><span class="line">  	.append(<span class="string">'rect'</span>)</span><br><span class="line">      .attr(<span class="string">'y'</span>, d =&gt; yBandScale(countryMapping(d)))</span><br><span class="line">      .attr(<span class="string">'width'</span>, d =&gt; xScale(populationMapping(d)))</span><br><span class="line">      .attr(<span class="string">'height'</span>, yBandScale.bandwidth())</span><br><span class="line">  </span><br><span class="line">svg.append(<span class="string">"text"</span>)</span><br><span class="line">  	.attr(<span class="string">"class"</span>, <span class="string">"axis-title"</span>)<span class="comment">//åŠ ä¸Šä¸€ä¸ªç±»æ ‡ç­¾ï¼Œä¾›cssé€‰æ‹©å™¨å»é€‰æ‹©</span></span><br><span class="line">    .attr(<span class="string">"y"</span>, <span class="number">-10</span>)</span><br><span class="line">    .text(<span class="string">"Top 10 Most Popular Countries"</span>);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">csv(<span class="string">'data.csv'</span>).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  data.forEach(<span class="function"><span class="params">record</span> =&gt;</span> &#123;</span><br><span class="line">    record.population = +record.population * <span class="number">1000</span></span><br><span class="line">  &#125;)</span><br><span class="line">  render(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/42.png" style="zoom: 70%;"></p>
<h3 id="å®ä¾‹ï¼šç»˜åˆ¶æŸ±çŠ¶å›¾"><a href="#å®ä¾‹ï¼šç»˜åˆ¶æŸ±çŠ¶å›¾" class="headerlink" title="å®ä¾‹ï¼šç»˜åˆ¶æŸ±çŠ¶å›¾"></a>å®ä¾‹ï¼šç»˜åˆ¶æŸ±çŠ¶å›¾</h3><p>æ•ˆæœ</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/30.png" style="zoom: 70%;"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>BarChart! <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../js/d3.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--è¿™é‡Œæˆ‘å·²ç»å®šä¹‰äº†svgç”»å¸ƒçš„å®½å’Œé«˜--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">"1600"</span> <span class="attr">height</span>=<span class="string">"800"</span> <span class="attr">id</span>=<span class="string">"mainsvg"</span> <span class="attr">class</span>=<span class="string">"svgs"</span>  &gt;</span><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="comment">//è¿™æ˜¯æˆ‘ä»¬æƒ³å±•ç¤ºçš„å†…å®¹ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> data = [&#123;name: <span class="string">'Shao-Kui'</span>, value:<span class="number">6</span>&#125;,</span></span><br><span class="line"><span class="actionscript">        &#123;name:<span class="string">'Wen-Yang'</span>, value:<span class="number">6</span>&#125;, &#123;name:<span class="string">'Cai Yun'</span>, value:<span class="number">16</span>&#125;, &#123;name:<span class="string">'Liang Yuan'</span>, value: <span class="number">10</span>&#125;, </span></span><br><span class="line"><span class="actionscript">        &#123;name:<span class="string">'Yuan-Chen'</span>, value:<span class="number">6</span>&#125;, &#123;name:<span class="string">'Rui-Long'</span>, value:<span class="number">10</span>&#125;, &#123;name:<span class="string">'Dong Xin'</span>, value:<span class="number">12</span>&#125;, </span></span><br><span class="line"><span class="actionscript">        &#123;name:<span class="string">'He Yu'</span>, value:<span class="number">20</span>&#125;, &#123;name:<span class="string">'Xiang-Li'</span>, value:<span class="number">12</span>&#125;, &#123;name:<span class="string">'Godness'</span>, value:<span class="number">20</span>&#125;, </span></span><br><span class="line"><span class="actionscript">        &#123;name:<span class="string">'Wei-Yu'</span>, value:<span class="number">15</span>&#125;, &#123;name:<span class="string">'Chen Zheng'</span>, value:<span class="number">14</span>&#125;, </span></span><br><span class="line"><span class="actionscript">        &#123;name:<span class="string">'Yu Peng'</span>, value:<span class="number">15</span>&#125;, &#123;name:<span class="string">'Li Jian'</span>, value:<span class="number">18</span>&#125;]; </span></span><br><span class="line"><span class="actionscript"><span class="comment">//é¦–å…ˆæˆ‘ä»¬è·å¾—ä¸Šé¢å®šä¹‰çš„svgç”»å¸ƒ</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> svg = d3.select(<span class="string">'#mainsvg'</span>);</span></span><br><span class="line"><span class="actionscript"><span class="comment">//è·å–svgçš„é•¿å’Œå®½       </span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> width = +svg.attr(<span class="string">'width'</span>);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> height = +svg.attr(<span class="string">'height'</span>);</span></span><br><span class="line"><span class="actionscript"><span class="comment">//å®šä¹‰é¢„ç•™ç©ºé—´        </span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> margin = &#123;top: <span class="number">60</span>, right: <span class="number">30</span>, bottom: <span class="number">60</span>, left: <span class="number">150</span>&#125;;</span></span><br><span class="line"><span class="actionscript"><span class="comment">//çœŸæ­£ä½œç”»çš„ç©ºé—´</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> innerWidth = width - margin.left - margin.right;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> innerHeight = height - margin.top - margin.bottom;</span></span><br><span class="line">/*</span><br><span class="line">ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°æ¨ªè½´æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨scaleLiner()æ¯”ä¾‹å°ºè¿›è¡Œæ˜ å°„</span><br><span class="line">æ€ä¹ˆæ˜ å°„å‘¢ï¼Ÿ</span><br><span class="line">æ•°æ®çš„æœ€å°å€¼å°±æ˜¯0ï¼Œæ•°æ®å¾—æœ€å¤§å€¼å°±åˆ©ç”¨d3.max ï¼Œç¬¬ä¸€ä¸ªæ•°æ®å°±æ˜¯æ•°æ®æœ¬èº«ï¼Œç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯ä¸€ä¸ªå‡½æ•°</span><br><span class="line">è¿™ä¸ªå‡½æ•°ä¼šå‘Šè¯‰æˆ‘ä»¬æ•°æ®æ˜¯æ€ä¹ˆè·å–åˆ°çš„</span><br><span class="line">æ˜ å°„èŒƒå›´å°±æ˜¯0åˆ°åˆšæ‰å®šä¹‰çš„å†…è¾¹æ¡†çš„å®½</span><br><span class="line">*/</span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> xScale = d3.scaleLinear()</span></span><br><span class="line">        .domain([0, d3.max(data, d =&gt; d.value)])</span><br><span class="line">        .range([0, innerWidth]);</span><br><span class="line">/*</span><br><span class="line">æ•°è½´æ˜¯åå­—ï¼Œæ‰€ä»¥æ˜¯ç¦»æ•£çš„ï¼Œæˆ‘ä»¬ç”¨scaleBand()æ¯”ä¾‹å°ºè¿›è¡Œæ˜ å°„</span><br><span class="line">æ€ä¹ˆæ˜ å°„bandå‘¢ï¼Ÿ</span><br><span class="line">æˆ‘ä»¬åˆ©ç”¨jsä¸­çš„mapå‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œä¼ å›ä¸€ä¸ªæ•°ç»„ã€‚å¹¶æŠŠè¿™ä¸ªæ•°ç»„ç»™domain</span><br><span class="line">é—´éš™ä¸º0.1</span><br><span class="line">*/</span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> yScale = d3.scaleBand()</span></span><br><span class="line"><span class="javascript">        .domain( data.map(<span class="function"><span class="params">d</span> =&gt;</span> d.name) )</span></span><br><span class="line">        .range([0, innerHeight])</span><br><span class="line">        .padding(0.1);</span><br><span class="line">/*</span><br><span class="line">åœ¨æ¸²æŸ“åæ ‡è½´ä¹‹å‰æˆ‘ä»¬è¦æŠŠæ•´ä¸ªæŸ±å½¢å›¾æä¾›ç»™ä¸€ä¸ªå®¹å™¨</span><br><span class="line">æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªgæ ‡ç­¾ï¼Œidå°±æ˜¯æˆ‘ä»¬çš„maingroupï¼Œ</span><br><span class="line">ç„¶åè®¾ç½®transformå±æ€§ï¼ŒæŠŠè¿™ä¸ªæŸ±å½¢å›¾å¹³ç§»åˆ°æˆ‘ä»¬åˆšæ‰è§„åˆ’çš„é‚£ä¸€ç‰‡åŒºåŸŸï¼Œåˆ©ç”¨æ¨¡æ¿è¯­æ³•</span><br><span class="line">*/</span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> g = svg.append(<span class="string">'g'</span>).attr(<span class="string">'id'</span>, <span class="string">'maingroup'</span>)</span></span><br><span class="line"><span class="javascript">        .attr(<span class="string">'transform'</span>, <span class="string">`translate(<span class="subst">$&#123;margin.left&#125;</span>, <span class="subst">$&#123;margin.top&#125;</span>)`</span>);</span></span><br><span class="line">/*</span><br><span class="line">ç„¶åæˆ‘ä»¬åœ¨maingroupä¸­æ·»åŠ åæ ‡è½´çš„å®¹å™¨äº†</span><br><span class="line">å®šä¹‰åæ ‡è½´ï¼Œå‘Šè¯‰åæ ‡è½´çš„å–å€¼èŒƒå›´è¯¥å¦‚ä½•æ˜ å°„</span><br><span class="line">ç„¶åæˆ‘ä»¬å‘é‡Œé¢æ·»åŠ æ¨ªè½´æ•°å€¼å’Œç«–è½´çš„äººåï¼Œæ³¨æ„å†™æ³•ï¼Œ call(xAxis)å°±æ˜¯æŠŠgroupäº¤ç»™xAxiså‡½æ•°å»å¤„ç†</span><br><span class="line">xAxis  </span><br><span class="line">ä½†æ˜¯åæ ‡è½´ä¼šé»˜è®¤å®šä¹‰åœ¨ä¸Šé¢ï¼Œå¦‚æœæˆ‘ä»¬è¦æŠŠæ¨ªè½´å®šä¹‰åœ¨æœ€åº•ç«¯ï¼Œæˆ‘ä»¬éœ€è¦å¹³ç§»ä¸€ä¸‹</span><br><span class="line">*/</span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> xAxis = d3.axisBottom(xScale);</span></span><br><span class="line"><span class="javascript">        g.append(<span class="string">'g'</span>).call(xAxis).attr(<span class="string">'transform'</span>, <span class="string">`translate(<span class="subst">$&#123;<span class="number">0</span>&#125;</span>, <span class="subst">$&#123;innerHeight&#125;</span>)`</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> yAxis = d3.axisLeft(yScale);</span></span><br><span class="line"><span class="actionscript">        g.append(<span class="string">'g'</span>).call(yAxis);</span></span><br><span class="line">/*</span><br><span class="line">ç°åœ¨å¯¹æ¯ä¸€æ¡æ•°æ®éƒ½è¦ç”»å‡ºä¸€ä¸ªæ¡å¸¦ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªçŸ©å½¢</span><br><span class="line">å› ä¸ºæˆ‘ä»¬æ˜¯æ ¹æ®æ¨ªè½´æ¯”ä¾‹å°ºå®šä¹‰é•¿åº¦ï¼Œé‚£ä¹ˆwidth å°±æ˜¯æ•°æ®çš„valueå±æ€§</span><br><span class="line">é«˜åº¦å°±æ˜¯åˆ©ç”¨yScaleæä¾›çš„æ–¹æ³•ï¼Œäº¤ç»™D3è‡ªå·±å»å®šä¹‰</span><br><span class="line">ç„¶åæˆ‘ä»¬å¡«å……ä¸€ä¸ªé¢œè‰²</span><br><span class="line">æœ€åæˆ‘ä»¬éœ€è¦è®©ä¿¡æ¯ä¸­çš„äººåå’Œåæ ‡è½´ä¸Šçš„äººåä¸€ä¸€å¯¹åº”ï¼Œè¿™æ ·æ‰èƒ½æ˜ å°„ä¸Šå»</span><br><span class="line">*/</span><br><span class="line"><span class="javascript">        data.forEach( <span class="function"><span class="params">d</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="actionscript">          g.append(<span class="string">'rect'</span>)</span></span><br><span class="line"><span class="actionscript">          .attr(<span class="string">'width'</span>, xScale(d.value))</span></span><br><span class="line"><span class="actionscript">          .attr(<span class="string">'height'</span>, yScale.bandwidth())</span></span><br><span class="line"><span class="actionscript">          .attr(<span class="string">'fill'</span>, <span class="string">'green'</span>)</span></span><br><span class="line"><span class="actionscript">          .attr(<span class="string">'y'</span>, yScale(d.name))</span></span><br><span class="line">        &#125; );</span><br><span class="line">/*</span><br><span class="line">ç°åœ¨æˆ‘ä»¬éœ€è¦å¯¹æŸ±çŠ¶å›¾è¿›è¡Œä¸€äº›æ”¹è¿›ï¼Œè¿™é‡Œæˆ‘ä»¬æƒ³æŠŠçºµåæ ‡çš„åˆ»åº¦ä¸Šçš„æ–‡æœ¬ï¼Œä¹Ÿå°±æ˜¯äººå</span><br><span class="line">é‚£ä¹ˆæˆ‘ä»¬æŠŠä»–çš„å­—ä½“å¤§å°è®¾ç½®æˆ2em</span><br><span class="line">æœ€åæˆ‘ä»¬å¸Œæœ›åŠ ä¸€ä¸ªè¡¨å¤´ï¼Œä¹Ÿå°±æ˜¯æ ‡é¢˜</span><br><span class="line">é‚£ä¹ˆæˆ‘ä»¬ç”¨appendä¸€ä¸ªtextï¼Œç„¶ååˆ©ç”¨.text()è®¾ç½®æ–‡å­—å†…å®¹ï¼Œå­—ä½“å¤§å°ä¸º3em</span><br><span class="line">ç„¶åæˆ‘ä»¬éœ€è¦æŠŠä»–å±…ä¸­ï¼Œåˆ©ç”¨transformå±æ€§ï¼Œä½†è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬ç°åœ¨åªæ˜¯æŠŠæ–‡æœ¬çš„å¼€å¤´ç§»åŠ¨åˆ°äº†ä¸­é—´</span><br><span class="line">æœ€åæˆ‘ä»¬è®¾ç½®æ–‡å­—çš„é”šè®¾ç½®ä¸ºä¸­é—´ã€‚ç°åœ¨æ–‡æœ¬çš„ä¸­é—´å°±åœ¨ç”»å¸ƒçš„ä¸­é—´äº†ï¼Œè¾¾æˆäº†å±…ä¸­çš„æ•ˆæœ</span><br><span class="line">*/</span><br><span class="line"><span class="actionscript">        d3.selectAll(<span class="string">'.tick text'</span>).attr(<span class="string">'font-size'</span>, <span class="string">'2em'</span>);</span></span><br><span class="line"><span class="actionscript">        g.append(<span class="string">'text'</span>).text(<span class="string">'Members of CSCG'</span>).attr(<span class="string">'font-size'</span>, <span class="string">'3em'</span>)</span></span><br><span class="line"><span class="actionscript">        .attr(<span class="string">'transform'</span>, `translate($&#123;innerWidth/<span class="number">2</span>&#125;, $&#123;<span class="number">0</span>&#125;)`)</span></span><br><span class="line"><span class="actionscript">        .attr(<span class="string">'text-anchor'</span>, <span class="string">'middle'</span>);</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="å®ç°ä¸€ä¸ªæ•£ç‚¹å›¾-1"><a href="#å®ç°ä¸€ä¸ªæ•£ç‚¹å›¾-1" class="headerlink" title="å®ç°ä¸€ä¸ªæ•£ç‚¹å›¾-1"></a>å®ç°ä¸€ä¸ªæ•£ç‚¹å›¾-1</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  select,</span><br><span class="line">  csv,</span><br><span class="line">  scaleLinear,</span><br><span class="line">  max,</span><br><span class="line">  scalePoint,</span><br><span class="line">  axisLeft,</span><br><span class="line">  axisBottom,</span><br><span class="line">  format,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">"d3"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> render = <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> svg = select(<span class="string">"svg"</span>);</span><br><span class="line">  <span class="keyword">const</span> height = +svg.attr(<span class="string">"height"</span>);</span><br><span class="line">  <span class="keyword">const</span> width = +svg.attr(<span class="string">"width"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> countryMapping = <span class="function">(<span class="params">d</span>) =&gt;</span> d.country;</span><br><span class="line">  <span class="keyword">const</span> populationMapping = <span class="function">(<span class="params">d</span>) =&gt;</span> d.population;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> countries = data.map(countryMapping);</span><br><span class="line">  <span class="keyword">const</span> populationMax = max(data, populationMapping);</span><br><span class="line">  <span class="keyword">const</span> margin = &#123;</span><br><span class="line">    top: <span class="number">45</span>,</span><br><span class="line">    bottom: <span class="number">85</span>,</span><br><span class="line">    left: <span class="number">200</span>,</span><br><span class="line">    right: <span class="number">100</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> textHeight = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">const</span> innerWidth = width - margin.left - margin.right;</span><br><span class="line">  <span class="keyword">const</span> innerHeight = height - margin.top - margin.bottom - textHeight;</span><br><span class="line">  <span class="keyword">const</span> xScale = scaleLinear()</span><br><span class="line">    .domain([<span class="number">0</span>, populationMax])</span><br><span class="line">    .range([<span class="number">0</span>, innerWidth])</span><br><span class="line">    .nice();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> yScale = scalePoint()</span><br><span class="line">    .domain(countries)</span><br><span class="line">    .range([<span class="number">0</span>, innerHeight])</span><br><span class="line">    .padding(<span class="number">0.7</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> circleGroup = svg</span><br><span class="line">    .append(<span class="string">"g"</span>)</span><br><span class="line">    .attr(</span><br><span class="line">      <span class="string">"transform"</span>,</span><br><span class="line">      <span class="string">`translate(<span class="subst">$&#123;margin.left&#125;</span>, <span class="subst">$&#123;margin.top + textHeight + <span class="number">5</span>&#125;</span>)`</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> yAxis = axisLeft(yScale).tickSize(-innerWidth);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> xAxisTickFormat = <span class="function">(<span class="params">number</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> format(<span class="string">".3s"</span>)(number).replace(<span class="string">"G"</span>, <span class="string">"B"</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> xAxis = axisBottom(xScale)</span><br><span class="line">    .tickFormat(xAxisTickFormat)</span><br><span class="line">    .tickSize(-innerHeight);</span><br><span class="line"></span><br><span class="line">  circleGroup.append(<span class="string">"g"</span>).call(yAxis).selectAll(<span class="string">".domain"</span>).remove();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> xAxisG = circleGroup</span><br><span class="line">    .append(<span class="string">"g"</span>)</span><br><span class="line">    .call(xAxis)</span><br><span class="line">    .attr(<span class="string">"transform"</span>, <span class="string">`translate(<span class="subst">$&#123;<span class="number">0</span>&#125;</span>, <span class="subst">$&#123;innerHeight&#125;</span>)`</span>);</span><br><span class="line"></span><br><span class="line">  xAxisG</span><br><span class="line">    .append(<span class="string">"text"</span>)</span><br><span class="line">    .text(<span class="string">"Something is missing"</span>)</span><br><span class="line">    .attr(<span class="string">"y"</span>, <span class="number">50</span>)</span><br><span class="line">    .attr(<span class="string">"x"</span>, innerWidth / <span class="number">2</span>)</span><br><span class="line">    .attr(<span class="string">"class"</span>, <span class="string">"x-label"</span>)</span><br><span class="line">    .text(<span class="string">"Population"</span>);</span><br><span class="line"></span><br><span class="line">  xAxisG</span><br><span class="line">    .append(<span class="string">"text"</span>)</span><br><span class="line">    .attr(<span class="string">"class"</span>, <span class="string">"axis-label"</span>) <span class="comment">//åŠ ä¸Šä¸€ä¸ªç±»æ ‡ç­¾ï¼Œä¾›cssé€‰æ‹©å™¨å»é€‰æ‹©</span></span><br><span class="line">    .attr(<span class="string">"fill"</span>, <span class="string">"black"</span>)</span><br><span class="line">    .attr(<span class="string">"y"</span>, <span class="number">75</span>)</span><br><span class="line">    .attr(<span class="string">"x"</span>, innerWidth / <span class="number">2</span>)</span><br><span class="line">    .text(<span class="string">"Population"</span>);</span><br><span class="line">  circleGroup.selectAll(<span class="string">".domain"</span>).remove();</span><br><span class="line"></span><br><span class="line">  circleGroup</span><br><span class="line">    .append(<span class="string">"text"</span>)</span><br><span class="line">    .attr(<span class="string">"class"</span>, <span class="string">"axis-title"</span>) <span class="comment">//åŠ ä¸Šä¸€ä¸ªç±»æ ‡ç­¾ï¼Œä¾›cssé€‰æ‹©å™¨å»é€‰æ‹©</span></span><br><span class="line">    .attr(<span class="string">"y"</span>, <span class="number">-10</span>)</span><br><span class="line">    .text(<span class="string">"Top 10 Most Popular Countries"</span>);</span><br><span class="line"></span><br><span class="line">  circleGroup</span><br><span class="line">    .selectAll(<span class="string">"circle"</span>)</span><br><span class="line">    .data(data)</span><br><span class="line">    .enter()</span><br><span class="line">    .append(<span class="string">"circle"</span>)</span><br><span class="line">    .attr(<span class="string">"cy"</span>, (d) =&gt; yScale(countryMapping(d)))</span><br><span class="line">    .attr(<span class="string">"cx"</span>, (d) =&gt; xScale(populationMapping(d)))</span><br><span class="line">    .attr(<span class="string">"r"</span>, <span class="number">18</span>);</span><br><span class="line"></span><br><span class="line">  svg</span><br><span class="line">    .append(<span class="string">"text"</span>)</span><br><span class="line">    .attr(<span class="string">"class"</span>, <span class="string">"axis-title"</span>) <span class="comment">//åŠ ä¸Šä¸€ä¸ªç±»æ ‡ç­¾ï¼Œä¾›cssé€‰æ‹©å™¨å»é€‰æ‹©</span></span><br><span class="line">    .attr(<span class="string">"y"</span>, <span class="number">-10</span>)</span><br><span class="line">    .text(<span class="string">"Top 10 Most Popular Countries"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">csv(<span class="string">"data.csv"</span>).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  data.forEach(<span class="function">(<span class="params">record</span>) =&gt;</span> &#123;</span><br><span class="line">    record.population = +record.population * <span class="number">1000</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  render(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/43.png" style="zoom: 70%;"></p>
<h3 id="å®ç°ä¸€ä¸ªæ•£ç‚¹å›¾-2"><a href="#å®ç°ä¸€ä¸ªæ•£ç‚¹å›¾-2" class="headerlink" title="å®ç°ä¸€ä¸ªæ•£ç‚¹å›¾-2"></a>å®ç°ä¸€ä¸ªæ•£ç‚¹å›¾-2</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  select,</span><br><span class="line">  csv,</span><br><span class="line">  scaleLinear,</span><br><span class="line">  extent,</span><br><span class="line">  axisLeft,</span><br><span class="line">  axisBottom,</span><br><span class="line">  format</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'d3'</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// d.mpg = +d.mpg;</span></span><br><span class="line">      <span class="comment">// d.cylinders = +d.cylinders;</span></span><br><span class="line">      <span class="comment">// d.displacement = +d.displacement;</span></span><br><span class="line">      <span class="comment">// d.horsepower = +d.horsepower;</span></span><br><span class="line">      <span class="comment">// d.weight = +d.weight;</span></span><br><span class="line">      <span class="comment">// d.acceleration = +d.acceleration;</span></span><br><span class="line">      <span class="comment">// d.year = +d.year;</span></span><br><span class="line"><span class="keyword">const</span> svg = select(<span class="string">'svg'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> width = +svg.attr(<span class="string">'width'</span>);</span><br><span class="line"><span class="keyword">const</span> height = +svg.attr(<span class="string">'height'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> render = <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> title = <span class="string">'Cars: Horsepower vs. Weight'</span>;</span><br><span class="line">  <span class="comment">//å¯ä»¥é€šè¿‡æ”¹å˜xValueå’ŒyValueæ¥åšä¸åŒçš„å›¾</span></span><br><span class="line">  <span class="keyword">const</span> xValue = <span class="function"><span class="params">d</span> =&gt;</span> d.horsepower;</span><br><span class="line">  <span class="keyword">const</span> xAxisLabel = <span class="string">'Horsepower'</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> yValue = <span class="function"><span class="params">d</span> =&gt;</span> d.weight;</span><br><span class="line">  <span class="keyword">const</span> circleRadius = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">const</span> yAxisLabel = <span class="string">'Weight'</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> margin = &#123; <span class="attr">top</span>: <span class="number">60</span>, <span class="attr">right</span>: <span class="number">40</span>, <span class="attr">bottom</span>: <span class="number">88</span>, <span class="attr">left</span>: <span class="number">150</span> &#125;;</span><br><span class="line">  <span class="keyword">const</span> innerWidth = width - margin.left - margin.right;</span><br><span class="line">  <span class="keyword">const</span> innerHeight = height - margin.top - margin.bottom;</span><br><span class="line">  <span class="comment">/*******************xå’Œyçš„æ¯”ä¾‹å°º********************/</span></span><br><span class="line">  <span class="keyword">const</span> xScale = scaleLinear()</span><br><span class="line">  <span class="comment">//extent(data, xValue)å‡½æ•°å°±æ˜¯[min(data,xValue),max(data,xValue)]</span></span><br><span class="line">    .domain(extent(data, xValue))</span><br><span class="line">    .range([<span class="number">0</span>, innerWidth])</span><br><span class="line">    .nice();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> yScale = scaleLinear()</span><br><span class="line">    .domain(extent(data, yValue))</span><br><span class="line">    .range([innerHeight, <span class="number">0</span>])</span><br><span class="line">    .nice();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> g = svg.append(<span class="string">'g'</span>)</span><br><span class="line">    .attr(<span class="string">'transform'</span>, <span class="string">`translate(<span class="subst">$&#123;margin.left&#125;</span>,<span class="subst">$&#123;margin.top&#125;</span>)`</span>);</span><br><span class="line">  <span class="comment">/******************xå’Œy çš„åæ ‡è½´*********************/</span></span><br><span class="line">  <span class="keyword">const</span> xAxis = axisBottom(xScale)</span><br><span class="line">    .tickSize(-innerHeight)</span><br><span class="line">  <span class="comment">//è®©åæ ‡è½´ä¸‹é¢çš„æ•°æ ‡å’Œè½´è¿œç¦»</span></span><br><span class="line">    .tickPadding(<span class="number">15</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> yAxis = axisLeft(yScale)</span><br><span class="line">    .tickSize(-innerWidth)</span><br><span class="line">    .tickPadding(<span class="number">10</span>);</span><br><span class="line">  <span class="comment">/****************yåæ ‡è½´çš„å±æ€§*******************/</span></span><br><span class="line">  <span class="keyword">const</span> yAxisG = g.append(<span class="string">'g'</span>).call(yAxis);</span><br><span class="line">  yAxisG.selectAll(<span class="string">'.domain'</span>).remove();</span><br><span class="line">  <span class="comment">//yè½´çš„åç§°</span></span><br><span class="line">  yAxisG.append(<span class="string">'text'</span>)</span><br><span class="line">      .attr(<span class="string">'class'</span>, <span class="string">'axis-label'</span>)</span><br><span class="line">      .attr(<span class="string">'y'</span>, <span class="number">-93</span>)</span><br><span class="line">      .attr(<span class="string">'x'</span>, -innerHeight / <span class="number">2</span>)</span><br><span class="line">      .attr(<span class="string">'fill'</span>, <span class="string">'black'</span>)</span><br><span class="line">  <span class="comment">//åè½¬ Weight -90åº¦</span></span><br><span class="line">      .attr(<span class="string">'transform'</span>, <span class="string">`rotate(-90)`</span>)</span><br><span class="line">  <span class="comment">//æŠŠé”šæ”¾ä¸­é—´ï¼Œè¾¾åˆ°å‰§ä¸­æ•ˆæœ</span></span><br><span class="line">      .attr(<span class="string">'text-anchor'</span>, <span class="string">'middle'</span>)</span><br><span class="line">      .text(yAxisLabel);</span><br><span class="line">  <span class="comment">/*****************xåæ ‡è½´çš„å±æ€§*********************/</span></span><br><span class="line">  <span class="keyword">const</span> xAxisG = g.append(<span class="string">'g'</span>).call(xAxis)</span><br><span class="line">    .attr(<span class="string">'transform'</span>, <span class="string">`translate(0,<span class="subst">$&#123;innerHeight&#125;</span>)`</span>);</span><br><span class="line">  </span><br><span class="line">  xAxisG.select(<span class="string">'.domain'</span>).remove();</span><br><span class="line">  </span><br><span class="line">  xAxisG.append(<span class="string">'text'</span>)</span><br><span class="line">      .attr(<span class="string">'class'</span>, <span class="string">'axis-label'</span>)</span><br><span class="line">      .attr(<span class="string">'y'</span>, <span class="number">75</span>)</span><br><span class="line">      .attr(<span class="string">'x'</span>, innerWidth / <span class="number">2</span>)</span><br><span class="line">      .attr(<span class="string">'fill'</span>, <span class="string">'black'</span>)</span><br><span class="line">      .text(xAxisLabel);</span><br><span class="line">  <span class="comment">/**************************************************/</span></span><br><span class="line">  g.selectAll(<span class="string">'circle'</span>).data(data)</span><br><span class="line">    .enter().append(<span class="string">'circle'</span>)</span><br><span class="line">      .attr(<span class="string">'cy'</span>, d =&gt; yScale(yValue(d)))</span><br><span class="line">      .attr(<span class="string">'cx'</span>, d =&gt; xScale(xValue(d)))</span><br><span class="line">      .attr(<span class="string">'r'</span>, circleRadius);</span><br><span class="line">  <span class="comment">/***************è®¾ç½®åç§°***************************/</span></span><br><span class="line">  g.append(<span class="string">'text'</span>)</span><br><span class="line">      .attr(<span class="string">'class'</span>, <span class="string">'title'</span>)</span><br><span class="line">      .attr(<span class="string">'y'</span>, <span class="number">-10</span>)</span><br><span class="line">      .text(title);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">csv(<span class="string">'https://vizhub.com/curran/datasets/auto-mpg.csv'</span>)</span><br><span class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    data.forEach(<span class="function"><span class="params">d</span> =&gt;</span> &#123;</span><br><span class="line">      d.mpg = +d.mpg;</span><br><span class="line">      d.cylinders = +d.cylinders;</span><br><span class="line">      d.displacement = +d.displacement;</span><br><span class="line">      d.horsepower = +d.horsepower;</span><br><span class="line">      d.weight = +d.weight;</span><br><span class="line">      d.acceleration = +d.acceleration;</span><br><span class="line">      d.year = +d.year;  </span><br><span class="line">    &#125;);</span><br><span class="line">    render(data);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/44.png" style="zoom: 70%;"></p>
<p>ç”¨è‡ªå·±çˆ¬å–çš„æ•°æ®åšçš„ä¸¤ä¸ªå›¾æ ‡.åªéœ€è¦è½½å…¥æ•°æ®ï¼Œæ¨¡æ¿æ˜¯ä¸€æ ·çš„ï¼Œæ–¹ä¾¿</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/5.jpg" style="zoom: 70%;"></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/6.jpg" style="zoom: 70%;"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jasonâ€˜s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/" class="post-title-link" itemprop="url">ä¸€èˆ¬å‘¨æœŸçš„å‡½æ•°çš„å‚…é‡Œå¶çº§æ•°</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-10 00:33:59" itemprop="dateCreated datePublished" datetime="2020-06-10T00:33:59+08:00">2020-06-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-15 07:38:54" itemprop="dateModified" datetime="2020-06-15T07:38:54+08:00">2020-06-15</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ä¸€èˆ¬å‘¨æœŸçš„å‡½æ•°çš„å‚…é‡Œå¶çº§æ•°"><a href="#ä¸€èˆ¬å‘¨æœŸçš„å‡½æ•°çš„å‚…é‡Œå¶çº§æ•°" class="headerlink" title="ä¸€èˆ¬å‘¨æœŸçš„å‡½æ•°çš„å‚…é‡Œå¶çº§æ•°"></a>ä¸€èˆ¬å‘¨æœŸçš„å‡½æ•°çš„å‚…é‡Œå¶çº§æ•°</h1><h2 id="å‘¨æœŸä¸º2lçš„å‚…é‡Œå¶çº§æ•°"><a href="#å‘¨æœŸä¸º2lçš„å‚…é‡Œå¶çº§æ•°" class="headerlink" title="å‘¨æœŸä¸º2lçš„å‚…é‡Œå¶çº§æ•°"></a>å‘¨æœŸä¸º2lçš„å‚…é‡Œå¶çº§æ•°</h2><p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/1.png" style="zoom:80%;"></p>
<h3 id="å®šç†"><a href="#å®šç†" class="headerlink" title="å®šç†"></a>å®šç†</h3><p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/2.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/3.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/4.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/5.png" style="zoom:80%;"></p>
<h3 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/7.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/8.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/9.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/10.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/11.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/12.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/13.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/16.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/19.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/20.png" style="zoom:80%;"></p>
<h3 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h3><p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/14.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/15.png" style="zoom:80%;"></p>
<h2 id="å‚…é‡Œå¶çº§æ•°çš„å¤æ•°å½¢å¼"><a href="#å‚…é‡Œå¶çº§æ•°çš„å¤æ•°å½¢å¼" class="headerlink" title="å‚…é‡Œå¶çº§æ•°çš„å¤æ•°å½¢å¼"></a>å‚…é‡Œå¶çº§æ•°çš„å¤æ•°å½¢å¼</h2><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/17.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/18.png" style="zoom:80%;"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jasonâ€˜s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/" class="post-title-link" itemprop="url">å‚…é‡Œå¶çº§æ•°</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-10 00:33:40" itemprop="dateCreated datePublished" datetime="2020-06-10T00:33:40+08:00">2020-06-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-13 18:40:12" itemprop="dateModified" datetime="2020-06-13T18:40:12+08:00">2020-06-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="å‚…é‡Œå¶çº§æ•°"><a href="#å‚…é‡Œå¶çº§æ•°" class="headerlink" title="å‚…é‡Œå¶çº§æ•°"></a>å‚…é‡Œå¶çº§æ•°</h1><h2 id="ä¸‰è§’çº§æ•°å’Œä¸‰è§’å‡½æ•°ç³»å¾—æ­£äº¤æ€§"><a href="#ä¸‰è§’çº§æ•°å’Œä¸‰è§’å‡½æ•°ç³»å¾—æ­£äº¤æ€§" class="headerlink" title="ä¸‰è§’çº§æ•°å’Œä¸‰è§’å‡½æ•°ç³»å¾—æ­£äº¤æ€§"></a>ä¸‰è§’çº§æ•°å’Œä¸‰è§’å‡½æ•°ç³»å¾—æ­£äº¤æ€§</h2><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/1.png" style="zoom: 67%;"></p>
<h3 id="å®šç†1"><a href="#å®šç†1" class="headerlink" title="å®šç†1"></a>å®šç†1</h3><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/2.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/3.png" style="zoom: 67%;"></p>
<h2 id="å‡½æ•°å±•å¼€æˆå‚…é‡Œå¶çº§æ•°"><a href="#å‡½æ•°å±•å¼€æˆå‚…é‡Œå¶çº§æ•°" class="headerlink" title="å‡½æ•°å±•å¼€æˆå‚…é‡Œå¶çº§æ•°"></a>å‡½æ•°å±•å¼€æˆå‚…é‡Œå¶çº§æ•°</h2><h2 id="å®šç†2"><a href="#å®šç†2" class="headerlink" title="å®šç†2"></a>å®šç†2</h2><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/4.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/5.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/6.png" style="zoom: 67%;"></p>
<h3 id="å®šç†3ï¼ˆæ”¶æ•›å±•å¼€å®šç†ï¼‰"><a href="#å®šç†3ï¼ˆæ”¶æ•›å±•å¼€å®šç†ï¼‰" class="headerlink" title="å®šç†3ï¼ˆæ”¶æ•›å±•å¼€å®šç†ï¼‰"></a>å®šç†3ï¼ˆæ”¶æ•›å±•å¼€å®šç†ï¼‰</h3><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/7.png" style="zoom: 67%;"></p>
<h3 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><h4 id="1"><a href="#1" class="headerlink" title="1"></a>1</h4><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/8.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/9.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/10.png" style="zoom: 67%;"></p>
<h4 id="2"><a href="#2" class="headerlink" title="2"></a>2</h4><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/12.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/13.png" style="zoom: 67%;"></p>
<h4 id="3"><a href="#3" class="headerlink" title="3"></a>3</h4><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/14.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/15.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/16.png" style="zoom: 67%;"></p>
<h3 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h3><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/11.png" style="zoom: 67%;"></p>
<h2 id="æ­£å¼¦å‡½æ•°å’Œä½™å¼¦å‡½æ•°"><a href="#æ­£å¼¦å‡½æ•°å’Œä½™å¼¦å‡½æ•°" class="headerlink" title="æ­£å¼¦å‡½æ•°å’Œä½™å¼¦å‡½æ•°"></a>æ­£å¼¦å‡½æ•°å’Œä½™å¼¦å‡½æ•°</h2><h3 id="å‘¨æœŸä¸º2-pi-çš„å¥‡å¶å‡½æ•°çš„å‚…é‡Œå¶çº§æ•°"><a href="#å‘¨æœŸä¸º2-pi-çš„å¥‡å¶å‡½æ•°çš„å‚…é‡Œå¶çº§æ•°" class="headerlink" title="å‘¨æœŸä¸º2$\pi$ çš„å¥‡å¶å‡½æ•°çš„å‚…é‡Œå¶çº§æ•°"></a>å‘¨æœŸä¸º2$\pi$ çš„å¥‡å¶å‡½æ•°çš„å‚…é‡Œå¶çº§æ•°</h3><h4 id="å®šç†4"><a href="#å®šç†4" class="headerlink" title="å®šç†4"></a>å®šç†4</h4><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/17.png" style="zoom: 67%;"></p>
<h4 id="ä¾‹é¢˜-1"><a href="#ä¾‹é¢˜-1" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h4><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/18.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/19.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/20.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/21.png" style="zoom: 67%;"></p>
<h3 id="å®šä¹‰åœ¨-0-pi-ä¸Šçš„å‡½æ•°çš„å‚…é‡Œå¶çº§æ•°"><a href="#å®šä¹‰åœ¨-0-pi-ä¸Šçš„å‡½æ•°çš„å‚…é‡Œå¶çº§æ•°" class="headerlink" title="å®šä¹‰åœ¨[0,pi]ä¸Šçš„å‡½æ•°çš„å‚…é‡Œå¶çº§æ•°"></a>å®šä¹‰åœ¨[0,pi]ä¸Šçš„å‡½æ•°çš„å‚…é‡Œå¶çº§æ•°</h3><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/22.png" style="zoom: 67%;"></p>
<h4 id="ä¾‹é¢˜-2"><a href="#ä¾‹é¢˜-2" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h4><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/23.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/24.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/25.png" style="zoom: 67%;"></p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/26.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/27.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/28.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/29.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/30.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/31.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/32.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/33.png" style="zoom: 67%;"></p>
<h2 id="è§£é¢˜æ­¥éª¤å’ŒæŠ€å·§"><a href="#è§£é¢˜æ­¥éª¤å’ŒæŠ€å·§" class="headerlink" title="è§£é¢˜æ­¥éª¤å’ŒæŠ€å·§"></a>è§£é¢˜æ­¥éª¤å’ŒæŠ€å·§</h2><p>ç‰¢è®°ä¸€äº›ç»“è®º</p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/1.jpg" style="zoom: 67%;"></p>
<h2 id="è¯¾æœ¬ç»ƒä¹ "><a href="#è¯¾æœ¬ç»ƒä¹ " class="headerlink" title="è¯¾æœ¬ç»ƒä¹ "></a>è¯¾æœ¬ç»ƒä¹ </h2><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/2.jpg" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/3.jpg" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/4.jpg" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/5.jpg" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/6.jpg" style="zoom: 67%;"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jasonâ€˜s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/" class="post-title-link" itemprop="url">å‡½æ•°å±•å¼€æˆå¹‚çº§æ•°åŠå…¶åº”ç”¨</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-10 00:33:26" itemprop="dateCreated datePublished" datetime="2020-06-10T00:33:26+08:00">2020-06-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-09 12:09:10" itemprop="dateModified" datetime="2020-09-09T12:09:10+08:00">2020-09-09</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="å‡½æ•°å±•å¼€æˆå¹‚çº§æ•°åŠå…¶åº”ç”¨"><a href="#å‡½æ•°å±•å¼€æˆå¹‚çº§æ•°åŠå…¶åº”ç”¨" class="headerlink" title="å‡½æ•°å±•å¼€æˆå¹‚çº§æ•°åŠå…¶åº”ç”¨"></a>å‡½æ•°å±•å¼€æˆå¹‚çº§æ•°åŠå…¶åº”ç”¨</h1><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/1.png" style="zoom:80%;"></p>
<h2 id="æ³°å‹’çº§æ•°"><a href="#æ³°å‹’çº§æ•°" class="headerlink" title="æ³°å‹’çº§æ•°"></a>æ³°å‹’çº§æ•°</h2><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/2.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/4.png" style="zoom: 67%;"></p>
<h3 id="å®šç†1"><a href="#å®šç†1" class="headerlink" title="å®šç†1"></a>å®šç†1</h3><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/5.png" style="zoom: 67%;"></p>
<h3 id="å®šç†2"><a href="#å®šç†2" class="headerlink" title="å®šç†2"></a>å®šç†2</h3><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/6.png" style="zoom: 67%;"> </p>
<h2 id="å‡½æ•°å±•å¼€æˆå¹‚çº§æ•°"><a href="#å‡½æ•°å±•å¼€æˆå¹‚çº§æ•°" class="headerlink" title="å‡½æ•°å±•å¼€æˆå¹‚çº§æ•°"></a>å‡½æ•°å±•å¼€æˆå¹‚çº§æ•°</h2><h3 id="ç›´æ¥å±•å¼€æ³•"><a href="#ç›´æ¥å±•å¼€æ³•" class="headerlink" title="ç›´æ¥å±•å¼€æ³•"></a>ç›´æ¥å±•å¼€æ³•</h3><p>ç”±æ³°å‹’çº§æ•°ç†è®ºå¯çŸ¥ï¼Œå‡½æ•°f(x) å±•å¼€æˆå¹‚çº§æ•°çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>æ±‚å‡½æ•°åŠå…¶å„é˜¶å¯¼æ•°åœ¨x=0 å¤„çš„å€¼ï¼›</li>
<li>å†™å‡ºéº¦å…‹åŠ³æ—çº§æ•°ï¼Œå¹¶æ±‚å‡ºå…¶æ”¶æ•›åŠå¾„ä¸ºR</li>
<li>åˆ¤åˆ«åœ¨ æ”¶æ•›åŒºé—´ï¼ˆ-R,R) å†… $\lim\limits_{n-&gt;\infty}R_n(x) $ï¼ˆä½™é¡¹ï¼‰æ˜¯å¦ä¸º0</li>
</ol>
<p>å±•å¼€ä¸ºå¹‚çº§æ•°ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯å±•å¼€æˆéº¦å…‹åŠ³æ—çº§æ•° </p>
<h3 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><h4 id="1"><a href="#1" class="headerlink" title="1"></a>1</h4><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/8.png" style="zoom: 50%;"></p>
<h4 id="2"><a href="#2" class="headerlink" title="2"></a>2</h4><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/9.png" style="zoom: 50%;"></p>
<h4 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h4><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/10.png" style="zoom: 50%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/11.png" style="zoom: 50%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/12.png" style="zoom: 50%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/13.png" style="zoom: 80%;"></p>
<h4 id="4"><a href="#4" class="headerlink" title="4."></a>4.</h4><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/20.png" style="zoom: 80%;"></p>
<h4 id="5"><a href="#5" class="headerlink" title="5."></a>5.</h4><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/21.png" style="zoom: 80%;"></p>
<h3 id="é—´æ¥å±•å¼€æ³•"><a href="#é—´æ¥å±•å¼€æ³•" class="headerlink" title="é—´æ¥å±•å¼€æ³•"></a>é—´æ¥å±•å¼€æ³•</h3><p>åˆ©ç”¨ä¸€äº›å·²çŸ¥å‡½æ•°çš„å±•å¼€å¼å’Œå¹‚çº§æ•°çš„è¿ç®—æ€§è´¨ï¼Œå°†æ‰€ç»™å‡½æ•°å±•å¼€æˆå¹‚çº§æ•°</p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/14.png" style="zoom: 80%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/15.png" style="zoom: 80%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/16.png" style="zoom: 80%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/17.png" style="zoom: 80%;"></p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/18.png" style="zoom: 50%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/19.png" style="zoom: 50%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/28.png" style="zoom: 80%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/29.png" style="zoom: 80%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/31.png" style="zoom: 80%;"></p>
<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ‹“å±•çš„äºŒé¡¹å¼å®šç†è§£å†³å¾ˆå¤šé—®é¢˜</p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/32.png" style="zoom:120%;"></p>
<p>åˆæ¯”å¦‚</p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/1.jpg" style="zoom: 80%;"></p>
<h3 id="è§£é¢˜æ­¥éª¤"><a href="#è§£é¢˜æ­¥éª¤" class="headerlink" title="è§£é¢˜æ­¥éª¤"></a>è§£é¢˜æ­¥éª¤</h3><h4 id="å±•å¼€ä¸ºå¹‚çº§æ•°"><a href="#å±•å¼€ä¸ºå¹‚çº§æ•°" class="headerlink" title="å±•å¼€ä¸ºå¹‚çº§æ•°"></a>å±•å¼€ä¸ºå¹‚çº§æ•°</h4><h5 id="ä½éš¾åº¦"><a href="#ä½éš¾åº¦" class="headerlink" title="ä½éš¾åº¦"></a>ä½éš¾åº¦</h5><p>å¦‚æœæ˜¯ä¸‰è§’å‡½æ•°ï¼Œé‚£ä¹ˆé€šè¿‡é™å¹‚ï¼Œè½¬åŒ–ç­‰ï¼ŒåŒ–æˆ sin kx çš„å½¢å¼</p>
<p>å¦‚æœæ˜¯ä¸ªå¤æ‚çš„åˆ†å­å¼ï¼Œæˆ‘ä»¬éœ€è¦å› å¼åˆ†è§£ï¼Œç„¶åè½¬åŒ–æˆ  1/x+1 æˆ–è€…1/1-x çš„å½¢å¼</p>
<h5 id="é«˜éš¾åº¦"><a href="#é«˜éš¾åº¦" class="headerlink" title="é«˜éš¾åº¦"></a>é«˜éš¾åº¦</h5><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/22.png" style="zoom: 150%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/23.png" style="zoom: 150%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/24.png" style="zoom: 150%;"></p>
<p>ï¼ˆ9ï¼‰ $(1+x)ln(1+x)$  </p>
<h5 id="å¹‚çº§æ•°å±•å¼€ä¸å’Œå‡½æ•°"><a href="#å¹‚çº§æ•°å±•å¼€ä¸å’Œå‡½æ•°" class="headerlink" title="å¹‚çº§æ•°å±•å¼€ä¸å’Œå‡½æ•°"></a>å¹‚çº§æ•°å±•å¼€ä¸å’Œå‡½æ•°</h5><p> <img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/25.png" style="zoom: 67%;"></p>
<h4 id="å±•å¼€ä¸ºXXXçš„å¹‚çº§æ•°"><a href="#å±•å¼€ä¸ºXXXçš„å¹‚çº§æ•°" class="headerlink" title="å±•å¼€ä¸ºXXXçš„å¹‚çº§æ•°"></a>å±•å¼€ä¸ºXXXçš„å¹‚çº§æ•°</h4><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/26.png" style="zoom: 120%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/27.png" style="zoom: 120%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/2.jpg" style="zoom: 120%;"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/10/%E6%B5%85%E8%B0%88redux2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jasonâ€˜s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/10/%E6%B5%85%E8%B0%88redux2/" class="post-title-link" itemprop="url">æµ…è°ˆredux2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-10 00:19:09" itemprop="dateCreated datePublished" datetime="2020-06-10T00:19:09+08:00">2020-06-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-13 14:21:28" itemprop="dateModified" datetime="2020-08-13T14:21:28+08:00">2020-08-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="æµ…è°ˆredux2"><a href="#æµ…è°ˆredux2" class="headerlink" title="æµ…è°ˆredux2"></a>æµ…è°ˆredux2</h1><h2 id="Debugging-Redux-Applications"><a href="#Debugging-Redux-Applications" class="headerlink" title="Debugging Redux Applications"></a>Debugging Redux Applications</h2><h3 id="Installing-Redux-DevTools"><a href="#Installing-Redux-DevTools" class="headerlink" title="Installing Redux DevTools"></a>Installing Redux DevTools</h3><h3 id="The-Basics"><a href="#The-Basics" class="headerlink" title="The Basics"></a>The Basics</h3><h3 id="Inspector-Monitor"><a href="#Inspector-Monitor" class="headerlink" title="Inspector Monitor"></a>Inspector Monitor</h3><h3 id="Tracing"><a href="#Tracing" class="headerlink" title="Tracing"></a>Tracing</h3><h3 id="Exporting-and-Importing"><a href="#Exporting-and-Importing" class="headerlink" title="Exporting and Importing"></a>Exporting and Importing</h3><h2 id="Writing-Clean-Redux-Code"><a href="#Writing-Clean-Redux-Code" class="headerlink" title="Writing Clean Redux Code"></a>Writing Clean Redux Code</h2><h3 id="Structuring-Files-and-Folders"><a href="#Structuring-Files-and-Folders" class="headerlink" title="Structuring Files and Folders"></a>Structuring Files and Folders</h3><h3 id="Ducks-Pattern"><a href="#Ducks-Pattern" class="headerlink" title="Ducks Pattern"></a>Ducks Pattern</h3><h3 id="Redux-Toolkit"><a href="#Redux-Toolkit" class="headerlink" title="Redux Toolkit"></a>Redux Toolkit</h3><h3 id="Creating-the-Store"><a href="#Creating-the-Store" class="headerlink" title="Creating the Store"></a>Creating the Store</h3><h3 id="Creating-Actions"><a href="#Creating-Actions" class="headerlink" title="Creating Actions"></a>Creating Actions</h3><h3 id="Creating-Reducers"><a href="#Creating-Reducers" class="headerlink" title="Creating Reducers"></a>Creating Reducers</h3><h3 id="Creating-Slices"><a href="#Creating-Slices" class="headerlink" title="Creating Slices"></a>Creating Slices</h3><h3 id="Exercise"><a href="#Exercise" class="headerlink" title="Exercise"></a>Exercise</h3><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><h2 id="Designing-the-Store"><a href="#Designing-the-Store" class="headerlink" title="Designing the Store"></a>Designing the Store</h2><h3 id="Redux-State-vs-Local-State"><a href="#Redux-State-vs-Local-State" class="headerlink" title="Redux State vs Local State"></a>Redux State vs Local State</h3><h3 id="Structuring-a-Redux-Store"><a href="#Structuring-a-Redux-Store" class="headerlink" title="Structuring a Redux Store"></a>Structuring a Redux Store</h3><h3 id="Combining-Reducers"><a href="#Combining-Reducers" class="headerlink" title="Combining Reducers"></a>Combining Reducers</h3><h3 id="Normalization"><a href="#Normalization" class="headerlink" title="Normalization"></a>Normalization</h3><h3 id="Selectors"><a href="#Selectors" class="headerlink" title="Selectors"></a>Selectors</h3><h3 id="Memoizing-Selectors-with-Reselect"><a href="#Memoizing-Selectors-with-Reselect" class="headerlink" title="Memoizing Selectors with Reselect"></a>Memoizing Selectors with Reselect</h3><h3 id="Exercise-1"><a href="#Exercise-1" class="headerlink" title="Exercise"></a>Exercise</h3><h3 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h3><h2 id="Middleware"><a href="#Middleware" class="headerlink" title="Middleware"></a>Middleware</h2><h3 id="What-is-Middleware"><a href="#What-is-Middleware" class="headerlink" title="What is Middleware"></a>What is Middleware</h3><h3 id="Creating-Middleware"><a href="#Creating-Middleware" class="headerlink" title="Creating Middleware"></a>Creating Middleware</h3><h3 id="Parameterizing-Middleware"><a href="#Parameterizing-Middleware" class="headerlink" title="Parameterizing Middleware"></a>Parameterizing Middleware</h3><h3 id="Dispatching-Functions"><a href="#Dispatching-Functions" class="headerlink" title="Dispatching Functions"></a>Dispatching Functions</h3><h3 id="Exercise-2"><a href="#Exercise-2" class="headerlink" title="Exercise"></a>Exercise</h3><h3 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution"></a>Solution</h3><h3 id="A-Quick-Note"><a href="#A-Quick-Note" class="headerlink" title="A Quick Note"></a>A Quick Note</h3><h2 id="Consuming-APIs"><a href="#Consuming-APIs" class="headerlink" title="Consuming APIs"></a>Consuming APIs</h2><h3 id="Setting-Up-the-Backend"><a href="#Setting-Up-the-Backend" class="headerlink" title="Setting Up the Backend"></a>Setting Up the Backend</h3><h3 id="The-Approach"><a href="#The-Approach" class="headerlink" title="The Approach"></a>The Approach</h3><h3 id="API-Middleware"><a href="#API-Middleware" class="headerlink" title="API Middleware"></a>API Middleware</h3><h3 id="Actions"><a href="#Actions" class="headerlink" title="Actions"></a>Actions</h3><h3 id="Restructuring-the-Store"><a href="#Restructuring-the-Store" class="headerlink" title="Restructuring the Store"></a>Restructuring the Store</h3><h3 id="Getting-Data-from-the-Server"><a href="#Getting-Data-from-the-Server" class="headerlink" title="Getting Data from the Server"></a>Getting Data from the Server</h3><h3 id="Loading-Indicators"><a href="#Loading-Indicators" class="headerlink" title="Loading Indicators"></a>Loading Indicators</h3><h3 id="Caching"><a href="#Caching" class="headerlink" title="Caching"></a>Caching</h3><h3 id="Saving-Data-to-the-Server"><a href="#Saving-Data-to-the-Server" class="headerlink" title="Saving Data to the Server"></a>Saving Data to the Server</h3><h3 id="Exercise-3"><a href="#Exercise-3" class="headerlink" title="Exercise"></a>Exercise</h3><h3 id="Solution-Resolving-Bugs"><a href="#Solution-Resolving-Bugs" class="headerlink" title="Solution- Resolving Bugs"></a>Solution- Resolving Bugs</h3><h3 id="Solution-Assigning-a-Bug-to-a-User"><a href="#Solution-Assigning-a-Bug-to-a-User" class="headerlink" title="Solution- Assigning a Bug to a User"></a>Solution- Assigning a Bug to a User</h3><h3 id="Reducing-Coupling"><a href="#Reducing-Coupling" class="headerlink" title="Reducing Coupling"></a>Reducing Coupling</h3><h3 id="Cohesion"><a href="#Cohesion" class="headerlink" title="Cohesion"></a>Cohesion</h3><h2 id="Testing-Redux-Applications"><a href="#Testing-Redux-Applications" class="headerlink" title="Testing Redux Applications"></a>Testing Redux Applications</h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><h3 id="What-is-Automated-Testing"><a href="#What-is-Automated-Testing" class="headerlink" title="What is Automated Testing"></a>What is Automated Testing</h3><h3 id="Setting-Up-the-Testing-Environment"><a href="#Setting-Up-the-Testing-Environment" class="headerlink" title="Setting Up the Testing Environment"></a>Setting Up the Testing Environment</h3><h3 id="Your-First-Unit-Test"><a href="#Your-First-Unit-Test" class="headerlink" title="Your First Unit Test"></a>Your First Unit Test</h3><h3 id="Unit-Testing-Redux-Applications"><a href="#Unit-Testing-Redux-Applications" class="headerlink" title="Unit Testing Redux Applications"></a>Unit Testing Redux Applications</h3><h3 id="Solitary-Tests"><a href="#Solitary-Tests" class="headerlink" title="Solitary Tests"></a>Solitary Tests</h3><h3 id="Social-Tests"><a href="#Social-Tests" class="headerlink" title="Social Tests"></a>Social Tests</h3><h3 id="Mocking-HTTP-Calls"><a href="#Mocking-HTTP-Calls" class="headerlink" title="Mocking HTTP Calls"></a>Mocking HTTP Calls</h3><h3 id="Writing-Clean-Tests"><a href="#Writing-Clean-Tests" class="headerlink" title="Writing Clean Tests"></a>Writing Clean Tests</h3><h3 id="Test-Coverage"><a href="#Test-Coverage" class="headerlink" title="Test Coverage"></a>Test Coverage</h3><h3 id="Exercises"><a href="#Exercises" class="headerlink" title="Exercises"></a>Exercises</h3><h3 id="Solution-getUnresolvedBugs"><a href="#Solution-getUnresolvedBugs" class="headerlink" title="Solution- getUnresolvedBugs"></a>Solution- getUnresolvedBugs</h3><h3 id="Solution-resolveBug"><a href="#Solution-resolveBug" class="headerlink" title="Solution- resolveBug"></a>Solution- resolveBug</h3><h3 id="Solution-loadingBugs"><a href="#Solution-loadingBugs" class="headerlink" title="Solution- loadingBugs"></a>Solution- loadingBugs</h3><h3 id="A-Quick-Note-1"><a href="#A-Quick-Note-1" class="headerlink" title="A Quick Note"></a>A Quick Note</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/08/Express%E6%A1%86%E6%9E%B6%E5%9C%A8%E5%90%8E%E7%AB%AF%E7%9A%84%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jasonâ€˜s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/08/Express%E6%A1%86%E6%9E%B6%E5%9C%A8%E5%90%8E%E7%AB%AF%E7%9A%84%E5%BA%94%E7%94%A8/" class="post-title-link" itemprop="url">Expressæ¡†æ¶åœ¨åç«¯çš„åº”ç”¨</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-08 20:26:47" itemprop="dateCreated datePublished" datetime="2020-06-08T20:26:47+08:00">2020-06-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-30 10:38:54" itemprop="dateModified" datetime="2020-06-30T10:38:54+08:00">2020-06-30</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Expressæ¡†æ¶åœ¨åç«¯çš„åº”ç”¨"><a href="#Expressæ¡†æ¶åœ¨åç«¯çš„åº”ç”¨" class="headerlink" title="Expressæ¡†æ¶åœ¨åç«¯çš„åº”ç”¨"></a>Expressæ¡†æ¶åœ¨åç«¯çš„åº”ç”¨</h1><p>åœ¨å†™åç«¯çš„æ—¶å€™ï¼Œæ—¶å¸¸è¦ç”¨åˆ°æˆ‘çš„å­¦ä¹ åšå®¢</p>
<p>è€ƒè™‘åˆ°åŸºç¡€åšå®¢çš„ç¯‡å¹…æ™®éè¿‡é•¿ï¼Œæ‰€ä»¥ä¸ºäº†é˜…è¯»çš„ä½“éªŒï¼Œæœ¬æ–‡æ‰€æœ‰é“¾æ¥ç‚¹å‡»å³å¯è·³è½¬è‡³ç›¸åº”ç« èŠ‚</p>
<p><a href="https://jasonxqh.github.io/2020/06/07/NodejsåŸºç¡€1/#more">NodejsåŸºç¡€1</a></p>
<p><a href="https://jasonxqh.github.io/2020/06/07/NodejsåŸºç¡€2/#more"> NodejsåŸºç¡€2</a></p>
<p><a href="https://jasonxqh.github.io/2020/06/07/NodejsåŸºç¡€3/#more">NodejsåŸºç¡€3</a></p>
<p><a href="https://jasonxqh.github.io/2020/06/07/NodejsåŸºç¡€4/#more">NodejsåŸºç¡€4</a></p>
<h2 id="æ ¹ç›®å½•"><a href="#æ ¹ç›®å½•" class="headerlink" title="æ ¹ç›®å½•"></a>æ ¹ç›®å½•</h2><h3 id="server-js"><a href="#server-js" class="headerlink" title="server.js"></a><code>server.js</code></h3><p>server.jsæ˜¯æœ€é‡è¦çš„ä¸€ä¸ªæ–‡ä»¶äº†ï¼Œä»–å°±åƒä¸€æ£µæ ‘çš„æ ‘æ ¹ï¼Œæ–‡ä»¶ä»å®ƒå¼€å§‹è¡ç”Ÿå¼€æ¥</p>
<p>åœ¨<a href="https://jasonxqh.github.io/2020/06/07/NodejsåŸºç¡€1/#Middleware">NodejsåŸºç¡€1çš„Middlewareç« èŠ‚</a>ä¸­ï¼Œæˆ‘è¯¦ç»†è®²äº† expresss.json(),express.urlencoded(),express.static(),morgan.helmetè¿™äº›ä¸­é—´ä»¶ã€‚æ‰€ä»¥ä»–ä»¬çš„ä½œç”¨æˆ‘åœ¨è¿™é‡Œä¸ç»†è®²äº†</p>
<p>corsåŒ…æ˜¯ç”¨æ¥è·¨åŸŸçš„ï¼Œè¿™ç‚¹åœ¨<a href="https://jasonxqh.github.io/2020/06/07/Reactæ¡†æ¶åœ¨ä½œä¸šå½“ä¸­çš„åº”ç”¨/#more">Reactæ¡†æ¶åœ¨ä½œä¸šå½“ä¸­çš„åº”ç”¨</a> ä¸­çš„setupProxy.jsæœ‰æåˆ°ï¼Œ</p>
<p>bodyParseræ˜¯å½“è¯·æ±‚ä½“è§£æä¹‹åï¼Œè§£æå€¼ä¼šè¢«æ”¾åˆ°req.bodyå±æ€§ä¸­ï¼Œå½“å†…å®¹ä¸ºç©ºæ—¶å€™ï¼Œä¸ºä¸€ä¸ªç©ºå¯¹è±¡{}ï¼Œjson()â€”è§£æJSONæ ¼å¼ <a href="https://www.jianshu.com/p/cd3de110b4b6" target="_blank" rel="noopener">Expressä¸­é—´ä»¶body-parser</a></p>
<p>ç„¶åæ˜¯ä¸€ä¸ªç™»é™†æ“ä½œï¼Œæˆ‘ä¸ºäº†è¿æ¥æ–¹ä¾¿è€Œä¸”å¤šç”µè„‘ç«¯éƒ½å¯ä»¥ä½¿ç”¨ï¼Œæ‰€ä»¥æŠŠæ•°æ®éƒ½ä¸Šè½½åˆ°äº†äº‘æ•°æ®åº“å½“ä¸­ã€‚é€šè¿‡å°†useNewUrlParserè®¾ç½®ä¸ºtrueæ¥é¿å…â€œä¸å»ºè®®ä½¿ç”¨å½“å‰URLå­—ç¬¦ä¸²è§£æå™¨â€è­¦å‘Š</p>
<p>å†åæ¥å°±æ˜¯æŠŠæ‰€æœ‰çš„è·¯ç”±æ¥å£å…¨éƒ¨å¯¼å…¥ï¼Œç„¶åæŠŠå‰ç¼€å…¨æ”¹ä¸º/apiï¼Œä¸ºäº†åœ¨apiRoutesä¸­å¯ä»¥çœç•¥/api</p>
<p>æœ€åå¯¼å…¥ä¸€ä¸ªæ£€æŸ¥é”™è¯¯çš„ä¸­é—´ä»¶ã€‚ç”¨æ¥æ£€æŸ¥éæ³•çš„è·¯ç”±å’Œç™»é™†é”™è¯¯</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>); </span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">'cors'</span>);</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> server = express();</span><br><span class="line"> </span><br><span class="line">server.use(cors());</span><br><span class="line">server.use(express.json());</span><br><span class="line">server.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">server.use(express.static(path.join(__dirname, <span class="string">'public'</span>)));</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line">server.use(bodyParser.json());</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> helmet = <span class="built_in">require</span>(<span class="string">'helmet'</span>);</span><br><span class="line">server.use(helmet());</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> logger = <span class="built_in">require</span>(<span class="string">"morgan"</span>);</span><br><span class="line"><span class="comment">//è¿™æ˜¯åœ¨ç»ˆç«¯æ‰“å°æ—¥å¿—ã€‚</span></span><br><span class="line">server.use(logger(<span class="string">"dev"</span>));</span><br><span class="line"><span class="comment">//è¿™æ˜¯æŠŠæ—¥å¿—å†™å…¥æ–‡ä»¶ä»¥ä¾›å‚é˜…ã€‚</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">var</span> accessLog = fs.createWriteStream(<span class="string">"./access.csv"</span>, &#123; <span class="attr">flags</span>: <span class="string">"a"</span> &#125;);</span><br><span class="line">server.use(logger(<span class="string">"combined"</span>, &#123; <span class="attr">stream</span>: accessLog &#125;));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; connectionStr &#125; = <span class="built_in">require</span>(<span class="string">'./config'</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ä¸ºäº†è¯»å–æ–¹ä¾¿ï¼Œä¸”èƒ½å¤šäººä½¿ç”¨ã€‚æˆ‘å·²ç»æŠŠæœ¬åœ°çš„æ•°æ®å…¨éƒ¨ç§»åŠ¨åˆ°äº†äº‘æ•°æ®åº“</span></span><br><span class="line"><span class="comment">https://cloud.mongodb.com/</span></span><br><span class="line"><span class="comment">ç„¶ååªè¦è·å–ç™»å½•é“¾æ¥å³å¯ï¼š</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// Connect to the Mongo database</span></span><br><span class="line">mongoose.Promise = global.Promise;</span><br><span class="line">mongoose.connect(connectionStr, &#123; <span class="attr">useNewUrlParser</span>: <span class="literal">true</span> &#125;, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'MongoDB Connect Success!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set up the routes</span></span><br><span class="line"><span class="keyword">const</span> apiRoutes = <span class="built_in">require</span>(<span class="string">'./src/routes/api-routes'</span>);</span><br><span class="line"></span><br><span class="line">server.use(<span class="string">'/api'</span>, apiRoutes);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Handle errors</span></span><br><span class="line"><span class="keyword">const</span> errorHandlers = <span class="built_in">require</span>(<span class="string">'./src/middleware/error-handlers'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Catch all invalid routes</span></span><br><span class="line">server.use(errorHandlers.invalidRoute);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Handle mongoose errors</span></span><br><span class="line">server.use(errorHandlers.validationErrors);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Export the server object</span></span><br><span class="line"><span class="built_in">module</span>.exports = server;</span><br></pre></td></tr></table></figure>
<h3 id="è®°å½•æ—¥å¿—å§‹æœ«"><a href="#è®°å½•æ—¥å¿—å§‹æœ«" class="headerlink" title="è®°å½•æ—¥å¿—å§‹æœ«"></a>è®°å½•æ—¥å¿—å§‹æœ«</h3><h4 id="é˜¶æ®µ1"><a href="#é˜¶æ®µ1" class="headerlink" title="é˜¶æ®µ1"></a>é˜¶æ®µ1</h4><p>ä¸€å¼€å§‹ï¼Œæˆ‘æ‰ç”¨äº†morganæ¥è®°å½•æ—¥å¿—</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> logger = <span class="built_in">require</span>(<span class="string">"morgan"</span>);</span><br><span class="line"><span class="comment">//è¿™æ˜¯åœ¨ç»ˆç«¯æ‰“å°æ—¥å¿—ã€‚</span></span><br><span class="line">server.use(logger(<span class="string">"dev"</span>));</span><br></pre></td></tr></table></figure>
<p>ä½†è¿™æ ·åªæ˜¯æ‰“åœ¨ç»ˆç«¯é‡Œï¼Œæ˜¾ç„¶æˆ‘ä»¬æ˜¯ä¸æ»¡è¶³çš„</p>
<h4 id="é˜¶æ®µ2"><a href="#é˜¶æ®µ2" class="headerlink" title="é˜¶æ®µ2"></a>é˜¶æ®µ2</h4><p>ç„¶åï¼Œæˆ‘ä»¬å‘æŠŠæ—¥å¿—è®°å½•åœ¨.csv æ–‡ä»¶ä¸­</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">var</span> accessLog = fs.createWriteStream(<span class="string">"./access.csv"</span>, &#123; <span class="attr">flags</span>: <span class="string">"a"</span> &#125;);</span><br><span class="line">server.use(logger(<span class="string">"combined"</span>, &#123; <span class="attr">stream</span>: accessLog &#125;));</span><br></pre></td></tr></table></figure>
<p>å¯åŠ¨æœåŠ¡åï¼Œæˆ‘ä»¬çœ‹åˆ°åœ¨æ ¹ç›®å½•ä¸‹çš„access.csvæ–‡ä»¶ä¸­è®°å½•ä¸‹äº†æ—¥å¿—</p>
<p><img src="/2020/06/08/Express%E6%A1%86%E6%9E%B6%E5%9C%A8%E5%90%8E%E7%AB%AF%E7%9A%84%E5%BA%94%E7%94%A8/1.png" style="zoom: 50%;"></p>
<p>è¿™é‡Œæˆ‘å…ˆå¯¼å…¥åˆ°csvæ–‡ä»¶å½“ä¸­ï¼Œç„¶åå†åˆ©ç”¨DataGripå®šæœŸå¯¼å…¥è¿™ä¸ªaccess.csvæ–‡ä»¶æ¥è¾¾åˆ°æ•°æ®åº“å­˜å‚¨çš„ä¸€ä¸ªæ•ˆæœã€‚ï¼ˆè™½ç„¶è¿™ä¹ˆåšä¸æ˜¯å¾ˆæ­£è§„ã€‚ã€‚ã€‚ï¼‰</p>
<p><img src="/2020/06/08/Express%E6%A1%86%E6%9E%B6%E5%9C%A8%E5%90%8E%E7%AB%AF%E7%9A%84%E5%BA%94%E7%94%A8/2.png" style="zoom: 55%;"></p>
<h4 id="é˜¶æ®µ3"><a href="#é˜¶æ®µ3" class="headerlink" title="é˜¶æ®µ3"></a>é˜¶æ®µ3</h4><p>å†ç„¶åï¼Œæˆ‘ä»¬åˆ©ç”¨morganæŠŠæ—¥å¿—è®°å½•åœ¨ mongodbå½“ä¸­ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬åœ¨modelsæ–‡ä»¶å¤¹ä¸‹æ–°å»ºlog.js</p>
<p>ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘å°±ä¸æå¤´å»å°¾äº†ã€‚ç›´æ¥è®°å½•æ•´æ¡æ—¥å¿—</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// models/log.js</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; Schema, model &#125; = mongoose;</span><br><span class="line"><span class="keyword">let</span> Log = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  line: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    <span class="keyword">default</span>: <span class="string">""</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">"Log"</span>, Log);</span><br></pre></td></tr></table></figure>
<p>ç„¶åæˆ‘ä»¬åœ¨sever.jsä¸­å¼•å…¥</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> logger = <span class="built_in">require</span>(<span class="string">"morgan"</span>);</span><br><span class="line"><span class="keyword">const</span> Log = <span class="built_in">require</span>(<span class="string">'./../server/src/models/log'</span>)</span><br><span class="line"><span class="keyword">var</span> writeToDB = &#123;</span><br><span class="line">  write: <span class="function"><span class="keyword">function</span> (<span class="params">line</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ele = <span class="keyword">new</span> Log(&#123;</span><br><span class="line">       line: line</span><br><span class="line">    &#125;)</span><br><span class="line">    ele.save(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'err'</span>, err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">server.use(logger(<span class="string">"combined"</span>, &#123;<span class="attr">stream</span>: writeToDB&#125;))</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±åœ¨mongodbä¸­è®°å½•ä¸‹äº†æ—¥å¿—äº†.</p>
<p><img src="/2020/06/08/Express%E6%A1%86%E6%9E%B6%E5%9C%A8%E5%90%8E%E7%AB%AF%E7%9A%84%E5%BA%94%E7%94%A8/3.png" style="zoom: 55%;"></p>
<h4 id="é˜¶æ®µ4"><a href="#é˜¶æ®µ4" class="headerlink" title="é˜¶æ®µ4"></a>é˜¶æ®µ4</h4><p>æœ€åï¼Œå­¦ä¹ äº†åŠ©æ•™çš„ä»£ç ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›æ—¥å¿—è®°å½•åœ¨mysqlå½“ä¸­</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> logger = <span class="built_in">require</span>(<span class="string">"morgan"</span>);</span><br><span class="line"><span class="keyword">const</span> logDAO = <span class="built_in">require</span>(<span class="string">'./../server/src/models/logDAO'</span>)</span><br><span class="line"><span class="keyword">let</span> method = <span class="string">''</span>;</span><br><span class="line">server.use(logger(<span class="function"><span class="keyword">function</span> (<span class="params">tokens, req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> request_time = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  <span class="keyword">var</span> request_method = tokens.method(req, res);</span><br><span class="line">  <span class="keyword">var</span> request_url = tokens.url(req, res);</span><br><span class="line">  <span class="keyword">var</span> status = tokens.status(req, res);</span><br><span class="line">  <span class="keyword">var</span> remote_addr = tokens[<span class="string">'remote-addr'</span>](req, res);</span><br><span class="line">  logDAO.userlog([request_time,request_method,request_url,status,remote_addr], <span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'æˆåŠŸä¿å­˜ï¼'</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>
<p><code>logDao.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”¨äºå­˜æ”¾ç”¨æˆ·æ“ä½œè®°å½•  æ—¥å¿—</span></span><br><span class="line"><span class="comment">//è¯¥æ–‡ä»¶æ²¡æœ‰ç”¨ï¼Œæœ€åé€‰æ‹©ä½¿ç”¨expressä¸­é—´ä»¶ morganè®°å½•æ—¥å¿—ï¼ˆapp.jsä¸­ï¼‰</span></span><br><span class="line"><span class="keyword">var</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mysqlConf = &#123;</span><br><span class="line">    mysql: &#123;</span><br><span class="line">        host: <span class="string">'localhost'</span>,</span><br><span class="line">        user: <span class="string">'root'</span>,</span><br><span class="line">        password: <span class="string">'root'</span>,</span><br><span class="line">        database:<span class="string">'crawl'</span>,</span><br><span class="line">        <span class="comment">// æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º10</span></span><br><span class="line">        connectionLimit: <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> pool = mysql.createPool(mysqlConf.mysql);</span><br><span class="line"><span class="comment">// ä½¿ç”¨äº†è¿æ¥æ± ï¼Œé‡å¤ä½¿ç”¨æ•°æ®åº“è¿æ¥ï¼Œè€Œä¸å¿…æ¯æ‰§è¡Œä¸€æ¬¡CRUDæ“ä½œå°±è·å–ã€é‡Šæ”¾ä¸€æ¬¡æ•°æ®åº“è¿æ¥ï¼Œä»è€Œæé«˜äº†å¯¹æ•°æ®åº“æ“ä½œçš„æ€§èƒ½ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è®°å½•ç”¨æˆ·æ“ä½œ</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    userlog :<span class="function"><span class="keyword">function</span> (<span class="params">useraction, callback</span>) </span>&#123;</span><br><span class="line">        pool.query(<span class="string">'insert into user_action(request_time,request_method,request_url,status,remote_addr) values(?,?,?,?,?)'</span>,</span><br><span class="line">            useraction, <span class="function"><span class="keyword">function</span> (<span class="params">error, result</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line">            callback(result.affectedRows &gt; <span class="number">0</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/08/Express%E6%A1%86%E6%9E%B6%E5%9C%A8%E5%90%8E%E7%AB%AF%E7%9A%84%E5%BA%94%E7%94%A8/4.png"></p>
<p>POST æ˜¯æ–°å»ºoperasæ“ä½œ</p>
<h3 id="config-js"><a href="#config-js" class="headerlink" title="config.js"></a><code>config.js</code></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  scrects: <span class="string">'test1234'</span>,</span><br><span class="line">  connectionStr:</span><br><span class="line">    <span class="string">'mongodb+srv://test1:1qaz!QAZ@cluster0-2ysvp.mongodb.net/test?retryWrites=true&amp;w=majority'</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="routesç›®å½•"><a href="#routesç›®å½•" class="headerlink" title="routesç›®å½•"></a>routesç›®å½•</h2><h3 id="api-routes-js"><a href="#api-routes-js" class="headerlink" title="api-routes.js"></a><code>api-routes.js</code></h3><p>api-routesæ˜¯æ‰€æœ‰çš„è·¯ç”±çš„é›†åˆï¼Œè¿™é‡ŒçœåŒºäº†/api/userså‰é¢çš„/apiï¼Œå› ä¸ºåœ¨server.jsä¸­å·²ç»å†™äº†å‰ç¼€/api</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> userRoutes = <span class="built_in">require</span>(<span class="string">'./user-routers'</span>);</span><br><span class="line"><span class="keyword">const</span> maoyanRoutes = <span class="built_in">require</span>(<span class="string">'./maoyan'</span>);</span><br><span class="line"><span class="keyword">const</span> doubanRoutes = <span class="built_in">require</span>(<span class="string">'./douban'</span>);</span><br><span class="line"><span class="keyword">const</span> operasRoutes = <span class="built_in">require</span>(<span class="string">'./operas'</span>);</span><br><span class="line"><span class="keyword">const</span> taobaoRoutes = <span class="built_in">require</span>(<span class="string">'./taobao'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"></span><br><span class="line">router.use(<span class="string">'/users'</span>, userRoutes);</span><br><span class="line">router.use(<span class="string">'/maoyan'</span>, maoyanRoutes);</span><br><span class="line">router.use(<span class="string">'/douban'</span>, doubanRoutes);</span><br><span class="line">router.use(<span class="string">'/operas'</span>, operasRoutes);</span><br><span class="line">router.use(<span class="string">'/taobao'</span>, taobaoRoutes);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
<p>ä¸‹é¢ä»‹ç»user-routerå’Œä»¥è±†ç“£ä¸ºä»£è¡¨çš„douban.jsï¼Œè¿™ä¸ªå‡ ä¸ªæ–‡ä»¶çš„ä½œç”¨ä¸»è¦æ˜¯å®šä¹‰apiæ¥å£ï¼Œç„¶åé€šè¿‡api-routesæ¥é›†æˆ</p>
<h3 id="user-router-js"><a href="#user-router-js" class="headerlink" title="user-router.js"></a><code>user-router.js</code></h3><p>user-routerä¸»è¦è§£å†³çš„æ˜¯ç”¨æˆ·çš„ç™»å½•å’Œæ³¨å†Œï¼Œç®¡ç†å‘˜çš„åˆ é™¤ç”¨æˆ·æ“ä½œã€‚ä¸ºäº†è®©æ–‡ä»¶çš„å±‚æ¬¡è§£æ„é²œæ˜ï¼Œå…·ä½“çš„æ“ä½œåœ¨controllerä¸­å®ç°ï¼Œè¿™é‡Œåªæ˜¯è§£æ„äº†controllerä¸­çš„å‡½æ•°å¹¶å¼•ç”¨ã€‚</p>
<p> å…·ä½“çš„apiåŠŸèƒ½æˆ‘åœ¨controllerä¼šè¯¦ç»†è§£é‡Š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="keyword">const</span> &#123; catchErrors &#125; = <span class="built_in">require</span>(<span class="string">'../middleware/error-handlers'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; authAdmin &#125; = <span class="built_in">require</span>(<span class="string">'../middleware/auth-handlers'</span>);</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">'express-jwt'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; scrects &#125; = <span class="built_in">require</span>(<span class="string">'../../config'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; register, login, findAll, getInfo, <span class="attr">delete</span>: del &#125; = <span class="built_in">require</span>(<span class="string">'../controllers/user'</span>);</span><br><span class="line"><span class="keyword">const</span> auth = jwt(&#123; <span class="attr">secret</span>: scrects &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// user api</span></span><br><span class="line">router.post(<span class="string">'/login'</span>, login); <span class="comment">// api/users/login</span></span><br><span class="line">router.post(<span class="string">'/register'</span>, catchErrors(register)); <span class="comment">//api/users/register</span></span><br><span class="line">router.get(<span class="string">'/info'</span>, auth, getInfo); <span class="comment">// api/users/info</span></span><br><span class="line"><span class="comment">// admin api</span></span><br><span class="line">router.get(<span class="string">'/list'</span>, auth, authAdmin, findAll); <span class="comment">//api/users/list</span></span><br><span class="line">router.post(<span class="string">'/:id/delete'</span>, auth, authAdmin, del);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
<h3 id="douban-js"><a href="#douban-js" class="headerlink" title="douban.js"></a><code>douban.js</code></h3><p> å…·ä½“çš„apiåŠŸèƒ½æˆ‘åœ¨controllerä¼šè¯¦ç»†è§£é‡Š</p>
<p>é¦–å…ˆæˆ‘ä»¬ä»controllerä¸­è§£æ„æˆ‘ä»¬éœ€è¦çš„å‡½æ•°ï¼Œç„¶åå†è·¯ç”±è§¦å‘çš„æ—¶å€™è°ƒç”¨è¿™äº›å‡½æ•°</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="keyword">const</span> &#123; findAll, insertMany, <span class="attr">delete</span>: del, getListByKey, getListByOr &#125; = <span class="built_in">require</span>(<span class="string">'../controllers/douban'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸€æ¬¡æ€§æ’å…¥å¤šæ¡æ•°æ®ï¼Œä¸ºäº†ä½¿ç”¨postManæ’å…¥å¤šæ¡æ•°æ®</span></span><br><span class="line">router.post(<span class="string">'/add'</span>, insertMany);</span><br><span class="line">router.post(<span class="string">'/delete/:id'</span>, del);</span><br><span class="line">router.get(<span class="string">'/list'</span>, findAll);</span><br><span class="line">router.get(<span class="string">'/getlist'</span>, getListByKey)</span><br><span class="line">router.get(<span class="string">'/getListOr'</span>, getListByOr)</span><br><span class="line">router.get(<span class="string">'/getAll'</span>, getAll)</span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
<h2 id="modelsç›®å½•"><a href="#modelsç›®å½•" class="headerlink" title="modelsç›®å½•"></a>modelsç›®å½•</h2><h3 id="schema"><a href="#schema" class="headerlink" title="schema"></a><code>schema</code></h3><p>å°±æ˜¯è¡¨æ ¼ï¼Œåˆ©ç”¨mongooseåˆ›å»ºä¸€å¼ è¡¨æ ¼æ¥å­˜æ”¾ä»æ•°æ®åº“ä¸­è·å¾—çš„ä¿¡æ¯ã€‚æ‰€ä»¥è¿™é‡Œçš„è¡¨æ ¼è¦å’Œæ•°æ®åº“ä¸­çš„è¡¨æ ¼ä¸€æ ·</p>
<h3 id="imestamps-true"><a href="#imestamps-true" class="headerlink" title="imestamps:true"></a><code>imestamps:true</code></h3><p><strong>timestamps</strong>é€‰é¡¹ä¼šåœ¨åˆ›å»ºæ–‡æ¡£æ—¶è‡ªåŠ¨ç”Ÿæˆ<strong>createAt</strong>å’Œ<strong>updateAt</strong>ä¸¤ä¸ªå­—æ®µï¼Œå€¼éƒ½ä¸ºç³»ç»Ÿå½“å‰æ—¶é—´ã€‚å¹¶ä¸”åœ¨æ›´æ–°æ–‡æ¡£æ—¶è‡ªåŠ¨æ›´æ–°<strong>updateAt</strong>å­—æ®µçš„å€¼ä¸ºç³»ç»Ÿå½“å‰æ—¶é—´ .tureä»£è¡¨äº†ä½¿ç”¨é»˜è®¤çš„å­—æ®µå</p>
<p>åœ¨Mongooseä¸­ï¼Œå®šä¹‰æ•°æ®åº“model schemasæ—¶ä½¿ç”¨<strong>timestamps</strong>é€‰é¡¹å¯ä»¥ç»™æˆ‘ä»¬å¸¦æ¥è®¸å¤šä¾¿åˆ©ã€‚åœ¨åˆ›å»ºæ–‡æ¡£æ—¶ä¸ç”¨åœ¨ä»£ç ä¸­å»æŒ‡å®š<strong>createTime</strong>å­—æ®µçš„å€¼ï¼Œåœ¨æ›´æ–°æ–‡æ¡£æ—¶ä¹Ÿä¸ç”¨å»ä¿®æ”¹<strong>updateTime</strong>å­—æ®µçš„å€¼ã€‚</p>
<p>å‚è€ƒ<a href="https://mongoosejs.com/docs/guide.html#timestamps" target="_blank" rel="noopener">Mongooseæ–‡æ¡£</a></p>
<h3 id="Model"><a href="#Model" class="headerlink" title="Model"></a><code>Model</code></h3><p>æ˜¯ç”±Schemaç¼–è¯‘è€Œæˆçš„å‡æƒ³ï¼ˆfancyï¼‰æ„é€ å™¨ï¼Œå…·æœ‰æŠ½è±¡å±æ€§å’Œè¡Œä¸ºã€‚Modelçš„æ¯ä¸€ä¸ªå®ä¾‹ï¼ˆinstanceï¼‰å°±æ˜¯ä¸€ä¸ªdocumentã€‚documentå¯ä»¥ä¿å­˜åˆ°æ•°æ®åº“å’Œå¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œã€‚<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œmodelæ˜¯ç”¨æ¥é€‰æ‹©é›†åˆçš„ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘åœ¨äº‘ç«¯æœ‰ä¸€å¼ æ•°æ®è¡¨å«Usersï¼Œæˆ‘æƒ³æŠŠé‡Œé¢çš„æ•°æ®ç”³è¯·åˆ°æœ¬åœ°ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨æœ¬åœ°éœ€è¦å»ºä¸€å¼ ä¸€æ¨¡ä¸€æ ·çš„è¡¨æ ¼æ¥ç”¨ä»¥å­˜æ”¾ã€‚ä½†æ˜¯æˆ‘åœ¨è¿™å¼ è¡¨æ ¼ä¸­æ‰€åšçš„å¢åˆ æ”¹æŸ¥ï¼Œéƒ½ä¼šåœ¨æ•°æ®åº“ä¸­åŒæ­¥ã€‚è¿™å°±æ˜¯modelçš„ç”¨æ³•ã€‚</p>
<h3 id="user-js"><a href="#user-js" class="headerlink" title="user.js"></a><code>user.js</code></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; Schema, model &#125; = mongoose;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> usersSchema = <span class="keyword">new</span> Schema(</span><br><span class="line">  &#123;</span><br><span class="line">    __v: &#123; <span class="attr">type</span>: <span class="built_in">Number</span>, <span class="attr">select</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    name: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    password: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">select</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    auth: &#123; <span class="attr">type</span>: <span class="built_in">Number</span>, <span class="attr">required</span>: <span class="literal">false</span>, <span class="attr">default</span>: <span class="number">0</span> &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">timestamps</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = model(<span class="string">'Users'</span>, usersSchema);</span><br></pre></td></tr></table></figure>
<h3 id="douban-js-1"><a href="#douban-js-1" class="headerlink" title="douban.js"></a><code>douban.js</code></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; Schema, model &#125; = mongoose;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> doubantop250Schema = <span class="keyword">new</span> Schema(</span><br><span class="line">  &#123;</span><br><span class="line">    __v: &#123; <span class="attr">type</span>: <span class="built_in">Number</span>, <span class="attr">select</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    actor: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    director: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    other_title: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    country: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    sort: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    quote: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    image: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    index: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    score: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    time: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    title: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">timestamps</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = model(<span class="string">'doubantop250'</span>, doubantop250Schema);</span><br></pre></td></tr></table></figure>
<h2 id="controllerç›®å½•"><a href="#controllerç›®å½•" class="headerlink" title="controllerç›®å½•"></a>controllerç›®å½•</h2><p>æƒ³äº†è§£åŸºæœ¬çš„CRUDæ“ä½œ å¯ä»¥çœ‹æˆ‘çš„åšå®¢ <a href="https://jasonxqh.github.io/2020/06/07/NodejsåŸºç¡€2/#CRUD-Operations-Using-Mongoose">NodejsåŸºç¡€2ä¸­çš„CRUD Operations Using Mongoose</a></p>
<p>é‡Œé¢è¯¦ç»†ä»‹ç»äº†å¢åˆ æ”¹æŸ¥çš„å„ç§model. æ–¹æ³•</p>
<h3 id="user-js-1"><a href="#user-js-1" class="headerlink" title="user.js"></a><code>user.js</code></h3><p>æˆ‘ä»model/userä¸­å¯¼å…¥äº†è¿™å¼ åœ¨æ•°æ®åº“ä¸­çš„Userè¡¨æ ¼ã€‚ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å¯¹ä»–è¿›è¡Œæˆ‘éœ€è¦çš„åç«¯æ“ä½œäº†ã€‚</p>
<h4 id="login"><a href="#login" class="headerlink" title="login"></a><code>login</code></h4><p>é¦–å…ˆæ˜¯ç™»å½•ã€‚å‰ç«¯ä¼šå‘ä¸€ä¸ªrequestè¿‡æ¥ï¼Œæˆ‘æŠŠé‡Œé¢çš„req.bodyå½“ä½œæˆ‘çš„targetåˆ°Userè¡¨æ ¼ä¸­å»å¯»æ‰¾ï¼Œç„¶åæŠŠç»“æœèµ‹å€¼ç»™user.å¦‚æœuserä¸å­˜åœ¨ï¼Œè¯´æ˜è¡¨æ ¼ä¸­ä¸å­˜åœ¨è¿™ä¸€å·äººç‰©ï¼Œé‚£å½“ç„¶è¿”å›ä¸€æ¡name or password incorrectçš„jsonæ ¼å¼çš„ä¿¡æ¯ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jsonwebtoken = <span class="built_in">require</span>(<span class="string">'jsonwebtoken'</span>);</span><br><span class="line"><span class="keyword">const</span> User = <span class="built_in">require</span>(<span class="string">'../models/user'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; scrects &#125; = <span class="built_in">require</span>(<span class="string">'../../config'</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UsersCtl</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ç™»å½•</span></span><br><span class="line">  <span class="keyword">async</span> login(req, res) &#123;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> User.findOne(req.body);</span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">      res.status(<span class="number">404</span>).json(&#123; <span class="attr">msg</span>: <span class="string">'name or password incorrect'</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> &#123; _id, name &#125; = user;</span><br><span class="line">    <span class="keyword">const</span> token = jsonwebtoken.sign(&#123; _id, name &#125;, scrects, &#123; <span class="attr">expiresIn</span>: <span class="string">'1d'</span> &#125;);</span><br><span class="line">    res.status(<span class="number">201</span>).json(&#123; token, name &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="register"><a href="#register" class="headerlink" title="register"></a><code>register</code></h4><p>æ³¨å†Œå‡½æ•°ï¼Œå°±æ˜¯æˆ‘ä»¬ä»å‰ç«¯å‘æ¥çš„<code>req.body</code>è§£æ„å‡ºnameï¼Œç„¶åæˆ‘ä»¬æŸ¥è¯¢ä¸€ä¸‹Userè¡¨æ ¼ä¸­æ˜¯å¦å­˜åœ¨è¿™ä¸ªäººï¼Œå¦‚æœå­˜åœ¨ï¼Œé‚£ä¹ˆå°±è¿”å›ä¸€æ¡<code>json</code>æ ¼å¼çš„user already existã€‚å¦‚æœåå­—æ˜¯<code>admin</code>çš„è¯ï¼Œæˆ‘ä»¬å°±å‘è¿™ä¸ªäººçš„ä¿¡æ¯ä¸­æ·»åŠ auth=1 æ¥è¯æ˜ä»–æ˜¯ç®¡ç†å‘˜ã€‚å…¶ä½™çš„ï¼Œæˆ‘ä»¬å°±åˆ©ç”¨<code>model.create</code>æ–¹æ³•æ¥åˆ›å»ºè¿™æ¡è®°å½•ï¼Œç„¶åè¿”å›ä¸€ä¸ªuserçš„ä¿¡æ¯</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨å†Œ</span></span><br><span class="line"> <span class="keyword">async</span> register(req, res) &#123;</span><br><span class="line">   <span class="keyword">const</span> &#123; name &#125; = req.body;</span><br><span class="line">   <span class="keyword">const</span> repeatedUser = <span class="keyword">await</span> User.findOne(&#123; name &#125;);</span><br><span class="line">   <span class="keyword">if</span> (repeatedUser) &#123;</span><br><span class="line">     <span class="keyword">return</span> res.status(<span class="number">409</span>).json(&#123; <span class="attr">mas</span>: <span class="string">'user already exist'</span> &#125;);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (name === <span class="string">'admin'</span>) &#123; </span><br><span class="line">     req.body.auth = <span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">const</span> user = <span class="keyword">await</span> User.create(req.body);</span><br><span class="line">   res.status(<span class="number">201</span>).json(&#123; <span class="attr">data</span>: user &#125;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="getInfo"><a href="#getInfo" class="headerlink" title="getInfo"></a><code>getInfo</code></h4><p>è·å–userçš„ä¿¡æ¯ã€‚è¿”å›ä¸€æ¡<code>json</code>æ ¼å¼çš„ä¿¡æ¯</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> getInfo(req, res) &#123;</span><br><span class="line">    res.status(<span class="number">201</span>).json(&#123; <span class="attr">data</span>: req.user &#125;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="findAll"><a href="#findAll" class="headerlink" title="findAll"></a><code>findAll</code></h4><p>æŠŠæ‰€æœ‰çš„userä¿¡æ¯å…¨éƒ¨æ‰¾åˆ°ç„¶åå…¨éƒ¨ä»¥<code>json</code>æ ¼å¼è¿”å›</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> findAll(req, res) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> User.find();</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">  res.status(<span class="number">201</span>).json(&#123; data &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="delete"><a href="#delete" class="headerlink" title="delete"></a><code>delete</code></h4><p>åˆ é™¤æ“ä½œï¼Œä¹Ÿå°±æ˜¯ç®¡ç†å‘˜æ‰èƒ½æ‰§è¡Œçš„åˆ é™¤ç”¨æˆ·çš„ä¿¡æ¯ã€‚</p>
<p>åˆ©ç”¨<code>model.findByIdAndRemove</code>æ–¹æ³•æ¥æ‰¾åˆ°å‰ç«¯å‘æ¥çš„requestä¸­çš„å‚æ•°ä¸­çš„idä¿¡æ¯ï¼Œç„¶ååˆ é™¤å®ƒå¹¶æŠŠåˆ é™¤çš„ä¿¡æ¯è¿”å›ç»™ä¸€ä¸ªresultã€‚å†åˆ©ç”¨<code>json</code>çš„å½¢å¼æŠŠresult æ˜ å°„dataåä¼ å›</p>
<p> <a href="https://jasonxqh.github.io/2020/06/07/NodejsåŸºç¡€2/#Removing-Documents">NodejsåŸºç¡€2 Removing Documents</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">delete</span>(req, res) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> User.findByIdAndRemove(req.params.id);</span><br><span class="line">    res.status(<span class="number">201</span>).json(&#123; <span class="attr">data</span>: result &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">new</span> UsersCtl();</span><br></pre></td></tr></table></figure>
<h3 id="douban-js-2"><a href="#douban-js-2" class="headerlink" title="douban.js"></a><code>douban.js</code></h3><p>æˆ‘ä»model/doubanä¸­å¯¼å…¥äº†è¿™å¼ åœ¨æ•°æ®åº“ä¸­çš„DouBanè¡¨æ ¼ã€‚ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å¯¹ä»–è¿›è¡Œæˆ‘éœ€è¦çš„åç«¯æ“ä½œäº†ã€‚</p>
<h4 id="getAll"><a href="#getAll" class="headerlink" title="getAll"></a><code>getAll</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> getAll(req, res) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> DouBan.find();</span><br><span class="line">  res.status(<span class="number">201</span>).json(&#123; data &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="findAll-1"><a href="#findAll-1" class="headerlink" title="findAll"></a><code>findAll</code></h4><p>è¿™æ˜¯å‰ç«¯æ˜¾ç¤ºæ•°æ®æ˜¯ä¼šç”¨åˆ°çš„ä¸€ä¸ªapi</p>
<p>é¦–å…ˆæˆ‘ä»¬ä»requestä¸­è§£æå‡ºä¼ è¿‡æ¥çš„per_pageä¹Ÿå°±æ˜¯æ¯é¡µæ˜¾ç¤ºçš„ç”µå½±æ¡æ•°ï¼Œå’Œæ’åºçš„ç§ç±»ï¼ˆå‡åºoré™åºorä¸æ’åºï¼‰</p>
<p>å¦‚æœä¸æ’åºï¼Œé‚£ä¹ˆè¯·æ±‚ä¸­sort = undefined,é‚£ä¹ˆæˆ‘ä»¬å°±ä¸è¿›è¡Œ.sort</p>
<p>å¦åˆ™ï¼Œæˆ‘ä»¬å°±è¿›è¡Œæ’åºï¼Œ 1ä»£è¡¨å‡åºï¼Œ-1ä»£è¡¨é™åº</p>
<p><strong>ï¼ˆå°æ’æ›²ï¼‰ï¼š</strong>åœ¨çˆ¬å–æ•°æ®çš„æ—¶å€™ï¼Œæ•°å­—ä¹Ÿæ˜¯æŒ‰ç…§stringç±»å‹å­˜å‚¨çš„ï¼Œå¯¼è‡´æˆ‘ä¸€å¼€å§‹éƒ½åœ¨åšå­—ç¬¦ä¸²æ’åºï¼Œ1111111æ˜¯å°äº9 çš„ï¼Œè¿™å°±å¾ˆçƒ¦ã€‚ç„¶åæˆ‘é€šè¿‡äº†robo 3Tå¯¹mongodbè¿›è¡Œæ‰¹é‡ä¿®æ”¹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.getCollection(<span class="string">'è¡¨æ ¼åå­—'</span>).find(&#123;<span class="string">'ç±»å‹ä¸ºstringçš„å­—æ®µ'</span> : &#123; <span class="attr">$type</span> : <span class="number">2</span> &#125;&#125;).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    x.ç±»å‹ä¸ºstringçš„å­—æ®µ = NumberInt(x.ç±»å‹ä¸ºstringçš„å­—æ®µ);<span class="comment">//è½¬æ¢ä¸ºæ•´å‹</span></span><br><span class="line">    db.getCollection(<span class="string">'è¡¨æ ¼åå­—'</span>).save(x);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.getCollection(<span class="string">'è¡¨æ ¼åå­—'</span>).find(&#123;<span class="string">'ç±»å‹ä¸ºstringçš„å­—æ®µ'</span> : &#123; <span class="attr">$type</span> : <span class="number">2</span> &#125;&#125;).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    x.ç±»å‹ä¸ºstringçš„å­—æ®µ = ParseInt(x.ç±»å‹ä¸ºstringçš„å­—æ®µ);<span class="comment">//è½¬æ¢ä¸ºå°æ•°</span></span><br><span class="line">    db.getCollection(<span class="string">'è¡¨æ ¼åå­—'</span>).save(x);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·æˆ‘ä»¬å°±å®Œæˆäº†ç±»å‹è½¬æ¢ï¼Œä»è€Œå¯ä»¥å¯¹æ•°å­—è¿›è¡Œæ’åºã€‚</p>
<p>å…¶æ¬¡æˆ‘ä»¬æ¥è®¡ç®—per_pageçš„å¤šå°‘ï¼Œä¹Ÿå°±æ˜¯è‡³å°‘ä¸º1æ¡</p>
<p>ç„¶åæˆ‘ä»¬è®¡ç®—è¡¨å†…æ€»å…±çš„æ•°æ®åˆ°åº•æœ‰å‡ æ¡å¹¶è¿”å›ï¼Œè¿™ä¸ªåœ¨å‰ç«¯çš„<strong>åˆ†é¡µå™¨</strong>ä¸­éœ€è¦ç”¨åˆ°ï¼Œå› ä¸ºåˆ†é¡µå™¨å¾—æœ‰æ€»æ¡æ•°æ‰èƒ½è®¡ç®—é¡µæ•°</p>
<p>æœ€åæˆ‘ä»¬åœ¨è¡¨ä¸­å¾—åˆ°å½“å‰é¡µé¢çš„ä¿¡æ¯ï¼Œéœ€è¦è°ƒè¿‡å‰é¢page*perpageæ¡ä¿¡æ¯ï¼Œç„¶åå–perpageæ¡è¿”å›</p>
<p><a href="https://jasonxqh.github.io/2020/06/07/NodejsåŸºç¡€2/#Pagination">NodejsåŸºç¡€2Pagination</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jsonwebtoken = <span class="built_in">require</span>(<span class="string">'jsonwebtoken'</span>);</span><br><span class="line"><span class="keyword">const</span> DouBan = <span class="built_in">require</span>(<span class="string">'../models/douban'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; scrects &#125; = <span class="built_in">require</span>(<span class="string">'../../config'</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DouBanCtl</span> </span>&#123;</span><br><span class="line">  <span class="keyword">async</span> findAll(req, res) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; per_page = <span class="number">10</span> &#125; = req.query;</span><br><span class="line">    <span class="keyword">const</span> page = <span class="built_in">Math</span>.max(req.query.page * <span class="number">1</span>, <span class="number">1</span>) - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> perPage = <span class="built_in">Math</span>.max(per_page * <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">const</span> sort = req.query.sort;</span><br><span class="line">    <span class="built_in">console</span>.log(sort);</span><br><span class="line">    <span class="keyword">const</span> total = <span class="keyword">await</span> DouBan.countDocuments();</span><br><span class="line">    <span class="keyword">if</span> (sort === <span class="string">"undefined"</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">await</span> DouBan.find()</span><br><span class="line">        .limit(perPage)</span><br><span class="line">        .skip(page * perPage);</span><br><span class="line">      res.status(<span class="number">201</span>).json(&#123; data, total &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">await</span> DouBan.find()</span><br><span class="line">        .sort(&#123; <span class="attr">score</span>: sort === <span class="string">"reverse"</span> ? <span class="number">1</span> : <span class="number">-1</span> &#125;)</span><br><span class="line">        .limit(perPage)</span><br><span class="line">        .skip(page * perPage);</span><br><span class="line">      res.status(<span class="number">201</span>).json(&#123; data, total &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="insertMany"><a href="#insertMany" class="headerlink" title="insertMany"></a><code>insertMany</code></h4><p>è¿™æ˜¯æ’å…¥æ“ä½œï¼Œæ˜¯ä¸ºäº†åˆ©ç”¨postmanå‘äº‘æ•°æ®åº“æ’å…¥ä¿¡æ¯ï¼Œåœ¨å‰ç«¯å¹¶æ²¡æœ‰ç”¨åˆ°ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> insertMany(req, res) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = req.body;</span><br><span class="line">    <span class="keyword">await</span> DouBan.insertMany(data);</span><br><span class="line">    res.status(<span class="number">201</span>).json(&#123; <span class="attr">data</span>: <span class="string">'success'</span> &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="getListByKey"><a href="#getListByKey" class="headerlink" title="getListByKey"></a><code>getListByKey</code></h4><p>è¿™æ˜¯å‰ç«¯å¸ƒå°”æŸ¥è¯¢ä¸­çš„ AND æŸ¥è¯¢ï¼Œåœ¨è¿™ç¯‡åšå®¢ä¸­<a href="https://jasonxqh.github.io/2020/06/07/Reactæ¡†æ¶åœ¨ä½œä¸šå½“ä¸­çš„åº”ç”¨/">Reactæ¡†æ¶åœ¨ä½œä¸šå½“ä¸­çš„åº”ç”¨</a>æˆ‘å·²ç»ä»‹ç»äº†æˆ‘ä»¬æŠŠæ•°æ®è¿”å›ä¹‹åå‰ç«¯è¿›è¡Œçš„æ¸²æŸ“æ“ä½œï¼Œç°åœ¨æˆ‘ä»¬æ¥è®²è®²ä»å‰ç«¯å‘æ¥è¯·æ±‚åå¦‚ä½•åœ¨åç«¯è·å¾—æˆ‘æƒ³è¦çš„ä¿¡æ¯ã€‚</p>
<p>åœ¨<a href="https://jasonxqh.github.io/2020/06/07/NodejsåŸºç¡€2/#Regular-Expressions">NodejsåŸºç¡€2Regular Expressions</a>ä¸­æˆ‘åˆæ­¥è®²äº†æ­£åˆ™è¡¨è¾¾å¼çš„ä½¿ç”¨æ–¹æ³•ã€‚</p>
<p>é¦–å…ˆæ¥çœ‹çœ‹è¯·æ±‚æ˜¯ä»€ä¹ˆ   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Api.get(<span class="string">`/douban/getList?<span class="subst">$&#123;keyWords&#125;</span>`</span>,&#123;...&#125;);</span><br></pre></td></tr></table></figure>
<p><code>Object.keys()</code>  æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªç”±ä¸€ä¸ªç»™å®šå¯¹è±¡çš„è‡ªèº«<strong>å¯æšä¸¾å±æ€§</strong>ç»„æˆçš„æ•°ç»„ï¼Œæ•°ç»„ä¸­å±æ€§åçš„æ’åˆ—é¡ºåºå’Œæ­£å¸¸å¾ªç¯éå†è¯¥å¯¹è±¡æ—¶è¿”å›çš„é¡ºåºä¸€è‡´ ã€‚</p>
<p><strong>$regex  </strong> ä¸ºæ¨¡ç³ŠæŸ¥è¯¢çš„å­—ç¬¦ä¸²æä¾›æ­£åˆ™è¡¨è¾¾å¼åŠŸèƒ½</p>
<p>é¦–å…ˆæˆ‘ä»¬å»ºç«‹ä¸€ä¸ªparamså¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ä¸­å°†å­˜æ”¾å¯»æ‰¾çš„æ¡ä»¶ã€‚</p>
<p> ç„¶åæˆ‘ä»¬åˆ©ç”¨forEachå¾ªç¯ï¼Œå¯¹req.queryé‡Œé¢ï¼Œä¹Ÿå°±æ˜¯å‰ç«¯ä¼ å›æ¥çš„æ¡ä»¶(2ä¸ªæ¡ä»¶)è¿›è¡Œæ“ä½œ</p>
<p>eval() å‡½æ•°å¯è®¡ç®—æŸä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶æ‰§è¡Œå…¶ä¸­çš„çš„ JavaScript ä»£ç ã€‚</p>
<p> ${è¡¨è¾¾å¼du}ç”¨æ¥è¾“å‡ºæˆ–è€…è®¡ç®—ä¸€ä¸ªè¡¨è¾¾å¼çš„å†…å®¹å€¼</p>
<p>æ¯”å¦‚ ${3+5}ï¼Œé‚£ä¹ˆä¾¿ä¼šåœ¨é¡µé¢ä¸Šè¾“å‡º8</p>
<p> æ¯”å¦‚å‰ç«¯ä¼ æ¥çš„æ˜¯  <code>ç”µå½±åå­—ï¼šçš„ AND è¯„åˆ†ï¼š7</code></p>
<p>è¿™æ—¶å€™itemå°±æ˜¯è¿™ä¸ªqueryçš„å¯æšä¸¾å±æ€§ï¼Œä¹Ÿå°±æ˜¯ç”µå½±åå­—å’Œè¯„åˆ†</p>
<p>æ‰€åŠæ“ä½œå¥½ä»¥åç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">params = &#123;</span><br><span class="line">	&#123;ç”µå½±åå­— : <span class="regexp">/çš„/ig</span> &#125;,</span><br><span class="line">	&#123;è¯„åˆ†: <span class="regexp">/7/ig</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åç”¨paramsä½œä¸ºæŸ¥æ‰¾æ¡ä»¶åˆ°è±†ç“£è¿™å¼ è¡¨é‡Œå»æŸ¥</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> getListByKey(req, res) &#123;</span><br><span class="line">   <span class="keyword">const</span> params = &#123;&#125;;</span><br><span class="line">   <span class="built_in">Object</span>.keys(req.query).forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">     params[item] = &#123; <span class="attr">$regex</span>: <span class="built_in">eval</span>(<span class="string">`/<span class="subst">$&#123;req.query[item]&#125;</span>/ig`</span>) &#125;;</span><br><span class="line">   &#125;);</span><br><span class="line">   <span class="built_in">console</span>.log(params);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">const</span> data = <span class="keyword">await</span> DouBan.find(params);</span><br><span class="line">   res.status(<span class="number">201</span>).json(&#123; data &#125;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="getListByOr"><a href="#getListByOr" class="headerlink" title="getListByOr"></a><code>getListByOr</code></h4><p>è¿™æ˜¯å‰ç«¯å¸ƒå°”æŸ¥è¯¢ä¸­çš„ OR æŸ¥è¯¢ï¼Œ</p>
<p>åœ¨<a href="https://jasonxqh.github.io/2020/06/07/NodejsåŸºç¡€2/#Logical-Query-Operators">NodejsåŸºç¡€2Logical Query Operators</a>ä¸­æˆ‘å·²ç»è®²äº†oræ“ä½œçš„ç¬¦æ˜¯è¦ä¼ å…¥ä¸€ä¸ªå¯¹è±¡æ•°ç»„çš„ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘åšçš„å·¥ä½œå°±æ˜¯æŠŠä¸Šé¢å·²ç»æ±‚å¥½çš„<code>params</code>è½¬æ¢æˆä¸€ä¸ªå¯¹è±¡æ•°ç»„ã€‚</p>
<p>åŒæ ·è¿˜æ˜¯ç”¨åˆ°äº†<code>Object.keys</code>æ–¹æ³•ï¼Œæˆ‘ä»¬æŠŠ<code>params</code>å¯¹è±¡è½¬æ¢æˆ<code>params2</code>å¯¹è±¡æ•°ç»„</p>
<p>æœ€åå°±æŠŠè¿™ä¸ªä¼ å…¥åˆ° $or é”®å€¼å¯¹åé¢å³å¯</p>
<p>ä¹Ÿå¯ä»¥ <code>DouBan.or(params2);</code></p>
<p>è¿™æ ·æˆ‘ä»¬è¿”å›çš„æ•°æ®å°±æ˜¯æ‹©ä¸€æ»¡è¶³çš„äº†</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">params2=[</span><br><span class="line">	&#123;ç”µå½±åå­— : <span class="regexp">/çš„/ig</span> &#125;,</span><br><span class="line">	&#123;è¯„åˆ†: <span class="regexp">/7/ig</span>&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">async</span> getListByOr(req, res) &#123;</span><br><span class="line">    <span class="keyword">const</span> params = &#123;&#125;;</span><br><span class="line">    <span class="built_in">Object</span>.keys(req.query).forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      params[item] = &#123; <span class="attr">$regex</span>: <span class="built_in">eval</span>(<span class="string">`/<span class="subst">$&#123;req.query[item]&#125;</span>/ig`</span>) &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> params2 = [];</span><br><span class="line">    <span class="built_in">Object</span>.keys(params).forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line">      obj[item] = params[item];</span><br><span class="line">      params2.push(obj);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(params, params2);</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> DouBan.find(&#123; <span class="attr">$or</span>: params2 &#125;);</span><br><span class="line">    res.status(<span class="number">201</span>).json(&#123; data &#125;);	</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">new</span> DouBanCtl();</span><br></pre></td></tr></table></figure>
<h3 id="operas-js"><a href="#operas-js" class="headerlink" title="operas.js"></a><code>operas.js</code></h3><p>å› ä¸ºå·²ç»å®ŒæˆåŸºæœ¬æ“ä½œäº†ï¼Œç°åœ¨æˆ‘ä»¬å°±æ‹“å±•ä¸€ä¸‹å†…å®¹ï¼Œåšä¸€ä¸ªæ–°å»ºoperas çš„æ“ä½œï¼ˆå…¶å®ä¹Ÿhinç®€å•ï¼‰</p>
<p>å‰ç«¯å®ç°è¯·çœ‹ ï¼Œè¿™é‡Œè®²ä¸€ä¸‹åç«¯æ”¶åˆ°å‰ç«¯å‘æ¥çš„è¡¨å•è¯·æ±‚è¯¥æ€ä¹ˆæŠŠè¿™æ¡æ–°å»ºçš„ä¿¡æ¯æ’å…¥åˆ°mongodbå½“ä¸­å»ï¼Ÿ</p>
<p>æˆ‘ä»¬çŸ¥é“æ‰€æœ‰çš„ä¿¡æ¯éƒ½è—åœ¨ req.bodyå½“ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªè¦ç”¨ . æŠŠä»–ä»¬éƒ½æå–å‡ºæ¥ï¼Œç„¶åæ–°å»ºä¸€ä¸ªOperaså¯¹è±¡å³å¯</p>
<p>æœ€åé€šè¿‡opera.save()æ¥å®ç°ä¿å­˜æ“ä½œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> create(req, res) &#123;</span><br><span class="line">   <span class="keyword">const</span> opera = <span class="keyword">new</span> Operas(&#123;</span><br><span class="line">       title: req.body.title,</span><br><span class="line">       actors: req.body.actors,</span><br><span class="line">       country: req.body.country,</span><br><span class="line">       type: req.body.type,</span><br><span class="line">       single: req.body.single,</span><br><span class="line">       first_date: req.body.first_date</span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="keyword">const</span> result = <span class="keyword">await</span> opera.save();</span><br><span class="line">   <span class="built_in">console</span>.log(result)</span><br><span class="line">   res.status(<span class="number">201</span>).json(&#123; result &#125;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="middlewareç›®å½•"><a href="#middlewareç›®å½•" class="headerlink" title="middlewareç›®å½•"></a><code>middleware</code>ç›®å½•</h2><h3 id="auth-handlers"><a href="#auth-handlers" class="headerlink" title="auth-handlers"></a><code>auth-handlers</code></h3><p>è¿™æ˜¯ç”¨æ¥è®¤è¯çš„ä¸€ä¸ªä¸­é—´ä»¶ï¼Œä¸­é—´ä»¶çš„å†™æ³•æˆ‘åœ¨ <a href="https://jasonxqh.github.io/2020/06/07/NodejsåŸºç¡€1/#Middleware">NodejsåŸºç¡€1çš„Middlewareç« èŠ‚</a> ä¸­è¯¦ç»†è¯´äº†ï¼Œè¿™é‡Œç®€å•è®²ä¸€ä¸‹ä»–çš„é€»è¾‘</p>
<p>å°±æ˜¯åˆ¤æ–­è¯·æ±‚ä½“é‡userçš„åå­—æ˜¯ä¸æ˜¯adminï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œä»€ä¹ˆä¹Ÿä¸åšï¼ŒæŠŠæ§åˆ¶æƒäº¤ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶æˆ–è€…å‡½æ•°</p>
<p>å¦‚æœä¸æ˜¯çš„è¯ï¼Œé‚£å°±è¿”å›ä¸€ä¸ªçŠ¶æ€ç 500</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> User = <span class="built_in">require</span>(<span class="string">'../models/user'</span>);</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">'jsonwebtoken'</span>);</span><br><span class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(<span class="string">'../../config'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">authAdmin</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(req.user.name !== <span class="string">'admin'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">'no authority '</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  next()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  authAdmin,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="error-handlers"><a href="#error-handlers" class="headerlink" title="error-handlers"></a><code>error-handlers</code></h3><p>è¿™æ˜¯ä¸€ä¸ªå¼€æºçš„æ£€æŸ¥é”™è¯¯çš„æ–‡æ¡£ã€‚é‡Œé¢é›†æˆäº†ä¸€äº›ä¸­é—´ä»¶</p>
<p><a href="https://github.com/wesbos/Learn-Node/blob/master/stepped-solutions/45%20-%20Finished%20App/handlers/errorHandlers.js" target="_blank" rel="noopener">https://github.com/wesbos/Learn-Node/blob/master/stepped-solutions/45%20-%20Finished%20App/handlers/errorHandlers.js</a></p>
<p>æˆ‘ä»¬ä¸»è¦ç”¨å®ƒæ¥æ£€æŸ¥ å¼‚æ­¥æ“ä½œçš„é—®é¢˜ï¼ŒéªŒè¯è·¯ç”±ï¼Œå’Œç”¨æˆ·éªŒè¯çš„é—®é¢˜</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  With async/await, you need some way to catch errors</span></span><br><span class="line"><span class="comment">  Instead of using try&#123;&#125; catch(e) &#123;&#125; in each controller, we wrap the function in</span></span><br><span class="line"><span class="comment">  catchErrors(), catch and errors they throw, and pass it along to our express </span></span><br><span class="line"><span class="comment">  middleware with next()</span></span><br><span class="line"><span class="comment"> * Handler to catch `async` operation errors.</span></span><br><span class="line"><span class="comment"> * Reduces having to write `try-catch` all the time.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">exports.catchErrors = <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    action(req, res).catch(next)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Handle any invalid routes.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">exports.invalidRoute = <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> err = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Invalid route: '</span> + req.method + <span class="string">':'</span> + req.route)</span><br><span class="line">  err.status = <span class="number">404</span></span><br><span class="line">  next(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Validation error handler for Mongo.</span></span><br><span class="line"><span class="comment"> * The client app should handle displaying the errors.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">exports.validationErrors = <span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// catch unique field error</span></span><br><span class="line">  <span class="keyword">if</span> (err.code &amp;&amp; err.code === <span class="number">11000</span>) &#123;</span><br><span class="line">    err.status = <span class="number">400</span></span><br><span class="line">    err.message = err.errmsg</span><br><span class="line">    <span class="keyword">return</span> next(err)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!err.errors) &#123;</span><br><span class="line">    <span class="keyword">return</span> next(err)</span><br><span class="line">  &#125;</span><br><span class="line">  res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">    status: <span class="number">400</span>,</span><br><span class="line">    error: err.errors,</span><br><span class="line">    data: &#123;&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/08/%E6%B5%85%E8%B0%88redux1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jasonâ€˜s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/08/%E6%B5%85%E8%B0%88redux1/" class="post-title-link" itemprop="url">æµ…è°ˆredux1</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-08 00:08:29" itemprop="dateCreated datePublished" datetime="2020-06-08T00:08:29+08:00">2020-06-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-10 00:18:22" itemprop="dateModified" datetime="2020-06-10T00:18:22+08:00">2020-06-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="æµ…è°ˆredux1"><a href="#æµ…è°ˆredux1" class="headerlink" title="æµ…è°ˆredux1"></a>æµ…è°ˆredux1</h1><p>å­¦ä¹ è‡ªé˜®ä¸€å³°çš„åšå®¢</p>
<p><a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html" target="_blank" rel="noopener">é˜®ä¸€å³°çš„æŠ€æœ¯åšå®¢1</a> </p>
<p><a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_two_async_operations.html" target="_blank" rel="noopener">é˜®ä¸€å³°çš„æŠ€æœ¯åšå®¢2</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_three_react-redux.html" target="_blank" rel="noopener">é˜®ä¸€å³°çš„æŠ€æœ¯åšå®¢3</a></p>
<p>å’Œ<a href="https://www.bilibili.com/video/BV1K7411U7P5" target="_blank" rel="noopener">bç«™Moshæ•™ç¨‹</a></p>
<h2 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h2><h3 id="What-is-Redux"><a href="#What-is-Redux" class="headerlink" title="What is Redux"></a>What is Redux</h3><p>Reduæ˜¯JavaScriptåº”ç”¨ç¨‹åºçš„çŠ¶æ€ç®¡ç†åº“.æˆ‘ä»¬å¯ä»¥åœ¨React,Angular,Vueç”šè‡³åŸç”ŸJSä¸­éƒ½èƒ½ç”¨</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/1.png" style="zoom: 50%;"></p>
<p>ä¸ºä»€ä¹ˆéœ€è¦Reduxï¼Ÿ å¦‚æœæˆ‘ä»¬æ›¾ç»å»ºç«‹äº†ä¸€ä¸ªå¸¦æœ‰å¤æ‚çš„ç”¨æˆ·ç•Œé¢çš„åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬éœ€è¦ä¿æŒä¸åŒéƒ¨åˆ†UIæ˜¾ç¤ºä¸Šçš„åŒæ­¥ã€‚å¦‚æœæˆ‘ä»¬é€šè¿‡æ™®é€šçš„æ•°æ®æµçš„æ–¹å¼ï¼Œéœ€è¦ç”¨å¾ˆå¤šä»£ç ï¼Œå¾ˆå¤æ‚çš„é€»è¾‘ï¼Œç”šè‡³è¿›å…¥ä¸€ä¸ªæ­»å¾ªç¯ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªçŠ¶æ€ç®¡ç†åº“ã€‚</p>
<p>ä¸å…¶è¯»å–ä¸åŒUIç»„ä»¶çš„çŠ¶æ€å˜é‡ï¼Œä¸å¦‚æŠŠä»–ä»¬éƒ½æ”¾åˆ°ä¸€ä¸ªåœ°æ–¹ï¼ˆstore)</p>
<p>ä½¿ç”¨äº†è¿™ç§æ¶æ„ï¼Œä¸åŒçš„uiå°†ä¸å†ä¿å­˜è‡ªå·±çš„çŠ¶æ€ï¼Œç›¸åä»–ä»¬ä»ä»“åº“ä¸­å¾—åˆ°çŠ¶æ€ä¿¡æ¯ã€‚å¦‚æœæœ‰å¿…è¦æ›´æ–°æŸä¸ªæ•°æ®ï¼Œæˆ‘ä»¬å°±ä»Storeä¸­å»æ‹¿ã€‚è¿™æ ·èƒ½ç«‹åˆ»è§£å†³ä¸åŒUIçš„æ•°æ®å…±äº«é—®é¢˜</p>
<p>Reduxé¡µå¾ˆå®¹æ˜“è®©æˆ‘ä»¬ç†è§£åº”ç”¨ç¨‹åºçš„æ•°æ®å˜åŒ–</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/2.png" style="zoom: 50%;"></p>
<h3 id="Pros-and-Cons-of-Redux"><a href="#Pros-and-Cons-of-Redux" class="headerlink" title="Pros and Cons of Redux"></a>Pros and Cons of Redux</h3><p>è¿™é‡Œæœ‰ä¸€ä¸ªè´­ç‰©è½¦å¼çš„è½¯ä»¶ã€‚å¦‚æœæˆ‘ä»¬å•†å“çš„æ•°é‡å¢åŠ äº†ï¼Œé‚£ä¹ˆPriceä¹Ÿä¼šéšä¹‹å¢åŠ ï¼Œæ€»è®¡ä¹Ÿä¼šéšä¹‹å¢åŠ </p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/3.png" style="zoom: 50%;"></p>
<p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æœ‰ä¸€ä¸ªå•ä¸€çš„ä»“åº“ï¼Œä¿å­˜åº”ç”¨ç¨‹åºçš„æ‰€æœ‰çŠ¶æ€</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/4.png" style="zoom: 45%;"></p>
<p> Reduxçš„ä¼˜ç¼ºç‚¹</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/5.png" style="zoom: 45%;"></p>
<h3 id="Is-Redux-for-You"><a href="#Is-Redux-for-You" class="headerlink" title="Is Redux for You"></a>Is Redux for You</h3><p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/6.png" style="zoom: 45%;"></p>
<p>webpackæ–‡ä»¶</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//Webpackä¼šä»è¿™ä¸ªæ–‡ä»¶å¼€å§‹ï¼Œç„¶åæœç´¢å‡ºæ‰€æœ‰çš„jsæ–‡ä»¶ï¼ŒæŠŠä»–ä»¬åˆå¹¶æˆapp.js</span></span><br><span class="line">    <span class="comment">//ä»–ä¼šé‡æ–°ä¿å­˜åœ¨distæ–‡ä»¶å¤¹ä¸­</span></span><br><span class="line">  entry: <span class="string">"./src/index.js"</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">"app.js"</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">"dist"</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">    <span class="comment">//è¿™æ˜¯æœåŠ¡å™¨çš„é…ç½®ï¼Œæˆ‘ä»¬å‘Šè¯‰webpack ä»è¿™ä¸ªæ–‡ä»¶å¤¹åŠ è½½åº”ç”¨ç¨‹åºï¼Œç«¯å£å·ä¸º9000</span></span><br><span class="line">  devServer: &#123;</span><br><span class="line">    contentBase: path.join(__dirname, <span class="string">"dist"</span>),</span><br><span class="line">    port: <span class="number">9000</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mode: <span class="string">"development"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="Functional-Programming-in-JavaScript-å‡½æ•°å¼ç¼–ç¨‹"><a href="#Functional-Programming-in-JavaScript-å‡½æ•°å¼ç¼–ç¨‹" class="headerlink" title="Functional Programming in JavaScript  å‡½æ•°å¼ç¼–ç¨‹"></a>Functional Programming in JavaScript  å‡½æ•°å¼ç¼–ç¨‹</h2><h3 id="What-is-Functional-Programming"><a href="#What-is-Functional-Programming" class="headerlink" title="What is Functional Programming"></a>What is Functional Programming</h3><p>å‡½æ•°å¼ç¼–ç¨‹æ˜¯ä¼—å¤šç¼–ç¨‹èŒƒå¼ï¼Œæˆ–è€…è¯´é£æ ¼çš„ä¸€ç§ï¼šOOPï¼ŒFunctionalï¼Œäº‹ä»¶é©±åŠ¨â€¦</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/7.png" style="zoom: 60%;"></p>
<p>å‡½æ•°å¼ç¼–ç¨‹ï¼Œå°±æ˜¯ä½¿ç”¨ä¸€äº›å¯ä»¥å¤ç”¨çš„å‡½æ•°ç»„åˆæ¥è§£å†³é—®é¢˜ã€‚è¿™äº›å‡½æ•°æ¥æ”¶è¾“å…¥å¹¶è¿”å›ç»“æœï¼Œä»–ä»¬ä¸ä¿®æ”¹åŸå§‹æ•°æ®ã€‚æœ‰äº†è¿™æ ·çš„åŸåˆ™ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›å‡½æ•°ç»„åˆæˆæ›´å¤æ‚çš„å‡½æ•°</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/8.png" style="zoom: 60%;"></p>
<h3 id="Functions-as-First-class-Citizens"><a href="#Functions-as-First-class-Citizens" class="headerlink" title="Functions as First-class Citizens"></a>Functions as First-class Citizens</h3><p>å‡½æ•°å¼jsä¸­çš„ä¸€ç­‰å…¬æ°‘ï¼Œä¹Ÿå°±æ˜¯è¯´ä»–ä»¬å¯ä»¥ç”¨åœ¨ä»»ä½•åœ°æ–¹ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå®ƒèµ‹å€¼ç»™å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒä»¬å½“ä½œå‚æ•°ä¼ å…¥ï¼Œå¯ä»¥ä½œä¸ºè¿”å›å€¼</p>
<h3 id="Higher-order-Functions"><a href="#Higher-order-Functions" class="headerlink" title="Higher-order Functions"></a>Higher-order Functions</h3><p>Higher-order functionså°±æ˜¯è¯´å§å‡½æ•°ä½œä¸ºä¸€ä¸ªå‚æ•°ï¼Œæˆ–è€…æŠŠå‡½æ•°ä½œä¸ºä¸€ä¸ªè¿”å›å€¼ï¼Œæˆ–è€…ä¸¤è€…éƒ½æœ‰çš„å‡½æ•°ã€‚ä¸åŒäºå¤„ç†å­—ç¬¦ä¸²ï¼Œæ•°å­—ï¼Œä»–ä»¬ä»¥æ›´é«˜çº§çš„æ–¹å¼å¤„ç†å‡½æ•°</p>
<p>æ¯”å¦‚è¯´mapå‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå®ƒçš„å‚æ•°</p>
<p>setTimeout()ä¹Ÿæ˜¯ä¸€ä¸ªHigher-order function</p>
<h3 id="Function-Composition"><a href="#Function-Composition" class="headerlink" title="Function Composition"></a>Function Composition</h3><p>æœ€ç†æƒ³çš„å‡½æ•°å¼ç¼–ç¨‹ï¼Œå°±æ˜¯åˆ›é€ ä¸€äº›å‡½æ•°ï¼Œå°†è¿™äº›å‡½æ•°ç»„åˆæˆæ›´å¤æ‚çš„å‡½æ•°ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> input = <span class="string">"  javascript  "</span>;</span><br><span class="line"><span class="keyword">let</span> output = <span class="string">"&lt;div&gt;"</span> + input.trim()+<span class="string">"&lt;/div&gt;"</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬é€šè¿‡å‡½æ•°å¼ç¼–ç¨‹æ”¹å†™</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> trim = <span class="function"><span class="params">str</span>=&gt;</span>str.trim();</span><br><span class="line"><span class="keyword">const</span> wrapInDiv = <span class="function"><span class="params">str</span> =&gt;</span><span class="string">`&lt;div&gt;<span class="subst">$&#123;str&#125;</span>&lt;/div&gt;`</span></span><br><span class="line"><span class="keyword">const</span> toLowerCase = <span class="function"><span class="params">str</span>=&gt;</span>str.toLowerCase();</span><br><span class="line"><span class="keyword">const</span> result=wrapInDiv(toLowerCase(trim(input)))</span><br></pre></td></tr></table></figure>
<h3 id="Composing-and-Piping"><a href="#Composing-and-Piping" class="headerlink" title="Composing and Piping"></a>Composing and Piping</h3><p>ä½†æ˜¯éšç€å‡½æ•°çš„å¤æ‚æ€§å¢åŠ ï¼Œè¿™äº›å°æ‹¬å·ä¼šè¶Šæ¥è¶Šå¤šã€‚</p>
<p>å€ŸåŠ©<a href="https://lodash.com/docs/4.17.15" target="_blank" rel="noopener">loadashåº“</a>æ¥ç®€åŒ–,ä»–åŒ…å«äº†å¾ˆå¤šé’ˆå¯¹å‡½æ•°å¼ç¼–ç¨‹çš„åŒ…</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;compose,pipe&#125; <span class="keyword">from</span> <span class="string">"lodash/fp"</span></span><br><span class="line"><span class="keyword">let</span> input = <span class="string">"  javascript  "</span>;</span><br><span class="line"><span class="keyword">const</span> trim = <span class="function"><span class="params">str</span>=&gt;</span>str.trim();</span><br><span class="line"><span class="keyword">const</span> wrapInDiv = <span class="function"><span class="params">str</span> =&gt;</span><span class="string">`&lt;div&gt;<span class="subst">$&#123;str&#125;</span>&lt;/div&gt;`</span></span><br><span class="line"><span class="keyword">const</span> toLowerCase = <span class="function"><span class="params">str</span>=&gt;</span>str.toLowerCase();</span><br><span class="line"><span class="keyword">const</span> transform = compose(wrapInDiv,toLowerCase,trim);</span><br><span class="line">transform(input)</span><br></pre></td></tr></table></figure>
<p>compose ä¹Ÿæ˜¯ä¸€ä¸ª higer -order Functions,å› ä¸ºä»–ä¼ å…¥äº†ä¸‰ä¸ªå‡½æ•°å¹¶è¿”å›äº†ä¸€ä¸ªæ–°çš„åŒ…å«äº†è¿™å‡ ä¸ªå‚æ•°çš„å‡½æ•°ã€‚</p>
<p>ä½†æ˜¯ç‰¹åˆ«è¦æ³¨æ„å¤„ç†é¡ºåºï¼Œcomposeå‡½æ•°æ˜¯è¦ä»å³å‘å·¦æ‰§è¡Œã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡pipeå‡½æ•°æ¥è¾¾åˆ°æˆ‘ä»¬è§‰å¾—èˆ’æœçš„ä»å·¦å‘å³æ‰§è¡Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> transform = pipe(trim,toLowerCase,wrapInDiv);</span><br><span class="line">transform(input)</span><br></pre></td></tr></table></figure>
<h3 id="Currying-curryåŒ–"><a href="#Currying-curryåŒ–" class="headerlink" title="Currying curryåŒ–"></a>Currying curryåŒ–</h3><p>æˆ‘åœ¨åŸæ¥çš„åŸºç¡€ä¸Šå†æ–°å»ºä¸€ä¸ªå‡½æ•°</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapInSpan = <span class="function"><span class="params">str</span> =&gt;</span><span class="string">`&lt;span&gt;<span class="subst">$&#123;str&#125;</span>&lt;/span&gt;`</span></span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯å› ä¸ºè¿™ä¸ªå’ŒwrapInSpané•¿å¾—å¾ˆåƒï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¯¹ä¸¤è€…æ¨¡æ¿åŒ–</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrap = <span class="function">(<span class="params">type,str</span>)=&gt;</span>&#123;<span class="string">`&lt;type&gt;<span class="subst">$&#123;str&#125;</span>&lt;/type&gt;`</span>&#125;</span><br></pre></td></tr></table></figure>
<p>ä½†è¿™æ ·ç›´æ¥è¾“å‡ºä»¥åæ˜¯\<javascript\>undefined\<javascript\></javascript\></javascript\></p>
<p>æ˜¯å› ä¸ºwrapä¼šæŠŠä¼ å…¥çš„JavaScriptå½“æˆç¬¬ä¸€ä¸ªtypeï¼Œæˆ‘ä»¬åŒæ ·ä¹Ÿä¸èƒ½pipe(trim,toLowerCase,wrap(â€œdivâ€));å› ä¸ºè¿™å®é™…ä¸Šæ˜¯è°ƒç”¨äº†wrapå¹¶ä¼ å…¥äº†div</p>
<p>è¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦curryåŒ–ã€‚curryåŒ–å…è®¸å°†å¤šä¸ªå‚æ•°ä¼ å…¥ï¼Œç„¶åè½¬åŒ–ä¸ºåªéœ€è¦ä¸€ä¸ªå‚æ•°çš„å‡½æ•°.æ‰€ä»¥æˆ‘ä»¬å§åŸæ¥çš„è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…æ˜¯æ•°å­—çš„å‡½æ•°æ”¹æˆä¸€ä¸ªè¿”å›ä¸€ä¸ªå‡½æ•°çš„å‡½æ•°.</p>
<p>åœ¨curryåŒ–ä¹‹åï¼Œæˆ‘ä»¬ä¸æ˜¯ç”¨é€—å·æ¥åˆ†éš”å‚æ•°äº†ï¼Œæˆ‘ä»¬ä½¿ç”¨æ‹¬å·æ¥åˆ†éš”</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a+b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>curryåŒ–ä¹‹å</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">a</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">b</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> a+b;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">add(<span class="number">1</span>)(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>ç”¨ç®­å¤´å‡½æ•°ç®€åŒ–å</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> add2 = <span class="function"><span class="params">a</span>=&gt;</span><span class="function"><span class="params">b</span>=&gt;</span>a+b;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥æˆ‘ä»¬å¯¹wrapå‡½æ•°è¿›è¡Œæ”¹é€ </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrap = <span class="function">(<span class="params">type</span>) =&gt;</span> <span class="function">(<span class="params">str</span>) =&gt;</span> <span class="string">`&lt;<span class="subst">$&#123;type&#125;</span>&gt;<span class="subst">$&#123;str&#125;</span>&lt;/<span class="subst">$&#123;type&#125;</span>&gt;`</span>;</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨ï¼Œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> transform = pipe(trim,toLowerCase,wrap(<span class="string">"div"</span>));</span><br><span class="line"><span class="built_in">console</span>.log(transform(input))</span><br></pre></td></tr></table></figure>
<p>æ‰“å°å‡ºæ¥çš„å°±æ˜¯ \<div\>javascript\&lt;/div> ç°åœ¨æƒ³æ¢æˆspanæ ‡ç­¾ï¼Œåªè¦æŠŠdivæ”¹æˆspanå³å¯</div\></p>
<h3 id="Pure-Functions"><a href="#Pure-Functions" class="headerlink" title="Pure Functions"></a>Pure Functions</h3><p>çº¯å‡½æ•°å°±æ˜¯æˆ‘æ¯æ¬¡ä¼ å…¥ç›¸åŒçš„å‚æ•°çš„è¯ï¼Œä»–å°±è¿”å›ä¸€ä¸ªç›¸åŒçš„å€¼ã€‚å¾ˆå¤šå‡½æ•°éƒ½æ˜¯çº¯å‡½æ•°ï¼Œä½†æ˜¯éšæœºå‡½æ•°å°±ä¸æ˜¯.å¦‚:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunction</span>(<span class="params">number</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> number * <span class="built_in">Math</span>.random();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/9.png" style="zoom: 60%;"></p>
<p>reduxä¸­reducerå°±æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ã€‚çº¯å‡½æ•°ä¸­çš„å‚æ•°ä¸èƒ½å¤Ÿå˜åŒ–ã€‚</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/10.png" style="zoom: 60%;"></p>
<p>è‡ªè¿°æ€§ï¼šå› ä¸ºæ‰€æœ‰çš„è¿™ä¸ªå‡½æ•°éœ€è¦çš„ä¸œè¥¿åœ¨å£°æ˜çš„æ—¶å€™å·²ç»éƒ½è¯´æ¸…æ¥šäº†</p>
<p>æ˜“æµ‹è¯•:  å› ä¸ºæˆ‘æ— éœ€å»è®¾ç½®æŸäº›å…¨å±€çŠ¶æ€ç”¨æ¥æµ‹è¯•è¿™ä¸ªå‡½æ•°</p>
<p>ç‹¬ç«‹çš„ï¼šæ— éœ€å»è®¾ç½®æŸäº›å…¨å±€çŠ¶æ€</p>
<p>å¯ç¼“å­˜çš„ï¼šæˆ‘ä»¬å¯ä»¥ä¿ç•™å‡½æ•°çš„è¿ç®—ç»“æœ</p>
<h3 id="Immutability"><a href="#Immutability" class="headerlink" title="Immutability"></a>Immutability</h3><p>ä¸€æ—¦åˆ›å»ºï¼Œæ— æ³•æ”¹å˜ï¼Œå¦‚æœæƒ³ä¿®æ”¹å¯¹è±¡ï¼Œé‚£ä¹ˆå°±è¦å¤åˆ¶ä»–ï¼Œç„¶åå†ä¿®æ”¹å®ƒçš„æ ·æœ¬ã€‚jsä¸­å¯ä»¥ä¿®æ”¹å¯¹è±¡å’Œæ•°ç»„ï¼Œæ‰€ä»¥jsä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„å‡½æ•°å¼çš„ç¼–ç¨‹è¯­è¨€ã€‚</p>
<p>jsä¸­ä¸ºäº†è¾¾åˆ°å‡½æ•°å¼è¯­è¨€çš„ç‰¹æ€§ï¼Œå¯ä»¥åˆ©ç”¨const ï¼Œconstçš„ä½œç”¨æ˜¯é˜²æ­¢å†æ¬¡èµ‹å€¼ï¼Œä½†æ˜¯å¯ä»¥ä¿®æ”¹å¯¹è±¡ä¸­çš„å±æ€§</p>
<p><strong>ä¸å¯å˜çš„å¥½å¤„ï¼š</strong></p>
<p><strong>å¯é¢„æµ‹æ€§</strong>ï¼šå‡å°‘äº†çªå‘æƒ…å†µ</p>
<p><strong>æ›´å¿«çš„æ„ŸçŸ¥å˜åŒ–</strong>: <img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/11.png" style="zoom: 60%;"></p>
<p><strong>å¹¶å‘æ€§</strong>ï¼šå¦‚æœæˆ‘ä»¬çŸ¥é“å‡½æ•°ä¸ä¼šä¿®æ”¹å¯¹è±¡æœ¬èº«ï¼Œæˆ‘ä»¬å°±çŸ¥é“å®ç°å¤šä»»åŠ¡æ˜¯å®‰å…¨çš„ã€‚ä¸ä¼šå› å¤šé‡åŠ è½½å¯¹è±¡è€Œé€ æˆæ•´ä¸ªç³»ç»Ÿçš„æ··ä¹±ã€‚</p>
<p>ä½†æ˜¯ä¸å¯å˜çš„å¯¹è±¡ä¹Ÿä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼š</p>
<p><strong>å¸¦æ¥æ½œåœ¨çš„æ€§èƒ½æ¶ˆè€—</strong>ï¼šæˆ‘ä»¬æ¯æ¬¡ä¿®æ”¹å¯¹è±¡ï¼Œæ‰€æœ‰åŸå¯¹è±¡çš„å­—æ®µéƒ½è¦å¤åˆ¶åˆ°æ–°çš„å¯¹è±¡ã€‚å¯èƒ½ä¼šå‡æ…¢é€Ÿåº¦</p>
<p><strong>å†…å­˜æ¶ˆè€—</strong>ï¼š</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/12.png" style="zoom: 60%;"></p>
<h3 id="Updating-Objects"><a href="#Updating-Objects" class="headerlink" title="Updating Objects"></a>Updating Objects</h3><p>æˆ‘ä»¬å¦‚æœè¦æ›´æ–°å¯¹è±¡çš„è¯ ç”¨spreadè¿ç®—ç¬¦</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;<span class="attr">name</span>:<span class="string">"John"</span>&#125;;</span><br><span class="line"><span class="keyword">const</span> updated = &#123;...person&#125;;<span class="comment">// &#123;...personï¼Œname:"Bob"&#125;ä¹Ÿå¯ä»¥åŠ ä¸Šåˆ«çš„ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼Œè¿™é‡Œçš„æ‹·è´éƒ½æ˜¯æµ…æ‹·è´ï¼Œä¹Ÿå°±æ˜¯æŠŠåœ°å€ä¸€æ‘¸ä¸€æ ·çš„æ‹·è´å›æ¥äº†ï¼Œæ‰€ä»¥è¿™æ ·åœ¨ä¿®æ”¹æ•°ç»„çš„æ—¶å€™ï¼Œä¸¤ä¸ªåœ°æ–¹éƒ½ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥è¦åˆ©ç”¨æ·±æ‹·è´</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">	name:<span class="string">"John"</span>,</span><br><span class="line">	address:&#123;</span><br><span class="line">		country:<span class="string">"USA"</span>,</span><br><span class="line">		city:<span class="string">"San Francisco"</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> updated = &#123;</span><br><span class="line">	...person,</span><br><span class="line">	address:&#123;</span><br><span class="line">	...person.address,</span><br><span class="line">	city:<span class="string">"New York"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	name:<span class="string">"Bob"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™æ ·éšç€åµŒå¥—çš„å¢å¤šï¼Œæ·±æ‹·è´ä¼šå˜å¾—å¾ˆéº»çƒ¦ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸“é—¨å®ç°ä¸å¯èƒ½å˜æ€§çš„åº“</p>
<h3 id="Updating-Arrays"><a href="#Updating-Arrays" class="headerlink" title="Updating Arrays"></a>Updating Arrays</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="comment">//adding</span></span><br><span class="line"><span class="keyword">const</span> added = [...numbers,<span class="number">4</span>];</span><br><span class="line"><span class="comment">// particular position </span></span><br><span class="line"><span class="keyword">const</span> index = numbers.indexOf(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">const</span> added2 = [...numbers.slice(<span class="number">0</span>,index),</span><br><span class="line">              <span class="number">4</span>,</span><br><span class="line">              ...numbers.slice(index)]</span><br><span class="line"><span class="built_in">console</span>.log(added2) <span class="comment">// 1,4,2,3</span></span><br><span class="line"><span class="comment">//remove</span></span><br><span class="line"><span class="keyword">const</span> removed = numbers.filter(<span class="function"><span class="params">n</span>=&gt;</span>n!==<span class="number">2</span>);</span><br><span class="line"><span class="comment">//Updating </span></span><br><span class="line"><span class="keyword">const</span> updated = numbers.map(<span class="function"><span class="params">n</span>=&gt;</span>n===<span class="number">2</span>?<span class="number">20</span>:n)</span><br></pre></td></tr></table></figure>
<h3 id="Enforcing-Immutability"><a href="#Enforcing-Immutability" class="headerlink" title="Enforcing Immutability"></a>Enforcing Immutability</h3><p>ä¸å˜çš„åº“</p>
<p><strong>immutable</strong> æä¾›äº†å¾ˆå¤šä¸å˜çš„æ•°æ®ç»“æ„ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¸Œæœ›æœ‰å¯å˜çš„å¯¹è±¡</p>
<p><strong>immer</strong></p>
<p><strong>mori</strong></p>
<h3 id="Immutable-js"><a href="#Immutable-js" class="headerlink" title="Immutable.js"></a>Immutable.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="built_in">Map</span> &#125; <span class="keyword">from</span> <span class="string">"immutable"</span>;</span><br><span class="line"><span class="keyword">let</span> book = <span class="built_in">Map</span>(&#123; <span class="attr">title</span>: <span class="string">"Harry Potter"</span> &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(book);</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·è¿™ä¸ªå¯¹è±¡å°±æ˜¯ä¸å¯æ”¹å˜çš„äº†ï¼Œä½†æ˜¯è·å–å¯¹è±¡å†…çš„å±æ€§å˜å¾—æœ‰ç‚¹å›°éš¾ï¼Œéœ€è¦ç”¨getæ–¹æ³•ã€‚è€Œä¸”å¦‚æœè¦è½¬åŒ–åˆ°åŸç”Ÿjsè¯­è¨€è¿˜éœ€è¦toJS()æ¯”è¾ƒçƒ¦</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="built_in">Map</span> &#125; <span class="keyword">from</span> <span class="string">"immutable"</span>;</span><br><span class="line"><span class="keyword">let</span> book = <span class="built_in">Map</span>(&#123; <span class="attr">title</span>: <span class="string">"Harry Potter"</span> &#125;);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">publish</span>(<span class="params">book</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> book.set(<span class="string">"isPublished"</span>,<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line">book = publish(book)</span><br><span class="line"><span class="built_in">console</span>.log(book.toJS());</span><br></pre></td></tr></table></figure>
<h3 id="Immer"><a href="#Immer" class="headerlink" title="Immer"></a>Immer</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; produce &#125; <span class="keyword">from</span> <span class="string">"immer"</span>;</span><br><span class="line"><span class="keyword">let</span> book = &#123; <span class="attr">title</span>: <span class="string">"Harry Potter"</span> &#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">publish</span>(<span class="params">book</span>) </span>&#123;</span><br><span class="line"><span class="comment">// draftBookåªæ˜¯å¤åˆ¶äº†bookå¯¹è±¡ç„¶ååœ¨é‡Œé¢è¿›è¡Œä¿®æ”¹ï¼Œæˆ‘ä»¬è¿”å›çš„æ˜¯ä¿®æ”¹è¿‡åçš„å‡½æ•°ï¼Œè¿™æ¯”spreadæ–¹ä¾¿</span></span><br><span class="line">  <span class="keyword">return</span> produce(book, (draftBook) =&gt; &#123;</span><br><span class="line">    draftBook.isPublished = <span class="literal">true</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> updated = publish(book);</span><br><span class="line"><span class="built_in">console</span>.log(book);</span><br><span class="line"><span class="built_in">console</span>.log(updated);</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/13.png" style="zoom:80%;"></p>
<h3 id="Quiz"><a href="#Quiz" class="headerlink" title="Quiz"></a>Quiz</h3><p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/14.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/15.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/16.png" style="zoom: 67%;"></p>
<h3 id="Coding-Challenges"><a href="#Coding-Challenges" class="headerlink" title="Coding Challenges"></a>Coding Challenges</h3><p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/17.png" style="zoom: 80%;"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; pipe &#125; <span class="keyword">from</span> <span class="string">"lodash/fp"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pickTag = <span class="function"><span class="params">obj</span> =&gt;</span> obj.tag;</span><br><span class="line"><span class="keyword">const</span> toLowerCase = <span class="function"><span class="params">str</span> =&gt;</span> str.toLowerCase();</span><br><span class="line"><span class="keyword">const</span> bracketify = <span class="function"><span class="params">str</span> =&gt;</span> <span class="string">`(<span class="subst">$&#123;str&#125;</span>)`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> transform = pipe(pickTag, toLowerCase, bracketify);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> output = transform(&#123; <span class="attr">tag</span>: <span class="string">"JAVASCRIPT"</span> &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(output);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> recipe = &#123;</span><br><span class="line">  name: <span class="string">"Spaghetti Bolognese"</span>,</span><br><span class="line">  ingredients: [<span class="string">"egg"</span>, <span class="string">"salt"</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add an ingredient</span></span><br><span class="line"><span class="keyword">const</span> added = &#123;</span><br><span class="line">  ...recipe,</span><br><span class="line">  ingredients: [...recipe.ingredients, <span class="string">"cream"</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Update an ingredient</span></span><br><span class="line"><span class="keyword">const</span> updated = &#123;</span><br><span class="line">  ...recipe,</span><br><span class="line">  ingredients: recipe.ingredients.map(<span class="function"><span class="params">ingredient</span> =&gt;</span></span><br><span class="line">    ingredient === <span class="string">"egg"</span> ? <span class="string">"egg white"</span> : ingredient</span><br><span class="line">  )</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Remove an ingredient</span></span><br><span class="line"><span class="keyword">const</span> removed = &#123;</span><br><span class="line">  ...recipe,</span><br><span class="line">  ingredients: recipe.ingredients.filter(<span class="function"><span class="params">ingredient</span> =&gt;</span> ingredient !== <span class="string">"egg"</span>)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="Redux-Fundamentals"><a href="#Redux-Fundamentals" class="headerlink" title="Redux Fundamentals"></a>Redux Fundamentals</h2><h3 id="Redux-Architecture"><a href="#Redux-Architecture" class="headerlink" title="Redux Architecture"></a>Redux Architecture</h3><p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/18.png" style="zoom: 67%;"></p>
<p>æ¯”å¦‚åœ¨ä¸€ä¸ª è´­ç‰©è½¯ä»¶ä¸­æœ‰è¿™æ ·ä¸€ä¸ªå¯¹è±¡,å¯¹è±¡ä¸­å¯ä»¥å­˜æ”¾ä»»ä½•ç±»å‹</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	categories:[],</span><br><span class="line">	products:[],</span><br><span class="line">	cart:&#123;&#125;,</span><br><span class="line">	user:&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ä¸èƒ½ç›´æ¥æ”¹å˜storeï¼Œå› ä¸ºReduxæ˜¯å»ºç«‹åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¹‹ä¸Šçš„ã€‚åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ä¸èƒ½æ”¹å˜å¯¹è±¡ã€‚å¦‚æœéœ€è¦æ”¹å˜å¯¹è±¡éœ€è¦ç¼–å†™ä¸€ä¸ªå‡½æ•°ç„¶åé€šè¿‡ä¸€äº›åº“æˆ–è€…â€¦è¿ç®—ç¬¦åœ¨åŸå¯¹è±¡åŸºç¡€ä¸Šå½¢æˆä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚é‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±è¢«ç§°ä¹‹ä¸ºreducer.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">store</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">const</span> updated = &#123;...store&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>reducerä»storeä¸­è·å– current instance of store and return a data storeã€‚</p>
<p>ç°åœ¨é—®é¢˜æ¥äº†ï¼Œreduceræ˜¯æ€ä¹ˆçŸ¥é“storeä¸­çš„é‚£äº›å±æ€§éœ€è¦ä¿®æ”¹å‘¢ï¼Ÿè¿™æ—¶å€™æˆ‘ä»¬å¼•å…¥äº†action,actionå°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒæè¿°äº†åˆšåˆšå‘ç”Ÿäº†ä»€ä¹ˆï¼šç”¨æˆ·ç™»é™†äº†ï¼Œç™»å‡ºäº†ï¼Œå‘è´­ç‰©è½¦åŠ äº†ä»€ä¹ˆä¸œè¥¿äº†ä¹‹ç±»çš„ï¼Œä¹Ÿå°±æ˜¯appä¸­å¯èƒ½å‘ç”Ÿçš„äº‹ä»¶ã€‚æ‰€ä»¥æˆ‘ä»¬ä¼ å…¥reducerè¿˜åº”è¯¥æœ‰ç¬¬äºŒä¸ªå‚æ•°action</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">store,action</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">const</span> updated = &#123;...store&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‹å›¾æˆªå–è‡ª<a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html" target="_blank" rel="noopener">é˜®ä¸€å³°çš„æŠ€æœ¯åšå®¢1</a> </p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/19.png" style="zoom: 67%;"></p>
<p>æ¯ä¸€ä¸ªreduceræŒç®¡ä¸€ä¸ªstoreä¸­çš„å†…å®¹ï¼Œåœ¨é˜®ä¸€å³°çš„åšå®¢ä¸­å†™é“ï¼šReducer å‡½æ•°è´Ÿè´£ç”Ÿæˆ Stateã€‚ç”±äºæ•´ä¸ªåº”ç”¨åªæœ‰ä¸€ä¸ª State å¯¹è±¡ï¼ŒåŒ…å«æ‰€æœ‰æ•°æ®ï¼Œå¯¹äºå¤§å‹åº”ç”¨æ¥è¯´ï¼Œè¿™ä¸ª State å¿…ç„¶ååˆ†åºå¤§ï¼Œå¯¼è‡´ Reducer å‡½æ•°ä¹Ÿååˆ†åºå¤§ã€‚ä¸Šé¢ä»£ç ä¸­ï¼Œä¸‰ç§ Action åˆ†åˆ«æ”¹å˜ State çš„ä¸‰ä¸ªå±æ€§ã€‚</p>
<blockquote>
<ul>
<li>ADD_CHATï¼š<code>chatLog</code>å±æ€§</li>
<li>CHANGE_STATUSï¼š<code>statusMessage</code>å±æ€§</li>
<li>CHANGE_USERNAMEï¼š<code>userName</code>å±æ€§</li>
</ul>
</blockquote>
<p>è¿™ä¸‰ä¸ªå±æ€§ä¹‹é—´æ²¡æœ‰è”ç³»ï¼Œè¿™æç¤ºæˆ‘ä»¬å¯ä»¥æŠŠ Reducer å‡½æ•°æ‹†åˆ†ã€‚ä¸åŒçš„å‡½æ•°è´Ÿè´£å¤„ç†ä¸åŒå±æ€§ï¼Œæœ€ç»ˆæŠŠå®ƒä»¬åˆå¹¶æˆä¸€ä¸ªå¤§çš„ Reducer å³å¯ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æœ‰å¤šä¸ªreducerï¼Œä¹Ÿå¯ä»¥åªæœ‰ä¸€ä¸ªï¼Œå–å†³äºstoreä¸­æ•°æ®çš„å¤šå°‘</p>
<p>å¯ä»¥è¿™æ ·æ¥ç†è§£ï¼šActionæ˜¯eventï¼ŒReduceræ˜¯Event Handlerã€‚Reduceråªæ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œä»–åªæ˜¯æ¥æ”¶actionç„¶åè¿”å›æ›´æ–°è¿‡åçš„storeä¸­çš„å€¼</p>
<p>ç°åœ¨æˆ‘ä»¬ç”¨ä¸€ä¸ªä¾‹å­æ¥æè¿°ä¸€æ ·reduxçš„æœºåˆ¶ï¼š</p>
<p>å½“æˆ‘ä»¬å‘è´­ç‰©è½¦é‡Œå¢åŠ äº†ä¸€ä»¶å•†å“çš„æ—¶å€™ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªactionç„¶ådispatch(è°ƒé£)äº†å®ƒç»™<code>Store</code>, <code>Reducer</code> å‡½æ•°ä¸ç”¨æ‰‹åŠ¨è°ƒç”¨ï¼Œ<code>store.dispatch</code>æ–¹æ³•ä¼šè§¦å‘ <code>Reducer</code> çš„è‡ªåŠ¨æ‰§è¡Œã€‚ä¸ºæ­¤ï¼Œ<code>Store</code> éœ€è¦çŸ¥é“ Reducer å‡½æ•°Store æ”¶åˆ° Action ä»¥åï¼Œå¿…é¡»ç»™å‡ºä¸€ä¸ªæ–°çš„ Stateï¼Œè¿™æ · UI æ‰ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/20.png" style="zoom: 67%;"></p>
<h3 id="Your-First-Redux-App"><a href="#Your-First-Redux-App" class="headerlink" title="Your First Redux App"></a>Your First Redux App</h3><p>è¿™æ˜¯æˆ‘ä»¬è¦å»ºçš„reduxåº”ç”¨</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/21.png" style="zoom: 50%;"></p>
<p>è¿™æ˜¯æˆ‘ä»¬æ„å»ºreduxçš„æ­¥éª¤</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/22.png" style="zoom: 50%;"></p>
<p>npm i redux@4.0</p>
<h3 id="Designing-the-Store"><a href="#Designing-the-Store" class="headerlink" title="Designing the Store"></a>Designing the Store</h3><p>æˆ‘ä»¬è¦å»ºä¸€ä¸ªstoreï¼Œå°±è¦ææ¸…æ¥šStoreè¦å­˜æ”¾ä»€ä¹ˆæ•°æ®ã€‚åˆ†æä¸€ä¸‹ä¸Šé¢çš„uiæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ä¸€ä¸ªç»“æ„</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">	&#123;</span><br><span class="line">		id:<span class="number">1</span>,</span><br><span class="line">		description:<span class="string">""</span>,</span><br><span class="line">		resolved: <span class="literal">false</span></span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;...&#125;,</span><br><span class="line">	&#123;...&#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>åœ¨real-world appä¸­,æˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼Œ this store has  two slices . åœ¨æ²¡æœ‰ç™»é™†çš„æ—¶å€™currentUserä¸ºnullï¼Œç™»é™†äº†ä»¥åæŠŠå®ƒè®¾ç½®æˆä¸€ä¸ªåŒ…å«äº†ç™»å½•ä¿¡æ¯çš„å¯¹è±¡</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">	bugs:&#123;</span><br><span class="line">		id:<span class="number">1</span>,</span><br><span class="line">		description:<span class="string">""</span>,</span><br><span class="line">		resolved: <span class="literal">false</span></span><br><span class="line">	&#125;,</span><br><span class="line">	currentUser:&#123;&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="Defining-the-Actions"><a href="#Defining-the-Actions" class="headerlink" title="Defining the Actions"></a>Defining the Actions</h3><p>ç°åœ¨æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸ªActionï¼Œåœ¨è¿™ä¸ªappå½“ä¸­æˆ‘ä»¬å¯ä»¥å†™è¿™æ ·å‡ ä¸ªactions,åœ¨ real-world appä¸­æˆ‘ä»¬ä¼šæœ‰æ›´å¤šå…¶å®ƒçš„actions</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/23.png" style="zoom: 50%;"></p>
<p>ä¹‹å‰è¯´äº†Action æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚å…¶ä¸­çš„<code>type</code>å±æ€§æ˜¯å¿…é¡»çš„ï¼Œè¡¨ç¤º Action çš„åç§°ã€‚å…¶ä»–å±æ€§å¯ä»¥è‡ªç”±è®¾ç½®ï¼Œç¤¾åŒºæœ‰ä¸€ä¸ª<a href="https://github.com/acdlite/flux-standard-action" target="_blank" rel="noopener">è§„èŒƒ</a>å¯ä»¥å‚è€ƒã€‚ </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	type:<span class="string">"ADD_BUG"</span>,</span><br><span class="line"> <span class="comment">// type:"bugAdded"</span></span><br><span class="line">	descriptionL:<span class="string">"..."</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	type:<span class="string">"ADD_BUG"</span>,</span><br><span class="line">    payload:&#123;</span><br><span class="line">    	id:<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Creating-a-Reducer"><a href="#Creating-a-Reducer" class="headerlink" title="Creating a Reducer"></a>Creating a Reducer</h3><h3 id="Creating-the-Store"><a href="#Creating-the-Store" class="headerlink" title="Creating the Store"></a>Creating the Store</h3><h3 id="Dispatching-Actions"><a href="#Dispatching-Actions" class="headerlink" title="Dispatching Actions"></a>Dispatching Actions</h3><h3 id="Subscribing-to-the-Store"><a href="#Subscribing-to-the-Store" class="headerlink" title="Subscribing to the Store"></a>Subscribing to the Store</h3><h3 id="Action-Types"><a href="#Action-Types" class="headerlink" title="Action Types"></a>Action Types</h3><h3 id="Action-Creators"><a href="#Action-Creators" class="headerlink" title="Action Creators"></a>Action Creators</h3><h3 id="Exercise"><a href="#Exercise" class="headerlink" title="Exercise"></a>Exercise</h3><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><h2 id="Building-Redux-from-Scratch"><a href="#Building-Redux-from-Scratch" class="headerlink" title="Building Redux from Scratch"></a>Building Redux from Scratch</h2><h3 id="Redux-Store"><a href="#Redux-Store" class="headerlink" title="Redux Store"></a>Redux Store</h3><h3 id="Private-Properties"><a href="#Private-Properties" class="headerlink" title="Private Properties"></a>Private Properties</h3><h3 id="Dispatching-Actions-1"><a href="#Dispatching-Actions-1" class="headerlink" title="Dispatching Actions"></a>Dispatching Actions</h3><h3 id="Subscribing-to-the-Store-1"><a href="#Subscribing-to-the-Store-1" class="headerlink" title="Subscribing to the Store"></a>Subscribing to the Store</h3><h3 id="A-Quick-Note"><a href="#A-Quick-Note" class="headerlink" title="A Quick Note"></a>A Quick Note</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jasonâ€˜s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/" class="post-title-link" itemprop="url">Reactæ¡†æ¶åœ¨ä½œä¸šå½“ä¸­çš„åº”ç”¨</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-07 20:59:03" itemprop="dateCreated datePublished" datetime="2020-06-07T20:59:03+08:00">2020-06-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-29 21:42:12" itemprop="dateModified" datetime="2020-06-29T21:42:12+08:00">2020-06-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index"><span itemprop="name">react</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Reactæ¡†æ¶åœ¨ä½œä¸šå½“ä¸­çš„åº”ç”¨"><a href="#Reactæ¡†æ¶åœ¨ä½œä¸šå½“ä¸­çš„åº”ç”¨" class="headerlink" title="Reactæ¡†æ¶åœ¨ä½œä¸šå½“ä¸­çš„åº”ç”¨"></a>Reactæ¡†æ¶åœ¨ä½œä¸šå½“ä¸­çš„åº”ç”¨</h1><p>æœ¬ç¯‡åšå®¢éšæ—¶ä¼šå¼•ç”¨è¿™å››ç¯‡åšå®¢ä¸­å®ç°çš„åŠŸèƒ½ä¸æŠ€æœ¯ã€‚</p>
<p>é‰´äºåŸºç¡€åšå®¢çš„ç¯‡å¹…éƒ½æ¯”è¾ƒé•¿ï¼Œ<strong>ä¸ºäº†æœ‰è‰¯å¥½çš„é˜…è¯»ä½“éªŒ</strong>ï¼Œæœ¬æ–‡æ‰€æœ‰çš„é“¾æ¥ç‚¹å‡»å³å¯<strong>è·³è½¬è‡³ç›¸åº”ç« èŠ‚</strong>ã€‚</p>
<p><a href="https://jasonxqh.github.io/2020/05/30/reactåŸºç¡€/#more">reactåŸºç¡€1ç»„ä»¶ä¸ç»„åˆç»„ä»¶</a></p>
<p><a href="https://jasonxqh.github.io/2020/06/02/reactåŸºç¡€2/">reactåŸºç¡€2åˆ†é¡µæ’åºæœç´¢+è·¯ç”±</a></p>
<p> <a href="https://jasonxqh.github.io/2020/06/04/reactåŸºç¡€3/">reactåŸºç¡€3è¡¨å•ä¸åç«¯</a></p>
<p><a href="https://jasonxqh.github.io/2020/06/05/reactåŸºç¡€4æˆæƒä¸éƒ¨ç½²/">reactåŸºç¡€4æˆæƒä¸éƒ¨ç½²</a></p>
<h2 id="æ ¹ç›®å½•"><a href="#æ ¹ç›®å½•" class="headerlink" title="æ ¹ç›®å½•"></a>æ ¹ç›®å½•</h2><h3 id="index-js"><a href="#index-js" class="headerlink" title="index.js"></a><code>index.js</code></h3><p><code>index.js</code>åŠ è½½äº†<code>App</code>ï¼Œæ‰€ä»¥ä¹Ÿè¦ç€é‡å…³æ³¨</p>
<p><a href="https://www.cnblogs.com/sameen/p/9182925.html" target="_blank" rel="noopener">å…³äºreact-reduxä¸­Providerã€connectçš„è§£æ</a></p>
<p>é˜®ä¸€å³°çš„åšå®¢ä¸­ä¹Ÿæœ‰å¯¹Providerçš„è§£é‡Š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> thunkMiddleware <span class="keyword">from</span> <span class="string">'redux-thunk'</span>;</span><br><span class="line"><span class="keyword">import</span> loggerMiddleware <span class="keyword">from</span> <span class="string">'./store/middleware/logger'</span>;</span><br><span class="line"><span class="keyword">import</span> rootReducer <span class="keyword">from</span> <span class="string">'./store'</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./page/App.jsx'</span>;</span><br><span class="line"><span class="comment">//Store å°±æ˜¯ä¿å­˜æ•°æ®çš„åœ°æ–¹ï¼Œä½ å¯ä»¥æŠŠå®ƒçœ‹æˆä¸€ä¸ªå®¹å™¨ã€‚æ•´ä¸ªåº”ç”¨åªèƒ½æœ‰ä¸€ä¸ª Storeã€‚</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Provideræ˜¯react-redux æä¾›çš„ä¸€ä¸ª React ç»„ä»¶</span></span><br><span class="line"><span class="comment">ä½œç”¨å°±æ˜¯æŠŠ store æä¾›ç»™å…¶å­ç»„ä»¶</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> store = createStore(rootReducer, applyMiddleware(thunkMiddleware, loggerMiddleware));</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;<span class="regexp">/Provider&gt;,</span></span><br><span class="line"><span class="regexp">  document.getElementById('root'),</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>
<h3 id="setupProxy-js"><a href="#setupProxy-js" class="headerlink" title="setupProxy.js"></a><code>setupProxy.js</code></h3><p>è¿™ä¸ªæ–‡ä»¶çš„ç›®çš„æ˜¯è®¾ç½®ä¸€ä¸ªä»£ç†ã€‚å‰ç«¯å¯åŠ¨ç«¯å£æ˜¯3000ï¼Œåç«¯æ˜¯8080ï¼Œè¿™æ ·å°±ä¼šè·¨åŸŸï¼Œå‰ç«¯åšä¸€ä¸ªä»£ç†ï¼ŒæŠŠæ‰€æœ‰apiçš„æ¥å£è¯·æ±‚éƒ½è½¬å‘åˆ°8080ç«¯å£ã€‚è¿™æ ·å°±èƒ½æŠŠæ‰€æœ‰çš„è¯·æ±‚éƒ½è½¬å‘åˆ°ä½ èµ·çš„åç«¯çš„æœåŠ¡ä¸Šäº†</p>
<p><a href="https://www.jianshu.com/p/a2a5163fefac" target="_blank" rel="noopener">å‚è€ƒreacté…ç½®å¤šä¸ªä»£ç†,è·¨åŸŸ</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> proxy = <span class="built_in">require</span>(<span class="string">'http-proxy-middleware'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">app</span>) </span>&#123;</span><br><span class="line">  app.use(proxy(<span class="string">'/api'</span>, &#123; <span class="attr">target</span>: <span class="string">'http://localhost:8080/'</span> &#125;));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="æœåŠ¡"><a href="#æœåŠ¡" class="headerlink" title="æœåŠ¡"></a>æœåŠ¡</h2><h3 id="Api-js"><a href="#Api-js" class="headerlink" title="Api.js"></a><code>Api.js</code></h3><p>å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–°å»ºä¸€ä¸ª axios å®ä¾‹,è‡ªå®šä¹‰å®ä¾‹é»˜è®¤å€¼</p>
<p>æ¯”å¦‚åç«¯æ¥å£çš„å®Œæ•´çš„è·¯å¾„æ˜¯ï¼š<code>localhost:8080/api/users/list</code> ï¼Œæˆ‘æŠŠæ‰€æœ‰çš„è¯·æ±‚å…¬å…±éƒ¨åˆ†ï¼Œ<code>localhost:8080/api</code> æŠ½å‡ºæ¥ï¼Œæ”¾åœ¨axiosçš„baseURLé‡Œé¢ï¼Œè¿™æ ·åœ¨ä»£ç é‡Œé¢ï¼Œå°±ä¸ç”¨æ¯æ¬¡éƒ½å†™<code>localhost:8080/api</code>è¿™æ ·çš„å¼€å¤´äº†ã€‚é™ä½äº†ä»£ç çš„è€¦åˆåº¦</p>
<p>å‡å¦‚æœ‰ä¸€å¤©ï¼Œåç«¯æ”¹äº†apiçš„å¼€å¤´ï¼Œæ”¹äº†ç«¯å£å·ï¼Œéƒ½ä¸ç”¨ä¸€ä¸ªä¸ªåœ¨ä»£ç é‡Œé¢ä¸€ä¸ªä¸ªæ”¹äº†</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"><span class="keyword">const</span> Api = axios.create(&#123;</span><br><span class="line">  baseURL: <span class="string">'http://localhost:8080/api/'</span>,</span><br><span class="line">  <span class="comment">// timeout: ,</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Api;</span><br></pre></td></tr></table></figure>
<p><a href="http://www.axios-js.com/zh-cn/docs/#axios-create-config" target="_blank" rel="noopener">å¯ä»¥å‚ç…§axioså®˜æ–¹æ–‡æ¡£</a></p>
<h3 id="Util-js"><a href="#Util-js" class="headerlink" title="Util.js"></a><code>Util.js</code></h3><p>è¿™ç›¸å½“äº<a href="https://jasonxqh.github.io/2020/06/05/reactåŸºç¡€4æˆæƒä¸éƒ¨ç½²/#Refactoring">reactåŸºç¡€4æˆæƒä¸éƒ¨ç½²ä¸­çš„authService</a>ä¸­å­˜å–tokençš„æ“ä½œ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Util = &#123;</span><br><span class="line">  <span class="comment">// ç™»å½•åå°†tokenå­˜åˆ°localStorageä¸­</span></span><br><span class="line">  <span class="keyword">async</span> setToken(token) &#123;</span><br><span class="line">    <span class="keyword">await</span> localStorage.setItem(<span class="string">'token'</span>, token);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// å–å‡ºlocalStorageä¸­çš„token</span></span><br><span class="line">  getToken() &#123;</span><br><span class="line">    <span class="keyword">return</span> localStorage.getItem(<span class="string">'token'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Util;</span><br></pre></td></tr></table></figure>
<h2 id="storeç›®å½•æ—¢Reduxç†è§£"><a href="#storeç›®å½•æ—¢Reduxç†è§£" class="headerlink" title="storeç›®å½•æ—¢Reduxç†è§£"></a>storeç›®å½•æ—¢Reduxç†è§£</h2><p>å­¦ä¹ äº†</p>
<p><a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html" target="_blank" rel="noopener">é˜®ä¸€å³°çš„æŠ€æœ¯åšå®¢1</a> </p>
<p><a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_two_async_operations.html" target="_blank" rel="noopener">é˜®ä¸€å³°çš„æŠ€æœ¯åšå®¢2</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_three_react-redux.html" target="_blank" rel="noopener">é˜®ä¸€å³°çš„æŠ€æœ¯åšå®¢3</a></p>
<p><a href="https://blog.csdn.net/weixin_38178584/article/details/82189351" target="_blank" rel="noopener">React-Reduxæµç¨‹ä¸­ï¼ŒmapStateToPropsçš„ç†è§£</a> </p>
<p><a href="https://www.cnblogs.com/sameen/p/9182925.html" target="_blank" rel="noopener">å…³äºreact-reduxä¸­Providerã€connectçš„è§£æ</a><br>å’Œ <a href="https://www.bilibili.com/video/BV1K7411U7P5" target="_blank" rel="noopener">bç«™Moshæ•™ç¨‹</a></p>
<p>å†™ä¸‹äº†ä¸€ç¯‡å­åšå®¢  <a href="https://jasonxqh.github.io/2020/06/08/æµ…è°ˆredux1/">æµ…è°ˆredux1</a></p>
<p>å¯¹reduxæœ‰äº†ä¸€äº›äº†è§£ï¼Œäºæ˜¯æˆ‘æŠŠä»–åº”ç”¨åˆ°å¤„ç†ç™»å½•è¿™ä¸€éƒ¨åˆ†</p>
<h3 id="å¤„ç†ç™»å½•ç›®å½•"><a href="#å¤„ç†ç™»å½•ç›®å½•" class="headerlink" title="å¤„ç†ç™»å½•ç›®å½•"></a>å¤„ç†ç™»å½•ç›®å½•</h3><h4 id="actions-js"><a href="#actions-js" class="headerlink" title="actions.js"></a><code>actions.js</code></h4><p>åœ¨<a href="https://jasonxqh.github.io/2020/06/08/æµ…è°ˆredux1/">æµ…è°ˆredux1</a> ä¸­ï¼Œå¼•ç”¨é˜®ä¸€å³°çš„æ–‡å­—ä¹Ÿå¥½ï¼Œè‡ªå·±å†™ä¸‹çš„ç†è§£ä¹Ÿç½¢ï¼Œå¯¹actionçš„ä½œç”¨å·²ç»æ˜ç™½äº†ï¼Œå¯ä»¥ç”¨ä¸‹å›¾æ¥è§£é‡Š</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/10.png" style="zoom: 67%;"></p>
<p>æˆ‘è¿™é‡Œæœ‰ä¸¤ä¸ªActionsï¼Œä¸€ä¸ªæ˜¯å…³äºç”¨æˆ·ç™»é™†çš„ï¼Œä¸€ä¸ªæ˜¯å…³äºè·å–ç”¨æˆ·ä¿¡æ¯çš„ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; USER_LOGIN, GET_USER_INFO &#125; <span class="keyword">from</span> <span class="string">'./action-type'</span>;</span><br><span class="line"><span class="comment">/*action-type:</span></span><br><span class="line"><span class="comment">export const GET_USER_INFO = 'GET_USER_INFO';</span></span><br><span class="line"><span class="comment">export const USER_LOGIN = 'USER_LOGIN';</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">import</span> Util <span class="keyword">from</span> <span class="string">'../../js/Util'</span>;</span><br><span class="line"><span class="keyword">import</span> Api <span class="keyword">from</span> <span class="string">'../../js/Api'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actionUserLoginCreator = <span class="function">(<span class="params">type, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; name &#125; = data;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type,</span><br><span class="line">    data: &#123;</span><br><span class="line">      isLogin: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦ç™»å½•</span></span><br><span class="line">      name,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»é™†æˆåŠŸçš„actionï¼Œå¦‚æœåœ¨ç™»é™†ç•Œé¢æˆ‘ç‚¹å‡»ç™»é™†çš„åŒ–ï¼Œè¡¨å•ä¸­çš„ä¿¡æ¯(è´¦å·å¯†ç )ä¼šå½“ä½œå‚æ•°</span></span><br><span class="line"><span class="comment">ä¼ å…¥ï¼Œç„¶åæˆ‘ä»¬é€šè¿‡åç«¯Apiåˆ¤æ–­è¿™ä¸ªè´¦å·å¯†ç æ˜¯å¦åˆæ³•ï¼Œåˆæ³•çš„è¯æˆ‘ä»¬å°±ä¼šå¾—åˆ°ä¸€ä¸ªresponseï¼Œ</span></span><br><span class="line"><span class="comment">responseä¸­ä¼šæœ‰ä¸€ä¸ªdataå¯¹è±¡</span></span><br><span class="line"><span class="comment">ç„¶åæˆ‘ä»¬å°±æŠŠè¿™ä¸ªå¯¹è±¡ä¸­çš„tokenå­˜åœ¨æœ¬åœ°storageå½“ä¸­ï¼Œè¿™æ ·èƒ½è®©ç”¨æˆ·ä¿æŒç™»é™†çŠ¶æ€ã€‚</span></span><br><span class="line"><span class="comment">æœ€åæˆ‘ä»¬å‘å‡ºä¸€ä¸ªactionï¼Œè®©reduceræŒ‰ç…§æˆ‘ä»¬çš„è¦æ±‚æ›´æ–°stateï¼Œå¹¶è¿”å›ç»™éœ€è¦çš„ç»„ä»¶ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> userLogin = <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Api.post(<span class="string">'/users/login'</span>, params).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (res.data) &#123;</span><br><span class="line">        Util.setToken(res.data.token);</span><br><span class="line">        dispatch(actionUserLoginCreator(USER_LOGIN, &#123; <span class="attr">name</span>: res.data.name &#125;));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">è·å–ç”¨æˆ·ä¿¡æ¯çš„action</span></span><br><span class="line"><span class="comment">è¿™ä¸ªactionå°±æ˜¯è¯´é¦–å…ˆæˆ‘ä»å½“å‰çš„storageä¸­æ‹¿åˆ°token</span></span><br><span class="line"><span class="comment">ç„¶åå¦‚æœtokenå­˜åœ¨ï¼Œé‚£ä¹ˆè°ƒç”¨Api.getè·å–åˆ°ç”¨æˆ·çš„ä¿¡æ¯ï¼Œç„¶åè°ƒç”¨actionUserLoginCreatorå‡½æ•°</span></span><br><span class="line"><span class="comment">dispatchå‡ºå»ï¼Œ(è¿™é‡Œä¸ºäº†è®©ä»£ç çš„ç»“æ„æ›´åŠ æ˜äº†ï¼Œæˆ‘æŠŠå¯¹è±¡æŠ½ç¦»å‡ºæ¥æ–°å»ºäº†ä¸ªå‡½æ•°ã€‚),å…¶ä¸­ï¼š</span></span><br><span class="line"><span class="comment">type:GET_USER_INFO</span></span><br><span class="line"><span class="comment">data:&#123;</span></span><br><span class="line"><span class="comment">	name:å½“å‰ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="comment">	isLogin:true è¯´æ˜å½“å‰ç”¨æˆ·å·²ç»ç™»é™†ã€‚</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">é‚£ä¹ˆå¦‚æœtokenæ²¡æœ‰ï¼Œè¯´æ˜å½“å‰æ²¡æœ‰ç”¨æˆ·ç™»å½•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±dispatchä¸€ä¸ªactionå¯¹è±¡</span></span><br><span class="line"><span class="comment">typeè¿˜æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯isLoginä¸ºfalseï¼Œè€Œä¸”å› ä¸ºæ²¡æœ‰ç™»é™†ï¼Œæ‰€ä»¥æ²¡æœ‰åå­—ã€‚</span></span><br><span class="line"><span class="comment">type: GET_USER_INFO,</span></span><br><span class="line"><span class="comment">data: &#123;</span></span><br><span class="line"><span class="comment">  isLogin: false,</span></span><br><span class="line"><span class="comment">  name: null,</span></span><br><span class="line"><span class="comment">&#125;,</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getUserInfo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> token = Util.getToken();</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">      <span class="keyword">return</span> Api.get(<span class="string">'/users/info'</span>, &#123;</span><br><span class="line">        headers: &#123; <span class="attr">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span> &#125;,</span><br><span class="line">      &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.data.data.name) &#123;</span><br><span class="line">          dispatch(actionUserLoginCreator(GET_USER_INFO, &#123; <span class="attr">name</span>: res.data.data.name &#125;));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      dispatch(&#123;</span><br><span class="line">        type: GET_USER_INFO,</span><br><span class="line">        data: &#123;</span><br><span class="line">          isLogin: <span class="literal">false</span>,</span><br><span class="line">          name: <span class="literal">null</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="reducer"><a href="#reducer" class="headerlink" title="reducer"></a><code>reducer</code></h4><p>åœ¨<a href="https://jasonxqh.github.io/2020/06/08/æµ…è°ˆredux1/">æµ…è°ˆredux1</a> ä¸­è¯´è¿‡äº†reduceræ˜¯ä¸€ä¸ªçº¯å‡½æ•°ã€‚ä»–åªæ¥æ”¶stateå’Œactionç„¶åè¿”å›å¯¹åº”çš„æ›´æ–°å®Œæ¯•çš„state</p>
<p>å› ä¸ºreduxçš„storeä¸­ä¿ç®¡äº†æ‰€æœ‰ç»„ä»¶çš„stateï¼Œæ‰€ä»¥éœ€è¦stateçš„ç»„ä»¶ä¼šé€šè¿‡æŸç§æ–¹å¼dispatchä¸€ä¸ªactionè¿‡æ¥ï¼Œ</p>
<p>reduceræ¥æ”¶äº†ä»¥åæ›´æ–°stateå¯¹è±¡å¹¶è¿”å›ç»™é‚£ä¸ªç»„ä»¶ã€‚</p>
<p>è¿™ä¸ªappä¸­æœ‰ä¸¤ä¸ªactionsï¼Œä»–ä»¬çš„åå­—åˆ†åˆ«æ˜¯USER_LOGINå’ŒGET_USER_INFO</p>
<p>å› ä¸ºactionsä¸å¤šï¼Œæ‰€ä»¥æˆ‘æ²¡æœ‰å¿…è¦å»æ‹†åˆ†reducerã€‚åšä¸€ä¸ªswitchcaseå°±å¯ä»¥äº†ã€‚</p>
<p>å¦‚æœactionçš„type=USER_LOGIN,é‚£ä¹ˆæˆ‘ä»¬å°±æŠŠç”¨æˆ·çš„åå­—èµ‹ç»™stateï¼Œå¹¶æŠŠisLoginè®¾ç½®ä¸ºtrueï¼Œ</p>
<p>GET_USER_INFOäº¦ç„¶</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; USER_LOGIN, GET_USER_INFO &#125; <span class="keyword">from</span> <span class="string">'./action-type'</span>;</span><br><span class="line"><span class="keyword">const</span> initState = &#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    isLogin: <span class="literal">false</span>, <span class="comment">// æ˜¯å¦ç™»å½•</span></span><br><span class="line">    username: <span class="literal">null</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> reducer = <span class="function">(<span class="params">state = initState, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> USER_LOGIN:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        data: action.data,</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="keyword">case</span> GET_USER_INFO:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        data: action.data,</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> reducer;</span><br></pre></td></tr></table></figure>
<h3 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="headerlink" title="ä¸­é—´ä»¶"></a>ä¸­é—´ä»¶</h3><p>è¿™é‡Œéœ€è¦äº†è§£ä¸‹å‡½æ•°å¼ç¼–ç¨‹ï¼Œæˆ‘åœ¨  <a href="https://jasonxqh.github.io/2020/06/08/æµ…è°ˆredux1/#Functional-Programming-in-JavaScript-å‡½æ•°å¼ç¼–ç¨‹">æµ…è°ˆredux1ï¼šå‡½æ•°å¼ç¼–ç¨‹ </a>ä¸­å·²ç»æœ‰äº†åˆæ­¥çš„ä»‹ç»</p>
<p>è¿™ä¸ªå°±æ˜¯ä¸€ä¸ªå•çº¯çš„è®°å½•æ—¥å¿—çš„ä¸­é—´ä»¶ã€‚å¯¹æ•´ä¸ªappç”¨å¤„ä¸å¤§</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> logger = <span class="function">(<span class="params">&#123; getState, dispatch &#125;</span>) =&gt;</span> <span class="function">(<span class="params">next</span>) =&gt;</span> <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.group(action.type);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'dispatching:'</span>, action);</span><br><span class="line">  <span class="keyword">const</span> result = next(action);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'next state:'</span>, getState());</span><br><span class="line">  <span class="built_in">console</span>.groupEnd();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> logger;</span><br></pre></td></tr></table></figure>
<h3 id="index-js-1"><a href="#index-js-1" class="headerlink" title="index.js"></a><code>index.js</code></h3><p><code>Redux</code> æä¾›äº†ä¸€ä¸ª<code>combineReducers</code>æ–¹æ³•ï¼Œç”¨äº Reducer çš„æ‹†åˆ†ã€‚ä½ åªè¦å®šä¹‰å„ä¸ªå­ Reducer å‡½æ•°ï¼Œç„¶åç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå°†å®ƒä»¬åˆæˆä¸€ä¸ªå¤§çš„ Reducerã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> userData <span class="keyword">from</span> <span class="string">'./login/reducer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineReducers(&#123;</span><br><span class="line">  userData,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="mapStateToPropsçš„ç†è§£"><a href="#mapStateToPropsçš„ç†è§£" class="headerlink" title="mapStateToPropsçš„ç†è§£"></a><code>mapStateToProps</code>çš„ç†è§£</h3><p>å› ä¸ºåœ¨ä»£ç ä¸­å¾ˆå¤šæ—¶å€™æ¶‰åŠåˆ°è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œæˆ‘å°±ç›´æ¥åœ¨è¿™é‡Œè§£é‡Šä¸€ä¸‹ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    userData: state.userData.data,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>mapStateToProps</code>æ–¹æ³•å°±æ˜¯å®¹å™¨ç»„ä»¶å‘storeå£°æ˜éœ€è¦çš„stateçš„åœ°æ–¹ï¼Œå› ä¸ºæˆ‘ä»¬çš„storeæ˜¯æ•´ä¸ªåº”ç”¨åªæœ‰ä¸€ä»½ï¼Œæ ¹æ®<code>redux</code>çš„æ€æƒ³é€šè¿‡contextå¯ä»¥ä¿è¯æ¯ä¸€ä¸ªç»„ä»¶éƒ½å¯ä»¥ä»contextä¸­è·å–åˆ°storeï¼Œä¸éœ€è¦ä¸€çº§ä¸€çº§çš„ä»é¡¶å±‚ä¼ é€’ä¸‹æ¥ã€‚æ‰€ä»¥ï¼Œä¸€èˆ¬å®¹å™¨ç»„ä»¶ä¸Šä¼šæœ‰è¿™ä¸ªå‡½æ•°è´Ÿè´£é€šè¿‡contextè·å–åˆ°storeä¸­æƒ³è¦çš„state<strong>ï¼Œå³ä»storeä¸­è·å–åˆ°çš„stateç›¸å½“äºå®¹å™¨ç»„ä»¶ä»çˆ¶ç»„ä»¶æ‹¿åˆ°çš„props</strong>ï¼Œå› æ­¤ï¼Œ<code>mapStateToProps</code>å‡½æ•°ä¸€èˆ¬åªå­˜åœ¨äºå®¹å™¨ç»„ä»¶ï¼ˆæˆ–é¡¶å±‚ç»„ä»¶ï¼‰ä¸­ã€‚</p>
<p>   ç”±äºï¼Œstoreä¸­çš„æ‰€æœ‰stateéƒ½ç”±reduceræ¥æ›´æ–°ï¼Œæ‰€æœ‰ä¸€èˆ¬<code>mapStateToProps</code>æ–¹æ³•ä¸­éœ€è¦å®šä¹‰æ‰€æœ‰çš„reducerï¼ŒæŠŠæ‰€æœ‰çš„reducerçš„ç»“æœéƒ½è¦æ‹¿åˆ°ï¼Œä¿è¯æˆ‘ä»¬çš„storeä¸­èƒ½åŒ…å«æ‰€æœ‰çš„stateï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¿™ä¸ªå¤§åº”ç”¨éœ€è¦çš„æ‰€æœ‰æ•°æ®éƒ½èƒ½ä»é¡¶å±‚ç»„ä»¶ï¼ˆæˆ–å®¹å™¨ç»„ä»¶ï¼‰è·å–ï¼Œç„¶åä¼ é€’ä¸‹å»ï¼›</p>
<p> è¿™é‡Œï¼Œé€šè¿‡è¿™ä¸ª<code>mapStateToProps</code>ï¼Œè¿”å›äº†ä¸€ä¸ªæœ¬åœ°çš„stateï¼Œstateä¸­æœ‰<code>userData.data</code></p>
<p><code>userData.data</code>å…¶å®å°±æ˜¯reducerä¸­è¿”å›çš„å¯¹è±¡ä¸­userçš„åå­—å’Œç™»é™†ä¸å¦çš„çŠ¶æ€</p>
<h3 id="mapDispatchToPropsçš„ç†è§£"><a href="#mapDispatchToPropsçš„ç†è§£" class="headerlink" title="mapDispatchToPropsçš„ç†è§£"></a><code>mapDispatchToProps</code>çš„ç†è§£</h3><p><code>mapDispatchToProps</code></p>
<ul>
<li>dispatchæ˜¯å¿…é¡»çš„å‚æ•°</li>
<li><code>mapDispatchToProps</code>åœ¨ç»„ä»¶constructor()ä¸­è¢«æ‰§è¡Œï¼Œå› è€Œåªæ‰§è¡Œä¸€æ¬¡</li>
<li><code>mapDispatchToProps</code>ä¸ºç»„ä»¶æä¾›äº†ç”¨äºæ”¹å˜StoreçŠ¶æ€çš„æ–¹æ³•ï¼Œå¹¶å°†å…¶å®šä¹‰ä¸ºç»„ä»¶çš„prop</li>
</ul>
<p><code>mapDispatchToProps</code>ç”¨äºå»ºç«‹ç»„ä»¶è·Ÿ<code>store.dispatch</code>çš„æ˜ å°„å…³ç³»,å¯ä»¥æ˜¯ä¸€ä¸ªobjectï¼Œä¹Ÿå¯ä»¥ä¼ å…¥å‡½æ•°<br>å¦‚æœ<code>mapDispatchToProps</code>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå¯ä»¥ä¼ å…¥dispatch,ownProps, å®šä¹‰UIç»„ä»¶å¦‚ä½•å‘å‡ºactionï¼Œå®é™…ä¸Šå°±æ˜¯è¦è°ƒç”¨dispatchè¿™ä¸ªæ–¹æ³•<br>è¿™ä¸¤ä¸ªä¾‹å­</p>
<p>1.å°±æ˜¯è¯´å¦‚æœæˆ‘è°ƒç”¨<code>getUserInfo</code>çš„è¯ï¼Œæˆ‘å°±ä¼šdispatchä¸€ä¸ª<code>getUserInfo</code>çš„action,è¿™ä¸ªactionçš„ä½œç”¨æ˜¯è·å–åˆ°ç”¨æˆ·çš„ä¿¡æ¯</p>
<p>2.å¦‚æœæˆ‘è°ƒç”¨<code>getUserLogin</code>ï¼Œé‚£ä¹ˆæˆ‘å°±ä¼šdispatchä¸€ä¸ª<code>userLogin</code>çš„actionï¼Œé‡Œé¢åŒ…å«äº†æˆ‘ä¼ å…¥çš„ç™»å½•ä¿¡æ¯params</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch</span>) =&gt;</span> (&#123;</span><br><span class="line">  getUserInfo: <span class="function"><span class="params">()</span> =&gt;</span> dispatch(getUserInfo()),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch</span>) =&gt;</span> (&#123;</span><br><span class="line">  getUserLogin: <span class="function">(<span class="params">params</span>) =&gt;</span> dispatch(userLogin(params)),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="connectçš„ç†è§£"><a href="#connectçš„ç†è§£" class="headerlink" title="connectçš„ç†è§£"></a>connectçš„ç†è§£</h3><p> <code>mapStateToProps</code>,<code>mapDispatchToProps</code>å‡½æ•°æ˜¯é€šè¿‡<code>redux</code>çš„connectå‡½æ•°ä¸reactè”ç³»åœ¨ä¸€èµ·çš„ï¼Œå¦‚connectï¼ˆ<code>mapStateToProps</code>ï¼Œ<code>mapDispatchToProps</code>ï¼‰ï¼ˆxxxPagesï¼‰ï¼Œ<strong>connectè¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°</strong>ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè°ƒç”¨å­ç»„ä»¶ï¼ˆå‚»ç“œç»„ä»¶ã€æœ¨å¶ç»„ä»¶ï¼‰ï¼Œå®Œæˆå®¹å™¨ç»„ä»¶ä¸æœ¨å¶ç»„ä»¶çš„é“¾æ¥ï¼Œè€Œ<code>mapStateToProps</code>,<code>mapDispatchToProps</code>çš„è¿”å›å°±æ˜¯è¿™ä¸ªæœ¨å¶ç»„ä»¶çš„propsï¼Œèµ°è¿™ä¸ªæœ¨å¶ç»„ä»¶çš„æ›´æ–°è¿‡ç¨‹ </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(</span><br><span class="line">  mapStateToProps,</span><br><span class="line">  mapDispatchToProps,</span><br><span class="line">)(wrappedLoginForm);</span><br></pre></td></tr></table></figure>
<h3 id="providerçš„ç†è§£"><a href="#providerçš„ç†è§£" class="headerlink" title="providerçš„ç†è§£"></a>providerçš„ç†è§£</h3><p>åœ¨indexä¸­ï¼Œæˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªprovideræ ‡ç­¾</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;<span class="regexp">/Provider&gt;,</span></span><br><span class="line"><span class="regexp">  document.getElementById('root'),</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>
<h2 id="ç»„ä»¶éƒ¨åˆ†"><a href="#ç»„ä»¶éƒ¨åˆ†" class="headerlink" title="ç»„ä»¶éƒ¨åˆ†"></a>ç»„ä»¶éƒ¨åˆ†</h2><h3 id="NavBar"><a href="#NavBar" class="headerlink" title="NavBar"></a><code>NavBar</code></h3><h4 id="å®ç°å½¢å¼ï¼š"><a href="#å®ç°å½¢å¼ï¼š" class="headerlink" title="å®ç°å½¢å¼ï¼š"></a>å®ç°å½¢å¼ï¼š</h4><p>åœ¨<code>admin</code>å½“ä¸­</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/1.png" style="zoom: 67%;"></p>
<p>åœ¨æ™®é€šç”¨æˆ·ä¸­<br><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/2.png" style="zoom: 67%;"></p>
<p>åœ¨æœªç™»å½•ç•Œé¢</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/3.png" style="zoom: 67%;"></p>
<h4 id="å®ç°é€»è¾‘-ä»£ç åˆ†æ"><a href="#å®ç°é€»è¾‘-ä»£ç åˆ†æ" class="headerlink" title="å®ç°é€»è¾‘+ä»£ç åˆ†æ"></a>å®ç°é€»è¾‘+ä»£ç åˆ†æ</h4><p>ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯¹æºç è¿›è¡Œåˆ†å‰²</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createHashHistory &#125; <span class="keyword">from</span> <span class="string">'history'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.scss'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Icon, Dropdown, Menu &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> Util <span class="keyword">from</span> <span class="string">'../../../js/Util'</span>;</span><br><span class="line"><span class="keyword">const</span> history = createHashHistory();</span><br><span class="line"><span class="keyword">const</span> &#123; Fragment &#125; = React;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommonHeader</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">      <span class="comment">//åœ¨æ„é€ å™¨ä¸­é¦–å…ˆsuper</span></span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">      <span class="comment">//stateä¸­ä¿å­˜NavBarç»„ä»¶çš„é»˜è®¤ä¿¡æ¯ï¼Œé‡Œé¢æœ‰isLoginï¼Œé»˜è®¤æœªç™»å½•;nameé»˜è®¤ä¸ºç©ºä¸²</span></span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      isLogin: <span class="literal">false</span>,</span><br><span class="line">      name: <span class="string">''</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//cdmä¸ºç©º</span></span><br><span class="line">  componentDidMount() &#123;&#125;</span><br></pre></td></tr></table></figure>
<h5 id="ä¸€äº›å‡½æ•°çš„å®ç°"><a href="#ä¸€äº›å‡½æ•°çš„å®ç°" class="headerlink" title="ä¸€äº›å‡½æ•°çš„å®ç°"></a>ä¸€äº›å‡½æ•°çš„å®ç°</h5><p>1.history.push()åœ¨ä¸Šæ–‡<a href="https://jasonxqh.github.io/2020/06/02/reactåŸºç¡€2/#Programmatic-Navigation">reactåŸºç¡€2åˆ†é¡µæ’åºæœç´¢+è·¯ç”±ä¸­çš„Programmatic Navigation</a>ä¸­çš„è·¯ç”±éƒ¨åˆ†æœ‰è¯¦ç»†æåˆ°ã€‚å†æ¬¡ä¸å¿…å¤šè¯´<br>2.NavBarä¸­å®ç°çš„è·¯ç”±è·³è½¬:<br>3.goSign: è·³è½¬åˆ°/typeå…¶ä¸­è¿™ä¸ªè¯­æ³•æ˜¯ES6çš„æ¨¡æ¿è¯­æ³•ï¼Œ${}ä¸­çš„å…ƒç´ ä¼šéšç€ä¼ å…¥çš„ä¸åŒè€Œå®æ—¶æ¸²æŸ“ï¼Œå…·ä½“çš„å®ç°åŠŸèƒ½å°±æ˜¯è·¯ç”±è·³è½¬ï¼Œæˆ‘ä¹‹æ‰€ä»¥å†™æˆè¿™æ ·æ˜¯å› ä¸ºå®ƒæ—¢å¯ä»¥å¯ä»¥è·³è½¬åˆ°loginï¼Œä¹Ÿå¯ä»¥è·³register è·³åˆ°å“ªé‡Œå®Œå…¨çœ‹æˆ‘ä¼ å…¥ä»€ä¹ˆtype<br>4.goHome: è·³è½¬åˆ°ä¸»é¡µ<br>5.logout: åˆ é™¤å½“å‰çš„token(ç½®ç©º)è·³è½¬åˆ°ä¸»é¡µ.å…¶ä¸­Utilä¸­å°è£…äº†setTokenå’ŒgetTokenä¸¤ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«<br>æ˜¯ç”¨æ¥è®¾ç½®Tokenå’Œè·å–Tokençš„å‡½æ•°(ä¹Ÿå°±æ˜¯localStorage.setItemä¹‹ç±»çš„ï¼Œåœ¨<a href="https://jasonxqh.github.io/2020/06/05/reactåŸºç¡€4æˆæƒä¸éƒ¨ç½²/#Storing-the-JWT-JSON-Token">reactåŸºç¡€4æˆæƒä¸­çš„Storing the JWT(JSON Token)ç« èŠ‚</a>æåŠ)<br>6.goManage:è·³è½¬åˆ°/manageä¹Ÿå°±æ˜¯ç®¡ç†é¡µé¢<br>7.goTarget:è·³è½¬åˆ°çš„åœ°æ–¹éštargetå†³å®š</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">goSign(type) &#123;</span><br><span class="line">  history.push(<span class="string">`/<span class="subst">$&#123;type&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">goHome() &#123;</span><br><span class="line">  history.push(<span class="string">'/'</span>);</span><br><span class="line">&#125;</span><br><span class="line">logout() &#123;</span><br><span class="line">  Util.setToken(<span class="string">''</span>);</span><br><span class="line">  <span class="built_in">window</span>.location.reload(<span class="string">'/'</span>);</span><br><span class="line">&#125;</span><br><span class="line">goManage() &#123;</span><br><span class="line">  history.push(<span class="string">'/manage'</span>);</span><br><span class="line">&#125;</span><br><span class="line">goTarget(target) &#123;</span><br><span class="line">  history.push(<span class="string">`/<span class="subst">$&#123;target&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="render-æ¸²æŸ“å™¨éƒ¨åˆ†"><a href="#render-æ¸²æŸ“å™¨éƒ¨åˆ†" class="headerlink" title="render()æ¸²æŸ“å™¨éƒ¨åˆ†"></a>render()æ¸²æŸ“å™¨éƒ¨åˆ†</h5><p> <strong>renderæ¸²æŸ“å™¨éƒ¨åˆ†</strong>ï¼Œé¦–å…ˆææ„userData<br> ç„¶åä»userDataä¸­ææ„åå­—å’Œç™»é™†çŠ¶æ€<br> menuå°±æ˜¯ä¸‹æ‹‰è¡¨å•ï¼Œé‡Œé¢å°è£…äº†ä¸€ä¸ªæŒ‰é’®ï¼Œä¹Ÿå°±æ˜¯æ¨å‡ºï¼Œç‚¹å‡»é€€å‡ºä¼šåˆ é™¤Tokenå¹¶å›åˆ°é¦–é¡µ</p>
<p><strong>renderä¸­è¿”å›çš„ç»„ä»¶éƒ¨åˆ†:</strong><br>1.ä¸€å¼€å§‹å½“ç„¶æ˜¯ä¸ªNavbaræ ‡ç­¾ï¼Œç‚¹å‡»å®ƒå°±ä¼šå›åˆ°ä¸»é¡µ<br>2.éšåæ˜¯æ¡ä»¶æ¸²æŸ“ï¼Œå°±æ˜¯åªæœ‰å½“ç”¨æˆ·æ˜¯adminçš„æ—¶å€™ï¼Œæ‰ä¼šæ˜¾ç¤ºè¿™ä¸ªæŒ‰é’®ï¼Œå¦åˆ™æ˜¯ä¸ä¼šæ˜¾ç¤ºçš„ã€‚ç‚¹å‡»è¿™ä¸ªæŒ‰é’®è·³è½¬åˆ°ç”¨æˆ·ç®¡ç†ç•Œé¢ï¼Œå…·ä½“ç•Œé¢çš„é€»è¾‘å†æ¬¡ä¸ç»†è¯´ã€‚<br>3.ç„¶åæ˜¯å››ä¸ªè¡¨å•çš„æ¡ä»¶æ¸²æŸ“ã€‚å°±æ˜¯åªæœ‰isLogin= trueçš„æ—¶å€™ï¼Œæ‰ä¼šæ˜¾ç¤ºè¿™å››ä¸ªè¡¨å•çš„æŒ‰é’®.ç‚¹å‡»è¿™4ä¸ªæŒ‰é’®ä¼šåˆ†åˆ«è·³è½¬åˆ°ç›¸åº”çš„å±•ç¤ºé¡µé¢<br>4.å†ç„¶åæ˜¯å³è¾¹çš„éƒ¨åˆ†ï¼Œè¿™ä¸ªéƒ¨åˆ†ä¼šæ ¹æ®æ˜¯å¦ç™»é™†è€Œå˜æ¢ã€‚é€šè¿‡åˆ¤æ–­isLoginï¼Ÿå¦‚æœæœªç™»å½•ï¼Œé‚£ä¹ˆå°±æ¸²æŸ“ç™»å½•å’Œæ³¨å†Œè¿™ä¸¤ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»åè°ƒç”¨goSignä¼ å…¥æˆ‘æƒ³å–å¾—åœ°æ–¹(loginæˆ–è€…register)è¿™å°±ä½“ç°äº†ES6æ¨¡æ¿åŒ–è¯­è¨€çš„å¥½å¤„ï¼Œå½“ç„¶ç›´æ¥åˆ©ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ä¹Ÿå¯ä»¥; å¦‚æœå·²ç»æ³¨å†Œï¼Œé‚£ä¹ˆå†æœ‰è¾¹æ˜¾ç¤ºä¸€ä¸ªä¸‹æ‹‰è¡¨å•: ä¸‹æ‹‰è¡¨å•ä¸­æœ‰ä¸Šæ–‡constçš„menuå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯é€€å‡ºã€‚æœªæ˜¾ç¤ºä¸‹æ‹‰è¡¨å•çš„æ—¶å€™å³è¾¹æ˜¯ä¸€ä¸ªantdåº“çš„iconå’Œç”¨æˆ·çš„åå­—ï¼Œ<br>å°±å¦‚ä¸Šæ–‡å›¾ç‰‡ä¸­å±•ç¤ºçš„ä¸€æ ·</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"> render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; userData &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> &#123; name, isLogin &#125; = userData;</span><br><span class="line">    <span class="keyword">const</span> menu = (</span><br><span class="line">      &lt;Menu&gt;</span><br><span class="line">        &lt;Menu.Item key=<span class="string">"0"</span> onClick=&#123;() =&gt; <span class="keyword">this</span>.logout()&#125;&gt;</span><br><span class="line">          é€€å‡º</span><br><span class="line">        &lt;<span class="regexp">/Menu.Item&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Menu&gt;</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"header-nav"</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">"home-logo"</span>&gt;</span><br><span class="line">          &lt;div className=<span class="string">"logo-text"</span> onClick=&#123;() =&gt; <span class="keyword">this</span>.goHome()&#125;&gt;</span><br><span class="line">            NavBar</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div className="tab-bar"&gt;</span></span><br><span class="line"><span class="regexp">            &#123;name === 'admin' ? (</span></span><br><span class="line"><span class="regexp">              &lt;div className="bar-item" onClick=&#123;() =&gt; this.goManage()&#125;&gt;</span></span><br><span class="line"><span class="regexp">                ç”¨æˆ·ç®¡ç†</span></span><br><span class="line"><span class="regexp">              &lt;/</span>div&gt;</span><br><span class="line">            ) : <span class="literal">null</span>&#125;</span><br><span class="line">            &#123;isLogin &amp;&amp; (</span><br><span class="line">              &lt;div style=&#123;&#123; <span class="attr">display</span>: <span class="string">'flex'</span> &#125;&#125;&gt;</span><br><span class="line">                &lt;div className=<span class="string">"bar-item"</span> onClick=&#123;() =&gt; <span class="keyword">this</span>.goTarget(<span class="string">'douban'</span>)&#125;&gt;</span><br><span class="line">                  è±†ç“£Top250</span><br><span class="line">                &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">                &lt;div className="bar-item" onClick=&#123;() =&gt; this.goTarget('maoyan')&#125;&gt;</span></span><br><span class="line"><span class="regexp">                  çŒ«çœ¼Top100</span></span><br><span class="line"><span class="regexp">                &lt;/</span>div&gt;</span><br><span class="line">                &lt;div className=<span class="string">"bar-item"</span> onClick=&#123;() =&gt; <span class="keyword">this</span>.goTarget(<span class="string">'operas'</span>)&#125;&gt;</span><br><span class="line">                  å‰§é›†</span><br><span class="line">                &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">                &lt;div className="bar-item" onClick=&#123;() =&gt; this.goTarget('taobao')&#125;&gt;</span></span><br><span class="line"><span class="regexp">                  æ·˜å®å’–å•¡</span></span><br><span class="line"><span class="regexp">                &lt;/</span>div&gt;</span><br><span class="line">              &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">            )&#125;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>div&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div className="nav-right"&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div className="mine"&gt;</span></span><br><span class="line"><span class="regexp">            &#123;!isLogin ? (</span></span><br><span class="line"><span class="regexp">              &lt;Fragment&gt;</span></span><br><span class="line"><span class="regexp">                &lt;div className="sign" onClick=&#123;() =&gt; this.goSign('login')&#125;&gt;</span></span><br><span class="line"><span class="regexp">                  ç™»å½•</span></span><br><span class="line"><span class="regexp">                &lt;/</span>div&gt;</span><br><span class="line">                &lt;div className=<span class="string">"split-line"</span>&gt;|&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">                &lt;div className="sign" onClick=&#123;() =&gt; this.goSign('register')&#125;&gt;</span></span><br><span class="line"><span class="regexp">                  æ³¨å†Œ</span></span><br><span class="line"><span class="regexp">                &lt;/</span>div&gt;</span><br><span class="line">              &lt;<span class="regexp">/Fragment&gt;</span></span><br><span class="line"><span class="regexp">            ) : (</span></span><br><span class="line"><span class="regexp">              &lt;Dropdown overlay=&#123;menu&#125;&gt;</span></span><br><span class="line"><span class="regexp">                &lt;div className="icon-header"&gt;</span></span><br><span class="line"><span class="regexp">                  &lt;Icon type="smile" className="icon-mine icon" theme="twoTone" /</span>&gt;</span><br><span class="line">                  &lt;span className=<span class="string">"user-name"</span>&gt;&#123;name&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">                  &lt;Icon type="caret-down" className="down icon" /</span>&gt;</span><br><span class="line">                &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">              &lt;/</span>Dropdown&gt;</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"> </span></span><br><span class="line"><span class="regexp">const mapStateToProps = (state) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  return &#123;</span></span><br><span class="line"><span class="regexp">    userData: state.userData.data,</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default connect(mapStateToProps, null)(CommonHeader);</span></span><br></pre></td></tr></table></figure>
<h3 id="Layout"><a href="#Layout" class="headerlink" title="Layout"></a><code>Layout</code></h3><p>Layoutç»„ä»¶å°±æ˜¯å¤§å®¶çš„å…±äº«ä¸»é¡µï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨é‡Œé¢æ¸²æŸ“äº†ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†</p>
<p>1.NavBar</p>
<p>2.æ‰€æœ‰é¡µé¢ä¸­çš„å…ƒç´ (ç»§æ‰¿props)</p>
<p>3.Footerï¼ˆä¸‹å›¾ä¸­æœ€åä¸€æ¡æš—å¸¦ï¼‰</p>
<p>ï¼ˆå¿½ç•¥HelloWorldï¼‰è¿™å°±æ˜¯Layoutç»„ä»¶çš„æ ·å­</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/4.png" style="zoom: 67%;"></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./layout.scss'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Layout &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> HeaderNav <span class="keyword">from</span> <span class="string">'../headerNav'</span>;</span><br><span class="line"><span class="comment">//Header,Footer,Contentéƒ½æ˜¯ä» antdå¯¼å…¥çš„Layoutå¯¹è±¡ï¼Œå°±ä¸ç”¨è‡ªå·±è®¾è®¡cssäº†</span></span><br><span class="line"><span class="keyword">const</span> &#123; Header, Footer, Content &#125; = Layout;</span><br><span class="line">render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Layout className=<span class="string">"layout"</span>&gt;</span><br><span class="line">          &lt;Header className=<span class="string">"header"</span>&gt;</span><br><span class="line">            &lt;div className=<span class="string">"content-1200"</span>&gt;</span><br><span class="line">              &lt;HeaderNav /&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>Header&gt;</span><br><span class="line">          &lt;Content className=<span class="string">"main"</span>&gt;</span><br><span class="line">            &lt;div className=<span class="string">"content-1200"</span>&gt;</span><br><span class="line">              &#123;<span class="keyword">this</span>.props.children&#125;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>Content&gt;</span><br><span class="line">          &lt;Footer className=<span class="string">"footer"</span>&gt;</span><br><span class="line">            &lt;div className=<span class="string">"content-1200"</span>&gt;</span><br><span class="line">              &lt;div className=<span class="string">"footer-content"</span> /&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>Footer&gt;</span><br><span class="line">        &lt;<span class="regexp">/Layout&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> CommonLayout;</span><br></pre></td></tr></table></figure>
<p>layout.scssè¡¨å•åœ¨è¿™é‡Œå°±ä¸å±•ç¤ºäº†ã€‚</p>
<h3 id="Loading"><a href="#Loading" class="headerlink" title="Loading"></a><code>Loading</code></h3><p>è¿™å°±æ˜¯ä¸€ä¸ªå½“é¡µé¢åŠ è½½çš„æ—¶å€™è½¬åœˆåœˆçš„ç»„ä»¶ï¼Œä»antdå¯¼å…¥å³å¯</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Spin &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Loading</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Spin /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Loading;</span></span><br></pre></td></tr></table></figure>
<h3 id="PrivateRoute"><a href="#PrivateRoute" class="headerlink" title="PrivateRoute"></a><code>PrivateRoute</code></h3><p>è¿™å°±æ˜¯ä¸€ä¸ªç§æœ‰è·¯ç”±ï¼Œç›®çš„æ˜¯<strong>ä¸è®©æœªæˆæƒçš„ç”¨æˆ·å¾—åˆ°æˆ‘çš„å±•ç¤ºé¡µé¢</strong>ã€‚</p>
<p>å®ç°é€»è¾‘åœ¨<a href="https://jasonxqh.github.io/2020/06/05/reactåŸºç¡€4æˆæƒä¸éƒ¨ç½²/#Extracting-PrivateRoute">reactåŸºç¡€4æˆæƒä¸éƒ¨ç½²çš„Extracting PrivateRoute</a>   ç« èŠ‚ä¸­æœ‰è¯¦ç»†è¯´æ˜ã€‚åœ¨è¿™é‡Œä»…ä»…å±•ç¤ºä»£ç ï¼Œå¹¶ä¸ç»†è¯´é€»è¾‘ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Route, Redirect &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getUserInfo &#125; <span class="keyword">from</span> <span class="string">'../../../store/login/actions'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrivateRoute</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.props.getUserInfo();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">component</span>: Component, userData, ...rest &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> &#123; isLogin &#125; = userData;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Route</span><br><span class="line">        &#123;...rest&#125;</span><br><span class="line">        render=&#123;(props) =&gt; &#123;</span><br><span class="line">          <span class="keyword">return</span> isLogin ? (</span><br><span class="line">            &lt;Component &#123;...props&#125; /&gt;</span><br><span class="line">          ) : (</span><br><span class="line">            &lt;Redirect</span><br><span class="line">              to=&#123;&#123;</span><br><span class="line">                pathname: <span class="string">'/login'</span>,</span><br><span class="line">                state: &#123; <span class="attr">from</span>: props.location &#125;,</span><br><span class="line">              &#125;&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">          );</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state, props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    userData: state.userData.data,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch</span>) =&gt;</span> (&#123;</span><br><span class="line">  getUserInfo: <span class="function"><span class="params">()</span> =&gt;</span> dispatch(getUserInfo()),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(PrivateRoute);</span><br></pre></td></tr></table></figure>
<h2 id="é¡µé¢éƒ¨åˆ†"><a href="#é¡µé¢éƒ¨åˆ†" class="headerlink" title="é¡µé¢éƒ¨åˆ†"></a>é¡µé¢éƒ¨åˆ†</h2><h3 id="App-jsx"><a href="#App-jsx" class="headerlink" title="App.jsx"></a><code>App.jsx</code></h3><p>Appç»„ä»¶æ˜¯æ ¹ç»„ä»¶æ‰€ä»¥æˆ‘ä»¬å•ç‹¬è®²ã€‚å…ˆä¸Šä»£ç </p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Suspense, lazy &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.scss'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; HashRouter <span class="keyword">as</span> Router, Route, Switch &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> PrivateRoute <span class="keyword">from</span> <span class="string">'./components/PrivateRoute'</span>;</span><br><span class="line"><span class="keyword">import</span> Loading <span class="keyword">from</span> <span class="string">'./components/loading'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./home'</span>));</span><br><span class="line"><span class="keyword">const</span> Sign = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./sign'</span>));</span><br><span class="line"><span class="keyword">const</span> Register = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./register'</span>));</span><br><span class="line"><span class="keyword">const</span> Manage = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./manage'</span>));</span><br><span class="line"><span class="keyword">const</span> Douban = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./douban'</span>));</span><br><span class="line"><span class="keyword">const</span> Taobao = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./taobao'</span>));</span><br><span class="line"><span class="keyword">const</span> Maoyan = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./maoyan'</span>));</span><br><span class="line"><span class="keyword">const</span> Operas = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./operas'</span>));</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Router&gt;</span><br><span class="line">        &lt;Suspense</span><br><span class="line">          fallback=&#123;<span class="comment">//è¿™é‡Œå¦‚æœç­‰å¾…çš„åŒ–ï¼Œé‚£ä¹ˆå°±åŠ è½½ä¸Šé¢æ‰€è¯´çš„Loadingç»„ä»¶</span></span><br><span class="line">            &lt;div className=<span class="string">"loading"</span>&gt;</span><br><span class="line">              &lt;Loading /&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &#125;</span></span><br><span class="line"><span class="regexp">        &gt;</span></span><br><span class="line"><span class="regexp">          &lt;Switch&gt;</span></span><br><span class="line"><span class="regexp">            &lt;PrivateRoute exact path="/</span><span class="string">" component=&#123;Home&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;PrivateRoute exact path="</span>/manage<span class="string">" component=&#123;Manage&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;Route exact path="</span>/login<span class="string">" component=&#123;Sign&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;Route exact path="</span>/register<span class="string">" component=&#123;Register&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;PrivateRoute exact path="</span>/douban<span class="string">" component=&#123;Douban&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;PrivateRoute exact path="</span>/taobao<span class="string">" component=&#123;Taobao&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;PrivateRoute exact path="</span>/maoyan<span class="string">" component=&#123;Maoyan&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;PrivateRoute exact path="</span>/operas<span class="string">" component=&#123;Operas&#125; /&gt;</span></span><br><span class="line"><span class="string">          &lt;/Switch&gt;</span></span><br><span class="line"><span class="string">        &lt;/Suspense&gt;</span></span><br><span class="line"><span class="string">      &lt;/Router&gt;</span></span><br><span class="line"><span class="string">    );</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">export default App;</span></span><br></pre></td></tr></table></figure>
<p><strong>è¿™é‡Œéœ€è¦è®²å‡ ä¸ªé—®é¢˜ï¼š</strong></p>
<h4 id="lazy-Suspense-çš„ä½œç”¨"><a href="#lazy-Suspense-çš„ä½œç”¨" class="headerlink" title="lazy+Suspense çš„ä½œç”¨"></a>lazy+Suspense çš„ä½œç”¨</h4><p>åœ¨<a href="https://react.docschina.org/docs/code-splitting.html" target="_blank" rel="noopener">reactå®˜æ–¹æ–‡æ¡£</a>ä¸­æˆ‘æˆªå–äº†ä¸€æ®µ</p>
<p><code>React.lazy</code> å‡½æ•°èƒ½è®©ä½ åƒæ¸²æŸ“å¸¸è§„ç»„ä»¶ä¸€æ ·å¤„ç†åŠ¨æ€å¼•å…¥ï¼ˆçš„ç»„ä»¶ï¼‰ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> OtherComponent = React.lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./OtherComponent'</span>));</span><br></pre></td></tr></table></figure>
<p>æ­¤ä»£ç å°†ä¼šåœ¨ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶ï¼Œè‡ªåŠ¨å¯¼å…¥åŒ…å« <code>OtherComponent</code> ç»„ä»¶çš„åŒ…ã€‚</p>
<p><code>React.lazy</code> æ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°éœ€è¦åŠ¨æ€è°ƒç”¨ <code>import()</code>ã€‚å®ƒå¿…é¡»è¿”å›ä¸€ä¸ª <code>Promise</code>ï¼Œè¯¥ Promise éœ€è¦ resolve ä¸€ä¸ª <code>default</code> export çš„ React ç»„ä»¶ã€‚</p>
<p>ç„¶ååº”åœ¨ <code>Suspense</code> ç»„ä»¶ä¸­æ¸²æŸ“ lazy ç»„ä»¶ï¼Œå¦‚æ­¤ä½¿å¾—æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åœ¨ç­‰å¾…åŠ è½½ lazy ç»„ä»¶æ—¶åšä¼˜é›…é™çº§ï¼ˆå¦‚ loading æŒ‡ç¤ºå™¨ç­‰ï¼‰ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Suspense &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> OtherComponent = React.lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./OtherComponent'</span>));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Suspense fallback=&#123;&lt;div&gt;Loading...&lt;<span class="regexp">/div&gt;&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;OtherComponent /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/Suspense&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>fallback</code> å±æ€§æ¥å—ä»»ä½•åœ¨ç»„ä»¶åŠ è½½è¿‡ç¨‹ä¸­ä½ æƒ³å±•ç¤ºçš„ React å…ƒç´ ã€‚ä½ å¯ä»¥å°† <code>Suspense</code> ç»„ä»¶ç½®äºæ‡’åŠ è½½ç»„ä»¶ä¹‹ä¸Šçš„ä»»ä½•ä½ç½®ã€‚ä½ ç”šè‡³å¯ä»¥ç”¨ä¸€ä¸ª <code>Suspense</code> ç»„ä»¶åŒ…è£¹å¤šä¸ªæ‡’åŠ è½½ç»„ä»¶ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Suspense &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> OtherComponent = React.lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./OtherComponent'</span>));</span><br><span class="line"><span class="keyword">const</span> AnotherComponent = React.lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./AnotherComponent'</span>));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Suspense fallback=&#123;&lt;div&gt;Loading...&lt;<span class="regexp">/div&gt;&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;section&gt;</span></span><br><span class="line"><span class="regexp">          &lt;OtherComponent /</span>&gt;</span><br><span class="line">          &lt;AnotherComponent /&gt;</span><br><span class="line">        &lt;<span class="regexp">/section&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Suspense&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="Switch-exact"><a href="#Switch-exact" class="headerlink" title="Switch,exact"></a><code>Switch,exact</code></h4><p>åœ¨<a href="https://jasonxqh.github.io/2020/06/02/reactåŸºç¡€2/#Switch">reactåŸºç¡€2ä¸­çš„Switch</a>æœ‰è¯¦ç»†æåŠ</p>
<h4 id="PrivateRouteå®ç°é€»è¾‘"><a href="#PrivateRouteå®ç°é€»è¾‘" class="headerlink" title="PrivateRouteå®ç°é€»è¾‘"></a><code>PrivateRoute</code>å®ç°é€»è¾‘</h4><p>åœ¨<a href="https://jasonxqh.github.io/2020/06/05/reactåŸºç¡€4æˆæƒä¸éƒ¨ç½²/#Protecting-Routes">reactåŸºç¡€4æˆæƒä¸éƒ¨ç½²çš„Protecting Routes</a>ä¸­æœ‰è¯¦ç»†æåŠ</p>
<h3 id="ç™»å½•é¡µé¢ä¸æ³¨å†Œé¡µé¢"><a href="#ç™»å½•é¡µé¢ä¸æ³¨å†Œé¡µé¢" class="headerlink" title="ç™»å½•é¡µé¢ä¸æ³¨å†Œé¡µé¢"></a>ç™»å½•é¡µé¢ä¸æ³¨å†Œé¡µé¢</h3><p>ç™»é™†é¡µé¢å’Œæ³¨å†Œé¡µé¢çš„<strong>å®ç°é€»è¾‘</strong>åœ¨<a href="https://jasonxqh.github.io/2020/06/05/reactåŸºç¡€4æˆæƒä¸éƒ¨ç½²/">reactåŸºç¡€4æˆæƒä¸éƒ¨ç½²</a> ä¸­çš„èŠ±äº†<strong>å¤§ç¯‡å¹…</strong>è¯´æ˜å’Œå®ç°(ä»<a href="https://jasonxqh.github.io/2020/06/05/reactåŸºç¡€4æˆæƒä¸éƒ¨ç½²/#Registering-a-New-User">1.1.2. Registering a New User</a> å¼€å§‹)ã€‚ </p>
<p><strong>ä¸è¿‡è¿˜è¦æ’ä¸€å˜´</strong>: åœ¨åšå®¢ä¸­æˆ‘ä»¬æ²¡æœ‰å€ŸåŠ©å¤–éƒ¨çš„åº“æ¥å®ç°æäº¤è¡¨å•ï¼Œä½†è¿™é‡Œæˆ‘ä½¿ç”¨äº†antdä¸­è¡¨å•ã€‚å…·ä½“å­¦ä¹ åšå®¢å¯ä»¥å‚ç…§</p>
<p><a href="https://www.jianshu.com/p/f8d3a8bcaf84" target="_blank" rel="noopener">antdä¸­è¡¨å•æäº¤çš„åŸºæœ¬ä½¿ç”¨</a></p>
<p>æºç ä¸­ç”¨åˆ°çš„å‡ ä¸ªé‡è¦çš„apiå¦‚ä¸‹</p>
<h4 id="Form-create"><a href="#Form-create" class="headerlink" title="Form.create"></a><code>Form.create</code></h4><p>ä½¿ç”¨<code>Form.create({options})(Forgot)</code>åŒ…è£…ç»„ä»¶ï¼ŒåŒ…è£…ä¹‹åçš„ç»„ä»¶ä¼šè‡ªåŠ¨æ·»åŠ <code>this.props.form</code> å±æ€§ï¼Œè¯¥å±æ€§åŒ…å«ä»¥ä¸‹APIï¼š</p>
<ul>
<li><code>getFieldDecorator</code> ï¼šç”¨äºå’Œè¡¨å•æ•°æ®è¿›è¡ŒåŒå‘ç»‘å®šï¼Œè®¾ç½®è¯¥è¡¨å•ç±»å‹ä¸ºemailï¼Œåœ¨<code>rules</code>ä¸­è®¾ç½®æ ¡éªŒè§„åˆ™å’Œæç¤ºä¿¡æ¯ã€‚</li>
<li><code>validateFields</code>ï¼šè·å–è¾“å…¥åŸŸçš„æ•°æ®å’Œerrorï¼Œç”¨äºåœ¨æäº¤å‰çš„åˆ¤æ–­ã€‚å¦‚æœ<code>!err</code>æ‰å¯ä»¥æäº¤ã€‚æ•°æ®valueså°±æ˜¯<code>{email: a@qq.com}</code>è¿™æ ·çš„æ ¼å¼ã€‚ä¼ é€’ç»™<code>handleConfirm</code>å‡½æ•°è¿›è¡Œæäº¤è¯·æ±‚æ“ä½œã€‚</li>
</ul>
<h4 id="login-jsx"><a href="#login-jsx" class="headerlink" title="login.jsx"></a><code>login.jsx</code></h4><p> ä¸ºäº†è®²è§£æ–¹ä¾¿ï¼Œæˆ‘ä»¬æŠŠæºä»£ç æ‹†æˆå‡ ä¸ªéƒ¨åˆ† </p>
<p><code>handleSubmit</code>éƒ¨åˆ†</p>
<p>é¦–å…ˆ<code>e.preventDefault()</code>æ˜¯é˜»æ­¢é¡µé¢åœ¨æäº¤è¡¨å•çš„æ—¶å€™é‡æ–°æ¸²æŸ“</p>
<p>ç„¶ååˆ©ç”¨antdä¸­çš„apiï¼Œ<code>form.validateFields</code>æ¥è¿›è¡ŒéªŒè¯ï¼Œå¦‚æœæ²¡æœ‰é”™çš„è¯ï¼Œå°±å‘é€ä¸€ä¸ªdispatchä¸€ä¸ª <strong>action</strong>ç»™storeï¼Œstoreå†é€šè¿‡è°ƒç”¨reducerï¼ŒreduceræŠŠæˆ‘ä»¬ä¼ å…¥çš„ç™»å½•ä¿¡æ¯æ¸²æŸ“åˆ°stateå½“ä¸­ ç„¶åè¿”å›ï¼Œè¿™æ ·å†loginä¸­å°±æœ‰æœ¬åœ°çš„stateä¿¡æ¯äº†ã€‚ï¼ˆæ•²é»‘æ¿çš„é‡ç‚¹ï¼ï¼‰</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Redirect &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; userLogin &#125; <span class="keyword">from</span> <span class="string">'../../store/login/actions'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Form, Icon, Input, Button &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/layout'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.scss'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidMount() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  handleSubmit = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    <span class="keyword">this</span>.props.form.validateFields(<span class="function">(<span class="params">err, values</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">        <span class="keyword">this</span>.props.getUserLogin(values);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<p><code>render</code>éƒ¨åˆ†</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; getFieldDecorator &#125; = <span class="keyword">this</span>.props.form;</span><br><span class="line">    <span class="keyword">const</span> &#123; userData &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> &#123; isLogin &#125; = userData;</span><br><span class="line">    <span class="keyword">if</span> (isLogin) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">"/"</span> /&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> formItemLayout = &#123;</span><br><span class="line">      labelCol: &#123;</span><br><span class="line">        xs: &#123; <span class="attr">span</span>: <span class="number">24</span> &#125;,</span><br><span class="line">        sm: &#123; <span class="attr">span</span>: <span class="number">8</span> &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      wrapperCol: &#123;</span><br><span class="line">        xs: &#123; <span class="attr">span</span>: <span class="number">24</span> &#125;,</span><br><span class="line">        sm: &#123; <span class="attr">span</span>: <span class="number">16</span> &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> tailFormItemLayout = &#123;</span><br><span class="line">      wrapperCol: &#123;</span><br><span class="line">        xs: &#123;</span><br><span class="line">          span: <span class="number">24</span>,</span><br><span class="line">          offset: <span class="number">0</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        sm: &#123;</span><br><span class="line">          span: <span class="number">22</span>,</span><br><span class="line">          offset: <span class="number">2</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Layout&gt;</span><br><span class="line">        &lt;Form &#123;...formItemLayout&#125; onSubmit=&#123;<span class="keyword">this</span>.handleSubmit&#125; className=<span class="string">"login-form"</span>&gt;</span><br><span class="line">          &lt;Form.Item label=<span class="string">"ç”¨æˆ·å"</span> className=<span class="string">"item"</span>&gt;</span><br><span class="line">            &#123;getFieldDecorator(<span class="string">'name'</span>, &#123;</span><br><span class="line">              rules: [&#123; <span class="attr">required</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">            &#125;)(</span><br><span class="line">              &lt;Input</span><br><span class="line">                size=<span class="string">"large"</span></span><br><span class="line">                prefix=&#123;&lt;Icon type=<span class="string">"user"</span> style=&#123;&#123; <span class="attr">color</span>: <span class="string">'rgba(0,0,0,.25)'</span> &#125;&#125; /&gt;&#125;</span><br><span class="line">                placeholder=<span class="string">"è¯·è¾“å…¥ç”¨æˆ·å"</span></span><br><span class="line">              /&gt;,</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="å¯†ç " className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &#123;getFieldDecorator('password', &#123;</span></span><br><span class="line"><span class="regexp">              rules: [&#123; required: true &#125;],</span></span><br><span class="line"><span class="regexp">            &#125;)(</span></span><br><span class="line"><span class="regexp">              &lt;Input</span></span><br><span class="line"><span class="regexp">                size="large"</span></span><br><span class="line"><span class="regexp">                prefix=&#123;&lt;Icon type="lock" style=&#123;&#123; color: 'rgba(0,0,0,.25)' &#125;&#125; /</span>&gt;&#125;</span><br><span class="line">                type=<span class="string">"password"</span></span><br><span class="line">                placeholder=<span class="string">"è¯·è¾“å…¥å¯†ç "</span></span><br><span class="line">              /&gt;,</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item &#123;...tailFormItemLayout&#125; className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Button size="large" type="primary" htmlType="submit" className="login-form-button"&gt;</span></span><br><span class="line"><span class="regexp">              ç™»å½•</span></span><br><span class="line"><span class="regexp">            &lt;/</span>Button&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Form&gt;</span><br><span class="line">      &lt;<span class="regexp">/Layout&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const mapStateToProps = (state) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  return &#123;</span></span><br><span class="line"><span class="regexp">    userData: state.userData.data,</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">const mapDispatchToProps = (dispatch) =&gt; (&#123;</span></span><br><span class="line"><span class="regexp">  getUserLogin: (params) =&gt; dispatch(userLogin(params)),</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const wrappedLoginForm = Form.create(&#123; name: 'login' &#125;)(LoginForm);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default connect(</span></span><br><span class="line"><span class="regexp">  mapStateToProps,</span></span><br><span class="line"><span class="regexp">  mapDispatchToProps,</span></span><br><span class="line"><span class="regexp">)(wrappedLoginForm);</span></span><br></pre></td></tr></table></figure>
<h4 id="register-jsx"><a href="#register-jsx" class="headerlink" title="register.jsx"></a><code>register.jsx</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Redirect &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createHashHistory &#125; <span class="keyword">from</span> <span class="string">'history'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Form, Icon, Input, Button, message &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/layout'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.scss'</span>;</span><br><span class="line"><span class="keyword">import</span> Api <span class="keyword">from</span> <span class="string">'../../js/Api'</span>;</span><br><span class="line"><span class="keyword">const</span> history = createHashHistory(&#123; <span class="attr">forceRefresh</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidMount() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  handleSubmit = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    <span class="keyword">this</span>.props.form.validateFields(<span class="function">(<span class="params">err, values</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">        Api.post(<span class="string">'/users/register'</span>, values)</span><br><span class="line">          .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (res.data) &#123;</span><br><span class="line">              message.success(<span class="string">'register success'</span>);</span><br><span class="line">              history.push(<span class="string">'/login'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err);</span><br><span class="line">            message.error(err.message);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<p><code>render</code>éƒ¨åˆ†ï¼š</p>
<p>è¡¨å•æ¸²æŸ“åœ¨ä¸Šé¢ä¹Ÿè¯´äº†ï¼Œè¿™é‡Œå°±ä¸å†ç»†è®²äº†</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; getFieldDecorator &#125; = <span class="keyword">this</span>.props.form;</span><br><span class="line">    <span class="keyword">const</span> &#123; userData &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> &#123; isLogin &#125; = userData;</span><br><span class="line">    <span class="keyword">if</span> (isLogin) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">"/"</span> /&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> formItemLayout = &#123;</span><br><span class="line">      labelCol: &#123;</span><br><span class="line">        xs: &#123; <span class="attr">span</span>: <span class="number">24</span> &#125;,</span><br><span class="line">        sm: &#123; <span class="attr">span</span>: <span class="number">8</span> &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      wrapperCol: &#123;</span><br><span class="line">        xs: &#123; <span class="attr">span</span>: <span class="number">24</span> &#125;,</span><br><span class="line">        sm: &#123; <span class="attr">span</span>: <span class="number">16</span> &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> tailFormItemLayout = &#123;</span><br><span class="line">      wrapperCol: &#123;</span><br><span class="line">        xs: &#123;</span><br><span class="line">          span: <span class="number">24</span>,</span><br><span class="line">          offset: <span class="number">0</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        sm: &#123;</span><br><span class="line">          span: <span class="number">22</span>,</span><br><span class="line">          offset: <span class="number">2</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Layout&gt;</span><br><span class="line">        &lt;Form &#123;...formItemLayout&#125; onSubmit=&#123;<span class="keyword">this</span>.handleSubmit&#125; className=<span class="string">"login-form"</span>&gt;</span><br><span class="line">          &lt;Form.Item label=<span class="string">"ç”¨æˆ·å"</span> className=<span class="string">"item"</span>&gt;</span><br><span class="line">            &#123;getFieldDecorator(<span class="string">'name'</span>, &#123;</span><br><span class="line">              rules: [&#123; <span class="attr">required</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">            &#125;)(</span><br><span class="line">              &lt;Input</span><br><span class="line">                size=<span class="string">"large"</span></span><br><span class="line">                prefix=&#123;&lt;Icon type=<span class="string">"user"</span> style=&#123;&#123; <span class="attr">color</span>: <span class="string">'rgba(0,0,0,.25)'</span> &#125;&#125; /&gt;&#125;</span><br><span class="line">                placeholder=<span class="string">"è¯·è¾“å…¥ç”¨æˆ·å"</span></span><br><span class="line">              /&gt;,</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="å¯†ç " className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &#123;getFieldDecorator('password', &#123;</span></span><br><span class="line"><span class="regexp">              rules: [&#123; required: true &#125;],</span></span><br><span class="line"><span class="regexp">            &#125;)(</span></span><br><span class="line"><span class="regexp">              &lt;Input</span></span><br><span class="line"><span class="regexp">                size="large"</span></span><br><span class="line"><span class="regexp">                prefix=&#123;&lt;Icon type="lock" style=&#123;&#123; color: 'rgba(0,0,0,.25)' &#125;&#125; /</span>&gt;&#125;</span><br><span class="line">                type=<span class="string">"password"</span></span><br><span class="line">                placeholder=<span class="string">"è¯·è¾“å…¥å¯†ç "</span></span><br><span class="line">              /&gt;,</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item &#123;...tailFormItemLayout&#125; className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Button size="large" type="primary" htmlType="submit" className="login-form-button"&gt;</span></span><br><span class="line"><span class="regexp">              æ³¨å†Œ</span></span><br><span class="line"><span class="regexp">            &lt;/</span>Button&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Form&gt;</span><br><span class="line">      &lt;<span class="regexp">/Layout&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const mapStateToProps = (state) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  return &#123;</span></span><br><span class="line"><span class="regexp">    userData: state.userData.data,</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const wrappedLoginForm = Form.create(&#123; name: 'login' &#125;)(LoginForm);</span></span><br><span class="line"><span class="regexp">export default connect(mapStateToProps, null)(wrappedLoginForm);</span></span><br></pre></td></tr></table></figure>
<h3 id="ç®¡ç†å‘˜çš„ç”¨æˆ·ç®¡ç†ç•Œé¢"><a href="#ç®¡ç†å‘˜çš„ç”¨æˆ·ç®¡ç†ç•Œé¢" class="headerlink" title="ç®¡ç†å‘˜çš„ç”¨æˆ·ç®¡ç†ç•Œé¢"></a>ç®¡ç†å‘˜çš„ç”¨æˆ·ç®¡ç†ç•Œé¢</h3><p>ç®¡ç†å‘˜ç•Œé¢å’Œæ™®é€šç”¨æˆ·ç•Œé¢çš„åŒºåˆ«å°±åœ¨äºç®¡ç†å‘˜å¤šäº†ä¸€ä¸ªç”¨æˆ·ç®¡ç†é¡µé¢å¯ä»¥åˆ é™¤åˆ«çš„ç”¨æˆ·çš„ä¿¡æ¯ã€‚è¿™é‡Œæˆ‘é€šè¿‡ä¸¤ä¸ª<code>jsx</code>æ–‡ä»¶å®ç°ï¼Œåœ¨ä¸»æ–‡ä»¶ä¸­å­˜æ”¾<code>UserManage</code>ç»„ä»¶ï¼Œè¿™æ ·çš„å†™æ³•è®©ä»£ç çš„å±‚æ¬¡æ›´åŠ åˆ†æ˜ç®€æ´</p>
<p><code>index.jsx</code>,å…³äºæ–‡ä»¶ä¸­Tabsçš„ä½¿ç”¨æ–¹æ³•ï¼Œå‚è€ƒ<a href="https://ant-design.gitee.io/components/tabs-cn/" target="_blank" rel="noopener">antdçš„å®˜æ–¹æ–‡æ¡£</a></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line">render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Layout&gt;</span><br><span class="line">        &lt;Tabs defaultActiveKey=<span class="string">"1"</span>&gt;</span><br><span class="line">          &lt;TabPane tab=<span class="string">"user management"</span> key=<span class="string">"1"</span>&gt;</span><br><span class="line">            &lt;UsersManage key=<span class="string">"user"</span> /&gt;</span><br><span class="line">          &lt;<span class="regexp">/TabPane&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Tabs&gt;</span><br><span class="line">      &lt;<span class="regexp">/Layout&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/...</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/5.png" style="zoom: 67%;"></p>
<h4 id="user-js"><a href="#user-js" class="headerlink" title="user.js"></a><code>user.js</code></h4><p>ä¸ºäº†è®²è§£æ–¹ä¾¿æˆ‘ä»¬æŠŠæºç æ‹†åˆ†æˆå‡ ä¸ªéƒ¨åˆ†</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Table, Icon, Tooltip, message, Modal &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> Util <span class="keyword">from</span> <span class="string">'../../js/Util'</span>;</span><br><span class="line"><span class="keyword">import</span> Api <span class="keyword">from</span> <span class="string">'../../js/Api'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.scss'</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; confirm &#125; = Modal;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UsersManage</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      userListData: [],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.getUserList();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="getUserListå®ç°é€»è¾‘"><a href="#getUserListå®ç°é€»è¾‘" class="headerlink" title="getUserListå®ç°é€»è¾‘:"></a><code>getUserList</code>å®ç°é€»è¾‘:</h4><p>é¦–å…ˆä»è·å–token ï¼Œå…³äºtokenæ˜¯ä»€ä¹ˆï¼Œåœ¨æˆ‘çš„åšå®¢<a href="https://jasonxqh.github.io/2020/06/05/reactåŸºç¡€4æˆæƒä¸éƒ¨ç½²/#Storing-the-JWT-JSON-Token">reactåŸºç¡€4æˆæƒä¸éƒ¨ç½²çš„è¿™ä¸ªç« èŠ‚Storing the JWT(JSON Token)</a>ä»¥åŠåæ¥çš„ç« èŠ‚å·²ç»è¯´çš„å¾ˆæ¸…æ¥šäº†ï¼Œåœ¨æ­¤ä¸èµ˜è¿°ã€‚</p>
<p>ç„¶åé€šè¿‡Api.getæ–¹æ³•å¯å‚ç…§ <a href="http://www.axios-js.com/zh-cn/docs/#axios-get-url-config-1" target="_blank" rel="noopener">axioså®˜æ–¹æ–‡æ¡£</a> ã€‚åªæœ‰ <code>url</code> æ˜¯å¿…éœ€çš„ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®š <code>method</code>ï¼Œè¯·æ±‚å°†é»˜è®¤ä½¿ç”¨ <code>get</code> æ–¹æ³•ã€‚ <code>config</code> æ˜¯ä¸ºè¯·æ±‚æä¾›çš„é…ç½®ä¿¡æ¯</p>
<p>åœ¨<a href="https://jasonxqh.github.io/2020/06/05/reactåŸºç¡€4æˆæƒä¸éƒ¨ç½²/">reactåŸºç¡€4æˆæƒä¸éƒ¨ç½²</a>ä¸­æˆ‘ä»¬åœ¨å¤´éƒ¨ä¼ å…¥ä¸€ä¸ªtokençš„æ–¹æ³•æ˜¯åœ¨åç«¯è¿›è¡Œä¿®æ”¹ï¼Œç„¶ååœ¨å¤´éƒ¨ä¸­è·å¾—tokenç„¶åå­˜å‚¨åˆ°æœ¬åœ°çš„ã€‚</p>
<p>è¿™é‡Œæˆ‘ç›´æ¥åˆ©ç”¨äº†axios.get,åœ¨è¯·æ±‚å¤´ä¸­åŠ å…¥tokenï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨ headers: { Authorization: <code>Bearer ${token}</code> },åªæœ‰å½“åç«¯éªŒè¯äº†è¿™ä¸ªtokenï¼Œä»–æ‰è‚¯æŠŠä¿¡æ¯ä¼ è¿‡æ¥å˜›ï¼Œæ˜¯ä¸æ˜¯ï¼Ÿ</p>
<p>ç„¶åæŠŠresponseçš„å†…å®¹ï¼Œåˆ©ç”¨<code>setState</code>æ–¹æ³•æ›´æ–°æœ¬åœ°stateï¼Œä¹Ÿå°±æ˜¯ç°åœ¨ï¼Œç®¡ç†å‘˜å°±å¯ä»¥è·å¾—è¿™ä¸ªåº”ç”¨ä¸­ç”¨æˆ·çš„è¡¨å•äº†</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">getUserList() &#123;</span><br><span class="line">  <span class="keyword">const</span> token = Util.getToken();</span><br><span class="line">  Api.get(<span class="string">'/users/list'</span>, &#123;</span><br><span class="line">    headers: &#123; <span class="attr">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span> &#125;,</span><br><span class="line">  &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (res.data) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        userListData: res.data.data,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="åˆ é™¤æ“ä½œ"><a href="#åˆ é™¤æ“ä½œ" class="headerlink" title="åˆ é™¤æ“ä½œ"></a>åˆ é™¤æ“ä½œ</h4><p>ç®¡ç†å‘˜åˆ©ç”¨åˆ é™¤æ“ä½œå¯ä»¥åˆ é™¤ç”¨æˆ·ä¿¡æ¯ã€‚</p>
<p>è¿™é‡Œæˆ‘ç”¨äº†<a href="https://ant-design.gitee.io/components/modal-cn/" target="_blank" rel="noopener">antdåº“ä¸­çš„Modalå¯¹è¯æ¡†</a>ä¸­çš„ç¡®è®¤å¯¹è¯æ¡†ï¼š<code>Modal.confirm</code></p>
<p>è¿™é‡Œæˆ‘æˆªå–äº†ä¸€æ®µåŸæ–‡æ¡£</p>
<p><strong>ä½•æ—¶ä½¿ç”¨ï¼Ÿ</strong></p>
<p>éœ€è¦ç”¨æˆ·å¤„ç†äº‹åŠ¡ï¼Œåˆä¸å¸Œæœ›è·³è½¬é¡µé¢ä»¥è‡´æ‰“æ–­å·¥ä½œæµç¨‹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>Modal</code> åœ¨å½“å‰é¡µé¢æ­£ä¸­æ‰“å¼€ä¸€ä¸ªæµ®å±‚ï¼Œæ‰¿è½½ç›¸åº”çš„æ“ä½œã€‚</p>
<p>å¦å¤–å½“éœ€è¦ä¸€ä¸ªç®€æ´çš„ç¡®è®¤æ¡†è¯¢é—®ç”¨æˆ·æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>Modal.confirm()</code> ç­‰è¯­æ³•ç³–æ–¹æ³•ã€‚</p>
<p>ä½¿ç”¨ <code>confirm()</code> å¯ä»¥å¿«æ·åœ°å¼¹å‡ºç¡®è®¤æ¡†ã€‚<code>onCancel/onOk</code> è¿”å› promise å¯ä»¥å»¶è¿Ÿå…³é—­ã€‚</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/7.png" style="zoom: 67%;"></p>
<p>é€šè¿‡è§‚å¯Ÿconfirmå¯¹è¯æ¡†ï¼Œå’Œå¯¹åº”çš„ä»£ç ã€‚æˆ‘ä»¬å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°<code>title</code>ï¼Œ<code>content</code>ï¼Œ<code>okText</code>,<code>okType</code>,<code>cancelText</code>åˆ†åˆ«å¯¹åº”äº†ä»€ä¹ˆã€‚æˆ‘å°±ä¸ç»†è¯´äº†ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å¦‚æœç‚¹å‡»cancelï¼Œé‚£ä¹ˆç›¸å®‰æ— äº‹ã€‚å¦‚æœç‚¹å‡»<code>onOk</code>ï¼Œä¹Ÿå°±æ˜¯confirmçš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šæœ‰è¿™æ ·çš„æ“ä½œï¼š</p>
<p>é¦–å…ˆè·å–åˆ°æˆ‘è¿™é‡Œç®¡ç†å‘˜çš„token</p>
<p>å…¶æ¬¡è·å¾—ä¸€ä¸ªurlï¼Œé€šè¿‡è¿™ä¸ªurlå¯ä»¥é‡ç½®è¿™ä¸ªäººçš„ä¿¡æ¯ï¼ŒæŠŠä»–æ‰€æœ‰çš„ä¿¡æ¯æŠ¹å»ã€‚</p>
<p>åˆ©ç”¨<code>Api.post()</code>ä¼ å…¥tokenï¼Œæ›´æ–°data,å®Œæˆäº†åˆ é™¤ç”¨æˆ·çš„åŠŸèƒ½</p>
<p>ç„¶ååˆ¤æ–­è¿”å›çš„ç»“æœã€‚è¿™é‡Œæ¶‰åŠåˆ°åç«¯</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">delete</span>(req, res) &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> User.findByIdAndRemove(req.params.id);</span><br><span class="line">  res.status(<span class="number">201</span>).json(&#123; <span class="attr">data</span>: result &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦‚æœåˆ é™¤æˆåŠŸï¼Œé‚£ä¹ˆå°±ä¼šè¿”å›201ï¼Œé™„å¸¦ä¸€ä¸ª<code>json</code>å¯¹è±¡ï¼Œæˆ‘ä»¬å‰ç«¯é€šè¿‡åˆ¤æ–­æœ‰æ²¡æœ‰è¿™ä¸ªå¯¹è±¡æ¥åˆ¤æ–­æ˜¯å¦åˆ é™¤æˆåŠŸ</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ é™¤</span></span><br><span class="line">deleteUser = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> _this = <span class="keyword">this</span>;</span><br><span class="line">  confirm(&#123;</span><br><span class="line">    title: <span class="string">'Are you sure delete?'</span>,</span><br><span class="line">    content: <span class="string">'Hope you know what you are doingï¼'</span>,</span><br><span class="line">    okText: <span class="string">'confirm'</span>,</span><br><span class="line">    okType: <span class="string">'danger'</span>,</span><br><span class="line">    cancelText: <span class="string">'cancel'</span>,</span><br><span class="line">    onOk() &#123;</span><br><span class="line">      <span class="keyword">const</span> token = Util.getToken();</span><br><span class="line">      <span class="keyword">const</span> postUrl = <span class="string">`/users/<span class="subst">$&#123;item._id&#125;</span>/delete`</span>;</span><br><span class="line">      Api.post(</span><br><span class="line">        postUrl,</span><br><span class="line">        &#123;&#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          headers: &#123; <span class="attr">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span> &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      )</span><br><span class="line">        .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(res);</span><br><span class="line">          <span class="keyword">if</span> (res.data) &#123;</span><br><span class="line">            message.success(<span class="string">'delete success'</span>);</span><br><span class="line">            _this.getUserList();</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            message.error(<span class="string">'fail'</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    onCancel() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Cancel'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="renderæ¸²æŸ“å™¨éƒ¨åˆ†"><a href="#renderæ¸²æŸ“å™¨éƒ¨åˆ†" class="headerlink" title="renderæ¸²æŸ“å™¨éƒ¨åˆ†"></a>renderæ¸²æŸ“å™¨éƒ¨åˆ†</h4><p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/8.png" style="zoom: 67%;"></p>
<p>ææ‡‚äº†å‰é¢çš„å‡½æ•°é€»è¾‘ï¼Œæ¸²æŸ“å™¨éƒ¨åˆ†å°±å¾ˆç®€å•äº†ã€‚é¦–å…ˆæ¸²æŸ“åˆä¸€å¼ è¡¨æ ¼æ¥ï¼Œåˆ©ç”¨<a href="https://ant-design.gitee.io/components/table-cn/" target="_blank" rel="noopener">antdä¸­çš„Tableå³å¯</a></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>bordered</th>
<th>æ˜¯å¦å±•ç¤ºå¤–è¾¹æ¡†å’Œåˆ—è¾¹æ¡†</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>dataSource</code></td>
<td>æ•°æ®æ•°ç»„</td>
</tr>
<tr>
<td><code>rowKey</code></td>
<td>è¡¨æ ¼è¡Œ key çš„å–å€¼ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–ä¸€ä¸ªå‡½æ•°</td>
</tr>
<tr>
<td><code>columns</code></td>
<td>åˆ—æè¿°æ•°æ®å¯¹è±¡ï¼Œæ˜¯ columns ä¸­çš„ä¸€é¡¹ï¼ŒColumn ä½¿ç”¨ç›¸åŒçš„ <code>API</code>ã€‚</td>
</tr>
</tbody>
</table>
</div>
<p>æ³¨æ„æœ€åä¸€åˆ—ï¼Œæ˜¯ä¸€ä¸ªæ¡ä»¶æ¸²æŸ“ã€‚å¦‚æœ<code>item.name</code> æ˜¯<code>admin</code>çš„è¯ï¼Œæ¸²æŸ“-- (å› ä¸º<code>admin</code>ä¸ä¼šè‡ªå·±åˆ é™¤è‡ªå·±) å¦åˆ™å°±æ¸²æŸ“ä¸€ä¸ªåˆ é™¤iconï¼Œä¹Ÿæ˜¯<code>antd</code>ä¸­å¼•ç”¨è¿‡æ¥çš„ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; userListData &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Table</span><br><span class="line">          bordered</span><br><span class="line">          dataSource=&#123;userListData&#125;</span><br><span class="line">          rowKey=&#123;(row) =&gt; row._id&#125;</span><br><span class="line">          columns=&#123;[</span><br><span class="line">            &#123;</span><br><span class="line">              title: <span class="string">'id'</span>,</span><br><span class="line">              dataIndex: <span class="string">'_id'</span>,</span><br><span class="line">              key: <span class="string">'_id'</span>,</span><br><span class="line">              align: <span class="string">'center'</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              title: <span class="string">'name'</span>,</span><br><span class="line">              dataIndex: <span class="string">'name'</span>,</span><br><span class="line">              key: <span class="string">'name'</span>,</span><br><span class="line">              align: <span class="string">'center'</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              title: <span class="string">'auth'</span>,</span><br><span class="line">              dataIndex: <span class="string">'auth'</span>,</span><br><span class="line">              key: <span class="string">'auth'</span>,</span><br><span class="line">              align: <span class="string">'center'</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              title: <span class="string">'handle'</span>,</span><br><span class="line">              key: <span class="string">'handle'</span>,</span><br><span class="line">              align: <span class="string">'center'</span>,</span><br><span class="line">              render: <span class="function">(<span class="params">row, item</span>) =&gt;</span> (</span><br><span class="line">                &lt;div className=<span class="string">"person-table-btn"</span>&gt;</span><br><span class="line">                  &#123;item.name !== <span class="string">'admin'</span> ? (</span><br><span class="line">                    &lt;Tooltip placement=<span class="string">"top"</span> title=&#123;<span class="string">'delete'</span>&#125;&gt;</span><br><span class="line">                      &lt;Icon</span><br><span class="line">                        type=<span class="string">"delete"</span></span><br><span class="line">                        theme=<span class="string">"twoTone"</span></span><br><span class="line">                        twoToneColor=<span class="string">"#eb2f96"</span></span><br><span class="line">                        className=<span class="string">"table-btn-item"</span></span><br><span class="line">                        onClick=&#123;() =&gt; <span class="keyword">this</span>.deleteUser(item)&#125;</span><br><span class="line">                      /&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Tooltip&gt;</span></span><br><span class="line"><span class="regexp">                  ) : (</span></span><br><span class="line"><span class="regexp">                    '--'</span></span><br><span class="line"><span class="regexp">                  )&#125;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>div&gt;</span><br><span class="line">              ),</span><br><span class="line">            &#125;,</span><br><span class="line">          ]&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default UsersManage;</span></span><br></pre></td></tr></table></figure>
<h3 id="ä»¥è±†ç“£ä¸ºä¾‹çš„å±•ç¤ºé¡µé¢"><a href="#ä»¥è±†ç“£ä¸ºä¾‹çš„å±•ç¤ºé¡µé¢" class="headerlink" title="ä»¥è±†ç“£ä¸ºä¾‹çš„å±•ç¤ºé¡µé¢"></a>ä»¥è±†ç“£ä¸ºä¾‹çš„å±•ç¤ºé¡µé¢</h3><p>å› ä¸º4å¼ è¡¨æ ¼åªé€‰æ‹©è¿™ä¸€å¼ ä½œä¸ºæˆ‘çš„ä¾‹å­ï¼Œæ‰€ä»¥æˆ‘æ‰“ç®—è¯¦ç»†è®²ä¸€ä¸‹å†…éƒ¨é€»è¾‘.ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘æŠŠæºç æ‹†åˆ†æˆå‡ ä¸ªéƒ¨åˆ†åˆ†åˆ«è®²è§£ã€‚</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/6.png" style="zoom: 67%;"></p>
<p>éœ€è¦äº†è§£<a href="http://www.axios-js.com/zh-cn/docs/#axios-get-url-config-1" target="_blank" rel="noopener">axioså®˜æ–¹æ–‡æ¡£</a>ä¸­<code>axios.get</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="comment">//é¦–å…ˆä»antdä¸­å¯¼å…¥ä¸€äº›æ ·å¼ï¼Œè¡¨æ ¼ï¼Œè¾“å…¥æ¡†ï¼Œåˆ†é¡µå™¨ï¼Œè¡¨å•ï¼ŒæŒ‰é’®ç­‰ç­‰</span></span><br><span class="line"><span class="keyword">import</span> &#123; Table, Input, Button, Select, Pagination, Form, message &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/layout'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.scss'</span>;</span><br><span class="line"><span class="comment">//å¯¼å…¥Apiå’ŒUtil Apiæ˜¯åç«¯æ¥å‡ºæ¥çš„ï¼Œæˆ‘ä»¬å‰ç«¯åªç®¡è°ƒç”¨å°±å¯ä»¥äº†</span></span><br><span class="line"><span class="keyword">import</span> Api <span class="keyword">from</span> <span class="string">'../../js/Api'</span>;</span><br><span class="line"><span class="keyword">import</span> Util <span class="keyword">from</span> <span class="string">'../../js/Util'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; Option &#125; = Select;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DouBan</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment"> stateæ˜¯è¿™å¼ è¡¨æ ¼æœ¬åœ°çš„ä¿¡æ¯ï¼Œcurrentè¡¨ç¤ºå½“å‰é¡µé¢ï¼Œtotalè¡¨ç¤ºä¸€å¼ å›¾æ ‡æ˜¾ç¤ºå¤šå°‘æ¡ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> labelå°±æ˜¯è¡¨å¤´çš„ä¿¡æ¯ï¼Œtypeå°±æ˜¯æœç´¢æ¡†çš„ç±»å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">      </span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      list: [],</span><br><span class="line">      current: <span class="number">1</span>,</span><br><span class="line">      total: <span class="number">10</span>,</span><br><span class="line">      label: [</span><br><span class="line">        &#123;</span><br><span class="line">          label: <span class="string">'ç”µå½±åå­—'</span>,</span><br><span class="line">          value: <span class="string">'title'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          label: <span class="string">'è¯„åˆ†'</span>,</span><br><span class="line">          value: <span class="string">'score'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          label: <span class="string">'å›½å®¶'</span>,</span><br><span class="line">          value: <span class="string">'country'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          label: <span class="string">'æ ‡ç­¾'</span>,</span><br><span class="line">          value: <span class="string">'sort'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          label: <span class="string">'å¯¼æ¼”'</span>,</span><br><span class="line">          value: <span class="string">'director'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          label: <span class="string">'æ¼”å‘˜'</span>,</span><br><span class="line">          value: <span class="string">'actor'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          label: <span class="string">'ä¸Šæ˜ æ—¶é—´'</span>,</span><br><span class="line">          value: <span class="string">'time'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">      type: [</span><br><span class="line">        &#123;</span><br><span class="line">          label: <span class="string">'AND'</span>,</span><br><span class="line">          value: <span class="string">'AND'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          label: <span class="string">'OR'</span>,</span><br><span class="line">          value: <span class="string">'OR'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="comment">//render()ä¹‹åè°ƒç”¨cdmhookæ¥åˆå§‹åŒ–è¡¨æ ¼</span></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.initTableData();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="inimitableçš„é€»è¾‘"><a href="#inimitableçš„é€»è¾‘" class="headerlink" title="inimitableçš„é€»è¾‘"></a><code>inimitable</code>çš„é€»è¾‘</h4><p>é¦–å…ˆè·å–åˆ°å½“å‰çš„tokenï¼Œç„¶åé€šè¿‡è¯·æ±‚å¤´ä¼ é€’åˆ°åç«¯å»ç”³è¯·æ•°æ®ï¼Œåç«¯è°ƒç”¨çš„æ˜¯<code>findAll</code>å‡½æ•° (è¯¦è§åç«¯å®ç°åšå®¢:<a href="https://jasonxqh.github.io/2020/06/08/Expressæ¡†æ¶åœ¨åç«¯çš„åº”ç”¨/#getAll"> Expressæ¡†æ¶åœ¨åç«¯çš„åº”ç”¨ä¹‹getAll</a>ï¼ŒæŠŠè¿”å›çš„æ•°æ®,ä¹Ÿå°±æ˜¯å½“å‰é¡µçš„ä¿¡æ¯ï¼Œå¯¹stateè¿›è¡Œæ›´æ–°ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">initTableData(current, sort) &#123;</span><br><span class="line">   <span class="keyword">const</span> token = Util.getToken();</span><br><span class="line">   Api.get(<span class="string">`/douban/list?page=<span class="subst">$&#123;current&#125;</span>&amp;sort=<span class="subst">$&#123;sort&#125;</span>`</span>, &#123;</span><br><span class="line">     headers: &#123; <span class="attr">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span> &#125;,</span><br><span class="line">   &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">if</span> (res.data) &#123;</span><br><span class="line">       <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">         list: res.data.data,</span><br><span class="line">         total: res.data.total,</span><br><span class="line">       &#125;);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="onChangeçš„é€»è¾‘"><a href="#onChangeçš„é€»è¾‘" class="headerlink" title="onChangeçš„é€»è¾‘"></a><code>onChange</code>çš„é€»è¾‘</h4><p>è¿™ä¸ªç”¨åœ¨åˆ†é¡µä¸Šã€‚é¦–å…ˆè·å¾—tokenï¼Œé€è¿‡è¯·æ±‚å¤´è¿›è¡Œä¼ é€’ã€‚è®¤è¯åå°†è¿”å›çš„dataæ›´æ–°æœ¬åœ°stateï¼Œæ³¨æ„ï¼Œå› ä¸ºåˆ†é¡µäº†ï¼Œæ‰€ä»¥è¿˜è¦æ›´æ–°current ä¸ºå½“å‰é¡µ</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">onChange = <span class="function">(<span class="params">page</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">const</span> token = Util.getToken();</span><br><span class="line">   Api.get(<span class="string">`/douban/list?page=<span class="subst">$&#123;page&#125;</span>`</span>, &#123; <span class="attr">headers</span>: &#123; <span class="attr">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span> &#125; &#125;).then(</span><br><span class="line">     (res) =&gt; &#123;</span><br><span class="line">       <span class="keyword">if</span> (res.data) &#123;</span><br><span class="line">         <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">           list: res.data.data,</span><br><span class="line">           total: res.data.total,</span><br><span class="line">           current: page,</span><br><span class="line">         &#125;);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;,</span><br><span class="line">   );</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>
<h4 id="æäº¤è¡¨å•æ“ä½œ"><a href="#æäº¤è¡¨å•æ“ä½œ" class="headerlink" title="æäº¤è¡¨å•æ“ä½œ"></a>æäº¤è¡¨å•æ“ä½œ</h4><p>é¦–å…ˆè·å–åˆ°tokenï¼Œ <code>e.preventDefault()</code>;ä¸è®©é‡æ–°åŠ è½½</p>
<p><code>validateFields</code>æ˜¯éªŒè¯è¡¨å•çš„å‡½æ•°ï¼Œè¿™æ˜¯antdæä¾›çš„api ï¼Œæ˜¯ç”¨äºå‡ºå‘è¡¨å•éªŒè¯çš„</p>
<p>é¦–å…ˆä»valuesä¸­è§£æ„åˆæˆ‘ä»¬ä¼ å…¥çš„ä¿¡æ¯</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/9.png" style="zoom: 67%;"></p>
<p>ä¹Ÿå°±æ˜¯è¿™äº”ä¸ªæ¡†æ¡†ã€‚ç„¶åå†™æˆ‘ä»¬çš„éªŒè¯é€»è¾‘ã€‚</p>
<ol>
<li>label1 ä¸èƒ½ç­‰äºlabel2</li>
<li>å¦‚æœtype=ANDï¼Œå°±è¯´æ˜ä¸¤ä¸ªæ¡ä»¶éƒ½è¦æ»¡è¶³ï¼Œtype=ORé‚£ä¹ˆåªæ»¡è¶³ä¸€ä¸ªæ¡ä»¶å³å¯.è¿™é‡Œæˆ‘ä¸è°ˆåç«¯å¦‚ä½•å®ç°ã€‚å› ä¸ºæœ‰ä¸“é—¨çš„åšå®¢<a href="https://jasonxqh.github.io/2020/06/08/Expressæ¡†æ¶åœ¨åç«¯çš„åº”ç”¨/#more">Expressæ¡†æ¶åœ¨åç«¯çš„åº”ç”¨</a>æ¥ä»‹ç»ï¼Œç„¶åæŠŠè¿”å›çš„ç»“æœæ›´æ–°åˆ°æœ¬åœ°çš„stateå½“ä¸­</li>
<li>å¦‚æœæ˜¯ANDè¯·æ±‚ï¼Œé‚£ä¹ˆæˆ‘éœ€è¦è¯·æ±‚<code>/douban/getList</code> ï¼Œåœ¨è¿™é‡Œåç«¯ä¼šè°ƒç”¨ <code>getListByKey</code>å‡½æ•° ï¼Œåœ¨<a href="https://jasonxqh.github.io/2020/06/08/Expressæ¡†æ¶åœ¨åç«¯çš„åº”ç”¨/#douban-js-2">Expressæ¡†æ¶åœ¨åç«¯çš„åº”ç”¨douban.jsä¸­æœ‰æ‰€ä»‹ç»</a>ï¼Œè¿”å›ä¸¤è€…çš†æ»¡è¶³çš„ä¿¡æ¯</li>
<li>å¦‚æœæ˜¯ORè¯·æ±‚ï¼Œé‚£ä¹ˆæˆ‘éœ€è¦è¯·æ±‚<code>/douban/getListOr</code>,åœ¨è¿™é‡Œåç«¯ä¼šè°ƒç”¨<code>getListByOr</code>å‡½æ•°ï¼Œåœ¨<a href="https://jasonxqh.github.io/2020/06/08/Expressæ¡†æ¶åœ¨åç«¯çš„åº”ç”¨/#douban-js-2">Expressæ¡†æ¶åœ¨åç«¯çš„åº”ç”¨douban.jsä¸­æœ‰æ‰€ä»‹ç»</a>ï¼Œè¿”å›ä¸¤è€…æ‹©ä¸€æ»¡è¶³çš„ä¿¡æ¯</li>
<li>åŒæ—¶ï¼Œæˆ‘ä»¬è¦æ»¡è¶³é€‰æ‹©çš„æ—¶å€™è¦æ’åºè¿™ä¸ªåŠŸèƒ½ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨reqä¸­åŠ ä¸Šsortçš„ç±»å‹</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">handleSubmit = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; sort &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">  <span class="keyword">const</span> token = Util.getToken();</span><br><span class="line">  e.preventDefault();</span><br><span class="line">  <span class="keyword">this</span>.props.form.validateFields(<span class="function">(<span class="params">err, values</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; label1, value1, type, label2, value2 &#125; = values;</span><br><span class="line">      <span class="keyword">if</span> (label1 === label2) &#123;</span><br><span class="line">        message.error(<span class="string">'ä¸¤ä¸ªæŸ¥è¯¢å­—æ®µä¸å¯é‡å¤ï¼'</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> keyWords = <span class="string">`<span class="subst">$&#123;label1&#125;</span>=<span class="subst">$&#123;value1&#125;</span>&amp;<span class="subst">$&#123;label2&#125;</span>=<span class="subst">$&#123;value2&#125;</span>`</span>;</span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">'AND'</span>) &#123;</span><br><span class="line">          Api.get(<span class="string">`/douban/getList?<span class="subst">$&#123;keyWords&#125;</span>&amp;sort=<span class="subst">$&#123;sort&#125;</span>`</span>, &#123;</span><br><span class="line">            headers: &#123; <span class="attr">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span> &#125;,</span><br><span class="line">          &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (res.data) &#123;</span><br><span class="line">              <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                list: res.data.data,</span><br><span class="line">                total: res.data.total,</span><br><span class="line">                current: <span class="number">1</span>,</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          Api.get(<span class="string">`/douban/getListOr?<span class="subst">$&#123;keyWords&#125;</span>`</span>, &#123;</span><br><span class="line">            headers: &#123; <span class="attr">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>&amp;sort=<span class="subst">$&#123;sort&#125;</span>`</span> &#125;,</span><br><span class="line">          &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (res.data) &#123;</span><br><span class="line">              <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                list: res.data.data,</span><br><span class="line">                total: res.data.total,</span><br><span class="line">                current: <span class="number">1</span>,</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="é‡ç½®æ“ä½œ"><a href="#é‡ç½®æ“ä½œ" class="headerlink" title="é‡ç½®æ“ä½œ"></a>é‡ç½®æ“ä½œ</h4><p><code>resetFields</code> ä¼šé‡ç½®æ•´ä¸ª Fieldï¼Œå› è€Œå…¶å­ç»„ä»¶ä¹Ÿä¼šé‡æ–° mount<br>ä»è€Œæ¶ˆé™¤è‡ªå®šä¹‰ç»„ä»¶å¯èƒ½å­˜åœ¨çš„å‰¯ä½œç”¨ï¼ˆä¾‹å¦‚å¼‚æ­¥æ•°æ®ã€çŠ¶æ€ç­‰ç­‰ï¼‰<br>ç„¶åè°ƒç”¨<code>initTableData</code>å‡½æ•°åˆå§‹åŒ– </p>
<p>æœ€ååˆ«å¿˜äº†è®¾ç½®current=1ï¼Œå¦åˆ™ä¸‹é¢çš„åˆ†é¡µå™¨è¿˜åœç•™åœ¨åŸæ¥çš„ä½ç½®ï¼Œä½†æ˜¯è¡¨æ ¼å·²ç»å›åˆ°äº†é¦–é¡µ</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">reset() &#123;</span><br><span class="line">  <span class="keyword">this</span>.props.form.resetFields();</span><br><span class="line">  <span class="keyword">this</span>.initTableData();</span><br><span class="line">  <span class="keyword">this</span>.state.current = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ’åºæ“ä½œ"><a href="#æ’åºæ“ä½œ" class="headerlink" title="æ’åºæ“ä½œ"></a>æ’åºæ“ä½œ</h4><p>åç«¯æ’åºå’Œå‰ç«¯æ’åºä¸å¤ªä¸€æ ·ï¼Œå‰ç«¯æ’åºçš„é€»è¾‘åœ¨<a href="https://jasonxqh.github.io/2020/06/02/reactåŸºç¡€2/#Sorting-Extracting-MoviesTable-å°è£…MoviesTable">reactåŸºç¡€2ä¸­çš„sort</a>å·²ç»æåˆ°äº†</p>
<p>è€Œåç«¯æ’åºåˆ™æ˜¯å‰ç«¯å‘é€ä¸€ä¸ªrequeståˆ°åç«¯ï¼Œåç«¯æ ¹æ®å‰ç«¯çš„sortç§ç±»æ¥è¿›è¡Œæ’åºï¼Œå†æŠŠæ•°æ®è¿”å›</p>
<p>è¿™é‡Œæ˜¯ä¸€ä¸ªæ›´æ–°Stateä¸­sortç§ç±»çš„å‡½æ•°ï¼Œé»˜è®¤sortä¸ºnullï¼Œä¹Ÿå°±æ˜¯ä¸æ’åº</p>
<p>åç«¯æ’åºçš„é€»è¾‘åœ¨è¿™é‡Œå®ç°: <a href="https://jasonxqh.github.io/2020/06/08/Expressæ¡†æ¶åœ¨åç«¯çš„åº”ç”¨/#findAll-1">åç«¯æ’åºfindAll</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sort(type) &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(</span><br><span class="line">      &#123;</span><br><span class="line">        sort: type,</span><br><span class="line">      &#125;,</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        <span class="keyword">this</span>.initTableData(<span class="literal">null</span>, type);</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>éšåï¼Œæˆ‘ä»¬åœ¨<code>initTableData</code>å‡½æ•°å½“ä¸­å‘é€æˆ‘ä»¬çš„sortè¯·æ±‚</p>
<p>åœ¨æ’åºè¿‡ç¨‹ä¸­å‡ºç°äº†ä¸€äº›å°æ’æ›²ï¼Œä¸€å¼€å§‹æˆ‘æ˜¯æ ¹æ®å­—ç¬¦ä¸²å¤§å°æ’åºçš„ã€‚ä½†æ˜¯ä¿®æ”¹äº†å˜é‡ç±»å‹ä¹‹åï¼Œé—®é¢˜è§£å†³äº†</p>
<p>æˆ‘ä»¬çœ‹åˆ°æ’åºè¿‡åï¼Œä»·æ ¼æ˜¯æŒ‰ç…§æ•°å­—æ’åºçš„ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²å¤§å°æ’åºçš„ã€‚</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/11.png" style="zoom: 67%;"></p>
<h4 id="renderæ¸²æŸ“å™¨"><a href="#renderæ¸²æŸ“å™¨" class="headerlink" title="renderæ¸²æŸ“å™¨"></a>renderæ¸²æŸ“å™¨</h4><p>é¦–å…ˆè§£æ„stateå’Œform(antd)</p>
<p>ç„¶åæ¸²æŸ“é€‰æ‹©æ¡†ï¼š</p>
<ol>
<li>ç¬¬ä¸€ä¸ªè¯·é€‰æ‹©æŸ¥è¯¢å­—æ®µçš„é€‰æ‹©æ¡†ï¼š<code>getFieldDecorator</code>ç”¨æˆ·å’Œè¡¨å•è¿›è¡ŒåŒå‘ç»‘å®šã€‚ required: trueæ˜¯å¿…é¡»è¦å¡«(å¦‚æœæƒ³æäº¤) ï¼Œç„¶åå°±æ˜¯ä¸€ä¸ªé€‰æ‹©æ¡†ï¼Œé»˜è®¤å ä½ç¬¦æ˜¯è¯·é€‰æ‹©æŸ¥è¯¢çš„å­—æ®µã€‚ç„¶åæŠŠlabelæ•°ç»„ä¸­ä¿¡æ¯çš„éƒ½æ¸²æŸ“åˆ°ä¸‹æ‹‰é€‰æ‹©è¡¨å•å½“ä¸­</li>
<li>ç¬¬äºŒä¸ªæ˜¯è¾“å…¥æ¡†ï¼Œä¹Ÿæ˜¯å¿…é¡»è¦å¡«çš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æƒ³æœç´¢çš„å†…å®¹</li>
<li>ç¬¬ä¸‰ä¸ªæ¡†æ˜¯é€‰æ‹©æŸ¥è¯¢ç±»å‹ï¼Œè¿™é‡Œå¯ä»¥æ˜¯ANDï¼Œå¯ä»¥ä¸ºORï¼Œå› ä¸ºæ¸²æŸ“çš„æ˜¯typeæ•°ç»„</li>
<li>ç¬¬å››ç¬¬äº”ä¸ªçš„é€»è¾‘å’Œç¬¬ä¸€ç¬¬äºŒä¸ªä¸€æ ·</li>
<li>ç„¶åæ˜¯æŸ¥è¯¢å’Œå……å€¼æŒ‰é’®ï¼Œç‚¹å‡»ååˆ†åˆ«è§¦å‘<code>handleSubmit()</code>å’Œ<code>reset()</code></li>
<li>æœ€åæ˜¯ä¸€ä¸ªåˆ†é¡µå™¨</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; getFieldDecorator &#125; = <span class="keyword">this</span>.props.form;</span><br><span class="line">    <span class="keyword">const</span> &#123; list, total, current, label, type &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Layout&gt;</span><br><span class="line">&#123;<span class="comment">/*</span></span><br><span class="line"><span class="comment">å¯¼å‡ºéƒ¨åˆ†åˆ†ä¸ºä¸¤å¤§ç»„ä»¶ï¼Œåˆ†åˆ«æ˜¯æœç´¢æ¡†å’Œè¡¨æ ¼Tablebodyéƒ¨åˆ†</span></span><br><span class="line"><span class="comment">*/</span>&#125;          </span><br><span class="line">          &lt;div className=<span class="string">"search"</span>&gt;</span><br><span class="line">            &lt;Form layout=<span class="string">"inline"</span> onSubmit=&#123;<span class="keyword">this</span>.handleSubmit&#125;&gt;</span><br><span class="line">              &lt;Form.Item className=<span class="string">"item"</span>&gt;</span><br><span class="line">                &#123;getFieldDecorator(<span class="string">'label1'</span>, &#123;</span><br><span class="line">                  rules: [</span><br><span class="line">                    &#123;</span><br><span class="line">                      required: <span class="literal">true</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                  ],</span><br><span class="line">                &#125;)(</span><br><span class="line">                  &lt;Select placeholder=<span class="string">"è¯·é€‰æ‹©æŸ¥è¯¢çš„å­—æ®µ"</span> style=&#123;&#123; <span class="attr">width</span>: <span class="string">'200px'</span> &#125;&#125;&gt;</span><br><span class="line">                    &#123;label.map(<span class="function">(<span class="params">item</span>) =&gt;</span> (</span><br><span class="line">                      &lt;Option value=&#123;item.value&#125; key=&#123;item.label&#125; label=&#123;item.label&#125;&gt;</span><br><span class="line">                        &#123;item.label&#125;</span><br><span class="line">                      &lt;<span class="regexp">/Option&gt;</span></span><br><span class="line"><span class="regexp">                    ))&#125;</span></span><br><span class="line"><span class="regexp">                  &lt;/</span>Select&gt;,</span><br><span class="line">                )&#125;</span><br><span class="line">              &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">              &lt;Form.Item className="item"&gt;</span></span><br><span class="line"><span class="regexp">                &#123;getFieldDecorator('value1', &#123;</span></span><br><span class="line"><span class="regexp">                  rules: [&#123; required: true &#125;],</span></span><br><span class="line"><span class="regexp">                &#125;)(&lt;Input size="default" /</span>&gt;)&#125;</span><br><span class="line">              &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">              &lt;Form.Item className="item"&gt;</span></span><br><span class="line"><span class="regexp">                &#123;getFieldDecorator('type', &#123;</span></span><br><span class="line"><span class="regexp">                  rules: [</span></span><br><span class="line"><span class="regexp">                    &#123;</span></span><br><span class="line"><span class="regexp">                      required: true,</span></span><br><span class="line"><span class="regexp">                    &#125;,</span></span><br><span class="line"><span class="regexp">                  ],</span></span><br><span class="line"><span class="regexp">                &#125;)(</span></span><br><span class="line"><span class="regexp">                  &lt;Select placeholder="æŸ¥è¯¢ç±»å‹" style=&#123;&#123; width: '150px' &#125;&#125;&gt;</span></span><br><span class="line"><span class="regexp">                    &#123;type.map((item) =&gt; (</span></span><br><span class="line"><span class="regexp">                      &lt;Option value=&#123;item.value&#125; key=&#123;item.label&#125; label=&#123;item.label&#125;&gt;</span></span><br><span class="line"><span class="regexp">                        &#123;item.label&#125;</span></span><br><span class="line"><span class="regexp">                      &lt;/</span>Option&gt;</span><br><span class="line">                    ))&#125;</span><br><span class="line">                  &lt;<span class="regexp">/Select&gt;,</span></span><br><span class="line"><span class="regexp">                )&#125;</span></span><br><span class="line"><span class="regexp">              &lt;/</span>Form.Item&gt;</span><br><span class="line">              &lt;Form.Item className=<span class="string">"item"</span>&gt;</span><br><span class="line">                &#123;getFieldDecorator(<span class="string">'label2'</span>, &#123;</span><br><span class="line">                  rules: [</span><br><span class="line">                    &#123;</span><br><span class="line">                      required: <span class="literal">true</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                  ],</span><br><span class="line">                &#125;)(</span><br><span class="line">                  &lt;Select placeholder=<span class="string">"è¯·é€‰æ‹©æŸ¥è¯¢çš„å­—æ®µ"</span> style=&#123;&#123; <span class="attr">width</span>: <span class="string">'200px'</span> &#125;&#125;&gt;</span><br><span class="line">                    &#123;label.map(<span class="function">(<span class="params">item</span>) =&gt;</span> (</span><br><span class="line">                      &lt;Option value=&#123;item.value&#125; key=&#123;item.label&#125; label=&#123;item.label&#125;&gt;</span><br><span class="line">                        &#123;item.label&#125;</span><br><span class="line">                      &lt;<span class="regexp">/Option&gt;</span></span><br><span class="line"><span class="regexp">                    ))&#125;</span></span><br><span class="line"><span class="regexp">                  &lt;/</span>Select&gt;,</span><br><span class="line">                )&#125;</span><br><span class="line">              &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">              &lt;Form.Item className="item"&gt;</span></span><br><span class="line"><span class="regexp">                &#123;getFieldDecorator('value2', &#123;</span></span><br><span class="line"><span class="regexp">                  rules: [&#123; required: true &#125;],</span></span><br><span class="line"><span class="regexp">                &#125;)(&lt;Input size="default" /</span>&gt;)&#125;</span><br><span class="line">              &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">              &lt;Form.Item className="item"&gt;</span></span><br><span class="line"><span class="regexp">                &lt;Button size="default" type="primary" htmlType="submit"&gt;</span></span><br><span class="line"><span class="regexp">                  æŸ¥è¯¢</span></span><br><span class="line"><span class="regexp">                &lt;/</span>Button&gt;</span><br><span class="line">                &lt;Button size=<span class="string">"default"</span> type=<span class="string">"primary"</span> onClick=&#123;() =&gt; <span class="keyword">this</span>.reset()&#125; style=&#123;&#123;<span class="attr">marginLeft</span>: <span class="string">'10px'</span>&#125;&#125;&gt;</span><br><span class="line">                  é‡ç½®</span><br><span class="line">                &lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">              &lt;/</span>Form.Item&gt;</span><br><span class="line">            &lt;<span class="regexp">/Form&gt;</span></span><br><span class="line"><span class="regexp">              &lt;Button</span></span><br><span class="line"><span class="regexp">              type=&#123;sort === "normal" ? "primary" : ""&#125;</span></span><br><span class="line"><span class="regexp">              style=&#123;&#123; marginRight: "10px" &#125;&#125;</span></span><br><span class="line"><span class="regexp">              onClick=&#123;() =&gt; this.sort("normal")&#125;</span></span><br><span class="line"><span class="regexp">            &gt;</span></span><br><span class="line"><span class="regexp">              åˆ†æ•°ä»é«˜åˆ°ä½</span></span><br><span class="line"><span class="regexp">            &lt;/</span>Button&gt;</span><br><span class="line">            &lt;Button</span><br><span class="line">              type=&#123;sort === <span class="string">"reverse"</span> ? <span class="string">"primary"</span> : <span class="string">""</span>&#125;</span><br><span class="line">              onClick=&#123;() =&gt; <span class="keyword">this</span>.sort(<span class="string">"reverse"</span>)&#125;</span><br><span class="line">              style=&#123;&#123; <span class="attr">marginRight</span>: <span class="string">"10px"</span> &#125;&#125;</span><br><span class="line">            &gt;</span><br><span class="line">              åˆ†æ•°ä»ä½åˆ°é«˜</span><br><span class="line">            &lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>div&gt;</span><br><span class="line"></span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;div style=&#123;&#123; <span class="attr">display</span>: <span class="string">'flex'</span> &#125;&#125;&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Table /</span><span class="regexp">/æ¸²æŸ“è¡¨æ ¼</span></span><br><span class="line"><span class="regexp">              bordered</span></span><br><span class="line"><span class="regexp">              dataSource=&#123;list&#125;</span></span><br><span class="line"><span class="regexp">              rowKey=&#123;(row) =&gt; row._id&#125;</span></span><br><span class="line"><span class="regexp">              pagination=&#123;false&#125;</span></span><br><span class="line"><span class="regexp">                /</span><span class="regexp">/åˆ—</span></span><br><span class="line"><span class="regexp">              columns=&#123;[</span></span><br><span class="line"><span class="regexp">                &#123;</span></span><br><span class="line"><span class="regexp">                  title: 'ç”µå½±åå­—',</span></span><br><span class="line"><span class="regexp">                  dataIndex: 'title',</span></span><br><span class="line"><span class="regexp">                  key: 'title',</span></span><br><span class="line"><span class="regexp">                  align: 'center',</span></span><br><span class="line"><span class="regexp">                &#125;,</span></span><br><span class="line"><span class="regexp">                &#123;</span></span><br><span class="line"><span class="regexp">                  title: 'å¯¼æ¼”',</span></span><br><span class="line"><span class="regexp">                  dataIndex: 'director',</span></span><br><span class="line"><span class="regexp">                  key: 'director',</span></span><br><span class="line"><span class="regexp">                  align: 'center',</span></span><br><span class="line"><span class="regexp">                &#125;,</span></span><br><span class="line"><span class="regexp">                &#123;</span></span><br><span class="line"><span class="regexp">                  title: 'æ¼”å‘˜',</span></span><br><span class="line"><span class="regexp">                  dataIndex: 'actor',</span></span><br><span class="line"><span class="regexp">                  key: 'actor',</span></span><br><span class="line"><span class="regexp">                  align: 'center',</span></span><br><span class="line"><span class="regexp">                  // width: 600,</span></span><br><span class="line"><span class="regexp">                &#125;,</span></span><br><span class="line"><span class="regexp">                &#123;</span></span><br><span class="line"><span class="regexp">                  title: 'å›½å®¶',</span></span><br><span class="line"><span class="regexp">                  dataIndex: 'country',</span></span><br><span class="line"><span class="regexp">                  key: 'country',</span></span><br><span class="line"><span class="regexp">                  align: 'center',</span></span><br><span class="line"><span class="regexp">                  width: 100,</span></span><br><span class="line"><span class="regexp">                &#125;,</span></span><br><span class="line"><span class="regexp">                &#123;</span></span><br><span class="line"><span class="regexp">                  title: 'æ ‡ç­¾',</span></span><br><span class="line"><span class="regexp">                  dataIndex: 'sort',</span></span><br><span class="line"><span class="regexp">                  key: 'sort',</span></span><br><span class="line"><span class="regexp">                  align: 'center',</span></span><br><span class="line"><span class="regexp">                  width: 200,</span></span><br><span class="line"><span class="regexp">                &#125;,</span></span><br><span class="line"><span class="regexp">                &#123;</span></span><br><span class="line"><span class="regexp">                  title: 'è¯„åˆ†',</span></span><br><span class="line"><span class="regexp">                  dataIndex: 'score',</span></span><br><span class="line"><span class="regexp">                  key: 'score',</span></span><br><span class="line"><span class="regexp">                  align: 'center',</span></span><br><span class="line"><span class="regexp">                &#125;,</span></span><br><span class="line"><span class="regexp">                &#123;</span></span><br><span class="line"><span class="regexp">                  title: 'ä¸Šæ˜ æ—¶é—´',</span></span><br><span class="line"><span class="regexp">                  dataIndex: 'time',</span></span><br><span class="line"><span class="regexp">                  key: 'time',</span></span><br><span class="line"><span class="regexp">                  align: 'center',</span></span><br><span class="line"><span class="regexp">                &#125;,</span></span><br><span class="line"><span class="regexp">              ]&#125;</span></span><br><span class="line"><span class="regexp">            /</span>&gt;</span><br><span class="line">            &lt;Pagination</span><br><span class="line">             <span class="comment">//åˆ†é¡µå™¨ï¼Œåœ¨reactåŸºç¡€2åˆ†é¡µéƒ¨åˆ†æœ‰å…·ä½“å®ç°ï¼Œè¿™é‡Œç›´æ¥å¼•ç”¨äº†antdä¸­çš„åˆ†é¡µå™¨æ ·å¼ </span></span><br><span class="line">              style=&#123;&#123; <span class="attr">marginTop</span>: <span class="string">'20px'</span> &#125;&#125;</span><br><span class="line">              defaultPageSize=&#123;<span class="number">10</span>&#125;</span><br><span class="line">              current=&#123;current&#125;</span><br><span class="line">              onChange=&#123;<span class="keyword">this</span>.onChange&#125;</span><br><span class="line">              total=&#123;total&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Layout&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const mapStateToProps = (state) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  return &#123;</span></span><br><span class="line"><span class="regexp">    userData: state.userData.data,</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const wrappedDouBanForm = Form.create(&#123; name: 'douban' &#125;)(DouBan);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default connect(mapStateToProps, null)(wrappedDouBanForm);</span></span><br></pre></td></tr></table></figure>
<h3 id="Operas-jsx-æ–°å»ºè¡¨å•"><a href="#Operas-jsx-æ–°å»ºè¡¨å•" class="headerlink" title="Operas.jsx æ–°å»ºè¡¨å•"></a><code>Operas.jsx</code> æ–°å»ºè¡¨å•</h3><p>å‰©ä¸‹çš„ä¸‰å¼ è¡¨ä¸­ï¼ŒçŒ«çœ¼å’Œæ·˜å®å’–å•¡éƒ½å¯ä»¥è¿›è¡Œä¸€äº›æ’åºï¼ˆåˆ†æ•°ï¼Œä»·æ ¼ï¼‰ã€‚ ä½†æ˜¯Operaè¡¨æ ¼å´æ²¡æœ‰ä»€ä¹ˆå¯ä»¥æ’åºçš„</p>
<p>æ‰€ä»¥æˆ‘å°±åœ¨operas.jsxä¸­æ–°åŠ å…¥äº†ä¸€ä¸ªåˆ›å»ºæ–°å‰§çš„åŠŸèƒ½</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/12.png" style="zoom: 67%;"></p>
<p>ç‚¹å‡»æ–°å»ºæŒ‰é’®ï¼Œæˆ‘ä»¬ä¼šè·³è½¬ä¸€ä¸ªè¡¨å•</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/13.png" style="zoom: 67%;"></p>
<p>ç„¶åæˆ‘ä»¬è¾“å…¥æˆ‘ä»¬æƒ³è¦åˆ›å»ºçš„æ–°ç”µè§†å‰§</p>
<p>æ¯”å¦‚ï¼š</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/14.png" style="zoom: 67%;"></p>
<p>å› ä¸ºå•é›†ç‰‡é•¿å¯é€‰å¡«ï¼Œæ‰€ä»¥è¿™é‡Œå°±æš‚æ—¶ä¸å¡«</p>
<p>ç‚¹å‡»åˆ›å»ºåï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¡¨ä¸­æŸ¥è¯¢åˆ°è¿™æ¡ç”µè§†å‰§ä¿¡æ¯å•¦ï¼</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/15.png" style="zoom: 67%;"></p>
<h4 id="å®ç°é€»è¾‘"><a href="#å®ç°é€»è¾‘" class="headerlink" title="å®ç°é€»è¾‘"></a>å®ç°é€»è¾‘</h4><p>åç«¯é€»è¾‘è¯·ç§»æ­¥</p>
<p>é¦–å…ˆæ–°å»ºä¸€ä¸ªoperaformçš„è¡¨æ ¼ï¼Œç”¨äºå­˜æ”¾æˆ‘ä»¬çš„è¡¨å•</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Redirect &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createHashHistory &#125; <span class="keyword">from</span> <span class="string">'history'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Form, Icon, Input, Button, message &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/layout'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.scss'</span>;</span><br><span class="line"><span class="keyword">import</span> Api <span class="keyword">from</span> <span class="string">'../../js/Api'</span>;</span><br><span class="line"><span class="keyword">const</span> history = createHashHistory(&#123; <span class="attr">forceRefresh</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MovieForm</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidMount() &#123;&#125;</span><br><span class="line"><span class="comment">// æäº¤è¡¨å•æ“ä½œï¼Œæˆ‘ä»¬åˆ©ç”¨postè¿™ä¸ªapiæ–°å»ºä¸€æ¡ä¿¡æ¯ï¼Œç„¶åå¦‚æœæ–°å»ºæˆåŠŸçš„è¯å°±è·³è½¬åˆ°operasç•Œé¢</span></span><br><span class="line">  handleSubmit = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    <span class="keyword">this</span>.props.form.validateFields(<span class="function">(<span class="params">err, values</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">        Api.post(<span class="string">'/operas/create'</span>, values)</span><br><span class="line">          .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (res.data) &#123;</span><br><span class="line">              message.success(<span class="string">'create successfully'</span>);</span><br><span class="line">              history.push(<span class="string">'/operas'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err);</span><br><span class="line">            message.error(err.message);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; getFieldDecorator &#125; = <span class="keyword">this</span>.props.form;</span><br><span class="line">    <span class="keyword">const</span> &#123; userData &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> &#123; isLogin &#125; = userData;</span><br><span class="line">    <span class="keyword">const</span> formItemLayout = &#123;</span><br><span class="line">      labelCol: &#123;</span><br><span class="line">        xs: &#123; <span class="attr">span</span>: <span class="number">24</span> &#125;,</span><br><span class="line">        sm: &#123; <span class="attr">span</span>: <span class="number">8</span> &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      wrapperCol: &#123;</span><br><span class="line">        xs: &#123; <span class="attr">span</span>: <span class="number">24</span> &#125;,</span><br><span class="line">        sm: &#123; <span class="attr">span</span>: <span class="number">16</span> &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> tailFormItemLayout = &#123;</span><br><span class="line">      wrapperCol: &#123;</span><br><span class="line">        xs: &#123;</span><br><span class="line">          span: <span class="number">24</span>,</span><br><span class="line">          offset: <span class="number">0</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        sm: &#123;</span><br><span class="line">          span: <span class="number">22</span>,</span><br><span class="line">          offset: <span class="number">2</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Layout&gt;</span><br><span class="line">        &lt;h1 className=<span class="string">"title"</span>&gt;å¿«æ¥åˆ›å»ºæœ€æ–°çš„ç”µè§†å‰§å§ï¼&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Form &#123;...formItemLayout&#125; onSubmit=&#123;this.handleSubmit&#125; className="login-form"&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="å‰§é›†åå­—" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &#123;getFieldDecorator('title', &#123;</span></span><br><span class="line"><span class="regexp">              rules: [&#123; required: true &#125;],</span></span><br><span class="line"><span class="regexp">            &#125;)(</span></span><br><span class="line"><span class="regexp">              &lt;Input</span></span><br><span class="line"><span class="regexp">                size="large"</span></span><br><span class="line"><span class="regexp">                placeholder="å‰§é›†åå­—"</span></span><br><span class="line"><span class="regexp">              /</span>&gt;,</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="æ¼”å‘˜" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &#123;getFieldDecorator('actors', &#123;</span></span><br><span class="line"><span class="regexp">              rules: [&#123; required: true &#125;],</span></span><br><span class="line"><span class="regexp">            &#125;)(</span></span><br><span class="line"><span class="regexp">              &lt;Input</span></span><br><span class="line"><span class="regexp">                size="large"</span></span><br><span class="line"><span class="regexp">                placeholder="æ¼”å‘˜"</span></span><br><span class="line"><span class="regexp">              /</span>&gt;,</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="å›½å®¶" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &#123;getFieldDecorator('country', &#123;</span></span><br><span class="line"><span class="regexp">              rules: [&#123; required: true &#125;],</span></span><br><span class="line"><span class="regexp">            &#125;)(</span></span><br><span class="line"><span class="regexp">              &lt;Input</span></span><br><span class="line"><span class="regexp">                size="large"</span></span><br><span class="line"><span class="regexp">                placeholder="å›½å®¶"</span></span><br><span class="line"><span class="regexp">              /</span>&gt;,</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="ç±»å‹" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &#123;getFieldDecorator('type', &#123;</span></span><br><span class="line"><span class="regexp">              rules: [&#123; required: true &#125;],</span></span><br><span class="line"><span class="regexp">            &#125;)(</span></span><br><span class="line"><span class="regexp">              &lt;Input</span></span><br><span class="line"><span class="regexp">                size="large"</span></span><br><span class="line"><span class="regexp">                placeholder="ç±»å‹:"</span></span><br><span class="line"><span class="regexp">              /</span>&gt;,</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="å•é›†ç‰‡é•¿" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &#123;getFieldDecorator('single', &#123;</span></span><br><span class="line"><span class="regexp">              rules: [&#123; required: false &#125;],</span></span><br><span class="line"><span class="regexp">            &#125;)(</span></span><br><span class="line"><span class="regexp">              &lt;Input</span></span><br><span class="line"><span class="regexp">                size="large"</span></span><br><span class="line"><span class="regexp">                placeholder="å•é›†ç‰‡é•¿:"</span></span><br><span class="line"><span class="regexp">              /</span>&gt;,</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="é¦–æ’­æ—¶é—´" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &#123;getFieldDecorator('first_date', &#123;</span></span><br><span class="line"><span class="regexp">              rules: [&#123; required: false &#125;],</span></span><br><span class="line"><span class="regexp">            &#125;)(</span></span><br><span class="line"><span class="regexp">              &lt;Input</span></span><br><span class="line"><span class="regexp">                size="large"</span></span><br><span class="line"><span class="regexp">                placeholder="é¦–æ’­æ—¶é—´:"</span></span><br><span class="line"><span class="regexp">              /</span>&gt;,</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item &#123;...tailFormItemLayout&#125; className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Button size="large" type="primary" htmlType="submit" className="login-form-button"&gt;</span></span><br><span class="line"><span class="regexp">              åˆ›å»º</span></span><br><span class="line"><span class="regexp">            &lt;/</span>Button&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Form&gt;</span><br><span class="line">      &lt;<span class="regexp">/Layout&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const mapStateToProps = (state) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  return &#123;</span></span><br><span class="line"><span class="regexp">    userData: state.userData.data,</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const wrappedMovieForm = Form.create(&#123; name: 'MovieForm' &#125;)(MovieForm);</span></span><br><span class="line"><span class="regexp">export default connect(mapStateToProps, null)(wrappedMovieForm);</span></span><br></pre></td></tr></table></figure>
<p>å…¶æ¬¡åœ¨<code>operas.jsx</code>ä¸­æ–°å»ºä¸€ä¸ªbuttonï¼Œç”¨äºè·³è½¬</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">//...</span></span><br><span class="line">  createForm() &#123;</span><br><span class="line">    history.push(<span class="string">"/operas/create"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&lt;Button</span><br><span class="line">  size=<span class="string">"default"</span></span><br><span class="line">  type=<span class="string">"primary"</span></span><br><span class="line">  onClick=&#123;() =&gt; <span class="keyword">this</span>.createForm()&#125;</span><br><span class="line">  style=&#123;&#123; <span class="attr">marginLeft</span>: <span class="string">"10px"</span> &#125;&#125;</span><br><span class="line">&gt;</span><br><span class="line">  æ–°å»º</span><br><span class="line">&lt;<span class="regexp">/Button&gt;</span></span><br></pre></td></tr></table></figure>
<p>æœ€å<code>app.jsx</code>ä¸­ç”³è¯·è·¯ç”±ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> OperaForm = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">"./operaform"</span>));</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&lt;PrivateRoute exact path=<span class="string">"/operas/create"</span> component=&#123;OperaForm&#125; /&gt;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>
<p>æœ‰æ–°å»ºï¼Œå¿…å®šæœ‰åˆ é™¤é¸­</p>
<p>å®ç°é€»è¾‘å’Œadminåˆ é™¤userä¸€æ ·ã€‚è¿™é‡Œå°±ä¸å¤šè®²äº†</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//... </span></span><br><span class="line">deleteOperas = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> _this = <span class="keyword">this</span>;</span><br><span class="line">    confirm(&#123;</span><br><span class="line">      title: <span class="string">"Are you sure delete?"</span>,</span><br><span class="line">      content: <span class="string">"Hope you know what you are doingï¼"</span>,</span><br><span class="line">      okText: <span class="string">"confirm"</span>,</span><br><span class="line">      okType: <span class="string">"danger"</span>,</span><br><span class="line">      cancelText: <span class="string">"cancel"</span>,</span><br><span class="line">      onOk() &#123;</span><br><span class="line">        <span class="keyword">const</span> token = Util.getToken();</span><br><span class="line">        Api.post( <span class="string">`/operas/<span class="subst">$&#123;item._id&#125;</span>/delete`</span>,&#123;</span><br><span class="line">          headers: &#123; <span class="attr">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span> &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">          .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(res);</span><br><span class="line">            <span class="keyword">if</span> (res.data) &#123;</span><br><span class="line">              message.success(<span class="string">"delete success"</span>);</span><br><span class="line">              _this.getUserList();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              message.error(<span class="string">"fail"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">      onCancel() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Cancel"</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">  &#123;</span><br><span class="line">    title: <span class="string">"delete"</span>,</span><br><span class="line">    key: <span class="string">"delete"</span>,</span><br><span class="line">    align: <span class="string">"center"</span>,</span><br><span class="line">    render: <span class="function">(<span class="params">row, item</span>) =&gt;</span> (</span><br><span class="line">      &lt;div className=<span class="string">"person-table-btn"</span>&gt;</span><br><span class="line">        &#123;</span><br><span class="line">          &lt;Tooltip placement=<span class="string">"top"</span> title=&#123;<span class="string">"delete"</span>&#125;&gt;</span><br><span class="line">            &lt;Icon</span><br><span class="line">              type=<span class="string">"delete"</span></span><br><span class="line">              theme=<span class="string">"twoTone"</span></span><br><span class="line">              twoToneColor=<span class="string">"#eb2f96"</span></span><br><span class="line">              className=<span class="string">"table-btn-item"</span></span><br><span class="line">              onClick=&#123;() =&gt; <span class="keyword">this</span>.deleteOperas(item)&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;<span class="regexp">/Tooltip&gt;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt; </span><br><span class="line">     ),</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/16.png" style="zoom: 67%;"></p>
<h3 id="å®ç°æ”¶è—åŠŸèƒ½"><a href="#å®ç°æ”¶è—åŠŸèƒ½" class="headerlink" title="å®ç°æ”¶è—åŠŸèƒ½"></a>å®ç°æ”¶è—åŠŸèƒ½</h3><p>æˆ‘æƒ³ï¼Œèƒ½ä¸èƒ½åŠ å…¥ä¸€ä¸ªæ”¶è—å¤¹çš„åŠŸèƒ½ï¼Œè®©ç”¨æˆ·èƒ½å¤ŸæŠŠä»–ä¸­æ„çš„ç¾å‰§æ”¾åœ¨æ”¶è—å¤¹å½“ä¸­å‘¢ï¼Ÿ</p>
<p>æˆ‘çš„å®ç°é€»è¾‘ï¼šé¦–å…ˆæ–°å»ºä¸€å¼ schemaï¼Œæ¥å­˜æ”¾æˆ‘æ”¶è—å¤¹ä¸­çš„ä¿¡æ¯ï¼Œè®©ç„¶ååœ¨operaè¡¨æ ¼å½“ä¸­æ–°æ·»åŠ ä¸€åˆ— Likeåˆ—ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªç‚¹èµæŒ‰é’®ï¼Œå½“ç‚¹å‡»åè¿™ä¸ªç¾å‰§å°±è¢«æ·»åŠ åˆ°æˆ‘ä»¬çš„æ”¶è—å¤¹å½“ä¸­äº†ã€‚</p>
<p>åœ¨æ”¶è—å¤¹ä¸­ï¼Œæˆ‘ä¹Ÿä»¥è¡¨æ ¼å½¢å¼å±•ç¤ºï¼Œå¯ä»¥åˆ é™¤æ”¶è—å¤¹ä¸­çš„ä¿¡æ¯ã€‚è¿˜æœ‰è¿”å›æŒ‰é’®è¿”å›å±•ç¤ºé¡µé¢</p>
<p>å› ä»£ç å’Œå±•ç¤ºé¡µé¢ç±»ä¼¼ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä¸å†å±•ç¤ºäº†ã€‚</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/17.png" style="zoom: 67%;"></p>
<h3 id="å®ç°å…·ä½“ä¿¡æ¯å±•ç¤º"><a href="#å®ç°å…·ä½“ä¿¡æ¯å±•ç¤º" class="headerlink" title="å®ç°å…·ä½“ä¿¡æ¯å±•ç¤º"></a>å®ç°å…·ä½“ä¿¡æ¯å±•ç¤º</h3><p>è¿™ä¸ªåŠŸèƒ½åœ¨å­¦ä¹ åšå®¢ï¼š<a href="https://jasonxqh.github.io/2020/06/04/reactåŸºç¡€3/#Exercise-1-Register-Form">Register Form</a> ä¸­ï¼Œæˆ‘æŠŠä»–è¿ç”¨åˆ°äº†è¿™ä¸ªé¡¹ç›®å½“ä¸­</p>
<p>ç®€å•çš„æ¥è¯´ï¼Œå°±æ˜¯åœ¨å±•ç¤ºç•Œé¢çš„titleåˆ—ï¼Œæ¸²æŸ“ä¸€ä¸ªé“¾æ¥ï¼Œè®©å®ƒæŒ‡å‘ä¸€ä¸ªç½‘é¡µï¼Œè¿™ä¸ªç½‘é¡µä¼šåœ¨è¿›è¡Œ<code>componentDidMount</code>æ—¶è‡ªåŠ¨æŠŠä»åç«¯è¯·æ±‚è¿‡æ¥çš„detailed message æ¸²æŸ“åˆ°è¡¨å•å½“ä¸­ã€‚ä½†æ˜¯ç¾ä¸­ä¸è¶³çš„æ—¶è¿™ä¸ªè¡¨å•æš‚æ—¶ä¸æ”¯æŒä¿®æ”¹ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createHashHistory &#125; <span class="keyword">from</span> <span class="string">"history"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Form, Input, Button  &#125; <span class="keyword">from</span> <span class="string">"antd"</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">"../components/layout"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./style.scss"</span>;</span><br><span class="line"><span class="keyword">import</span> Api <span class="keyword">from</span> <span class="string">"../../js/Api"</span>;</span><br><span class="line"><span class="keyword">const</span> history = createHashHistory(&#123; <span class="attr">forceRefresh</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MovieForm</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;&#125;;</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      _id: <span class="literal">null</span>,</span><br><span class="line">      actors: <span class="literal">null</span>,</span><br><span class="line">      country: <span class="literal">null</span>,</span><br><span class="line">      first_date: <span class="literal">null</span>,</span><br><span class="line">      now: <span class="literal">null</span>,</span><br><span class="line">      other_name: <span class="literal">null</span>,</span><br><span class="line">      single: <span class="literal">null</span>,</span><br><span class="line">      station: <span class="literal">null</span>,</span><br><span class="line">      title: <span class="literal">null</span>,</span><br><span class="line">      type: <span class="literal">null</span>,</span><br><span class="line">      url: <span class="literal">null</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">this</span>.populateOpera();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> populateOpera() &#123;</span><br><span class="line">    <span class="keyword">const</span> operaname = <span class="keyword">this</span>.props.match.params.id; <span class="comment">//è·å–urlå‚æ•°</span></span><br><span class="line">    <span class="keyword">const</span> opera = Api.get(<span class="string">`/operas/<span class="subst">$&#123;operaname&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">const</span> details = (<span class="keyword">await</span> opera).data;</span><br><span class="line">    <span class="keyword">const</span> infos = details.targetOpera[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      _id,</span><br><span class="line">      actors,</span><br><span class="line">      country,</span><br><span class="line">      first_date,</span><br><span class="line">      now,</span><br><span class="line">      other_name,</span><br><span class="line">      single,</span><br><span class="line">      station,</span><br><span class="line">      title,</span><br><span class="line">      type,</span><br><span class="line">      url,</span><br><span class="line">    &#125; = infos;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      _id,</span><br><span class="line">      actors,</span><br><span class="line">      country,</span><br><span class="line">      first_date,</span><br><span class="line">      now,</span><br><span class="line">      other_name,</span><br><span class="line">      single,</span><br><span class="line">      station,</span><br><span class="line">      title,</span><br><span class="line">      type,</span><br><span class="line">      url,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// console.log(actors)</span></span><br><span class="line">  &#125;</span><br><span class="line">  back() &#123;</span><br><span class="line">    history.push(<span class="string">'/operas'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      _id,</span><br><span class="line">      actors,</span><br><span class="line">      country,</span><br><span class="line">      first_date,</span><br><span class="line">      now,</span><br><span class="line">      other_name,</span><br><span class="line">      single,</span><br><span class="line">      station,</span><br><span class="line">      title,</span><br><span class="line">      type,</span><br><span class="line">      url,</span><br><span class="line">    &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="built_in">console</span>.log(actors);</span><br><span class="line">    <span class="keyword">const</span> &#123; getFieldDecorator &#125; = <span class="keyword">this</span>.props.form;</span><br><span class="line">    <span class="keyword">const</span> &#123; userData &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> &#123; name, isLogin &#125; = userData;</span><br><span class="line">    <span class="keyword">const</span> formItemLayout = &#123;</span><br><span class="line">      labelCol: &#123; <span class="attr">span</span>: <span class="number">50</span> &#125;,</span><br><span class="line">      wrapperCol: &#123; <span class="attr">span</span>: <span class="number">60</span> &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> tailFormItemLayout = &#123;</span><br><span class="line">      wrapperCol: &#123;</span><br><span class="line">        xs: &#123;</span><br><span class="line">          span: <span class="number">24</span>,</span><br><span class="line">          offset: <span class="number">0</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        sm: &#123;</span><br><span class="line">          span: <span class="number">22</span>,</span><br><span class="line">          offset: <span class="number">2</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Layout&gt;</span><br><span class="line">        &lt;strong className=<span class="string">"title"</span>&gt;DetailedInformation&lt;<span class="regexp">/strong&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Form</span></span><br><span class="line"><span class="regexp">          &#123;...formItemLayout&#125;</span></span><br><span class="line"><span class="regexp">          onSubmit=&#123;this.handleSubmit&#125;</span></span><br><span class="line"><span class="regexp">          className="login-form"</span></span><br><span class="line"><span class="regexp">        &gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="å‰§é›†åå­—" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Input size="large" value=&#123;title&#125; /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="æ¼”å‘˜" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Input.TextArea rows=&#123;4&#125; size="large" value=&#123;actors&#125; /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="å›½å®¶" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Input size="large" value=&#123;country&#125; /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="ç±»å‹" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Input size="large" value=&#123;type&#125; /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="å•é›†ç‰‡é•¿" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Input size="large" value=&#123;single&#125; /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="é¦–æ’­æ—¶é—´" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Input size="large" value=&#123;first_date&#125; /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="æ›´æ–°è‡³" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Input size="large" value=&#123;now&#125; /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="åˆ«å" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Input size="large" value=&#123;other_name&#125; /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="ç”µè§†å°" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Input size="large" value=&#123;station&#125; /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="url" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Input size="large" value=&#123;url&#125; /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item &#123;...tailFormItemLayout&#125; className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Button</span></span><br><span class="line"><span class="regexp">              size="large"</span></span><br><span class="line"><span class="regexp">              type="primary"</span></span><br><span class="line"><span class="regexp">              onClick=&#123;() =&gt; this.back()&#125;</span></span><br><span class="line"><span class="regexp">              className="login-form-button"</span></span><br><span class="line"><span class="regexp">            &gt;</span></span><br><span class="line"><span class="regexp">              è¿”å›</span></span><br><span class="line"><span class="regexp">            &lt;/</span>Button&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Form&gt;</span><br><span class="line">      &lt;<span class="regexp">/Layout&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const mapStateToProps = (state) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  return &#123;</span></span><br><span class="line"><span class="regexp">    userData: state.userData.data,</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const wrappedMovieForm = Form.create(&#123; name: "MovieForm" &#125;)(MovieForm);</span></span><br><span class="line"><span class="regexp">export default connect(mapStateToProps, null)(wrappedMovieForm);</span></span><br></pre></td></tr></table></figure>
<h2 id="App-js"><a href="#App-js" class="headerlink" title="App.js"></a><code>App.js</code></h2><p>Appç»„ä»¶æ˜¯æ ¹ç»„ä»¶æ‰€ä»¥æˆ‘ä»¬å•ç‹¬è®²ã€‚å…ˆä¸Šä»£ç </p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Suspense, lazy &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.scss'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; HashRouter <span class="keyword">as</span> Router, Route, Switch &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> PrivateRoute <span class="keyword">from</span> <span class="string">'./components/PrivateRoute'</span>;</span><br><span class="line"><span class="keyword">import</span> Loading <span class="keyword">from</span> <span class="string">'./components/loading'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./home'</span>));</span><br><span class="line"><span class="keyword">const</span> Sign = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./sign'</span>));</span><br><span class="line"><span class="keyword">const</span> Register = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./register'</span>));</span><br><span class="line"><span class="keyword">const</span> Manage = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./manage'</span>));</span><br><span class="line"><span class="keyword">const</span> Douban = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./douban'</span>));</span><br><span class="line"><span class="keyword">const</span> Taobao = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./taobao'</span>));</span><br><span class="line"><span class="keyword">const</span> Maoyan = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./maoyan'</span>));</span><br><span class="line"><span class="keyword">const</span> Operas = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./operas'</span>));</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Router&gt;</span><br><span class="line">        &lt;Suspense</span><br><span class="line">          fallback=&#123;<span class="comment">//è¿™é‡Œå¦‚æœç­‰å¾…çš„åŒ–ï¼Œé‚£ä¹ˆå°±åŠ è½½ä¸Šé¢æ‰€è¯´çš„Loadingç»„ä»¶</span></span><br><span class="line">            &lt;div className=<span class="string">"loading"</span>&gt;</span><br><span class="line">              &lt;Loading /&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &#125;</span></span><br><span class="line"><span class="regexp">        &gt;</span></span><br><span class="line"><span class="regexp">          &lt;Switch&gt;</span></span><br><span class="line"><span class="regexp">            &lt;PrivateRoute exact path="/</span><span class="string">" component=&#123;Home&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;PrivateRoute exact path="</span>/manage<span class="string">" component=&#123;Manage&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;Route exact path="</span>/login<span class="string">" component=&#123;Sign&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;Route exact path="</span>/register<span class="string">" component=&#123;Register&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;PrivateRoute exact path="</span>/douban<span class="string">" component=&#123;Douban&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;PrivateRoute exact path="</span>/taobao<span class="string">" component=&#123;Taobao&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;PrivateRoute exact path="</span>/maoyan<span class="string">" component=&#123;Maoyan&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;PrivateRoute exact path="</span>/operas<span class="string">" component=&#123;Operas&#125; /&gt;</span></span><br><span class="line"><span class="string">          &lt;/Switch&gt;</span></span><br><span class="line"><span class="string">        &lt;/Suspense&gt;</span></span><br><span class="line"><span class="string">      &lt;/Router&gt;</span></span><br><span class="line"><span class="string">    );</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">export default App;</span></span><br></pre></td></tr></table></figure>
<p><strong>è¿™é‡Œéœ€è¦è®²å‡ ä¸ªé—®é¢˜ï¼š</strong></p>
<h3 id="lazy-Suspense-çš„ä½œç”¨-1"><a href="#lazy-Suspense-çš„ä½œç”¨-1" class="headerlink" title="lazy+Suspense çš„ä½œç”¨"></a><code>lazy+Suspense</code> çš„ä½œç”¨</h3><p>åœ¨<a href="https://react.docschina.org/docs/code-splitting.html" target="_blank" rel="noopener">reactå®˜æ–¹æ–‡æ¡£</a>ä¸­æˆ‘æˆªå–äº†ä¸€æ®µ</p>
<p><code>React.lazy</code> å‡½æ•°èƒ½è®©ä½ åƒæ¸²æŸ“å¸¸è§„ç»„ä»¶ä¸€æ ·å¤„ç†åŠ¨æ€å¼•å…¥ï¼ˆçš„ç»„ä»¶ï¼‰ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> OtherComponent = React.lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./OtherComponent'</span>));</span><br></pre></td></tr></table></figure>
<p>æ­¤ä»£ç å°†ä¼šåœ¨ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶ï¼Œè‡ªåŠ¨å¯¼å…¥åŒ…å« <code>OtherComponent</code> ç»„ä»¶çš„åŒ…ã€‚</p>
<p><code>React.lazy</code> æ¥å—ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°éœ€è¦åŠ¨æ€è°ƒç”¨ <code>import()</code>ã€‚å®ƒå¿…é¡»è¿”å›ä¸€ä¸ª <code>Promise</code>ï¼Œè¯¥ Promise éœ€è¦ resolve ä¸€ä¸ª <code>default</code> export çš„ React ç»„ä»¶ã€‚</p>
<p>ç„¶ååº”åœ¨ <code>Suspense</code> ç»„ä»¶ä¸­æ¸²æŸ“ lazy ç»„ä»¶ï¼Œå¦‚æ­¤ä½¿å¾—æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åœ¨ç­‰å¾…åŠ è½½ lazy ç»„ä»¶æ—¶åšä¼˜é›…é™çº§ï¼ˆå¦‚ loading æŒ‡ç¤ºå™¨ç­‰ï¼‰ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Suspense &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> OtherComponent = React.lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./OtherComponent'</span>));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Suspense fallback=&#123;&lt;div&gt;Loading...&lt;<span class="regexp">/div&gt;&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;OtherComponent /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/Suspense&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>fallback</code> å±æ€§æ¥å—ä»»ä½•åœ¨ç»„ä»¶åŠ è½½è¿‡ç¨‹ä¸­ä½ æƒ³å±•ç¤ºçš„ React å…ƒç´ ã€‚ä½ å¯ä»¥å°† <code>Suspense</code> ç»„ä»¶ç½®äºæ‡’åŠ è½½ç»„ä»¶ä¹‹ä¸Šçš„ä»»ä½•ä½ç½®ã€‚ä½ ç”šè‡³å¯ä»¥ç”¨ä¸€ä¸ª <code>Suspense</code> ç»„ä»¶åŒ…è£¹å¤šä¸ªæ‡’åŠ è½½ç»„ä»¶ã€‚</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Suspense &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> OtherComponent = React.lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./OtherComponent'</span>));</span><br><span class="line"><span class="keyword">const</span> AnotherComponent = React.lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./AnotherComponent'</span>));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Suspense fallback=&#123;&lt;div&gt;Loading...&lt;<span class="regexp">/div&gt;&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;section&gt;</span></span><br><span class="line"><span class="regexp">          &lt;OtherComponent /</span>&gt;</span><br><span class="line">          &lt;AnotherComponent /&gt;</span><br><span class="line">        &lt;<span class="regexp">/section&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Suspense&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/07/Nodejs%E5%9F%BA%E7%A1%804/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jasonâ€˜s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/07/Nodejs%E5%9F%BA%E7%A1%804/" class="post-title-link" itemprop="url">NodejsåŸºç¡€4</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-07 20:54:01" itemprop="dateCreated datePublished" datetime="2020-06-07T20:54:01+08:00">2020-06-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-30 10:38:46" itemprop="dateModified" datetime="2020-06-30T10:38:46+08:00">2020-06-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/node/" itemprop="url" rel="index"><span itemprop="name">node</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Authentication-and-Authorization"><a href="#Authentication-and-Authorization" class="headerlink" title="Authentication and Authorization"></a>Authentication and Authorization</h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><h3 id="Creating-the-User-Model"><a href="#Creating-the-User-Model" class="headerlink" title="Creating the User Model"></a>Creating the User Model</h3><h3 id="Registering-Users"><a href="#Registering-Users" class="headerlink" title="Registering Users"></a>Registering Users</h3><h3 id="Using-Lodash"><a href="#Using-Lodash" class="headerlink" title="Using Lodash"></a>Using Lodash</h3><h3 id="Hashing-Passwords"><a href="#Hashing-Passwords" class="headerlink" title="Hashing Passwords"></a>Hashing Passwords</h3><h3 id="Authenticating-Users"><a href="#Authenticating-Users" class="headerlink" title="Authenticating Users"></a>Authenticating Users</h3><h3 id="Testing-the-Authentication"><a href="#Testing-the-Authentication" class="headerlink" title="Testing the Authentication"></a>Testing the Authentication</h3><h3 id="JSON-Web-Tokens"><a href="#JSON-Web-Tokens" class="headerlink" title="JSON Web Tokens"></a>JSON Web Tokens</h3><h3 id="Generating-Authentication-Tokens"><a href="#Generating-Authentication-Tokens" class="headerlink" title="Generating Authentication Tokens"></a>Generating Authentication Tokens</h3><h3 id="Storing-Secrets-in-Environment-Variables"><a href="#Storing-Secrets-in-Environment-Variables" class="headerlink" title="Storing Secrets in Environment Variables"></a>Storing Secrets in Environment Variables</h3><h3 id="Setting-Response-Headers"><a href="#Setting-Response-Headers" class="headerlink" title="Setting Response Headers"></a>Setting Response Headers</h3><h3 id="Encapsulating-Logic-in-Mongoose-Models"><a href="#Encapsulating-Logic-in-Mongoose-Models" class="headerlink" title="Encapsulating Logic in Mongoose Models"></a>Encapsulating Logic in Mongoose Models</h3><h3 id="Authorization-Middleware"><a href="#Authorization-Middleware" class="headerlink" title="Authorization Middleware"></a>Authorization Middleware</h3><h3 id="Protecting-Routes"><a href="#Protecting-Routes" class="headerlink" title="Protecting Routes"></a>Protecting Routes</h3><h3 id="Getting-the-Current-User"><a href="#Getting-the-Current-User" class="headerlink" title="Getting the Current User"></a>Getting the Current User</h3><h3 id="Logging-Out-Users"><a href="#Logging-Out-Users" class="headerlink" title="Logging Out Users"></a>Logging Out Users</h3><h3 id="Role-based-Authorization"><a href="#Role-based-Authorization" class="headerlink" title="Role-based Authorization"></a>Role-based Authorization</h3><h3 id="Testing-the-Authorization"><a href="#Testing-the-Authorization" class="headerlink" title="Testing the Authorization"></a>Testing the Authorization</h3><h3 id="Authentication-and-Authorization-Recap"><a href="#Authentication-and-Authorization-Recap" class="headerlink" title="Authentication and Authorization Recap"></a>Authentication and Authorization Recap</h3><h2 id="Handling-and-Logging-Errors"><a href="#Handling-and-Logging-Errors" class="headerlink" title="Handling and Logging Errors"></a>Handling and Logging Errors</h2><h3 id="Introduction-1"><a href="#Introduction-1" class="headerlink" title="Introduction"></a>Introduction</h3><p>ç°åœ¨æˆ‘ä»¬å‡è®¾æˆ‘ä»¬çš„åº”ç”¨æ²¡æœ‰å‘ç”Ÿä»€ä¹ˆé”™è¯¯ï¼Œä½†æ˜¯ too young too simple.ç°å®ç”Ÿæ´»ä¸­ä¼šæœ‰å¾ˆå¤šæ„å¤–ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬æœ€å¥½èƒ½å¤„ç†è¿™äº›æ„å¤–ï¼Œå¹¶å‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªåé¦ˆï¼Œå¹¶æŠŠé”™è¯¯è®°å½•åœ¨æ—¥å¿—é‡Œã€‚</p>
<p>æ¯”å¦‚mongodbå®•æœºäº†1åˆ†é’Ÿï¼Œç°åœ¨æˆ‘ä»¬çš„appæ— æ³•åº”å¯¹è¿™ç§ä¸­æ–­ï¼Œä¹Ÿä¸ä¼šå‘å®¢æˆ·ç«¯æä¾›ä»»ä½•æœåŠ¡ï¼Œç”šè‡³å†æ¢å¤ä¹Ÿä¸è¡Œ</p>
<h3 id="Handling-Rejected-Promises"><a href="#Handling-Rejected-Promises" class="headerlink" title="Handling Rejected Promises"></a>Handling Rejected Promises</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">"/"</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> genres = <span class="keyword">await</span> Genre.find().sort(<span class="string">"name"</span>);</span><br><span class="line">    res.send(genres);</span><br><span class="line">  &#125;<span class="keyword">catch</span>(ex)&#123;</span><br><span class="line">    <span class="comment">//log errors</span></span><br><span class="line">    res.status(<span class="number">500</span>).send(<span class="string">"Something failed"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨mongodbå†å®•æœºçš„æ—¶å€™ï¼Œå°±çœ‹ä¸åˆ° unhandled promise rejectionäº†</p>
<h3 id="Express-Error-Middleware"><a href="#Express-Error-Middleware" class="headerlink" title="Express Error Middleware"></a>Express Error Middleware</h3><p>ä½†æ˜¯ï¼Œæˆ‘ä»¬å¦‚æœå‘ä¿®æ”¹è®°å½•æ—¥å¿—çš„æ–¹å¼æ´»ç€ä¿®æ”¹è¿”å›çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦åˆ°å¤„æ‰¾try catchå¥å—æ”¹ï¼Œéå¸¸éº»çƒ¦</p>
<p>æˆ‘ä»¬å¸Œæœ›æŠŠæ‰€æœ‰çš„é€»è¾‘éƒ½é›†ä¸­èµ·æ¥ï¼Œè¿™æ ·å°±åªéœ€è¦ä¿®æ”¹ä¸€ä¸ªåœ°æ–¹å³å¯ã€‚</p>
<p>è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ä¸­é—´ä»¶å—ï¼Ÿç°åœ¨æˆ‘ä»¬å°±åšä¸€ä¸ªå‘ç°å¼‚å¸¸çš„ä¸­é—´ä»¶</p>
<p>middlewareæ–‡ä»¶å¤¹ä¸­æ–°å»ºä¸€ä¸ªerror.jsï¼Œç„¶åå¤„ç†æˆ‘ä»¬çš„é€»è¾‘</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">err, req, res, next</span>) </span>&#123;</span><br><span class="line">  res.status(<span class="number">500</span>).send(<span class="string">"Something failed"</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>index.jsä¸­æˆ‘ä»¬å¼•å…¥è¿™ä¸ªä¸­é—´é”®æ¨¡å—,ç„¶ååœ¨apiä¹‹ä¸‹å†™è¿™ä¸ªå¼•ç”¨</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(error);</span><br></pre></td></tr></table></figure>
<p>æœ€åä¿®æ”¹genre.js  å½“æˆ‘ä»¬catchåˆ°é”™è¯¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŠŠæ§åˆ¶æƒäº¤ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢æ‰€è¯´çš„error.jså»å¤„ç†</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">"/"</span>, <span class="keyword">async</span> (req, res,next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> genres = <span class="keyword">await</span> Genre.find().sort(<span class="string">"name"</span>);</span><br><span class="line">    res.send(genres);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (ex) &#123;</span><br><span class="line">    next(ex);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Removing-Try-Catch-Blocks"><a href="#Removing-Try-Catch-Blocks" class="headerlink" title="Removing Try Catch Blocks"></a>Removing Try Catch Blocks</h3><p>æˆ‘ä»¬å¯¹ä¸Šé¢çš„ä»£ç ä»ç„¶ä¸å¤ªæ»¡æ„ï¼Œå› ä¸ºæˆ‘ä»¬æ¯æ¬¡éƒ½è¦catchã€‚next å¤ªéº»çƒ¦äº†</p>
<p>æ–°å»ºä¸€ä¸ª asyncä¸­é—´ä»¶</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asyncMiddleware</span>(<span class="params">handler</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> handler(req, res);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ex) &#123;</span><br><span class="line">      next(ex);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨genreä¸­å¼•å…¥å</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">router.get(</span><br><span class="line">  <span class="string">"/"</span>,</span><br><span class="line">  asyncMiddleware(<span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> genres = <span class="keyword">await</span> Genre.find().sort(<span class="string">"name"</span>);</span><br><span class="line">    res.send(genres);</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="Express-Async-Errors"><a href="#Express-Async-Errors" class="headerlink" title="Express Async Errors"></a>Express Async Errors</h3><p>æˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹ä¸€ä¸ªæ¨¡å—ï¼Œè¿™æ ·å°±ä¸ç”¨æ¯æ¬¡å†™asyncMiddleWareäº†ã€‚è¿™ä¸ªæ¨¡å—ä¼šå°†è·¯ç”±å¥æŸ„åŒ…è£¹åœ¨ç±»ä¼¼çš„ä»£ç å½“ä¸­npm i express-async-errors</p>
<p>indexä¸­ï¼Œæˆ‘ä»¬ç›´æ¥å¼•å…¥å³å¯require(â€˜express-async-errorsâ€™) </p>
<p>genre.jsä¸­æˆ‘ä»¬ä¿æŒåŸæ ·ï¼Œä¹Ÿä¸éœ€è¦å¼•å…¥<em>const asyncMiddleware = require(â€œ../middleware/asyncâ€);</em> äº†</p>
<p>ä½†æ˜¯è¿™ä¸ªæ¨¡å—ä»ç„¶æŠŠæˆ‘ä»¬çš„æ§åˆ¶æƒè‡ªåŠ¨è½¬åˆ°äº†é”™è¯¯æ§åˆ¶çš„æ¨¡å—</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">"/"</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> genres = <span class="keyword">await</span> Genre.find().sort(<span class="string">"name"</span>);</span><br><span class="line">  res.send(genres);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Logging-Errors"><a href="#Logging-Errors" class="headerlink" title="Logging Errors"></a>Logging Errors</h3><p>æˆ‘ä»¬éœ€è¦åœ¨æŸå¤„è®°å½•æ—¥å¿—ã€‚åœ¨reactåŸºç¡€è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€morganæ¥è®°å½•æ—¥å¿—ï¼Œè¿™é‡Œæˆ‘ä»¬æ˜¯ç”¨Winston</p>
<p>npm i winstonä¹‹åï¼Œæˆ‘ä»¬å¼•å…¥</p>
<p>const winston = require(â€˜winstonâ€™)</p>
<p>è¿™ä¸ªwinstonæ˜¯è¿™ä¸ªæ¨¡å—ä¸­é»˜è®¤çš„æ—¥å¿—æ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰è®°å½•å™¨ã€‚ä½†è¿™å·²ç»è¶³å¤Ÿäº†</p>
<p><img src="/2020/06/07/Nodejs%E5%9F%BA%E7%A1%804/1.png" style="zoom:80%;"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> winston = <span class="built_in">require</span>(<span class="string">'winston'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">err, req, res, next</span>)</span>&#123;</span><br><span class="line">  winston.error(err.message, err);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// error</span></span><br><span class="line">  <span class="comment">// warn</span></span><br><span class="line">  <span class="comment">// info</span></span><br><span class="line">  <span class="comment">// verbose</span></span><br><span class="line">  <span class="comment">// debug </span></span><br><span class="line">  <span class="comment">// silly</span></span><br><span class="line"></span><br><span class="line">  res.status(<span class="number">500</span>).send(<span class="string">'Something failed.'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Logging-to-MongoDB"><a href="#Logging-to-MongoDB" class="headerlink" title="Logging to MongoDB"></a>Logging to MongoDB</h3><p>å®‰è£…winston-mongodb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">require(&#39;winston-mongodb&#39;);</span><br><span class="line">&#x2F;&#x2F;...</span><br><span class="line">winston.add(winston.transports.MongoDB,&#123;db:&#39;mongodb:&#x2F;&#x2F;localhost&#x2F;vidly&#39;&#125;);</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬è¿˜å¯ä»¥ä¸ºå­˜å‚¨åˆ°mongodbè®¾ç½®ç­‰çº§ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">winston.add(winston.transports.MongoDB,&#123;</span><br><span class="line">		db:&#39;mongodb:&#x2F;&#x2F;localhost&#x2F;vidly&#39;,</span><br><span class="line">		level:&#39;info&#39;&#x2F;&#x2F;infoæ˜¯ç¬¬ä¸‰ç­‰çº§ï¼ŒåŒ…å«errorå’Œwarn</span><br><span class="line">		</span><br><span class="line">		&#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="Uncaught-Exceptions"><a href="#Uncaught-Exceptions" class="headerlink" title="Uncaught Exceptions"></a>Uncaught Exceptions</h3><h3 id="Unhandled-Promise-Rejections"><a href="#Unhandled-Promise-Rejections" class="headerlink" title="Unhandled Promise Rejections"></a>Unhandled Promise Rejections</h3><h3 id="Error-Handling-Recap"><a href="#Error-Handling-Recap" class="headerlink" title="Error Handling Recap"></a>Error Handling Recap</h3><h3 id="Extracting-Routes"><a href="#Extracting-Routes" class="headerlink" title="Extracting Routes"></a>Extracting Routes</h3><h3 id="Extracting-the-Db-Logic"><a href="#Extracting-the-Db-Logic" class="headerlink" title="Extracting the Db Logic"></a>Extracting the Db Logic</h3><h3 id="Extracting-the-Logging-Logic"><a href="#Extracting-the-Logging-Logic" class="headerlink" title="Extracting the Logging Logic"></a>Extracting the Logging Logic</h3><h3 id="Extracting-the-Config-Logic"><a href="#Extracting-the-Config-Logic" class="headerlink" title="Extracting the Config Logic"></a>Extracting the Config Logic</h3><h3 id="Extracting-the-Validation-Logic"><a href="#Extracting-the-Validation-Logic" class="headerlink" title="Extracting the Validation Logic"></a>Extracting the Validation Logic</h3><h3 id="Showing-Unhandled-Exceptions-on-the-Console"><a href="#Showing-Unhandled-Exceptions-on-the-Console" class="headerlink" title="Showing Unhandled Exceptions on the Console"></a>Showing Unhandled Exceptions on the Console</h3><h3 id="Handling-and-Logging-Errors-Recap"><a href="#Handling-and-Logging-Errors-Recap" class="headerlink" title="Handling and Logging Errors Recap"></a>Handling and Logging Errors Recap</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/24/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><span class="page-number current">25</span><a class="page-number" href="/page/26/">26</a><span class="space">&hellip;</span><a class="page-number" href="/page/44/">44</a><a class="extend next" rel="next" href="/page/26/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jason</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">439</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">68</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jason</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

    

  

</body>
</html>
