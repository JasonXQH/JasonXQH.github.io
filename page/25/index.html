<!DOCTYPE html>
<html lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jasonxqh.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Jason‘s Blog">
<meta property="og:url" content="https://jasonxqh.github.io/page/25/index.html">
<meta property="og:site_name" content="Jason‘s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Jason">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://jasonxqh.github.io/page/25/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Jason‘s Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Jason‘s Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/15/leetcode%E6%A0%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/15/leetcode%E6%A0%91/" class="post-title-link" itemprop="url">leetcode树</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-15 09:35:03" itemprop="dateCreated datePublished" datetime="2020-06-15T09:35:03+08:00">2020-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-16 10:01:24" itemprop="dateModified" datetime="2020-06-16T10:01:24+08:00">2020-06-16</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="leetcode树"><a href="#leetcode树" class="headerlink" title="leetcode树"></a>leetcode树</h1><h2 id="简单"><a href="#简单" class="headerlink" title="简单"></a>简单</h2><h3 id="100-相同的树"><a href="#100-相同的树" class="headerlink" title="100  相同的树"></a>100  相同的树</h3><p><img src="/2020/06/15/leetcode%E6%A0%91/2.png" style="zoom:80%;"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">public:</span><br><span class="line">    bool isSameTree(TreeNode* p, TreeNode* q) &#123;</span><br><span class="line">        <span class="comment">//如果p和q都为NULL，那么返回true</span></span><br><span class="line">        <span class="keyword">if</span>(!p &amp;&amp; !q) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		<span class="comment">// p有一个是NULL，一个非空，那么返回false</span></span><br><span class="line">        <span class="keyword">if</span>(!p || !q) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//同时满足 p-&gt;val == q-&gt;val 左子树右子树都相等，才返回true</span></span><br><span class="line">        <span class="keyword">return</span> (p-&gt;val == q-&gt;val) </span><br><span class="line">                &amp;&amp; (isSameTree(p-&gt;left,q-&gt;left) </span><br><span class="line">                &amp;&amp; isSameTree(p-&gt;right,q-&gt;right));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="101-对称二叉树"><a href="#101-对称二叉树" class="headerlink" title="101 对称二叉树"></a>101 对称二叉树</h3><h3 id="104-二叉树的最大深度"><a href="#104-二叉树的最大深度" class="headerlink" title="104 二叉树的最大深度"></a>104 二叉树的最大深度</h3><p><img src="/2020/06/15/leetcode%E6%A0%91/3.png" style="zoom:80%;"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">public:</span><br><span class="line">       int maxDepth(TreeNode* root) &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == NULL) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        int left = maxDepth(root-&gt;left);</span><br><span class="line">        int right = maxDepth(root-&gt;right);</span><br><span class="line">        <span class="keyword">return</span> max(left, right) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="面试4-04-检查平衡性"><a href="#面试4-04-检查平衡性" class="headerlink" title="面试4.04 检查平衡性"></a>面试4.04 检查平衡性</h3><p><img src="/2020/06/15/leetcode%E6%A0%91/1.png" style="zoom:80%;"></p>
<h4 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h4><p>定义一个bool值，然后在深度搜索的时候时刻判断左右子树的高度差是否超过了1</p>
<p>当左右节点等于null的时候，就返回0 ；当左右子树不相等的时候，返回左右子树最大深度加一作为当前节点的深度。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    bool ans = <span class="literal">true</span>;</span><br><span class="line">    int maxDepth(TreeNode* root) &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == NULL) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        int left = maxDepth(root-&gt;left);</span><br><span class="line">        int right = maxDepth(root-&gt;right);</span><br><span class="line">        <span class="keyword">if</span>(abs(left - right) &gt; <span class="number">1</span>) </span><br><span class="line">            ans = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> max(left, right) + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">public:</span><br><span class="line">    bool isBalanced(TreeNode* root) &#123;</span><br><span class="line">        <span class="keyword">if</span>(root == NULL) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        maxDepth(root);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="中等"><a href="#中等" class="headerlink" title="中等"></a>中等</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/" class="post-title-link" itemprop="url">JavaScript数据可视化之D3</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-12 01:00:54" itemprop="dateCreated datePublished" datetime="2020-06-12T01:00:54+08:00">2020-06-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-04-09 23:24:14" itemprop="dateModified" datetime="2025-04-09T23:24:14+08:00">2025-04-09</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="JavaScript数据可视化之D3"><a href="#JavaScript数据可视化之D3" class="headerlink" title="JavaScript数据可视化之D3"></a>JavaScript数据可视化之D3</h1><p>教程：</p>
<p> <a href="https://www.youtube.com/watch?v=_8V5o2UHG0E&amp;list=WL&amp;index=6&amp;t=202s" target="_blank" rel="noopener">https://www.youtube.com/watch?v=_8V5o2UHG0E&amp;list=WL&amp;index=6&amp;t=202s</a></p>
<p>网站：<a href="https://vizhub.com/" target="_blank" rel="noopener">https://vizhub.com/</a></p>
<p>教程2：<a href="https://www.bilibili.com/video/BV1HK411L72d?p=1" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1HK411L72d?p=1</a></p>
<p>源码： <a href="https://github.com/Shao-Kui/D3.js-Demos" target="_blank" rel="noopener">https://github.com/Shao-Kui/D3.js-Demos</a></p>
<p>文档：<a href="https://github.com/d3/d3/wiki" target="_blank" rel="noopener">https://github.com/d3/d3/wiki</a></p>
<p><strong>了解以下标签即可</strong></p>
<p>•<code>&lt;html&gt;</code>：最外层的主标签，每个HTML文件都需要有！</p>
<p>•<code>&lt;head&gt;</code>: 标题内容，包含HTML的文件链接、标题等</p>
<p>•<code>&lt;body&gt;</code>：HTML的主体，包括各种其中的各种元素</p>
<p>•<code>&lt;title&gt;</code>：标题（显示在浏览器的标签栏）</p>
<p>•<code>&lt;script&gt;</code>：JavaScript脚本或对于脚本的链接•D3.js的编程主要写在此标签中</p>
<p>•<code>&lt;svg&gt;</code>: 对于D3最为重要的标签，主要操作的对象（见下页）</p>
<p>•<code>&lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/style.css&quot;&gt;</code></p>
<p> •<code>&lt;!DOCTYPEhtml&gt;</code></p>
<p>•所有标签都需要以<code>&lt;/tag&gt;</code>结束</p>
<p>D3: Data-Driven Documents</p>
<p>和python 的数据可视化和R语言不同，D3是把数据可视化展示在web上的，还可以创建用户交互等等</p>
<h2 id="Loading-D3-js"><a href="#Loading-D3-js" class="headerlink" title="Loading D3.js"></a>Loading D3.js</h2><p>我们可以之间 在d3的文档上找 <a href="https://github.com/d3/d3/wiki/CN-Home" target="_blank" rel="noopener">https://github.com/d3/d3/wiki/CN-Home</a></p>
<p>也可以在<a href="https://unpkg.com上找" target="_blank" rel="noopener">https://unpkg.com上找</a> 引入d3 的script</p>
<p>直接<code>&lt;script src=&quot;https://d3js.org/d3.v5.min.js&quot;&gt;&lt;/script&gt;</code></p>
<p>或者<code>&lt;script src=&quot;https://unpkg.com/d3@5.6.0/dist/d3.min.js&quot;&gt;&lt;/script&gt;</code></p>
<p>也可以通过本地服务器链接</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Let's make a face with D3.js<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"style.css"</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://unpkg.com/d3@5.6.0/dist/d3.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--       &lt;script src="https://d3js.org/d3.v3.min.js"&gt;&lt;/script&gt; </span></span><br><span class="line"><span class="comment">			注意，这里要写https不要写http</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">"960"</span> <span class="attr">height</span> =<span class="string">"500"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">          	<span class="keyword">const</span> svg = d3.select(<span class="string">'svg'</span>);</span></span><br><span class="line"><span class="actionscript">              <span class="comment">//我们把背景颜色设置为 red看看效果</span></span></span><br><span class="line"><span class="actionscript">            svg.style(<span class="string">'background-color'</span>,<span class="string">'red'</span>);</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span> <span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/7.png" style="zoom:40%;"></p>
<h4 id="对D3有一个大体的了解"><a href="#对D3有一个大体的了解" class="headerlink" title="对D3有一个大体的了解"></a>对D3有一个大体的了解</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Data Visualization!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://d3js.org/d3.v5.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">"960"</span> <span class="attr">height</span>=<span class="string">"500"</span> <span class="attr">id</span>=<span class="string">"mainsvg"</span> <span class="attr">class</span>=<span class="string">"svgs"</span>&gt;</span><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">      <span class="comment">//这段代码是在屏幕上绘制一个最简单的圆</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> mainsvg = d3.select(<span class="string">'.svgs'</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> maingroup = mainsvg</span></span><br><span class="line"><span class="actionscript">      .append(<span class="string">'g'</span>)</span></span><br><span class="line"><span class="javascript">      .attr(<span class="string">'transform'</span>, <span class="string">`translate(<span class="subst">$&#123;<span class="number">100</span>&#125;</span>, <span class="subst">$&#123;<span class="number">100</span>&#125;</span>)`</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> circle = maingroup</span></span><br><span class="line"><span class="actionscript">      .append(<span class="string">'circle'</span>)</span></span><br><span class="line"><span class="actionscript">      .attr(<span class="string">'stroke'</span>, <span class="string">'black'</span>)</span></span><br><span class="line"><span class="actionscript">      .attr(<span class="string">'r'</span>, <span class="string">'66'</span>)</span></span><br><span class="line"><span class="actionscript">      .attr(<span class="string">'fill'</span>, <span class="string">'yellow'</span>);</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/8.png" style="zoom:80%;"></p>
<p>•在HTML中查找并获取SVG</p>
<p>•在SVG中加入组（Group）<code>&lt;g&gt;</code></p>
<p>•设置组的平移为向下、向右个100像素</p>
<p>•在主要组中加入一个圆</p>
<p>•圆的边框为黑色</p>
<p>•圆的半径为66像素</p>
<p>•圆的填充颜色为黄色</p>
<h2 id="Intro"><a href="#Intro" class="headerlink" title="Intro"></a>Intro</h2><h3 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h3><h4 id="Header-Title"><a href="#Header-Title" class="headerlink" title="Header Title"></a>Header Title</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>HTML Cars Report<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="Bulleted-list"><a href="#Bulleted-list" class="headerlink" title="Bulleted list"></a>Bulleted list</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Cars Report<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"highlighted"</span>&gt;</span>2012 Nissan Leaf: $1800<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>2009 Ford F150: $1950<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>2009 Chevrolet Trailblazer: $1550<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span> <span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/1.png" style="zoom:90%;"></p>
<h3 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h3><h4 id="Customisze-Font-amp-Highlight-an-item"><a href="#Customisze-Font-amp-Highlight-an-item" class="headerlink" title="Customisze Font &amp; Highlight an item"></a>Customisze Font &amp; Highlight an item</h4><p>style.css 这是css选择器</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">2em</span>;</span><br><span class="line">  <span class="attribute">font-family</span>: monospace;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.highlighted</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>index.html中引入，用link标签</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>HTML Cars Report<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"style.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--&lt;body...&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span> <span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/2.png" style="zoom:90%;"></p>
<h3 id="SVG-可缩放矢量图形"><a href="#SVG-可缩放矢量图形" class="headerlink" title="SVG 可缩放矢量图形"></a>SVG 可缩放矢量图形</h3><h4 id="SVG-as-Image-Format"><a href="#SVG-as-Image-Format" class="headerlink" title="SVG as Image Format"></a>SVG as Image Format</h4><p>.svg 不会像素化 无论怎么放大，都是很清晰的</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/3.png" style="zoom:40%;"></p>
<p>相反，png会像素化，放大会失真会模糊</p>
<h4 id="SVG-in-HTML"><a href="#SVG-in-HTML" class="headerlink" title="SVG in HTML"></a>SVG in HTML</h4><p>coordinate system,circles,rectangles,lines, colors,groups</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Shapes with SVG and CSS<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"style.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">"960"</span> <span class="attr">height</span> =<span class="string">"500"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">把所有的svg放在一个group中，整体设置大小为原来的1.5倍&lt;g transform = "scale(1.5)"&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">第一行的圆形我们可以用cx和cy确定圆心坐标， r代表了半径</span></span><br><span class="line"><span class="comment">第二行的rectangle是正方形，x，y代表着他的左上角顶点坐标</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">第三行的圆我们添加了颜色， 用fill = "" 来定义颜色</span></span><br><span class="line"><span class="comment">第四行第五行我们可以在fill中加入多种格式的颜色 rgb(),#...</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">还可以把图片放到一个group里，通过group参数设置 transform="translate()"代表坐标，fill填充</span></span><br><span class="line"><span class="comment">如果group中的某一组件本身具有fill填充，会覆盖group中的fill</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">stroke代表边框或者线的颜色，stroke-width 代表线的粗细</span></span><br><span class="line"><span class="comment">我们可以定义&lt;line&gt;&lt;/line&gt;为一条线</span></span><br><span class="line"><span class="comment">我们还可以定义&lt;path&gt;&lt;/path&gt; 这是一条路线</span></span><br><span class="line"><span class="comment">M300 280代表我们move to(300,280) 这个点</span></span><br><span class="line"><span class="comment">L350 200代表我们画一条线从(300,280)指向(350,200)以此类推</span></span><br><span class="line"><span class="comment">--&gt;</span>            </span><br><span class="line">          <span class="tag">&lt;<span class="name">g</span> <span class="attr">transform</span> = <span class="string">"scale(1.5)"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">circle</span> <span class="attr">cx</span>=<span class="string">"50"</span> <span class="attr">cy</span>=<span class="string">"50"</span> <span class="attr">r</span>=<span class="string">"40"</span>&gt;</span><span class="tag">&lt;/<span class="name">circle</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rect</span> <span class="attr">x</span>=<span class="string">"100"</span> <span class="attr">y</span>=<span class="string">"25"</span> <span class="attr">width</span> = <span class="string">"50"</span> <span class="attr">height</span>=<span class="string">"50"</span>&gt;</span><span class="tag">&lt;/<span class="name">rect</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">circle</span> <span class="attr">cx</span>=<span class="string">"50"</span> <span class="attr">cy</span>=<span class="string">"150"</span> <span class="attr">r</span>=<span class="string">"40"</span> <span class="attr">fill</span>=<span class="string">"blue"</span>&gt;</span><span class="tag">&lt;/<span class="name">circle</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rect</span> <span class="attr">x</span>=<span class="string">"100"</span> <span class="attr">y</span>=<span class="string">"125"</span> <span class="attr">width</span> = <span class="string">"50"</span> <span class="attr">height</span>=<span class="string">"50"</span> <span class="attr">fill</span>=<span class="string">"#40b842"</span>&gt;</span><span class="tag">&lt;/<span class="name">rect</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">rect</span> <span class="attr">x</span>=<span class="string">"100"</span> <span class="attr">y</span>=<span class="string">"225"</span> <span class="attr">width</span> = <span class="string">"50"</span> <span class="attr">height</span>=<span class="string">"50"</span> <span class="attr">fill</span>=<span class="string">"rgb(33, 14, 180)"</span>&gt;</span><span class="tag">&lt;/<span class="name">rect</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">g</span> <span class="attr">transform</span>= <span class="string">"translate(0,200)"</span> <span class="attr">fill</span>=<span class="string">"pink"</span> <span class="attr">stroke</span>=<span class="string">"black"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">circle</span> <span class="attr">cx</span>=<span class="string">"50"</span> <span class="attr">cy</span>=<span class="string">"150"</span> <span class="attr">r</span>=<span class="string">"40"</span> <span class="attr">stroke-width</span>=<span class="string">"5"</span> &gt;</span><span class="tag">&lt;/<span class="name">circle</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">rect</span> <span class="attr">x</span>=<span class="string">"100"</span> <span class="attr">y</span>=<span class="string">"125"</span> <span class="attr">width</span> = <span class="string">"50"</span> <span class="attr">height</span>=<span class="string">"50"</span>&gt;</span><span class="tag">&lt;/<span class="name">rect</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">g</span> <span class="attr">class</span> = <span class="string">"lines"</span> <span class="attr">transform</span>=<span class="string">"translate(50,0)"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">line</span> <span class="attr">x1</span>=<span class="string">"200"</span> <span class="attr">y1</span>=<span class="string">"20"</span> <span class="attr">x2</span>=<span class="string">"300"</span> <span class="attr">y2</span>=<span class="string">"280"</span>&gt;</span><span class="tag">&lt;/<span class="name">line</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">path</span>  <span class="attr">fill</span>=<span class="string">"none"</span> <span class="attr">d</span>=<span class="string">"M300 280 L350 200 L450 250 L450 400"</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span> <span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>style.css 我们把lines定义成黑色，宽度为10，line中的path属性定义成这个颜色。</p>
<p><strong><code>stroke-linejoin</code></strong> 属性指明路径的转角处使用的形状或者绘制的基础形状。<a href="https://developer.mozilla.org/zh-CN/docs/Web/SVG/Attribute/stroke-linejoin" target="_blank" rel="noopener">developer.mozila.org</a></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123; </span><br><span class="line"> 	<span class="attribute">margin</span>:<span class="number">0px</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.highlighted</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.lines</span>&#123;</span><br><span class="line">  <span class="attribute">stroke</span>:black;</span><br><span class="line">  <span class="attribute">stroke-width</span>:<span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.lines</span> <span class="selector-tag">path</span>&#123;</span><br><span class="line">  <span class="attribute">stroke</span>: <span class="number">#25656d</span> ;</span><br><span class="line">  <span class="attribute">stroke-linejoin</span>: round;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>miter,round,bevel,miter-clip,arcs</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/4.png" style="zoom:40%;"></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/6.png" style="zoom:80%;"></p>
<h3 id="Js-D3的常用接口"><a href="#Js-D3的常用接口" class="headerlink" title="Js D3的常用接口"></a>Js D3的常用接口</h3><p>•console.log(‘hello world! ’);</p>
<p>•数组a = [1, 2, 3]</p>
<p>•对象a = {name: ‘Shao-Kui’, age: 24.3, lab: ‘cscg’}</p>
<p>•D3数据可视化中常见对象数组，如：</p>
<p>​     •a = [{name: ‘Shao-Kui’, age: 24.3, dept: ‘cs’},</p>
<pre><code> •{name: ‘Wen-Yang’, age: 23, dept: ‘cs’},
</code></pre><p>​     •{name: ‘Yun’, age: 18😏, dept: ‘art’}]</p>
<p>•数组的排序a.sort()</p>
<p>•可加入回调函数来替代缺省的排序方案，如对日期排序</p>
<p>•a.sort(function(a,b){ return new Date(b.date) -new Date(a.date); }</p>
<p>•数组的查询a.find( d =&gt; d.name === ‘Wen-Yang’)</p>
<p>•把字符串转换成数值：+(‘3.14’)</p>
<p>•D3.js经常读取CSV文件，届时会涉及大量的数组、对象的操作！</p>
<h3 id="Flask-Why？"><a href="#Flask-Why？" class="headerlink" title="Flask - Why？"></a>Flask - Why？</h3><p>•为什么需要一个后台（服务器）？</p>
<p>​    •CORS (Cross Origin Resource Sharing)</p>
<p>•可否用一个完整的.html文件编程</p>
<p>​    •完全可以，但数据处理、链接d3.js库、链接.js、链接.css文件会非常麻烦！</p>
<p>•对于没有WEB开发经验的同学，本课程对D3.js和可视化以外的工程不做要求：</p>
<p>​    •提供默认调通的客户端-服务器框架</p>
<p>​    •仅需要了解后续的内容，对服务器进行配置并运行即可</p>
<p>​    •推荐有web经验的同学搭建自己熟悉的环境</p>
<p>利用服务器我们可以设置路由，然后当我们输入链接会显示相应html文件</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/9.png" style="zoom:80%;"></p>
<p>我们需要下载 flask_cors 涉及到跨域访问的问题.启动了这个flask后，我们输入 nCovnxt，显示了这样一个D3</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/10.png" style="zoom:80%;"></p>
<p>我们可以很简单的在Flask中申请一个路由</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/stack_histogram')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">stack_histogram</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> flask.send_from_directory(<span class="string">'static'</span>, <span class="string">'stack_histogram.html'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="Hello-D3"><a href="#Hello-D3" class="headerlink" title="Hello D3"></a>Hello D3</h2><h3 id="D3获取修改删除节点"><a href="#D3获取修改删除节点" class="headerlink" title="D3获取修改删除节点"></a>D3获取修改删除节点</h3><h4 id="D3查询SVG"><a href="#D3查询SVG" class="headerlink" title="D3查询SVG"></a>D3查询SVG</h4><p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/11.png" style="zoom: 67%;"></p>
<p>比如我们新建了这个demo，里面各个图形有他的id</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/1.jpg" style="zoom: 67%;"></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/12.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/13.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/14.png" style="zoom: 67%;"></p>
<p>除了基于单纯的id和class来进行索引，我们还可以通过层级查询来进行索引</p>
<p>比如下面有一堆父节点，那么我们先用 <code>#maingroup</code>找到父节点，然后再在里面找到rect子节点</p>
<p>或者我找到所有 class = “tick” 的父节点，然后去下面找text的子节点</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/15.png" style="zoom: 80%;"></p>
<p>class索引某个子集，id索引某个特定的元素</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/16.png" style="zoom: 80%;"></p>
<p>元素的 Class ：人为赋予的“类别”可以标记元素集合， 其中的元素标签可以不相同 ！</p>
<p>比如我可以利用class 筛选这rect1，rect2，circle1 这三个图型，因为他们的class相同 ，id可以不同</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/17.png" style="zoom: 80%;"></p>
<h4 id="使用D3-设置SVG中的属性"><a href="#使用D3-设置SVG中的属性" class="headerlink" title="使用D3 设置SVG中的属性"></a>使用D3 设置SVG中的属性</h4><p>尽可能记住常用的属性</p>
<p>现查现用！<a href="https://developer.mozilla.org/zh-CN/docs/Web/SVG/Attribute" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/SVG/Attribute</a></p>
<p> <img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/18.png" style="zoom: 80%;"></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/19.png" style="zoom: 80%;"></p>
<p>比如我们在chrome中修改一个柱体，那么我们先 选择rect2，然后利用attr把柱体的颜色改成黑色</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/20.png" style="zoom: 80%;"></p>
<p>利用selectAll把一个类中的所有对象全部选择，然后填充黄色</p>
<h5 id="transform"><a href="#transform" class="headerlink" title="transform"></a>transform</h5><p><strong>translate</strong></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/21.png" style="zoom: 80%;"></p>
<p><strong>rotate</strong></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/22.png" style="zoom: 80%;"></p>
<p><strong>scale</strong></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/23.png" style="zoom: 80%;"></p>
<h5 id="element-attr"><a href="#element-attr" class="headerlink" title="element.attr"></a>element.attr</h5><p>前面的参数是图元的属性名称，后面一个是要设置的值</p>
<p> <img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/24.png" style="zoom: 80%;"></p>
<h5 id="活用-节点"><a href="#活用-节点" class="headerlink" title="活用 \节点"></a>活用 \<g\>节点</g\></h5><p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/25.png" style="zoom: 80%;"></p>
<p>子节点的属性设置都是在父节点的基础上进行设置</p>
<h4 id="添加和删除元素"><a href="#添加和删除元素" class="headerlink" title="添加和删除元素"></a>添加和删除元素</h4><p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/26.png" style="zoom: 80%;"></p>
<p>append后面写的是添加什么类型的图元</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d3.select(<span class="string">'#maingroup'</span>).append(<span class="string">'rect'</span>).attr(<span class="string">'width'</span>,<span class="number">100</span>).attr(<span class="string">'height'</span>,<span class="number">100</span>);</span><br></pre></td></tr></table></figure>
<p>我如果想删除一个图元，那么</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d3.select(<span class="string">'#rect1'</span>).remove();</span><br></pre></td></tr></table></figure>
<p>无论是添加或还是删除，都需要先查询，再做操作</p>
<h3 id="margin"><a href="#margin" class="headerlink" title="margin"></a>margin</h3><p>首先还要了解一下<strong>margin</strong></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/31.png" style="zoom: 50%;"></p>
<p>margin就是边框</p>
<p>SVG对于D3.js是一个“画布”，SVG范围外的任何内容属于画布之外，浏览器将不予显示</p>
<p>定义Margin:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> margin = &#123;<span class="attr">top</span>: <span class="number">60</span>, <span class="attr">right</span>: <span class="number">30</span>, <span class="attr">bottom</span>: <span class="number">60</span>, <span class="attr">left</span>: <span class="number">200</span>&#125;</span><br></pre></td></tr></table></figure>
<p>计算实际操作的 inner 长/宽</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> innerWidth = width - margin.left - margin.right;</span><br><span class="line"><span class="keyword">const</span> innerHeight = height - margin.top - margin.bottom;</span><br></pre></td></tr></table></figure>
<p>在SVG下额外定义一个组作为新的根节点</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> g = svg.append(<span class="string">'g'</span>).attr(<span class="string">'id'</span>, <span class="string">'maingroup'</span>)</span><br><span class="line">attr(<span class="string">'transform'</span>, <span class="string">`translate(<span class="subst">$&#123;margin.left&#125;</span>, <span class="subst">$&#123;margin.top&#125;</span>)`</span>);</span><br></pre></td></tr></table></figure>
<h3 id="比例尺"><a href="#比例尺" class="headerlink" title="比例尺"></a>比例尺</h3><p>•    比例尺用于把实际的数据空间映射到屏幕的空间<br>•    比例尺非常重要，会经常同时传给坐标轴与数据</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/27.png" style="zoom: 50%;"></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/2.jpg" style="zoom: 50%;"></p>
<p>线性的比例尺</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> xScale = d3.scaleLinear()</span><br><span class="line"><span class="comment">//domain就是原比例</span></span><br><span class="line">				 .domain([min_d, max_d]).</span><br><span class="line"><span class="comment">//range就是缩放后的比例尺</span></span><br><span class="line"><span class="comment">//range和domain都必须传入一个数组</span></span><br><span class="line">				 .range([min, max]);</span><br><span class="line"><span class="keyword">const</span> xScale = d3.scaleLinear()</span><br><span class="line">				 .domain([<span class="number">0</span>, d3.max(data, datum=&gt;datum.value)])</span><br><span class="line">				 .range([<span class="number">0</span>, innerWidth]);</span><br></pre></td></tr></table></figure>
<p>d3.max(数据，回调：如何提取数据的值)<br>d3.max: 求出数据某一属性的最大值，比如年龄的最大值</p>
<p> from Data Space to Screen Space</p>
<p>​                               <img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/3.jpg" style="zoom: 50%;"><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/4.jpg" style="zoom: 50%;"></p>
<p>柱状的比例尺 ：对应离散的变量</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/29.png" style="zoom: 90%;"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> yScale = d3.scaleBand() </span><br><span class="line">				 .domain(list)</span><br><span class="line">				 .range([min, max])</span><br><span class="line">				 .padding(p);</span><br><span class="line"><span class="keyword">const</span> yScale = d3.scaleBand()</span><br><span class="line">				 .domain(data.map(<span class="function"><span class="params">datum</span> =&gt;</span> datum.name)) </span><br><span class="line">				 .range([<span class="number">0</span>, innerHeight])</span><br><span class="line">			  	 .padding(<span class="number">0.1</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>通过d3.scaleLinear或d3.scaleBand得到的返回值本质上是函数<ul>
<li>给出数据中的值（domain)</li>
<li>返回映射后的值（range）</li>
<li>.domain(…)和.range(…)可以理解为配置这个函数（功能）的过程</li>
</ul>
</li>
<li>比例尺的定义仍适用链式调用</li>
<li>坐标轴实际上是一个映射函数，我可以把我domain中的连续的或者离散的数据映射到图标当中</li>
</ul>
<h3 id="坐标轴"><a href="#坐标轴" class="headerlink" title="坐标轴"></a>坐标轴</h3><h4 id="引入坐标轴"><a href="#引入坐标轴" class="headerlink" title="引入坐标轴"></a>引入坐标轴</h4><ul>
<li>一个坐标轴为一个group（<code>&lt;g&gt;</code>），通常我们需要两个坐标轴</li>
<li>坐标轴中包含：<ul>
<li>一个 <code>&lt;path&gt;</code>用于横跨坐标轴的覆盖范围</li>
<li>若干个刻度<ul>
<li>每个刻度也是一个group</li>
</ul>
</li>
<li>每个刻度下属还会包含一个<code>&lt;line&gt;</code> 和一个<code>&lt;text&gt;</code> <ul>
<li><code>&lt;line&gt;</code> 用于展示坐标轴的轴线，如左到右或上到下</li>
<li>​    <code>&lt;text&gt;</code> 用于展示坐标轴的刻度值，如实数、姓名、日期</li>
</ul>
</li>
<li>（可选）一个标签用以描述坐标轴</li>
</ul>
</li>
<li>定义坐标轴（获得结果是函数）：<br>•    const yAxis = d3.axisLeft(yScale);<br>•    const xAxis = d3.axisBottom(xScale);<br>•    axisLeft: 左侧坐标轴<br>•    axisBotton: 右侧坐标轴</li>
<li>实际配置坐标轴：<br>•    const yAxisGroup = g.append(‘g’).call(yAxis);<br>•    const xAxisGroup = g.append(‘g’).call(xAxis)</li>
<li>实际配置后会发现 <code>&lt;g&gt;</code>中增添了与坐标轴相关的元素</li>
<li>任何坐标轴在初始化之后会默认放置在坐标原点，需要进一步的平移</li>
<li><p>关于 selection.call(…)</p>
<ul>
<li>函数的输入为另一个函数</li>
<li>另一个函数以selection的图元作为输入</li>
<li>另一个函数中会根据函数体的内容修改selection对应的图元</li>
</ul>
</li>
<li>下面的代码的意思就是告诉坐标轴他该怎么使用这个而比例尺<br>•    const yAxis = d3.axisLeft(yScale);<br>•    const yAxisGroup = g.append(‘g’).call(yAxis);</li>
<li>​    对函数式编程敏感有助于学习D3 &amp; 理解D3的代码！</li>
</ul>
<h4 id="配置坐标轴"><a href="#配置坐标轴" class="headerlink" title="配置坐标轴"></a>配置坐标轴</h4><ul>
<li>可以对坐标轴的风格进行修改：d3.selectAll(‘.tick text’).attr(‘font-size’, ‘2em’);</li>
<li>.tickSize来设置网格线</li>
<li>坐标轴的标签加入不在D3接口的负责范围内：<br>•    通过对应组 .append(‘text’)来人为实现<br>•    （左）纵轴坐标需要 .attr(‘transform’, ‘rotate(-90)’) 来旋转<br>•    纵轴坐标旋转后，x / y 会颠倒甚至取值范围相反<br>•    回忆DOM：父节点的属性会影响子节点，而坐标轴默认的’fill’属性是 ‘none’，因此请一定手动设置文字颜色 .attr(‘fill’, ‘black’)</li>
</ul>
<h2 id="Data-Join"><a href="#Data-Join" class="headerlink" title="Data-Join"></a>Data-Join</h2><p>我们能不能把添加和修改图元自动化？</p>
<ul>
<li>Data-Join 的本质上 是将数据与图元进行绑定<ul>
<li>每个国家的人数绑定到矩形的长度</li>
<li>疫情感染的人数比例绑定到圆的半径</li>
</ul>
</li>
<li><p>Why?</p>
<ul>
<li>使用Data-Join可以省去大量根据数据设置图元属性的代码量</li>
<li>对于<strong>动态变化的数据</strong>提供统一接口</li>
</ul>
</li>
<li><p>以数据为中心的可视化操作<br>•    根据数据的每个属性自动调整绑定图元的属性</p>
</li>
<li>不再需要手动添加、‘修改’、删除图元<br>•    会根据Data-Join的绑定自动推断</li>
<li>如果图元的数目不等于数据的条目？<br>•    根据数据条目的数量选定相应数量的图元</li>
</ul>
<h3 id="用函数设置图元属性"><a href="#用函数设置图元属性" class="headerlink" title="用函数设置图元属性"></a>用函数设置图元属性</h3><ul>
<li>回忆使用.attr设置图元属性</li>
<li>selection.attr(‘attrbuteName’, ‘value’)<br>•    支持直接通过值来设置属性<br>•    支持通过函数来设置属性</li>
<li>selection.attr(‘attrbuteName’, (d, i) =&gt; {…})<br>•    d为绑定给图元的数据（即将到来）<br>•    i为图元的索引，是一个整数，如d3.selectAll(‘rect’)中的第几个矩形<br>•    函数也可以仅使用 d =&gt; {…}，但此时函数体无法使用索引<br>•    即使不使用绑定的数据（如没有绑定数据），如需使用索引，仍需要完整的写出 (d, i) =&gt; {…}</li>
</ul>
<h3 id="数据与图元的绑定"><a href="#数据与图元的绑定" class="headerlink" title="数据与图元的绑定"></a>数据与图元的绑定</h3><ul>
<li>.data( dataArray )</li>
<li>dataArray在保证是一个数组的前提下可以是任何形式<br>•    e.g., [0, 2, 5, 6, 233, 666, 384, 32, 18]<br>•    e.g., [{name: ‘Sebastian’, value:384}, {name:’ Ciel’, value:32},{name:’Cai Yun’, value:16}]</li>
<li>先考虑数据和图元数目相同的情况：<br>•    dataArray是一个数组，其中的每‘条’数据会与一个图元绑定（反之亦然）</li>
<li>绑定给每个图元的数据将对应 .attr(, (d, i) =&gt; {…}) 中的 d</li>
<li>默认的绑定按照双方的索引顺序</li>
<li>不调用.data(…)，则图元不会与任何数据绑定！</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">      <span class="keyword">const</span> data = [&#123;<span class="attr">name</span>: <span class="string">'Shao-Kui'</span>, <span class="attr">value</span>:<span class="number">6</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Wen-Yang'</span>, <span class="attr">value</span>:<span class="number">6</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Cai Yun'</span>, <span class="attr">value</span>:<span class="number">16</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Liang Yuan'</span>, <span class="attr">value</span>: <span class="number">10</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Yuan-Chen'</span>, <span class="attr">value</span>:<span class="number">6</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Rui-Long'</span>, <span class="attr">value</span>:<span class="number">10</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Dong Xin'</span>, <span class="attr">value</span>:<span class="number">12</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'He Yu'</span>, <span class="attr">value</span>:<span class="number">20</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Xiang-Li'</span>, <span class="attr">value</span>:<span class="number">12</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Godness'</span>, <span class="attr">value</span>:<span class="number">20</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Wei-Yu'</span>, <span class="attr">value</span>:<span class="number">15</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Chen Zheng'</span>, <span class="attr">value</span>:<span class="number">14</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Yu Peng'</span>, <span class="attr">value</span>:<span class="number">15</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Li Jian'</span>, <span class="attr">value</span>:<span class="number">18</span>&#125;]; </span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data1 = [&#123;<span class="attr">name</span>: <span class="string">'Shao-Kui'</span>, <span class="attr">value</span>:<span class="number">12</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Wen-Yang'</span>, <span class="attr">value</span>:<span class="number">13</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Cai Yun'</span>, <span class="attr">value</span>:<span class="number">16</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Liang Yuan'</span>, <span class="attr">value</span>: <span class="number">10</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Yuan-Chen'</span>, <span class="attr">value</span>:<span class="number">6</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Rui-Long'</span>, <span class="attr">value</span>:<span class="number">10</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Dong Xin'</span>, <span class="attr">value</span>:<span class="number">12</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'He Yu'</span>, <span class="attr">value</span>:<span class="number">20</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Xiang-Li'</span>, <span class="attr">value</span>:<span class="number">12</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Godness'</span>, <span class="attr">value</span>:<span class="number">20</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Wei-Yu'</span>, <span class="attr">value</span>:<span class="number">15</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Chen Zheng'</span>, <span class="attr">value</span>:<span class="number">14</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Yu Peng'</span>, <span class="attr">value</span>:<span class="number">15</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Li Jian'</span>, <span class="attr">value</span>:<span class="number">18</span>&#125;]; </span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> data2 = [&#123;<span class="attr">name</span>: <span class="string">'Wen-Yang'</span>, <span class="attr">value</span>:<span class="number">15</span>&#125;,</span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Shao-Kui'</span>, <span class="attr">value</span>:<span class="number">20</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Cai Yun'</span>, <span class="attr">value</span>:<span class="number">16</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Yuan-Chen'</span>, <span class="attr">value</span>: <span class="number">10</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Liang Yuan'</span>, <span class="attr">value</span>:<span class="number">6</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Rui-Long'</span>, <span class="attr">value</span>:<span class="number">10</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Dong Xin'</span>, <span class="attr">value</span>:<span class="number">12</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'He Yu'</span>, <span class="attr">value</span>:<span class="number">20</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Xiang-Li'</span>, <span class="attr">value</span>:<span class="number">12</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Godness'</span>, <span class="attr">value</span>:<span class="number">20</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Wei-Yu'</span>, <span class="attr">value</span>:<span class="number">15</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Chen Zheng'</span>, <span class="attr">value</span>:<span class="number">14</span>&#125;, </span><br><span class="line">      &#123;<span class="attr">name</span>:<span class="string">'Yu Peng'</span>, <span class="attr">value</span>:<span class="number">15</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">'Li Jian'</span>, <span class="attr">value</span>:<span class="number">18</span>&#125;];</span><br></pre></td></tr></table></figure>
<p>如上面我定义了data1，data2，我如果想把data1中的数据渲染在图表上去替换data中的数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">'rect'</span>).data(data1).attr(<span class="string">'width'</span>,d=&gt; xScale(d.value));</span><br></pre></td></tr></table></figure>
<p>但是我如果这样来改，就会出现问题了。因为默认的data函数根据index来索引的，如果我给出的数据的顺序发生了变化，我们还是从第一个到最后一个去索引</p>
<p>那么这样data2中Wen-Yang的数据就会绑定到Shao-Kui上去。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">'rect'</span>).data(data1).attr(<span class="string">'width'</span>,d=&gt; xScale(d.value));</span><br></pre></td></tr></table></figure>
<h3 id="Key"><a href="#Key" class="headerlink" title="Key"></a>Key</h3><ul>
<li>.data(data, keyFunction)<br>•    keyFunction的返回值通常是一个字符串（string）<br>•    keyFunction的定义根据数据，比如 keyFunction = d =&gt; d.name</li>
<li>在绑定数据给图元时：<br>•    keyFunction为每条输入绑定的数据执行一次<br>•    keyFunction为每个包含数据的图元执行一次</li>
<li>如果图元之前没有绑定过任何数据，则keyFunction会报错！<br>•    第一次绑定时根据索引即可<br>•    实际的可视化任务，图元都是根据数据的‘条’数动态添加（enter）、删除（exit），只需要在添加时指定好DOM的ID即可</li>
</ul>
<p>所以我们需要手动的把key值加到数据中去。</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/32.png" style="zoom: 100%;"></p>
<p>这里，因为数据中的name都是不一样的，所以我们可以把name设置为key :data(data2,d=&gt;d.name)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">'rect'</span>).data(data2,d=&gt;d.name).attr(<span class="string">'width'</span>,d=&gt; xScale(d.value));</span><br></pre></td></tr></table></figure>
<p>现在的值就变得正常了。</p>
<p>也就是用data来绑定数据，用key来进行索引</p>
<h3 id="Enter-Update-Exit"><a href="#Enter-Update-Exit" class="headerlink" title="Enter Update Exit"></a>Enter Update Exit</h3><ul>
<li>D3.js绑定数据的三个‘状态’</li>
<li>Update<br>•    图元和数据条目相同，之前的介绍均为单纯的update</li>
<li>Enter<br>•    数据的条目多于图元甚至没有图元，常用于第一次绑定数据</li>
<li>Exit<br>•    数据的条目少于图元甚至没有数据，常用于结束可视化</li>
</ul>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/33.png" style="zoom: 100%;"></p>
<h4 id="Enter"><a href="#Enter" class="headerlink" title="Enter"></a>Enter</h4><ul>
<li>有数据没图元</li>
<li>D3.js会自动‘搞清楚’哪些数据是新增的</li>
<li>根据新增的数据生成相应的图元</li>
<li>生成图元的占位，占位的内容需要编程者自行添加（append）</li>
<li>const p = maingroup.selectAll(‘.class’).data(data).enter().append(‘’).attr(…)<ul>
<li>相当于我调用data的时候，selectAll中的内容都是空的，然后我们可以向里面添加什么样的图元，设置什么样的属性</li>
</ul>
</li>
<li>enter本质上生成指向父节点的指针，而append操作相当于在父节点后添加指针数量的图元并将其与多出的数据绑定</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">g.selectAll(<span class="string">'.dataRect'</span>).data(data).enter().append(<span class="string">'rect'</span>)</span><br><span class="line">.attr(<span class="string">'class'</span>, <span class="string">'dataRect'</span>)</span><br><span class="line">.attr(<span class="string">'width'</span>, d =&gt; xScale(d.value))</span><br><span class="line">.attr(<span class="string">'height'</span>, yScale.bandwidth())</span><br><span class="line">.attr(<span class="string">'y'</span>, d =&gt; yScale(d.name))</span><br><span class="line">.attr(<span class="string">'fill'</span>, <span class="string">'green'</span>).attr(<span class="string">'opacity</span></span><br></pre></td></tr></table></figure>
<h4 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h4><ul>
<li>有图元有数据</li>
<li>const p = maingroup.selectAll(‘.datacurve’).data(data).attr(…).attr(…)</li>
<li>Update作为实际可视化任务最常用的状态，经常被单独封装成一个函数</li>
<li>updateSelection.merge( enterSelection ).attr(…).attr(…)<br>•    将两个selection合并到一起操作<br>•    enterSelection需要至少append(…)图元</li>
</ul>
<h4 id="Exit"><a href="#Exit" class="headerlink" title="Exit"></a>Exit</h4><ul>
<li>有图元没数据<br>D3.js会自动‘搞清楚’哪些图元是不绑定数据的</li>
<li>引用官方文档：existing DOM elements in the selection for which no new datum was found</li>
<li>const p = maingroup.selectAll(‘.class’).data(data).exit().remove()</li>
</ul>
<h3 id="Animation"><a href="#Animation" class="headerlink" title="Animation"></a>Animation</h3><ul>
<li>Update经常与D3.js的动画一起使用</li>
<li>.transition().duration()<ul>
<li>transition就是说进入动画模式， duration()是设置动画持续时间</li>
</ul>
</li>
<li>d3.selectAll(‘rect’).data(data2, d =&gt; d.name).transition().duration(3000).attr(‘width’, d =&gt; xScale(d.value))</li>
<li>.duration(…)中为毫秒，即3000表示3秒钟</li>
<li>.transition(…)经过调用后，后续的链式调用会变成数值上的渐变，渐变的时间由.duration(…)设定</li>
<li>插值的方式由.ease(…)设定</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">'rect'</span>).data(data).transition().duration(<span class="number">1000</span>).attr(<span class="string">'width'</span>,d=&gt;xScale(d.value));</span><br><span class="line">d3.selectAll(<span class="string">'rect'</span>).data(data1).transition().duration(<span class="number">1000</span>).attr(<span class="string">'width'</span>,d=&gt;xScale(d.value));</span><br><span class="line">d3.selectAll(<span class="string">'rect'</span>).data(data2,d=&gt;d.name).transition().duration(<span class="number">1000</span>).attr(<span class="string">'width'</span>,d=&gt;xScale(d.value));</span><br></pre></td></tr></table></figure>
<p>结果如下</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/1.gif" style="zoom: 130%;"></p>
<h3 id="Data-Join简洁形式"><a href="#Data-Join简洁形式" class="headerlink" title="Data-Join简洁形式"></a>Data-Join简洁形式</h3><ul>
<li>data(…).join(‘…’)</li>
<li>默认enter和update的执行形式相同</li>
<li>默认exit是删除（remove）节点</li>
<li>默认data-join形式简洁但不灵活<br>•    必须需要设置enter数据的初始图元属性，update会每次重新设置初始值，从而导致动画出现‘奇怪’的效果<br>•    仍支持‘定制’：<br>•    .join(enter =&gt; enter.append(“text”).attr(“fill”, “green”).text(d =&gt; d),update =&gt; (), exit =&gt; ())</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d3.selectAll(<span class="string">'rect'</span>).data(data).transition().duration(<span class="number">1000</span>).attr(<span class="string">'width'</span>,d=&gt;xScale(d.value));</span><br><span class="line">d3.selectAll(<span class="string">'rect'</span>).data(data1).join(<span class="string">'rect'</span>).transition().duration(<span class="number">1000</span>).attr(<span class="string">'width'</span>,d=&gt;xScale(d.value));</span><br></pre></td></tr></table></figure>
<h3 id="数据的读取"><a href="#数据的读取" class="headerlink" title="数据的读取"></a>数据的读取</h3><p>常见的CSV数据</p>
<ul>
<li>第一行为属性列表</li>
<li>后续每行对应一‘条’数据</li>
<li>CSV本质上是纯文本，区别于EXCEL的格式</li>
</ul>
<p>读取</p>
<ul>
<li>d3.csv(‘path/to/data.csv’).then( data =&gt; {…} ) 对数据进行预处理</li>
<li>.csv函数的返回值是一个JS的’Promise’对象<br>•    ‘Promise’对象用于执行异步操作</li>
<li>​    .then(…)的参数为一个函数，参数为.csv(…)的返回值<br>•     实际上在JavaScript异步中是一个resolve</li>
<li>d3.csv(…)会正常向服务器请求数据，在请求并处理好之后，将结果扔给.then(…)中的回调函数</li>
</ul>
<h3 id="实例：绘制笑脸"><a href="#实例：绘制笑脸" class="headerlink" title="实例：绘制笑脸"></a>实例：绘制笑脸</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;select,arc&#125; <span class="keyword">from</span> <span class="string">'d3'</span>;</span><br><span class="line"><span class="keyword">const</span> svg = select(<span class="string">'svg'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> width = +svg.attr(<span class="string">'width'</span>);</span><br><span class="line"><span class="keyword">const</span> height = +svg.attr(<span class="string">'height'</span>);</span><br><span class="line"><span class="keyword">const</span> g = svg</span><br><span class="line">		.append(<span class="string">'g'</span>)</span><br><span class="line">			.attr(<span class="string">'transform'</span>,<span class="string">`translate(<span class="subst">$&#123;width<span class="regexp">/2&#125;,$&#123;height/</span><span class="number">2</span>&#125;</span>)`</span>)</span><br><span class="line"><span class="keyword">const</span> circle =  g</span><br><span class="line">		.append(<span class="string">'circle'</span>)</span><br><span class="line">			.attr(<span class="string">'r'</span>,height/<span class="number">2</span>)</span><br><span class="line">			.attr(<span class="string">'fill'</span>,<span class="string">'yellow'</span>)</span><br><span class="line">			.attr(<span class="string">'stroke'</span>,<span class="string">'black'</span>)</span><br><span class="line"><span class="keyword">const</span> eyeSpacing = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">const</span> eyeYOffset = <span class="number">-70</span>;</span><br><span class="line"><span class="keyword">const</span> eyeRadius = <span class="number">40</span>;</span><br><span class="line"><span class="keyword">const</span> eyebrowWidth = <span class="number">70</span>;</span><br><span class="line"><span class="keyword">const</span> eyebrowHeight =<span class="number">15</span>;</span><br><span class="line"><span class="keyword">const</span> eyebrowYOffset = <span class="number">-70</span>;</span><br><span class="line"><span class="comment">//眼睛组</span></span><br><span class="line"><span class="keyword">const</span> eyesG = g</span><br><span class="line">		.append(<span class="string">'g'</span>)</span><br><span class="line">			.attr(<span class="string">'transform'</span>,<span class="string">`translate(0,<span class="subst">$&#123;eyeYOffset&#125;</span>)`</span>);</span><br><span class="line"><span class="keyword">const</span> leftEye =  eyesG</span><br><span class="line">		.append(<span class="string">'circle'</span>)</span><br><span class="line">			.attr(<span class="string">'r'</span>,eyeRadius)</span><br><span class="line">			.attr(<span class="string">'cx'</span>, -eyeSpacing)</span><br><span class="line"><span class="keyword">const</span> rightEye =  eyesG</span><br><span class="line">		.append(<span class="string">'circle'</span>)</span><br><span class="line">			.attr(<span class="string">'r'</span>,eyeRadius)</span><br><span class="line">			.attr(<span class="string">'cx'</span>, eyeSpacing)</span><br><span class="line"><span class="comment">//眉毛组，我觉得可以说是从眼睛组中继承过来的。</span></span><br><span class="line"><span class="keyword">const</span> eyebrowsG = eyesG</span><br><span class="line">		.append(<span class="string">'g'</span>)</span><br><span class="line">			.attr(<span class="string">'transform'</span>,<span class="string">`translate(0,<span class="subst">$&#123;eyeYOffset&#125;</span>)`</span>);</span><br><span class="line">eyebrowsG</span><br><span class="line">  .transition().duration(<span class="number">2000</span>)</span><br><span class="line">		.attr(<span class="string">'transform'</span>,<span class="string">`translate(0,<span class="subst">$&#123;eyebrowYOffset<span class="number">-50</span>&#125;</span>)`</span>)</span><br><span class="line">	.transition().duration(<span class="number">2000</span>)</span><br><span class="line">		.attr(<span class="string">'transform'</span>,<span class="string">`translate(0,<span class="subst">$&#123;eyebrowYOffset&#125;</span>)`</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//左右眉毛</span></span><br><span class="line"><span class="keyword">const</span> leftEyebrow = eyebrowsG</span><br><span class="line">  .append(<span class="string">'rect'</span>)</span><br><span class="line">    .attr(<span class="string">'x'</span>, -eyeSpacing - eyebrowWidth / <span class="number">2</span>)</span><br><span class="line">    .attr(<span class="string">'width'</span>, eyebrowWidth)</span><br><span class="line">    .attr(<span class="string">'height'</span>, eyebrowHeight);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rightEyebrow = eyebrowsG</span><br><span class="line">  .append(<span class="string">'rect'</span>)</span><br><span class="line">    .attr(<span class="string">'x'</span>, eyeSpacing - eyebrowWidth / <span class="number">2</span>)</span><br><span class="line">    .attr(<span class="string">'width'</span>, eyebrowWidth)</span><br><span class="line">    .attr(<span class="string">'height'</span>, eyebrowHeight); </span><br><span class="line"></span><br><span class="line"><span class="comment">//嘴巴，利用arc，是制作弧的一个api			</span></span><br><span class="line"><span class="keyword">const</span> mounth = g</span><br><span class="line">	.append(<span class="string">'path'</span>)</span><br><span class="line">		.attr(<span class="string">'d'</span>,arc()(&#123;</span><br><span class="line">						innerRadius: <span class="number">150</span>,</span><br><span class="line">  					outerRadius: <span class="number">170</span>,</span><br><span class="line">  					startAngle: <span class="built_in">Math</span>.PI/<span class="number">2</span>,</span><br><span class="line">  					endAngle: <span class="built_in">Math</span>.PI*<span class="number">1.5</span> ,</span><br><span class="line">      &#125;))</span><br></pre></td></tr></table></figure>
<p> <img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/2.gif" style="zoom: 70%;"></p>
<h3 id="实例：-绘制柱状图"><a href="#实例：-绘制柱状图" class="headerlink" title="实例： 绘制柱状图"></a>实例： 绘制柱状图</h3><p>画处柱形图需要遵循五个步骤</p>
<ul>
<li>Representing a data dable in JavaScript</li>
</ul>
<p>data.css</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; select, csv, max, scaleLinear, scaleBand &#125; <span class="keyword">from</span> <span class="string">"d3"</span>;</span><br><span class="line"><span class="keyword">const</span> svg = select(<span class="string">"svg"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> width = +svg.attr(<span class="string">"width"</span>);</span><br><span class="line"><span class="keyword">const</span> height = +svg.attr(<span class="string">"height"</span>);</span><br><span class="line">csv(<span class="string">"data.csv"</span>).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  data.forEach(<span class="function">(<span class="params">d</span>) =&gt;</span> &#123;</span><br><span class="line">    d.population = +d.population * <span class="number">1000</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  render(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>Creating rectangles for each row</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">const</span> render = <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> xValue = <span class="function">(<span class="params">d</span>) =&gt;</span> d.population;</span><br><span class="line">  <span class="keyword">const</span> yValue = <span class="function">(<span class="params">d</span>) =&gt;</span> d.country;</span><br><span class="line">  svg</span><br><span class="line">    .selectAll(<span class="string">"rect"</span>)</span><br><span class="line">    .data(data)</span><br><span class="line">    .enter()</span><br><span class="line">    .append(<span class="string">"rect"</span>)</span><br><span class="line">    .attr(<span class="string">"y"</span>, (d) =&gt; yScale(yValue(d)))</span><br><span class="line">    .attr(<span class="string">"width"</span>, (d) =&gt; xScale(xValue(d)))</span><br><span class="line">    .attr(<span class="string">"height"</span>, yScale.bandwidth());</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Using linear and band scales</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">const</span> render = <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> xValue = <span class="function">(<span class="params">d</span>) =&gt;</span> d.population;</span><br><span class="line">  <span class="keyword">const</span> yValue = <span class="function">(<span class="params">d</span>) =&gt;</span> d.country;</span><br><span class="line">  <span class="keyword">const</span> xScale = scaleLinear()</span><br><span class="line">    .domain([<span class="number">0</span>, max(data, xValue)])</span><br><span class="line">    .range([<span class="number">0</span>, width]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> yScale = scaleBand()</span><br><span class="line">    .domain(data.map(yValue))</span><br><span class="line">    .range([<span class="number">0</span>, height])</span><br><span class="line">    .padding(<span class="number">0.1</span>);</span><br><span class="line">  svg</span><br><span class="line">    .selectAll(<span class="string">"rect"</span>)</span><br><span class="line">    .data(data)</span><br><span class="line">    .enter()</span><br><span class="line">    .append(<span class="string">"rect"</span>)</span><br><span class="line">    .attr(<span class="string">"y"</span>, (d) =&gt; yScale(yValue(d)))</span><br><span class="line">    .attr(<span class="string">"width"</span>, (d) =&gt; xScale(xValue(d)))</span><br><span class="line">    .attr(<span class="string">"height"</span>, yScale.bandwidth());</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>The margin convention </p>
</li>
<li><p>Adding axes</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  select,</span><br><span class="line">  csv,</span><br><span class="line">  max,</span><br><span class="line">  scaleLinear,</span><br><span class="line">  scaleBand,</span><br><span class="line">  axisLeft,</span><br><span class="line">  axisBottom,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">"d3"</span>;</span><br><span class="line"><span class="keyword">const</span> svg = select(<span class="string">"svg"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> width = +svg.attr(<span class="string">"width"</span>);</span><br><span class="line"><span class="keyword">const</span> height = +svg.attr(<span class="string">"height"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> render = <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> xValue = <span class="function">(<span class="params">d</span>) =&gt;</span> d.population;</span><br><span class="line">  <span class="keyword">const</span> yValue = <span class="function">(<span class="params">d</span>) =&gt;</span> d.country;</span><br><span class="line">  <span class="keyword">const</span> margin = &#123; <span class="attr">top</span>: <span class="number">20</span>, <span class="attr">right</span>: <span class="number">40</span>, <span class="attr">bottom</span>: <span class="number">20</span>, <span class="attr">left</span>: <span class="number">100</span> &#125;;</span><br><span class="line">  <span class="keyword">const</span> innerheight = width - margin.left - margin.right;</span><br><span class="line">  <span class="keyword">const</span> innerwidth = width - margin.left - margin.right;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//比例尺</span></span><br><span class="line">  <span class="keyword">const</span> xScale = scaleLinear()</span><br><span class="line">    .domain([<span class="number">0</span>, max(data, xValue)])</span><br><span class="line">    .range([<span class="number">0</span>, innerwidth]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> yScale = scaleBand()</span><br><span class="line">    .domain(data.map(yValue))</span><br><span class="line">    .range([<span class="number">0</span>, innerheight])</span><br><span class="line">    .padding(<span class="number">0.1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> g = svg</span><br><span class="line">    .append(<span class="string">"g"</span>)</span><br><span class="line">    .attr(<span class="string">"transform"</span>, <span class="string">`translate(<span class="subst">$&#123;margin.left&#125;</span>,<span class="subst">$&#123;margin.top&#125;</span>)`</span>);</span><br><span class="line">	<span class="comment">//坐标轴</span></span><br><span class="line">  g.append(<span class="string">"g"</span>).call(axisLeft(yScale));</span><br><span class="line">  g.append(<span class="string">"g"</span>)</span><br><span class="line">    .call(axisBottom(xScale))</span><br><span class="line">    .attr(<span class="string">"transform"</span>, <span class="string">`translate(0,<span class="subst">$&#123;innerheight&#125;</span>)`</span>);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">  g.selectAll(<span class="string">"rect"</span>)</span><br><span class="line">    .data(data)</span><br><span class="line">    .enter()</span><br><span class="line">    .append(<span class="string">"rect"</span>)</span><br><span class="line">    .attr(<span class="string">"y"</span>, (d) =&gt; yScale(yValue(d)))</span><br><span class="line">    .attr(<span class="string">"width"</span>, (d) =&gt; xScale(xValue(d)))</span><br><span class="line">    .attr(<span class="string">"height"</span>, yScale.bandwidth());</span><br><span class="line">&#125;;</span><br><span class="line">csv(<span class="string">"data.csv"</span>).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  data.forEach(<span class="function">(<span class="params">d</span>) =&gt;</span> &#123;</span><br><span class="line">    d.population = +d.population * <span class="number">1000</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  render(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/35.png" style="zoom: 70%;"></p>
<h4 id="Customizing-Axes"><a href="#Customizing-Axes" class="headerlink" title="Customizing Axes"></a>Customizing Axes</h4><ul>
<li>Formatting numbers</li>
</ul>
<p><a href="http://bl.ocks.org/zanarmstrong/05c1e95bf7aa16c4768e" target="_blank" rel="noopener">http://bl.ocks.org/zanarmstrong/05c1e95bf7aa16c4768e</a></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/36.png" style="zoom: 80%;"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//默认 百万M上面是G,但是我们认为十亿级的更准确，所以我们用replace函数把 G换成了B。然后用</span></span><br><span class="line"><span class="comment">//tickFormat来引用我们自定义的格式化规则</span></span><br><span class="line"><span class="keyword">const</span> xAxisTickFormat = <span class="function">(<span class="params">number</span>) =&gt;</span> format(<span class="string">".3s"</span>)(number).replace(<span class="string">"G"</span>, <span class="string">"B"</span>);</span><br><span class="line">  <span class="keyword">const</span> xAxis = axisBottom(xScale).tickFormat(xAxisTickFormat);</span><br><span class="line">  g.append(<span class="string">"g"</span>).call(axisLeft(yScale));</span><br><span class="line">  g.append(<span class="string">"g"</span>).call(xAxis).attr(<span class="string">"transform"</span>, <span class="string">`translate(0,<span class="subst">$&#123;innerheight&#125;</span>)`</span>);</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/37.png" style="zoom: 90%;"></p>
<ul>
<li>Removing unnecessary lines</li>
</ul>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/38.png" style="zoom: 50%;"></p>
<p>我们要去除这些根难看的边框线和凸起来的东西</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">g.append(<span class="string">"g"</span>)</span><br><span class="line">	.call(axisLeft(yScale))</span><br><span class="line">	.selectAll(<span class="string">".domain,.tick line"</span>)</span><br><span class="line">	.remove();</span><br><span class="line">g.append(<span class="string">"g"</span>)</span><br><span class="line">  .call(xAxis)</span><br><span class="line">  .attr(<span class="string">"transform"</span>, <span class="string">`translate(0,<span class="subst">$&#123;innerheight&#125;</span>)`</span>)</span><br><span class="line">  .selectAll(<span class="string">".domain "</span>)</span><br><span class="line">  .remove();</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/39.png" style="zoom: 50%;"></p>
<ul>
<li>Adding a Visualization title</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g.append(<span class="string">"text"</span>).attr(<span class="string">"y"</span>, <span class="number">-10</span>).text(<span class="string">"Top 10 Most Popular Countries"</span>);</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/40.png" style="zoom: 50%;"></p>
<ul>
<li>Adding axis labels</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> xAxisG = g</span><br><span class="line">  .append(<span class="string">"g"</span>)</span><br><span class="line">  .call(xAxis)</span><br><span class="line">  .attr(<span class="string">"transform"</span>, <span class="string">`translate(0,<span class="subst">$&#123;innerheight&#125;</span>)`</span>);</span><br><span class="line">xAxisG.select(<span class="string">".domain "</span>).remove();</span><br><span class="line">xAxisG</span><br><span class="line">  .append(<span class="string">"text"</span>)</span><br><span class="line">  .attr(<span class="string">"fill"</span>, <span class="string">"black"</span>)</span><br><span class="line">  .attr(<span class="string">"y"</span>, <span class="number">60</span>)</span><br><span class="line">  .attr(<span class="string">"x"</span>, innerWidth / <span class="number">2</span> - <span class="number">100</span>)</span><br><span class="line">  .text(<span class="string">"Population"</span>);</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/41.png" style="zoom: 100%;"></p>
<ul>
<li>Making tick grid lines网格线</li>
</ul>
<p>css</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"> 	<span class="attribute">margin</span>:<span class="number">0px</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="selector-tag">rect</span> &#123;</span><br><span class="line">  <span class="attribute">fill</span>: steelblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">text</span>&#123;</span><br><span class="line">  <span class="attribute">font-size </span>:<span class="number">3em</span>;</span><br><span class="line">  <span class="attribute">font-family</span>: sans-serif;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.tick</span> <span class="selector-tag">text</span> &#123;</span><br><span class="line">  <span class="attribute">font-size </span>:<span class="number">2.7em</span>;</span><br><span class="line">  <span class="attribute">fill</span>: <span class="number">#635F5D</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.tick</span> <span class="selector-tag">line</span>&#123;</span><br><span class="line">  <span class="attribute">stroke</span>: <span class="number">#C0C0BB</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.axis-label</span>&#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">5em</span>;</span><br><span class="line">  <span class="attribute">fill</span>: <span class="number">#8E8883</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.axis-title</span>&#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">3.2em</span>;</span><br><span class="line">  <span class="attribute">fill</span>:<span class="number">#635F5D</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; </span><br><span class="line">  select,</span><br><span class="line">  csv,</span><br><span class="line">  scaleLinear,</span><br><span class="line">  max,</span><br><span class="line">  scaleBand,</span><br><span class="line">  axisLeft,</span><br><span class="line">  axisBottom,</span><br><span class="line">  format</span><br><span class="line">&#125;  <span class="keyword">from</span> <span class="string">'d3'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> render = <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">const</span> svg = select(<span class="string">'svg'</span>)</span><br><span class="line">  <span class="keyword">const</span> height = +svg.attr(<span class="string">'height'</span>)</span><br><span class="line">  <span class="keyword">const</span> width = +svg.attr(<span class="string">'width'</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> countryMapping = <span class="function"><span class="params">d</span> =&gt;</span> d.country</span><br><span class="line">  <span class="keyword">const</span> populationMapping = <span class="function"><span class="params">d</span> =&gt;</span> d.population</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> countries = data.map(countryMapping)</span><br><span class="line">  <span class="keyword">const</span> populationMax = max(data, populationMapping)</span><br><span class="line">  <span class="keyword">const</span> margin = &#123;</span><br><span class="line">    top: <span class="number">45</span>,</span><br><span class="line">    bottom: <span class="number">85</span>,</span><br><span class="line">    left: <span class="number">200</span>,</span><br><span class="line">    right: <span class="number">100</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> textHeight = <span class="number">10</span></span><br><span class="line">  <span class="keyword">const</span> innerWidth = width - margin.left - margin.right</span><br><span class="line">  <span class="keyword">const</span> innerHeight = height - margin.top - margin.bottom - textHeight</span><br><span class="line">  <span class="keyword">const</span> xScale = scaleLinear().domain([<span class="number">0</span>, populationMax]).range([<span class="number">0</span>, innerWidth])</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> yBandScale = scaleBand()</span><br><span class="line">  .domain(countries)</span><br><span class="line">  .range([<span class="number">0</span>, innerHeight])</span><br><span class="line">  .padding(<span class="number">.2</span>)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> barGroup = svg.append(<span class="string">'g'</span>).attr(<span class="string">'transform'</span>,</span><br><span class="line">                                        <span class="string">`translate(<span class="subst">$&#123;margin.left&#125;</span>, <span class="subst">$&#123;margin.top + textHeight + <span class="number">5</span>&#125;</span>)`</span>)</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> yAxis = axisLeft(yBandScale)</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> xAxisTickFormat = <span class="function"><span class="params">number</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> format(<span class="string">'.3s'</span>)(number).replace(<span class="string">'G'</span>, <span class="string">'B'</span>)</span><br><span class="line">  &#125;</span><br><span class="line">	<span class="keyword">const</span> xAxis = axisBottom(xScale)</span><br><span class="line">  								.tickFormat(xAxisTickFormat)</span><br><span class="line">  </span><br><span class="line">  barGroup.append(<span class="string">'g'</span>).call(yAxis)</span><br><span class="line">  	.selectAll(<span class="string">'.domain, .tick line'</span>)</span><br><span class="line">  	.remove();</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> xAxisG = barGroup.append(<span class="string">'g'</span>).call(xAxis)</span><br><span class="line">    .attr(<span class="string">'transform'</span>, <span class="string">`translate(<span class="subst">$&#123;<span class="number">0</span>&#125;</span>, <span class="subst">$&#123;innerHeight&#125;</span>)`</span>);</span><br><span class="line">  </span><br><span class="line">xAxisG</span><br><span class="line">  .append(<span class="string">'text'</span>)</span><br><span class="line">  .text(<span class="string">'Something is missing'</span>)</span><br><span class="line">  .attr(<span class="string">'y'</span>, <span class="number">50</span>)</span><br><span class="line">  .attr(<span class="string">'x'</span>, innerWidth / <span class="number">2</span>)</span><br><span class="line">  .attr(<span class="string">'class'</span>, <span class="string">'x-label'</span>)</span><br><span class="line">  .text(<span class="string">"Population"</span>);</span><br><span class="line">  </span><br><span class="line">xAxisG    </span><br><span class="line">    .append(<span class="string">"text"</span>)</span><br><span class="line">    .attr(<span class="string">"class"</span>, <span class="string">"axis-label"</span>)<span class="comment">//加上一个类标签，供css选择器去选择</span></span><br><span class="line">    .attr(<span class="string">"fill"</span>, <span class="string">"black"</span>)</span><br><span class="line">    .attr(<span class="string">"y"</span>, <span class="number">75</span>)</span><br><span class="line">    .attr(<span class="string">"x"</span>, innerWidth / <span class="number">2</span>  )</span><br><span class="line">    .text(<span class="string">"Population"</span>);</span><br><span class="line">barGroup</span><br><span class="line">  	.selectAll(<span class="string">'.domain'</span>)</span><br><span class="line">  	.remove();</span><br><span class="line">  </span><br><span class="line"> barGroup</span><br><span class="line">    .append(<span class="string">"text"</span>)</span><br><span class="line">    .attr(<span class="string">"class"</span>, <span class="string">"axis-title"</span>)<span class="comment">//加上一个类标签，供css选择器去选择</span></span><br><span class="line">    .attr(<span class="string">"y"</span>, <span class="number">-10</span>)</span><br><span class="line">    .text(<span class="string">"Top 10 Most Popular Countries"</span>);  </span><br><span class="line"></span><br><span class="line">  barGroup</span><br><span class="line">    .selectAll(<span class="string">'rect'</span>)</span><br><span class="line">  	.data(data)</span><br><span class="line">  	.enter()</span><br><span class="line">  	.append(<span class="string">'rect'</span>)</span><br><span class="line">      .attr(<span class="string">'y'</span>, d =&gt; yBandScale(countryMapping(d)))</span><br><span class="line">      .attr(<span class="string">'width'</span>, d =&gt; xScale(populationMapping(d)))</span><br><span class="line">      .attr(<span class="string">'height'</span>, yBandScale.bandwidth())</span><br><span class="line">  </span><br><span class="line">svg.append(<span class="string">"text"</span>)</span><br><span class="line">  	.attr(<span class="string">"class"</span>, <span class="string">"axis-title"</span>)<span class="comment">//加上一个类标签，供css选择器去选择</span></span><br><span class="line">    .attr(<span class="string">"y"</span>, <span class="number">-10</span>)</span><br><span class="line">    .text(<span class="string">"Top 10 Most Popular Countries"</span>);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">csv(<span class="string">'data.csv'</span>).then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  data.forEach(<span class="function"><span class="params">record</span> =&gt;</span> &#123;</span><br><span class="line">    record.population = +record.population * <span class="number">1000</span></span><br><span class="line">  &#125;)</span><br><span class="line">  render(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/42.png" style="zoom: 70%;"></p>
<h3 id="实例：绘制柱状图"><a href="#实例：绘制柱状图" class="headerlink" title="实例：绘制柱状图"></a>实例：绘制柱状图</h3><p>效果</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/30.png" style="zoom: 70%;"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>BarChart! <span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../js/d3.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!--这里我已经定义了svg画布的宽和高--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">svg</span> <span class="attr">width</span>=<span class="string">"1600"</span> <span class="attr">height</span>=<span class="string">"800"</span> <span class="attr">id</span>=<span class="string">"mainsvg"</span> <span class="attr">class</span>=<span class="string">"svgs"</span>  &gt;</span><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript"><span class="comment">//这是我们想展示的内容，是一个数组</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> data = [&#123;name: <span class="string">'Shao-Kui'</span>, value:<span class="number">6</span>&#125;,</span></span><br><span class="line"><span class="actionscript">        &#123;name:<span class="string">'Wen-Yang'</span>, value:<span class="number">6</span>&#125;, &#123;name:<span class="string">'Cai Yun'</span>, value:<span class="number">16</span>&#125;, &#123;name:<span class="string">'Liang Yuan'</span>, value: <span class="number">10</span>&#125;, </span></span><br><span class="line"><span class="actionscript">        &#123;name:<span class="string">'Yuan-Chen'</span>, value:<span class="number">6</span>&#125;, &#123;name:<span class="string">'Rui-Long'</span>, value:<span class="number">10</span>&#125;, &#123;name:<span class="string">'Dong Xin'</span>, value:<span class="number">12</span>&#125;, </span></span><br><span class="line"><span class="actionscript">        &#123;name:<span class="string">'He Yu'</span>, value:<span class="number">20</span>&#125;, &#123;name:<span class="string">'Xiang-Li'</span>, value:<span class="number">12</span>&#125;, &#123;name:<span class="string">'Godness'</span>, value:<span class="number">20</span>&#125;, </span></span><br><span class="line"><span class="actionscript">        &#123;name:<span class="string">'Wei-Yu'</span>, value:<span class="number">15</span>&#125;, &#123;name:<span class="string">'Chen Zheng'</span>, value:<span class="number">14</span>&#125;, </span></span><br><span class="line"><span class="actionscript">        &#123;name:<span class="string">'Yu Peng'</span>, value:<span class="number">15</span>&#125;, &#123;name:<span class="string">'Li Jian'</span>, value:<span class="number">18</span>&#125;]; </span></span><br><span class="line"><span class="actionscript"><span class="comment">//首先我们获得上面定义的svg画布</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> svg = d3.select(<span class="string">'#mainsvg'</span>);</span></span><br><span class="line"><span class="actionscript"><span class="comment">//获取svg的长和宽       </span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> width = +svg.attr(<span class="string">'width'</span>);</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> height = +svg.attr(<span class="string">'height'</span>);</span></span><br><span class="line"><span class="actionscript"><span class="comment">//定义预留空间        </span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> margin = &#123;top: <span class="number">60</span>, right: <span class="number">30</span>, bottom: <span class="number">60</span>, left: <span class="number">150</span>&#125;;</span></span><br><span class="line"><span class="actionscript"><span class="comment">//真正作画的空间</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> innerWidth = width - margin.left - margin.right;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> innerHeight = height - margin.top - margin.bottom;</span></span><br><span class="line">/*</span><br><span class="line">从上面可以看到横轴是连续的，所以我们用scaleLiner()比例尺进行映射</span><br><span class="line">怎么映射呢？</span><br><span class="line">数据的最小值就是0，数据得最大值就利用d3.max ，第一个数据就是数据本身，第二个参数就是一个函数</span><br><span class="line">这个函数会告诉我们数据是怎么获取到的</span><br><span class="line">映射范围就是0到刚才定义的内边框的宽</span><br><span class="line">*/</span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> xScale = d3.scaleLinear()</span></span><br><span class="line">        .domain([0, d3.max(data, d =&gt; d.value)])</span><br><span class="line">        .range([0, innerWidth]);</span><br><span class="line">/*</span><br><span class="line">数轴是名字，所以是离散的，我们用scaleBand()比例尺进行映射</span><br><span class="line">怎么映射band呢？</span><br><span class="line">我们利用js中的map函数，传入一个回调函数，传回一个数组。并把这个数组给domain</span><br><span class="line">间隙为0.1</span><br><span class="line">*/</span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> yScale = d3.scaleBand()</span></span><br><span class="line"><span class="javascript">        .domain( data.map(<span class="function"><span class="params">d</span> =&gt;</span> d.name) )</span></span><br><span class="line">        .range([0, innerHeight])</span><br><span class="line">        .padding(0.1);</span><br><span class="line">/*</span><br><span class="line">在渲染坐标轴之前我们要把整个柱形图提供给一个容器</span><br><span class="line">我们定义一个g标签，id就是我们的maingroup，</span><br><span class="line">然后设置transform属性，把这个柱形图平移到我们刚才规划的那一片区域，利用模板语法</span><br><span class="line">*/</span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> g = svg.append(<span class="string">'g'</span>).attr(<span class="string">'id'</span>, <span class="string">'maingroup'</span>)</span></span><br><span class="line"><span class="javascript">        .attr(<span class="string">'transform'</span>, <span class="string">`translate(<span class="subst">$&#123;margin.left&#125;</span>, <span class="subst">$&#123;margin.top&#125;</span>)`</span>);</span></span><br><span class="line">/*</span><br><span class="line">然后我们在maingroup中添加坐标轴的容器了</span><br><span class="line">定义坐标轴，告诉坐标轴的取值范围该如何映射</span><br><span class="line">然后我们向里面添加横轴数值和竖轴的人名，注意写法， call(xAxis)就是把group交给xAxis函数去处理</span><br><span class="line">xAxis  </span><br><span class="line">但是坐标轴会默认定义在上面，如果我们要把横轴定义在最底端，我们需要平移一下</span><br><span class="line">*/</span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> xAxis = d3.axisBottom(xScale);</span></span><br><span class="line"><span class="javascript">        g.append(<span class="string">'g'</span>).call(xAxis).attr(<span class="string">'transform'</span>, <span class="string">`translate(<span class="subst">$&#123;<span class="number">0</span>&#125;</span>, <span class="subst">$&#123;innerHeight&#125;</span>)`</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="keyword">const</span> yAxis = d3.axisLeft(yScale);</span></span><br><span class="line"><span class="actionscript">        g.append(<span class="string">'g'</span>).call(yAxis);</span></span><br><span class="line">/*</span><br><span class="line">现在对每一条数据都要画出一个条带，也就是一个矩形</span><br><span class="line">因为我们是根据横轴比例尺定义长度，那么width 就是数据的value属性</span><br><span class="line">高度就是利用yScale提供的方法，交给D3自己去定义</span><br><span class="line">然后我们填充一个颜色</span><br><span class="line">最后我们需要让信息中的人名和坐标轴上的人名一一对应，这样才能映射上去</span><br><span class="line">*/</span><br><span class="line"><span class="javascript">        data.forEach( <span class="function"><span class="params">d</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="actionscript">          g.append(<span class="string">'rect'</span>)</span></span><br><span class="line"><span class="actionscript">          .attr(<span class="string">'width'</span>, xScale(d.value))</span></span><br><span class="line"><span class="actionscript">          .attr(<span class="string">'height'</span>, yScale.bandwidth())</span></span><br><span class="line"><span class="actionscript">          .attr(<span class="string">'fill'</span>, <span class="string">'green'</span>)</span></span><br><span class="line"><span class="actionscript">          .attr(<span class="string">'y'</span>, yScale(d.name))</span></span><br><span class="line">        &#125; );</span><br><span class="line">/*</span><br><span class="line">现在我们需要对柱状图进行一些改进，这里我们想把纵坐标的刻度上的文本，也就是人名</span><br><span class="line">那么我们把他的字体大小设置成2em</span><br><span class="line">最后我们希望加一个表头，也就是标题</span><br><span class="line">那么我们用append一个text，然后利用.text()设置文字内容，字体大小为3em</span><br><span class="line">然后我们需要把他居中，利用transform属性，但还不够，我们现在只是把文本的开头移动到了中间</span><br><span class="line">最后我们设置文字的锚设置为中间。现在文本的中间就在画布的中间了，达成了居中的效果</span><br><span class="line">*/</span><br><span class="line"><span class="actionscript">        d3.selectAll(<span class="string">'.tick text'</span>).attr(<span class="string">'font-size'</span>, <span class="string">'2em'</span>);</span></span><br><span class="line"><span class="actionscript">        g.append(<span class="string">'text'</span>).text(<span class="string">'Members of CSCG'</span>).attr(<span class="string">'font-size'</span>, <span class="string">'3em'</span>)</span></span><br><span class="line"><span class="actionscript">        .attr(<span class="string">'transform'</span>, `translate($&#123;innerWidth/<span class="number">2</span>&#125;, $&#123;<span class="number">0</span>&#125;)`)</span></span><br><span class="line"><span class="actionscript">        .attr(<span class="string">'text-anchor'</span>, <span class="string">'middle'</span>);</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="实现一个散点图-1"><a href="#实现一个散点图-1" class="headerlink" title="实现一个散点图-1"></a>实现一个散点图-1</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  select,</span><br><span class="line">  csv,</span><br><span class="line">  scaleLinear,</span><br><span class="line">  max,</span><br><span class="line">  scalePoint,</span><br><span class="line">  axisLeft,</span><br><span class="line">  axisBottom,</span><br><span class="line">  format,</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">"d3"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> render = <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> svg = select(<span class="string">"svg"</span>);</span><br><span class="line">  <span class="keyword">const</span> height = +svg.attr(<span class="string">"height"</span>);</span><br><span class="line">  <span class="keyword">const</span> width = +svg.attr(<span class="string">"width"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> countryMapping = <span class="function">(<span class="params">d</span>) =&gt;</span> d.country;</span><br><span class="line">  <span class="keyword">const</span> populationMapping = <span class="function">(<span class="params">d</span>) =&gt;</span> d.population;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> countries = data.map(countryMapping);</span><br><span class="line">  <span class="keyword">const</span> populationMax = max(data, populationMapping);</span><br><span class="line">  <span class="keyword">const</span> margin = &#123;</span><br><span class="line">    top: <span class="number">45</span>,</span><br><span class="line">    bottom: <span class="number">85</span>,</span><br><span class="line">    left: <span class="number">200</span>,</span><br><span class="line">    right: <span class="number">100</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> textHeight = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">const</span> innerWidth = width - margin.left - margin.right;</span><br><span class="line">  <span class="keyword">const</span> innerHeight = height - margin.top - margin.bottom - textHeight;</span><br><span class="line">  <span class="keyword">const</span> xScale = scaleLinear()</span><br><span class="line">    .domain([<span class="number">0</span>, populationMax])</span><br><span class="line">    .range([<span class="number">0</span>, innerWidth])</span><br><span class="line">    .nice();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> yScale = scalePoint()</span><br><span class="line">    .domain(countries)</span><br><span class="line">    .range([<span class="number">0</span>, innerHeight])</span><br><span class="line">    .padding(<span class="number">0.7</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> circleGroup = svg</span><br><span class="line">    .append(<span class="string">"g"</span>)</span><br><span class="line">    .attr(</span><br><span class="line">      <span class="string">"transform"</span>,</span><br><span class="line">      <span class="string">`translate(<span class="subst">$&#123;margin.left&#125;</span>, <span class="subst">$&#123;margin.top + textHeight + <span class="number">5</span>&#125;</span>)`</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> yAxis = axisLeft(yScale).tickSize(-innerWidth);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> xAxisTickFormat = <span class="function">(<span class="params">number</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> format(<span class="string">".3s"</span>)(number).replace(<span class="string">"G"</span>, <span class="string">"B"</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">const</span> xAxis = axisBottom(xScale)</span><br><span class="line">    .tickFormat(xAxisTickFormat)</span><br><span class="line">    .tickSize(-innerHeight);</span><br><span class="line"></span><br><span class="line">  circleGroup.append(<span class="string">"g"</span>).call(yAxis).selectAll(<span class="string">".domain"</span>).remove();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> xAxisG = circleGroup</span><br><span class="line">    .append(<span class="string">"g"</span>)</span><br><span class="line">    .call(xAxis)</span><br><span class="line">    .attr(<span class="string">"transform"</span>, <span class="string">`translate(<span class="subst">$&#123;<span class="number">0</span>&#125;</span>, <span class="subst">$&#123;innerHeight&#125;</span>)`</span>);</span><br><span class="line"></span><br><span class="line">  xAxisG</span><br><span class="line">    .append(<span class="string">"text"</span>)</span><br><span class="line">    .text(<span class="string">"Something is missing"</span>)</span><br><span class="line">    .attr(<span class="string">"y"</span>, <span class="number">50</span>)</span><br><span class="line">    .attr(<span class="string">"x"</span>, innerWidth / <span class="number">2</span>)</span><br><span class="line">    .attr(<span class="string">"class"</span>, <span class="string">"x-label"</span>)</span><br><span class="line">    .text(<span class="string">"Population"</span>);</span><br><span class="line"></span><br><span class="line">  xAxisG</span><br><span class="line">    .append(<span class="string">"text"</span>)</span><br><span class="line">    .attr(<span class="string">"class"</span>, <span class="string">"axis-label"</span>) <span class="comment">//加上一个类标签，供css选择器去选择</span></span><br><span class="line">    .attr(<span class="string">"fill"</span>, <span class="string">"black"</span>)</span><br><span class="line">    .attr(<span class="string">"y"</span>, <span class="number">75</span>)</span><br><span class="line">    .attr(<span class="string">"x"</span>, innerWidth / <span class="number">2</span>)</span><br><span class="line">    .text(<span class="string">"Population"</span>);</span><br><span class="line">  circleGroup.selectAll(<span class="string">".domain"</span>).remove();</span><br><span class="line"></span><br><span class="line">  circleGroup</span><br><span class="line">    .append(<span class="string">"text"</span>)</span><br><span class="line">    .attr(<span class="string">"class"</span>, <span class="string">"axis-title"</span>) <span class="comment">//加上一个类标签，供css选择器去选择</span></span><br><span class="line">    .attr(<span class="string">"y"</span>, <span class="number">-10</span>)</span><br><span class="line">    .text(<span class="string">"Top 10 Most Popular Countries"</span>);</span><br><span class="line"></span><br><span class="line">  circleGroup</span><br><span class="line">    .selectAll(<span class="string">"circle"</span>)</span><br><span class="line">    .data(data)</span><br><span class="line">    .enter()</span><br><span class="line">    .append(<span class="string">"circle"</span>)</span><br><span class="line">    .attr(<span class="string">"cy"</span>, (d) =&gt; yScale(countryMapping(d)))</span><br><span class="line">    .attr(<span class="string">"cx"</span>, (d) =&gt; xScale(populationMapping(d)))</span><br><span class="line">    .attr(<span class="string">"r"</span>, <span class="number">18</span>);</span><br><span class="line"></span><br><span class="line">  svg</span><br><span class="line">    .append(<span class="string">"text"</span>)</span><br><span class="line">    .attr(<span class="string">"class"</span>, <span class="string">"axis-title"</span>) <span class="comment">//加上一个类标签，供css选择器去选择</span></span><br><span class="line">    .attr(<span class="string">"y"</span>, <span class="number">-10</span>)</span><br><span class="line">    .text(<span class="string">"Top 10 Most Popular Countries"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">csv(<span class="string">"data.csv"</span>).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  data.forEach(<span class="function">(<span class="params">record</span>) =&gt;</span> &#123;</span><br><span class="line">    record.population = +record.population * <span class="number">1000</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  render(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/43.png" style="zoom: 70%;"></p>
<h3 id="实现一个散点图-2"><a href="#实现一个散点图-2" class="headerlink" title="实现一个散点图-2"></a>实现一个散点图-2</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  select,</span><br><span class="line">  csv,</span><br><span class="line">  scaleLinear,</span><br><span class="line">  extent,</span><br><span class="line">  axisLeft,</span><br><span class="line">  axisBottom,</span><br><span class="line">  format</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'d3'</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// d.mpg = +d.mpg;</span></span><br><span class="line">      <span class="comment">// d.cylinders = +d.cylinders;</span></span><br><span class="line">      <span class="comment">// d.displacement = +d.displacement;</span></span><br><span class="line">      <span class="comment">// d.horsepower = +d.horsepower;</span></span><br><span class="line">      <span class="comment">// d.weight = +d.weight;</span></span><br><span class="line">      <span class="comment">// d.acceleration = +d.acceleration;</span></span><br><span class="line">      <span class="comment">// d.year = +d.year;</span></span><br><span class="line"><span class="keyword">const</span> svg = select(<span class="string">'svg'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> width = +svg.attr(<span class="string">'width'</span>);</span><br><span class="line"><span class="keyword">const</span> height = +svg.attr(<span class="string">'height'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> render = <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> title = <span class="string">'Cars: Horsepower vs. Weight'</span>;</span><br><span class="line">  <span class="comment">//可以通过改变xValue和yValue来做不同的图</span></span><br><span class="line">  <span class="keyword">const</span> xValue = <span class="function"><span class="params">d</span> =&gt;</span> d.horsepower;</span><br><span class="line">  <span class="keyword">const</span> xAxisLabel = <span class="string">'Horsepower'</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> yValue = <span class="function"><span class="params">d</span> =&gt;</span> d.weight;</span><br><span class="line">  <span class="keyword">const</span> circleRadius = <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">const</span> yAxisLabel = <span class="string">'Weight'</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> margin = &#123; <span class="attr">top</span>: <span class="number">60</span>, <span class="attr">right</span>: <span class="number">40</span>, <span class="attr">bottom</span>: <span class="number">88</span>, <span class="attr">left</span>: <span class="number">150</span> &#125;;</span><br><span class="line">  <span class="keyword">const</span> innerWidth = width - margin.left - margin.right;</span><br><span class="line">  <span class="keyword">const</span> innerHeight = height - margin.top - margin.bottom;</span><br><span class="line">  <span class="comment">/*******************x和y的比例尺********************/</span></span><br><span class="line">  <span class="keyword">const</span> xScale = scaleLinear()</span><br><span class="line">  <span class="comment">//extent(data, xValue)函数就是[min(data,xValue),max(data,xValue)]</span></span><br><span class="line">    .domain(extent(data, xValue))</span><br><span class="line">    .range([<span class="number">0</span>, innerWidth])</span><br><span class="line">    .nice();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> yScale = scaleLinear()</span><br><span class="line">    .domain(extent(data, yValue))</span><br><span class="line">    .range([innerHeight, <span class="number">0</span>])</span><br><span class="line">    .nice();</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> g = svg.append(<span class="string">'g'</span>)</span><br><span class="line">    .attr(<span class="string">'transform'</span>, <span class="string">`translate(<span class="subst">$&#123;margin.left&#125;</span>,<span class="subst">$&#123;margin.top&#125;</span>)`</span>);</span><br><span class="line">  <span class="comment">/******************x和y 的坐标轴*********************/</span></span><br><span class="line">  <span class="keyword">const</span> xAxis = axisBottom(xScale)</span><br><span class="line">    .tickSize(-innerHeight)</span><br><span class="line">  <span class="comment">//让坐标轴下面的数标和轴远离</span></span><br><span class="line">    .tickPadding(<span class="number">15</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> yAxis = axisLeft(yScale)</span><br><span class="line">    .tickSize(-innerWidth)</span><br><span class="line">    .tickPadding(<span class="number">10</span>);</span><br><span class="line">  <span class="comment">/****************y坐标轴的属性*******************/</span></span><br><span class="line">  <span class="keyword">const</span> yAxisG = g.append(<span class="string">'g'</span>).call(yAxis);</span><br><span class="line">  yAxisG.selectAll(<span class="string">'.domain'</span>).remove();</span><br><span class="line">  <span class="comment">//y轴的名称</span></span><br><span class="line">  yAxisG.append(<span class="string">'text'</span>)</span><br><span class="line">      .attr(<span class="string">'class'</span>, <span class="string">'axis-label'</span>)</span><br><span class="line">      .attr(<span class="string">'y'</span>, <span class="number">-93</span>)</span><br><span class="line">      .attr(<span class="string">'x'</span>, -innerHeight / <span class="number">2</span>)</span><br><span class="line">      .attr(<span class="string">'fill'</span>, <span class="string">'black'</span>)</span><br><span class="line">  <span class="comment">//反转 Weight -90度</span></span><br><span class="line">      .attr(<span class="string">'transform'</span>, <span class="string">`rotate(-90)`</span>)</span><br><span class="line">  <span class="comment">//把锚放中间，达到剧中效果</span></span><br><span class="line">      .attr(<span class="string">'text-anchor'</span>, <span class="string">'middle'</span>)</span><br><span class="line">      .text(yAxisLabel);</span><br><span class="line">  <span class="comment">/*****************x坐标轴的属性*********************/</span></span><br><span class="line">  <span class="keyword">const</span> xAxisG = g.append(<span class="string">'g'</span>).call(xAxis)</span><br><span class="line">    .attr(<span class="string">'transform'</span>, <span class="string">`translate(0,<span class="subst">$&#123;innerHeight&#125;</span>)`</span>);</span><br><span class="line">  </span><br><span class="line">  xAxisG.select(<span class="string">'.domain'</span>).remove();</span><br><span class="line">  </span><br><span class="line">  xAxisG.append(<span class="string">'text'</span>)</span><br><span class="line">      .attr(<span class="string">'class'</span>, <span class="string">'axis-label'</span>)</span><br><span class="line">      .attr(<span class="string">'y'</span>, <span class="number">75</span>)</span><br><span class="line">      .attr(<span class="string">'x'</span>, innerWidth / <span class="number">2</span>)</span><br><span class="line">      .attr(<span class="string">'fill'</span>, <span class="string">'black'</span>)</span><br><span class="line">      .text(xAxisLabel);</span><br><span class="line">  <span class="comment">/**************************************************/</span></span><br><span class="line">  g.selectAll(<span class="string">'circle'</span>).data(data)</span><br><span class="line">    .enter().append(<span class="string">'circle'</span>)</span><br><span class="line">      .attr(<span class="string">'cy'</span>, d =&gt; yScale(yValue(d)))</span><br><span class="line">      .attr(<span class="string">'cx'</span>, d =&gt; xScale(xValue(d)))</span><br><span class="line">      .attr(<span class="string">'r'</span>, circleRadius);</span><br><span class="line">  <span class="comment">/***************设置名称***************************/</span></span><br><span class="line">  g.append(<span class="string">'text'</span>)</span><br><span class="line">      .attr(<span class="string">'class'</span>, <span class="string">'title'</span>)</span><br><span class="line">      .attr(<span class="string">'y'</span>, <span class="number">-10</span>)</span><br><span class="line">      .text(title);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">csv(<span class="string">'https://vizhub.com/curran/datasets/auto-mpg.csv'</span>)</span><br><span class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    data.forEach(<span class="function"><span class="params">d</span> =&gt;</span> &#123;</span><br><span class="line">      d.mpg = +d.mpg;</span><br><span class="line">      d.cylinders = +d.cylinders;</span><br><span class="line">      d.displacement = +d.displacement;</span><br><span class="line">      d.horsepower = +d.horsepower;</span><br><span class="line">      d.weight = +d.weight;</span><br><span class="line">      d.acceleration = +d.acceleration;</span><br><span class="line">      d.year = +d.year;  </span><br><span class="line">    &#125;);</span><br><span class="line">    render(data);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/44.png" style="zoom: 70%;"></p>
<p>用自己爬取的数据做的两个图标.只需要载入数据，模板是一样的，方便</p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/5.jpg" style="zoom: 70%;"></p>
<p><img src="/2020/06/12/JavaScript%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96%E4%B9%8BD3/6.jpg" style="zoom: 70%;"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/" class="post-title-link" itemprop="url">一般周期的函数的傅里叶级数</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-10 00:33:59" itemprop="dateCreated datePublished" datetime="2020-06-10T00:33:59+08:00">2020-06-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-15 07:38:54" itemprop="dateModified" datetime="2020-06-15T07:38:54+08:00">2020-06-15</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一般周期的函数的傅里叶级数"><a href="#一般周期的函数的傅里叶级数" class="headerlink" title="一般周期的函数的傅里叶级数"></a>一般周期的函数的傅里叶级数</h1><h2 id="周期为2l的傅里叶级数"><a href="#周期为2l的傅里叶级数" class="headerlink" title="周期为2l的傅里叶级数"></a>周期为2l的傅里叶级数</h2><p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/1.png" style="zoom:80%;"></p>
<h3 id="定理"><a href="#定理" class="headerlink" title="定理"></a>定理</h3><p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/2.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/3.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/4.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/5.png" style="zoom:80%;"></p>
<h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/7.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/8.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/9.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/10.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/11.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/12.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/13.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/16.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/19.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/20.png" style="zoom:80%;"></p>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/14.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/15.png" style="zoom:80%;"></p>
<h2 id="傅里叶级数的复数形式"><a href="#傅里叶级数的复数形式" class="headerlink" title="傅里叶级数的复数形式"></a>傅里叶级数的复数形式</h2><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/17.png" style="zoom:80%;"></p>
<p><img src="/2020/06/10/%E4%B8%80%E8%88%AC%E5%91%A8%E6%9C%9F%E7%9A%84%E5%87%BD%E6%95%B0%E7%9A%84%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/18.png" style="zoom:80%;"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/" class="post-title-link" itemprop="url">傅里叶级数</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-10 00:33:40" itemprop="dateCreated datePublished" datetime="2020-06-10T00:33:40+08:00">2020-06-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-13 18:40:12" itemprop="dateModified" datetime="2020-06-13T18:40:12+08:00">2020-06-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="傅里叶级数"><a href="#傅里叶级数" class="headerlink" title="傅里叶级数"></a>傅里叶级数</h1><h2 id="三角级数和三角函数系得正交性"><a href="#三角级数和三角函数系得正交性" class="headerlink" title="三角级数和三角函数系得正交性"></a>三角级数和三角函数系得正交性</h2><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/1.png" style="zoom: 67%;"></p>
<h3 id="定理1"><a href="#定理1" class="headerlink" title="定理1"></a>定理1</h3><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/2.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/3.png" style="zoom: 67%;"></p>
<h2 id="函数展开成傅里叶级数"><a href="#函数展开成傅里叶级数" class="headerlink" title="函数展开成傅里叶级数"></a>函数展开成傅里叶级数</h2><h2 id="定理2"><a href="#定理2" class="headerlink" title="定理2"></a>定理2</h2><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/4.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/5.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/6.png" style="zoom: 67%;"></p>
<h3 id="定理3（收敛展开定理）"><a href="#定理3（收敛展开定理）" class="headerlink" title="定理3（收敛展开定理）"></a>定理3（收敛展开定理）</h3><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/7.png" style="zoom: 67%;"></p>
<h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><h4 id="1"><a href="#1" class="headerlink" title="1"></a>1</h4><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/8.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/9.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/10.png" style="zoom: 67%;"></p>
<h4 id="2"><a href="#2" class="headerlink" title="2"></a>2</h4><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/12.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/13.png" style="zoom: 67%;"></p>
<h4 id="3"><a href="#3" class="headerlink" title="3"></a>3</h4><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/14.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/15.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/16.png" style="zoom: 67%;"></p>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/11.png" style="zoom: 67%;"></p>
<h2 id="正弦函数和余弦函数"><a href="#正弦函数和余弦函数" class="headerlink" title="正弦函数和余弦函数"></a>正弦函数和余弦函数</h2><h3 id="周期为2-pi-的奇偶函数的傅里叶级数"><a href="#周期为2-pi-的奇偶函数的傅里叶级数" class="headerlink" title="周期为2$\pi$ 的奇偶函数的傅里叶级数"></a>周期为2$\pi$ 的奇偶函数的傅里叶级数</h3><h4 id="定理4"><a href="#定理4" class="headerlink" title="定理4"></a>定理4</h4><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/17.png" style="zoom: 67%;"></p>
<h4 id="例题-1"><a href="#例题-1" class="headerlink" title="例题"></a>例题</h4><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/18.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/19.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/20.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/21.png" style="zoom: 67%;"></p>
<h3 id="定义在-0-pi-上的函数的傅里叶级数"><a href="#定义在-0-pi-上的函数的傅里叶级数" class="headerlink" title="定义在[0,pi]上的函数的傅里叶级数"></a>定义在[0,pi]上的函数的傅里叶级数</h3><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/22.png" style="zoom: 67%;"></p>
<h4 id="例题-2"><a href="#例题-2" class="headerlink" title="例题"></a>例题</h4><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/23.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/24.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/25.png" style="zoom: 67%;"></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/26.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/27.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/28.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/29.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/30.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/31.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/32.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/33.png" style="zoom: 67%;"></p>
<h2 id="解题步骤和技巧"><a href="#解题步骤和技巧" class="headerlink" title="解题步骤和技巧"></a>解题步骤和技巧</h2><p>牢记一些结论</p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/1.jpg" style="zoom: 67%;"></p>
<h2 id="课本练习"><a href="#课本练习" class="headerlink" title="课本练习"></a>课本练习</h2><p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/2.jpg" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/3.jpg" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/4.jpg" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/5.jpg" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%82%85%E9%87%8C%E5%8F%B6%E7%BA%A7%E6%95%B0/6.jpg" style="zoom: 67%;"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/" class="post-title-link" itemprop="url">函数展开成幂级数及其应用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-10 00:33:26" itemprop="dateCreated datePublished" datetime="2020-06-10T00:33:26+08:00">2020-06-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-09 12:09:10" itemprop="dateModified" datetime="2020-09-09T12:09:10+08:00">2020-09-09</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="函数展开成幂级数及其应用"><a href="#函数展开成幂级数及其应用" class="headerlink" title="函数展开成幂级数及其应用"></a>函数展开成幂级数及其应用</h1><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/1.png" style="zoom:80%;"></p>
<h2 id="泰勒级数"><a href="#泰勒级数" class="headerlink" title="泰勒级数"></a>泰勒级数</h2><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/2.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/4.png" style="zoom: 67%;"></p>
<h3 id="定理1"><a href="#定理1" class="headerlink" title="定理1"></a>定理1</h3><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/5.png" style="zoom: 67%;"></p>
<h3 id="定理2"><a href="#定理2" class="headerlink" title="定理2"></a>定理2</h3><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/6.png" style="zoom: 67%;"> </p>
<h2 id="函数展开成幂级数"><a href="#函数展开成幂级数" class="headerlink" title="函数展开成幂级数"></a>函数展开成幂级数</h2><h3 id="直接展开法"><a href="#直接展开法" class="headerlink" title="直接展开法"></a>直接展开法</h3><p>由泰勒级数理论可知，函数f(x) 展开成幂级数的步骤如下：</p>
<ol>
<li>求函数及其各阶导数在x=0 处的值；</li>
<li>写出麦克劳林级数，并求出其收敛半径为R</li>
<li>判别在 收敛区间（-R,R) 内 $\lim\limits_{n-&gt;\infty}R_n(x) $（余项）是否为0</li>
</ol>
<p>展开为幂级数，也可以说是展开成麦克劳林级数 </p>
<h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><h4 id="1"><a href="#1" class="headerlink" title="1"></a>1</h4><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/8.png" style="zoom: 50%;"></p>
<h4 id="2"><a href="#2" class="headerlink" title="2"></a>2</h4><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/9.png" style="zoom: 50%;"></p>
<h4 id="3"><a href="#3" class="headerlink" title="3."></a>3.</h4><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/10.png" style="zoom: 50%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/11.png" style="zoom: 50%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/12.png" style="zoom: 50%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/13.png" style="zoom: 80%;"></p>
<h4 id="4"><a href="#4" class="headerlink" title="4."></a>4.</h4><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/20.png" style="zoom: 80%;"></p>
<h4 id="5"><a href="#5" class="headerlink" title="5."></a>5.</h4><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/21.png" style="zoom: 80%;"></p>
<h3 id="间接展开法"><a href="#间接展开法" class="headerlink" title="间接展开法"></a>间接展开法</h3><p>利用一些已知函数的展开式和幂级数的运算性质，将所给函数展开成幂级数</p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/14.png" style="zoom: 80%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/15.png" style="zoom: 80%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/16.png" style="zoom: 80%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/17.png" style="zoom: 80%;"></p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/18.png" style="zoom: 50%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/19.png" style="zoom: 50%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/28.png" style="zoom: 80%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/29.png" style="zoom: 80%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/31.png" style="zoom: 80%;"></p>
<p>我们可以利用这个拓展的二项式定理解决很多问题</p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/32.png" style="zoom:120%;"></p>
<p>又比如</p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/1.jpg" style="zoom: 80%;"></p>
<h3 id="解题步骤"><a href="#解题步骤" class="headerlink" title="解题步骤"></a>解题步骤</h3><h4 id="展开为幂级数"><a href="#展开为幂级数" class="headerlink" title="展开为幂级数"></a>展开为幂级数</h4><h5 id="低难度"><a href="#低难度" class="headerlink" title="低难度"></a>低难度</h5><p>如果是三角函数，那么通过降幂，转化等，化成 sin kx 的形式</p>
<p>如果是个复杂的分子式，我们需要因式分解，然后转化成  1/x+1 或者1/1-x 的形式</p>
<h5 id="高难度"><a href="#高难度" class="headerlink" title="高难度"></a>高难度</h5><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/22.png" style="zoom: 150%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/23.png" style="zoom: 150%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/24.png" style="zoom: 150%;"></p>
<p>（9） $(1+x)ln(1+x)$  </p>
<h5 id="幂级数展开与和函数"><a href="#幂级数展开与和函数" class="headerlink" title="幂级数展开与和函数"></a>幂级数展开与和函数</h5><p> <img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/25.png" style="zoom: 67%;"></p>
<h4 id="展开为XXX的幂级数"><a href="#展开为XXX的幂级数" class="headerlink" title="展开为XXX的幂级数"></a>展开为XXX的幂级数</h4><p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/26.png" style="zoom: 120%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/27.png" style="zoom: 120%;"></p>
<p><img src="/2020/06/10/%E5%87%BD%E6%95%B0%E5%B1%95%E5%BC%80%E6%88%90%E5%B9%82%E7%BA%A7%E6%95%B0%E5%8F%8A%E5%85%B6%E5%BA%94%E7%94%A8/2.jpg" style="zoom: 120%;"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/10/%E6%B5%85%E8%B0%88redux2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/10/%E6%B5%85%E8%B0%88redux2/" class="post-title-link" itemprop="url">浅谈redux2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-10 00:19:09" itemprop="dateCreated datePublished" datetime="2020-06-10T00:19:09+08:00">2020-06-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-08-13 14:21:28" itemprop="dateModified" datetime="2020-08-13T14:21:28+08:00">2020-08-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="浅谈redux2"><a href="#浅谈redux2" class="headerlink" title="浅谈redux2"></a>浅谈redux2</h1><h2 id="Debugging-Redux-Applications"><a href="#Debugging-Redux-Applications" class="headerlink" title="Debugging Redux Applications"></a>Debugging Redux Applications</h2><h3 id="Installing-Redux-DevTools"><a href="#Installing-Redux-DevTools" class="headerlink" title="Installing Redux DevTools"></a>Installing Redux DevTools</h3><h3 id="The-Basics"><a href="#The-Basics" class="headerlink" title="The Basics"></a>The Basics</h3><h3 id="Inspector-Monitor"><a href="#Inspector-Monitor" class="headerlink" title="Inspector Monitor"></a>Inspector Monitor</h3><h3 id="Tracing"><a href="#Tracing" class="headerlink" title="Tracing"></a>Tracing</h3><h3 id="Exporting-and-Importing"><a href="#Exporting-and-Importing" class="headerlink" title="Exporting and Importing"></a>Exporting and Importing</h3><h2 id="Writing-Clean-Redux-Code"><a href="#Writing-Clean-Redux-Code" class="headerlink" title="Writing Clean Redux Code"></a>Writing Clean Redux Code</h2><h3 id="Structuring-Files-and-Folders"><a href="#Structuring-Files-and-Folders" class="headerlink" title="Structuring Files and Folders"></a>Structuring Files and Folders</h3><h3 id="Ducks-Pattern"><a href="#Ducks-Pattern" class="headerlink" title="Ducks Pattern"></a>Ducks Pattern</h3><h3 id="Redux-Toolkit"><a href="#Redux-Toolkit" class="headerlink" title="Redux Toolkit"></a>Redux Toolkit</h3><h3 id="Creating-the-Store"><a href="#Creating-the-Store" class="headerlink" title="Creating the Store"></a>Creating the Store</h3><h3 id="Creating-Actions"><a href="#Creating-Actions" class="headerlink" title="Creating Actions"></a>Creating Actions</h3><h3 id="Creating-Reducers"><a href="#Creating-Reducers" class="headerlink" title="Creating Reducers"></a>Creating Reducers</h3><h3 id="Creating-Slices"><a href="#Creating-Slices" class="headerlink" title="Creating Slices"></a>Creating Slices</h3><h3 id="Exercise"><a href="#Exercise" class="headerlink" title="Exercise"></a>Exercise</h3><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><h2 id="Designing-the-Store"><a href="#Designing-the-Store" class="headerlink" title="Designing the Store"></a>Designing the Store</h2><h3 id="Redux-State-vs-Local-State"><a href="#Redux-State-vs-Local-State" class="headerlink" title="Redux State vs Local State"></a>Redux State vs Local State</h3><h3 id="Structuring-a-Redux-Store"><a href="#Structuring-a-Redux-Store" class="headerlink" title="Structuring a Redux Store"></a>Structuring a Redux Store</h3><h3 id="Combining-Reducers"><a href="#Combining-Reducers" class="headerlink" title="Combining Reducers"></a>Combining Reducers</h3><h3 id="Normalization"><a href="#Normalization" class="headerlink" title="Normalization"></a>Normalization</h3><h3 id="Selectors"><a href="#Selectors" class="headerlink" title="Selectors"></a>Selectors</h3><h3 id="Memoizing-Selectors-with-Reselect"><a href="#Memoizing-Selectors-with-Reselect" class="headerlink" title="Memoizing Selectors with Reselect"></a>Memoizing Selectors with Reselect</h3><h3 id="Exercise-1"><a href="#Exercise-1" class="headerlink" title="Exercise"></a>Exercise</h3><h3 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution"></a>Solution</h3><h2 id="Middleware"><a href="#Middleware" class="headerlink" title="Middleware"></a>Middleware</h2><h3 id="What-is-Middleware"><a href="#What-is-Middleware" class="headerlink" title="What is Middleware"></a>What is Middleware</h3><h3 id="Creating-Middleware"><a href="#Creating-Middleware" class="headerlink" title="Creating Middleware"></a>Creating Middleware</h3><h3 id="Parameterizing-Middleware"><a href="#Parameterizing-Middleware" class="headerlink" title="Parameterizing Middleware"></a>Parameterizing Middleware</h3><h3 id="Dispatching-Functions"><a href="#Dispatching-Functions" class="headerlink" title="Dispatching Functions"></a>Dispatching Functions</h3><h3 id="Exercise-2"><a href="#Exercise-2" class="headerlink" title="Exercise"></a>Exercise</h3><h3 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution"></a>Solution</h3><h3 id="A-Quick-Note"><a href="#A-Quick-Note" class="headerlink" title="A Quick Note"></a>A Quick Note</h3><h2 id="Consuming-APIs"><a href="#Consuming-APIs" class="headerlink" title="Consuming APIs"></a>Consuming APIs</h2><h3 id="Setting-Up-the-Backend"><a href="#Setting-Up-the-Backend" class="headerlink" title="Setting Up the Backend"></a>Setting Up the Backend</h3><h3 id="The-Approach"><a href="#The-Approach" class="headerlink" title="The Approach"></a>The Approach</h3><h3 id="API-Middleware"><a href="#API-Middleware" class="headerlink" title="API Middleware"></a>API Middleware</h3><h3 id="Actions"><a href="#Actions" class="headerlink" title="Actions"></a>Actions</h3><h3 id="Restructuring-the-Store"><a href="#Restructuring-the-Store" class="headerlink" title="Restructuring the Store"></a>Restructuring the Store</h3><h3 id="Getting-Data-from-the-Server"><a href="#Getting-Data-from-the-Server" class="headerlink" title="Getting Data from the Server"></a>Getting Data from the Server</h3><h3 id="Loading-Indicators"><a href="#Loading-Indicators" class="headerlink" title="Loading Indicators"></a>Loading Indicators</h3><h3 id="Caching"><a href="#Caching" class="headerlink" title="Caching"></a>Caching</h3><h3 id="Saving-Data-to-the-Server"><a href="#Saving-Data-to-the-Server" class="headerlink" title="Saving Data to the Server"></a>Saving Data to the Server</h3><h3 id="Exercise-3"><a href="#Exercise-3" class="headerlink" title="Exercise"></a>Exercise</h3><h3 id="Solution-Resolving-Bugs"><a href="#Solution-Resolving-Bugs" class="headerlink" title="Solution- Resolving Bugs"></a>Solution- Resolving Bugs</h3><h3 id="Solution-Assigning-a-Bug-to-a-User"><a href="#Solution-Assigning-a-Bug-to-a-User" class="headerlink" title="Solution- Assigning a Bug to a User"></a>Solution- Assigning a Bug to a User</h3><h3 id="Reducing-Coupling"><a href="#Reducing-Coupling" class="headerlink" title="Reducing Coupling"></a>Reducing Coupling</h3><h3 id="Cohesion"><a href="#Cohesion" class="headerlink" title="Cohesion"></a>Cohesion</h3><h2 id="Testing-Redux-Applications"><a href="#Testing-Redux-Applications" class="headerlink" title="Testing Redux Applications"></a>Testing Redux Applications</h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><h3 id="What-is-Automated-Testing"><a href="#What-is-Automated-Testing" class="headerlink" title="What is Automated Testing"></a>What is Automated Testing</h3><h3 id="Setting-Up-the-Testing-Environment"><a href="#Setting-Up-the-Testing-Environment" class="headerlink" title="Setting Up the Testing Environment"></a>Setting Up the Testing Environment</h3><h3 id="Your-First-Unit-Test"><a href="#Your-First-Unit-Test" class="headerlink" title="Your First Unit Test"></a>Your First Unit Test</h3><h3 id="Unit-Testing-Redux-Applications"><a href="#Unit-Testing-Redux-Applications" class="headerlink" title="Unit Testing Redux Applications"></a>Unit Testing Redux Applications</h3><h3 id="Solitary-Tests"><a href="#Solitary-Tests" class="headerlink" title="Solitary Tests"></a>Solitary Tests</h3><h3 id="Social-Tests"><a href="#Social-Tests" class="headerlink" title="Social Tests"></a>Social Tests</h3><h3 id="Mocking-HTTP-Calls"><a href="#Mocking-HTTP-Calls" class="headerlink" title="Mocking HTTP Calls"></a>Mocking HTTP Calls</h3><h3 id="Writing-Clean-Tests"><a href="#Writing-Clean-Tests" class="headerlink" title="Writing Clean Tests"></a>Writing Clean Tests</h3><h3 id="Test-Coverage"><a href="#Test-Coverage" class="headerlink" title="Test Coverage"></a>Test Coverage</h3><h3 id="Exercises"><a href="#Exercises" class="headerlink" title="Exercises"></a>Exercises</h3><h3 id="Solution-getUnresolvedBugs"><a href="#Solution-getUnresolvedBugs" class="headerlink" title="Solution- getUnresolvedBugs"></a>Solution- getUnresolvedBugs</h3><h3 id="Solution-resolveBug"><a href="#Solution-resolveBug" class="headerlink" title="Solution- resolveBug"></a>Solution- resolveBug</h3><h3 id="Solution-loadingBugs"><a href="#Solution-loadingBugs" class="headerlink" title="Solution- loadingBugs"></a>Solution- loadingBugs</h3><h3 id="A-Quick-Note-1"><a href="#A-Quick-Note-1" class="headerlink" title="A Quick Note"></a>A Quick Note</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/08/Express%E6%A1%86%E6%9E%B6%E5%9C%A8%E5%90%8E%E7%AB%AF%E7%9A%84%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/08/Express%E6%A1%86%E6%9E%B6%E5%9C%A8%E5%90%8E%E7%AB%AF%E7%9A%84%E5%BA%94%E7%94%A8/" class="post-title-link" itemprop="url">Express框架在后端的应用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-08 20:26:47" itemprop="dateCreated datePublished" datetime="2020-06-08T20:26:47+08:00">2020-06-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-30 10:38:54" itemprop="dateModified" datetime="2020-06-30T10:38:54+08:00">2020-06-30</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Express框架在后端的应用"><a href="#Express框架在后端的应用" class="headerlink" title="Express框架在后端的应用"></a>Express框架在后端的应用</h1><p>在写后端的时候，时常要用到我的学习博客</p>
<p>考虑到基础博客的篇幅普遍过长，所以为了阅读的体验，本文所有链接点击即可跳转至相应章节</p>
<p><a href="https://jasonxqh.github.io/2020/06/07/Nodejs基础1/#more">Nodejs基础1</a></p>
<p><a href="https://jasonxqh.github.io/2020/06/07/Nodejs基础2/#more"> Nodejs基础2</a></p>
<p><a href="https://jasonxqh.github.io/2020/06/07/Nodejs基础3/#more">Nodejs基础3</a></p>
<p><a href="https://jasonxqh.github.io/2020/06/07/Nodejs基础4/#more">Nodejs基础4</a></p>
<h2 id="根目录"><a href="#根目录" class="headerlink" title="根目录"></a>根目录</h2><h3 id="server-js"><a href="#server-js" class="headerlink" title="server.js"></a><code>server.js</code></h3><p>server.js是最重要的一个文件了，他就像一棵树的树根，文件从它开始衍生开来</p>
<p>在<a href="https://jasonxqh.github.io/2020/06/07/Nodejs基础1/#Middleware">Nodejs基础1的Middleware章节</a>中，我详细讲了 expresss.json(),express.urlencoded(),express.static(),morgan.helmet这些中间件。所以他们的作用我在这里不细讲了</p>
<p>cors包是用来跨域的，这点在<a href="https://jasonxqh.github.io/2020/06/07/React框架在作业当中的应用/#more">React框架在作业当中的应用</a> 中的setupProxy.js有提到，</p>
<p>bodyParser是当请求体解析之后，解析值会被放到req.body属性中，当内容为空时候，为一个空对象{}，json()—解析JSON格式 <a href="https://www.jianshu.com/p/cd3de110b4b6" target="_blank" rel="noopener">Express中间件body-parser</a></p>
<p>然后是一个登陆操作，我为了连接方便而且多电脑端都可以使用，所以把数据都上载到了云数据库当中。通过将useNewUrlParser设置为true来避免“不建议使用当前URL字符串解析器”警告</p>
<p>再后来就是把所有的路由接口全部导入，然后把前缀全改为/api，为了在apiRoutes中可以省略/api</p>
<p>最后导入一个检查错误的中间件。用来检查非法的路由和登陆错误</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>); </span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">'cors'</span>);</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> server = express();</span><br><span class="line"> </span><br><span class="line">server.use(cors());</span><br><span class="line">server.use(express.json());</span><br><span class="line">server.use(express.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">server.use(express.static(path.join(__dirname, <span class="string">'public'</span>)));</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line">server.use(bodyParser.json());</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> helmet = <span class="built_in">require</span>(<span class="string">'helmet'</span>);</span><br><span class="line">server.use(helmet());</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> logger = <span class="built_in">require</span>(<span class="string">"morgan"</span>);</span><br><span class="line"><span class="comment">//这是在终端打印日志。</span></span><br><span class="line">server.use(logger(<span class="string">"dev"</span>));</span><br><span class="line"><span class="comment">//这是把日志写入文件以供参阅。</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">var</span> accessLog = fs.createWriteStream(<span class="string">"./access.csv"</span>, &#123; <span class="attr">flags</span>: <span class="string">"a"</span> &#125;);</span><br><span class="line">server.use(logger(<span class="string">"combined"</span>, &#123; <span class="attr">stream</span>: accessLog &#125;));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; connectionStr &#125; = <span class="built_in">require</span>(<span class="string">'./config'</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">为了读取方便，且能多人使用。我已经把本地的数据全部移动到了云数据库</span></span><br><span class="line"><span class="comment">https://cloud.mongodb.com/</span></span><br><span class="line"><span class="comment">然后只要获取登录链接即可：</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// Connect to the Mongo database</span></span><br><span class="line">mongoose.Promise = global.Promise;</span><br><span class="line">mongoose.connect(connectionStr, &#123; <span class="attr">useNewUrlParser</span>: <span class="literal">true</span> &#125;, () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'MongoDB Connect Success!'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Set up the routes</span></span><br><span class="line"><span class="keyword">const</span> apiRoutes = <span class="built_in">require</span>(<span class="string">'./src/routes/api-routes'</span>);</span><br><span class="line"></span><br><span class="line">server.use(<span class="string">'/api'</span>, apiRoutes);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Handle errors</span></span><br><span class="line"><span class="keyword">const</span> errorHandlers = <span class="built_in">require</span>(<span class="string">'./src/middleware/error-handlers'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Catch all invalid routes</span></span><br><span class="line">server.use(errorHandlers.invalidRoute);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Handle mongoose errors</span></span><br><span class="line">server.use(errorHandlers.validationErrors);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Export the server object</span></span><br><span class="line"><span class="built_in">module</span>.exports = server;</span><br></pre></td></tr></table></figure>
<h3 id="记录日志始末"><a href="#记录日志始末" class="headerlink" title="记录日志始末"></a>记录日志始末</h3><h4 id="阶段1"><a href="#阶段1" class="headerlink" title="阶段1"></a>阶段1</h4><p>一开始，我才用了morgan来记录日志</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> logger = <span class="built_in">require</span>(<span class="string">"morgan"</span>);</span><br><span class="line"><span class="comment">//这是在终端打印日志。</span></span><br><span class="line">server.use(logger(<span class="string">"dev"</span>));</span><br></pre></td></tr></table></figure>
<p>但这样只是打在终端里，显然我们是不满足的</p>
<h4 id="阶段2"><a href="#阶段2" class="headerlink" title="阶段2"></a>阶段2</h4><p>然后，我们向把日志记录在.csv 文件中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">var</span> accessLog = fs.createWriteStream(<span class="string">"./access.csv"</span>, &#123; <span class="attr">flags</span>: <span class="string">"a"</span> &#125;);</span><br><span class="line">server.use(logger(<span class="string">"combined"</span>, &#123; <span class="attr">stream</span>: accessLog &#125;));</span><br></pre></td></tr></table></figure>
<p>启动服务后，我们看到在根目录下的access.csv文件中记录下了日志</p>
<p><img src="/2020/06/08/Express%E6%A1%86%E6%9E%B6%E5%9C%A8%E5%90%8E%E7%AB%AF%E7%9A%84%E5%BA%94%E7%94%A8/1.png" style="zoom: 50%;"></p>
<p>这里我先导入到csv文件当中，然后再利用DataGrip定期导入这个access.csv文件来达到数据库存储的一个效果。（虽然这么做不是很正规。。。）</p>
<p><img src="/2020/06/08/Express%E6%A1%86%E6%9E%B6%E5%9C%A8%E5%90%8E%E7%AB%AF%E7%9A%84%E5%BA%94%E7%94%A8/2.png" style="zoom: 55%;"></p>
<h4 id="阶段3"><a href="#阶段3" class="headerlink" title="阶段3"></a>阶段3</h4><p>再然后，我们利用morgan把日志记录在 mongodb当中。</p>
<p>首先我们在models文件夹下新建log.js</p>
<p>为了方便起见，我就不掐头去尾了。直接记录整条日志</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// models/log.js</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; Schema, model &#125; = mongoose;</span><br><span class="line"><span class="keyword">let</span> Log = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  line: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    <span class="keyword">default</span>: <span class="string">""</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">"Log"</span>, Log);</span><br></pre></td></tr></table></figure>
<p>然后我们在sever.js中引入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> logger = <span class="built_in">require</span>(<span class="string">"morgan"</span>);</span><br><span class="line"><span class="keyword">const</span> Log = <span class="built_in">require</span>(<span class="string">'./../server/src/models/log'</span>)</span><br><span class="line"><span class="keyword">var</span> writeToDB = &#123;</span><br><span class="line">  write: <span class="function"><span class="keyword">function</span> (<span class="params">line</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ele = <span class="keyword">new</span> Log(&#123;</span><br><span class="line">       line: line</span><br><span class="line">    &#125;)</span><br><span class="line">    ele.save(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'err'</span>, err)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">server.use(logger(<span class="string">"combined"</span>, &#123;<span class="attr">stream</span>: writeToDB&#125;))</span><br></pre></td></tr></table></figure>
<p>这样，我们就在mongodb中记录下了日志了.</p>
<p><img src="/2020/06/08/Express%E6%A1%86%E6%9E%B6%E5%9C%A8%E5%90%8E%E7%AB%AF%E7%9A%84%E5%BA%94%E7%94%A8/3.png" style="zoom: 55%;"></p>
<h4 id="阶段4"><a href="#阶段4" class="headerlink" title="阶段4"></a>阶段4</h4><p>最后，学习了助教的代码之后，我们可以把这些日志记录在mysql当中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> logger = <span class="built_in">require</span>(<span class="string">"morgan"</span>);</span><br><span class="line"><span class="keyword">const</span> logDAO = <span class="built_in">require</span>(<span class="string">'./../server/src/models/logDAO'</span>)</span><br><span class="line"><span class="keyword">let</span> method = <span class="string">''</span>;</span><br><span class="line">server.use(logger(<span class="function"><span class="keyword">function</span> (<span class="params">tokens, req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> request_time = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  <span class="keyword">var</span> request_method = tokens.method(req, res);</span><br><span class="line">  <span class="keyword">var</span> request_url = tokens.url(req, res);</span><br><span class="line">  <span class="keyword">var</span> status = tokens.status(req, res);</span><br><span class="line">  <span class="keyword">var</span> remote_addr = tokens[<span class="string">'remote-addr'</span>](req, res);</span><br><span class="line">  logDAO.userlog([request_time,request_method,request_url,status,remote_addr], <span class="function"><span class="keyword">function</span> (<span class="params">success</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'成功保存！'</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>
<p><code>logDao.js</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用于存放用户操作记录  日志</span></span><br><span class="line"><span class="comment">//该文件没有用，最后选择使用express中间件 morgan记录日志（app.js中）</span></span><br><span class="line"><span class="keyword">var</span> mysql = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mysqlConf = &#123;</span><br><span class="line">    mysql: &#123;</span><br><span class="line">        host: <span class="string">'localhost'</span>,</span><br><span class="line">        user: <span class="string">'root'</span>,</span><br><span class="line">        password: <span class="string">'root'</span>,</span><br><span class="line">        database:<span class="string">'crawl'</span>,</span><br><span class="line">        <span class="comment">// 最大连接数，默认为10</span></span><br><span class="line">        connectionLimit: <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> pool = mysql.createPool(mysqlConf.mysql);</span><br><span class="line"><span class="comment">// 使用了连接池，重复使用数据库连接，而不必每执行一次CRUD操作就获取、释放一次数据库连接，从而提高了对数据库操作的性能。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 记录用户操作</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    userlog :<span class="function"><span class="keyword">function</span> (<span class="params">useraction, callback</span>) </span>&#123;</span><br><span class="line">        pool.query(<span class="string">'insert into user_action(request_time,request_method,request_url,status,remote_addr) values(?,?,?,?,?)'</span>,</span><br><span class="line">            useraction, <span class="function"><span class="keyword">function</span> (<span class="params">error, result</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line">            callback(result.affectedRows &gt; <span class="number">0</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/08/Express%E6%A1%86%E6%9E%B6%E5%9C%A8%E5%90%8E%E7%AB%AF%E7%9A%84%E5%BA%94%E7%94%A8/4.png"></p>
<p>POST 是新建operas操作</p>
<h3 id="config-js"><a href="#config-js" class="headerlink" title="config.js"></a><code>config.js</code></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  scrects: <span class="string">'test1234'</span>,</span><br><span class="line">  connectionStr:</span><br><span class="line">    <span class="string">'mongodb+srv://test1:1qaz!QAZ@cluster0-2ysvp.mongodb.net/test?retryWrites=true&amp;w=majority'</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="routes目录"><a href="#routes目录" class="headerlink" title="routes目录"></a>routes目录</h2><h3 id="api-routes-js"><a href="#api-routes-js" class="headerlink" title="api-routes.js"></a><code>api-routes.js</code></h3><p>api-routes是所有的路由的集合，这里省区了/api/users前面的/api，因为在server.js中已经写了前缀/api</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> userRoutes = <span class="built_in">require</span>(<span class="string">'./user-routers'</span>);</span><br><span class="line"><span class="keyword">const</span> maoyanRoutes = <span class="built_in">require</span>(<span class="string">'./maoyan'</span>);</span><br><span class="line"><span class="keyword">const</span> doubanRoutes = <span class="built_in">require</span>(<span class="string">'./douban'</span>);</span><br><span class="line"><span class="keyword">const</span> operasRoutes = <span class="built_in">require</span>(<span class="string">'./operas'</span>);</span><br><span class="line"><span class="keyword">const</span> taobaoRoutes = <span class="built_in">require</span>(<span class="string">'./taobao'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"></span><br><span class="line">router.use(<span class="string">'/users'</span>, userRoutes);</span><br><span class="line">router.use(<span class="string">'/maoyan'</span>, maoyanRoutes);</span><br><span class="line">router.use(<span class="string">'/douban'</span>, doubanRoutes);</span><br><span class="line">router.use(<span class="string">'/operas'</span>, operasRoutes);</span><br><span class="line">router.use(<span class="string">'/taobao'</span>, taobaoRoutes);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
<p>下面介绍user-router和以豆瓣为代表的douban.js，这个几个文件的作用主要是定义api接口，然后通过api-routes来集成</p>
<h3 id="user-router-js"><a href="#user-router-js" class="headerlink" title="user-router.js"></a><code>user-router.js</code></h3><p>user-router主要解决的是用户的登录和注册，管理员的删除用户操作。为了让文件的层次解构鲜明，具体的操作在controller中实现，这里只是解构了controller中的函数并引用。</p>
<p> 具体的api功能我在controller会详细解释</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="keyword">const</span> &#123; catchErrors &#125; = <span class="built_in">require</span>(<span class="string">'../middleware/error-handlers'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; authAdmin &#125; = <span class="built_in">require</span>(<span class="string">'../middleware/auth-handlers'</span>);</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">'express-jwt'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; scrects &#125; = <span class="built_in">require</span>(<span class="string">'../../config'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; register, login, findAll, getInfo, <span class="attr">delete</span>: del &#125; = <span class="built_in">require</span>(<span class="string">'../controllers/user'</span>);</span><br><span class="line"><span class="keyword">const</span> auth = jwt(&#123; <span class="attr">secret</span>: scrects &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// user api</span></span><br><span class="line">router.post(<span class="string">'/login'</span>, login); <span class="comment">// api/users/login</span></span><br><span class="line">router.post(<span class="string">'/register'</span>, catchErrors(register)); <span class="comment">//api/users/register</span></span><br><span class="line">router.get(<span class="string">'/info'</span>, auth, getInfo); <span class="comment">// api/users/info</span></span><br><span class="line"><span class="comment">// admin api</span></span><br><span class="line">router.get(<span class="string">'/list'</span>, auth, authAdmin, findAll); <span class="comment">//api/users/list</span></span><br><span class="line">router.post(<span class="string">'/:id/delete'</span>, auth, authAdmin, del);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
<h3 id="douban-js"><a href="#douban-js" class="headerlink" title="douban.js"></a><code>douban.js</code></h3><p> 具体的api功能我在controller会详细解释</p>
<p>首先我们从controller中解构我们需要的函数，然后再路由触发的时候调用这些函数</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="keyword">const</span> &#123; findAll, insertMany, <span class="attr">delete</span>: del, getListByKey, getListByOr &#125; = <span class="built_in">require</span>(<span class="string">'../controllers/douban'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 一次性插入多条数据，为了使用postMan插入多条数据</span></span><br><span class="line">router.post(<span class="string">'/add'</span>, insertMany);</span><br><span class="line">router.post(<span class="string">'/delete/:id'</span>, del);</span><br><span class="line">router.get(<span class="string">'/list'</span>, findAll);</span><br><span class="line">router.get(<span class="string">'/getlist'</span>, getListByKey)</span><br><span class="line">router.get(<span class="string">'/getListOr'</span>, getListByOr)</span><br><span class="line">router.get(<span class="string">'/getAll'</span>, getAll)</span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
<h2 id="models目录"><a href="#models目录" class="headerlink" title="models目录"></a>models目录</h2><h3 id="schema"><a href="#schema" class="headerlink" title="schema"></a><code>schema</code></h3><p>就是表格，利用mongoose创建一张表格来存放从数据库中获得的信息。所以这里的表格要和数据库中的表格一样</p>
<h3 id="imestamps-true"><a href="#imestamps-true" class="headerlink" title="imestamps:true"></a><code>imestamps:true</code></h3><p><strong>timestamps</strong>选项会在创建文档时自动生成<strong>createAt</strong>和<strong>updateAt</strong>两个字段，值都为系统当前时间。并且在更新文档时自动更新<strong>updateAt</strong>字段的值为系统当前时间 .ture代表了使用默认的字段名</p>
<p>在Mongoose中，定义数据库model schemas时使用<strong>timestamps</strong>选项可以给我们带来许多便利。在创建文档时不用在代码中去指定<strong>createTime</strong>字段的值，在更新文档时也不用去修改<strong>updateTime</strong>字段的值。</p>
<p>参考<a href="https://mongoosejs.com/docs/guide.html#timestamps" target="_blank" rel="noopener">Mongoose文档</a></p>
<h3 id="Model"><a href="#Model" class="headerlink" title="Model"></a><code>Model</code></h3><p>是由Schema编译而成的假想（fancy）构造器，具有抽象属性和行为。Model的每一个实例（instance）就是一个document。document可以保存到数据库和对数据库进行操作。<br>也就是说，model是用来选择集合的。</p>
<p>也就是说，我在云端有一张数据表叫Users，我想把里面的数据申请到本地。所以我们在本地需要建一张一模一样的表格来用以存放。但是我在这张表格中所做的增删改查，都会在数据库中同步。这就是model的用法。</p>
<h3 id="user-js"><a href="#user-js" class="headerlink" title="user.js"></a><code>user.js</code></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; Schema, model &#125; = mongoose;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> usersSchema = <span class="keyword">new</span> Schema(</span><br><span class="line">  &#123;</span><br><span class="line">    __v: &#123; <span class="attr">type</span>: <span class="built_in">Number</span>, <span class="attr">select</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    name: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    password: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span>, <span class="attr">select</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    auth: &#123; <span class="attr">type</span>: <span class="built_in">Number</span>, <span class="attr">required</span>: <span class="literal">false</span>, <span class="attr">default</span>: <span class="number">0</span> &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">timestamps</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = model(<span class="string">'Users'</span>, usersSchema);</span><br></pre></td></tr></table></figure>
<h3 id="douban-js-1"><a href="#douban-js-1" class="headerlink" title="douban.js"></a><code>douban.js</code></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; Schema, model &#125; = mongoose;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> doubantop250Schema = <span class="keyword">new</span> Schema(</span><br><span class="line">  &#123;</span><br><span class="line">    __v: &#123; <span class="attr">type</span>: <span class="built_in">Number</span>, <span class="attr">select</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    actor: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    director: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    other_title: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    country: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    sort: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    quote: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">false</span> &#125;,</span><br><span class="line">    image: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    index: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    score: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    time: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">    title: &#123; <span class="attr">type</span>: <span class="built_in">String</span>, <span class="attr">required</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; <span class="attr">timestamps</span>: <span class="literal">true</span> &#125;,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = model(<span class="string">'doubantop250'</span>, doubantop250Schema);</span><br></pre></td></tr></table></figure>
<h2 id="controller目录"><a href="#controller目录" class="headerlink" title="controller目录"></a>controller目录</h2><p>想了解基本的CRUD操作 可以看我的博客 <a href="https://jasonxqh.github.io/2020/06/07/Nodejs基础2/#CRUD-Operations-Using-Mongoose">Nodejs基础2中的CRUD Operations Using Mongoose</a></p>
<p>里面详细介绍了增删改查的各种model. 方法</p>
<h3 id="user-js-1"><a href="#user-js-1" class="headerlink" title="user.js"></a><code>user.js</code></h3><p>我从model/user中导入了这张在数据库中的User表格。现在我们就可以对他进行我需要的后端操作了。</p>
<h4 id="login"><a href="#login" class="headerlink" title="login"></a><code>login</code></h4><p>首先是登录。前端会发一个request过来，我把里面的req.body当作我的target到User表格中去寻找，然后把结果赋值给user.如果user不存在，说明表格中不存在这一号人物，那当然返回一条name or password incorrect的json格式的信息。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jsonwebtoken = <span class="built_in">require</span>(<span class="string">'jsonwebtoken'</span>);</span><br><span class="line"><span class="keyword">const</span> User = <span class="built_in">require</span>(<span class="string">'../models/user'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; scrects &#125; = <span class="built_in">require</span>(<span class="string">'../../config'</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UsersCtl</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 登录</span></span><br><span class="line">  <span class="keyword">async</span> login(req, res) &#123;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> User.findOne(req.body);</span><br><span class="line">    <span class="keyword">if</span> (!user) &#123;</span><br><span class="line">      res.status(<span class="number">404</span>).json(&#123; <span class="attr">msg</span>: <span class="string">'name or password incorrect'</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> &#123; _id, name &#125; = user;</span><br><span class="line">    <span class="keyword">const</span> token = jsonwebtoken.sign(&#123; _id, name &#125;, scrects, &#123; <span class="attr">expiresIn</span>: <span class="string">'1d'</span> &#125;);</span><br><span class="line">    res.status(<span class="number">201</span>).json(&#123; token, name &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="register"><a href="#register" class="headerlink" title="register"></a><code>register</code></h4><p>注册函数，就是我们从前端发来的<code>req.body</code>解构出name，然后我们查询一下User表格中是否存在这个人，如果存在，那么就返回一条<code>json</code>格式的user already exist。如果名字是<code>admin</code>的话，我们就向这个人的信息中添加auth=1 来证明他是管理员。其余的，我们就利用<code>model.create</code>方法来创建这条记录，然后返回一个user的信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注册</span></span><br><span class="line"> <span class="keyword">async</span> register(req, res) &#123;</span><br><span class="line">   <span class="keyword">const</span> &#123; name &#125; = req.body;</span><br><span class="line">   <span class="keyword">const</span> repeatedUser = <span class="keyword">await</span> User.findOne(&#123; name &#125;);</span><br><span class="line">   <span class="keyword">if</span> (repeatedUser) &#123;</span><br><span class="line">     <span class="keyword">return</span> res.status(<span class="number">409</span>).json(&#123; <span class="attr">mas</span>: <span class="string">'user already exist'</span> &#125;);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (name === <span class="string">'admin'</span>) &#123; </span><br><span class="line">     req.body.auth = <span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">const</span> user = <span class="keyword">await</span> User.create(req.body);</span><br><span class="line">   res.status(<span class="number">201</span>).json(&#123; <span class="attr">data</span>: user &#125;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="getInfo"><a href="#getInfo" class="headerlink" title="getInfo"></a><code>getInfo</code></h4><p>获取user的信息。返回一条<code>json</code>格式的信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> getInfo(req, res) &#123;</span><br><span class="line">    res.status(<span class="number">201</span>).json(&#123; <span class="attr">data</span>: req.user &#125;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="findAll"><a href="#findAll" class="headerlink" title="findAll"></a><code>findAll</code></h4><p>把所有的user信息全部找到然后全部以<code>json</code>格式返回</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> findAll(req, res) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> User.find();</span><br><span class="line">  <span class="built_in">console</span>.log(data)</span><br><span class="line">  res.status(<span class="number">201</span>).json(&#123; data &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="delete"><a href="#delete" class="headerlink" title="delete"></a><code>delete</code></h4><p>删除操作，也就是管理员才能执行的删除用户的信息。</p>
<p>利用<code>model.findByIdAndRemove</code>方法来找到前端发来的request中的参数中的id信息，然后删除它并把删除的信息返回给一个result。再利用<code>json</code>的形式把result 映射data后传回</p>
<p> <a href="https://jasonxqh.github.io/2020/06/07/Nodejs基础2/#Removing-Documents">Nodejs基础2 Removing Documents</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">delete</span>(req, res) &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> User.findByIdAndRemove(req.params.id);</span><br><span class="line">    res.status(<span class="number">201</span>).json(&#123; <span class="attr">data</span>: result &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">new</span> UsersCtl();</span><br></pre></td></tr></table></figure>
<h3 id="douban-js-2"><a href="#douban-js-2" class="headerlink" title="douban.js"></a><code>douban.js</code></h3><p>我从model/douban中导入了这张在数据库中的DouBan表格。现在我们就可以对他进行我需要的后端操作了。</p>
<h4 id="getAll"><a href="#getAll" class="headerlink" title="getAll"></a><code>getAll</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> getAll(req, res) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = <span class="keyword">await</span> DouBan.find();</span><br><span class="line">  res.status(<span class="number">201</span>).json(&#123; data &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="findAll-1"><a href="#findAll-1" class="headerlink" title="findAll"></a><code>findAll</code></h4><p>这是前端显示数据是会用到的一个api</p>
<p>首先我们从request中解析出传过来的per_page也就是每页显示的电影条数，和排序的种类（升序or降序or不排序）</p>
<p>如果不排序，那么请求中sort = undefined,那么我们就不进行.sort</p>
<p>否则，我们就进行排序， 1代表升序，-1代表降序</p>
<p><strong>（小插曲）：</strong>在爬取数据的时候，数字也是按照string类型存储的，导致我一开始都在做字符串排序，1111111是小于9 的，这就很烦。然后我通过了robo 3T对mongodb进行批量修改</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.getCollection(<span class="string">'表格名字'</span>).find(&#123;<span class="string">'类型为string的字段'</span> : &#123; <span class="attr">$type</span> : <span class="number">2</span> &#125;&#125;).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    x.类型为string的字段 = NumberInt(x.类型为string的字段);<span class="comment">//转换为整型</span></span><br><span class="line">    db.getCollection(<span class="string">'表格名字'</span>).save(x);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.getCollection(<span class="string">'表格名字'</span>).find(&#123;<span class="string">'类型为string的字段'</span> : &#123; <span class="attr">$type</span> : <span class="number">2</span> &#125;&#125;).forEach(<span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">    x.类型为string的字段 = ParseInt(x.类型为string的字段);<span class="comment">//转换为小数</span></span><br><span class="line">    db.getCollection(<span class="string">'表格名字'</span>).save(x);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这样我们就完成了类型转换，从而可以对数字进行排序。</p>
<p>其次我们来计算per_page的多少，也就是至少为1条</p>
<p>然后我们计算表内总共的数据到底有几条并返回，这个在前端的<strong>分页器</strong>中需要用到，因为分页器得有总条数才能计算页数</p>
<p>最后我们在表中得到当前页面的信息，需要调过前面page*perpage条信息，然后取perpage条返回</p>
<p><a href="https://jasonxqh.github.io/2020/06/07/Nodejs基础2/#Pagination">Nodejs基础2Pagination</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jsonwebtoken = <span class="built_in">require</span>(<span class="string">'jsonwebtoken'</span>);</span><br><span class="line"><span class="keyword">const</span> DouBan = <span class="built_in">require</span>(<span class="string">'../models/douban'</span>);</span><br><span class="line"><span class="keyword">const</span> &#123; scrects &#125; = <span class="built_in">require</span>(<span class="string">'../../config'</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DouBanCtl</span> </span>&#123;</span><br><span class="line">  <span class="keyword">async</span> findAll(req, res) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; per_page = <span class="number">10</span> &#125; = req.query;</span><br><span class="line">    <span class="keyword">const</span> page = <span class="built_in">Math</span>.max(req.query.page * <span class="number">1</span>, <span class="number">1</span>) - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> perPage = <span class="built_in">Math</span>.max(per_page * <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">const</span> sort = req.query.sort;</span><br><span class="line">    <span class="built_in">console</span>.log(sort);</span><br><span class="line">    <span class="keyword">const</span> total = <span class="keyword">await</span> DouBan.countDocuments();</span><br><span class="line">    <span class="keyword">if</span> (sort === <span class="string">"undefined"</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">await</span> DouBan.find()</span><br><span class="line">        .limit(perPage)</span><br><span class="line">        .skip(page * perPage);</span><br><span class="line">      res.status(<span class="number">201</span>).json(&#123; data, total &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> data = <span class="keyword">await</span> DouBan.find()</span><br><span class="line">        .sort(&#123; <span class="attr">score</span>: sort === <span class="string">"reverse"</span> ? <span class="number">1</span> : <span class="number">-1</span> &#125;)</span><br><span class="line">        .limit(perPage)</span><br><span class="line">        .skip(page * perPage);</span><br><span class="line">      res.status(<span class="number">201</span>).json(&#123; data, total &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="insertMany"><a href="#insertMany" class="headerlink" title="insertMany"></a><code>insertMany</code></h4><p>这是插入操作，是为了利用postman向云数据库插入信息，在前端并没有用到。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> insertMany(req, res) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = req.body;</span><br><span class="line">    <span class="keyword">await</span> DouBan.insertMany(data);</span><br><span class="line">    res.status(<span class="number">201</span>).json(&#123; <span class="attr">data</span>: <span class="string">'success'</span> &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="getListByKey"><a href="#getListByKey" class="headerlink" title="getListByKey"></a><code>getListByKey</code></h4><p>这是前端布尔查询中的 AND 查询，在这篇博客中<a href="https://jasonxqh.github.io/2020/06/07/React框架在作业当中的应用/">React框架在作业当中的应用</a>我已经介绍了我们把数据返回之后前端进行的渲染操作，现在我们来讲讲从前端发来请求后如何在后端获得我想要的信息。</p>
<p>在<a href="https://jasonxqh.github.io/2020/06/07/Nodejs基础2/#Regular-Expressions">Nodejs基础2Regular Expressions</a>中我初步讲了正则表达式的使用方法。</p>
<p>首先来看看请求是什么   </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Api.get(<span class="string">`/douban/getList?<span class="subst">$&#123;keyWords&#125;</span>`</span>,&#123;...&#125;);</span><br></pre></td></tr></table></figure>
<p><code>Object.keys()</code>  方法会返回一个由一个给定对象的自身<strong>可枚举属性</strong>组成的数组，数组中属性名的排列顺序和正常循环遍历该对象时返回的顺序一致 。</p>
<p><strong>$regex  </strong> 为模糊查询的字符串提供正则表达式功能</p>
<p>首先我们建立一个params对象，这个对象中将存放寻找的条件。</p>
<p> 然后我们利用forEach循环，对req.query里面，也就是前端传回来的条件(2个条件)进行操作</p>
<p>eval() 函数可计算某个字符串，并执行其中的的 JavaScript 代码。</p>
<p> ${表达式du}用来输出或者计算一个表达式的内容值</p>
<p>比如 ${3+5}，那么便会在页面上输出8</p>
<p> 比如前端传来的是  <code>电影名字：的 AND 评分：7</code></p>
<p>这时候item就是这个query的可枚举属性，也就是电影名字和评分</p>
<p>所及操作好以后结果如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">params = &#123;</span><br><span class="line">	&#123;电影名字 : <span class="regexp">/的/ig</span> &#125;,</span><br><span class="line">	&#123;评分: <span class="regexp">/7/ig</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后用params作为查找条件到豆瓣这张表里去查</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> getListByKey(req, res) &#123;</span><br><span class="line">   <span class="keyword">const</span> params = &#123;&#125;;</span><br><span class="line">   <span class="built_in">Object</span>.keys(req.query).forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">     params[item] = &#123; <span class="attr">$regex</span>: <span class="built_in">eval</span>(<span class="string">`/<span class="subst">$&#123;req.query[item]&#125;</span>/ig`</span>) &#125;;</span><br><span class="line">   &#125;);</span><br><span class="line">   <span class="built_in">console</span>.log(params);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">const</span> data = <span class="keyword">await</span> DouBan.find(params);</span><br><span class="line">   res.status(<span class="number">201</span>).json(&#123; data &#125;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="getListByOr"><a href="#getListByOr" class="headerlink" title="getListByOr"></a><code>getListByOr</code></h4><p>这是前端布尔查询中的 OR 查询，</p>
<p>在<a href="https://jasonxqh.github.io/2020/06/07/Nodejs基础2/#Logical-Query-Operators">Nodejs基础2Logical Query Operators</a>中我已经讲了or操作的符是要传入一个对象数组的。所以这里我做的工作就是把上面已经求好的<code>params</code>转换成一个对象数组。</p>
<p>同样还是用到了<code>Object.keys</code>方法，我们把<code>params</code>对象转换成<code>params2</code>对象数组</p>
<p>最后就把这个传入到 $or 键值对后面即可</p>
<p>也可以 <code>DouBan.or(params2);</code></p>
<p>这样我们返回的数据就是择一满足的了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">params2=[</span><br><span class="line">	&#123;电影名字 : <span class="regexp">/的/ig</span> &#125;,</span><br><span class="line">	&#123;评分: <span class="regexp">/7/ig</span>&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">async</span> getListByOr(req, res) &#123;</span><br><span class="line">    <span class="keyword">const</span> params = &#123;&#125;;</span><br><span class="line">    <span class="built_in">Object</span>.keys(req.query).forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      params[item] = &#123; <span class="attr">$regex</span>: <span class="built_in">eval</span>(<span class="string">`/<span class="subst">$&#123;req.query[item]&#125;</span>/ig`</span>) &#125;;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> params2 = [];</span><br><span class="line">    <span class="built_in">Object</span>.keys(params).forEach(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> obj = &#123;&#125;;</span><br><span class="line">      obj[item] = params[item];</span><br><span class="line">      params2.push(obj);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(params, params2);</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> DouBan.find(&#123; <span class="attr">$or</span>: params2 &#125;);</span><br><span class="line">    res.status(<span class="number">201</span>).json(&#123; data &#125;);	</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">new</span> DouBanCtl();</span><br></pre></td></tr></table></figure>
<h3 id="operas-js"><a href="#operas-js" class="headerlink" title="operas.js"></a><code>operas.js</code></h3><p>因为已经完成基本操作了，现在我们就拓展一下内容，做一个新建operas 的操作（其实也hin简单）</p>
<p>前端实现请看 ，这里讲一下后端收到前端发来的表单请求该怎么把这条新建的信息插入到mongodb当中去？</p>
<p>我们知道所有的信息都藏在 req.body当中，那么我们只要用 . 把他们都提取出来，然后新建一个Operas对象即可</p>
<p>最后通过opera.save()来实现保存操作</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> create(req, res) &#123;</span><br><span class="line">   <span class="keyword">const</span> opera = <span class="keyword">new</span> Operas(&#123;</span><br><span class="line">       title: req.body.title,</span><br><span class="line">       actors: req.body.actors,</span><br><span class="line">       country: req.body.country,</span><br><span class="line">       type: req.body.type,</span><br><span class="line">       single: req.body.single,</span><br><span class="line">       first_date: req.body.first_date</span><br><span class="line">   &#125;)</span><br><span class="line">   <span class="keyword">const</span> result = <span class="keyword">await</span> opera.save();</span><br><span class="line">   <span class="built_in">console</span>.log(result)</span><br><span class="line">   res.status(<span class="number">201</span>).json(&#123; result &#125;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="middleware目录"><a href="#middleware目录" class="headerlink" title="middleware目录"></a><code>middleware</code>目录</h2><h3 id="auth-handlers"><a href="#auth-handlers" class="headerlink" title="auth-handlers"></a><code>auth-handlers</code></h3><p>这是用来认证的一个中间件，中间件的写法我在 <a href="https://jasonxqh.github.io/2020/06/07/Nodejs基础1/#Middleware">Nodejs基础1的Middleware章节</a> 中详细说了，这里简单讲一下他的逻辑</p>
<p>就是判断请求体重user的名字是不是admin，如果是的话，什么也不做，把控制权交给下一个中间件或者函数</p>
<p>如果不是的话，那就返回一个状态码500</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> User = <span class="built_in">require</span>(<span class="string">'../models/user'</span>);</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">'jsonwebtoken'</span>);</span><br><span class="line"><span class="keyword">var</span> config = <span class="built_in">require</span>(<span class="string">'../../config'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">authAdmin</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(req.user.name !== <span class="string">'admin'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.status(<span class="number">500</span>).send(<span class="string">'no authority '</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  next()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  authAdmin,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="error-handlers"><a href="#error-handlers" class="headerlink" title="error-handlers"></a><code>error-handlers</code></h3><p>这是一个开源的检查错误的文档。里面集成了一些中间件</p>
<p><a href="https://github.com/wesbos/Learn-Node/blob/master/stepped-solutions/45%20-%20Finished%20App/handlers/errorHandlers.js" target="_blank" rel="noopener">https://github.com/wesbos/Learn-Node/blob/master/stepped-solutions/45%20-%20Finished%20App/handlers/errorHandlers.js</a></p>
<p>我们主要用它来检查 异步操作的问题，验证路由，和用户验证的问题</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  With async/await, you need some way to catch errors</span></span><br><span class="line"><span class="comment">  Instead of using try&#123;&#125; catch(e) &#123;&#125; in each controller, we wrap the function in</span></span><br><span class="line"><span class="comment">  catchErrors(), catch and errors they throw, and pass it along to our express </span></span><br><span class="line"><span class="comment">  middleware with next()</span></span><br><span class="line"><span class="comment"> * Handler to catch `async` operation errors.</span></span><br><span class="line"><span class="comment"> * Reduces having to write `try-catch` all the time.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">exports.catchErrors = <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    action(req, res).catch(next)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Handle any invalid routes.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">exports.invalidRoute = <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> err = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Invalid route: '</span> + req.method + <span class="string">':'</span> + req.route)</span><br><span class="line">  err.status = <span class="number">404</span></span><br><span class="line">  next(err)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Validation error handler for Mongo.</span></span><br><span class="line"><span class="comment"> * The client app should handle displaying the errors.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">exports.validationErrors = <span class="function">(<span class="params">err, req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// catch unique field error</span></span><br><span class="line">  <span class="keyword">if</span> (err.code &amp;&amp; err.code === <span class="number">11000</span>) &#123;</span><br><span class="line">    err.status = <span class="number">400</span></span><br><span class="line">    err.message = err.errmsg</span><br><span class="line">    <span class="keyword">return</span> next(err)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!err.errors) &#123;</span><br><span class="line">    <span class="keyword">return</span> next(err)</span><br><span class="line">  &#125;</span><br><span class="line">  res.status(<span class="number">400</span>).json(&#123;</span><br><span class="line">    status: <span class="number">400</span>,</span><br><span class="line">    error: err.errors,</span><br><span class="line">    data: &#123;&#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/08/%E6%B5%85%E8%B0%88redux1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/08/%E6%B5%85%E8%B0%88redux1/" class="post-title-link" itemprop="url">浅谈redux1</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-08 00:08:29" itemprop="dateCreated datePublished" datetime="2020-06-08T00:08:29+08:00">2020-06-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-10 00:18:22" itemprop="dateModified" datetime="2020-06-10T00:18:22+08:00">2020-06-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="浅谈redux1"><a href="#浅谈redux1" class="headerlink" title="浅谈redux1"></a>浅谈redux1</h1><p>学习自阮一峰的博客</p>
<p><a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html" target="_blank" rel="noopener">阮一峰的技术博客1</a> </p>
<p><a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_two_async_operations.html" target="_blank" rel="noopener">阮一峰的技术博客2</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_three_react-redux.html" target="_blank" rel="noopener">阮一峰的技术博客3</a></p>
<p>和<a href="https://www.bilibili.com/video/BV1K7411U7P5" target="_blank" rel="noopener">b站Mosh教程</a></p>
<h2 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h2><h3 id="What-is-Redux"><a href="#What-is-Redux" class="headerlink" title="What is Redux"></a>What is Redux</h3><p>Redu是JavaScript应用程序的状态管理库.我们可以在React,Angular,Vue甚至原生JS中都能用</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/1.png" style="zoom: 50%;"></p>
<p>为什么需要Redux？ 如果我们曾经建立了一个带有复杂的用户界面的应用程序。我们需要保持不同部分UI显示上的同步。如果我们通过普通的数据流的方式，需要用很多代码，很复杂的逻辑，甚至进入一个死循环。所以我们需要一个状态管理库。</p>
<p>与其读取不同UI组件的状态变量，不如把他们都放到一个地方（store)</p>
<p>使用了这种架构，不同的ui将不再保存自己的状态，相反他们从仓库中得到状态信息。如果有必要更新某个数据，我们就从Store中去拿。这样能立刻解决不同UI的数据共享问题</p>
<p>Redux页很容易让我们理解应用程序的数据变化</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/2.png" style="zoom: 50%;"></p>
<h3 id="Pros-and-Cons-of-Redux"><a href="#Pros-and-Cons-of-Redux" class="headerlink" title="Pros and Cons of Redux"></a>Pros and Cons of Redux</h3><p>这里有一个购物车式的软件。如果我们商品的数量增加了，那么Price也会随之增加，总计也会随之增加</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/3.png" style="zoom: 50%;"></p>
<p>这是因为我们有一个单一的仓库，保存应用程序的所有状态</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/4.png" style="zoom: 45%;"></p>
<p> Redux的优缺点</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/5.png" style="zoom: 45%;"></p>
<h3 id="Is-Redux-for-You"><a href="#Is-Redux-for-You" class="headerlink" title="Is Redux for You"></a>Is Redux for You</h3><p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/6.png" style="zoom: 45%;"></p>
<p>webpack文件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">"path"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//Webpack会从这个文件开始，然后搜索出所有的js文件，把他们合并成app.js</span></span><br><span class="line">    <span class="comment">//他会重新保存在dist文件夹中</span></span><br><span class="line">  entry: <span class="string">"./src/index.js"</span>,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">"app.js"</span>,</span><br><span class="line">    path: path.resolve(__dirname, <span class="string">"dist"</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">    <span class="comment">//这是服务器的配置，我们告诉webpack 从这个文件夹加载应用程序，端口号为9000</span></span><br><span class="line">  devServer: &#123;</span><br><span class="line">    contentBase: path.join(__dirname, <span class="string">"dist"</span>),</span><br><span class="line">    port: <span class="number">9000</span></span><br><span class="line">  &#125;,</span><br><span class="line">  mode: <span class="string">"development"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="Functional-Programming-in-JavaScript-函数式编程"><a href="#Functional-Programming-in-JavaScript-函数式编程" class="headerlink" title="Functional Programming in JavaScript  函数式编程"></a>Functional Programming in JavaScript  函数式编程</h2><h3 id="What-is-Functional-Programming"><a href="#What-is-Functional-Programming" class="headerlink" title="What is Functional Programming"></a>What is Functional Programming</h3><p>函数式编程是众多编程范式，或者说风格的一种：OOP，Functional，事件驱动…</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/7.png" style="zoom: 60%;"></p>
<p>函数式编程，就是使用一些可以复用的函数组合来解决问题。这些函数接收输入并返回结果，他们不修改原始数据。有了这样的原则，我们可以将这些函数组合成更复杂的函数</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/8.png" style="zoom: 60%;"></p>
<h3 id="Functions-as-First-class-Citizens"><a href="#Functions-as-First-class-Citizens" class="headerlink" title="Functions as First-class Citizens"></a>Functions as First-class Citizens</h3><p>函数式js中的一等公民，也就是说他们可以用在任何地方。我们可以把它赋值给变量，我们可以把它们当作参数传入，可以作为返回值</p>
<h3 id="Higher-order-Functions"><a href="#Higher-order-Functions" class="headerlink" title="Higher-order Functions"></a>Higher-order Functions</h3><p>Higher-order functions就是说吧函数作为一个参数，或者把函数作为一个返回值，或者两者都有的函数。不同于处理字符串，数字，他们以更高级的方式处理函数</p>
<p>比如说map函数，它接收一个函数作为它的参数</p>
<p>setTimeout()也是一个Higher-order function</p>
<h3 id="Function-Composition"><a href="#Function-Composition" class="headerlink" title="Function Composition"></a>Function Composition</h3><p>最理想的函数式编程，就是创造一些函数，将这些函数组合成更复杂的函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> input = <span class="string">"  javascript  "</span>;</span><br><span class="line"><span class="keyword">let</span> output = <span class="string">"&lt;div&gt;"</span> + input.trim()+<span class="string">"&lt;/div&gt;"</span></span><br></pre></td></tr></table></figure>
<p>我们通过函数式编程改写</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> trim = <span class="function"><span class="params">str</span>=&gt;</span>str.trim();</span><br><span class="line"><span class="keyword">const</span> wrapInDiv = <span class="function"><span class="params">str</span> =&gt;</span><span class="string">`&lt;div&gt;<span class="subst">$&#123;str&#125;</span>&lt;/div&gt;`</span></span><br><span class="line"><span class="keyword">const</span> toLowerCase = <span class="function"><span class="params">str</span>=&gt;</span>str.toLowerCase();</span><br><span class="line"><span class="keyword">const</span> result=wrapInDiv(toLowerCase(trim(input)))</span><br></pre></td></tr></table></figure>
<h3 id="Composing-and-Piping"><a href="#Composing-and-Piping" class="headerlink" title="Composing and Piping"></a>Composing and Piping</h3><p>但是随着函数的复杂性增加，这些小括号会越来越多。</p>
<p>借助<a href="https://lodash.com/docs/4.17.15" target="_blank" rel="noopener">loadash库</a>来简化,他包含了很多针对函数式编程的包</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;compose,pipe&#125; <span class="keyword">from</span> <span class="string">"lodash/fp"</span></span><br><span class="line"><span class="keyword">let</span> input = <span class="string">"  javascript  "</span>;</span><br><span class="line"><span class="keyword">const</span> trim = <span class="function"><span class="params">str</span>=&gt;</span>str.trim();</span><br><span class="line"><span class="keyword">const</span> wrapInDiv = <span class="function"><span class="params">str</span> =&gt;</span><span class="string">`&lt;div&gt;<span class="subst">$&#123;str&#125;</span>&lt;/div&gt;`</span></span><br><span class="line"><span class="keyword">const</span> toLowerCase = <span class="function"><span class="params">str</span>=&gt;</span>str.toLowerCase();</span><br><span class="line"><span class="keyword">const</span> transform = compose(wrapInDiv,toLowerCase,trim);</span><br><span class="line">transform(input)</span><br></pre></td></tr></table></figure>
<p>compose 也是一个 higer -order Functions,因为他传入了三个函数并返回了一个新的包含了这几个参数的函数。</p>
<p>但是特别要注意处理顺序，compose函数是要从右向左执行。</p>
<p>我们可以通过pipe函数来达到我们觉得舒服的从左向右执行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> transform = pipe(trim,toLowerCase,wrapInDiv);</span><br><span class="line">transform(input)</span><br></pre></td></tr></table></figure>
<h3 id="Currying-curry化"><a href="#Currying-curry化" class="headerlink" title="Currying curry化"></a>Currying curry化</h3><p>我在原来的基础上再新建一个函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapInSpan = <span class="function"><span class="params">str</span> =&gt;</span><span class="string">`&lt;span&gt;<span class="subst">$&#123;str&#125;</span>&lt;/span&gt;`</span></span><br></pre></td></tr></table></figure>
<p>但是因为这个和wrapInSpan长得很像，所以我们可以对两者模板化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrap = <span class="function">(<span class="params">type,str</span>)=&gt;</span>&#123;<span class="string">`&lt;type&gt;<span class="subst">$&#123;str&#125;</span>&lt;/type&gt;`</span>&#125;</span><br></pre></td></tr></table></figure>
<p>但这样直接输出以后是\<javascript\>undefined\<javascript\></javascript\></javascript\></p>
<p>是因为wrap会把传入的JavaScript当成第一个type，我们同样也不能pipe(trim,toLowerCase,wrap(“div”));因为这实际上是调用了wrap并传入了div</p>
<p>这时候我们就需要curry化。curry化允许将多个参数传入，然后转化为只需要一个参数的函数.所以我们吧原来的返回一个字符串或者是数字的函数改成一个返回一个函数的函数.</p>
<p>在curry化之后，我们不是用逗号来分隔参数了，我们使用括号来分隔</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a+b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>curry化之后</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>(<span class="params">a</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">b</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> a+b;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">add(<span class="number">1</span>)(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>用箭头函数简化后</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> add2 = <span class="function"><span class="params">a</span>=&gt;</span><span class="function"><span class="params">b</span>=&gt;</span>a+b;</span><br></pre></td></tr></table></figure>
<p>所以我们对wrap函数进行改造</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrap = <span class="function">(<span class="params">type</span>) =&gt;</span> <span class="function">(<span class="params">str</span>) =&gt;</span> <span class="string">`&lt;<span class="subst">$&#123;type&#125;</span>&gt;<span class="subst">$&#123;str&#125;</span>&lt;/<span class="subst">$&#123;type&#125;</span>&gt;`</span>;</span><br></pre></td></tr></table></figure>
<p>现在，</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> transform = pipe(trim,toLowerCase,wrap(<span class="string">"div"</span>));</span><br><span class="line"><span class="built_in">console</span>.log(transform(input))</span><br></pre></td></tr></table></figure>
<p>打印出来的就是 \<div\>javascript\&lt;/div> 现在想换成span标签，只要把div改成span即可</div\></p>
<h3 id="Pure-Functions"><a href="#Pure-Functions" class="headerlink" title="Pure Functions"></a>Pure Functions</h3><p>纯函数就是我每次传入相同的参数的话，他就返回一个相同的值。很多函数都是纯函数，但是随机函数就不是.如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunction</span>(<span class="params">number</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> number * <span class="built_in">Math</span>.random();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/9.png" style="zoom: 60%;"></p>
<p>redux中reducer就是一个纯函数。纯函数中的参数不能够变化。</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/10.png" style="zoom: 60%;"></p>
<p>自述性：因为所有的这个函数需要的东西在声明的时候已经都说清楚了</p>
<p>易测试:  因为我无需去设置某些全局状态用来测试这个函数</p>
<p>独立的：无需去设置某些全局状态</p>
<p>可缓存的：我们可以保留函数的运算结果</p>
<h3 id="Immutability"><a href="#Immutability" class="headerlink" title="Immutability"></a>Immutability</h3><p>一旦创建，无法改变，如果想修改对象，那么就要复制他，然后再修改它的样本。js中可以修改对象和数组，所以js不是严格意义上的函数式的编程语言。</p>
<p>js中为了达到函数式语言的特性，可以利用const ，const的作用是防止再次赋值，但是可以修改对象中的属性</p>
<p><strong>不可变的好处：</strong></p>
<p><strong>可预测性</strong>：减少了突发情况</p>
<p><strong>更快的感知变化</strong>: <img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/11.png" style="zoom: 60%;"></p>
<p><strong>并发性</strong>：如果我们知道函数不会修改对象本身，我们就知道实现多任务是安全的。不会因多重加载对象而造成整个系统的混乱。</p>
<p>但是不可变的对象也会带来一些问题：</p>
<p><strong>带来潜在的性能消耗</strong>：我们每次修改对象，所有原对象的字段都要复制到新的对象。可能会减慢速度</p>
<p><strong>内存消耗</strong>：</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/12.png" style="zoom: 60%;"></p>
<h3 id="Updating-Objects"><a href="#Updating-Objects" class="headerlink" title="Updating Objects"></a>Updating Objects</h3><p>我们如果要更新对象的话 用spread运算符</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;<span class="attr">name</span>:<span class="string">"John"</span>&#125;;</span><br><span class="line"><span class="keyword">const</span> updated = &#123;...person&#125;;<span class="comment">// &#123;...person，name:"Bob"&#125;也可以加上别的信息</span></span><br></pre></td></tr></table></figure>
<p>注意，这里的拷贝都是浅拷贝，也就是把地址一摸一样的拷贝回来了，所以这样在修改数组的时候，两个地方都会修改，所以要利用深拷贝</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">	name:<span class="string">"John"</span>,</span><br><span class="line">	address:&#123;</span><br><span class="line">		country:<span class="string">"USA"</span>,</span><br><span class="line">		city:<span class="string">"San Francisco"</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> updated = &#123;</span><br><span class="line">	...person,</span><br><span class="line">	address:&#123;</span><br><span class="line">	...person.address,</span><br><span class="line">	city:<span class="string">"New York"</span></span><br><span class="line">	&#125;,</span><br><span class="line">	name:<span class="string">"Bob"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>我们可以看到这样随着嵌套的增多，深拷贝会变得很麻烦。所以我们需要专门实现不可能变性的库</p>
<h3 id="Updating-Arrays"><a href="#Updating-Arrays" class="headerlink" title="Updating Arrays"></a>Updating Arrays</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> numbers = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="comment">//adding</span></span><br><span class="line"><span class="keyword">const</span> added = [...numbers,<span class="number">4</span>];</span><br><span class="line"><span class="comment">// particular position </span></span><br><span class="line"><span class="keyword">const</span> index = numbers.indexOf(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">const</span> added2 = [...numbers.slice(<span class="number">0</span>,index),</span><br><span class="line">              <span class="number">4</span>,</span><br><span class="line">              ...numbers.slice(index)]</span><br><span class="line"><span class="built_in">console</span>.log(added2) <span class="comment">// 1,4,2,3</span></span><br><span class="line"><span class="comment">//remove</span></span><br><span class="line"><span class="keyword">const</span> removed = numbers.filter(<span class="function"><span class="params">n</span>=&gt;</span>n!==<span class="number">2</span>);</span><br><span class="line"><span class="comment">//Updating </span></span><br><span class="line"><span class="keyword">const</span> updated = numbers.map(<span class="function"><span class="params">n</span>=&gt;</span>n===<span class="number">2</span>?<span class="number">20</span>:n)</span><br></pre></td></tr></table></figure>
<h3 id="Enforcing-Immutability"><a href="#Enforcing-Immutability" class="headerlink" title="Enforcing Immutability"></a>Enforcing Immutability</h3><p>不变的库</p>
<p><strong>immutable</strong> 提供了很多不变的数据结构，因为我们不希望有可变的对象</p>
<p><strong>immer</strong></p>
<p><strong>mori</strong></p>
<h3 id="Immutable-js"><a href="#Immutable-js" class="headerlink" title="Immutable.js"></a>Immutable.js</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="built_in">Map</span> &#125; <span class="keyword">from</span> <span class="string">"immutable"</span>;</span><br><span class="line"><span class="keyword">let</span> book = <span class="built_in">Map</span>(&#123; <span class="attr">title</span>: <span class="string">"Harry Potter"</span> &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(book);</span><br></pre></td></tr></table></figure>
<p>这样这个对象就是不可改变的了，但是获取对象内的属性变得有点困难，需要用get方法。而且如果要转化到原生js语言还需要toJS()比较烦</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="built_in">Map</span> &#125; <span class="keyword">from</span> <span class="string">"immutable"</span>;</span><br><span class="line"><span class="keyword">let</span> book = <span class="built_in">Map</span>(&#123; <span class="attr">title</span>: <span class="string">"Harry Potter"</span> &#125;);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">publish</span>(<span class="params">book</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> book.set(<span class="string">"isPublished"</span>,<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line">book = publish(book)</span><br><span class="line"><span class="built_in">console</span>.log(book.toJS());</span><br></pre></td></tr></table></figure>
<h3 id="Immer"><a href="#Immer" class="headerlink" title="Immer"></a>Immer</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; produce &#125; <span class="keyword">from</span> <span class="string">"immer"</span>;</span><br><span class="line"><span class="keyword">let</span> book = &#123; <span class="attr">title</span>: <span class="string">"Harry Potter"</span> &#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">publish</span>(<span class="params">book</span>) </span>&#123;</span><br><span class="line"><span class="comment">// draftBook只是复制了book对象然后在里面进行修改，我们返回的是修改过后的函数，这比spread方便</span></span><br><span class="line">  <span class="keyword">return</span> produce(book, (draftBook) =&gt; &#123;</span><br><span class="line">    draftBook.isPublished = <span class="literal">true</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> updated = publish(book);</span><br><span class="line"><span class="built_in">console</span>.log(book);</span><br><span class="line"><span class="built_in">console</span>.log(updated);</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/13.png" style="zoom:80%;"></p>
<h3 id="Quiz"><a href="#Quiz" class="headerlink" title="Quiz"></a>Quiz</h3><p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/14.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/15.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/16.png" style="zoom: 67%;"></p>
<h3 id="Coding-Challenges"><a href="#Coding-Challenges" class="headerlink" title="Coding Challenges"></a>Coding Challenges</h3><p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/17.png" style="zoom: 80%;"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; pipe &#125; <span class="keyword">from</span> <span class="string">"lodash/fp"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> pickTag = <span class="function"><span class="params">obj</span> =&gt;</span> obj.tag;</span><br><span class="line"><span class="keyword">const</span> toLowerCase = <span class="function"><span class="params">str</span> =&gt;</span> str.toLowerCase();</span><br><span class="line"><span class="keyword">const</span> bracketify = <span class="function"><span class="params">str</span> =&gt;</span> <span class="string">`(<span class="subst">$&#123;str&#125;</span>)`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> transform = pipe(pickTag, toLowerCase, bracketify);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> output = transform(&#123; <span class="attr">tag</span>: <span class="string">"JAVASCRIPT"</span> &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(output);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> recipe = &#123;</span><br><span class="line">  name: <span class="string">"Spaghetti Bolognese"</span>,</span><br><span class="line">  ingredients: [<span class="string">"egg"</span>, <span class="string">"salt"</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add an ingredient</span></span><br><span class="line"><span class="keyword">const</span> added = &#123;</span><br><span class="line">  ...recipe,</span><br><span class="line">  ingredients: [...recipe.ingredients, <span class="string">"cream"</span>]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Update an ingredient</span></span><br><span class="line"><span class="keyword">const</span> updated = &#123;</span><br><span class="line">  ...recipe,</span><br><span class="line">  ingredients: recipe.ingredients.map(<span class="function"><span class="params">ingredient</span> =&gt;</span></span><br><span class="line">    ingredient === <span class="string">"egg"</span> ? <span class="string">"egg white"</span> : ingredient</span><br><span class="line">  )</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Remove an ingredient</span></span><br><span class="line"><span class="keyword">const</span> removed = &#123;</span><br><span class="line">  ...recipe,</span><br><span class="line">  ingredients: recipe.ingredients.filter(<span class="function"><span class="params">ingredient</span> =&gt;</span> ingredient !== <span class="string">"egg"</span>)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="Redux-Fundamentals"><a href="#Redux-Fundamentals" class="headerlink" title="Redux Fundamentals"></a>Redux Fundamentals</h2><h3 id="Redux-Architecture"><a href="#Redux-Architecture" class="headerlink" title="Redux Architecture"></a>Redux Architecture</h3><p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/18.png" style="zoom: 67%;"></p>
<p>比如在一个 购物软件中有这样一个对象,对象中可以存放任何类型</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	categories:[],</span><br><span class="line">	products:[],</span><br><span class="line">	cart:&#123;&#125;,</span><br><span class="line">	user:&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们不能直接改变store，因为Redux是建立在函数式编程之上的。在函数式编程中不能改变对象。如果需要改变对象需要编写一个函数然后通过一些库或者…运算符在原对象基础上形成一个新的对象。那么这个函数就被称之为reducer.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">store</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">const</span> updated = &#123;...store&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>reducer从store中获取 current instance of store and return a data store。</p>
<p>现在问题来了，reducer是怎么知道store中的那些属性需要修改呢？这时候我们引入了action,action就是一个对象，它描述了刚刚发生了什么：用户登陆了，登出了，向购物车加了什么东西了之类的，也就是app中可能发生的事件。所以我们传入reducer还应该有第二个参数action</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">store,action</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">const</span> updated = &#123;...store&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下图截取自<a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html" target="_blank" rel="noopener">阮一峰的技术博客1</a> </p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/19.png" style="zoom: 67%;"></p>
<p>每一个reducer掌管一个store中的内容，在阮一峰的博客中写道：Reducer 函数负责生成 State。由于整个应用只有一个 State 对象，包含所有数据，对于大型应用来说，这个 State 必然十分庞大，导致 Reducer 函数也十分庞大。上面代码中，三种 Action 分别改变 State 的三个属性。</p>
<blockquote>
<ul>
<li>ADD_CHAT：<code>chatLog</code>属性</li>
<li>CHANGE_STATUS：<code>statusMessage</code>属性</li>
<li>CHANGE_USERNAME：<code>userName</code>属性</li>
</ul>
</blockquote>
<p>这三个属性之间没有联系，这提示我们可以把 Reducer 函数拆分。不同的函数负责处理不同属性，最终把它们合并成一个大的 Reducer 即可。</p>
<p>所以我们可以有多个reducer，也可以只有一个，取决于store中数据的多少</p>
<p>可以这样来理解：Action是event，Reducer是Event Handler。Reducer只是一个纯函数，他只是接收action然后返回更新过后的store中的值</p>
<p>现在我们用一个例子来描述一样redux的机制：</p>
<p>当我们向购物车里增加了一件商品的时候，我们创建了一个action然后dispatch(调遣)了它给<code>Store</code>, <code>Reducer</code> 函数不用手动调用，<code>store.dispatch</code>方法会触发 <code>Reducer</code> 的自动执行。为此，<code>Store</code> 需要知道 Reducer 函数Store 收到 Action 以后，必须给出一个新的 State，这样 UI 才会发生变化。</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/20.png" style="zoom: 67%;"></p>
<h3 id="Your-First-Redux-App"><a href="#Your-First-Redux-App" class="headerlink" title="Your First Redux App"></a>Your First Redux App</h3><p>这是我们要建的redux应用</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/21.png" style="zoom: 50%;"></p>
<p>这是我们构建redux的步骤</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/22.png" style="zoom: 50%;"></p>
<p>npm i redux@4.0</p>
<h3 id="Designing-the-Store"><a href="#Designing-the-Store" class="headerlink" title="Designing the Store"></a>Designing the Store</h3><p>我们要建一个store，就要搞清楚Store要存放什么数据。分析一下上面的ui我们可以这样写一个结构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">	&#123;</span><br><span class="line">		id:<span class="number">1</span>,</span><br><span class="line">		description:<span class="string">""</span>,</span><br><span class="line">		resolved: <span class="literal">false</span></span><br><span class="line">	&#125;,</span><br><span class="line">	&#123;...&#125;,</span><br><span class="line">	&#123;...&#125;,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>在real-world app中,我们可以这样写， this store has  two slices . 在没有登陆的时候currentUser为null，登陆了以后把它设置成一个包含了登录信息的对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">	bugs:&#123;</span><br><span class="line">		id:<span class="number">1</span>,</span><br><span class="line">		description:<span class="string">""</span>,</span><br><span class="line">		resolved: <span class="literal">false</span></span><br><span class="line">	&#125;,</span><br><span class="line">	currentUser:&#123;&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h3 id="Defining-the-Actions"><a href="#Defining-the-Actions" class="headerlink" title="Defining the Actions"></a>Defining the Actions</h3><p>现在我们来定义一个Action，在这个app当中我们可以写这样几个actions,在 real-world app中我们会有更多其它的actions</p>
<p><img src="/2020/06/08/%E6%B5%85%E8%B0%88redux1/23.png" style="zoom: 50%;"></p>
<p>之前说了Action 是一个对象。其中的<code>type</code>属性是必须的，表示 Action 的名称。其他属性可以自由设置，社区有一个<a href="https://github.com/acdlite/flux-standard-action" target="_blank" rel="noopener">规范</a>可以参考。 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	type:<span class="string">"ADD_BUG"</span>,</span><br><span class="line"> <span class="comment">// type:"bugAdded"</span></span><br><span class="line">	descriptionL:<span class="string">"..."</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	type:<span class="string">"ADD_BUG"</span>,</span><br><span class="line">    payload:&#123;</span><br><span class="line">    	id:<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Creating-a-Reducer"><a href="#Creating-a-Reducer" class="headerlink" title="Creating a Reducer"></a>Creating a Reducer</h3><h3 id="Creating-the-Store"><a href="#Creating-the-Store" class="headerlink" title="Creating the Store"></a>Creating the Store</h3><h3 id="Dispatching-Actions"><a href="#Dispatching-Actions" class="headerlink" title="Dispatching Actions"></a>Dispatching Actions</h3><h3 id="Subscribing-to-the-Store"><a href="#Subscribing-to-the-Store" class="headerlink" title="Subscribing to the Store"></a>Subscribing to the Store</h3><h3 id="Action-Types"><a href="#Action-Types" class="headerlink" title="Action Types"></a>Action Types</h3><h3 id="Action-Creators"><a href="#Action-Creators" class="headerlink" title="Action Creators"></a>Action Creators</h3><h3 id="Exercise"><a href="#Exercise" class="headerlink" title="Exercise"></a>Exercise</h3><h3 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h3><h2 id="Building-Redux-from-Scratch"><a href="#Building-Redux-from-Scratch" class="headerlink" title="Building Redux from Scratch"></a>Building Redux from Scratch</h2><h3 id="Redux-Store"><a href="#Redux-Store" class="headerlink" title="Redux Store"></a>Redux Store</h3><h3 id="Private-Properties"><a href="#Private-Properties" class="headerlink" title="Private Properties"></a>Private Properties</h3><h3 id="Dispatching-Actions-1"><a href="#Dispatching-Actions-1" class="headerlink" title="Dispatching Actions"></a>Dispatching Actions</h3><h3 id="Subscribing-to-the-Store-1"><a href="#Subscribing-to-the-Store-1" class="headerlink" title="Subscribing to the Store"></a>Subscribing to the Store</h3><h3 id="A-Quick-Note"><a href="#A-Quick-Note" class="headerlink" title="A Quick Note"></a>A Quick Note</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/" class="post-title-link" itemprop="url">React框架在作业当中的应用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-07 20:59:03" itemprop="dateCreated datePublished" datetime="2020-06-07T20:59:03+08:00">2020-06-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-29 21:42:12" itemprop="dateModified" datetime="2020-06-29T21:42:12+08:00">2020-06-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index"><span itemprop="name">react</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="React框架在作业当中的应用"><a href="#React框架在作业当中的应用" class="headerlink" title="React框架在作业当中的应用"></a>React框架在作业当中的应用</h1><p>本篇博客随时会引用这四篇博客中实现的功能与技术。</p>
<p>鉴于基础博客的篇幅都比较长，<strong>为了有良好的阅读体验</strong>，本文所有的链接点击即可<strong>跳转至相应章节</strong>。</p>
<p><a href="https://jasonxqh.github.io/2020/05/30/react基础/#more">react基础1组件与组合组件</a></p>
<p><a href="https://jasonxqh.github.io/2020/06/02/react基础2/">react基础2分页排序搜索+路由</a></p>
<p> <a href="https://jasonxqh.github.io/2020/06/04/react基础3/">react基础3表单与后端</a></p>
<p><a href="https://jasonxqh.github.io/2020/06/05/react基础4授权与部署/">react基础4授权与部署</a></p>
<h2 id="根目录"><a href="#根目录" class="headerlink" title="根目录"></a>根目录</h2><h3 id="index-js"><a href="#index-js" class="headerlink" title="index.js"></a><code>index.js</code></h3><p><code>index.js</code>加载了<code>App</code>，所以也要着重关注</p>
<p><a href="https://www.cnblogs.com/sameen/p/9182925.html" target="_blank" rel="noopener">关于react-redux中Provider、connect的解析</a></p>
<p>阮一峰的博客中也有对Provider的解释</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createStore, applyMiddleware &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> thunkMiddleware <span class="keyword">from</span> <span class="string">'redux-thunk'</span>;</span><br><span class="line"><span class="keyword">import</span> loggerMiddleware <span class="keyword">from</span> <span class="string">'./store/middleware/logger'</span>;</span><br><span class="line"><span class="keyword">import</span> rootReducer <span class="keyword">from</span> <span class="string">'./store'</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./page/App.jsx'</span>;</span><br><span class="line"><span class="comment">//Store 就是保存数据的地方，你可以把它看成一个容器。整个应用只能有一个 Store。</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Provider是react-redux 提供的一个 React 组件</span></span><br><span class="line"><span class="comment">作用就是把 store 提供给其子组件</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> store = createStore(rootReducer, applyMiddleware(thunkMiddleware, loggerMiddleware));</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;<span class="regexp">/Provider&gt;,</span></span><br><span class="line"><span class="regexp">  document.getElementById('root'),</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>
<h3 id="setupProxy-js"><a href="#setupProxy-js" class="headerlink" title="setupProxy.js"></a><code>setupProxy.js</code></h3><p>这个文件的目的是设置一个代理。前端启动端口是3000，后端是8080，这样就会跨域，前端做一个代理，把所有api的接口请求都转发到8080端口。这样就能把所有的请求都转发到你起的后端的服务上了</p>
<p><a href="https://www.jianshu.com/p/a2a5163fefac" target="_blank" rel="noopener">参考react配置多个代理,跨域</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> proxy = <span class="built_in">require</span>(<span class="string">'http-proxy-middleware'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">app</span>) </span>&#123;</span><br><span class="line">  app.use(proxy(<span class="string">'/api'</span>, &#123; <span class="attr">target</span>: <span class="string">'http://localhost:8080/'</span> &#125;));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="服务"><a href="#服务" class="headerlink" title="服务"></a>服务</h2><h3 id="Api-js"><a href="#Api-js" class="headerlink" title="Api.js"></a><code>Api.js</code></h3><p>可以使用自定义配置新建一个 axios 实例,自定义实例默认值</p>
<p>比如后端接口的完整的路径是：<code>localhost:8080/api/users/list</code> ，我把所有的请求公共部分，<code>localhost:8080/api</code> 抽出来，放在axios的baseURL里面，这样在代码里面，就不用每次都写<code>localhost:8080/api</code>这样的开头了。降低了代码的耦合度</p>
<p>假如有一天，后端改了api的开头，改了端口号，都不用一个个在代码里面一个个改了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;</span><br><span class="line"><span class="keyword">const</span> Api = axios.create(&#123;</span><br><span class="line">  baseURL: <span class="string">'http://localhost:8080/api/'</span>,</span><br><span class="line">  <span class="comment">// timeout: ,</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Api;</span><br></pre></td></tr></table></figure>
<p><a href="http://www.axios-js.com/zh-cn/docs/#axios-create-config" target="_blank" rel="noopener">可以参照axios官方文档</a></p>
<h3 id="Util-js"><a href="#Util-js" class="headerlink" title="Util.js"></a><code>Util.js</code></h3><p>这相当于<a href="https://jasonxqh.github.io/2020/06/05/react基础4授权与部署/#Refactoring">react基础4授权与部署中的authService</a>中存取token的操作</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Util = &#123;</span><br><span class="line">  <span class="comment">// 登录后将token存到localStorage中</span></span><br><span class="line">  <span class="keyword">async</span> setToken(token) &#123;</span><br><span class="line">    <span class="keyword">await</span> localStorage.setItem(<span class="string">'token'</span>, token);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 取出localStorage中的token</span></span><br><span class="line">  getToken() &#123;</span><br><span class="line">    <span class="keyword">return</span> localStorage.getItem(<span class="string">'token'</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Util;</span><br></pre></td></tr></table></figure>
<h2 id="store目录既Redux理解"><a href="#store目录既Redux理解" class="headerlink" title="store目录既Redux理解"></a>store目录既Redux理解</h2><p>学习了</p>
<p><a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_one_basic_usages.html" target="_blank" rel="noopener">阮一峰的技术博客1</a> </p>
<p><a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_two_async_operations.html" target="_blank" rel="noopener">阮一峰的技术博客2</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2016/09/redux_tutorial_part_three_react-redux.html" target="_blank" rel="noopener">阮一峰的技术博客3</a></p>
<p><a href="https://blog.csdn.net/weixin_38178584/article/details/82189351" target="_blank" rel="noopener">React-Redux流程中，mapStateToProps的理解</a> </p>
<p><a href="https://www.cnblogs.com/sameen/p/9182925.html" target="_blank" rel="noopener">关于react-redux中Provider、connect的解析</a><br>和 <a href="https://www.bilibili.com/video/BV1K7411U7P5" target="_blank" rel="noopener">b站Mosh教程</a></p>
<p>写下了一篇子博客  <a href="https://jasonxqh.github.io/2020/06/08/浅谈redux1/">浅谈redux1</a></p>
<p>对redux有了一些了解，于是我把他应用到处理登录这一部分</p>
<h3 id="处理登录目录"><a href="#处理登录目录" class="headerlink" title="处理登录目录"></a>处理登录目录</h3><h4 id="actions-js"><a href="#actions-js" class="headerlink" title="actions.js"></a><code>actions.js</code></h4><p>在<a href="https://jasonxqh.github.io/2020/06/08/浅谈redux1/">浅谈redux1</a> 中，引用阮一峰的文字也好，自己写下的理解也罢，对action的作用已经明白了，可以用下图来解释</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/10.png" style="zoom: 67%;"></p>
<p>我这里有两个Actions，一个是关于用户登陆的，一个是关于获取用户信息的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; USER_LOGIN, GET_USER_INFO &#125; <span class="keyword">from</span> <span class="string">'./action-type'</span>;</span><br><span class="line"><span class="comment">/*action-type:</span></span><br><span class="line"><span class="comment">export const GET_USER_INFO = 'GET_USER_INFO';</span></span><br><span class="line"><span class="comment">export const USER_LOGIN = 'USER_LOGIN';</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">import</span> Util <span class="keyword">from</span> <span class="string">'../../js/Util'</span>;</span><br><span class="line"><span class="keyword">import</span> Api <span class="keyword">from</span> <span class="string">'../../js/Api'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> actionUserLoginCreator = <span class="function">(<span class="params">type, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; name &#125; = data;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type,</span><br><span class="line">    data: &#123;</span><br><span class="line">      isLogin: <span class="literal">true</span>, <span class="comment">// 是否登录</span></span><br><span class="line">      name,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">判断用户是否登陆成功的action，如果在登陆界面我点击登陆的化，表单中的信息(账号密码)会当作参数</span></span><br><span class="line"><span class="comment">传入，然后我们通过后端Api判断这个账号密码是否合法，合法的话我们就会得到一个response，</span></span><br><span class="line"><span class="comment">response中会有一个data对象</span></span><br><span class="line"><span class="comment">然后我们就把这个对象中的token存在本地storage当中，这样能让用户保持登陆状态。</span></span><br><span class="line"><span class="comment">最后我们发出一个action，让reducer按照我们的要求更新state，并返回给需要的组件。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> userLogin = <span class="function">(<span class="params">params</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Api.post(<span class="string">'/users/login'</span>, params).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (res.data) &#123;</span><br><span class="line">        Util.setToken(res.data.token);</span><br><span class="line">        dispatch(actionUserLoginCreator(USER_LOGIN, &#123; <span class="attr">name</span>: res.data.name &#125;));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">获取用户信息的action</span></span><br><span class="line"><span class="comment">这个action就是说首先我从当前的storage中拿到token</span></span><br><span class="line"><span class="comment">然后如果token存在，那么调用Api.get获取到用户的信息，然后调用actionUserLoginCreator函数</span></span><br><span class="line"><span class="comment">dispatch出去，(这里为了让代码的结构更加明了，我把对象抽离出来新建了个函数。),其中：</span></span><br><span class="line"><span class="comment">type:GET_USER_INFO</span></span><br><span class="line"><span class="comment">data:&#123;</span></span><br><span class="line"><span class="comment">	name:当前用户信息</span></span><br><span class="line"><span class="comment">	isLogin:true 说明当前用户已经登陆。</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">那么如果token没有，说明当前没有用户登录，那么我们就dispatch一个action对象</span></span><br><span class="line"><span class="comment">type还是一样的，但是isLogin为false，而且因为没有登陆，所以没有名字。</span></span><br><span class="line"><span class="comment">type: GET_USER_INFO,</span></span><br><span class="line"><span class="comment">data: &#123;</span></span><br><span class="line"><span class="comment">  isLogin: false,</span></span><br><span class="line"><span class="comment">  name: null,</span></span><br><span class="line"><span class="comment">&#125;,</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> getUserInfo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> token = Util.getToken();</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">dispatch</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (token) &#123;</span><br><span class="line">      <span class="keyword">return</span> Api.get(<span class="string">'/users/info'</span>, &#123;</span><br><span class="line">        headers: &#123; <span class="attr">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span> &#125;,</span><br><span class="line">      &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (res.data.data.name) &#123;</span><br><span class="line">          dispatch(actionUserLoginCreator(GET_USER_INFO, &#123; <span class="attr">name</span>: res.data.data.name &#125;));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      dispatch(&#123;</span><br><span class="line">        type: GET_USER_INFO,</span><br><span class="line">        data: &#123;</span><br><span class="line">          isLogin: <span class="literal">false</span>,</span><br><span class="line">          name: <span class="literal">null</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="reducer"><a href="#reducer" class="headerlink" title="reducer"></a><code>reducer</code></h4><p>在<a href="https://jasonxqh.github.io/2020/06/08/浅谈redux1/">浅谈redux1</a> 中说过了reducer是一个纯函数。他只接收state和action然后返回对应的更新完毕的state</p>
<p>因为redux的store中保管了所有组件的state，所以需要state的组件会通过某种方式dispatch一个action过来，</p>
<p>reducer接收了以后更新state对象并返回给那个组件。</p>
<p>这个app中有两个actions，他们的名字分别是USER_LOGIN和GET_USER_INFO</p>
<p>因为actions不多，所以我没有必要去拆分reducer。做一个switchcase就可以了。</p>
<p>如果action的type=USER_LOGIN,那么我们就把用户的名字赋给state，并把isLogin设置为true，</p>
<p>GET_USER_INFO亦然</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; USER_LOGIN, GET_USER_INFO &#125; <span class="keyword">from</span> <span class="string">'./action-type'</span>;</span><br><span class="line"><span class="keyword">const</span> initState = &#123;</span><br><span class="line">  data: &#123;</span><br><span class="line">    isLogin: <span class="literal">false</span>, <span class="comment">// 是否登录</span></span><br><span class="line">    username: <span class="literal">null</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> reducer = <span class="function">(<span class="params">state = initState, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> USER_LOGIN:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        data: action.data,</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="keyword">case</span> GET_USER_INFO:</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        ...state,</span><br><span class="line">        data: action.data,</span><br><span class="line">      &#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> reducer;</span><br></pre></td></tr></table></figure>
<h3 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h3><p>这里需要了解下函数式编程，我在  <a href="https://jasonxqh.github.io/2020/06/08/浅谈redux1/#Functional-Programming-in-JavaScript-函数式编程">浅谈redux1：函数式编程 </a>中已经有了初步的介绍</p>
<p>这个就是一个单纯的记录日志的中间件。对整个app用处不大</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> logger = <span class="function">(<span class="params">&#123; getState, dispatch &#125;</span>) =&gt;</span> <span class="function">(<span class="params">next</span>) =&gt;</span> <span class="function">(<span class="params">action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.group(action.type);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'dispatching:'</span>, action);</span><br><span class="line">  <span class="keyword">const</span> result = next(action);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'next state:'</span>, getState());</span><br><span class="line">  <span class="built_in">console</span>.groupEnd();</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> logger;</span><br></pre></td></tr></table></figure>
<h3 id="index-js-1"><a href="#index-js-1" class="headerlink" title="index.js"></a><code>index.js</code></h3><p><code>Redux</code> 提供了一个<code>combineReducers</code>方法，用于 Reducer 的拆分。你只要定义各个子 Reducer 函数，然后用这个方法，将它们合成一个大的 Reducer。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; combineReducers &#125; <span class="keyword">from</span> <span class="string">'redux'</span>;</span><br><span class="line"><span class="keyword">import</span> userData <span class="keyword">from</span> <span class="string">'./login/reducer'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> combineReducers(&#123;</span><br><span class="line">  userData,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="mapStateToProps的理解"><a href="#mapStateToProps的理解" class="headerlink" title="mapStateToProps的理解"></a><code>mapStateToProps</code>的理解</h3><p>因为在代码中很多时候涉及到这两个函数，我就直接在这里解释一下。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    userData: state.userData.data,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>mapStateToProps</code>方法就是容器组件向store声明需要的state的地方，因为我们的store是整个应用只有一份，根据<code>redux</code>的思想通过context可以保证每一个组件都可以从context中获取到store，不需要一级一级的从顶层传递下来。所以，一般容器组件上会有这个函数负责通过context获取到store中想要的state<strong>，即从store中获取到的state相当于容器组件从父组件拿到的props</strong>，因此，<code>mapStateToProps</code>函数一般只存在于容器组件（或顶层组件）中。</p>
<p>   由于，store中的所有state都由reducer来更新，所有一般<code>mapStateToProps</code>方法中需要定义所有的reducer，把所有的reducer的结果都要拿到，保证我们的store中能包含所有的state，也就是我们这个大应用需要的所有数据都能从顶层组件（或容器组件）获取，然后传递下去；</p>
<p> 这里，通过这个<code>mapStateToProps</code>，返回了一个本地的state，state中有<code>userData.data</code></p>
<p><code>userData.data</code>其实就是reducer中返回的对象中user的名字和登陆与否的状态</p>
<h3 id="mapDispatchToProps的理解"><a href="#mapDispatchToProps的理解" class="headerlink" title="mapDispatchToProps的理解"></a><code>mapDispatchToProps</code>的理解</h3><p><code>mapDispatchToProps</code></p>
<ul>
<li>dispatch是必须的参数</li>
<li><code>mapDispatchToProps</code>在组件constructor()中被执行，因而只执行一次</li>
<li><code>mapDispatchToProps</code>为组件提供了用于改变Store状态的方法，并将其定义为组件的prop</li>
</ul>
<p><code>mapDispatchToProps</code>用于建立组件跟<code>store.dispatch</code>的映射关系,可以是一个object，也可以传入函数<br>如果<code>mapDispatchToProps</code>是一个函数，它可以传入dispatch,ownProps, 定义UI组件如何发出action，实际上就是要调用dispatch这个方法<br>这两个例子</p>
<p>1.就是说如果我调用<code>getUserInfo</code>的话，我就会dispatch一个<code>getUserInfo</code>的action,这个action的作用是获取到用户的信息</p>
<p>2.如果我调用<code>getUserLogin</code>，那么我就会dispatch一个<code>userLogin</code>的action，里面包含了我传入的登录信息params</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch</span>) =&gt;</span> (&#123;</span><br><span class="line">  getUserInfo: <span class="function"><span class="params">()</span> =&gt;</span> dispatch(getUserInfo()),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch</span>) =&gt;</span> (&#123;</span><br><span class="line">  getUserLogin: <span class="function">(<span class="params">params</span>) =&gt;</span> dispatch(userLogin(params)),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="connect的理解"><a href="#connect的理解" class="headerlink" title="connect的理解"></a>connect的理解</h3><p> <code>mapStateToProps</code>,<code>mapDispatchToProps</code>函数是通过<code>redux</code>的connect函数与react联系在一起的，如connect（<code>mapStateToProps</code>，<code>mapDispatchToProps</code>）（xxxPages），<strong>connect返回的是一个函数</strong>，这个函数会调用子组件（傻瓜组件、木偶组件），完成容器组件与木偶组件的链接，而<code>mapStateToProps</code>,<code>mapDispatchToProps</code>的返回就是这个木偶组件的props，走这个木偶组件的更新过程 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(</span><br><span class="line">  mapStateToProps,</span><br><span class="line">  mapDispatchToProps,</span><br><span class="line">)(wrappedLoginForm);</span><br></pre></td></tr></table></figure>
<h3 id="provider的理解"><a href="#provider的理解" class="headerlink" title="provider的理解"></a>provider的理解</h3><p>在index中，我们有这样一个provider标签</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Provider store=&#123;store&#125;&gt;</span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;<span class="regexp">/Provider&gt;,</span></span><br><span class="line"><span class="regexp">  document.getElementById('root'),</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>
<h2 id="组件部分"><a href="#组件部分" class="headerlink" title="组件部分"></a>组件部分</h2><h3 id="NavBar"><a href="#NavBar" class="headerlink" title="NavBar"></a><code>NavBar</code></h3><h4 id="实现形式："><a href="#实现形式：" class="headerlink" title="实现形式："></a>实现形式：</h4><p>在<code>admin</code>当中</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/1.png" style="zoom: 67%;"></p>
<p>在普通用户中<br><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/2.png" style="zoom: 67%;"></p>
<p>在未登录界面</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/3.png" style="zoom: 67%;"></p>
<h4 id="实现逻辑-代码分析"><a href="#实现逻辑-代码分析" class="headerlink" title="实现逻辑+代码分析"></a>实现逻辑+代码分析</h4><p>为了方便，我们对源码进行分割</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createHashHistory &#125; <span class="keyword">from</span> <span class="string">'history'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.scss'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Icon, Dropdown, Menu &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> Util <span class="keyword">from</span> <span class="string">'../../../js/Util'</span>;</span><br><span class="line"><span class="keyword">const</span> history = createHashHistory();</span><br><span class="line"><span class="keyword">const</span> &#123; Fragment &#125; = React;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CommonHeader</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">      <span class="comment">//在构造器中首先super</span></span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">      <span class="comment">//state中保存NavBar组件的默认信息，里面有isLogin，默认未登录;name默认为空串</span></span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      isLogin: <span class="literal">false</span>,</span><br><span class="line">      name: <span class="string">''</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//cdm为空</span></span><br><span class="line">  componentDidMount() &#123;&#125;</span><br></pre></td></tr></table></figure>
<h5 id="一些函数的实现"><a href="#一些函数的实现" class="headerlink" title="一些函数的实现"></a>一些函数的实现</h5><p>1.history.push()在上文<a href="https://jasonxqh.github.io/2020/06/02/react基础2/#Programmatic-Navigation">react基础2分页排序搜索+路由中的Programmatic Navigation</a>中的路由部分有详细提到。再次不必多说<br>2.NavBar中实现的路由跳转:<br>3.goSign: 跳转到/type其中这个语法是ES6的模板语法，${}中的元素会随着传入的不同而实时渲染，具体的实现功能就是路由跳转，我之所以写成这样是因为它既可以可以跳转到login，也可以跳register 跳到哪里完全看我传入什么type<br>4.goHome: 跳转到主页<br>5.logout: 删除当前的token(置空)跳转到主页.其中Util中封装了setToken和getToken两个函数，分别<br>是用来设置Token和获取Token的函数(也就是localStorage.setItem之类的，在<a href="https://jasonxqh.github.io/2020/06/05/react基础4授权与部署/#Storing-the-JWT-JSON-Token">react基础4授权中的Storing the JWT(JSON Token)章节</a>提及)<br>6.goManage:跳转到/manage也就是管理页面<br>7.goTarget:跳转到的地方随target决定</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">goSign(type) &#123;</span><br><span class="line">  history.push(<span class="string">`/<span class="subst">$&#123;type&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">goHome() &#123;</span><br><span class="line">  history.push(<span class="string">'/'</span>);</span><br><span class="line">&#125;</span><br><span class="line">logout() &#123;</span><br><span class="line">  Util.setToken(<span class="string">''</span>);</span><br><span class="line">  <span class="built_in">window</span>.location.reload(<span class="string">'/'</span>);</span><br><span class="line">&#125;</span><br><span class="line">goManage() &#123;</span><br><span class="line">  history.push(<span class="string">'/manage'</span>);</span><br><span class="line">&#125;</span><br><span class="line">goTarget(target) &#123;</span><br><span class="line">  history.push(<span class="string">`/<span class="subst">$&#123;target&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="render-渲染器部分"><a href="#render-渲染器部分" class="headerlink" title="render()渲染器部分"></a>render()渲染器部分</h5><p> <strong>render渲染器部分</strong>，首先析构userData<br> 然后从userData中析构名字和登陆状态<br> menu就是下拉表单，里面封装了一个按钮，也就是推出，点击退出会删除Token并回到首页</p>
<p><strong>render中返回的组件部分:</strong><br>1.一开始当然是个Navbar标签，点击它就会回到主页<br>2.随后是条件渲染，就是只有当用户是admin的时候，才会显示这个按钮，否则是不会显示的。点击这个按钮跳转到用户管理界面，具体界面的逻辑再次不细说。<br>3.然后是四个表单的条件渲染。就是只有isLogin= true的时候，才会显示这四个表单的按钮.点击这4个按钮会分别跳转到相应的展示页面<br>4.再然后是右边的部分，这个部分会根据是否登陆而变换。通过判断isLogin？如果未登录，那么就渲染登录和注册这两个按钮，点击后调用goSign传入我想取得地方(login或者register)这就体现了ES6模板化语言的好处，当然直接利用字符串拼接也可以; 如果已经注册，那么再有边显示一个下拉表单: 下拉表单中有上文const的menu对象，也就是退出。未显示下拉表单的时候右边是一个antd库的icon和用户的名字，<br>就如上文图片中展示的一样</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"> render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; userData &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> &#123; name, isLogin &#125; = userData;</span><br><span class="line">    <span class="keyword">const</span> menu = (</span><br><span class="line">      &lt;Menu&gt;</span><br><span class="line">        &lt;Menu.Item key=<span class="string">"0"</span> onClick=&#123;() =&gt; <span class="keyword">this</span>.logout()&#125;&gt;</span><br><span class="line">          退出</span><br><span class="line">        &lt;<span class="regexp">/Menu.Item&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Menu&gt;</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"header-nav"</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">"home-logo"</span>&gt;</span><br><span class="line">          &lt;div className=<span class="string">"logo-text"</span> onClick=&#123;() =&gt; <span class="keyword">this</span>.goHome()&#125;&gt;</span><br><span class="line">            NavBar</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div className="tab-bar"&gt;</span></span><br><span class="line"><span class="regexp">            &#123;name === 'admin' ? (</span></span><br><span class="line"><span class="regexp">              &lt;div className="bar-item" onClick=&#123;() =&gt; this.goManage()&#125;&gt;</span></span><br><span class="line"><span class="regexp">                用户管理</span></span><br><span class="line"><span class="regexp">              &lt;/</span>div&gt;</span><br><span class="line">            ) : <span class="literal">null</span>&#125;</span><br><span class="line">            &#123;isLogin &amp;&amp; (</span><br><span class="line">              &lt;div style=&#123;&#123; <span class="attr">display</span>: <span class="string">'flex'</span> &#125;&#125;&gt;</span><br><span class="line">                &lt;div className=<span class="string">"bar-item"</span> onClick=&#123;() =&gt; <span class="keyword">this</span>.goTarget(<span class="string">'douban'</span>)&#125;&gt;</span><br><span class="line">                  豆瓣Top250</span><br><span class="line">                &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">                &lt;div className="bar-item" onClick=&#123;() =&gt; this.goTarget('maoyan')&#125;&gt;</span></span><br><span class="line"><span class="regexp">                  猫眼Top100</span></span><br><span class="line"><span class="regexp">                &lt;/</span>div&gt;</span><br><span class="line">                &lt;div className=<span class="string">"bar-item"</span> onClick=&#123;() =&gt; <span class="keyword">this</span>.goTarget(<span class="string">'operas'</span>)&#125;&gt;</span><br><span class="line">                  剧集</span><br><span class="line">                &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">                &lt;div className="bar-item" onClick=&#123;() =&gt; this.goTarget('taobao')&#125;&gt;</span></span><br><span class="line"><span class="regexp">                  淘宝咖啡</span></span><br><span class="line"><span class="regexp">                &lt;/</span>div&gt;</span><br><span class="line">              &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">            )&#125;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>div&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div className="nav-right"&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div className="mine"&gt;</span></span><br><span class="line"><span class="regexp">            &#123;!isLogin ? (</span></span><br><span class="line"><span class="regexp">              &lt;Fragment&gt;</span></span><br><span class="line"><span class="regexp">                &lt;div className="sign" onClick=&#123;() =&gt; this.goSign('login')&#125;&gt;</span></span><br><span class="line"><span class="regexp">                  登录</span></span><br><span class="line"><span class="regexp">                &lt;/</span>div&gt;</span><br><span class="line">                &lt;div className=<span class="string">"split-line"</span>&gt;|&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">                &lt;div className="sign" onClick=&#123;() =&gt; this.goSign('register')&#125;&gt;</span></span><br><span class="line"><span class="regexp">                  注册</span></span><br><span class="line"><span class="regexp">                &lt;/</span>div&gt;</span><br><span class="line">              &lt;<span class="regexp">/Fragment&gt;</span></span><br><span class="line"><span class="regexp">            ) : (</span></span><br><span class="line"><span class="regexp">              &lt;Dropdown overlay=&#123;menu&#125;&gt;</span></span><br><span class="line"><span class="regexp">                &lt;div className="icon-header"&gt;</span></span><br><span class="line"><span class="regexp">                  &lt;Icon type="smile" className="icon-mine icon" theme="twoTone" /</span>&gt;</span><br><span class="line">                  &lt;span className=<span class="string">"user-name"</span>&gt;&#123;name&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">                  &lt;Icon type="caret-down" className="down icon" /</span>&gt;</span><br><span class="line">                &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">              &lt;/</span>Dropdown&gt;</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"> </span></span><br><span class="line"><span class="regexp">const mapStateToProps = (state) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  return &#123;</span></span><br><span class="line"><span class="regexp">    userData: state.userData.data,</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default connect(mapStateToProps, null)(CommonHeader);</span></span><br></pre></td></tr></table></figure>
<h3 id="Layout"><a href="#Layout" class="headerlink" title="Layout"></a><code>Layout</code></h3><p>Layout组件就是大家的共享主页，也就是说在里面渲染了三个主要部分</p>
<p>1.NavBar</p>
<p>2.所有页面中的元素(继承props)</p>
<p>3.Footer（下图中最后一条暗带）</p>
<p>（忽略HelloWorld）这就是Layout组件的样子</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/4.png" style="zoom: 67%;"></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./layout.scss'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Layout &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> HeaderNav <span class="keyword">from</span> <span class="string">'../headerNav'</span>;</span><br><span class="line"><span class="comment">//Header,Footer,Content都是从 antd导入的Layout对象，就不用自己设计css了</span></span><br><span class="line"><span class="keyword">const</span> &#123; Header, Footer, Content &#125; = Layout;</span><br><span class="line">render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Layout className=<span class="string">"layout"</span>&gt;</span><br><span class="line">          &lt;Header className=<span class="string">"header"</span>&gt;</span><br><span class="line">            &lt;div className=<span class="string">"content-1200"</span>&gt;</span><br><span class="line">              &lt;HeaderNav /&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>Header&gt;</span><br><span class="line">          &lt;Content className=<span class="string">"main"</span>&gt;</span><br><span class="line">            &lt;div className=<span class="string">"content-1200"</span>&gt;</span><br><span class="line">              &#123;<span class="keyword">this</span>.props.children&#125;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>Content&gt;</span><br><span class="line">          &lt;Footer className=<span class="string">"footer"</span>&gt;</span><br><span class="line">            &lt;div className=<span class="string">"content-1200"</span>&gt;</span><br><span class="line">              &lt;div className=<span class="string">"footer-content"</span> /&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>Footer&gt;</span><br><span class="line">        &lt;<span class="regexp">/Layout&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> CommonLayout;</span><br></pre></td></tr></table></figure>
<p>layout.scss表单在这里就不展示了。</p>
<h3 id="Loading"><a href="#Loading" class="headerlink" title="Loading"></a><code>Loading</code></h3><p>这就是一个当页面加载的时候转圈圈的组件，从antd导入即可</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Spin &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Loading</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Spin /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Loading;</span></span><br></pre></td></tr></table></figure>
<h3 id="PrivateRoute"><a href="#PrivateRoute" class="headerlink" title="PrivateRoute"></a><code>PrivateRoute</code></h3><p>这就是一个私有路由，目的是<strong>不让未授权的用户得到我的展示页面</strong>。</p>
<p>实现逻辑在<a href="https://jasonxqh.github.io/2020/06/05/react基础4授权与部署/#Extracting-PrivateRoute">react基础4授权与部署的Extracting PrivateRoute</a>   章节中有详细说明。在这里仅仅展示代码，并不细说逻辑。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Route, Redirect &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getUserInfo &#125; <span class="keyword">from</span> <span class="string">'../../../store/login/actions'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrivateRoute</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.props.getUserInfo();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">component</span>: Component, userData, ...rest &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> &#123; isLogin &#125; = userData;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Route</span><br><span class="line">        &#123;...rest&#125;</span><br><span class="line">        render=&#123;(props) =&gt; &#123;</span><br><span class="line">          <span class="keyword">return</span> isLogin ? (</span><br><span class="line">            &lt;Component &#123;...props&#125; /&gt;</span><br><span class="line">          ) : (</span><br><span class="line">            &lt;Redirect</span><br><span class="line">              to=&#123;&#123;</span><br><span class="line">                pathname: <span class="string">'/login'</span>,</span><br><span class="line">                state: &#123; <span class="attr">from</span>: props.location &#125;,</span><br><span class="line">              &#125;&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">          );</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapStateToProps = <span class="function">(<span class="params">state, props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    userData: state.userData.data,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> mapDispatchToProps = <span class="function">(<span class="params">dispatch</span>) =&gt;</span> (&#123;</span><br><span class="line">  getUserInfo: <span class="function"><span class="params">()</span> =&gt;</span> dispatch(getUserInfo()),</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> connect(mapStateToProps, mapDispatchToProps)(PrivateRoute);</span><br></pre></td></tr></table></figure>
<h2 id="页面部分"><a href="#页面部分" class="headerlink" title="页面部分"></a>页面部分</h2><h3 id="App-jsx"><a href="#App-jsx" class="headerlink" title="App.jsx"></a><code>App.jsx</code></h3><p>App组件是根组件所以我们单独讲。先上代码</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Suspense, lazy &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.scss'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; HashRouter <span class="keyword">as</span> Router, Route, Switch &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> PrivateRoute <span class="keyword">from</span> <span class="string">'./components/PrivateRoute'</span>;</span><br><span class="line"><span class="keyword">import</span> Loading <span class="keyword">from</span> <span class="string">'./components/loading'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./home'</span>));</span><br><span class="line"><span class="keyword">const</span> Sign = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./sign'</span>));</span><br><span class="line"><span class="keyword">const</span> Register = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./register'</span>));</span><br><span class="line"><span class="keyword">const</span> Manage = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./manage'</span>));</span><br><span class="line"><span class="keyword">const</span> Douban = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./douban'</span>));</span><br><span class="line"><span class="keyword">const</span> Taobao = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./taobao'</span>));</span><br><span class="line"><span class="keyword">const</span> Maoyan = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./maoyan'</span>));</span><br><span class="line"><span class="keyword">const</span> Operas = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./operas'</span>));</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Router&gt;</span><br><span class="line">        &lt;Suspense</span><br><span class="line">          fallback=&#123;<span class="comment">//这里如果等待的化，那么就加载上面所说的Loading组件</span></span><br><span class="line">            &lt;div className=<span class="string">"loading"</span>&gt;</span><br><span class="line">              &lt;Loading /&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &#125;</span></span><br><span class="line"><span class="regexp">        &gt;</span></span><br><span class="line"><span class="regexp">          &lt;Switch&gt;</span></span><br><span class="line"><span class="regexp">            &lt;PrivateRoute exact path="/</span><span class="string">" component=&#123;Home&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;PrivateRoute exact path="</span>/manage<span class="string">" component=&#123;Manage&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;Route exact path="</span>/login<span class="string">" component=&#123;Sign&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;Route exact path="</span>/register<span class="string">" component=&#123;Register&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;PrivateRoute exact path="</span>/douban<span class="string">" component=&#123;Douban&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;PrivateRoute exact path="</span>/taobao<span class="string">" component=&#123;Taobao&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;PrivateRoute exact path="</span>/maoyan<span class="string">" component=&#123;Maoyan&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;PrivateRoute exact path="</span>/operas<span class="string">" component=&#123;Operas&#125; /&gt;</span></span><br><span class="line"><span class="string">          &lt;/Switch&gt;</span></span><br><span class="line"><span class="string">        &lt;/Suspense&gt;</span></span><br><span class="line"><span class="string">      &lt;/Router&gt;</span></span><br><span class="line"><span class="string">    );</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">export default App;</span></span><br></pre></td></tr></table></figure>
<p><strong>这里需要讲几个问题：</strong></p>
<h4 id="lazy-Suspense-的作用"><a href="#lazy-Suspense-的作用" class="headerlink" title="lazy+Suspense 的作用"></a>lazy+Suspense 的作用</h4><p>在<a href="https://react.docschina.org/docs/code-splitting.html" target="_blank" rel="noopener">react官方文档</a>中我截取了一段</p>
<p><code>React.lazy</code> 函数能让你像渲染常规组件一样处理动态引入（的组件）。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> OtherComponent = React.lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./OtherComponent'</span>));</span><br></pre></td></tr></table></figure>
<p>此代码将会在组件首次渲染时，自动导入包含 <code>OtherComponent</code> 组件的包。</p>
<p><code>React.lazy</code> 接受一个函数，这个函数需要动态调用 <code>import()</code>。它必须返回一个 <code>Promise</code>，该 Promise 需要 resolve 一个 <code>default</code> export 的 React 组件。</p>
<p>然后应在 <code>Suspense</code> 组件中渲染 lazy 组件，如此使得我们可以使用在等待加载 lazy 组件时做优雅降级（如 loading 指示器等）。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Suspense &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> OtherComponent = React.lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./OtherComponent'</span>));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Suspense fallback=&#123;&lt;div&gt;Loading...&lt;<span class="regexp">/div&gt;&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;OtherComponent /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/Suspense&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>fallback</code> 属性接受任何在组件加载过程中你想展示的 React 元素。你可以将 <code>Suspense</code> 组件置于懒加载组件之上的任何位置。你甚至可以用一个 <code>Suspense</code> 组件包裹多个懒加载组件。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Suspense &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> OtherComponent = React.lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./OtherComponent'</span>));</span><br><span class="line"><span class="keyword">const</span> AnotherComponent = React.lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./AnotherComponent'</span>));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Suspense fallback=&#123;&lt;div&gt;Loading...&lt;<span class="regexp">/div&gt;&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;section&gt;</span></span><br><span class="line"><span class="regexp">          &lt;OtherComponent /</span>&gt;</span><br><span class="line">          &lt;AnotherComponent /&gt;</span><br><span class="line">        &lt;<span class="regexp">/section&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Suspense&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="Switch-exact"><a href="#Switch-exact" class="headerlink" title="Switch,exact"></a><code>Switch,exact</code></h4><p>在<a href="https://jasonxqh.github.io/2020/06/02/react基础2/#Switch">react基础2中的Switch</a>有详细提及</p>
<h4 id="PrivateRoute实现逻辑"><a href="#PrivateRoute实现逻辑" class="headerlink" title="PrivateRoute实现逻辑"></a><code>PrivateRoute</code>实现逻辑</h4><p>在<a href="https://jasonxqh.github.io/2020/06/05/react基础4授权与部署/#Protecting-Routes">react基础4授权与部署的Protecting Routes</a>中有详细提及</p>
<h3 id="登录页面与注册页面"><a href="#登录页面与注册页面" class="headerlink" title="登录页面与注册页面"></a>登录页面与注册页面</h3><p>登陆页面和注册页面的<strong>实现逻辑</strong>在<a href="https://jasonxqh.github.io/2020/06/05/react基础4授权与部署/">react基础4授权与部署</a> 中的花了<strong>大篇幅</strong>说明和实现(从<a href="https://jasonxqh.github.io/2020/06/05/react基础4授权与部署/#Registering-a-New-User">1.1.2. Registering a New User</a> 开始)。 </p>
<p><strong>不过还要插一嘴</strong>: 在博客中我们没有借助外部的库来实现提交表单，但这里我使用了antd中表单。具体学习博客可以参照</p>
<p><a href="https://www.jianshu.com/p/f8d3a8bcaf84" target="_blank" rel="noopener">antd中表单提交的基本使用</a></p>
<p>源码中用到的几个重要的api如下</p>
<h4 id="Form-create"><a href="#Form-create" class="headerlink" title="Form.create"></a><code>Form.create</code></h4><p>使用<code>Form.create({options})(Forgot)</code>包装组件，包装之后的组件会自动添加<code>this.props.form</code> 属性，该属性包含以下API：</p>
<ul>
<li><code>getFieldDecorator</code> ：用于和表单数据进行双向绑定，设置该表单类型为email，在<code>rules</code>中设置校验规则和提示信息。</li>
<li><code>validateFields</code>：获取输入域的数据和error，用于在提交前的判断。如果<code>!err</code>才可以提交。数据values就是<code>{email: a@qq.com}</code>这样的格式。传递给<code>handleConfirm</code>函数进行提交请求操作。</li>
</ul>
<h4 id="login-jsx"><a href="#login-jsx" class="headerlink" title="login.jsx"></a><code>login.jsx</code></h4><p> 为了讲解方便，我们把源代码拆成几个部分 </p>
<p><code>handleSubmit</code>部分</p>
<p>首先<code>e.preventDefault()</code>是阻止页面在提交表单的时候重新渲染</p>
<p>然后利用antd中的api，<code>form.validateFields</code>来进行验证，如果没有错的话，就发送一个dispatch一个 <strong>action</strong>给store，store再通过调用reducer，reducer把我们传入的登录信息渲染到state当中 然后返回，这样再login中就有本地的state信息了。（敲黑板的重点！）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Redirect &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; userLogin &#125; <span class="keyword">from</span> <span class="string">'../../store/login/actions'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Form, Icon, Input, Button &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/layout'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.scss'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidMount() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  handleSubmit = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    <span class="keyword">this</span>.props.form.validateFields(<span class="function">(<span class="params">err, values</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">        <span class="keyword">this</span>.props.getUserLogin(values);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<p><code>render</code>部分</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; getFieldDecorator &#125; = <span class="keyword">this</span>.props.form;</span><br><span class="line">    <span class="keyword">const</span> &#123; userData &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> &#123; isLogin &#125; = userData;</span><br><span class="line">    <span class="keyword">if</span> (isLogin) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">"/"</span> /&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> formItemLayout = &#123;</span><br><span class="line">      labelCol: &#123;</span><br><span class="line">        xs: &#123; <span class="attr">span</span>: <span class="number">24</span> &#125;,</span><br><span class="line">        sm: &#123; <span class="attr">span</span>: <span class="number">8</span> &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      wrapperCol: &#123;</span><br><span class="line">        xs: &#123; <span class="attr">span</span>: <span class="number">24</span> &#125;,</span><br><span class="line">        sm: &#123; <span class="attr">span</span>: <span class="number">16</span> &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> tailFormItemLayout = &#123;</span><br><span class="line">      wrapperCol: &#123;</span><br><span class="line">        xs: &#123;</span><br><span class="line">          span: <span class="number">24</span>,</span><br><span class="line">          offset: <span class="number">0</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        sm: &#123;</span><br><span class="line">          span: <span class="number">22</span>,</span><br><span class="line">          offset: <span class="number">2</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Layout&gt;</span><br><span class="line">        &lt;Form &#123;...formItemLayout&#125; onSubmit=&#123;<span class="keyword">this</span>.handleSubmit&#125; className=<span class="string">"login-form"</span>&gt;</span><br><span class="line">          &lt;Form.Item label=<span class="string">"用户名"</span> className=<span class="string">"item"</span>&gt;</span><br><span class="line">            &#123;getFieldDecorator(<span class="string">'name'</span>, &#123;</span><br><span class="line">              rules: [&#123; <span class="attr">required</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">            &#125;)(</span><br><span class="line">              &lt;Input</span><br><span class="line">                size=<span class="string">"large"</span></span><br><span class="line">                prefix=&#123;&lt;Icon type=<span class="string">"user"</span> style=&#123;&#123; <span class="attr">color</span>: <span class="string">'rgba(0,0,0,.25)'</span> &#125;&#125; /&gt;&#125;</span><br><span class="line">                placeholder=<span class="string">"请输入用户名"</span></span><br><span class="line">              /&gt;,</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="密码" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &#123;getFieldDecorator('password', &#123;</span></span><br><span class="line"><span class="regexp">              rules: [&#123; required: true &#125;],</span></span><br><span class="line"><span class="regexp">            &#125;)(</span></span><br><span class="line"><span class="regexp">              &lt;Input</span></span><br><span class="line"><span class="regexp">                size="large"</span></span><br><span class="line"><span class="regexp">                prefix=&#123;&lt;Icon type="lock" style=&#123;&#123; color: 'rgba(0,0,0,.25)' &#125;&#125; /</span>&gt;&#125;</span><br><span class="line">                type=<span class="string">"password"</span></span><br><span class="line">                placeholder=<span class="string">"请输入密码"</span></span><br><span class="line">              /&gt;,</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item &#123;...tailFormItemLayout&#125; className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Button size="large" type="primary" htmlType="submit" className="login-form-button"&gt;</span></span><br><span class="line"><span class="regexp">              登录</span></span><br><span class="line"><span class="regexp">            &lt;/</span>Button&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Form&gt;</span><br><span class="line">      &lt;<span class="regexp">/Layout&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const mapStateToProps = (state) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  return &#123;</span></span><br><span class="line"><span class="regexp">    userData: state.userData.data,</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">const mapDispatchToProps = (dispatch) =&gt; (&#123;</span></span><br><span class="line"><span class="regexp">  getUserLogin: (params) =&gt; dispatch(userLogin(params)),</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const wrappedLoginForm = Form.create(&#123; name: 'login' &#125;)(LoginForm);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default connect(</span></span><br><span class="line"><span class="regexp">  mapStateToProps,</span></span><br><span class="line"><span class="regexp">  mapDispatchToProps,</span></span><br><span class="line"><span class="regexp">)(wrappedLoginForm);</span></span><br></pre></td></tr></table></figure>
<h4 id="register-jsx"><a href="#register-jsx" class="headerlink" title="register.jsx"></a><code>register.jsx</code></h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Redirect &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createHashHistory &#125; <span class="keyword">from</span> <span class="string">'history'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Form, Icon, Input, Button, message &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/layout'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.scss'</span>;</span><br><span class="line"><span class="keyword">import</span> Api <span class="keyword">from</span> <span class="string">'../../js/Api'</span>;</span><br><span class="line"><span class="keyword">const</span> history = createHashHistory(&#123; <span class="attr">forceRefresh</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidMount() &#123;&#125;</span><br><span class="line"></span><br><span class="line">  handleSubmit = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    <span class="keyword">this</span>.props.form.validateFields(<span class="function">(<span class="params">err, values</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">        Api.post(<span class="string">'/users/register'</span>, values)</span><br><span class="line">          .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (res.data) &#123;</span><br><span class="line">              message.success(<span class="string">'register success'</span>);</span><br><span class="line">              history.push(<span class="string">'/login'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err);</span><br><span class="line">            message.error(err.message);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<p><code>render</code>部分：</p>
<p>表单渲染在上面也说了，这里就不再细讲了</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; getFieldDecorator &#125; = <span class="keyword">this</span>.props.form;</span><br><span class="line">    <span class="keyword">const</span> &#123; userData &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> &#123; isLogin &#125; = userData;</span><br><span class="line">    <span class="keyword">if</span> (isLogin) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">"/"</span> /&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> formItemLayout = &#123;</span><br><span class="line">      labelCol: &#123;</span><br><span class="line">        xs: &#123; <span class="attr">span</span>: <span class="number">24</span> &#125;,</span><br><span class="line">        sm: &#123; <span class="attr">span</span>: <span class="number">8</span> &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      wrapperCol: &#123;</span><br><span class="line">        xs: &#123; <span class="attr">span</span>: <span class="number">24</span> &#125;,</span><br><span class="line">        sm: &#123; <span class="attr">span</span>: <span class="number">16</span> &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> tailFormItemLayout = &#123;</span><br><span class="line">      wrapperCol: &#123;</span><br><span class="line">        xs: &#123;</span><br><span class="line">          span: <span class="number">24</span>,</span><br><span class="line">          offset: <span class="number">0</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        sm: &#123;</span><br><span class="line">          span: <span class="number">22</span>,</span><br><span class="line">          offset: <span class="number">2</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Layout&gt;</span><br><span class="line">        &lt;Form &#123;...formItemLayout&#125; onSubmit=&#123;<span class="keyword">this</span>.handleSubmit&#125; className=<span class="string">"login-form"</span>&gt;</span><br><span class="line">          &lt;Form.Item label=<span class="string">"用户名"</span> className=<span class="string">"item"</span>&gt;</span><br><span class="line">            &#123;getFieldDecorator(<span class="string">'name'</span>, &#123;</span><br><span class="line">              rules: [&#123; <span class="attr">required</span>: <span class="literal">true</span> &#125;],</span><br><span class="line">            &#125;)(</span><br><span class="line">              &lt;Input</span><br><span class="line">                size=<span class="string">"large"</span></span><br><span class="line">                prefix=&#123;&lt;Icon type=<span class="string">"user"</span> style=&#123;&#123; <span class="attr">color</span>: <span class="string">'rgba(0,0,0,.25)'</span> &#125;&#125; /&gt;&#125;</span><br><span class="line">                placeholder=<span class="string">"请输入用户名"</span></span><br><span class="line">              /&gt;,</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="密码" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &#123;getFieldDecorator('password', &#123;</span></span><br><span class="line"><span class="regexp">              rules: [&#123; required: true &#125;],</span></span><br><span class="line"><span class="regexp">            &#125;)(</span></span><br><span class="line"><span class="regexp">              &lt;Input</span></span><br><span class="line"><span class="regexp">                size="large"</span></span><br><span class="line"><span class="regexp">                prefix=&#123;&lt;Icon type="lock" style=&#123;&#123; color: 'rgba(0,0,0,.25)' &#125;&#125; /</span>&gt;&#125;</span><br><span class="line">                type=<span class="string">"password"</span></span><br><span class="line">                placeholder=<span class="string">"请输入密码"</span></span><br><span class="line">              /&gt;,</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item &#123;...tailFormItemLayout&#125; className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Button size="large" type="primary" htmlType="submit" className="login-form-button"&gt;</span></span><br><span class="line"><span class="regexp">              注册</span></span><br><span class="line"><span class="regexp">            &lt;/</span>Button&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Form&gt;</span><br><span class="line">      &lt;<span class="regexp">/Layout&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const mapStateToProps = (state) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  return &#123;</span></span><br><span class="line"><span class="regexp">    userData: state.userData.data,</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const wrappedLoginForm = Form.create(&#123; name: 'login' &#125;)(LoginForm);</span></span><br><span class="line"><span class="regexp">export default connect(mapStateToProps, null)(wrappedLoginForm);</span></span><br></pre></td></tr></table></figure>
<h3 id="管理员的用户管理界面"><a href="#管理员的用户管理界面" class="headerlink" title="管理员的用户管理界面"></a>管理员的用户管理界面</h3><p>管理员界面和普通用户界面的区别就在于管理员多了一个用户管理页面可以删除别的用户的信息。这里我通过两个<code>jsx</code>文件实现，在主文件中存放<code>UserManage</code>组件，这样的写法让代码的层次更加分明简洁</p>
<p><code>index.jsx</code>,关于文件中Tabs的使用方法，参考<a href="https://ant-design.gitee.io/components/tabs-cn/" target="_blank" rel="noopener">antd的官方文档</a></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line">render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Layout&gt;</span><br><span class="line">        &lt;Tabs defaultActiveKey=<span class="string">"1"</span>&gt;</span><br><span class="line">          &lt;TabPane tab=<span class="string">"user management"</span> key=<span class="string">"1"</span>&gt;</span><br><span class="line">            &lt;UsersManage key=<span class="string">"user"</span> /&gt;</span><br><span class="line">          &lt;<span class="regexp">/TabPane&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Tabs&gt;</span><br><span class="line">      &lt;<span class="regexp">/Layout&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/...</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/5.png" style="zoom: 67%;"></p>
<h4 id="user-js"><a href="#user-js" class="headerlink" title="user.js"></a><code>user.js</code></h4><p>为了讲解方便我们把源码拆分成几个部分</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Table, Icon, Tooltip, message, Modal &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> Util <span class="keyword">from</span> <span class="string">'../../js/Util'</span>;</span><br><span class="line"><span class="keyword">import</span> Api <span class="keyword">from</span> <span class="string">'../../js/Api'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.scss'</span>;</span><br><span class="line"><span class="keyword">const</span> &#123; confirm &#125; = Modal;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UsersManage</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      userListData: [],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.getUserList();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="getUserList实现逻辑"><a href="#getUserList实现逻辑" class="headerlink" title="getUserList实现逻辑:"></a><code>getUserList</code>实现逻辑:</h4><p>首先从获取token ，关于token是什么，在我的博客<a href="https://jasonxqh.github.io/2020/06/05/react基础4授权与部署/#Storing-the-JWT-JSON-Token">react基础4授权与部署的这个章节Storing the JWT(JSON Token)</a>以及后来的章节已经说的很清楚了，在此不赘述。</p>
<p>然后通过Api.get方法可参照 <a href="http://www.axios-js.com/zh-cn/docs/#axios-get-url-config-1" target="_blank" rel="noopener">axios官方文档</a> 。只有 <code>url</code> 是必需的。如果没有指定 <code>method</code>，请求将默认使用 <code>get</code> 方法。 <code>config</code> 是为请求提供的配置信息</p>
<p>在<a href="https://jasonxqh.github.io/2020/06/05/react基础4授权与部署/">react基础4授权与部署</a>中我们在头部传入一个token的方法是在后端进行修改，然后在头部中获得token然后存储到本地的。</p>
<p>这里我直接利用了axios.get,在请求头中加入token，也就是利用 headers: { Authorization: <code>Bearer ${token}</code> },只有当后端验证了这个token，他才肯把信息传过来嘛，是不是？</p>
<p>然后把response的内容，利用<code>setState</code>方法更新本地state，也就是现在，管理员就可以获得这个应用中用户的表单了</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">getUserList() &#123;</span><br><span class="line">  <span class="keyword">const</span> token = Util.getToken();</span><br><span class="line">  Api.get(<span class="string">'/users/list'</span>, &#123;</span><br><span class="line">    headers: &#123; <span class="attr">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span> &#125;,</span><br><span class="line">  &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (res.data) &#123;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">        userListData: res.data.data,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="删除操作"><a href="#删除操作" class="headerlink" title="删除操作"></a>删除操作</h4><p>管理员利用删除操作可以删除用户信息。</p>
<p>这里我用了<a href="https://ant-design.gitee.io/components/modal-cn/" target="_blank" rel="noopener">antd库中的Modal对话框</a>中的确认对话框：<code>Modal.confirm</code></p>
<p>这里我截取了一段原文档</p>
<p><strong>何时使用？</strong></p>
<p>需要用户处理事务，又不希望跳转页面以致打断工作流程时，可以使用 <code>Modal</code> 在当前页面正中打开一个浮层，承载相应的操作。</p>
<p>另外当需要一个简洁的确认框询问用户时，可以使用 <code>Modal.confirm()</code> 等语法糖方法。</p>
<p>使用 <code>confirm()</code> 可以快捷地弹出确认框。<code>onCancel/onOk</code> 返回 promise 可以延迟关闭。</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/7.png" style="zoom: 67%;"></p>
<p>通过观察confirm对话框，和对应的代码。我们可以清楚的看到<code>title</code>，<code>content</code>，<code>okText</code>,<code>okType</code>,<code>cancelText</code>分别对应了什么。我就不细说了。</p>
<p>那么我们如果点击cancel，那么相安无事。如果点击<code>onOk</code>，也就是confirm的话，那么就会有这样的操作：</p>
<p>首先获取到我这里管理员的token</p>
<p>其次获得一个url，通过这个url可以重置这个人的信息，把他所有的信息抹去。</p>
<p>利用<code>Api.post()</code>传入token，更新data,完成了删除用户的功能</p>
<p>然后判断返回的结果。这里涉及到后端</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">delete</span>(req, res) &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> User.findByIdAndRemove(req.params.id);</span><br><span class="line">  res.status(<span class="number">201</span>).json(&#123; <span class="attr">data</span>: result &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果删除成功，那么就会返回201，附带一个<code>json</code>对象，我们前端通过判断有没有这个对象来判断是否删除成功</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除</span></span><br><span class="line">deleteUser = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> _this = <span class="keyword">this</span>;</span><br><span class="line">  confirm(&#123;</span><br><span class="line">    title: <span class="string">'Are you sure delete?'</span>,</span><br><span class="line">    content: <span class="string">'Hope you know what you are doing！'</span>,</span><br><span class="line">    okText: <span class="string">'confirm'</span>,</span><br><span class="line">    okType: <span class="string">'danger'</span>,</span><br><span class="line">    cancelText: <span class="string">'cancel'</span>,</span><br><span class="line">    onOk() &#123;</span><br><span class="line">      <span class="keyword">const</span> token = Util.getToken();</span><br><span class="line">      <span class="keyword">const</span> postUrl = <span class="string">`/users/<span class="subst">$&#123;item._id&#125;</span>/delete`</span>;</span><br><span class="line">      Api.post(</span><br><span class="line">        postUrl,</span><br><span class="line">        &#123;&#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          headers: &#123; <span class="attr">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span> &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      )</span><br><span class="line">        .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(res);</span><br><span class="line">          <span class="keyword">if</span> (res.data) &#123;</span><br><span class="line">            message.success(<span class="string">'delete success'</span>);</span><br><span class="line">            _this.getUserList();</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            message.error(<span class="string">'fail'</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="built_in">console</span>.log(err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    onCancel() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Cancel'</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="render渲染器部分"><a href="#render渲染器部分" class="headerlink" title="render渲染器部分"></a>render渲染器部分</h4><p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/8.png" style="zoom: 67%;"></p>
<p>搞懂了前面的函数逻辑，渲染器部分就很简单了。首先渲染初一张表格来，利用<a href="https://ant-design.gitee.io/components/table-cn/" target="_blank" rel="noopener">antd中的Table即可</a></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>bordered</th>
<th>是否展示外边框和列边框</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>dataSource</code></td>
<td>数据数组</td>
</tr>
<tr>
<td><code>rowKey</code></td>
<td>表格行 key 的取值，可以是字符串或一个函数</td>
</tr>
<tr>
<td><code>columns</code></td>
<td>列描述数据对象，是 columns 中的一项，Column 使用相同的 <code>API</code>。</td>
</tr>
</tbody>
</table>
</div>
<p>注意最后一列，是一个条件渲染。如果<code>item.name</code> 是<code>admin</code>的话，渲染-- (因为<code>admin</code>不会自己删除自己) 否则就渲染一个删除icon，也是<code>antd</code>中引用过来的。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; userListData &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Table</span><br><span class="line">          bordered</span><br><span class="line">          dataSource=&#123;userListData&#125;</span><br><span class="line">          rowKey=&#123;(row) =&gt; row._id&#125;</span><br><span class="line">          columns=&#123;[</span><br><span class="line">            &#123;</span><br><span class="line">              title: <span class="string">'id'</span>,</span><br><span class="line">              dataIndex: <span class="string">'_id'</span>,</span><br><span class="line">              key: <span class="string">'_id'</span>,</span><br><span class="line">              align: <span class="string">'center'</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              title: <span class="string">'name'</span>,</span><br><span class="line">              dataIndex: <span class="string">'name'</span>,</span><br><span class="line">              key: <span class="string">'name'</span>,</span><br><span class="line">              align: <span class="string">'center'</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              title: <span class="string">'auth'</span>,</span><br><span class="line">              dataIndex: <span class="string">'auth'</span>,</span><br><span class="line">              key: <span class="string">'auth'</span>,</span><br><span class="line">              align: <span class="string">'center'</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">              title: <span class="string">'handle'</span>,</span><br><span class="line">              key: <span class="string">'handle'</span>,</span><br><span class="line">              align: <span class="string">'center'</span>,</span><br><span class="line">              render: <span class="function">(<span class="params">row, item</span>) =&gt;</span> (</span><br><span class="line">                &lt;div className=<span class="string">"person-table-btn"</span>&gt;</span><br><span class="line">                  &#123;item.name !== <span class="string">'admin'</span> ? (</span><br><span class="line">                    &lt;Tooltip placement=<span class="string">"top"</span> title=&#123;<span class="string">'delete'</span>&#125;&gt;</span><br><span class="line">                      &lt;Icon</span><br><span class="line">                        type=<span class="string">"delete"</span></span><br><span class="line">                        theme=<span class="string">"twoTone"</span></span><br><span class="line">                        twoToneColor=<span class="string">"#eb2f96"</span></span><br><span class="line">                        className=<span class="string">"table-btn-item"</span></span><br><span class="line">                        onClick=&#123;() =&gt; <span class="keyword">this</span>.deleteUser(item)&#125;</span><br><span class="line">                      /&gt;</span><br><span class="line">                    &lt;<span class="regexp">/Tooltip&gt;</span></span><br><span class="line"><span class="regexp">                  ) : (</span></span><br><span class="line"><span class="regexp">                    '--'</span></span><br><span class="line"><span class="regexp">                  )&#125;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>div&gt;</span><br><span class="line">              ),</span><br><span class="line">            &#125;,</span><br><span class="line">          ]&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default UsersManage;</span></span><br></pre></td></tr></table></figure>
<h3 id="以豆瓣为例的展示页面"><a href="#以豆瓣为例的展示页面" class="headerlink" title="以豆瓣为例的展示页面"></a>以豆瓣为例的展示页面</h3><p>因为4张表格只选择这一张作为我的例子，所以我打算详细讲一下内部逻辑.为了方便起见，我把源码拆分成几个部分分别讲解。</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/6.png" style="zoom: 67%;"></p>
<p>需要了解<a href="http://www.axios-js.com/zh-cn/docs/#axios-get-url-config-1" target="_blank" rel="noopener">axios官方文档</a>中<code>axios.get</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="comment">//首先从antd中导入一些样式，表格，输入框，分页器，表单，按钮等等</span></span><br><span class="line"><span class="keyword">import</span> &#123; Table, Input, Button, Select, Pagination, Form, message &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/layout'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.scss'</span>;</span><br><span class="line"><span class="comment">//导入Api和Util Api是后端接出来的，我们前端只管调用就可以了</span></span><br><span class="line"><span class="keyword">import</span> Api <span class="keyword">from</span> <span class="string">'../../js/Api'</span>;</span><br><span class="line"><span class="keyword">import</span> Util <span class="keyword">from</span> <span class="string">'../../js/Util'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; Option &#125; = Select;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DouBan</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment"> state是这张表格本地的信息，current表示当前页面，total表示一张图标显示多少条信息</span></span><br><span class="line"><span class="comment"> label就是表头的信息，type就是搜索框的类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">      </span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      list: [],</span><br><span class="line">      current: <span class="number">1</span>,</span><br><span class="line">      total: <span class="number">10</span>,</span><br><span class="line">      label: [</span><br><span class="line">        &#123;</span><br><span class="line">          label: <span class="string">'电影名字'</span>,</span><br><span class="line">          value: <span class="string">'title'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          label: <span class="string">'评分'</span>,</span><br><span class="line">          value: <span class="string">'score'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          label: <span class="string">'国家'</span>,</span><br><span class="line">          value: <span class="string">'country'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          label: <span class="string">'标签'</span>,</span><br><span class="line">          value: <span class="string">'sort'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          label: <span class="string">'导演'</span>,</span><br><span class="line">          value: <span class="string">'director'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          label: <span class="string">'演员'</span>,</span><br><span class="line">          value: <span class="string">'actor'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          label: <span class="string">'上映时间'</span>,</span><br><span class="line">          value: <span class="string">'time'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">      type: [</span><br><span class="line">        &#123;</span><br><span class="line">          label: <span class="string">'AND'</span>,</span><br><span class="line">          value: <span class="string">'AND'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          label: <span class="string">'OR'</span>,</span><br><span class="line">          value: <span class="string">'OR'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="comment">//render()之后调用cdmhook来初始化表格</span></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">this</span>.initTableData();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h4 id="inimitable的逻辑"><a href="#inimitable的逻辑" class="headerlink" title="inimitable的逻辑"></a><code>inimitable</code>的逻辑</h4><p>首先获取到当前的token，然后通过请求头传递到后端去申请数据，后端调用的是<code>findAll</code>函数 (详见后端实现博客:<a href="https://jasonxqh.github.io/2020/06/08/Express框架在后端的应用/#getAll"> Express框架在后端的应用之getAll</a>，把返回的数据,也就是当前页的信息，对state进行更新。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">initTableData(current, sort) &#123;</span><br><span class="line">   <span class="keyword">const</span> token = Util.getToken();</span><br><span class="line">   Api.get(<span class="string">`/douban/list?page=<span class="subst">$&#123;current&#125;</span>&amp;sort=<span class="subst">$&#123;sort&#125;</span>`</span>, &#123;</span><br><span class="line">     headers: &#123; <span class="attr">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span> &#125;,</span><br><span class="line">   &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">if</span> (res.data) &#123;</span><br><span class="line">       <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">         list: res.data.data,</span><br><span class="line">         total: res.data.total,</span><br><span class="line">       &#125;);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="onChange的逻辑"><a href="#onChange的逻辑" class="headerlink" title="onChange的逻辑"></a><code>onChange</code>的逻辑</h4><p>这个用在分页上。首先获得token，透过请求头进行传递。认证后将返回的data更新本地state，注意，因为分页了，所以还要更新current 为当前页</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">onChange = <span class="function">(<span class="params">page</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">const</span> token = Util.getToken();</span><br><span class="line">   Api.get(<span class="string">`/douban/list?page=<span class="subst">$&#123;page&#125;</span>`</span>, &#123; <span class="attr">headers</span>: &#123; <span class="attr">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span> &#125; &#125;).then(</span><br><span class="line">     (res) =&gt; &#123;</span><br><span class="line">       <span class="keyword">if</span> (res.data) &#123;</span><br><span class="line">         <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">           list: res.data.data,</span><br><span class="line">           total: res.data.total,</span><br><span class="line">           current: page,</span><br><span class="line">         &#125;);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;,</span><br><span class="line">   );</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>
<h4 id="提交表单操作"><a href="#提交表单操作" class="headerlink" title="提交表单操作"></a>提交表单操作</h4><p>首先获取到token， <code>e.preventDefault()</code>;不让重新加载</p>
<p><code>validateFields</code>是验证表单的函数，这是antd提供的api ，是用于出发表单验证的</p>
<p>首先从values中解构初我们传入的信息</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/9.png" style="zoom: 67%;"></p>
<p>也就是这五个框框。然后写我们的验证逻辑。</p>
<ol>
<li>label1 不能等于label2</li>
<li>如果type=AND，就说明两个条件都要满足，type=OR那么只满足一个条件即可.这里我不谈后端如何实现。因为有专门的博客<a href="https://jasonxqh.github.io/2020/06/08/Express框架在后端的应用/#more">Express框架在后端的应用</a>来介绍，然后把返回的结果更新到本地的state当中</li>
<li>如果是AND请求，那么我需要请求<code>/douban/getList</code> ，在这里后端会调用 <code>getListByKey</code>函数 ，在<a href="https://jasonxqh.github.io/2020/06/08/Express框架在后端的应用/#douban-js-2">Express框架在后端的应用douban.js中有所介绍</a>，返回两者皆满足的信息</li>
<li>如果是OR请求，那么我需要请求<code>/douban/getListOr</code>,在这里后端会调用<code>getListByOr</code>函数，在<a href="https://jasonxqh.github.io/2020/06/08/Express框架在后端的应用/#douban-js-2">Express框架在后端的应用douban.js中有所介绍</a>，返回两者择一满足的信息</li>
<li>同时，我们要满足选择的时候要排序这个功能，那么我们需要在req中加上sort的类型</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line">handleSubmit = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; sort &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">  <span class="keyword">const</span> token = Util.getToken();</span><br><span class="line">  e.preventDefault();</span><br><span class="line">  <span class="keyword">this</span>.props.form.validateFields(<span class="function">(<span class="params">err, values</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; label1, value1, type, label2, value2 &#125; = values;</span><br><span class="line">      <span class="keyword">if</span> (label1 === label2) &#123;</span><br><span class="line">        message.error(<span class="string">'两个查询字段不可重复！'</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> keyWords = <span class="string">`<span class="subst">$&#123;label1&#125;</span>=<span class="subst">$&#123;value1&#125;</span>&amp;<span class="subst">$&#123;label2&#125;</span>=<span class="subst">$&#123;value2&#125;</span>`</span>;</span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">'AND'</span>) &#123;</span><br><span class="line">          Api.get(<span class="string">`/douban/getList?<span class="subst">$&#123;keyWords&#125;</span>&amp;sort=<span class="subst">$&#123;sort&#125;</span>`</span>, &#123;</span><br><span class="line">            headers: &#123; <span class="attr">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span> &#125;,</span><br><span class="line">          &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (res.data) &#123;</span><br><span class="line">              <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                list: res.data.data,</span><br><span class="line">                total: res.data.total,</span><br><span class="line">                current: <span class="number">1</span>,</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          Api.get(<span class="string">`/douban/getListOr?<span class="subst">$&#123;keyWords&#125;</span>`</span>, &#123;</span><br><span class="line">            headers: &#123; <span class="attr">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>&amp;sort=<span class="subst">$&#123;sort&#125;</span>`</span> &#125;,</span><br><span class="line">          &#125;).then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (res.data) &#123;</span><br><span class="line">              <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                list: res.data.data,</span><br><span class="line">                total: res.data.total,</span><br><span class="line">                current: <span class="number">1</span>,</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="重置操作"><a href="#重置操作" class="headerlink" title="重置操作"></a>重置操作</h4><p><code>resetFields</code> 会重置整个 Field，因而其子组件也会重新 mount<br>从而消除自定义组件可能存在的副作用（例如异步数据、状态等等）<br>然后调用<code>initTableData</code>函数初始化 </p>
<p>最后别忘了设置current=1，否则下面的分页器还停留在原来的位置，但是表格已经回到了首页</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">reset() &#123;</span><br><span class="line">  <span class="keyword">this</span>.props.form.resetFields();</span><br><span class="line">  <span class="keyword">this</span>.initTableData();</span><br><span class="line">  <span class="keyword">this</span>.state.current = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="排序操作"><a href="#排序操作" class="headerlink" title="排序操作"></a>排序操作</h4><p>后端排序和前端排序不太一样，前端排序的逻辑在<a href="https://jasonxqh.github.io/2020/06/02/react基础2/#Sorting-Extracting-MoviesTable-封装MoviesTable">react基础2中的sort</a>已经提到了</p>
<p>而后端排序则是前端发送一个request到后端，后端根据前端的sort种类来进行排序，再把数据返回</p>
<p>这里是一个更新State中sort种类的函数，默认sort为null，也就是不排序</p>
<p>后端排序的逻辑在这里实现: <a href="https://jasonxqh.github.io/2020/06/08/Express框架在后端的应用/#findAll-1">后端排序findAll</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sort(type) &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(</span><br><span class="line">      &#123;</span><br><span class="line">        sort: type,</span><br><span class="line">      &#125;,</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        <span class="keyword">this</span>.initTableData(<span class="literal">null</span>, type);</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>随后，我们在<code>initTableData</code>函数当中发送我们的sort请求</p>
<p>在排序过程中出现了一些小插曲，一开始我是根据字符串大小排序的。但是修改了变量类型之后，问题解决了</p>
<p>我们看到排序过后，价格是按照数字排序的，而不是字符串大小排序的。</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/11.png" style="zoom: 67%;"></p>
<h4 id="render渲染器"><a href="#render渲染器" class="headerlink" title="render渲染器"></a>render渲染器</h4><p>首先解构state和form(antd)</p>
<p>然后渲染选择框：</p>
<ol>
<li>第一个请选择查询字段的选择框：<code>getFieldDecorator</code>用户和表单进行双向绑定。 required: true是必须要填(如果想提交) ，然后就是一个选择框，默认占位符是请选择查询的字段。然后把label数组中信息的都渲染到下拉选择表单当中</li>
<li>第二个是输入框，也是必须要填的，也就是我们想搜索的内容</li>
<li>第三个框是选择查询类型，这里可以是AND，可以为OR，因为渲染的是type数组</li>
<li>第四第五个的逻辑和第一第二个一样</li>
<li>然后是查询和充值按钮，点击后分别触发<code>handleSubmit()</code>和<code>reset()</code></li>
<li>最后是一个分页器</li>
</ol>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; getFieldDecorator &#125; = <span class="keyword">this</span>.props.form;</span><br><span class="line">    <span class="keyword">const</span> &#123; list, total, current, label, type &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;Layout&gt;</span><br><span class="line">&#123;<span class="comment">/*</span></span><br><span class="line"><span class="comment">导出部分分为两大组件，分别是搜索框和表格Tablebody部分</span></span><br><span class="line"><span class="comment">*/</span>&#125;          </span><br><span class="line">          &lt;div className=<span class="string">"search"</span>&gt;</span><br><span class="line">            &lt;Form layout=<span class="string">"inline"</span> onSubmit=&#123;<span class="keyword">this</span>.handleSubmit&#125;&gt;</span><br><span class="line">              &lt;Form.Item className=<span class="string">"item"</span>&gt;</span><br><span class="line">                &#123;getFieldDecorator(<span class="string">'label1'</span>, &#123;</span><br><span class="line">                  rules: [</span><br><span class="line">                    &#123;</span><br><span class="line">                      required: <span class="literal">true</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                  ],</span><br><span class="line">                &#125;)(</span><br><span class="line">                  &lt;Select placeholder=<span class="string">"请选择查询的字段"</span> style=&#123;&#123; <span class="attr">width</span>: <span class="string">'200px'</span> &#125;&#125;&gt;</span><br><span class="line">                    &#123;label.map(<span class="function">(<span class="params">item</span>) =&gt;</span> (</span><br><span class="line">                      &lt;Option value=&#123;item.value&#125; key=&#123;item.label&#125; label=&#123;item.label&#125;&gt;</span><br><span class="line">                        &#123;item.label&#125;</span><br><span class="line">                      &lt;<span class="regexp">/Option&gt;</span></span><br><span class="line"><span class="regexp">                    ))&#125;</span></span><br><span class="line"><span class="regexp">                  &lt;/</span>Select&gt;,</span><br><span class="line">                )&#125;</span><br><span class="line">              &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">              &lt;Form.Item className="item"&gt;</span></span><br><span class="line"><span class="regexp">                &#123;getFieldDecorator('value1', &#123;</span></span><br><span class="line"><span class="regexp">                  rules: [&#123; required: true &#125;],</span></span><br><span class="line"><span class="regexp">                &#125;)(&lt;Input size="default" /</span>&gt;)&#125;</span><br><span class="line">              &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">              &lt;Form.Item className="item"&gt;</span></span><br><span class="line"><span class="regexp">                &#123;getFieldDecorator('type', &#123;</span></span><br><span class="line"><span class="regexp">                  rules: [</span></span><br><span class="line"><span class="regexp">                    &#123;</span></span><br><span class="line"><span class="regexp">                      required: true,</span></span><br><span class="line"><span class="regexp">                    &#125;,</span></span><br><span class="line"><span class="regexp">                  ],</span></span><br><span class="line"><span class="regexp">                &#125;)(</span></span><br><span class="line"><span class="regexp">                  &lt;Select placeholder="查询类型" style=&#123;&#123; width: '150px' &#125;&#125;&gt;</span></span><br><span class="line"><span class="regexp">                    &#123;type.map((item) =&gt; (</span></span><br><span class="line"><span class="regexp">                      &lt;Option value=&#123;item.value&#125; key=&#123;item.label&#125; label=&#123;item.label&#125;&gt;</span></span><br><span class="line"><span class="regexp">                        &#123;item.label&#125;</span></span><br><span class="line"><span class="regexp">                      &lt;/</span>Option&gt;</span><br><span class="line">                    ))&#125;</span><br><span class="line">                  &lt;<span class="regexp">/Select&gt;,</span></span><br><span class="line"><span class="regexp">                )&#125;</span></span><br><span class="line"><span class="regexp">              &lt;/</span>Form.Item&gt;</span><br><span class="line">              &lt;Form.Item className=<span class="string">"item"</span>&gt;</span><br><span class="line">                &#123;getFieldDecorator(<span class="string">'label2'</span>, &#123;</span><br><span class="line">                  rules: [</span><br><span class="line">                    &#123;</span><br><span class="line">                      required: <span class="literal">true</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                  ],</span><br><span class="line">                &#125;)(</span><br><span class="line">                  &lt;Select placeholder=<span class="string">"请选择查询的字段"</span> style=&#123;&#123; <span class="attr">width</span>: <span class="string">'200px'</span> &#125;&#125;&gt;</span><br><span class="line">                    &#123;label.map(<span class="function">(<span class="params">item</span>) =&gt;</span> (</span><br><span class="line">                      &lt;Option value=&#123;item.value&#125; key=&#123;item.label&#125; label=&#123;item.label&#125;&gt;</span><br><span class="line">                        &#123;item.label&#125;</span><br><span class="line">                      &lt;<span class="regexp">/Option&gt;</span></span><br><span class="line"><span class="regexp">                    ))&#125;</span></span><br><span class="line"><span class="regexp">                  &lt;/</span>Select&gt;,</span><br><span class="line">                )&#125;</span><br><span class="line">              &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">              &lt;Form.Item className="item"&gt;</span></span><br><span class="line"><span class="regexp">                &#123;getFieldDecorator('value2', &#123;</span></span><br><span class="line"><span class="regexp">                  rules: [&#123; required: true &#125;],</span></span><br><span class="line"><span class="regexp">                &#125;)(&lt;Input size="default" /</span>&gt;)&#125;</span><br><span class="line">              &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">              &lt;Form.Item className="item"&gt;</span></span><br><span class="line"><span class="regexp">                &lt;Button size="default" type="primary" htmlType="submit"&gt;</span></span><br><span class="line"><span class="regexp">                  查询</span></span><br><span class="line"><span class="regexp">                &lt;/</span>Button&gt;</span><br><span class="line">                &lt;Button size=<span class="string">"default"</span> type=<span class="string">"primary"</span> onClick=&#123;() =&gt; <span class="keyword">this</span>.reset()&#125; style=&#123;&#123;<span class="attr">marginLeft</span>: <span class="string">'10px'</span>&#125;&#125;&gt;</span><br><span class="line">                  重置</span><br><span class="line">                &lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">              &lt;/</span>Form.Item&gt;</span><br><span class="line">            &lt;<span class="regexp">/Form&gt;</span></span><br><span class="line"><span class="regexp">              &lt;Button</span></span><br><span class="line"><span class="regexp">              type=&#123;sort === "normal" ? "primary" : ""&#125;</span></span><br><span class="line"><span class="regexp">              style=&#123;&#123; marginRight: "10px" &#125;&#125;</span></span><br><span class="line"><span class="regexp">              onClick=&#123;() =&gt; this.sort("normal")&#125;</span></span><br><span class="line"><span class="regexp">            &gt;</span></span><br><span class="line"><span class="regexp">              分数从高到低</span></span><br><span class="line"><span class="regexp">            &lt;/</span>Button&gt;</span><br><span class="line">            &lt;Button</span><br><span class="line">              type=&#123;sort === <span class="string">"reverse"</span> ? <span class="string">"primary"</span> : <span class="string">""</span>&#125;</span><br><span class="line">              onClick=&#123;() =&gt; <span class="keyword">this</span>.sort(<span class="string">"reverse"</span>)&#125;</span><br><span class="line">              style=&#123;&#123; <span class="attr">marginRight</span>: <span class="string">"10px"</span> &#125;&#125;</span><br><span class="line">            &gt;</span><br><span class="line">              分数从低到高</span><br><span class="line">            &lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>div&gt;</span><br><span class="line"></span><br><span class="line">          &lt;div&gt;</span><br><span class="line">            &lt;div style=&#123;&#123; <span class="attr">display</span>: <span class="string">'flex'</span> &#125;&#125;&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Table /</span><span class="regexp">/渲染表格</span></span><br><span class="line"><span class="regexp">              bordered</span></span><br><span class="line"><span class="regexp">              dataSource=&#123;list&#125;</span></span><br><span class="line"><span class="regexp">              rowKey=&#123;(row) =&gt; row._id&#125;</span></span><br><span class="line"><span class="regexp">              pagination=&#123;false&#125;</span></span><br><span class="line"><span class="regexp">                /</span><span class="regexp">/列</span></span><br><span class="line"><span class="regexp">              columns=&#123;[</span></span><br><span class="line"><span class="regexp">                &#123;</span></span><br><span class="line"><span class="regexp">                  title: '电影名字',</span></span><br><span class="line"><span class="regexp">                  dataIndex: 'title',</span></span><br><span class="line"><span class="regexp">                  key: 'title',</span></span><br><span class="line"><span class="regexp">                  align: 'center',</span></span><br><span class="line"><span class="regexp">                &#125;,</span></span><br><span class="line"><span class="regexp">                &#123;</span></span><br><span class="line"><span class="regexp">                  title: '导演',</span></span><br><span class="line"><span class="regexp">                  dataIndex: 'director',</span></span><br><span class="line"><span class="regexp">                  key: 'director',</span></span><br><span class="line"><span class="regexp">                  align: 'center',</span></span><br><span class="line"><span class="regexp">                &#125;,</span></span><br><span class="line"><span class="regexp">                &#123;</span></span><br><span class="line"><span class="regexp">                  title: '演员',</span></span><br><span class="line"><span class="regexp">                  dataIndex: 'actor',</span></span><br><span class="line"><span class="regexp">                  key: 'actor',</span></span><br><span class="line"><span class="regexp">                  align: 'center',</span></span><br><span class="line"><span class="regexp">                  // width: 600,</span></span><br><span class="line"><span class="regexp">                &#125;,</span></span><br><span class="line"><span class="regexp">                &#123;</span></span><br><span class="line"><span class="regexp">                  title: '国家',</span></span><br><span class="line"><span class="regexp">                  dataIndex: 'country',</span></span><br><span class="line"><span class="regexp">                  key: 'country',</span></span><br><span class="line"><span class="regexp">                  align: 'center',</span></span><br><span class="line"><span class="regexp">                  width: 100,</span></span><br><span class="line"><span class="regexp">                &#125;,</span></span><br><span class="line"><span class="regexp">                &#123;</span></span><br><span class="line"><span class="regexp">                  title: '标签',</span></span><br><span class="line"><span class="regexp">                  dataIndex: 'sort',</span></span><br><span class="line"><span class="regexp">                  key: 'sort',</span></span><br><span class="line"><span class="regexp">                  align: 'center',</span></span><br><span class="line"><span class="regexp">                  width: 200,</span></span><br><span class="line"><span class="regexp">                &#125;,</span></span><br><span class="line"><span class="regexp">                &#123;</span></span><br><span class="line"><span class="regexp">                  title: '评分',</span></span><br><span class="line"><span class="regexp">                  dataIndex: 'score',</span></span><br><span class="line"><span class="regexp">                  key: 'score',</span></span><br><span class="line"><span class="regexp">                  align: 'center',</span></span><br><span class="line"><span class="regexp">                &#125;,</span></span><br><span class="line"><span class="regexp">                &#123;</span></span><br><span class="line"><span class="regexp">                  title: '上映时间',</span></span><br><span class="line"><span class="regexp">                  dataIndex: 'time',</span></span><br><span class="line"><span class="regexp">                  key: 'time',</span></span><br><span class="line"><span class="regexp">                  align: 'center',</span></span><br><span class="line"><span class="regexp">                &#125;,</span></span><br><span class="line"><span class="regexp">              ]&#125;</span></span><br><span class="line"><span class="regexp">            /</span>&gt;</span><br><span class="line">            &lt;Pagination</span><br><span class="line">             <span class="comment">//分页器，在react基础2分页部分有具体实现，这里直接引用了antd中的分页器样式 </span></span><br><span class="line">              style=&#123;&#123; <span class="attr">marginTop</span>: <span class="string">'20px'</span> &#125;&#125;</span><br><span class="line">              defaultPageSize=&#123;<span class="number">10</span>&#125;</span><br><span class="line">              current=&#123;current&#125;</span><br><span class="line">              onChange=&#123;<span class="keyword">this</span>.onChange&#125;</span><br><span class="line">              total=&#123;total&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Layout&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const mapStateToProps = (state) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  return &#123;</span></span><br><span class="line"><span class="regexp">    userData: state.userData.data,</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const wrappedDouBanForm = Form.create(&#123; name: 'douban' &#125;)(DouBan);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default connect(mapStateToProps, null)(wrappedDouBanForm);</span></span><br></pre></td></tr></table></figure>
<h3 id="Operas-jsx-新建表单"><a href="#Operas-jsx-新建表单" class="headerlink" title="Operas.jsx 新建表单"></a><code>Operas.jsx</code> 新建表单</h3><p>剩下的三张表中，猫眼和淘宝咖啡都可以进行一些排序（分数，价格）。 但是Opera表格却没有什么可以排序的</p>
<p>所以我就在operas.jsx中新加入了一个创建新剧的功能</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/12.png" style="zoom: 67%;"></p>
<p>点击新建按钮，我们会跳转一个表单</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/13.png" style="zoom: 67%;"></p>
<p>然后我们输入我们想要创建的新电视剧</p>
<p>比如：</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/14.png" style="zoom: 67%;"></p>
<p>因为单集片长可选填，所以这里就暂时不填</p>
<p>点击创建后，我们就可以在表中查询到这条电视剧信息啦！</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/15.png" style="zoom: 67%;"></p>
<h4 id="实现逻辑"><a href="#实现逻辑" class="headerlink" title="实现逻辑"></a>实现逻辑</h4><p>后端逻辑请移步</p>
<p>首先新建一个operaform的表格，用于存放我们的表单</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Redirect &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">'react-redux'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createHashHistory &#125; <span class="keyword">from</span> <span class="string">'history'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Form, Icon, Input, Button, message &#125; <span class="keyword">from</span> <span class="string">'antd'</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">'../components/layout'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.scss'</span>;</span><br><span class="line"><span class="keyword">import</span> Api <span class="keyword">from</span> <span class="string">'../../js/Api'</span>;</span><br><span class="line"><span class="keyword">const</span> history = createHashHistory(&#123; <span class="attr">forceRefresh</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MovieForm</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  componentDidMount() &#123;&#125;</span><br><span class="line"><span class="comment">// 提交表单操作，我们利用post这个api新建一条信息，然后如果新建成功的话就跳转到operas界面</span></span><br><span class="line">  handleSubmit = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    <span class="keyword">this</span>.props.form.validateFields(<span class="function">(<span class="params">err, values</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!err) &#123;</span><br><span class="line">        Api.post(<span class="string">'/operas/create'</span>, values)</span><br><span class="line">          .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (res.data) &#123;</span><br><span class="line">              message.success(<span class="string">'create successfully'</span>);</span><br><span class="line">              history.push(<span class="string">'/operas'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err);</span><br><span class="line">            message.error(err.message);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; getFieldDecorator &#125; = <span class="keyword">this</span>.props.form;</span><br><span class="line">    <span class="keyword">const</span> &#123; userData &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> &#123; isLogin &#125; = userData;</span><br><span class="line">    <span class="keyword">const</span> formItemLayout = &#123;</span><br><span class="line">      labelCol: &#123;</span><br><span class="line">        xs: &#123; <span class="attr">span</span>: <span class="number">24</span> &#125;,</span><br><span class="line">        sm: &#123; <span class="attr">span</span>: <span class="number">8</span> &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      wrapperCol: &#123;</span><br><span class="line">        xs: &#123; <span class="attr">span</span>: <span class="number">24</span> &#125;,</span><br><span class="line">        sm: &#123; <span class="attr">span</span>: <span class="number">16</span> &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> tailFormItemLayout = &#123;</span><br><span class="line">      wrapperCol: &#123;</span><br><span class="line">        xs: &#123;</span><br><span class="line">          span: <span class="number">24</span>,</span><br><span class="line">          offset: <span class="number">0</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        sm: &#123;</span><br><span class="line">          span: <span class="number">22</span>,</span><br><span class="line">          offset: <span class="number">2</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Layout&gt;</span><br><span class="line">        &lt;h1 className=<span class="string">"title"</span>&gt;快来创建最新的电视剧吧！&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Form &#123;...formItemLayout&#125; onSubmit=&#123;this.handleSubmit&#125; className="login-form"&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="剧集名字" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &#123;getFieldDecorator('title', &#123;</span></span><br><span class="line"><span class="regexp">              rules: [&#123; required: true &#125;],</span></span><br><span class="line"><span class="regexp">            &#125;)(</span></span><br><span class="line"><span class="regexp">              &lt;Input</span></span><br><span class="line"><span class="regexp">                size="large"</span></span><br><span class="line"><span class="regexp">                placeholder="剧集名字"</span></span><br><span class="line"><span class="regexp">              /</span>&gt;,</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="演员" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &#123;getFieldDecorator('actors', &#123;</span></span><br><span class="line"><span class="regexp">              rules: [&#123; required: true &#125;],</span></span><br><span class="line"><span class="regexp">            &#125;)(</span></span><br><span class="line"><span class="regexp">              &lt;Input</span></span><br><span class="line"><span class="regexp">                size="large"</span></span><br><span class="line"><span class="regexp">                placeholder="演员"</span></span><br><span class="line"><span class="regexp">              /</span>&gt;,</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="国家" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &#123;getFieldDecorator('country', &#123;</span></span><br><span class="line"><span class="regexp">              rules: [&#123; required: true &#125;],</span></span><br><span class="line"><span class="regexp">            &#125;)(</span></span><br><span class="line"><span class="regexp">              &lt;Input</span></span><br><span class="line"><span class="regexp">                size="large"</span></span><br><span class="line"><span class="regexp">                placeholder="国家"</span></span><br><span class="line"><span class="regexp">              /</span>&gt;,</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="类型" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &#123;getFieldDecorator('type', &#123;</span></span><br><span class="line"><span class="regexp">              rules: [&#123; required: true &#125;],</span></span><br><span class="line"><span class="regexp">            &#125;)(</span></span><br><span class="line"><span class="regexp">              &lt;Input</span></span><br><span class="line"><span class="regexp">                size="large"</span></span><br><span class="line"><span class="regexp">                placeholder="类型:"</span></span><br><span class="line"><span class="regexp">              /</span>&gt;,</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="单集片长" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &#123;getFieldDecorator('single', &#123;</span></span><br><span class="line"><span class="regexp">              rules: [&#123; required: false &#125;],</span></span><br><span class="line"><span class="regexp">            &#125;)(</span></span><br><span class="line"><span class="regexp">              &lt;Input</span></span><br><span class="line"><span class="regexp">                size="large"</span></span><br><span class="line"><span class="regexp">                placeholder="单集片长:"</span></span><br><span class="line"><span class="regexp">              /</span>&gt;,</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="首播时间" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &#123;getFieldDecorator('first_date', &#123;</span></span><br><span class="line"><span class="regexp">              rules: [&#123; required: false &#125;],</span></span><br><span class="line"><span class="regexp">            &#125;)(</span></span><br><span class="line"><span class="regexp">              &lt;Input</span></span><br><span class="line"><span class="regexp">                size="large"</span></span><br><span class="line"><span class="regexp">                placeholder="首播时间:"</span></span><br><span class="line"><span class="regexp">              /</span>&gt;,</span><br><span class="line">            )&#125;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item &#123;...tailFormItemLayout&#125; className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Button size="large" type="primary" htmlType="submit" className="login-form-button"&gt;</span></span><br><span class="line"><span class="regexp">              创建</span></span><br><span class="line"><span class="regexp">            &lt;/</span>Button&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Form&gt;</span><br><span class="line">      &lt;<span class="regexp">/Layout&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const mapStateToProps = (state) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  return &#123;</span></span><br><span class="line"><span class="regexp">    userData: state.userData.data,</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const wrappedMovieForm = Form.create(&#123; name: 'MovieForm' &#125;)(MovieForm);</span></span><br><span class="line"><span class="regexp">export default connect(mapStateToProps, null)(wrappedMovieForm);</span></span><br></pre></td></tr></table></figure>
<p>其次在<code>operas.jsx</code>中新建一个button，用于跳转</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">//...</span></span><br><span class="line">  createForm() &#123;</span><br><span class="line">    history.push(<span class="string">"/operas/create"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&lt;Button</span><br><span class="line">  size=<span class="string">"default"</span></span><br><span class="line">  type=<span class="string">"primary"</span></span><br><span class="line">  onClick=&#123;() =&gt; <span class="keyword">this</span>.createForm()&#125;</span><br><span class="line">  style=&#123;&#123; <span class="attr">marginLeft</span>: <span class="string">"10px"</span> &#125;&#125;</span><br><span class="line">&gt;</span><br><span class="line">  新建</span><br><span class="line">&lt;<span class="regexp">/Button&gt;</span></span><br></pre></td></tr></table></figure>
<p>最后<code>app.jsx</code>中申请路由。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> OperaForm = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">"./operaform"</span>));</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&lt;PrivateRoute exact path=<span class="string">"/operas/create"</span> component=&#123;OperaForm&#125; /&gt;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>
<p>有新建，必定有删除鸭</p>
<p>实现逻辑和admin删除user一样。这里就不多讲了</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//... </span></span><br><span class="line">deleteOperas = <span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> _this = <span class="keyword">this</span>;</span><br><span class="line">    confirm(&#123;</span><br><span class="line">      title: <span class="string">"Are you sure delete?"</span>,</span><br><span class="line">      content: <span class="string">"Hope you know what you are doing！"</span>,</span><br><span class="line">      okText: <span class="string">"confirm"</span>,</span><br><span class="line">      okType: <span class="string">"danger"</span>,</span><br><span class="line">      cancelText: <span class="string">"cancel"</span>,</span><br><span class="line">      onOk() &#123;</span><br><span class="line">        <span class="keyword">const</span> token = Util.getToken();</span><br><span class="line">        Api.post( <span class="string">`/operas/<span class="subst">$&#123;item._id&#125;</span>/delete`</span>,&#123;</span><br><span class="line">          headers: &#123; <span class="attr">Authorization</span>: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span> &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">          .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(res);</span><br><span class="line">            <span class="keyword">if</span> (res.data) &#123;</span><br><span class="line">              message.success(<span class="string">"delete success"</span>);</span><br><span class="line">              _this.getUserList();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              message.error(<span class="string">"fail"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;)</span><br><span class="line">          .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(err);</span><br><span class="line">          &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">      onCancel() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Cancel"</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">  &#123;</span><br><span class="line">    title: <span class="string">"delete"</span>,</span><br><span class="line">    key: <span class="string">"delete"</span>,</span><br><span class="line">    align: <span class="string">"center"</span>,</span><br><span class="line">    render: <span class="function">(<span class="params">row, item</span>) =&gt;</span> (</span><br><span class="line">      &lt;div className=<span class="string">"person-table-btn"</span>&gt;</span><br><span class="line">        &#123;</span><br><span class="line">          &lt;Tooltip placement=<span class="string">"top"</span> title=&#123;<span class="string">"delete"</span>&#125;&gt;</span><br><span class="line">            &lt;Icon</span><br><span class="line">              type=<span class="string">"delete"</span></span><br><span class="line">              theme=<span class="string">"twoTone"</span></span><br><span class="line">              twoToneColor=<span class="string">"#eb2f96"</span></span><br><span class="line">              className=<span class="string">"table-btn-item"</span></span><br><span class="line">              onClick=&#123;() =&gt; <span class="keyword">this</span>.deleteOperas(item)&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;<span class="regexp">/Tooltip&gt;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt; </span><br><span class="line">     ),</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/16.png" style="zoom: 67%;"></p>
<h3 id="实现收藏功能"><a href="#实现收藏功能" class="headerlink" title="实现收藏功能"></a>实现收藏功能</h3><p>我想，能不能加入一个收藏夹的功能，让用户能够把他中意的美剧放在收藏夹当中呢？</p>
<p>我的实现逻辑：首先新建一张schema，来存放我收藏夹中的信息，让然后在opera表格当中新添加一列 Like列，里面有一个点赞按钮，当点击后这个美剧就被添加到我们的收藏夹当中了。</p>
<p>在收藏夹中，我也以表格形式展示，可以删除收藏夹中的信息。还有返回按钮返回展示页面</p>
<p>因代码和展示页面类似，所以这里就不再展示了。</p>
<p><img src="/2020/06/07/React%E6%A1%86%E6%9E%B6%E5%9C%A8%E4%BD%9C%E4%B8%9A%E5%BD%93%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/17.png" style="zoom: 67%;"></p>
<h3 id="实现具体信息展示"><a href="#实现具体信息展示" class="headerlink" title="实现具体信息展示"></a>实现具体信息展示</h3><p>这个功能在学习博客：<a href="https://jasonxqh.github.io/2020/06/04/react基础3/#Exercise-1-Register-Form">Register Form</a> 中，我把他运用到了这个项目当中</p>
<p>简单的来说，就是在展示界面的title列，渲染一个链接，让它指向一个网页，这个网页会在进行<code>componentDidMount</code>时自动把从后端请求过来的detailed message 渲染到表单当中。但是美中不足的时这个表单暂时不支持修改。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; connect &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createHashHistory &#125; <span class="keyword">from</span> <span class="string">"history"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Form, Input, Button  &#125; <span class="keyword">from</span> <span class="string">"antd"</span>;</span><br><span class="line"><span class="keyword">import</span> Layout <span class="keyword">from</span> <span class="string">"../components/layout"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./style.scss"</span>;</span><br><span class="line"><span class="keyword">import</span> Api <span class="keyword">from</span> <span class="string">"../../js/Api"</span>;</span><br><span class="line"><span class="keyword">const</span> history = createHashHistory(&#123; <span class="attr">forceRefresh</span>: <span class="literal">true</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MovieForm</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">    <span class="keyword">super</span>(props);</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;&#125;;</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      _id: <span class="literal">null</span>,</span><br><span class="line">      actors: <span class="literal">null</span>,</span><br><span class="line">      country: <span class="literal">null</span>,</span><br><span class="line">      first_date: <span class="literal">null</span>,</span><br><span class="line">      now: <span class="literal">null</span>,</span><br><span class="line">      other_name: <span class="literal">null</span>,</span><br><span class="line">      single: <span class="literal">null</span>,</span><br><span class="line">      station: <span class="literal">null</span>,</span><br><span class="line">      title: <span class="literal">null</span>,</span><br><span class="line">      type: <span class="literal">null</span>,</span><br><span class="line">      url: <span class="literal">null</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">this</span>.populateOpera();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> populateOpera() &#123;</span><br><span class="line">    <span class="keyword">const</span> operaname = <span class="keyword">this</span>.props.match.params.id; <span class="comment">//获取url参数</span></span><br><span class="line">    <span class="keyword">const</span> opera = Api.get(<span class="string">`/operas/<span class="subst">$&#123;operaname&#125;</span>`</span>);</span><br><span class="line">    <span class="keyword">const</span> details = (<span class="keyword">await</span> opera).data;</span><br><span class="line">    <span class="keyword">const</span> infos = details.targetOpera[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      _id,</span><br><span class="line">      actors,</span><br><span class="line">      country,</span><br><span class="line">      first_date,</span><br><span class="line">      now,</span><br><span class="line">      other_name,</span><br><span class="line">      single,</span><br><span class="line">      station,</span><br><span class="line">      title,</span><br><span class="line">      type,</span><br><span class="line">      url,</span><br><span class="line">    &#125; = infos;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">      _id,</span><br><span class="line">      actors,</span><br><span class="line">      country,</span><br><span class="line">      first_date,</span><br><span class="line">      now,</span><br><span class="line">      other_name,</span><br><span class="line">      single,</span><br><span class="line">      station,</span><br><span class="line">      title,</span><br><span class="line">      type,</span><br><span class="line">      url,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// console.log(actors)</span></span><br><span class="line">  &#125;</span><br><span class="line">  back() &#123;</span><br><span class="line">    history.push(<span class="string">'/operas'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      _id,</span><br><span class="line">      actors,</span><br><span class="line">      country,</span><br><span class="line">      first_date,</span><br><span class="line">      now,</span><br><span class="line">      other_name,</span><br><span class="line">      single,</span><br><span class="line">      station,</span><br><span class="line">      title,</span><br><span class="line">      type,</span><br><span class="line">      url,</span><br><span class="line">    &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="built_in">console</span>.log(actors);</span><br><span class="line">    <span class="keyword">const</span> &#123; getFieldDecorator &#125; = <span class="keyword">this</span>.props.form;</span><br><span class="line">    <span class="keyword">const</span> &#123; userData &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">const</span> &#123; name, isLogin &#125; = userData;</span><br><span class="line">    <span class="keyword">const</span> formItemLayout = &#123;</span><br><span class="line">      labelCol: &#123; <span class="attr">span</span>: <span class="number">50</span> &#125;,</span><br><span class="line">      wrapperCol: &#123; <span class="attr">span</span>: <span class="number">60</span> &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">const</span> tailFormItemLayout = &#123;</span><br><span class="line">      wrapperCol: &#123;</span><br><span class="line">        xs: &#123;</span><br><span class="line">          span: <span class="number">24</span>,</span><br><span class="line">          offset: <span class="number">0</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        sm: &#123;</span><br><span class="line">          span: <span class="number">22</span>,</span><br><span class="line">          offset: <span class="number">2</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Layout&gt;</span><br><span class="line">        &lt;strong className=<span class="string">"title"</span>&gt;DetailedInformation&lt;<span class="regexp">/strong&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Form</span></span><br><span class="line"><span class="regexp">          &#123;...formItemLayout&#125;</span></span><br><span class="line"><span class="regexp">          onSubmit=&#123;this.handleSubmit&#125;</span></span><br><span class="line"><span class="regexp">          className="login-form"</span></span><br><span class="line"><span class="regexp">        &gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="剧集名字" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Input size="large" value=&#123;title&#125; /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="演员" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Input.TextArea rows=&#123;4&#125; size="large" value=&#123;actors&#125; /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="国家" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Input size="large" value=&#123;country&#125; /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="类型" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Input size="large" value=&#123;type&#125; /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="单集片长" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Input size="large" value=&#123;single&#125; /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="首播时间" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Input size="large" value=&#123;first_date&#125; /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="更新至" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Input size="large" value=&#123;now&#125; /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="别名" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Input size="large" value=&#123;other_name&#125; /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="电视台" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Input size="large" value=&#123;station&#125; /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item label="url" className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Input size="large" value=&#123;url&#125; /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Form.Item &#123;...tailFormItemLayout&#125; className="item"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;Button</span></span><br><span class="line"><span class="regexp">              size="large"</span></span><br><span class="line"><span class="regexp">              type="primary"</span></span><br><span class="line"><span class="regexp">              onClick=&#123;() =&gt; this.back()&#125;</span></span><br><span class="line"><span class="regexp">              className="login-form-button"</span></span><br><span class="line"><span class="regexp">            &gt;</span></span><br><span class="line"><span class="regexp">              返回</span></span><br><span class="line"><span class="regexp">            &lt;/</span>Button&gt;</span><br><span class="line">          &lt;<span class="regexp">/Form.Item&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>Form&gt;</span><br><span class="line">      &lt;<span class="regexp">/Layout&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const mapStateToProps = (state) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  return &#123;</span></span><br><span class="line"><span class="regexp">    userData: state.userData.data,</span></span><br><span class="line"><span class="regexp">  &#125;;</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const wrappedMovieForm = Form.create(&#123; name: "MovieForm" &#125;)(MovieForm);</span></span><br><span class="line"><span class="regexp">export default connect(mapStateToProps, null)(wrappedMovieForm);</span></span><br></pre></td></tr></table></figure>
<h2 id="App-js"><a href="#App-js" class="headerlink" title="App.js"></a><code>App.js</code></h2><p>App组件是根组件所以我们单独讲。先上代码</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Suspense, lazy &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./style.scss'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; HashRouter <span class="keyword">as</span> Router, Route, Switch &#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> PrivateRoute <span class="keyword">from</span> <span class="string">'./components/PrivateRoute'</span>;</span><br><span class="line"><span class="keyword">import</span> Loading <span class="keyword">from</span> <span class="string">'./components/loading'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Home = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./home'</span>));</span><br><span class="line"><span class="keyword">const</span> Sign = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./sign'</span>));</span><br><span class="line"><span class="keyword">const</span> Register = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./register'</span>));</span><br><span class="line"><span class="keyword">const</span> Manage = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./manage'</span>));</span><br><span class="line"><span class="keyword">const</span> Douban = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./douban'</span>));</span><br><span class="line"><span class="keyword">const</span> Taobao = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./taobao'</span>));</span><br><span class="line"><span class="keyword">const</span> Maoyan = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./maoyan'</span>));</span><br><span class="line"><span class="keyword">const</span> Operas = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./operas'</span>));</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Router&gt;</span><br><span class="line">        &lt;Suspense</span><br><span class="line">          fallback=&#123;<span class="comment">//这里如果等待的化，那么就加载上面所说的Loading组件</span></span><br><span class="line">            &lt;div className=<span class="string">"loading"</span>&gt;</span><br><span class="line">              &lt;Loading /&gt;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &#125;</span></span><br><span class="line"><span class="regexp">        &gt;</span></span><br><span class="line"><span class="regexp">          &lt;Switch&gt;</span></span><br><span class="line"><span class="regexp">            &lt;PrivateRoute exact path="/</span><span class="string">" component=&#123;Home&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;PrivateRoute exact path="</span>/manage<span class="string">" component=&#123;Manage&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;Route exact path="</span>/login<span class="string">" component=&#123;Sign&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;Route exact path="</span>/register<span class="string">" component=&#123;Register&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;PrivateRoute exact path="</span>/douban<span class="string">" component=&#123;Douban&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;PrivateRoute exact path="</span>/taobao<span class="string">" component=&#123;Taobao&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;PrivateRoute exact path="</span>/maoyan<span class="string">" component=&#123;Maoyan&#125; /&gt;</span></span><br><span class="line"><span class="string">            &lt;PrivateRoute exact path="</span>/operas<span class="string">" component=&#123;Operas&#125; /&gt;</span></span><br><span class="line"><span class="string">          &lt;/Switch&gt;</span></span><br><span class="line"><span class="string">        &lt;/Suspense&gt;</span></span><br><span class="line"><span class="string">      &lt;/Router&gt;</span></span><br><span class="line"><span class="string">    );</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">export default App;</span></span><br></pre></td></tr></table></figure>
<p><strong>这里需要讲几个问题：</strong></p>
<h3 id="lazy-Suspense-的作用-1"><a href="#lazy-Suspense-的作用-1" class="headerlink" title="lazy+Suspense 的作用"></a><code>lazy+Suspense</code> 的作用</h3><p>在<a href="https://react.docschina.org/docs/code-splitting.html" target="_blank" rel="noopener">react官方文档</a>中我截取了一段</p>
<p><code>React.lazy</code> 函数能让你像渲染常规组件一样处理动态引入（的组件）。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> OtherComponent = React.lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./OtherComponent'</span>));</span><br></pre></td></tr></table></figure>
<p>此代码将会在组件首次渲染时，自动导入包含 <code>OtherComponent</code> 组件的包。</p>
<p><code>React.lazy</code> 接受一个函数，这个函数需要动态调用 <code>import()</code>。它必须返回一个 <code>Promise</code>，该 Promise 需要 resolve 一个 <code>default</code> export 的 React 组件。</p>
<p>然后应在 <code>Suspense</code> 组件中渲染 lazy 组件，如此使得我们可以使用在等待加载 lazy 组件时做优雅降级（如 loading 指示器等）。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Suspense &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> OtherComponent = React.lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./OtherComponent'</span>));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Suspense fallback=&#123;&lt;div&gt;Loading...&lt;<span class="regexp">/div&gt;&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;OtherComponent /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/Suspense&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>fallback</code> 属性接受任何在组件加载过程中你想展示的 React 元素。你可以将 <code>Suspense</code> 组件置于懒加载组件之上的任何位置。你甚至可以用一个 <code>Suspense</code> 组件包裹多个懒加载组件。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Suspense &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> OtherComponent = React.lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./OtherComponent'</span>));</span><br><span class="line"><span class="keyword">const</span> AnotherComponent = React.lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./AnotherComponent'</span>));</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComponent</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;Suspense fallback=&#123;&lt;div&gt;Loading...&lt;<span class="regexp">/div&gt;&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;section&gt;</span></span><br><span class="line"><span class="regexp">          &lt;OtherComponent /</span>&gt;</span><br><span class="line">          &lt;AnotherComponent /&gt;</span><br><span class="line">        &lt;<span class="regexp">/section&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>Suspense&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/07/Nodejs%E5%9F%BA%E7%A1%804/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/07/Nodejs%E5%9F%BA%E7%A1%804/" class="post-title-link" itemprop="url">Nodejs基础4</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-06-07 20:54:01" itemprop="dateCreated datePublished" datetime="2020-06-07T20:54:01+08:00">2020-06-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-30 10:38:46" itemprop="dateModified" datetime="2020-06-30T10:38:46+08:00">2020-06-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/node/" itemprop="url" rel="index"><span itemprop="name">node</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Authentication-and-Authorization"><a href="#Authentication-and-Authorization" class="headerlink" title="Authentication and Authorization"></a>Authentication and Authorization</h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><h3 id="Creating-the-User-Model"><a href="#Creating-the-User-Model" class="headerlink" title="Creating the User Model"></a>Creating the User Model</h3><h3 id="Registering-Users"><a href="#Registering-Users" class="headerlink" title="Registering Users"></a>Registering Users</h3><h3 id="Using-Lodash"><a href="#Using-Lodash" class="headerlink" title="Using Lodash"></a>Using Lodash</h3><h3 id="Hashing-Passwords"><a href="#Hashing-Passwords" class="headerlink" title="Hashing Passwords"></a>Hashing Passwords</h3><h3 id="Authenticating-Users"><a href="#Authenticating-Users" class="headerlink" title="Authenticating Users"></a>Authenticating Users</h3><h3 id="Testing-the-Authentication"><a href="#Testing-the-Authentication" class="headerlink" title="Testing the Authentication"></a>Testing the Authentication</h3><h3 id="JSON-Web-Tokens"><a href="#JSON-Web-Tokens" class="headerlink" title="JSON Web Tokens"></a>JSON Web Tokens</h3><h3 id="Generating-Authentication-Tokens"><a href="#Generating-Authentication-Tokens" class="headerlink" title="Generating Authentication Tokens"></a>Generating Authentication Tokens</h3><h3 id="Storing-Secrets-in-Environment-Variables"><a href="#Storing-Secrets-in-Environment-Variables" class="headerlink" title="Storing Secrets in Environment Variables"></a>Storing Secrets in Environment Variables</h3><h3 id="Setting-Response-Headers"><a href="#Setting-Response-Headers" class="headerlink" title="Setting Response Headers"></a>Setting Response Headers</h3><h3 id="Encapsulating-Logic-in-Mongoose-Models"><a href="#Encapsulating-Logic-in-Mongoose-Models" class="headerlink" title="Encapsulating Logic in Mongoose Models"></a>Encapsulating Logic in Mongoose Models</h3><h3 id="Authorization-Middleware"><a href="#Authorization-Middleware" class="headerlink" title="Authorization Middleware"></a>Authorization Middleware</h3><h3 id="Protecting-Routes"><a href="#Protecting-Routes" class="headerlink" title="Protecting Routes"></a>Protecting Routes</h3><h3 id="Getting-the-Current-User"><a href="#Getting-the-Current-User" class="headerlink" title="Getting the Current User"></a>Getting the Current User</h3><h3 id="Logging-Out-Users"><a href="#Logging-Out-Users" class="headerlink" title="Logging Out Users"></a>Logging Out Users</h3><h3 id="Role-based-Authorization"><a href="#Role-based-Authorization" class="headerlink" title="Role-based Authorization"></a>Role-based Authorization</h3><h3 id="Testing-the-Authorization"><a href="#Testing-the-Authorization" class="headerlink" title="Testing the Authorization"></a>Testing the Authorization</h3><h3 id="Authentication-and-Authorization-Recap"><a href="#Authentication-and-Authorization-Recap" class="headerlink" title="Authentication and Authorization Recap"></a>Authentication and Authorization Recap</h3><h2 id="Handling-and-Logging-Errors"><a href="#Handling-and-Logging-Errors" class="headerlink" title="Handling and Logging Errors"></a>Handling and Logging Errors</h2><h3 id="Introduction-1"><a href="#Introduction-1" class="headerlink" title="Introduction"></a>Introduction</h3><p>现在我们假设我们的应用没有发生什么错误，但是 too young too simple.现实生活中会有很多意外。</p>
<p>所以我们最好能处理这些意外，并向客户端发送一个反馈，并把错误记录在日志里。</p>
<p>比如mongodb宕机了1分钟，现在我们的app无法应对这种中断，也不会向客户端提供任何服务，甚至再恢复也不行</p>
<h3 id="Handling-Rejected-Promises"><a href="#Handling-Rejected-Promises" class="headerlink" title="Handling Rejected Promises"></a>Handling Rejected Promises</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">"/"</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> genres = <span class="keyword">await</span> Genre.find().sort(<span class="string">"name"</span>);</span><br><span class="line">    res.send(genres);</span><br><span class="line">  &#125;<span class="keyword">catch</span>(ex)&#123;</span><br><span class="line">    <span class="comment">//log errors</span></span><br><span class="line">    res.status(<span class="number">500</span>).send(<span class="string">"Something failed"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>现在mongodb再宕机的时候，就看不到 unhandled promise rejection了</p>
<h3 id="Express-Error-Middleware"><a href="#Express-Error-Middleware" class="headerlink" title="Express Error Middleware"></a>Express Error Middleware</h3><p>但是，我们如果向修改记录日志的方式活着修改返回的信息，我们需要到处找try catch句块改，非常麻烦</p>
<p>我们希望把所有的逻辑都集中起来，这样就只需要修改一个地方即可。</p>
<p>还记得我们之前提到的中间件吗？现在我们就做一个发现异常的中间件</p>
<p>middleware文件夹中新建一个error.js，然后处理我们的逻辑</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> (<span class="params">err, req, res, next</span>) </span>&#123;</span><br><span class="line">  res.status(<span class="number">500</span>).send(<span class="string">"Something failed"</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>index.js中我们引入这个中间键模块,然后在api之下写这个引用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(error);</span><br></pre></td></tr></table></figure>
<p>最后修改genre.js  当我们catch到错误的时候，我们把控制权交给下一个中间件，也就是上面所说的error.js去处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">"/"</span>, <span class="keyword">async</span> (req, res,next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> genres = <span class="keyword">await</span> Genre.find().sort(<span class="string">"name"</span>);</span><br><span class="line">    res.send(genres);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (ex) &#123;</span><br><span class="line">    next(ex);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Removing-Try-Catch-Blocks"><a href="#Removing-Try-Catch-Blocks" class="headerlink" title="Removing Try Catch Blocks"></a>Removing Try Catch Blocks</h3><p>我们对上面的代码仍然不太满意，因为我们每次都要catch。next 太麻烦了</p>
<p>新建一个 async中间件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asyncMiddleware</span>(<span class="params">handler</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">async</span> (req, res, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">await</span> handler(req, res);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ex) &#123;</span><br><span class="line">      next(ex);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在genre中引入后</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">router.get(</span><br><span class="line">  <span class="string">"/"</span>,</span><br><span class="line">  asyncMiddleware(<span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> genres = <span class="keyword">await</span> Genre.find().sort(<span class="string">"name"</span>);</span><br><span class="line">    res.send(genres);</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="Express-Async-Errors"><a href="#Express-Async-Errors" class="headerlink" title="Express Async Errors"></a>Express Async Errors</h3><p>我们来介绍一下一个模块，这样就不用每次写asyncMiddleWare了。这个模块会将路由句柄包裹在类似的代码当中npm i express-async-errors</p>
<p>index中，我们直接引入即可require(‘express-async-errors’) </p>
<p>genre.js中我们保持原样，也不需要引入<em>const asyncMiddleware = require(“../middleware/async”);</em> 了</p>
<p>但是这个模块仍然把我们的控制权自动转到了错误控制的模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">"/"</span>, <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> genres = <span class="keyword">await</span> Genre.find().sort(<span class="string">"name"</span>);</span><br><span class="line">  res.send(genres);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Logging-Errors"><a href="#Logging-Errors" class="headerlink" title="Logging Errors"></a>Logging Errors</h3><p>我们需要在某处记录日志。在react基础课程中，我们使用了一morgan来记录日志，这里我们是用Winston</p>
<p>npm i winston之后，我们引入</p>
<p>const winston = require(‘winston’)</p>
<p>这个winston是这个模块中默认的日志模块，我们可以自定义记录器。但这已经足够了</p>
<p><img src="/2020/06/07/Nodejs%E5%9F%BA%E7%A1%804/1.png" style="zoom:80%;"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> winston = <span class="built_in">require</span>(<span class="string">'winston'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">err, req, res, next</span>)</span>&#123;</span><br><span class="line">  winston.error(err.message, err);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// error</span></span><br><span class="line">  <span class="comment">// warn</span></span><br><span class="line">  <span class="comment">// info</span></span><br><span class="line">  <span class="comment">// verbose</span></span><br><span class="line">  <span class="comment">// debug </span></span><br><span class="line">  <span class="comment">// silly</span></span><br><span class="line"></span><br><span class="line">  res.status(<span class="number">500</span>).send(<span class="string">'Something failed.'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Logging-to-MongoDB"><a href="#Logging-to-MongoDB" class="headerlink" title="Logging to MongoDB"></a>Logging to MongoDB</h3><p>安装winston-mongodb</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">require(&#39;winston-mongodb&#39;);</span><br><span class="line">&#x2F;&#x2F;...</span><br><span class="line">winston.add(winston.transports.MongoDB,&#123;db:&#39;mongodb:&#x2F;&#x2F;localhost&#x2F;vidly&#39;&#125;);</span><br></pre></td></tr></table></figure>
<p>我们还可以为存储到mongodb设置等级：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">winston.add(winston.transports.MongoDB,&#123;</span><br><span class="line">		db:&#39;mongodb:&#x2F;&#x2F;localhost&#x2F;vidly&#39;,</span><br><span class="line">		level:&#39;info&#39;&#x2F;&#x2F;info是第三等级，包含error和warn</span><br><span class="line">		</span><br><span class="line">		&#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="Uncaught-Exceptions"><a href="#Uncaught-Exceptions" class="headerlink" title="Uncaught Exceptions"></a>Uncaught Exceptions</h3><h3 id="Unhandled-Promise-Rejections"><a href="#Unhandled-Promise-Rejections" class="headerlink" title="Unhandled Promise Rejections"></a>Unhandled Promise Rejections</h3><h3 id="Error-Handling-Recap"><a href="#Error-Handling-Recap" class="headerlink" title="Error Handling Recap"></a>Error Handling Recap</h3><h3 id="Extracting-Routes"><a href="#Extracting-Routes" class="headerlink" title="Extracting Routes"></a>Extracting Routes</h3><h3 id="Extracting-the-Db-Logic"><a href="#Extracting-the-Db-Logic" class="headerlink" title="Extracting the Db Logic"></a>Extracting the Db Logic</h3><h3 id="Extracting-the-Logging-Logic"><a href="#Extracting-the-Logging-Logic" class="headerlink" title="Extracting the Logging Logic"></a>Extracting the Logging Logic</h3><h3 id="Extracting-the-Config-Logic"><a href="#Extracting-the-Config-Logic" class="headerlink" title="Extracting the Config Logic"></a>Extracting the Config Logic</h3><h3 id="Extracting-the-Validation-Logic"><a href="#Extracting-the-Validation-Logic" class="headerlink" title="Extracting the Validation Logic"></a>Extracting the Validation Logic</h3><h3 id="Showing-Unhandled-Exceptions-on-the-Console"><a href="#Showing-Unhandled-Exceptions-on-the-Console" class="headerlink" title="Showing Unhandled Exceptions on the Console"></a>Showing Unhandled Exceptions on the Console</h3><h3 id="Handling-and-Logging-Errors-Recap"><a href="#Handling-and-Logging-Errors-Recap" class="headerlink" title="Handling and Logging Errors Recap"></a>Handling and Logging Errors Recap</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/24/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><span class="page-number current">25</span><a class="page-number" href="/page/26/">26</a><span class="space">&hellip;</span><a class="page-number" href="/page/44/">44</a><a class="extend next" rel="next" href="/page/26/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jason</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">439</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">68</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jason</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

    

  

</body>
</html>
