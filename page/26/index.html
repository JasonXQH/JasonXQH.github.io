<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=">


  <link rel="mask-icon" href="/images/logo.svg?v=" color="#222">














<meta property="og:type" content="website">
<meta property="og:title" content="Jason‘s Blog">
<meta property="og:url" content="https://jasonxqh.github.io/page/26/index.html">
<meta property="og:site_name" content="Jason‘s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Jason">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '',
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    fancybox: false,
    tabs: ,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: 'undefined',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>







  <title>Jason‘s Blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', '[object Object]', 'auto');
  ga('send', 'pageview');
</script>





<meta name="generator" content="Hexo 4.2.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">
  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
<a href="https://github.com/JasonXQH/JasonXQH.github.io" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jason‘s Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/%20" rel="section">
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/%20" rel="section">
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/%20" rel="section">
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/05/react%E5%9F%BA%E7%A1%804%E6%8E%88%E6%9D%83%E4%B8%8E%E9%83%A8%E7%BD%B2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/05/react%E5%9F%BA%E7%A1%804%E6%8E%88%E6%9D%83%E4%B8%8E%E9%83%A8%E7%BD%B2/" itemprop="url">react基础4授权与部署</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-06-05T22:56:38+08:00">
                2020-06-05
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2020-06-21T12:43:18+08:00">
                2020-06-21
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index">
                    <span itemprop="name">react</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="react基础4授权与部署"><a href="#react基础4授权与部署" class="headerlink" title="react基础4授权与部署"></a>react基础4授权与部署</h1><p>最终章。可能有番外吧。。但是也要在完成大作业之后了</p>
<p>前三章：</p>
<p><a href="https://jasonxqh.github.io/2020/06/04/react基础3/">react基础3表单与后端</a></p>
<p><a href="https://jasonxqh.github.io/2020/06/02/react基础2/#more">react基础2排序分页与查询+路由</a></p>
<p><a href="https://jasonxqh.github.io/2020/05/30/react基础/#more">react基础组件+如何组合组件 </a></p>
<h2 id="Authentication-and-Authorization"><a href="#Authentication-and-Authorization" class="headerlink" title="Authentication and Authorization"></a>Authentication and Authorization</h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><h3 id="Registering-a-New-User"><a href="#Registering-a-New-User" class="headerlink" title="Registering a New User"></a>Registering a New User</h3><p>利用postman 进行post，成功了</p>
<p><img src="/2020/06/05/react%E5%9F%BA%E7%A1%804%E6%8E%88%E6%9D%83%E4%B8%8E%E9%83%A8%E7%BD%B2/1.png" style="zoom:67%;"></p>
<h3 id="Submitting-the-Registration-Form"><a href="#Submitting-the-Registration-Form" class="headerlink" title="Submitting the Registration Form"></a>Submitting the Registration Form</h3><p>首先新建一个userService.js 这个文件封装了调用后端api的函数，沟通了前后端。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">"./httpService"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; apiUrl &#125; <span class="keyword">from</span> <span class="string">"../config.json"</span>;</span><br><span class="line"><span class="keyword">const</span> apiEndpoint = apiUrl + <span class="string">"/users"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> http.post(apiEndpoint, &#123;</span><br><span class="line">    email: user.username,</span><br><span class="line">    password: user.password,</span><br><span class="line">    name: user.name,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后再registerForm中导入，我们可以用这种语法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import * as userService from &quot;..&#x2F;services&#x2F;userService&quot;;</span><br></pre></td></tr></table></figure>
<p>这样的语法 ,会在registerForm中创建一个userServices对象，然后从userServices导入的所有函数都会成为他的方法<br>然后修改doSubmit方法,调用userService.register() 来注册</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">doSubmit = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> userService.register(<span class="keyword">this</span>.state.data);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>我们看到在前端输入信息提交之后，在dev-tools中可以看到这条注册信息，然后后端会在MongoDb上载入信息</p>
<p><img src="/2020/06/05/react%E5%9F%BA%E7%A1%804%E6%8E%88%E6%9D%83%E4%B8%8E%E9%83%A8%E7%BD%B2/3.png" style="zoom:67%;"></p>
<p><img src="/2020/06/05/react%E5%9F%BA%E7%A1%804%E6%8E%88%E6%9D%83%E4%B8%8E%E9%83%A8%E7%BD%B2/2.png" style="zoom:67%;"></p>
<p><img src="/2020/06/05/react%E5%9F%BA%E7%A1%804%E6%8E%88%E6%9D%83%E4%B8%8E%E9%83%A8%E7%BD%B2/4.png" style="zoom:80%;"></p>
<h3 id="Handling-Registration-Errors"><a href="#Handling-Registration-Errors" class="headerlink" title="Handling Registration Errors"></a>Handling Registration Errors</h3><p>现在来处理注册时出现的错误，利用try，catch</p>
<p>如果出现错误且错误码为400，那么就是说用户的操作出现了问题。我们需要在表单中提示一些错误的信息。</p>
<p>这里我们只能得到用户已经被注册了的错误。所以我们先克隆errors。然后让errors的username属性设置成ex.response.data，然后再实现更新。ex.response.data是服务器给我们报的错误</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">doSubmit = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> userService.register(<span class="keyword">this</span>.state.data);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (ex) &#123;</span><br><span class="line">    <span class="keyword">if</span> (ex.response &amp;&amp; ex.response.status === <span class="number">400</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> errors = &#123; ...this.state.errors &#125;;</span><br><span class="line">      errors.username = ex.response.data;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; errors &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/05/react%E5%9F%BA%E7%A1%804%E6%8E%88%E6%9D%83%E4%B8%8E%E9%83%A8%E7%BD%B2/5.png" style="zoom:80%;"></p>
<h3 id="Logging-in-a-User"><a href="#Logging-in-a-User" class="headerlink" title="Logging in a User"></a>Logging in a User</h3><p>我们先做登录页，登录页做好了我们做注册成功跳转页面这个功能。我们在postman中实现登录。发现返回了一堆代码，这其实是一种 ID card</p>
<p>实现逻辑是这样的：所以如果用户发送了合法的用户名和密码的组合给了服务器，服务器给用户一个认证卡。以后无论何时，用户都需要请求apiEndpoint，apiEndpoint需要认证这个用户，客户端会把这个token发给server，如果他是一个合法的token，服务器就会执行用户请求</p>
<p><img src="/2020/06/05/react%E5%9F%BA%E7%A1%804%E6%8E%88%E6%9D%83%E4%B8%8E%E9%83%A8%E7%BD%B2/6.png" style="zoom:80%;"></p>
<h3 id="Submitting-the-Login-Form"><a href="#Submitting-the-Login-Form" class="headerlink" title="Submitting the Login Form"></a>Submitting the Login Form</h3><p>首先新建一个authService.js 这里面封装了调用后端的post函数，并把promise返回</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">"./httpService"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; apiUrl &#125; <span class="keyword">from</span> <span class="string">"../config.json"</span>;</span><br><span class="line"><span class="keyword">const</span> apiEndpoint = apiUrl + <span class="string">"/auth"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">email, password</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> http.post(apiEndpoint, &#123; email, password &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在loginForm.jsx中导入以后，我们重写doSubmit函数</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">doSubmit = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">await</span> login(data.username, data.password);</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<p>那么我如果输入刚才登陆的账号密码，那么我们看到返回了一个token</p>
<p><img src="/2020/06/05/react%E5%9F%BA%E7%A1%804%E6%8E%88%E6%9D%83%E4%B8%8E%E9%83%A8%E7%BD%B2/7.png" style="zoom: 50%;"></p>
<h3 id="Handling-Login-Errors"><a href="#Handling-Login-Errors" class="headerlink" title="Handling Login Errors"></a>Handling Login Errors</h3><p>现在来处理登陆时发生的错误,利用try catch，逻辑和注册表单一样</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">doSubmit = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">await</span> login(data.username, data.password);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (ex) &#123;</span><br><span class="line">    <span class="keyword">if</span> (ex.response &amp;&amp; ex.response.status === <span class="number">400</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> errors = &#123; ...this.state.errors &#125;;</span><br><span class="line">      errors.username = ex.response.data;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; errors &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/05/react%E5%9F%BA%E7%A1%804%E6%8E%88%E6%9D%83%E4%B8%8E%E9%83%A8%E7%BD%B2/8.png" style="zoom: 50%;"></p>
<h3 id="Storing-the-JWT-JSON-Token"><a href="#Storing-the-JWT-JSON-Token" class="headerlink" title="Storing the JWT(JSON Token)"></a>Storing the JWT(JSON Token)</h3><p> 我们得到了Token之后，现在我们应该把token保留在客户端。每个浏览器都有一个小型的本地数据库。这个数据库可以保存键值对</p>
<p>因为login函数（http.post）会返回一个promise对象，其中的data存放着返回的jwt，也就是我们想要的token，那么我们重命名它，然后存储到浏览器本地的小型数据库中。然后，点击提交的以后自动转回到首页</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> doSubmit = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">data</span>: jwt &#125; = <span class="keyword">await</span> login(data.username, data.password);</span><br><span class="line">      <span class="built_in">console</span>.log(jwt);</span><br><span class="line">      localStorage.setItem(<span class="string">"token"</span>, jwt);</span><br><span class="line">      <span class="keyword">this</span>.props.history.push(<span class="string">"/"</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ex) &#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Logging-in-the-User-upon-Registration"><a href="#Logging-in-the-User-upon-Registration" class="headerlink" title="Logging in the User upon Registration"></a>Logging in the User upon Registration</h3><p>现在我们想从 Headers（服务器发给我的包的头部信息）中获取tokens，学会了这个就可以如何使用头部来传递信息了</p>
<p>为实现这个功能，我们对后端user.js进行修改</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">res</span><br><span class="line">   .header(<span class="string">"x-auth-token"</span>, token)</span><br><span class="line">   .header(<span class="string">"access-control-expose-headers"</span>, <span class="string">"x-auth-token"</span>)</span><br><span class="line">   .send(_.pick(user, [<span class="string">"_id"</span>, <span class="string">"name"</span>, <span class="string">"email"</span>]));</span><br></pre></td></tr></table></figure>
<p>我们修改registerForm.js中的doSubmit,让他从headers中获取token并且存入localStorage。最后跳转到首页</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">doSubmit = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> userService.register(<span class="keyword">this</span>.state.data);</span><br><span class="line">    <span class="built_in">console</span>.log(response);</span><br><span class="line">    localStorage.setItem(<span class="string">"token"</span>, response.headers[<span class="string">"x-auth-token"</span>]);</span><br><span class="line">    <span class="keyword">this</span>.props.history.push(<span class="string">'/'</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (ex) &#123;</span><br><span class="line">    <span class="keyword">if</span> (ex.response &amp;&amp; ex.response.status === <span class="number">400</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> errors = &#123; ...this.state.errors &#125;;</span><br><span class="line">      errors.username = ex.response.data;</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; errors &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>下面是console.log(response)打印出来的内容，我们就是从这个headers中获取token</p>
<p><img src="/2020/06/05/react%E5%9F%BA%E7%A1%804%E6%8E%88%E6%9D%83%E4%B8%8E%E9%83%A8%E7%BD%B2/11.png" style="zoom: 50%;"></p>
<h3 id="JSON-Web-Tokens-JWT"><a href="#JSON-Web-Tokens-JWT" class="headerlink" title="JSON Web Tokens (JWT)"></a>JSON Web Tokens (JWT)</h3><p><a href="https://jwt.io/" target="_blank" rel="noopener">https://jwt.io/</a></p>
<p>在这个网站我们可以验证我们得到的Token是否合法</p>
<p><img src="/2020/06/05/react%E5%9F%BA%E7%A1%804%E6%8E%88%E6%9D%83%E4%B8%8E%E9%83%A8%E7%BD%B2/12.png" style="zoom: 80%;"></p>
<p>我们看到和我注册的信息是一致的</p>
<p>这相当于一个JSON对象，利用Base64URL加密算法进行编码得到的结果。我们看到左边有刚刚的id，name，email，最后一行是创建的事件。这就是为什么JWT是一个ID card的原因了，他就像驾照活着护照。存放了很多用户的信息</p>
<p>蓝色部分只有服务器才有。除非服务器被hack了，他们是不能通过修改token来伪装的。</p>
<h3 id="Getting-the-Current-User"><a href="#Getting-the-Current-User" class="headerlink" title="Getting the Current User"></a>Getting the Current User</h3><p>下面我们来说说如何在本地得到token，解码它，然后读取装在信息，并且显示在导航栏上</p>
<p>npm i jwt-decode@2.2.0</p>
<p>在app.js中导入 jwt-decode</p>
<p>这样说吧，jwt-decode 导出了一个默认函数，然后我们把他叫做jwtDecode，我们随便叫他什么都可以。只要有辨识度即可</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jwtDecode <span class="keyword">from</span> <span class="string">"jwt-decode"</span>;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;&#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> jwt = localStorage.getItem(<span class="string">"token"</span>);</span><br><span class="line">      <span class="keyword">const</span> user = jwtDecode(jwt);</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; user &#125;);</span><br><span class="line">    &#125;<span class="keyword">catch</span>(ex)&#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//...同时，我们向NavBar中传递user信息</span></span><br><span class="line">    &lt;NavBar user=&#123;<span class="keyword">this</span>.state.user&#125; /&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/05/react%E5%9F%BA%E7%A1%804%E6%8E%88%E6%9D%83%E4%B8%8E%E9%83%A8%E7%BD%B2/13.png" style="zoom: 80%;"></p>
<h3 id="Displaying-the-Current-User-on-NavBar"><a href="#Displaying-the-Current-User-on-NavBar" class="headerlink" title="Displaying the Current User on NavBar"></a>Displaying the Current User on NavBar</h3><p>接下来我们实现：没有登陆就只显示Login和Register，登陆了就显示用户名和logout链接</p>
<p>首先我们在NavBar的()中把user解构出来，如果user非空，那么就显示user的名字和Logout按钮，否则就显示Login和Register</p>
<p>那我们就这样渲染，我们知道</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">          </span><br><span class="line"><span class="comment">//....</span></span><br><span class="line">		&#123;!user &amp;&amp; (</span><br><span class="line">            &lt;React.Fragment&gt;</span><br><span class="line">              &lt;NavLink className=<span class="string">"nav-item nav-link"</span> to=<span class="string">"/login"</span>&gt;</span><br><span class="line">                Login</span><br><span class="line">              &lt;<span class="regexp">/NavLink&gt;</span></span><br><span class="line"><span class="regexp">              &lt;NavLink className="nav-item nav-link" to="/</span>register<span class="string">"&gt;</span></span><br><span class="line"><span class="string">                Register</span></span><br><span class="line"><span class="string">              &lt;/NavLink&gt;</span></span><br><span class="line"><span class="string">            &lt;/React.Fragment&gt;</span></span><br><span class="line"><span class="string">          )&#125;</span></span><br><span class="line"><span class="string">          &#123;user &amp;&amp; (</span></span><br><span class="line"><span class="string">            &lt;React.Fragment&gt;</span></span><br><span class="line"><span class="string">              &lt;NavLink className="</span>nav-item nav-link<span class="string">" to="</span>/profile<span class="string">"&gt;</span></span><br><span class="line"><span class="string">                &#123;user.name&#125;</span></span><br><span class="line"><span class="string">              &lt;/NavLink&gt;</span></span><br><span class="line"><span class="string">              &lt;NavLink className="</span>nav-item nav-link<span class="string">" to="</span>/logout<span class="string">"&gt;</span></span><br><span class="line"><span class="string">                Logout</span></span><br><span class="line"><span class="string">              &lt;/NavLink&gt;</span></span><br><span class="line"><span class="string">            &lt;/React.Fragment&gt;</span></span><br><span class="line"><span class="string">          )&#125;</span></span><br><span class="line"><span class="string">//....</span></span><br></pre></td></tr></table></figure>
<p>但是这么做有个问题。我登陆以后返回首页，看到的还是login和register，只有当我重新刷新的时候，才会显示名字和logout。</p>
<p>这是因为在App组件当中，我们从本地获得JWT并且在cdm中解码了它，这个方法在程序的生命周期中只被调用了一次。为了解决这个问题，我们在登录和注册表单中，不要使用history的push方法来重定向</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.props.history.push(<span class="string">"/"</span>);</span><br></pre></td></tr></table></figure>
<p>我们要完全的重载应用.window.location强制重载。这样的结果就是App对象又会被Mount一次。这时候，我们的本地存储已经有JWT了，这样就可以解码它并且得到当前的user了</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.location = <span class="string">'/'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="Logging-out-a-User"><a href="#Logging-out-a-User" class="headerlink" title="Logging out a User"></a>Logging out a User</h3><p>logging out 就是把本地的token删除。</p>
<p>首先我们注册这个路由，然后渲染一个logout组件。当这个组件被装载时，我们删掉本地的token，然后将用户重定向到主页</p>
<p>logout.jsx</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Logout</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    localStorage.removeItem(<span class="string">"token"</span>);</span><br><span class="line">      <span class="comment">//重定向</span></span><br><span class="line">    <span class="built_in">window</span>.location = <span class="string">"/"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Logout;</span><br></pre></td></tr></table></figure>
<p>然后注册路由之后。我们就可以正常退出了</p>
<h3 id="Refactoring"><a href="#Refactoring" class="headerlink" title="Refactoring"></a>Refactoring</h3><p>现在我们有很多的文件出现了token，以后我们如果想换其他键值，就会比较麻烦，所以我们只需要一个模块来完成授权工作，所有授权相关的都在那个模块当中。所以我们希望把保存和删除token的方法，放到authService当中。这样这个服务就是应用中唯一负责处理授权的地方。</p>
<p>authService.jsx</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">"./httpService"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; apiUrl &#125; <span class="keyword">from</span> <span class="string">"../config.json"</span>;</span><br><span class="line"><span class="keyword">import</span> jwtDecode <span class="keyword">from</span> <span class="string">"jwt-decode"</span>;</span><br><span class="line"><span class="keyword">const</span> apiEndpoint = apiUrl + <span class="string">"/auth"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params">email, password</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">data</span>: jwt &#125; = <span class="keyword">await</span> http.post(apiEndpoint, &#123; email, password &#125;);</span><br><span class="line">  localStorage.setItem(<span class="string">"token"</span>, jwt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">loginWithJwt</span>(<span class="params">jwt</span>) </span>&#123;</span><br><span class="line">  localStorage.setItem(<span class="string">"token"</span>, jwt);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">logout</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  localStorage.removeItem(<span class="string">"token"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getCurrentUser</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> jwt = localStorage.getItem(<span class="string">"token"</span>);</span><br><span class="line">    <span class="keyword">return</span> jwtDecode(jwt);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (ex) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  login,</span><br><span class="line">  logout,</span><br><span class="line">  getCurrenrUser,</span><br><span class="line">  loginWithJwt,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>App,loginForm,registerForm,logout中对于token的操作，都换成</p>
<p>import auth from “../services/authService”;  然后相对应引用auth.loginWithJwt, auth.login,  auth.logout, auth.getCurrentUser,…</p>
<p><strong>首先来看看App.js</strong>: 在cdm中调用getCurrentUser方法，从本地数据库中取出token并用user接受这个对象</p>
<p>然后更新user,如果当前没有token，那么就返回一个null值， user为null</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;&#125;;</span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> user = auth.getCurrentUser();</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; user &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后来看loginForm：调用auth.login，authService会帮他提取出JWT并存储到本地数据库中</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//... </span></span><br><span class="line">doSubmit = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">      <span class="keyword">await</span> auth.login(data.username, data.password);</span><br><span class="line">      <span class="built_in">window</span>.location = <span class="string">"/"</span>;</span><br><span class="line"><span class="comment">//window.location 这和用户登录没关系，只是重定向可以调到主页也可以其他页，不管login的事</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (ex) &#123;</span><br><span class="line">      <span class="keyword">if</span> (ex.response &amp;&amp; ex.response.status === <span class="number">400</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> errors = &#123; ...this.state.errors &#125;;</span><br><span class="line">        errors.username = ex.response.data;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123; errors &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>
<p>registerForm:  调用loginWithJwt，authService接收headers中提取出来的JWT并存储到本地数据库中</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line">doSubmit = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> userService.register(<span class="keyword">this</span>.state.data);</span><br><span class="line">      <span class="built_in">console</span>.log(response);</span><br><span class="line">      auth.loginWithJwt(response.headers[<span class="string">"x-auth-token"</span>]);</span><br><span class="line">      <span class="built_in">window</span>.location = <span class="string">"/"</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ex) &#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>
<p>最后来看看logout: authService会删除本地的token</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line">componentDidMount() &#123;</span><br><span class="line">      auth.Logout();</span><br><span class="line">    <span class="built_in">window</span>.location = <span class="string">"/"</span>;<span class="comment">//同样不管logout函数的事情</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>
<h3 id="Calling-Protected-API-Endpoints"><a href="#Calling-Protected-API-Endpoints" class="headerlink" title="Calling Protected API Endpoints"></a>Calling Protected API Endpoints</h3><p>受保护的终端要求用户认证或者登录，并且有明确的授权</p>
<p>后端 的config中的default.json中修改 “requiresAuth”: true 这样的话，如果是没有授权的用户就无法修改或者删除我后端数据库的内容了。</p>
<p>然后，我们需要给有token的用户授权。这个工作需要在httpServer中实现。因为这个模块的职责就是和终端进行http对话。现在我们添加一个配置一个信息，目的是让axios无论发送什么给服务器都带上这个头部</p>
<p>首先在authservice中写一个返回 JWT 的函数</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getJwt</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> localStorage.getItem(tokenKey);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后再httpService中添加以下配置，这样就实现了对注册用户的认证</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">axios.defaults.headers.common[<span class="string">'x-auth-token'</span>] = auth.getJwt();</span><br></pre></td></tr></table></figure>
<h3 id="Fixing-Bi-directional-Dependencies"><a href="#Fixing-Bi-directional-Dependencies" class="headerlink" title="Fixing Bi-directional Dependencies"></a>Fixing Bi-directional Dependencies</h3><p>我们在authService和httpService之间缔造了一个双向依赖关系，这是很危险的</p>
<p><img src="/2020/06/05/react%E5%9F%BA%E7%A1%804%E6%8E%88%E6%9D%83%E4%B8%8E%E9%83%A8%E7%BD%B2/14.png" style="zoom: 50%;"></p>
<p> 在这里，http更为重要，auth是建立在http之上的，所以我们既要在http中抹去对authService的依赖，又要在http中获取JWT。所以我们与其调用auth中的函数获取token，不如就直接跟auth说把token给我拿来，就像下面这张图</p>
<p><img src="/2020/06/05/react%E5%9F%BA%E7%A1%804%E6%8E%88%E6%9D%83%E4%B8%8E%E9%83%A8%E7%BD%B2/15.png" style="zoom: 50%;"></p>
<p>我们在httpService中写一个这个set函数，目的是获取到jwt并赋值给请求头</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setJwt</span>(<span class="params">jwt</span>)</span>&#123;</span><br><span class="line">  axios.defaults.headers.common[<span class="string">"x-auth-token"</span>] = jwt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后把这个函数导出</p>
<p>在authService中我们调用setJwt,把getJwt得到的结果来传入到这个函数。这样，httpService中就会得到我们的jwt了。解决了双向依赖</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http.setJwt(getJwt);</span><br></pre></td></tr></table></figure>
<h3 id="Authorization"><a href="#Authorization" class="headerlink" title="Authorization"></a>Authorization</h3><p>在后端，我们实现了只有管理员才能删除电影的功能.这就相当于当后端收到一个删除电影的请求的时候，请确保用户被授权且是管理员，auth和admin是中间件函数</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">router.delete(<span class="string">"/:id"</span>, [auth, admin], <span class="keyword">async</span> (req, res) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> movie = <span class="keyword">await</span> Movie.findByIdAndRemove(req.params.id);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!movie)</span><br><span class="line">    <span class="keyword">return</span> res.status(<span class="number">404</span>).send(<span class="string">"The movie with the given ID was not found."</span>);</span><br><span class="line"></span><br><span class="line">  res.send(movie);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>auth函数的功能：首先他确认服务器的requiresAuth打开了没有，如果是关闭的，他会将控制权移交到下一个中间件函数，否则就读取头部信息中的 x-auth-token .如果没有token的话，我们就返回Access denied. No token provided。意思是没有办法验证。如果有token的话，就先验证这个token是不是合法，是就传递给另外一个，不是就返回Invalid token.</p>
<p>auth函数的实现如下</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">"jsonwebtoken"</span>);</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">"config"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!config.get(<span class="string">"requiresAuth"</span>)) <span class="keyword">return</span> next();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> token = req.header(<span class="string">"x-auth-token"</span>);</span><br><span class="line">  <span class="keyword">if</span> (!token) <span class="keyword">return</span> res.status(<span class="number">401</span>).send(<span class="string">"Access denied. No token provided."</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> decoded = jwt.verify(token, config.get(<span class="string">"jwtPrivateKey"</span>));</span><br><span class="line">    req.user = decoded;</span><br><span class="line">    next();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (ex) &#123;</span><br><span class="line">    res.status(<span class="number">400</span>).send(<span class="string">"Invalid token."</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>admin函数的其实要检测设置，如果配置关闭，就传递控制权，不做任何事情；否则就检测是否用户为管理员，如果不是管理员，那么就返回 Access denied</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">"config"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 401 Unauthorized</span></span><br><span class="line">  <span class="comment">// 403 Forbidden</span></span><br><span class="line">  <span class="keyword">if</span> (!config.get(<span class="string">"requiresAuth"</span>)) <span class="keyword">return</span> next();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!req.user.isAdmin) <span class="keyword">return</span> res.status(<span class="number">403</span>).send(<span class="string">"Access denied."</span>);</span><br><span class="line"></span><br><span class="line">  next();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>如果授权的话我们呢需要在数据库中修改</p>
<p><img src="/2020/06/05/react%E5%9F%BA%E7%A1%804%E6%8E%88%E6%9D%83%E4%B8%8E%E9%83%A8%E7%BD%B2/16.png" style="zoom: 80%;"></p>
<p>设置好后，重新登入，那么就可以删除movie了</p>
<h3 id="Showing-or-Hiding-Elements-based-on-the-User"><a href="#Showing-or-Hiding-Elements-based-on-the-User" class="headerlink" title="Showing or Hiding Elements based on the User"></a>Showing or Hiding Elements based on the User</h3><p>现在我们想让没有登陆的用户看不到Delete，New Movie 按钮</p>
<p>在App中设置movie的路由.我们不能直接传入user进去，为了给子组件传递属性，我们要用到render</p>
<p>我们用render替换component,用箭头函数传入props，返回Movies组件，在movies组件当中加入所有的props还有当前的user属性</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route</span><br><span class="line">  path=<span class="string">"/movies"</span></span><br><span class="line">  render=&#123;(props) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">Movies</span> &#123;<span class="attr">...props</span>&#125; <span class="attr">user</span>=<span class="string">&#123;this.state.user&#125;</span> /&gt;</span></span>&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<p>然后在movies的 new movies中，我们这样修改（在上面已经解构了）.只有当user存在，我们才可以说把这个NewMovie渲染出来</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;user &amp;&amp; (</span><br><span class="line">   &lt;Link</span><br><span class="line">     to=<span class="string">"/movies/new"</span></span><br><span class="line">     className=<span class="string">"btn btn-primary"</span></span><br><span class="line">     style=&#123;&#123; <span class="attr">marginBottom</span>: <span class="number">20</span> &#125;&#125;</span><br><span class="line">   &gt;</span><br><span class="line">     New Movie</span><br><span class="line">   &lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp"> )&#125;</span></span><br></pre></td></tr></table></figure>
<p>同理，我们可以隐藏Delete</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">content: <span class="function"><span class="params">movie</span> =&gt;</span> (</span><br><span class="line">  <span class="keyword">this</span>.props.user&amp;&amp;(</span><br><span class="line">      &lt;button</span><br><span class="line">    onClick=&#123;() =&gt; <span class="keyword">this</span>.props.onDelete(movie)&#125;</span><br><span class="line">    className=<span class="string">"btn btn-danger btn-sm"</span></span><br><span class="line">	  &gt;</span><br><span class="line">    Delete</span><br><span class="line">  &lt;<span class="regexp">/button&gt;)</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure>
<p>效果图</p>
<p><img src="/2020/06/05/react%E5%9F%BA%E7%A1%804%E6%8E%88%E6%9D%83%E4%B8%8E%E9%83%A8%E7%BD%B2/18.png" style="zoom: 80%;"></p>
<h3 id="Protecting-Routes"><a href="#Protecting-Routes" class="headerlink" title="Protecting Routes"></a>Protecting Routes</h3><p>但直接隐藏并不能阻止新建电影，因为可以直接通过输入网站来访问路由</p>
<p>所以我们来看看怎么保护这个路由(初步实现)，没有办法再每个route中都重复这个逻辑</p>
<p>逻辑和刚才的一样（我们在上面已经结构了user),传入props，判断是否存在user，如果不存在，那么就重定向为login页面，存在那么渲染 MovieForm组件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route</span><br><span class="line">  path=<span class="string">"/movies/:id"</span></span><br><span class="line">  render=&#123;(props) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (!user) <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">"/login"</span> /&gt;</span></span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">MovieForm</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>;</span><br><span class="line">  &#125;&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Extracting-PrivateRoute"><a href="#Extracting-PrivateRoute" class="headerlink" title="Extracting PrivateRoute"></a>Extracting PrivateRoute</h3><p>我们这里想把前面的逻辑封装成一个组件</p>
<p>PrivateRoute.jsx:返回一个标准的React Route。</p>
<p>原来的path现在已经囊括到{…rest}当中去了，render中我们要把!user 改成!auth.getCurrentUser()</p>
<p>除此之外，我们还需要判断当前的Component是否存在。因为在App.js当中，要么设置component要么设置render，所以如果有component，那么就返回继承了所有props的component，否则就继承所有props的render</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> auth <span class="keyword">from</span> <span class="string">"../services/authService"</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Route, Redirect &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"><span class="keyword">const</span> PrivateRoute = <span class="function">(<span class="params">&#123;  component: Component, render, ...rest &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Route</span><br><span class="line">      &#123;...rest&#125;</span><br><span class="line">      render=&#123;(props) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (!auth.getCurrentUser()) <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">"/login"</span> /&gt;</span></span>;</span><br><span class="line">        <span class="keyword">return</span> Component ? <span class="xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span> : render(props);</span><br><span class="line">      &#125;&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> PrivateRoute;</span><br></pre></td></tr></table></figure>
<p>然后我们在app.js中引入的时候，对之前的进行修改. </p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;PrivateRoute path=<span class="string">"/movies/:id"</span> component=&#123;MovieForm&#125; /&gt;</span><br></pre></td></tr></table></figure>
<p>现在如果我们点击movie的名字，那么我们不会跳到MovieForm表单，我们会跳到Login表单</p>
<h3 id="Redirecting-after-Login"><a href="#Redirecting-after-Login" class="headerlink" title="Redirecting after Login"></a>Redirecting after Login</h3><p>我们现在点击movie名字，登录好以后，不想再回到主页了，我想到这个movie的表单当中去，怎么办？</p>
<p>我们首先打印一下这个组件的props</p>
<p><img src="/2020/06/05/react%E5%9F%BA%E7%A1%804%E6%8E%88%E6%9D%83%E4%B8%8E%E9%83%A8%E7%BD%B2/19.png" style="zoom: 80%;"></p>
<p>我们发现在location中的pathname是有效的，我们就要重定向到这条路径。Redirect中我们把to设置成一个对象</p>
<p>我们首先传入一个pathname，这是默认的，我们也要设置state属性，这是用来传递附加数据的。我再这个state当中传入一个from属性把它设置为props.location 因为这个location对象保留了用户跳转前的 位置信息</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> (</span><br><span class="line">    &lt;Route</span><br><span class="line">      &#123;...rest&#125;</span><br><span class="line">      render=&#123;(props) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (!auth.getCurrentUser())</span><br><span class="line">          <span class="keyword">return</span> (</span><br><span class="line">            &lt;Redirect</span><br><span class="line">              to=&#123;&#123;</span><br><span class="line">                pathname: <span class="string">"/login"</span>,</span><br><span class="line">                state: &#123; <span class="attr">from</span>: props.location &#125;,</span><br><span class="line">              &#125;&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">          );</span><br><span class="line">        <span class="keyword">return</span> Component ? <span class="xml"><span class="tag">&lt;<span class="name">Component</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span> : render(props);</span><br><span class="line">      &#125;&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">  );</span><br></pre></td></tr></table></figure>
<p>然后我们转到loginForm去看看是否state已经设置了，如果设置了我们就取location中的pathname；如果state没有被设置，那么就回到主页当中.</p>
<p><img src="/2020/06/05/react%E5%9F%BA%E7%A1%804%E6%8E%88%E6%9D%83%E4%B8%8E%E9%83%A8%E7%BD%B2/20.png" style="zoom: 80%;"></p>
<p>比如上图，我是直接点击login进入LoginForm的，那么这时候state就不会被设置，那么登陆过后就直接跳转主页</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">doSubmit = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;    </span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">await</span> auth.login(data.username, data.password);</span><br><span class="line">    <span class="keyword">const</span> &#123; state &#125; = <span class="keyword">this</span>.props.location</span><br><span class="line">    <span class="built_in">window</span>.location = state ? state.from.pathname : <span class="string">"/"</span>; </span><br><span class="line">      <span class="comment">//...</span></span><br><span class="line">  &#125;<span class="keyword">catch</span>(ex)&#123;<span class="comment">//...</span></span><br><span class="line">  &#125;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在还需要注意到，在登陆状态下如果我们直接输入login，还是会跳转到login表单。所以在login表单我们要做一个重定向</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (auth.getCurrentUser()) <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">to</span>=<span class="string">"/"</span> /&gt;</span></span>;</span><br></pre></td></tr></table></figure>
<h3 id="Exercise"><a href="#Exercise" class="headerlink" title="Exercise"></a>Exercise</h3><p>现在我们要实现只有admin才能显示delete按钮（刚才是只要是用户就能显示）</p>
<h3 id="Hiding-the-Delete-Column"><a href="#Hiding-the-Delete-Column" class="headerlink" title="Hiding the Delete Column"></a>Hiding the Delete Column</h3><p>有几种方法隐藏这个Delete 列，一种方法是添加一个属性如visible或者hidden来动态控制它，这个方法需要修改好几个组件；还有一种方法是将这个Delete列直接删除，只在当前用户是管理员的情况下才添加进来，这个方法相对简单</p>
<p>我们为了不污染constructor，把delete列单独设置成了deleteColumn对象。然后写一个constructor，利用auth.getCurrentUser()获取当前的user</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">deleteColumn = &#123;</span><br><span class="line">   key: <span class="string">"delete"</span>,</span><br><span class="line">   content: <span class="function"><span class="params">movie</span> =&gt;</span> (</span><br><span class="line">     &lt;button</span><br><span class="line">       onClick=&#123;() =&gt; <span class="keyword">this</span>.props.onDelete(movie)&#125;</span><br><span class="line">       className=<span class="string">"btn btn-danger btn-sm"</span></span><br><span class="line">     &gt;</span><br><span class="line">       Delete</span><br><span class="line">     &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">   )</span></span><br><span class="line"><span class="regexp"> &#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp"> constructor() &#123;</span></span><br><span class="line"><span class="regexp">   super();</span></span><br><span class="line"><span class="regexp">   const user = auth.getCurrentUser();</span></span><br><span class="line"><span class="regexp">   if (user &amp;&amp; user.isAdmin) this.columns.push(this.deleteColumn);</span></span><br><span class="line"><span class="regexp"> &#125;</span></span><br></pre></td></tr></table></figure>
<p>我们设置mosh为管理员：再mongodb中添加 isAdmin: true </p>
<p><img src="/2020/06/05/react%E5%9F%BA%E7%A1%804%E6%8E%88%E6%9D%83%E4%B8%8E%E9%83%A8%E7%BD%B2/21.png" style="zoom: 80%;"></p>
<h2 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h2><h3 id="Introduction-1"><a href="#Introduction-1" class="headerlink" title="Introduction"></a>Introduction</h3><h3 id="Environment-Variables"><a href="#Environment-Variables" class="headerlink" title="Environment Variables"></a>Environment Variables</h3><h3 id="Production-Builds"><a href="#Production-Builds" class="headerlink" title="Production Builds"></a>Production Builds</h3><h3 id="Getting-Started-with-Heroku"><a href="#Getting-Started-with-Heroku" class="headerlink" title="Getting Started with Heroku"></a>Getting Started with Heroku</h3><h3 id="MongoDB-in-the-Cloud"><a href="#MongoDB-in-the-Cloud" class="headerlink" title="MongoDB in the Cloud"></a>MongoDB in the Cloud</h3><p>云数据库</p>
<h3 id="Adding-Code-to-a-Git-Repository"><a href="#Adding-Code-to-a-Git-Repository" class="headerlink" title="Adding Code to a Git Repository"></a>Adding Code to a Git Repository</h3><h3 id="Deploying-to-Heroku"><a href="#Deploying-to-Heroku" class="headerlink" title="Deploying to Heroku"></a>Deploying to Heroku</h3><h3 id="Viewing-Logs"><a href="#Viewing-Logs" class="headerlink" title="Viewing Logs"></a>Viewing Logs</h3><h3 id="Setting-Environment-Variables-on-Heroku"><a href="#Setting-Environment-Variables-on-Heroku" class="headerlink" title="Setting Environment Variables on Heroku"></a>Setting Environment Variables on Heroku</h3><h3 id="Preparing-the-Font-end-for-Deployment"><a href="#Preparing-the-Font-end-for-Deployment" class="headerlink" title="Preparing the Font-end for Deployment"></a>Preparing the Font-end for Deployment</h3><h3 id="Deploying-the-Front-end"><a href="#Deploying-the-Front-end" class="headerlink" title="Deploying the Front-end"></a>Deploying the Front-end</h3>
          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/" itemprop="url">离散数学之关系2</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-06-05T11:31:09+08:00">
                2020-06-05
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2020-09-06T10:05:12+08:00">
                2020-09-06
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="离散数学之关系2"><a href="#离散数学之关系2" class="headerlink" title="离散数学之关系2"></a>离散数学之关系2</h1><p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/1.png" style="zoom:80%;"></p>
<h2 id="Closures-of-Relations-闭包"><a href="#Closures-of-Relations-闭包" class="headerlink" title="Closures of Relations 闭包"></a>Closures of Relations 闭包</h2><p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/2.png" style="zoom:80%;"></p>
<p>设R是非空集合A上的关系，在关系R中，可能有或无性质P，如自反(r)，对称(s)，传递(t)，若存在包含R，满足性质P的关系S，使得S是所有包含R，满足P的关系的子集，那么称S是R关于P的闭包（有时这样的闭包不存在）</p>
<p>所以我原来R可能不是闭包，但是我可以往里面加点东西，让它变成一个闭包。加进去的东西和原来的R就构成了我们的S</p>
<h3 id="自反闭包"><a href="#自反闭包" class="headerlink" title="自反闭包"></a><strong>自反闭包</strong></h3><p>如果我们要满足自反性，那么(a,a) 一定要属于R，所以我们把小于改成小于等于即可</p>
<p>自反闭包在图中表现为自环。让我们补全要素称为自反闭包可以是集合形式也可以是图的形式。</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/3.png" style="zoom:80%;"></p>
<p>如果R是自反性的，那么 $R^{*}$ 也是自反的。因为\</p>
<p>$R\subseteq R^<em>,(a,a)\in R\Rightarrow (a,a)\in R^</em>$ </p>
<p>但是请注意，如果R是irreflexive的，也就是$(a,a)\notin R$ 但是 $R^2$ 却不一定是irreflexive的，比如说R对角线上全是0，然后其余部分都是1，也就是说如果$(a,b)\in R, (b,a)\in R$ 那么$(a,a)\in R\circ R = R^2,(b,b)\in R\circ R = R^2$</p>
<h3 id="对称闭包"><a href="#对称闭包" class="headerlink" title="对称闭包"></a>对称闭包</h3><p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/4.png" style="zoom:80%;"></p>
<p>那么在图上又如何展示对称闭包呢？因为(a,b)在关系内，(b,a)也一定要在关系内，所以在图中表现为只要两点直接又连线，那么这个连线一定要有两根，a指向b，b指向a</p>
<p>如果R是对称的，那么$R^*$ 也是对称的：</p>
<p>假设让$(a,b)\in R^<em>$, 那么a和b之间存在一组有序对$(s<em>0,s_1)\in R,(s_1,s_2)\in R,\cdots(s</em>{j-1},s<em>j)\in R$ ,起点是a，终点是b。那么因为$R$ 是对称的，所以必然有$(s_j,s</em>{j-1})\in R,(s<em>{j-1},s</em>{j-2})\in R,\cdots(s_2,s_1)\in R$<br>这就说明，从b到a也有一条path存在，于是 $(b,a)\in R^</em>$ ,得证。</p>
<h3 id="传递闭包"><a href="#传递闭包" class="headerlink" title="传递闭包"></a>传递闭包</h3><p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/5.png" style="zoom:80%;"></p>
<p>图G可以看作是一个关系，path可以看作是一条路径。$X_0$ 是起点， $X_n$ 是终点，一共走了n条边</p>
<p>$X<em>0,X_1…X</em>{n-1}$ 可以是一样的，是可能等于a的，也可能等于b，如果k出现了两次那么意味着先走到$X_k$绕了一圈又回到了$X_k$ 那么就说明这个路径中有一个环。如果a和b是同一个顶点，那么就是a出发绕了一圈回到了a，这就是个环。</p>
<p>path的长度为n，说明走了n步一定是可以到达目的地的，所以对应的位置上一定是1</p>
<h4 id="定理1："><a href="#定理1：" class="headerlink" title="定理1："></a>定理1：</h4><p>这就是说R的基础上构造了一个新的关系$R^n$。 R是集合A当中的一个关系。那么如果 有一条a到b之间长度为n的路径的话，那么 (a,b)就属于$R^n$ </p>
<p>可以用数学归纳法证明：</p>
<p>如果path长度为1，那么$(a,b)\in R$ 成立，假设当 n=k的时候成立，那么当n=k+1的时候，找一点c,把原来的路线拆成两段，$(a,c)\in R,(c,b)\in R^n$ 那么根据复合法则，$(a,b)\in R^{n+1}$</p>
<p>如果$(a,b)\in R^n$那么<strong>至少</strong>存在一个长度为n的path，从a点（起点）走到b点（终点）</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/6.png" style="zoom:80%;"></p>
<h4 id="connectivity-relation-连接关系"><a href="#connectivity-relation-连接关系" class="headerlink" title="connectivity relation 连接关系"></a>connectivity relation 连接关系</h4><p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/7.png" style="zoom:80%;"></p>
<p>这个$R^<em>$ 的意思是说这条路径可长可短(至少为1)，无法确定。R\</em> 包含的是a到b的可达，只要a走到b就可以了，走多长的路我不管。$R^*$ 是很难算的，因为这是1到无穷</p>
<p>下面这个例子：$R^n$ 的意思就是 a通过n-1 个人可以认识b,$R^*$ 则是a可以认识b，但是不知道要通过多少人</p>
<h4 id="定理2："><a href="#定理2：" class="headerlink" title="定理2："></a>定理2：</h4><p>$R$的传递闭包，就是$R^*$  </p>
<p>原来的R可能不满足传递性，但是我们可以通过往里面加点什么让他满足，这是闭包的定义</p>
<p>那么包含R，且<strong>满足传递性</strong>的<strong>最小的</strong>那个关系就叫做传递闭包。所谓最小的，就是任意拿一个包含R的传递关系过来都是R*的超集。</p>
<p>证明：</p>
<p>首先要证明R*具有传递性</p>
<p>其次要证明R*属于S</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/8.png" style="zoom:80%;"></p>
<p>证明  S 是具有传递关系的，那么 $S^n$ 也是具有传递关系的</p>
<p>现在我假设 $(x,y)\in S^n,(y,z)\in S^n$  我希望得到$(x,z)\in S^n$ 这个结论</p>
<p>因为$S^n \in S$ 所以 当n=1，2，3…的时候都满足。</p>
<p>现在 已经知道 x到y有n步，也就是说有n-1个内部节点。我们可以画出类似简图</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/26.png" style="zoom:80%;"></p>
<p>同样，从y到z也可以画出一个相应的草图，所以(x,z)可以先从x走n-1步走到y，然后再从y一步走到z，这样$(x,z)\in S^n=S^{n-1} o S$  就满足了 </p>
<h4 id="计算方法1"><a href="#计算方法1" class="headerlink" title="计算方法1"></a>计算方法1</h4><h5 id="引理1"><a href="#引理1" class="headerlink" title="引理1"></a>引理1</h5><p>A中有n个元素，那么如果有一条path从a走向b，那么这条path不会超过n</p>
<p>更进一步来说，如果a!=b的话，那么这条path长度不会超过n-1</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/9.png" style="zoom:80%;"></p>
<h5 id="定理3"><a href="#定理3" class="headerlink" title="定理3"></a>定理3</h5><p>从引理可以知道我们没有必要把$R<em>1,R_2,R</em>{\infty}$ 都并起来，我们只需要<strong>并到n即可求出传递闭包</strong>。因为最多往前走n步嘛</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/10.png" style="zoom:80%;"></p>
<p>例子：</p>
<p>如果我们要找3个顶点的传递闭包，我们只要算3个矩阵相并即可</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/11.png" style="zoom:80%;"></p>
<h5 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h5><p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/12.png" style="zoom:80%;"></p>
<p>这个复杂度很高，有$O(n^4)$ </p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/18.png" style="zoom:80%;"></p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/22.png" style="zoom:80%;"></p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/23.png" style="zoom:80%;"></p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/24.png" style="zoom:80%;"></p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/25.png" style="zoom:80%;"></p>
<h4 id="计算方法2"><a href="#计算方法2" class="headerlink" title="计算方法2"></a>计算方法2</h4><h5 id="内部顶点："><a href="#内部顶点：" class="headerlink" title="内部顶点："></a>内部顶点：</h5><p>位于起点和终点之间的节点都是内部节点</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/13.png" style="zoom:80%;"></p>
<p>我们定义一个01矩阵W，令$W<em>0= M_R$ ,那么 我们可以给出如上$W</em>{ij}^k$ 的定义</p>
<p>$W^1$也就是说如果$X<em>i,X_j$ 可以通过$v_1$连起来的，$W</em>{ij}$取1，或者$X_i,X_j$直接可以到达的，那也可以取1，否则取0.所以$W^1$只保留了$X_i$通过$v_1$到达$X_j$ 的 $v_1$相当于 它们之间的桥梁。 $W_2$就是以此类推，通过$v_1,v2$ ,$X_i$可以到达$X_j$</p>
<p>那么$W<em>n$ 的话，我们 的中间节点就有$V_1,V_2…V_n$ ，所以说$W^n</em>{ij}$当中当且仅当$X_i$到$X_j$存在path(内部顶点可以取$V_1,V_2…V_n$)的时候，取1,否则取0。</p>
<p>那么我们就可以说 $W^n$ 就是 R 的传递闭包。</p>
<p><strong>例子：</strong></p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/14.png" style="zoom:80%;"></p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/15.png" style="zoom:80%;"></p>
<h5 id="引理"><a href="#引理" class="headerlink" title="引理"></a>引理</h5><p>要么本来$V_i,V_j$就能连在一起，要么就是加入了k点之后能够连在一起</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/16.png" style="zoom:80%;"></p>
<h5 id="算法："><a href="#算法：" class="headerlink" title="算法："></a>算法：</h5><p>初始状态就是$M_R$ 然后一个节点一个结点得加进去，三重循环。比原来的$O(n^4)$降低了一个数量级、</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/17.png" style="zoom:80%;"></p>
<p><strong>例题：</strong></p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/45.png" style="zoom:80%;"></p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/46.png" style="zoom:80%;"></p>
<p>我们用第二个算法做题的格式：</p>
<p>1：列出 R 中的关系对 ，列出节点个数。</p>
<p>2：加入第一个节点，看关系对中有无以第一个节点结尾和开头的元素，将其连接。并在矩阵上标为1。以此类推。比如说上面这个例子，我加入第三个节点，那么我发现$(2,3)$是以3结尾的,$(3,1),(3,4)$是以3开头的，于是我们就可以连接$(2,1),(2,4)$ ; 同理在加入节点4的时候，我发现$(3,4)$是以4 结尾的,$(4,3)$ 是以4开头的，于是$(3,3)$可以在矩阵中标出。</p>
<p>注：有几个节点就加入几次，最后就可以得到传递闭包。</p>
<h2 id="Equivalence-relations"><a href="#Equivalence-relations" class="headerlink" title="Equivalence relations"></a>Equivalence relations</h2><p>如果一个关系同时满足自反性，对称性和传递性这三个性质，我们就把它叫做等价关系</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/27.png" style="zoom:90%;"></p>
<p>这样的关系有很多。比如等于号，同龄，相似，全等，来自于同一个城市等</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/29.png" style="zoom:90%;"></p>
<h3 id="Equivalence-Classes-等价类"><a href="#Equivalence-Classes-等价类" class="headerlink" title="Equivalence Classes 等价类"></a>Equivalence Classes 等价类</h3><p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/28.png" style="zoom:80%;"></p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/30.png" style="zoom:80%;"></p>
<h3 id="Equivalence-Classes-and-Partitions"><a href="#Equivalence-Classes-and-Partitions" class="headerlink" title="Equivalence Classes and Partitions"></a>Equivalence Classes and Partitions</h3><h4 id="Theorem"><a href="#Theorem" class="headerlink" title="Theorem"></a>Theorem</h4><p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/31.png" style="zoom:80%;"></p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/32.png" style="zoom:80%;"></p>
<p>这个定理说明了对所有a里面的元素的等价类都找出来然后求并集，一定等于A</p>
<p>两个等价类中要么没有公共的元素，只要有公共的元素，那么这两个等价类必然相等</p>
<p>这说明了另外一个概念。</p>
<h4 id="Partition"><a href="#Partition" class="headerlink" title="Partition"></a>Partition</h4><p><strong>Denition</strong></p>
<p>一个集合的partition就是由其中的不相交的子集构成的，如下图。</p>
<p>如果这些子集满足partition，那么一定满足以下三点条件 </p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/33.png"></p>
<p>实际上我们可以根据等价类对这个集合求partition</p>
<p>有了等价关系，就有了等价类，所有的等价类构成了集合A的partition</p>
<p>同样如果有一个partition，我们肯定可以导出一个等价类。下面是一个定理：</p>
<p>给定一个partition，有一个等价关系R，他以$A_i$作为等价类</p>
<p>证明其自反性，对称性和传递性即可</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/34.png"></p>
<p><strong>例一</strong></p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/35.png"></p>
<p><strong>例二</strong></p>
<p>有一个比特串组成的集合。</p>
<p>有关系$sR_nt$ ，要么s = t ,要么 前n个字符一样。</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/36.png"></p>
<h2 id="Partial-orderings-偏序关系"><a href="#Partial-orderings-偏序关系" class="headerlink" title="Partial orderings 偏序关系"></a>Partial orderings 偏序关系</h2><p>如果一个关系R满足自反性，反对称性，和传递性。那么R就是一个偏序关系</p>
<p>包含关系R的集合S被叫做偏序集，记作(S,R)</p>
<p>偏序关系中的元素满足一下三个条件</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/37.png"></p>
<p>A relation R on a set S is a partial ordering if the relation R is reflexice,antisymmetric,and transitive,then (S,R) is called a <strong>poset</strong> </p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/39.png"></p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/38.png"></p>
<p>这里定义了新的关系，叫做偏序关系，a小于等于b</p>
<p><strong>例题5：</strong> </p>
<p>Is （S，R) a poset if S is the set of all people  in the world and $(a,b)\in R$ ,where a and b are people,if a is not taller than b?</p>
<p>这里我们要区分人和他们的属性，a is not taller than b 确实可以让 a和b的身高相等，但是并不能让a=b，两个人的身高相同不意味着两个就是同一个人！</p>
<p>if  a and b do not have a common friend?</p>
<p>很明显这不符合自反性，(a,a) 带入就会自相矛盾。</p>
<p>所以我们判断一个关系是否为偏序关系，必须分清本体和属性的区别和三个性能是否满足。</p>
<h4 id="Comparable"><a href="#Comparable" class="headerlink" title="Comparable"></a>Comparable</h4><p>元素 a和b在这个偏序关系，如果a小于等于b或者b小于等于a，那么(a,b)就是可比较的。否则如果不知道哪个小于等于哪个，那么就是不可比较的</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/40.png" style="zoom:80%;"></p>
<p>比如说在正整数中的整除关系，拿出来两个数3，9 那么3小于等于9，说明这两个元素是可比较的。如果拿出来的是5和7那么它们不可比较的。</p>
<p>所以我们可以知道 正整数上的整除关系并不是一个全序集。全序集就是任意拿出来两个元素都可以比较的。</p>
<p>所以偏序集又可以分为全续集和非全序集</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/41.png" style="zoom:80%;"></p>
<p>现在我们来看一下字典顺序。我们假设有一个偏序关系是定义在正整数集和正整数集的笛卡尔集上面的，</p>
<p>(a1,a2)是集合中的一个元素。现在我们定义一个关系如下。</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/42.png" style="zoom:80%;"></p>
<p>我们称这个关系为字典顺序。为什么要叫字典顺序？因为这就像我们查字典一样，如果我们要查order，我们就直接看o，因为a，b这些开头的 都在o的前面。</p>
<p>这个集合也是一个良序集，良序集的意思就是存在最小的一个元素，这里是(1,1) 那么ZXZ这个笛卡尔集就不是了，因为整数的笛卡尔集不存在最小的元素</p>
<p>我们可以定义两个，也可以定义n个元素</p>
<h4 id="Totally-ordered-全序集"><a href="#Totally-ordered-全序集" class="headerlink" title="Totally ordered 全序集"></a>Totally ordered 全序集</h4><p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/43.png" style="zoom:100%;"></p>
<p>全序集 就是一个线性的偏序结构。任何两个元素都能够进行比较。因为我们总是可以知道谁在前谁在后，所以我们也可以把全续集叫做链</p>
<p>如果偏序关系，而且也是个全序集，又满足每一个非空的子集都可以找出来最小的元素，那么我们就可以把这个集合叫做良序集。良序集一定可以拿到第一个元素，找到一个开头的元素。</p>
<h4 id="The-principle-of-well-ordered-induction"><a href="#The-principle-of-well-ordered-induction" class="headerlink" title="The principle of well-ordered induction"></a>The principle of well-ordered induction</h4><p>良序集的应用：数学归纳法。</p>
<p>自然数集是一个良序集。这要这个集基于良序集，那么数学归纳法都是对的，所以我们可以定义<strong>字典序集</strong>上的数学归纳法。</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/44.png" style="zoom:100%;"></p>
<h3 id="Lexicographic-ordering"><a href="#Lexicographic-ordering" class="headerlink" title="Lexicographic ordering"></a>Lexicographic ordering</h3><p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/47.png" style="zoom: 80%;"></p>
<p>这里定义了一个整数和整数的笛卡尔集上的偏序关系，lexicographic就是词典顺序。</p>
<p>比如： Find the lexicographic ordering of these n-tuples:</p>
<p>a) (1,1,2) ,(1,2,1)  b)  (0,1,2,3) ,(0,1,3,2)   c) (1,0,1,0,1),(0,1,1,1,0)</p>
<p>这个方法我们就一个一个比，按照词典顺序排列：</p>
<p>对于a） 1=1 ，1&lt;2  所以 (1,1,2) &lt; (1,2,1)</p>
<p>b) 0=0,1=1,2&lt;3. 所以 (0,1,2,3)&lt; (0,1,3,2) </p>
<p>c) 1&gt;0 所以(1,0,1,0,1) &gt; (0,1,1,1,0)</p>
<h3 id="Hasse-diagrams"><a href="#Hasse-diagrams" class="headerlink" title="Hasse diagrams"></a>Hasse diagrams</h3><p>哈塞图是偏序关系的一种表达关系，而且更简洁</p>
<h4 id="Definition"><a href="#Definition" class="headerlink" title="Definition"></a>Definition</h4><p>偏序关系满足自反性，反对称性和传递性。所以一定是每个定点上都有自环。</p>
<p><strong>第一步</strong>就去掉所有的自环。</p>
<p><strong>第二步</strong>，如果两步可达的顶点，那么就要把<strong>一步可达</strong>的边给删掉。最后我们要把最小的放在下面，最大的放到上面，这样就可以去掉箭头了。</p>
<p>哈塞图一定是对于偏序关系来说的，上面的结点一定比下面的结点要大</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/48.png" style="zoom: 80%;"></p>
<h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><p>比如下面这一幅图，我们要把它变成哈塞图。第一步去掉所有的环。第二步所有两步并作一步走的边全部都去掉，最后去掉箭头。</p>
<p>Draw the Hasse diagram representing the partial ordering<br>${(a,b)|a divides b} on {1, 2, 3, 4, 6, 8, 12}$</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/1.jpg" style="zoom: 67%;"></p>
<h3 id="Maximal-and-minimal-elements"><a href="#Maximal-and-minimal-elements" class="headerlink" title="Maximal and minimal elements"></a>Maximal and minimal elements</h3><p>极大元和极小元的定义不是最大和最小的元素。还要看看能不能比较。看这里，12和20是不能比较的，所以定义是找不到一个比他更大的元素（找不到一个比它更小的）</p>
<p>这里12，20，25 是极大元，2，5是极小元。没有最大元和最小元</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/49.png" style="zoom: 80%;"></p>
<h3 id="Greatest-and-least-elements"><a href="#Greatest-and-least-elements" class="headerlink" title="Greatest and least elements"></a>Greatest and least elements</h3><p>最大元和最小元所有的元素都小于等于或大于等于该元素</p>
<p>下面四张哈塞图。</p>
<p>a是有最小元，但是没有最大元；</p>
<p>b没有最小元，也没有最大元；</p>
<p>c没有最小元，最大元是d；</p>
<p>d既有最小元又有最大元</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/50.png" style="zoom: 80%;"></p>
<h3 id="Upper-and-lower-bounds上界和下界"><a href="#Upper-and-lower-bounds上界和下界" class="headerlink" title="Upper and lower bounds上界和下界"></a>Upper and lower bounds上界和下界</h3><p>对于一个集合内每个元素都要大或等于的，就是它的上界；对于这个集合内每个元素都要小或等于的，就是他的下界</p>
<p>下面呢我们可以看到 </p>
<p>{a,b,c}的上界是 e,f,j,h （因为并没有这样一条 c-&gt;d,c-&gt;g的路）；下界是 a，因为；</p>
<p>{j,h} 没有上界，但是有下界a,b,c,d,e</p>
<p>{a,c,d,f} 的上界是 f、h、j，下界是a</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/51.png" style="zoom: 80%;"></p>
<h3 id="Least-upper-and-greatest-lower-bounds"><a href="#Least-upper-and-greatest-lower-bounds" class="headerlink" title="Least upper and greatest lower bounds"></a>Least upper and greatest lower bounds</h3><p>Least upper  bounds，就是在所有的上界中，它极小</p>
<p>greatest lower bounds,就是在所有的下界当中，它极大</p>
<p>下面这个例子， {b,d,g} 的极大下界就是 b；极小上界就是 g</p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/52.png" style="zoom: 80%;"></p>
<p>一个集合的极大下界和极小上界被称为 glb(A) 和 lub(A)</p>
<h3 id="Lattices-格"><a href="#Lattices-格" class="headerlink" title="Lattices 格"></a>Lattices 格</h3><p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/53.png"></p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/54.png"></p>
<h3 id="Topological-sorting-拓扑排序"><a href="#Topological-sorting-拓扑排序" class="headerlink" title="Topological sorting 拓扑排序"></a>Topological sorting 拓扑排序</h3><p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/55.png" style="zoom: 80%;"></p>
<p><img src="/2020/06/05/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB2/56.png" style="zoom: 80%;"></p>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/04/react%E5%9F%BA%E7%A1%803/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/04/react%E5%9F%BA%E7%A1%803/" itemprop="url">react基础3</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-06-04T00:40:25+08:00">
                2020-06-04
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2020-06-21T12:43:14+08:00">
                2020-06-21
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index">
                    <span itemprop="name">react</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="react基础3：表单和后端"><a href="#react基础3：表单和后端" class="headerlink" title="react基础3：表单和后端"></a>react基础3：表单和后端</h1><p>前两篇回顾</p>
<p><a href="https://jasonxqh.github.io/2020/05/30/react基础/#more">react基础组件+如何组合组件 </a></p>
<p><a href="https://jasonxqh.github.io/2020/06/02/react基础2/">react基础2分页排序搜索+路由</a></p>
<p>下一篇</p>
<p><a href="https://jasonxqh.github.io/2020/06/05/react基础4授权与部署/">react基础4授权与部署</a></p>
<h2 id="Forms-表单"><a href="#Forms-表单" class="headerlink" title="Forms   表单"></a>Forms   表单</h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>登陆表单<img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/1.png" style="zoom:67%;"></p>
<p>添加电影信息的表单</p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/2.png" style="zoom:67%;"></p>
<p>查询表单</p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/3.png" style="zoom:67%;"></p>
<h3 id="Building-a-Bootstrap-Form"><a href="#Building-a-Bootstrap-Form" class="headerlink" title="Building a Bootstrap Form"></a>Building a Bootstrap Form</h3><p>我们先把表单添加到NavBar当中去</p>
<p>首先在NavBar中添加一个Login标签</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;li className=<span class="string">"nav-item"</span>&gt;</span><br><span class="line">  &lt;NavLink className=<span class="string">"nav-link"</span> to=<span class="string">"/login"</span>&gt;</span><br><span class="line">    Login</span><br><span class="line">  &lt;<span class="regexp">/NavLink&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>li&gt;</span><br></pre></td></tr></table></figure>
<p>其次我们在新建一个loginForm.jsx来存放我们的表单组件(表单格式在bootstrap上)</p>
<p>同时添加一个Login按钮</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;&#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;Login&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;form&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div className="form-group"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;label htmlFor="username"&gt;Username&lt;/</span>label&gt;</span><br><span class="line">            &lt;input id=<span class="string">"username"</span> type=<span class="string">"text"</span> className=<span class="string">"form-control"</span> /&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div className="form-group"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;label htmlFor="password"&gt;Password&lt;/</span>label&gt;</span><br><span class="line">            &lt;input</span><br><span class="line">              type=<span class="string">"password"</span></span><br><span class="line">              <span class="class"><span class="keyword">class</span></span>=<span class="string">"form-control"</span></span><br><span class="line">              id=<span class="string">"exampleInputPassword1"</span></span><br><span class="line">              placeholder=<span class="string">"Password"</span></span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;button className="btn btn-primary"&gt;Login&lt;/</span>button&gt;</span><br><span class="line">        &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> LoginForm;</span><br></pre></td></tr></table></figure>
<p>然后在App中注册路由</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">"/login"</span> component=&#123;LoginForm&#125;&gt;&lt;<span class="regexp">/Route&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Handling-Form-Submission-提交表单"><a href="#Handling-Form-Submission-提交表单" class="headerlink" title="Handling Form Submission 提交表单"></a>Handling Form Submission 提交表单</h3><p>我们不希望提交表单的时候重新下载页面。那么怎么办？</p>
<p>每个form元素又有一个onSubmit事件，然后我们要把它设置成一个句柄（handler），</p>
<p>在handler中我们需要用到一个preventDefult方法。它可以阻止事件的默认行为</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    handleSubmit = <span class="function"><span class="params">e</span>=&gt;</span>&#123;</span><br><span class="line">        e.preventDefault();</span><br><span class="line">        <span class="comment">// Call the server</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Submitted'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;Login&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;form onSubmit=&#123;this.handleSubmit&#125; &gt; </span></span><br><span class="line"><span class="regexp">        /</span><span class="regexp">/....</span></span><br></pre></td></tr></table></figure>
<p>现在再次点击submit，页面没有被重载</p>
<h3 id="Refs"><a href="#Refs" class="headerlink" title="Refs"></a>Refs</h3><p>在平常的时候我们会从document中获得信息，但是在react中我们从不使用document对象。</p>
<p>所以为了获取Users和Password,我们需要给其一个引用（reference）。但这个也不是一个好方法，anyway，这个逻辑就是在组件中新建一个引用，然后在表单的input标签中通过 ref={this.引用} </p>
<p>这样我们就可以实时获取表单中的信息了</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> username = <span class="keyword">this</span>.username.current.value;</span><br></pre></td></tr></table></figure>
<p> 尽量不要过度使用 refs</p>
<p>现在我们希望在页面渲染完成之后，username输入获得光标</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    username = React.createRef();</span><br><span class="line"><span class="comment">//利用hooks，在页面渲染完后focus on username</span></span><br><span class="line">    componentDidMount()&#123;</span><br><span class="line">        <span class="keyword">this</span>.username.current.focus();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  handleSubmit = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    <span class="keyword">const</span> username = <span class="keyword">this</span>.username.current.value;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Submitted"</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然我们也可以用 autofocus 属性，物品们把它放在input标签里去</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;input</span><br><span class="line">autoFocus</span><br><span class="line">  ref=&#123;<span class="keyword">this</span>.username&#125;</span><br><span class="line">  id=<span class="string">"username"</span></span><br><span class="line">  type=<span class="string">"text"</span></span><br><span class="line">  className=<span class="string">"form-control"</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<p>和利用hooks是等价的</p>
<h3 id="Controlled-Elements"><a href="#Controlled-Elements" class="headerlink" title="Controlled Elements"></a>Controlled Elements</h3><p>接下来介绍更标准的输入域的方式。</p>
<p>我们在state中新建一个account对象，里面包含username和password两个属性</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">state = &#123;</span><br><span class="line">   account: &#123; <span class="attr">username</span>: <span class="string">""</span>, <span class="attr">password</span>: <span class="string">""</span> &#125;,</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>
<p>但这是不够的，因为表单组件中的input也具有自己的state，我们需要改变这一点，把表单变成一个受控元素，只接受来自props中的信息</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">         </span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">  handleChange = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> account = &#123; ...this.state.account &#125;;</span><br><span class="line">    account.username = e.currentTarget.value;<span class="comment">//获得最新的输入讯息</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; account &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">		&lt;div className=<span class="string">"form-group"</span>&gt;</span><br><span class="line">            &lt;label htmlFor=<span class="string">"username"</span>&gt;Username&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">            &lt;input</span></span><br><span class="line"><span class="regexp">              autoFocus</span></span><br><span class="line"><span class="regexp">              value=&#123;this.state.account.username&#125;/</span><span class="regexp">/从state中获取</span></span><br><span class="line"><span class="regexp">              onChange=&#123;this.handleChange&#125;/</span><span class="regexp">/若文本内容发生改变那么就调用handleChange</span></span><br><span class="line"><span class="regexp">              id="username"</span></span><br><span class="line"><span class="regexp">              type="text"</span></span><br><span class="line"><span class="regexp">              className="form-control"</span></span><br><span class="line"><span class="regexp">            /</span>&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/...</span></span><br></pre></td></tr></table></figure>
<p>回到浏览器我们看到输入sss之后，username中也呈现了sss</p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/4.png" style="zoom:67%;"></p>
<h3 id="Handling-Multiple-Inputs"><a href="#Handling-Multiple-Inputs" class="headerlink" title="Handling Multiple Inputs"></a>Handling Multiple Inputs</h3><p>我现在想动态设置这个属性（需要用到中括号操作符）</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    account: &#123; <span class="attr">username</span>: <span class="string">""</span>, <span class="attr">password</span>: <span class="string">""</span> &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">  handleSubmit = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Submitted"</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//首先从事件e中析构出currentTarget，并把它称为input(更直观)</span></span><br><span class="line">  handleChange = <span class="function">(<span class="params">&#123;currentTarget:input&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> account = &#123; ...this.state.account &#125;;</span><br><span class="line">      <span class="comment">///在这里我们利用中括号访问！</span></span><br><span class="line">    account[input.name] = input.value;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; account &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">      <span class="comment">//先解构state，提取account</span></span><br><span class="line">      <span class="keyword">const</span> &#123;account &#125; = <span class="keyword">this</span>.state</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;Login&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;form onSubmit=&#123;this.handleSubmit&#125;&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div className="form-group"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;label htmlFor="username"&gt;Username&lt;/</span>label&gt;</span><br><span class="line">            &lt;input</span><br><span class="line">              autoFocus</span><br><span class="line">              value=&#123;account.username&#125;<span class="comment">//从account中获取username</span></span><br><span class="line">              onChange=&#123;<span class="keyword">this</span>.handleChange&#125;<span class="comment">//每当改变就发起</span></span><br><span class="line">              name=<span class="string">"username"</span><span class="comment">//设置name，以供handleChange访问</span></span><br><span class="line">              id=<span class="string">"username"</span></span><br><span class="line">              type=<span class="string">"text"</span></span><br><span class="line">              className=<span class="string">"form-control"</span></span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;div className="form-group"&gt;</span></span><br><span class="line"><span class="regexp">            &lt;label htmlFor="password"&gt;Password&lt;/</span>label&gt;</span><br><span class="line">            &lt;input</span><br><span class="line">              type=<span class="string">"password"</span></span><br><span class="line">              onChange=&#123;<span class="keyword">this</span>.handleChange&#125;<span class="comment">//每当改变就发起</span></span><br><span class="line">              value=&#123;account.password&#125;</span><br><span class="line">              name=<span class="string">"password"</span></span><br><span class="line">              className=<span class="string">"form-control"</span></span><br><span class="line">              id=<span class="string">"password"</span></span><br><span class="line">              placeholder=<span class="string">"Password"</span></span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">          &lt;button className="btn btn-primary"&gt;Login&lt;/</span>button&gt;</span><br><span class="line">        &lt;<span class="regexp">/form&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> LoginForm;</span><br></pre></td></tr></table></figure>
<p>这样，username和password都成为了受控元素</p>
<h3 id="Common-Errors"><a href="#Common-Errors" class="headerlink" title="Common Errors"></a>Common Errors</h3><p>如果我删除了this.state.account.username ，那么我再试图访问account中的username的时候，会得到undefined，然而value={undefined}，虽然定了value，但这不是一个受控元素。 那么这个元素就会有自己的state和value。当我们输入a的时候，（会自动创建state.username) 并且想把这个username传递给表单，但是表单这时候已经不是一个受控元素了，所以说会报错。</p>
<p>这就是为什么我们必须创建一个password，username，并且把它命名为空串的原因（注意，这里千万不能写undefined或者null）。作为一个原则，当我们创建一个表单的时候，当我想创建state对象当中的属性的时候，我们一定要写空串或者从服务器获得数据</p>
<h3 id="Extracting-a-Reusable-Input"><a href="#Extracting-a-Reusable-Input" class="headerlink" title="Extracting a Reusable Input"></a>Extracting a Reusable Input</h3><p>我们可以把表单独立成一个可以公用的组件， 然后通过析构，从props中获得所有我想要的信息</p>
<p>input.jsx</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="comment">//从props中解构出name，label，value，onChange</span></span><br><span class="line"><span class="keyword">const</span> Input = <span class="function">(<span class="params">&#123;name,label,value,onChange&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line"> <span class="comment">//下面就是替换了，username 用 name替换，渲染部分用label替换，</span></span><br><span class="line"> <span class="comment">//this.account.username 用value替换，把原来的this.handleChange变为向上抛出一个event</span></span><br><span class="line">    &lt;div className=<span class="string">"form-group"</span>&gt;</span><br><span class="line">      &lt;label htmlFor=&#123;name&#125;&gt;&#123;label&#125;&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">      &lt;input</span></span><br><span class="line"><span class="regexp">        autoFocus</span></span><br><span class="line"><span class="regexp">        value=&#123;value&#125;</span></span><br><span class="line"><span class="regexp">        onChange=&#123;onChange&#125;</span></span><br><span class="line"><span class="regexp">        name=&#123;name&#125;</span></span><br><span class="line"><span class="regexp">        id=&#123;name&#125;</span></span><br><span class="line"><span class="regexp">        type="text"</span></span><br><span class="line"><span class="regexp">        className="form-control"</span></span><br><span class="line"><span class="regexp">      /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Input;</span></span><br></pre></td></tr></table></figure>
<p>然后回到login部分我们这样修改</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h1&gt;Login&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">    &lt;form onSubmit=&#123;this.handleSubmit&#125;&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Input</span></span><br><span class="line"><span class="regexp">        name="username"</span></span><br><span class="line"><span class="regexp">        value=&#123;account.username&#125;</span></span><br><span class="line"><span class="regexp">        label="Username"</span></span><br><span class="line"><span class="regexp">        onChange=&#123;this.handleChange&#125;</span></span><br><span class="line"><span class="regexp">      /</span>&gt;</span><br><span class="line">      &lt;Input</span><br><span class="line">        name=<span class="string">"password"</span></span><br><span class="line">        value=&#123;account.password&#125;</span><br><span class="line">        label=<span class="string">"Password"</span></span><br><span class="line">        onChange=&#123;<span class="keyword">this</span>.handleChange&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;button className=<span class="string">"btn btn-primary"</span>&gt;Login&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>form&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">);</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/...</span></span><br></pre></td></tr></table></figure>
<h3 id="Validation-验证"><a href="#Validation-验证" class="headerlink" title="Validation 验证"></a>Validation 验证</h3><p>几乎所有的表单域都需要值验证。下面我们为我们造的表单添加验证</p>
<p>我们在state中添加errors，然后在里面写上我们出现的错误类型.注意，这里用对象而不是用数组，因为对象的话更容易定位，直接用点即可</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">errors:&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们需要在handleChange方法中调用一个验证的函数</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">validate = <span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">username</span>:<span class="string">'Username is required'</span>&#125;</span><br><span class="line">&#125;  </span><br><span class="line">handleSubmit = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  e.preventDefault();</span><br><span class="line">  <span class="keyword">const</span> errors = <span class="keyword">this</span>.validate();</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123; errors &#125;);</span><br><span class="line">  <span class="keyword">if</span> (errors) <span class="keyword">return</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Submitted"</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="A-Basic-Validation-Implementation"><a href="#A-Basic-Validation-Implementation" class="headerlink" title="A Basic Validation Implementation"></a>A Basic Validation Implementation</h3><p>接下来实现上面声明的验证函数（基本功能）</p>
<p>实现的逻辑是这样的，当我们点击提交表单的时候，会调用handleSubmit方法，handleSubmit方法有会调用validate()方法。在 validate中，我们来判断是否存在errors，如果不存在返回null，那么console.log(errors)就不会打印，在最后打印Submitted如果存在errors，那么把errors对象返回，在handleSubmit中打印。然后是先更新。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">validate = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> errors = &#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> &#123; account &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">  <span class="keyword">if</span> (account.username.trim() === <span class="string">""</span>)</span><br><span class="line">    errors.username = <span class="string">"Username is required."</span>;</span><br><span class="line">  <span class="keyword">if</span> (account.password.trim() === <span class="string">""</span>)</span><br><span class="line">    errors.password = <span class="string">"Password is required."</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Object</span>.keys(errors).length === <span class="number">0</span> ? <span class="literal">null</span> : errors;</span><br><span class="line">&#125;;</span><br><span class="line">handleSubmit = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  e.preventDefault();</span><br><span class="line">  <span class="keyword">const</span> errors = <span class="keyword">this</span>.validate();</span><br><span class="line">  <span class="built_in">console</span>.log(errors);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.setState(&#123; errors &#125;);</span><br><span class="line">  <span class="keyword">if</span> (errors) <span class="keyword">return</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Submitted"</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/5.png" style="zoom:67%;"></p>
<h3 id="Displaying-Validation-Errors-显示验证错误信息"><a href="#Displaying-Validation-Errors-显示验证错误信息" class="headerlink" title="Displaying Validation Errors 显示验证错误信息"></a>Displaying Validation Errors 显示验证错误信息</h3><p>我们想要在输入错误的时候显示一个错误信息 div.alert.alert-danger</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Input = <span class="function">(<span class="params">&#123; name, label, value, error, onChange &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"form-group"</span>&gt;</span><br><span class="line">      &lt;label htmlFor=&#123;name&#125;&gt;&#123;label&#125;&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">      &lt;input</span></span><br><span class="line"><span class="regexp">        value=&#123;value&#125;</span></span><br><span class="line"><span class="regexp">        onChange=&#123;onChange&#125;</span></span><br><span class="line"><span class="regexp">        name=&#123;name&#125;</span></span><br><span class="line"><span class="regexp">        id=&#123;name&#125;</span></span><br><span class="line"><span class="regexp">        type="text"</span></span><br><span class="line"><span class="regexp">        className="form-control"</span></span><br><span class="line"><span class="regexp">      /</span>&gt;</span><br><span class="line">&#123;<span class="comment">/*在原来的表单下面添加一个错误显示</span></span><br><span class="line"><span class="comment">只有当error非空才显示，显示内容是从props中解构的error*/</span>&#125;         </span><br><span class="line">      &#123;error &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"alert alert-danger"</span>&gt;</span>&#123;error&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure>
<p>然后再loginForm.jsx中，给两个表单添加error属性。注意，一个给的是username，一个给的是password</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;Input</span><br><span class="line">         name=<span class="string">"username"</span></span><br><span class="line">         value=&#123;account.username&#125;</span><br><span class="line">         label=<span class="string">"Username"</span></span><br><span class="line">         onChange=&#123;<span class="keyword">this</span>.handleChange&#125;</span><br><span class="line">         error=&#123;errors.username&#125;</span><br><span class="line">       /&gt;</span><br><span class="line">       &lt;Input</span><br><span class="line">         name=<span class="string">"password"</span></span><br><span class="line">         value=&#123;account.password&#125;</span><br><span class="line">         label=<span class="string">"Password"</span></span><br><span class="line">         onChange=&#123;<span class="keyword">this</span>.handleChange&#125;</span><br><span class="line">         error=&#123;errors.password&#125;</span><br><span class="line">       /&gt;</span><br></pre></td></tr></table></figure>
<p>实现逻辑是当我们提交空表单的时候我们更新了state中的错误，state把错误传递给Input，然后Input实现渲染更新</p>
<h3 id="Validation-on-Change-在值变更的时候验证"><a href="#Validation-on-Change-在值变更的时候验证" class="headerlink" title="Validation on Change 在值变更的时候验证"></a>Validation on Change 在值变更的时候验证</h3><p>刚才是在提交的时候显示错误，现在我们在输入值的时候就显示错误。那么我们就必须在handleChange的时候进行修改。首先拷贝errors对象，然后调用判断当前输入是否有错并赋给errorMessage。如果errorMessage非空的话，就把errorMessage装给errors，否则就删除该处信息。最后更新state当中的errors和account</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">validateProperty = <span class="function">(<span class="params">&#123; name, value &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (name === <span class="string">"username"</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (value.trim() === <span class="string">""</span>) <span class="keyword">return</span> <span class="string">"Username is required."</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (name === <span class="string">"password"</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (value.trim() === <span class="string">""</span>) <span class="keyword">return</span> <span class="string">"Password is required."</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">handleChange = <span class="function">(<span class="params">&#123; currentTarget: input &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> errors = &#123; ...this.state.errors &#125;;</span><br><span class="line">  <span class="keyword">const</span> errorMessage = <span class="keyword">this</span>.validateProperty(input);</span><br><span class="line">  <span class="keyword">if</span> (errorMessage) errors[input.name] = errorMessage;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">delete</span> errors[input.name];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> account = &#123; ...this.state.account &#125;;</span><br><span class="line">  account[input.name] = input.value;</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123; account, errors &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Joi"><a href="#Joi" class="headerlink" title="Joi"></a>Joi</h3><p>为了实现验证，我们需要用到一个非常强大的库Joi</p>
<p><a href="https://www.npmjs.com/package/joi" target="_blank" rel="noopener">https://www.npmjs.com/package/joi</a></p>
<p>example:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Joi = <span class="built_in">require</span>(<span class="string">'joi'</span>);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">const</span> schema = Joi.object().keys(&#123;</span><br><span class="line">    username: Joi.string().alphanum().min(<span class="number">3</span>).max(<span class="number">30</span>).required(),</span><br><span class="line">    password: Joi.string().regex(<span class="regexp">/^[a-zA-Z0-9]&#123;3,30&#125;$/</span>),</span><br><span class="line">    access_token: [Joi.string(), Joi.number()],</span><br><span class="line">    birthyear: Joi.number().integer().min(<span class="number">1900</span>).max(<span class="number">2013</span>),</span><br><span class="line">    email: Joi.string().email(&#123; <span class="attr">minDomainAtoms</span>: <span class="number">2</span> &#125;)</span><br><span class="line">&#125;).with(<span class="string">'username'</span>, <span class="string">'birthyear'</span>).without(<span class="string">'password'</span>, <span class="string">'access_token'</span>);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Return result.</span></span><br><span class="line"><span class="keyword">const</span> result = Joi.validate(&#123; <span class="attr">username</span>: <span class="string">'abc'</span>, <span class="attr">birthyear</span>: <span class="number">1994</span> &#125;, schema);</span><br><span class="line"><span class="comment">// result.error === null -&gt; valid</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// You can also pass a callback which will be called synchronously with the validation result.</span></span><br><span class="line">Joi.validate(&#123; <span class="attr">username</span>: <span class="string">'abc'</span>, <span class="attr">birthyear</span>: <span class="number">1994</span> &#125;, schema, <span class="function"><span class="keyword">function</span> (<span class="params">err, value</span>) </span>&#123; &#125;);  <span class="comment">// err === null -&gt; valid</span></span><br></pre></td></tr></table></figure>
<p>我们看到这样就方便很多， Joi.string()[一定要字符串形式].alpanum()[字母数字的组合].min(3).max(30)[3到30个字符串之间].required()[必须的]</p>
<p>还可以让string满足这个 正则表达式之类的</p>
<p>如何实现？</p>
<p>首先建一个schema对象，里面有我们需要检测的内容</p>
<p>用result 来接收Joi判断好的对象，其中第一个参数就是受测对象第二个参数就是上面定义的schema</p>
<p>{abortEarly: false,} 就是说让Joi全部检测完才返回，否则Joi检测到错误就不进行下去了</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">schema = &#123;</span><br><span class="line">    username: Joi.string().required(),</span><br><span class="line">    password: Joi.string().required(),</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  validate = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> result = Joi.validate(<span class="keyword">this</span>.state.account, <span class="keyword">this</span>.schema, &#123;</span><br><span class="line">      abortEarly: <span class="literal">false</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>那么我们就看到在error对象中的details中就由我们的报错信息</p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/7.png" style="zoom:67%;"></p>
<h3 id="Validating-a-Form-Using-Joi"><a href="#Validating-a-Form-Using-Joi" class="headerlink" title="Validating a Form Using Joi"></a>Validating a Form Using Joi</h3><p>errors对象中有error属性，他只在问题出现的时候才会被创建。errors中有一个details数组，里面记录了我们的错误信息。我们的挑战就是把这个映射到我们的errors对象当中</p>
<p>我们对handleSubmit和validate进行修改。对于validate我们通过result接受了errors对象以后，判断是否为空，如果非空的话，我们就让遍历details数组，每次迭代一次就给errors对象添加一个新的属性，path中存放的就是 input.name,然后返回</p>
<p>在handleSubmit当中如果errors存在，那么就同步，否则就把errors置空</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> schema = &#123;</span><br><span class="line">     <span class="comment">//label在显示的时候提示Username而不是username</span></span><br><span class="line">   username: Joi.string().required().label(<span class="string">"Username"</span>),</span><br><span class="line">   password: Joi.string().required().label(<span class="string">"Password"</span>),</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line">validate = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">const</span> options = &#123; <span class="attr">abortEarly</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">    <span class="comment">//这里通过析构简化了代码</span></span><br><span class="line">   <span class="keyword">const</span> &#123; error &#125; = Joi.validate(<span class="keyword">this</span>.state.account, <span class="keyword">this</span>.schema, options);</span><br><span class="line">   <span class="keyword">if</span> (!error) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   <span class="keyword">const</span> errors = &#123;&#125;;</span><br><span class="line">   <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> error.details) errors[item.path[<span class="number">0</span>]] = item.message;</span><br><span class="line">   <span class="keyword">return</span> errors;</span><br><span class="line"> &#125;;</span><br><span class="line"> handleSubmit = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">   e.preventDefault();</span><br><span class="line">   <span class="keyword">const</span> errors = <span class="keyword">this</span>.validate();</span><br><span class="line">   <span class="keyword">this</span>.setState(&#123; <span class="attr">errors</span>: errors || &#123;&#125; &#125;);</span><br><span class="line">   <span class="keyword">if</span> (errors) <span class="keyword">return</span>;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"Submitted"</span>);</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Validating-a-Field-Using-Joi"><a href="#Validating-a-Field-Using-Joi" class="headerlink" title="Validating a Field Using Joi"></a>Validating a Field Using Joi</h3><p>这里调整一下 validateProperty</p>
<p>因为我希望在一个输入框中输入不符合格式的话，就报错，所以我们每次报错一个</p>
<p>我们首先从input中解构name，value</p>
<p>然后利用ES6的运算方法在中括号中写name，那么运行的时候name是什么，[name] 就是什么、</p>
<p>我们就用这个obj来替代this.state.account,因为这时候obj中只有当前表单，所以Joi.validate只会检测当前的表单中的错误。注意，这里不要用abortEarly:false 了，因为我们不希望他一下子把所有的错误提示出来，那样看着会很烦</p>
<p>因为Joi.validate()返回一个errors对象，所以我们要从中析构出error来</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">validateProperty = <span class="function">(<span class="params">&#123; name, value &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> obj = &#123; [name]: value &#125;;</span><br><span class="line">  <span class="keyword">const</span> schema = &#123; [name]: <span class="keyword">this</span>.schema[name] &#125;;</span><br><span class="line">  <span class="keyword">const</span> &#123; error &#125; = Joi.validate(obj, schema);</span><br><span class="line">  <span class="keyword">return</span> error ? error.details[<span class="number">0</span>].message : <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Disabling-the-Submit-Button"><a href="#Disabling-the-Submit-Button" class="headerlink" title="Disabling the Submit Button"></a>Disabling the Submit Button</h3><p>我想禁用提交按钮，知道表单数据合法</p>
<p>这里我如果this.validate()存在，那么我们就把Login按钮变为红色，而且设置为不能提交</p>
<p>disabled={this.validate()}</p>
<p>那么如果检测到没有错误，那么我们就把Login变为蓝色，这时候才能够提交</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="keyword">this</span>.validate()&amp;&amp;<span class="xml"><span class="tag">&lt;<span class="name">button</span> <span class="attr">disabled</span>=<span class="string">&#123;this.validate()&#125;</span> <span class="attr">className</span>=<span class="string">"btn btn-danger"</span>&gt;</span></span></span><br><span class="line"><span class="xml">  Login</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>&#125;</span><br><span class="line">&#123; !<span class="keyword">this</span>.validate()&amp;&amp;<span class="xml"><span class="tag">&lt;<span class="name">button</span>  <span class="attr">className</span>=<span class="string">"btn btn-primary"</span>&gt;</span></span></span><br><span class="line"><span class="xml">  Login</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span>&#125;</span><br></pre></td></tr></table></figure>
<p>每个表单都可能有自己的errors对象</p>
<h3 id="Extracting-a-Reusable-Form"><a href="#Extracting-a-Reusable-Form" class="headerlink" title="Extracting a Reusable Form"></a>Extracting a Reusable Form</h3><p>接下来我们把表单中可以重复利用的都抽象成方法或者子组件。</p>
<p>我们可以新建一个子组件，然后让我这个LoginForm 继承我们的Form组件，这样Form组件中就存放了一些验证、提交的方法，而这些方法对于所有表单都是可以用的。</p>
<p>在LoginForm中，需要保留state,schema 这些表特有的，还要保留render和doSubmit方法（当提交成功后显示的内容，如Submitted之类的）</p>
<p>form.jsx</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Joi <span class="keyword">from</span> <span class="string">"joi-browser"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Form</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">//这里把form的信息统一命名为data，然后在loginform中还需要重定义</span></span><br><span class="line">  state = &#123;</span><br><span class="line">    data: &#123;&#125;,</span><br><span class="line">    errors: &#123;&#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">  validate = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> options = &#123; <span class="attr">abortEarly</span>: <span class="literal">false</span> &#125;;</span><br><span class="line">    <span class="keyword">const</span> &#123; error &#125; = Joi.validate(<span class="keyword">this</span>.state.account, <span class="keyword">this</span>.schema, options);</span><br><span class="line">    <span class="keyword">if</span> (!error) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">const</span> errors = &#123;&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> item <span class="keyword">of</span> error.details) errors[item.path[<span class="number">0</span>]] = item.message;</span><br><span class="line">    <span class="keyword">return</span> errors;</span><br><span class="line">  &#125;;</span><br><span class="line">  validateProperty = <span class="function">(<span class="params">&#123; name, value &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> obj = &#123; [name]: value &#125;;</span><br><span class="line">    <span class="keyword">const</span> schema = &#123; [name]: <span class="keyword">this</span>.schema[name] &#125;;</span><br><span class="line">    <span class="keyword">const</span> &#123; error &#125; = Joi.validate(obj, schema);</span><br><span class="line">    <span class="keyword">return</span> error ? error.details[<span class="number">0</span>].message : <span class="literal">null</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">  handleSubmit = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    e.preventDefault();</span><br><span class="line">    <span class="keyword">const</span> errors = <span class="keyword">this</span>.validate();</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">errors</span>: errors || &#123;&#125; &#125;);</span><br><span class="line">    <span class="keyword">if</span> (errors) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">this</span>.doSubmit();</span><br><span class="line">  &#125;;</span><br><span class="line">  handleChange = <span class="function">(<span class="params">&#123; currentTarget: input &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> errors = &#123; ...this.state.errors &#125;;</span><br><span class="line">    <span class="keyword">const</span> errorMessage = <span class="keyword">this</span>.validateProperty(input);</span><br><span class="line">    <span class="keyword">if</span> (errorMessage) errors[input.name] = errorMessage;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">delete</span> errors[input.name];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> account = &#123; ...this.state.account &#125;;</span><br><span class="line">    account[input.name] = input.value;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; account, errors &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Form;</span><br></pre></td></tr></table></figure>
<p>login.jsx</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Input <span class="keyword">from</span> <span class="string">"./common/input"</span>;</span><br><span class="line"><span class="keyword">import</span> Joi <span class="keyword">from</span> <span class="string">"joi-browser"</span>;</span><br><span class="line"><span class="keyword">import</span> Form <span class="keyword">from</span> <span class="string">"./common/form"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginForm</span> <span class="keyword">extends</span> <span class="title">Form</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    data: &#123; <span class="attr">username</span>: <span class="string">""</span>, <span class="attr">password</span>: <span class="string">""</span> &#125;,</span><br><span class="line">    errors: &#123;&#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  schema = &#123;</span><br><span class="line">    username: Joi.string().required().label(<span class="string">"Username"</span>),</span><br><span class="line">    password: Joi.string().required().label(<span class="string">"Password"</span>),</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  doSubmit = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Submitted"</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"> render()&#123;<span class="comment">/*...*/</span>&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Extracting-Helper-Rendering-Methods"><a href="#Extracting-Helper-Rendering-Methods" class="headerlink" title="Extracting Helper Rendering Methods"></a>Extracting Helper Rendering Methods</h3><p>接下来我们来接化render<br>首先把按钮变成一个方法，通过调用渲染</p>
<p>在form.jsx中加上renderButton方法，同时在loginForm.jsx中调用这个方法，因为是直接继承自Form的，所以可以直接调用{this.renderButton(“Login”)}</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">renderButton(label) &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;button disabled=&#123;<span class="keyword">this</span>.validate()&#125; className=<span class="string">"btn btn-primary"</span>&gt;</span><br><span class="line">      &#123;label&#125;</span><br><span class="line">    &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p> 我们也可以把输入域放到Form组件当中去,在form中加入renderInput方法</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Input <span class="keyword">from</span> <span class="string">"./input"</span>;</span><br><span class="line">renderInput(name, label, type = <span class="string">"text"</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data, errors &#125; = <span class="keyword">this</span>.state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Input</span><br><span class="line">        type=&#123;type&#125;</span><br><span class="line">        name=&#123;name&#125;</span><br><span class="line">        value=&#123;data[name]&#125;</span><br><span class="line">        label=&#123;label&#125;</span><br><span class="line">        onChange=&#123;<span class="keyword">this</span>.handleChange&#125;</span><br><span class="line">        error=&#123;errors[name]&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>然后在LoginForm中的render中调用者两个方法</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="keyword">this</span>.renderInput(<span class="string">"username"</span>, <span class="string">"Username"</span>)&#125;<span class="comment">//这里不传入第三个参数，那么默认类型就是text</span></span><br><span class="line">&#123;<span class="keyword">this</span>.renderInput(<span class="string">"password"</span>, <span class="string">"Password"</span>, <span class="string">"password"</span>)&#125;<span class="comment">//传入password那么密码会被隐藏</span></span><br></pre></td></tr></table></figure>
<p>当然。input组件也需要修改</p>
<p>因为真正在每个表单中中改变的值只有name，label,error，剩下的我们不想一个一个析构。所以我们直接用…rest来代替，这样我们也不需要再每次添加新的属性进去了，所有的属性都会自动添加</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">const</span> Input = <span class="function">(<span class="params">&#123; name, label, error, ...rest &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"form-group"</span>&gt;</span><br><span class="line">      &lt;label htmlFor=&#123;name&#125;&gt;&#123;label&#125;&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">      &lt;input</span></span><br><span class="line"><span class="regexp">        &#123;...rest&#125;</span></span><br><span class="line"><span class="regexp">        name=&#123;name&#125;</span></span><br><span class="line"><span class="regexp">        id=&#123;name&#125;</span></span><br><span class="line"><span class="regexp">        className="form-control"</span></span><br><span class="line"><span class="regexp">      /</span>&gt;</span><br><span class="line">      &#123;error &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"alert alert-danger"</span>&gt;</span>&#123;error&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Input;</span></span><br></pre></td></tr></table></figure>
<h3 id="Exercise-1-Register-Form"><a href="#Exercise-1-Register-Form" class="headerlink" title="Exercise 1-Register Form"></a>Exercise 1-Register Form</h3><p>现在我们创建一个注册表单，就会灰常简单</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Joi <span class="keyword">from</span> <span class="string">"joi-browser"</span>;</span><br><span class="line"><span class="keyword">import</span> Form <span class="keyword">from</span> <span class="string">"./common/form"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RegisterForm</span> <span class="keyword">extends</span> <span class="title">Form</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    data: &#123; <span class="attr">username</span>: <span class="string">""</span>, <span class="attr">password</span>: <span class="string">""</span>, <span class="attr">name</span>: <span class="string">""</span> &#125;,</span><br><span class="line">    errors: &#123;&#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  schema = &#123;</span><br><span class="line">      <span class="comment">//username必须是email格式的</span></span><br><span class="line">    username: Joi.string().required().email().label(<span class="string">"Username"</span>),</span><br><span class="line">      <span class="comment">//密码不小于5个字符，不大于10个字符</span></span><br><span class="line">    password: Joi.string().required().min(<span class="number">5</span>).max(<span class="number">10</span>).label(<span class="string">"Password"</span>),</span><br><span class="line">    name: Joi.string().required().label(<span class="string">"Name"</span>),</span><br><span class="line">  &#125;;</span><br><span class="line">  doSubmit = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Submitted"</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;Login&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;form onSubmit=&#123;this.handleSubmit&#125;&gt;</span></span><br><span class="line"><span class="regexp">          &#123;this.renderInput("username", "Username")&#125;</span></span><br><span class="line"><span class="regexp">          &#123;this.renderInput("password", "Password", "password")&#125;</span></span><br><span class="line"><span class="regexp">          &#123;this.renderInput("name", "Name")&#125;</span></span><br><span class="line"><span class="regexp">          &#123;this.renderButton("Register")&#125;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>form&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default RegisterForm;</span></span><br></pre></td></tr></table></figure>
<p>然后再App.js中注册路由，在navbar中添加，即可</p>
<h3 id="Exercise-2-Movie-Form"><a href="#Exercise-2-Movie-Form" class="headerlink" title="Exercise 2- Movie Form"></a>Exercise 2- Movie Form</h3><p>我们接下来做一个添加电影的表单，</p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/9.png" style="zoom:67%;"></p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/10.png" style="zoom:67%;"></p>
<p>那么我们首先做一个按钮。在Movies.jsx中</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...    </span></span><br><span class="line"><span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"row"</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">"col-3"</span>&gt;</span><br><span class="line">          &lt;ListGroup</span><br><span class="line">            items=&#123;<span class="keyword">this</span>.state.genres&#125;</span><br><span class="line">            selectedItem=&#123;<span class="keyword">this</span>.state.selectedGenre&#125;</span><br><span class="line">            onItemSelect=&#123;<span class="keyword">this</span>.handleGenreSelect&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div className="col"&gt;</span></span><br><span class="line"><span class="regexp">          &lt;Link/</span><span class="regexp">/ 这里其实是一个链接，只是伪装成了按钮</span></span><br><span class="line"><span class="regexp">            to="/m</span>ovies/<span class="keyword">new</span><span class="string">"</span></span><br><span class="line"><span class="string">            className="</span>btn btn-primary<span class="string">"</span></span><br><span class="line"><span class="string">            style=&#123;&#123; marginBottom: 20 &#125;&#125;</span></span><br><span class="line"><span class="string">          &gt;</span></span><br><span class="line"><span class="string">            New Movie</span></span><br><span class="line"><span class="string">          &lt;/Link&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后我们重构MovieForm</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Joi <span class="keyword">from</span> <span class="string">"joi-browser"</span>;</span><br><span class="line"><span class="keyword">import</span> Form <span class="keyword">from</span> <span class="string">"./common/form"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getMovie, saveMovie &#125; <span class="keyword">from</span> <span class="string">"../services/fakeMovieService"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getGenres &#125; <span class="keyword">from</span> <span class="string">"../services/fakeGenreService"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MovieForm</span> <span class="keyword">extends</span> <span class="title">Form</span> </span>&#123;</span><br><span class="line"> <span class="comment">/*在movieForm表单下拉类型的时候，我们在内部实现的其实是选择genreId而不是genre名称    </span></span><br><span class="line"><span class="comment"> data中的四个元素分别对应Title,Genre,Number in Stock,Rate</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">  state = &#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">      title: <span class="string">""</span>,</span><br><span class="line">      genreId: <span class="string">""</span>,</span><br><span class="line">      numberInStock: <span class="string">""</span>,</span><br><span class="line">      dailyRentalRate: <span class="string">""</span></span><br><span class="line">    &#125;,</span><br><span class="line">    genres: [],</span><br><span class="line">    errors: &#123;&#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">schema中设定了四个Input组件必须满足的条件。numberInStock 是数字类型的，从0-100</span></span><br><span class="line"><span class="comment">Rate从0-10</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">  schema = &#123;</span><br><span class="line">    _id: Joi.string(),</span><br><span class="line">    title: Joi.string()</span><br><span class="line">      .required()</span><br><span class="line">      .label(<span class="string">"Title"</span>),</span><br><span class="line">    genreId: Joi.string()</span><br><span class="line">      .required()</span><br><span class="line">      .label(<span class="string">"Genre"</span>),</span><br><span class="line">    numberInStock: Joi.number()</span><br><span class="line">      .required()</span><br><span class="line">      .min(<span class="number">0</span>)</span><br><span class="line">      .max(<span class="number">100</span>)</span><br><span class="line">      .label(<span class="string">"Number in Stock"</span>),</span><br><span class="line">    dailyRentalRate: Joi.number()</span><br><span class="line">      .required()</span><br><span class="line">      .min(<span class="number">0</span>)</span><br><span class="line">      .max(<span class="number">10</span>)</span><br><span class="line">      .label(<span class="string">"Daily Rental Rate"</span>)</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">现在来看看componentDidMount这个钩子中处理的内容</span></span><br><span class="line"><span class="comment">首先是从假想的服务器中获得genres字段，然后更新state</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">然后读取路由中的id参数，并赋值给一个movieID 如果检测到这是新电影</span></span><br><span class="line"><span class="comment">也就是我从按钮中点击进入的话。我就直接return掉，因为我们不需要生成一个已经有电影的表单。</span></span><br><span class="line"><span class="comment">反之，我们把数据给渲染上去。那么我们获取电影信息的方法就是 getMovie</span></span><br><span class="line"><span class="comment">export function getMovie(id) &#123;</span></span><br><span class="line"><span class="comment">  return movies.find((m) =&gt; m._id === id);</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">然后如果找不到的话，那么就返回not-found</span></span><br><span class="line"><span class="comment">找到了，那么就通过setState，和mapToViewModel方法把电影信息填到state当中，完成渲染</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> genres = getGenres();</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; genres &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> movieId = <span class="keyword">this</span>.props.match.params.id;</span><br><span class="line">    <span class="keyword">if</span> (movieId === <span class="string">"new"</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> movie = getMovie(movieId);</span><br><span class="line">    <span class="keyword">if</span> (!movie) <span class="keyword">return</span> <span class="keyword">this</span>.props.history.replace(<span class="string">"/not-found"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">data</span>: <span class="keyword">this</span>.mapToViewModel(movie) &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//这就是上面所说的mapToViewModel了，也就是返回一个state.data类型的对象，然后实现覆盖</span></span><br><span class="line">  mapToViewModel(movie) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      _id: movie._id,</span><br><span class="line">      title: movie.title,</span><br><span class="line">      genreId: movie.genre._id,</span><br><span class="line">      numberInStock: movie.numberInStock,</span><br><span class="line">      dailyRentalRate: movie.dailyRentalRate</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// 然后处理doSubmit方法，如果提交成功的话，那就saveMovie，也就是在fakemovieSeries中的</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">如果movieInDb存在，那么就是在原来的基础上保存修改过后的内容，如果不存在，就是一个空对象</span></span><br><span class="line"><span class="comment">然后就把新建或者要更新的movie的信息都填到这个对象当中去</span></span><br><span class="line"><span class="comment">export function saveMovie(movie) &#123;</span></span><br><span class="line"><span class="comment">  let movieInDb = movies.find((m) =&gt; m._id === movie._id) || &#123;&#125;;</span></span><br><span class="line"><span class="comment">  movieInDb.name = movie.name;</span></span><br><span class="line"><span class="comment">  movieInDb.genre = genresAPI.genres.find((g) =&gt; g._id === movie.genreId);</span></span><br><span class="line"><span class="comment">  movieInDb.numberInStock = movie.numberInStock;</span></span><br><span class="line"><span class="comment">  movieInDb.dailyRentalRate = movie.dailyRentalRate;</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">这里要注意要把Date.now()转换成string类型的，否则类型不同，无法保存</span></span><br><span class="line"><span class="comment">通过push来吧这个电影信息加到Db当中去</span></span><br><span class="line"><span class="comment">  if (!movieInDb._id) &#123;</span></span><br><span class="line"><span class="comment">    movieInDb._id = Date.now().toString();</span></span><br><span class="line"><span class="comment">    movies.push(movieInDb);</span></span><br><span class="line"><span class="comment">  &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  return movieInDb;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">  doSubmit = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    saveMovie(<span class="keyword">this</span>.state.data);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.props.history.push(<span class="string">"/movies"</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="comment">//随后渲染这个表单。</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;Movie Form&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;form onSubmit=&#123;this.handleSubmit&#125;&gt;</span></span><br><span class="line"><span class="regexp">          &#123;this.renderInput("title", "Title")&#125;</span></span><br><span class="line"><span class="regexp">          &#123;this.renderSelect("genreId", "Genre", this.state.genres)&#125;</span></span><br><span class="line"><span class="regexp">          &#123;this.renderInput("numberInStock", "Number in Stock", "number")&#125;</span></span><br><span class="line"><span class="regexp">          &#123;this.renderInput("dailyRentalRate", "Rate")&#125;</span></span><br><span class="line"><span class="regexp">          &#123;this.renderButton("Save")&#125;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>form&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default MovieForm;</span></span><br></pre></td></tr></table></figure>
<h3 id="Exercise-3-Search-Movies-加入搜索功能"><a href="#Exercise-3-Search-Movies-加入搜索功能" class="headerlink" title="Exercise 3- Search Movies    加入搜索功能"></a>Exercise 3- Search Movies    加入搜索功能</h3><p>首先建一个SearchBox</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SearchBox = <span class="function">(<span class="params">&#123; value, onChange &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;input</span><br><span class="line">      type=<span class="string">"text"</span></span><br><span class="line">      name=<span class="string">"query"</span></span><br><span class="line">      className=<span class="string">"form-control my-3"</span></span><br><span class="line">      placeholder=<span class="string">"Search..."</span></span><br><span class="line">      value=&#123;value&#125;</span><br><span class="line">        <span class="comment">//当我在表单输入的时候，我们调用onChange，然后从输入框中获取value值赋给handleSearch</span></span><br><span class="line">      onChange=&#123;e =&gt; onChange(e.currentTarget.value)&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> SearchBox;</span><br></pre></td></tr></table></figure>
<p>然后在Movies中添加这个组件和handleSearch方法</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//... </span></span><br><span class="line">state = &#123;</span><br><span class="line">    <span class="comment">//我们虽然可以不在这个state中声明赋值，因为直接state.属性也是可以访问的(只是没value)</span></span><br><span class="line">    <span class="comment">//但是呢我们一般还是要声明的，这样对自己和别人看代码更有帮助</span></span><br><span class="line">    movies: [],</span><br><span class="line">    genres: [],</span><br><span class="line">    currentPage: <span class="number">1</span>,</span><br><span class="line">    pageSize: <span class="number">4</span>,</span><br><span class="line">    searchQuery: <span class="string">""</span>,</span><br><span class="line">    selectedGenre: <span class="literal">null</span>,</span><br><span class="line">    sortColumn: &#123; <span class="attr">path</span>: <span class="string">"title"</span>, <span class="attr">order</span>: <span class="string">"asc"</span> &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="comment">/*这里拿到的是一个字符串，因为我们把Input放到了组件当中，当搜索框发生改变的时候，onChange</span></span><br><span class="line"><span class="comment">调用了handleSearch，然后handleSearch 实现了对state的更新，注意，这里要把currentPage</span></span><br><span class="line"><span class="comment">重置为1，因为我们当前可能不在第一页，那就看不到第一页的内容了！</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"> handleSearch = <span class="function">(<span class="params">query</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">searchQuery</span>: query, <span class="attr">selectedGenre</span>: <span class="literal">null</span>, <span class="attr">currentPage</span>: <span class="number">1</span> &#125;);</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"> </span><br><span class="line">&lt;SearchBox value=&#123;searchQuery&#125; onChange=&#123;<span class="keyword">this</span>.handleSearch&#125; /&gt;</span><br></pre></td></tr></table></figure>
<p> 此外我们还需要修改movies.jsx种getPageData方法 对原来的filter函数进行了修改</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> filtered = allMovies;</span><br><span class="line"><span class="comment">//如果searchQuery非空，那么我们就要选择电影名称以searchQuery开头的电影（这里没实现模糊查询）</span></span><br><span class="line"><span class="keyword">if</span> (searchQuery)</span><br><span class="line">  filtered = allMovies.filter(<span class="function">(<span class="params">m</span>) =&gt;</span></span><br><span class="line">    m.title.toLowerCase().startsWith(searchQuery.toLowerCase())</span><br><span class="line">  );</span><br><span class="line"><span class="comment">//否则就像之前一样，选择电影类型和selectedGenre一样的电影</span></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (selectedGenre &amp;&amp; selectedGenre._id)</span><br><span class="line">  filtered = allMovies.filter(<span class="function">(<span class="params">m</span>) =&gt;</span> m.genre._id === selectedGenre._id);</span><br><span class="line"><span class="comment">//如果都不满足，就说明现在是All Genres，且没有查询内容，那么不变 filtered = allMovies;</span></span><br></pre></td></tr></table></figure>
<h2 id="Calling-Backend-Services"><a href="#Calling-Backend-Services" class="headerlink" title="Calling Backend Services"></a>Calling Backend Services</h2><p>这一章开始我们来讲讲前后端链接</p>
<h3 id="JSON-Placeholder"><a href="#JSON-Placeholder" class="headerlink" title="JSON Placeholder"></a>JSON Placeholder</h3><p><a href="http://jsonplaceholder.typicode.com/posts" target="_blank" rel="noopener">http://jsonplaceholder.typicode.com/posts</a></p>
<p>Extension:JSONView </p>
<p>jsonplaceholder 给我们提供了一个API，这个API提供了诸如帖子等功能的一些终端</p>
<p>我们可以通过它来实现CRUD(增删改查)</p>
<h3 id="Http-Clients"><a href="#Http-Clients" class="headerlink" title="Http Clients"></a>Http Clients</h3><p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/11.png" style="zoom:80%;"></p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/12.png" style="zoom:80%;"></p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/13.png" style="zoom:80%;"></p>
<p>几种发送Http请求的方式</p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/14.png" style="zoom:80%;"></p>
<p>这里先下载Axios</p>
<p>npm install axios@0.18</p>
<p>利用源码中的 <a href="https://www.filepicker.io/api/file/ZfFMGUER9OAWZWe4kkWk" target="_blank" rel="noopener">https://www.filepicker.io/api/file/ZfFMGUER9OAWZWe4kkWk</a></p>
<p>http-app ，npm install ，npm start 打开</p>
<h3 id="Getting-Data"><a href="#Getting-Data" class="headerlink" title="Getting Data"></a>Getting Data</h3><p>利用axios获取数据,在app.js中导入后，添加cdm，然后在里面请求刚才的页面</p>
<p>这里的promise是一个装载异步操作的对象，promise对象承诺保存异步操作的结果</p>
<p>当我声明promise的时候，它历即进入pending状态 pending&gt;resolved(success) OR rejected(failure)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount() &#123;</span><br><span class="line"> 	<span class="keyword">const</span> promise= axios.get(<span class="string">'http://jsonplaceholder.typicode.com/posts'</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(promise);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/15.png" style="zoom:80%;"></p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/16.png" style="zoom:50%;"></p>
<p>这些就是我们请求来的数据，但是我们真正想要的是Object中的部分，也就是config，data…..</p>
<p>我们只想获取具体的数据，所以我们做这样一步：利用ES6中的新型特性await，await和async总时成对出现，所以在这个Hook 前我们还要用async修饰</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> componentDidMount() &#123;</span><br><span class="line">  <span class="keyword">const</span> promise = axios.get(<span class="string">"http://jsonplaceholder.typicode.com/posts"</span>);</span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> promise;</span><br><span class="line">  <span class="built_in">console</span>.log(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/17.png" style="zoom:70%;"></p>
<p>我们还有更简洁的写法</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> componentDidMount() &#123;</span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> axios.get(<span class="string">"http://jsonplaceholder.typicode.com/posts"</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>进一步我们只想获取data，那么我们就用析构就好了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> componentDidMount() &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;<span class="attr">data</span>:posts&#125; = <span class="keyword">await</span> axios.get(<span class="string">"http://jsonplaceholder.typicode.com/posts"</span>);</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123;posts&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更新完成后，因为框架老师已经搭好了，所以我们就直接可以看到这些帖子了</p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/18.png" style="zoom:70%;"></p>
<h3 id="Creating-Data"><a href="#Creating-Data" class="headerlink" title="Creating Data"></a>Creating Data</h3><p>如上图我们点击了Add以后，会得到一个表单，点击提交以后在现实情况下会形成一个对象，发送给后端，后端得到以后存储至数据库。现在我们来模拟一下</p>
<p>上面我用了get来请求数据，这里我用post来创建一条数据</p>
<p>创建有两方面，前端创建（表格上显示）和后端创建（数据库中存放）</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//值得注意的是，这里是一个方法属性，所以async要卸载handleAdd后面  </span></span><br><span class="line">handleAdd = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="comment">//假设我们想把 title为a，body为b的放到这个表格当中，那么我们就新建一个对象</span></span><br><span class="line">    <span class="keyword">const</span> obj = &#123; <span class="attr">title</span>: <span class="string">"a"</span>, <span class="attr">body</span>: <span class="string">"b"</span> &#125;;</span><br><span class="line">     <span class="comment">//然后利用post把这个对象给post到这个假的服务器上去，返回值我们解构出data并重命名post</span></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: post &#125; = <span class="keyword">await</span> axios.post(apiEndpoint, obj);</span><br><span class="line">      <span class="comment">//打印</span></span><br><span class="line">    <span class="built_in">console</span>.log(post);</span><br><span class="line">      <span class="comment">//实现本地state的更新 把post放在其他的数据之前</span></span><br><span class="line">    <span class="keyword">const</span> posts = [post, ...this.state.posts];</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; posts &#125;);</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/19.png" style="zoom:70%;"></p>
<p>但是我们发现有id相同的信息，这是因为我们这不是一个真的服务器。</p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/20.png" style="zoom:70%;"></p>
<h3 id="Lifecycle-of-a-Request"><a href="#Lifecycle-of-a-Request" class="headerlink" title="Lifecycle of a Request"></a>Lifecycle of a Request</h3><p>现在看看一个request的生命周期</p>
<p>先来看看第一张图，Request Method 是OPTIONS， 每个HTTP请求都有个叫做“Method”的属性来描述这个请求的目的（增删改查），通常的方式是get得到，post创建，put更新，delete删除</p>
<p>这里是个options请求，产生的原因是这个应用在本地运行，但是他的后端却在别的地方<a href="http://jsonplaceholder.typicode.com/posts" target="_blank" rel="noopener">jsonplaceholder</a></p>
<p>这是两个独立的域，从安全角度考虑，当一个应用向另一个域发起HTTP请求的时候，浏览器总会发出一个options请求，这就是为何这有OPTIONS了</p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/22.png" style="zoom:70%;"></p>
<p>再来看看第二张，这里请求的地址一样，但实际Method确实Post。Post用于创建数据。状态码为201代表了这个已经成功创建了。</p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/21.png" style="zoom:70%;"></p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/23.png" style="zoom:70%;"></p>
<p>现在来看反馈标签，这里你可以看到网站服务器给我们的反馈。适合我们发给他的一样的。Axios将这个对象保存到了一个response对象当中。这个response是对象有一个data属性（我们解构出来的）。 这个response对象有其他属性，我们可以用来读取请求的状态以及请求头等等，这就是一个请求的生命周期</p>
<h3 id="Updating-Data"><a href="#Updating-Data" class="headerlink" title="Updating Data"></a>Updating Data</h3><p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/25.png" style="zoom:70%;"></p>
<p>我们看到如果要更新一条信息的话，必须在请求的时候在posts后面加上当前信息的id才可以。</p>
<p>所以我们用put方式实现更新，先来看看我们能不能正确的请求信息。</p>
<p>（更新有两种方法，一种是put，一种是patch，patch可以针对对象的特定属性实现更新，而put是对整个对象实现更新）这里用了put，所以在传入第二个参数的时候我把整个post全传进去了</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">handleUpdate = <span class="keyword">async</span> (post) =&gt; &#123;</span><br><span class="line">  post.title = <span class="string">"UPDATED"</span>;</span><br><span class="line">  <span class="keyword">const</span> &#123; data &#125; = axios.put(apiEndpoint + <span class="string">"/"</span> + post.id, post);</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/26.png" style="zoom:50%;"></p>
<p>我们看到点击以后title就改成了UPDATED</p>
<p>为了更新一个对象(资源)，我们向后端发送了HTTP请求，这个后端有给定的id的资源，所以服务器得到了id，然后在response中返回了这个对象（资源）</p>
<p>好，现在我们实现更新。更新有两方面，前端更新（表格上更新）和后端更新（数据库更新）</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">handleUpdate = <span class="keyword">async</span> (post) =&gt; &#123;</span><br><span class="line">    post.title = <span class="string">"UPDATED"</span>;</span><br><span class="line">    <span class="keyword">await</span> axios.put(apiEndpoint + <span class="string">"/"</span> + post.id, post);<span class="comment">//到这里实现了后端更新，但前端未变</span></span><br><span class="line">    <span class="comment">//现在把整个state.posts拷贝下来</span></span><br><span class="line">    <span class="keyword">const</span> posts = [...this.state.posts];</span><br><span class="line">    <span class="comment">//现在得到要更新的那个对象的index</span></span><br><span class="line">    <span class="keyword">const</span> index = posts.indexOf(post);</span><br><span class="line">    <span class="comment">//现在用更新完毕的post去覆盖原来的post</span></span><br><span class="line">    posts[index] = &#123; ...post &#125;;</span><br><span class="line">    <span class="comment">//实现更新</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; posts &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/27.png" style="zoom:50%;"></p>
<h3 id="Deleting-Data"><a href="#Deleting-Data" class="headerlink" title="Deleting Data"></a>Deleting Data</h3><p>同样的，删除数据也要从后端和前端同时删除</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">handleDelete = <span class="keyword">async</span> (post) =&gt; &#123;</span><br><span class="line">  axios.delete(apiEndpoint + <span class="string">"/"</span> + post.id);</span><br><span class="line">  <span class="keyword">const</span> posts = <span class="keyword">this</span>.state.posts.filter(<span class="function">(<span class="params">p</span>) =&gt;</span> p.id !== post.id);</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123; posts &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>就不用我多说了</p>
<h3 id="Optimistic-vs-Pessimistic-Updates"><a href="#Optimistic-vs-Pessimistic-Updates" class="headerlink" title="Optimistic vs Pessimistic Updates"></a>Optimistic vs Pessimistic Updates</h3><p>但是我们在操作的时候，常常会有半秒到一秒钟的延迟。这是因为我们总是先请求服务器。然后再更新视图。使用这种方法实现的话，当请求服务器后端出现错误的时候，余下的代码将不会被执行。这就是我们说的Pessimistic Updates，因为我们不确定请求服务器后是否成功</p>
<p>Optimistic Updates：我们假设服务器大部分情况都是请求成功的，所以不妨先更新界面，再请求服务器。如果请求失败，我们再回滚至用户之前的界面</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">handleDelete = <span class="keyword">async</span> (post) =&gt; &#123;</span><br><span class="line">    <span class="comment">//首先我们先把原来的state保存下来</span></span><br><span class="line">  <span class="keyword">const</span> originalPosts = <span class="keyword">this</span>.state.posts;</span><br><span class="line">    <span class="comment">//实现界面的更新</span></span><br><span class="line">  <span class="keyword">const</span> posts = <span class="keyword">this</span>.state.posts.filter(<span class="function">(<span class="params">p</span>) =&gt;</span> p.id !== post.id);</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123; posts &#125;);</span><br><span class="line">    <span class="comment">//然后请求服务器，如果发生错误（这里我为了测试手动抛出一个错误）</span></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    axios.delete(apiEndpoint + <span class="string">"/"</span> + post.id);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">''</span>)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (ex) &#123;<span class="comment">//接收到错误后，再浏览器发出alert</span></span><br><span class="line">      <span class="comment">//然后回滚，就是把之前保存着的”备份“更新回去</span></span><br><span class="line">    alert(<span class="string">"Something failed while deleting a post!"</span>);</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">posts</span>: originalPosts &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Expected-vs-Unexpected-Errors"><a href="#Expected-vs-Unexpected-Errors" class="headerlink" title="Expected vs Unexpected Errors"></a>Expected vs Unexpected Errors</h3><p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/28.png"></p>
<p>我们怎么判断这里获得的异常是一个可预见的错误呢</p>
<p>这里有两个异常对象的属性：</p>
<p>ex.request:这个属性在成功发送请求给服务器时被设置</p>
<p>ex.resposne:这个属性在服务器正常反馈的时候被设置为null</p>
<p>所以这个逻辑可以这么处理，当ex.response不为空（错误存在）且状态码为404的时候，我们就收到了一个Expected Errors，否则我们收到的就是Unexpected Errors</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">handleDelete = <span class="keyword">async</span> (post) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> originalPosts = <span class="keyword">this</span>.state.posts;</span><br><span class="line">  <span class="keyword">const</span> posts = <span class="keyword">this</span>.state.posts.filter(<span class="function">(<span class="params">p</span>) =&gt;</span> p.id !== post.id);</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123; posts &#125;);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    axios.delete(apiEndpoint + <span class="string">"/"</span> + post.id);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (ex) &#123;</span><br><span class="line">    <span class="keyword">if</span> (ex.response &amp;&amp; ex.response.status === <span class="number">404</span>)</span><br><span class="line">      alert(<span class="string">"This post has already been deleted!"</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'Logging the error'</span>,ex);</span><br><span class="line">      alert(<span class="string">"An unexcepted error occurred!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">posts</span>: originalPosts &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Handling-Unexpected-Errors-Globally"><a href="#Handling-Unexpected-Errors-Globally" class="headerlink" title="Handling Unexpected Errors Globally"></a>Handling Unexpected Errors Globally</h3><p>我们现在只是在handleDelete中做到了检查异常。但是我们需要在发帖，更新贴，读取贴的时候都实现。所以如果有个不可预期的错误，那么就需要记录日志，打印错误信息。但是我们不想再每个地方都这样重复相同的代码</p>
<p>这时候应该使用 Axios Interceptors。 我们在类外写这个方法。</p>
<p>axios.interceptors后可以有response也可以有request，传入的参数是两个函数。第一个函数是成功的时候调用的，第二个函数是失败的时候调用的。这里我们只写当发生错误的时候该怎么办，所以把第一个参数设置为null</p>
<p>为了让catch捕获异常，我们需要返回一个Promise.reject 这是一个对象，我们就把axios发现的错误放到这个对象当中。这样我们无论何时得到了一个错误，我们就会调用axios.interceptors，然后控制权交给catch处理</p>
<p> 现在，我们让axios.interceptors处理unexpectedError，那么我先过滤掉4开头的状态码，因为那些都是expectedError，如果还有错误，那就是unexpectedError，我们就记录日志，并且给一个alert。不管发现的是expected还是unexpected error，都需要返回一个Promise.reject</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">axios.interceptors.response.use(<span class="literal">null</span>, (error) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> expectedError =</span><br><span class="line">    error.response &amp;&amp;</span><br><span class="line">    error.response.status &gt;= <span class="number">400</span> &amp;&amp;</span><br><span class="line">    error.response.status &lt;= <span class="number">500</span>;</span><br><span class="line">  <span class="keyword">if</span> (!expectedError) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Logging the error"</span>, error);</span><br><span class="line">    alert(<span class="string">"An unexcepted error occurred!"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>如果把id改成999，那么这就输入404的范畴，会显示 This post has already been deleted</p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/30.png" style="zoom:50%;"></p>
<p>如果我们请求一个非法的网址，那么我们就会得到一个  unexpected error，那么就像这样</p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/29.png" style="zoom:50%;"></p>
<p>这样，只有在我需要针对特定错误做什么的时候，我们才在下面的catch中写上错误的类型以及弹出的内容。其他的错误就交给axios.interceptors去解决</p>
<h3 id="Extracting-a-Reusable-Http-Service"><a href="#Extracting-a-Reusable-Http-Service" class="headerlink" title="Extracting a Reusable Http Service"></a>Extracting a Reusable Http Service</h3><p>使用axios.interceptors我们成功处理了不可预期的错误。但这不理想，他污染了App module，所以这些代码把App.js 复杂化了。另外一点是当某天我想要创建另外一个React应用的时候。我需要回来复制这段axios.interceptors到新的应用。我们可以把Http Service变成一个可以重复利用的module</p>
<p>我们新建一个service 文件夹，新建一个 httpService.js,然后把这些处理错误的代码放到httpService当中</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">"axios"</span>;</span><br><span class="line">axios.interceptors.response.use(<span class="literal">null</span>, (error) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> expectedError =</span><br><span class="line">    error.response &amp;&amp;</span><br><span class="line">    error.response.status &gt;= <span class="number">400</span> &amp;&amp;</span><br><span class="line">    error.response.status &lt;= <span class="number">500</span>;</span><br><span class="line">  <span class="keyword">if</span> (!expectedError) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Logging the error"</span>, error);</span><br><span class="line">    alert(<span class="string">"An unexcepted error occurred!"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span>&#123;</span><br><span class="line">    <span class="keyword">get</span>:axios.<span class="keyword">get</span>,</span><br><span class="line">    post:axios.post,</span><br><span class="line">    put:axios.put,</span><br><span class="line">    delete:axios.delete,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在导入httpService后把App.js中所有的axios都换成http</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">"./services/httpService"</span>;</span><br></pre></td></tr></table></figure>
<p>这样，这个模块就不再使用axios模块了，我们把Axios服务隐藏在http模块了，之后我如果想换一个库替代axios，我们需只要改一个地方。也就是我的httpService.js 。只要这个模块能导出get，post，put，delete方法，应用中的其余部分都不会受到影响。App.js中我们并不关心使用了什么库来发送HTTP请求，这是封装一个http模块最主要的好处之一了。新建项目的话也会方便很多</p>
<h3 id="Extracting-a-Config-Module"><a href="#Extracting-a-Config-Module" class="headerlink" title="Extracting a Config Module"></a>Extracting a Config Module</h3><p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/31.png" style="zoom:80%;"></p>
<p>然后在App.js中引入的时候，把所有的apiEndpoint 都改成config</p>
<p>这样可以避免 hard coding</p>
<h3 id="Displaying-Toast-Notifications"><a href="#Displaying-Toast-Notifications" class="headerlink" title="Displaying Toast Notifications"></a>Displaying Toast Notifications</h3><p>我们把原来的alert弹窗改成这样的，会比原来更加美观</p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/32.png" style="zoom:80%;"></p>
<p>npm i react-toastify@4.1</p>
<p>然后导入</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ToastContainer &#125; <span class="keyword">from</span> <span class="string">"react-toastify"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"react-toastify/dist/ReactToastify.css"</span>;</span><br></pre></td></tr></table></figure>
<p>在把httpService中的alert改成 toast.error(“An unexcepted error occurred!”);</p>
<p>toast还有其他的如success，warn等弹窗</p>
<p>当然也可以直接改成 toast (“An unexcepted error occurred!”); 颜色更好看</p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/33.png" style="zoom:80%;"></p>
<h3 id="Logging-Errors"><a href="#Logging-Errors" class="headerlink" title="Logging Errors"></a>Logging Errors</h3><p>我们要把日志作为系统功能的一部分。这里使用Sentry.io</p>
<p>//..</p>
<h3 id="Extracting-a-Logger-Service"><a href="#Extracting-a-Logger-Service" class="headerlink" title="Extracting a Logger Service"></a>Extracting a Logger Service</h3><p>//…</p>
<h3 id="Vidly-Backend"><a href="#Vidly-Backend" class="headerlink" title="Vidly Backend"></a>Vidly Backend</h3><p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/34.png" style="zoom:80%;"></p>
<h3 id="Setting-Up-the-Node-Backend"><a href="#Setting-Up-the-Node-Backend" class="headerlink" title="Setting Up the Node Backend"></a>Setting Up the Node Backend</h3><p><a href="https://www.bilibili.com/video/BV1Sb411P79t?p=153" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1Sb411P79t?p=153</a></p>
<p>有个坑。。需要先手动安装这个bcrypt否则一大堆错误</p>
<p>npm install bcrypt —unsafe-perm</p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/35.png" style="zoom:80%;"></p>
<p>这就算成功了。</p>
<p>这个后端支持CRUD</p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/36.png" style="zoom:80%;"></p>
<p>如果要修改数据，需要在config.json中修改设置</p>
<h3 id="Disabling-Authentication"><a href="#Disabling-Authentication" class="headerlink" title="Disabling Authentication"></a>Disabling Authentication</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"jwtPrivateKey"</span>: <span class="string">"unsecureKey"</span>,</span><br><span class="line">  <span class="attr">"db"</span>: <span class="string">"mongodb://localhost/vidly"</span>,</span><br><span class="line">  <span class="attr">"port"</span>: <span class="string">"3900"</span>,</span><br><span class="line">  <span class="attr">"requiresAuth"</span>: <span class="literal">false</span> <span class="comment">//修改成false，这样不需要授权认证即可修改</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Exercise-Connect-Movies-Page-to-the-Backend"><a href="#Exercise-Connect-Movies-Page-to-the-Backend" class="headerlink" title="Exercise- Connect Movies Page to the Backend"></a>Exercise- Connect Movies Page to the Backend</h3><p>把连接内存改为链接后端</p>
<h3 id="Adding-Http-and-Log-Services"><a href="#Adding-Http-and-Log-Services" class="headerlink" title="Adding Http and Log Services"></a>Adding Http and Log Services</h3><p>在service文件夹中导入 httpservice</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">"axios"</span>;</span><br><span class="line"><span class="keyword">import</span> logger <span class="keyword">from</span> <span class="string">"./logService"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; toast &#125; <span class="keyword">from</span> <span class="string">"react-toastify"</span>;</span><br><span class="line"></span><br><span class="line">axios.interceptors.response.use(<span class="literal">null</span>, error =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> expectedError =</span><br><span class="line">    error.response &amp;&amp;</span><br><span class="line">    error.response.status &gt;= <span class="number">400</span> &amp;&amp;</span><br><span class="line">    error.response.status &lt; <span class="number">500</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!expectedError) &#123;</span><br><span class="line">    logger.log(error);</span><br><span class="line">    toast.error(<span class="string">"An unexpected error occurrred."</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="keyword">get</span>: axios.<span class="keyword">get</span>,</span><br><span class="line">  post: axios.post,</span><br><span class="line">  put: axios.put,</span><br><span class="line">  delete: axios.delete</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>logservice</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">log</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.error(error);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  init,</span><br><span class="line">  log</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>app中导入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ToastContainer &#125; <span class="keyword">from</span> <span class="string">"react-toastify"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"react-toastify/dist/ReactToastify.css"</span>;</span><br></pre></td></tr></table></figure>
<p>添加<ToastContainer \></ToastContainer></p>
<h3 id="Replacing-FakeGenreService"><a href="#Replacing-FakeGenreService" class="headerlink" title="Replacing FakeGenreService"></a>Replacing FakeGenreService</h3><p>在service文件夹中新建genreService.js</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> apiUrl=<span class="string">"http://localhost:3900/api"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getGenres</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> http.get(apiUrl + <span class="string">"/genres"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在movies中修改</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">import</span> &#123; getGenres &#125; <span class="keyword">from</span> <span class="string">"../services/genreService"</span>;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">async</span> componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> getGenres();</span><br><span class="line">    <span class="keyword">const</span> genres = [&#123; <span class="attr">_id</span>: <span class="string">""</span>, <span class="attr">name</span>: <span class="string">"All Genres"</span> &#125;, ...data];</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: movies &#125; = <span class="keyword">await</span> getMovies();</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; movies, genres &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Replacing-FakeMovieService"><a href="#Replacing-FakeMovieService" class="headerlink" title="Replacing FakeMovieService"></a>Replacing FakeMovieService</h3><p>movieService.js</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">"./httpService"</span>;</span><br><span class="line">apiUrl=<span class="string">"http://localhost:3900/api"</span>;</span><br><span class="line"><span class="keyword">const</span> apiEndpoint = apiUrl + <span class="string">"/movies"</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getMovies</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> http.get(apiEndpoint);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">deleteMovie</span>(<span class="params">movieId</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> http.delete(apiEndpoint+<span class="string">"/"</span>+movieId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在movies中给对应的函数加上async 和await</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">async</span> componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data &#125; = <span class="keyword">await</span> getGenres();</span><br><span class="line">    <span class="keyword">const</span> genres = [&#123; <span class="attr">_id</span>: <span class="string">""</span>, <span class="attr">name</span>: <span class="string">"All Genres"</span> &#125;, ...data];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: movies &#125; = <span class="keyword">await</span> getMovies();</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; movies, genres &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="comment">//我们这里实现optmistic  利用try-catch</span></span><br><span class="line">  handleDelete = <span class="keyword">async</span> movie =&gt; &#123;</span><br><span class="line">     <span class="keyword">const</span> originalMovies = <span class="keyword">this</span>.state.movies;</span><br><span class="line">    <span class="keyword">const</span> movies  = <span class="keyword">this</span>.state.movies.filter(<span class="function"><span class="params">m</span>=&gt;</span>m._id!=movie._id);</span><br><span class="line">      <span class="keyword">this</span>.setState (&#123;movies&#125;);</span><br><span class="line">      <span class="keyword">try</span>&#123;</span><br><span class="line">          <span class="keyword">await</span> deleteMovie(movie._id);</span><br><span class="line">      &#125;<span class="keyword">catch</span>(ex)&#123;</span><br><span class="line">          <span class="keyword">if</span>(ex.response&amp;&amp;ex.response.status===<span class="number">404</span>)</span><br><span class="line">              toast.error(<span class="string">'This movie has already been deleted'</span>);</span><br><span class="line">           <span class="keyword">this</span>.setState(&#123; <span class="attr">movies</span>: originalMovies &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<p>现在的表格就是以数据库数据构成的。现在删除的话，就是真的在数据库中删除了</p>
<h3 id="Extracting-a-Config-File-封装配置文件"><a href="#Extracting-a-Config-File-封装配置文件" class="headerlink" title="Extracting a Config File 封装配置文件"></a>Extracting a Config File 封装配置文件</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"apiUrl"</span>: <span class="string">"http://localhost:3900/api"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在logService和httpService中进行修改</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">"./httpService"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; apiUrl &#125; <span class="keyword">from</span> <span class="string">"../config.json"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getGenres</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> http.get(apiUrl + <span class="string">"/genres"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">"./httpService"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; apiUrl &#125; <span class="keyword">from</span> <span class="string">"../config.json"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> apiEndpoint = apiUrl + <span class="string">"/movies"</span>;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>
<h3 id="Exercise-Connect-Movie-Form-to-the-Backend"><a href="#Exercise-Connect-Movie-Form-to-the-Backend" class="headerlink" title="Exercise- Connect Movie Form to the Backend"></a>Exercise- Connect Movie Form to the Backend</h3><p>现在我们如果点击电影，会发现</p>
<p><img src="/2020/06/04/react%E5%9F%BA%E7%A1%803/37.png" style="zoom:80%;"></p>
<p>这是因为movieForm任然使用了fakeMovieService</p>
<p>我们现在来替换他</p>
<p>movieService.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http <span class="keyword">from</span> <span class="string">"./httpService"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; apiUrl &#125; <span class="keyword">from</span> <span class="string">"../config.json"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> apiEndpoint = apiUrl + <span class="string">"/movies"</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">为了不到处使用字符串拼接，我们把代码重构一下</span></span><br><span class="line"><span class="comment">这里使用Es6中的模板语法，$&#123;&#125;中的参数会实时计算</span></span><br><span class="line"><span class="comment">= return apiEndpoint+'/'+id;</span></span><br><span class="line"><span class="comment">然后把接下来的都替换掉</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">movieUrl</span>(<span class="params">id</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;apiEndpoint&#125;</span>/<span class="subst">$&#123;id&#125;</span>`</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getMovies</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> http.get(apiEndpoint);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">import &#123; getMovie, saveMovie &#125; from "../services/movieService";</span></span><br><span class="line"><span class="comment">因为movieServise没有这两个函数，所以我们写一下这两个函数</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getMovie</span>(<span class="params">movieId</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> http.get(movieUrl(movieId));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">这个save函数可以保存新建的电影信息，也可以更新已经有的电影信息。</span></span><br><span class="line"><span class="comment">如果movie._id存在的，那么我们就要用put(第一个参数是url,第二个参数是请求对象)</span></span><br><span class="line"><span class="comment">但是我们做的后端不喜欢请求体中有id。因为如果body中有id的话，那么前面也是id，后面也有id，</span></span><br><span class="line"><span class="comment">会产生混淆。</span></span><br><span class="line"><span class="comment">为了解决这个问题，我们就克隆这个movie的信息，然后删除这个id属性，在把这两个参数传入put</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">如果movie._id不存在，说明我们是新建电影信息，这样我们就用point</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">saveMovie</span>(<span class="params">movie</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (movie._id) &#123;</span><br><span class="line">    <span class="keyword">const</span> body = &#123; ...movie &#125;;</span><br><span class="line">    <span class="keyword">delete</span> body._id;</span><br><span class="line">    <span class="keyword">return</span> http.put(movieUrl(movie._id), body);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> http.post(apiEndpoint, movie);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">deleteMovie</span>(<span class="params">movieId</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> http.delete(movieUrl(movieId));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>movieForm.jsx</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Joi <span class="keyword">from</span> <span class="string">"joi-browser"</span>;</span><br><span class="line"><span class="keyword">import</span> Form <span class="keyword">from</span> <span class="string">"./common/form"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getMovie, saveMovie &#125; <span class="keyword">from</span> <span class="string">"../services/movieService"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getGenres &#125; <span class="keyword">from</span> <span class="string">"../services/genreService"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MovieForm</span> <span class="keyword">extends</span> <span class="title">Form</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    data: &#123;</span><br><span class="line">      title: <span class="string">""</span>,</span><br><span class="line">      genreId: <span class="string">""</span>,</span><br><span class="line">      numberInStock: <span class="string">""</span>,</span><br><span class="line">      dailyRentalRate: <span class="string">""</span></span><br><span class="line">    &#125;,</span><br><span class="line">    genres: [],</span><br><span class="line">    errors: &#123;&#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  schema = &#123;</span><br><span class="line">    _id: Joi.string(),</span><br><span class="line">    title: Joi.string()</span><br><span class="line">      .required()</span><br><span class="line">      .label(<span class="string">"Title"</span>),</span><br><span class="line">    genreId: Joi.string()</span><br><span class="line">      .required()</span><br><span class="line">      .label(<span class="string">"Genre"</span>),</span><br><span class="line">    numberInStock: Joi.number()</span><br><span class="line">      .required()</span><br><span class="line">      .min(<span class="number">0</span>)</span><br><span class="line">      .max(<span class="number">100</span>)</span><br><span class="line">      .label(<span class="string">"Number in Stock"</span>),</span><br><span class="line">    dailyRentalRate: Joi.number()</span><br><span class="line">      .required()</span><br><span class="line">      .min(<span class="number">0</span>)</span><br><span class="line">      .max(<span class="number">10</span>)</span><br><span class="line">      .label(<span class="string">"Daily Rental Rate"</span>)</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> populateGenres() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">data</span>: genres &#125; = <span class="keyword">await</span> getGenres();</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; genres &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">try catch 的作用就是当输入未存储的电影id的时候，我们就需要导向not-found，之前是通过</span></span><br><span class="line"><span class="comment">if(!movie) return this.props.history.replace("/not-found")实现的,但现在需要catch到异常才执行这一步;</span></span><br><span class="line"><span class="comment">try放在第一行，更加美观，反正不影响</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">  <span class="keyword">async</span> populateMovie() &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> movieId = <span class="keyword">this</span>.props.match.params.id;</span><br><span class="line">      <span class="keyword">if</span> (movieId === <span class="string">"new"</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> &#123; <span class="attr">data</span>: movie &#125; = <span class="keyword">await</span> getMovie(movieId);</span><br><span class="line">      <span class="keyword">this</span>.setState(&#123; <span class="attr">data</span>: <span class="keyword">this</span>.mapToViewModel(movie) &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ex) &#123;</span><br><span class="line">      <span class="keyword">if</span> (ex.response &amp;&amp; ex.response.status === <span class="number">404</span>)</span><br><span class="line">        <span class="keyword">this</span>.props.history.replace(<span class="string">"/not-found"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//这里代码重构一下，更具有可读性，否则堆起来很不好看。在render 这个hook结束之后，</span></span><br><span class="line"><span class="comment">//调用commponentDidMount 这个hook，然后他有会调用两个函数，把genre和movies都渲染上去</span></span><br><span class="line"><span class="comment">//componentDidMount 就不会被渲染</span></span><br><span class="line">  <span class="keyword">async</span> componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">this</span>.populateGenres();</span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">this</span>.populateMovie();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  mapToViewModel(movie) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      _id: movie._id,</span><br><span class="line">      title: movie.title,</span><br><span class="line">      genreId: movie.genre._id,</span><br><span class="line">      numberInStock: movie.numberInStock,</span><br><span class="line">      dailyRentalRate: movie.dailyRentalRate</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">这里用到了saveMovie所以要用 async和await</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">  doSubmit = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">await</span> saveMovie(<span class="keyword">this</span>.state.data);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.props.history.push(<span class="string">"/movies"</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;Movie Form&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;form onSubmit=&#123;this.handleSubmit&#125;&gt;</span></span><br><span class="line"><span class="regexp">          &#123;this.renderInput("title", "Title")&#125;</span></span><br><span class="line"><span class="regexp">          &#123;this.renderSelect("genreId", "Genre", this.state.genres)&#125;</span></span><br><span class="line"><span class="regexp">          &#123;this.renderInput("numberInStock", "Number in Stock", "number")&#125;</span></span><br><span class="line"><span class="regexp">          &#123;this.renderInput("dailyRentalRate", "Rate")&#125;</span></span><br><span class="line"><span class="regexp">          &#123;this.renderButton("Save")&#125;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>form&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default MovieForm;</span></span><br></pre></td></tr></table></figure>
<p>现在，没有地方用到fakeservice了！</p>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/" itemprop="url">离散数学之关系1</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-06-02T13:44:32+08:00">
                2020-06-02
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2020-09-06T09:57:12+08:00">
                2020-09-06
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="离散数学之关系1"><a href="#离散数学之关系1" class="headerlink" title="离散数学之关系1"></a>离散数学之关系1</h1><p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/0.png"></p>
<h2 id="Relation"><a href="#Relation" class="headerlink" title="Relation"></a>Relation</h2><h3 id="Binary-Relation"><a href="#Binary-Relation" class="headerlink" title="Binary Relation"></a>Binary Relation</h3><p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/1.png" style="zoom:80%;"></p>
<p>这样所有的二元运算符都可以成为一种关系，或者父子师生也可以成为一个关系</p>
<p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/2.png" style="zoom:80%;"></p>
<p>这个和我们的函数有点像，但是显然不是函数（一个x可以有多个指向），所以我们可以把关系看成一个函数的推广。函数本身就是个关系</p>
<h3 id="Function-as-relations"><a href="#Function-as-relations" class="headerlink" title="Function as relations"></a>Function as relations</h3><p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/3.png" style="zoom:80%;"></p>
<h3 id="Relations-on-a-set"><a href="#Relations-on-a-set" class="headerlink" title="Relations on a set"></a>Relations on a set</h3><p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/4.png" style="zoom:80%;"></p>
<ul>
<li>可以在一个集合中定义关系，比如说a能被b整除；或者a&lt;=b,a&gt;b等等</li>
</ul>
<h3 id="Representing-Relations"><a href="#Representing-Relations" class="headerlink" title="Representing Relations"></a>Representing Relations</h3><h4 id="Matrix-representing"><a href="#Matrix-representing" class="headerlink" title="Matrix representing"></a>Matrix representing</h4><p>也就是说如果$(a_i,b_j) $满足关系，那么这点上的数据就是1，否则就是0</p>
<p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/5.png" style="zoom:80%;"></p>
<h4 id="Digraph-definition"><a href="#Digraph-definition" class="headerlink" title="Digraph definition"></a>Digraph definition</h4><p>利用有向图来存储。如果a指向b，那么关系就是a在前，b在后</p>
<p>那么如果a到a有一条边，那么这就是一个自环</p>
<p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/6.png" style="zoom:80%;"></p>
<p><strong>Question:</strong> How many relations are there on a set with n elements?<br><strong>Solution:</strong><br>A relation on a set A is a subset of A X A. Because A X A has n^2^<br>elements when A has n elements. A set with m elements has 2^m^ subsets, there are $2^{m^2}$ subsets of AXA.<br>Thus, there are $2^{n^2}$ relations on a set with n elements.<br>For example, there are $2^{3^2} = 2^9 = 512$ relations on the set {a,b,c}</p>
<p>也就是说一个集合中的关系是非常非常复杂的</p>
<h2 id="Properties-of-Relations"><a href="#Properties-of-Relations" class="headerlink" title="Properties  of Relations"></a>Properties  of Relations</h2><h3 id="Reflexive-自反"><a href="#Reflexive-自反" class="headerlink" title="Reflexive 自反"></a>Reflexive 自反</h3><p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/7.png" style="zoom:80%;"></p>
<p>那么R1不是自反的，因为里面没有(3,3)</p>
<p>自反关系在图里面表示为一个自环，如果在矩阵上则是 对角线上都为1</p>
<p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/8.png" style="zoom:80%;"></p>
<h3 id="Symmetric-and-antisymmetric-对称和反对称"><a href="#Symmetric-and-antisymmetric-对称和反对称" class="headerlink" title="Symmetric and antisymmetric 对称和反对称"></a>Symmetric and antisymmetric 对称和反对称</h3><p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/9.png" style="zoom:80%;"></p>
<p>A relation R on a set A is called <strong>symmetric</strong> if $(b,a) \in R$ whenever $(a,b) \in R$, for all $ a,b  \in A$.   </p>
<p>对称的就是如果$(b,a) \in R$，那么必然 $(a,b) \in R$,  在矩阵中表示，就是非主对角线上的每一个1，对称点必然是1.</p>
<p>比如说我们的同学关系，相似关系，成比例关系，都是长头发，同一天生日，来自同一个地方，都是对称的。</p>
<p>A relation R on a set A such that for all $ a,b  \in A$.    if  $(a,b) \in R$, and $(b,a) \in R$, then a = b is called<br><strong>antisymmetric.</strong></p>
<p>反对称关系，也就是说对于非主对角线上的每一个1，对称点必然是0。 比如大于等于（a&gt;=b,b&gt;=a ,那么a=b）， a和b的整除(a能整除b，b能整除a，那么a=b)关系。</p>
<p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/10.png" style="zoom:80%;"></p>
<h3 id="Transive-传递性"><a href="#Transive-传递性" class="headerlink" title="Transive 传递性"></a>Transive 传递性</h3><p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/11.png" style="zoom:80%;"></p>
<p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/12.png" style="zoom:80%;"></p>
<p>我们看到只有R3是具有传递性的</p>
<p>R1:（3，4），（4，1） 但是没有（3，1）</p>
<p>R2:（4，1），（1，2） 但是没有（4，2）</p>
<p>传递性在图中的表现：、</p>
<p>A relation is transitive if and only if whenever there is an edge from a vertex x to a vertex y and an edge from a vertex y to a vertex z, there is an edge from x to z (completing a triangle where each side is a directed edge with the correct direction).</p>
<p>也就是说在图中具有传递性的话，三个点之间必然有一个三角形，且一条边的向量等于另外两条边的矢量和。<br>如下图。上面的那张是有传递性的，下面那张没有传递性。因为缺少了c->d，因为已经有c-&gt;a和a-&gt;d了，所以一定要满足三角形才具有传递性</p>
<p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/1.jpg" style="zoom: 33%;"></p>
<h3 id="Irreflexive-非自反性"><a href="#Irreflexive-非自反性" class="headerlink" title="Irreflexive 非自反性"></a>Irreflexive 非自反性</h3><p>Irreflexive代表了对角线上<strong>不能出现</strong> 1</p>
<h3 id="Asymmetric-非对称"><a href="#Asymmetric-非对称" class="headerlink" title="Asymmetric 非对称"></a>Asymmetric 非对称</h3><p>当$(a,b)\in R$时,$(b,a)\notin R$ ，也就是说对角线上必须全部为零且满足反对称</p>
<h2 id="n-ary-relations"><a href="#n-ary-relations" class="headerlink" title="n-ary relations"></a>n-ary relations</h2><p>n元关系：现在我有n个集合，现在n元关系就是这n个集合的笛卡尔集的子集。n称为它的度</p>
<p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/13.png" style="zoom:80%;"></p>
<p>比如说第一个3元关系，关系是a&lt;b&lt;c，那么很明显（1，2，3） 属于R，(2,4,3)就不如与R了</p>
<p>第二个三元关系：定义在整数集上面，(a,b,c)为等差数列</p>
<p>第三个三元关系：a与b是同模的，也就是a与b除以m余数相等</p>
<p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/14.png" style="zoom:80%;"></p>
<p>n元关系的应用就是数据库，数据库中每一个字段都可以成为一个集合，这张表就是这四个集合组成的笛卡尔集中的一部分，也就是一个n元关系。</p>
<p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/15.png" style="zoom:80%;"></p>
<h2 id="Relation-Operators"><a href="#Relation-Operators" class="headerlink" title="Relation Operators"></a>Relation Operators</h2><h3 id="Operations-on-Binary-Relations"><a href="#Operations-on-Binary-Relations" class="headerlink" title="Operations on Binary Relations"></a>Operations on Binary Relations</h3><h4 id="交、并、差、亦或"><a href="#交、并、差、亦或" class="headerlink" title="交、并、差、亦或"></a>交、并、差、亦或</h4><p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/16.png" style="zoom:80%;"></p>
<h4 id="复和-Composite"><a href="#复和-Composite" class="headerlink" title="复和 Composite"></a>复和 Composite</h4><p>也就是说R是A与B之间的关系，S是B和C之间的关系。那么R和S的复合定义如下</p>
<p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/17.png" style="zoom: 67%;"></p>
<p>也就是说设 R 为 X 到 Y 的关系，S为 Y 到 Z 的关系，则$R\circ S$称为R和S的复合关系  $S\circ R = {<x,z>|x\in X\land z\in Z\land(\exists y)(y\in Y: <x,y>\in R\land <y,z>\in S)}$ </y,z></x,y></x,z></p>
<p>至少存在一个b，也可以存在多个b</p>
<p>答题格式：</p>
<ol>
<li>$R_1\circ R_2{(a,c)\in R^2|\exists b \in R: (a,b) \in R_1 and (b,c) \in R_2 }$</li>
<li>将 $(a,b)$ 代入$R_1$, $(a,c)$带入$R_2$</li>
<li>得到$(a,c)$ 满足的关系式</li>
<li>因为结果是a和c的关系是，相对于b独立，我们可以将c重命名为b，转换成a和b的关系式</li>
</ol>
<p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/29.png" style="zoom: 167%;"></p>
<p>这一题能帮我们更好地理解这些运算。</p>
<p>a： $R_1\cup R_2$ 就是  a divides b or a is a multiple of a $\Rightarrow$  a divides b or b divides a</p>
<p>b:   $R_1\cap R_2$ 就是 a divides b and a is a multiple of a $\Rightarrow$ $a=\pm b$ 又因为a需要当分母，所以 $a\neq 0$ </p>
<p>c: $R_1 - R_2$ 就是 a divides b but a is not a multiple of b $\Rightarrow $ a divides b and $a\neq \pm b$ </p>
<p>d: $R_2-R_1$ 就是 b divides a but b is not a multiple of a $\Rightarrow $b divides a and   $a\neq \pm b$ </p>
<p>e: $R_1\oplus R_2$ 为异或： a divides b or a is a multiple of a but not both $\Rightarrow$ (a divides b or b divides a) and   $a\neq \pm b$ </p>
<h4 id="Power-幂运算"><a href="#Power-幂运算" class="headerlink" title="Power  幂运算"></a>Power  幂运算</h4><p>$R^{n+1}$相当于 $R^n$ 和R的附和</p>
<p>$R^1 $ 就是走一步能不能到，$R^2$ 就是走两步能不能到，$R^3$ 就是走三步能不能到（4-&gt;3-&gt;2-&gt;1)(2-&gt;1-&gt;1-&gt;1)，以此类推</p>
<p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/18.png" style="zoom: 67%;"></p>
<h4 id="Property-of-transitive"><a href="#Property-of-transitive" class="headerlink" title="Property of transitive"></a>Property of transitive</h4><p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/19.png" style="zoom: 67%;"></p>
<h4 id="用矩阵表示传递"><a href="#用矩阵表示传递" class="headerlink" title="用矩阵表示传递"></a>用矩阵表示传递</h4><p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/20.png" style="zoom: 67%;"></p>
<h4 id="矩阵运算"><a href="#矩阵运算" class="headerlink" title="矩阵运算"></a>矩阵运算</h4><p>矩阵的点乘，就是先做合取，再做析取</p>
<p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/21.png" style="zoom: 67%;"></p>
<p>Example：</p>
<p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/22.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/23.png" style="zoom: 67%;"></p>
<p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/24.png" style="zoom: 67%;"></p>
<h3 id="Operations-on-n-ary-Relations"><a href="#Operations-on-n-ary-Relations" class="headerlink" title="Operations on n-ary Relations"></a>Operations on n-ary Relations</h3><h4 id="select"><a href="#select" class="headerlink" title="select"></a>select</h4><p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/25.png" style="zoom: 67%;"></p>
<h4 id="Projection"><a href="#Projection" class="headerlink" title="Projection"></a>Projection</h4><p>只看两个维度</p>
<p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/26.png" style="zoom: 67%;"></p>
<h4 id="Join"><a href="#Join" class="headerlink" title="Join"></a>Join</h4><p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/27.png" style="zoom: 67%;"></p>
<p>Join完了之后得到了一张新的表格</p>
<p><img src="/2020/06/02/%E7%A6%BB%E6%95%A3%E6%95%B0%E5%AD%A6%E4%B9%8B%E5%85%B3%E7%B3%BB1/28.png" style="zoom: 67%;"></p>
<h3 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h3><p><a href="https://jasonxqh.github.io/2020/05/16/Mysql基础/">Mysql基础</a></p>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/06/02/react%E5%9F%BA%E7%A1%802/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/02/react%E5%9F%BA%E7%A1%802/" itemprop="url">react基础2</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-06-02T01:07:14+08:00">
                2020-06-02
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2020-06-21T12:43:12+08:00">
                2020-06-21
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index">
                    <span itemprop="name">react</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="react基础2（分页分类排序-路由）"><a href="#react基础2（分页分类排序-路由）" class="headerlink" title="react基础2（分页分类排序+路由）"></a>react基础2（分页分类排序+路由）</h1><p>这篇文章的教程</p>
<p><a href="https://www.bilibili.com/video/BV1Sb411P79t?p=23" target="_blank" rel="noopener">Mosh的react课程</a></p>
<p>从第5章开始</p>
<p>上一篇：<a href="https://jasonxqh.github.io/2020/05/30/react基础/#more">react基础1组件与组合</a></p>
<p>下一篇：<a href="https://jasonxqh.github.io/2020/06/04/react基础3/">react基础3表单与后端</a></p>
<p>下下篇： <a href="https://jasonxqh.github.io/2020/06/05/react基础4授权与部署/">react基础4授权与部署</a></p>
<h2 id="Pagination-Filtering-and-Sorting-分页过滤和排序"><a href="#Pagination-Filtering-and-Sorting-分页过滤和排序" class="headerlink" title="Pagination, Filtering, and Sorting 分页过滤和排序"></a>Pagination, Filtering, and Sorting 分页过滤和排序</h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>我们的目标：分类+排序+分页</p>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/1.png" style="zoom:80%;"></p>
<h3 id="Pagination-Component-Interface"><a href="#Pagination-Component-Interface" class="headerlink" title="Pagination- Component Interface"></a>Pagination- Component Interface</h3><p>首先我们来做分页按钮。因为分页按钮也可以重复使用所以我们把他新建到common文件夹当中</p>
<p>imr导入import React, { Component } from “react”;</p>
<p>sfc导入stateless functional component</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">const</span> Pagination = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Pagination;</span><br></pre></td></tr></table></figure>
<p>显然这个Pagination是Movies的一个受控组件，全部有props传递数据，所以我们在Movies中建一个\<Pagination></Pagination></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新建一个handlePageChange接口，完成翻页操作 </span></span><br><span class="line">handlePageChange =<span class="function"><span class="params">()</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"page"</span>);</span><br><span class="line"></span><br><span class="line">  &#125; </span><br><span class="line">&lt;Pagination</span><br><span class="line">     <span class="comment">//   计算电影信息条数</span></span><br><span class="line">          itemsCount=&#123;count&#125;</span><br><span class="line">     <span class="comment">//	  这里state中放一个每页电影数目，我写的是25</span></span><br><span class="line">          pageSize=&#123;<span class="keyword">this</span>.state.pageSize&#125;</span><br><span class="line">     <span class="comment">//   翻页操作</span></span><br><span class="line">          onPageChange=&#123;<span class="keyword">this</span>.handlePageChange&#125;</span><br><span class="line"> /&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Pagination-Displaying-Pages"><a href="#Pagination-Displaying-Pages" class="headerlink" title="Pagination- Displaying Pages"></a>Pagination- Displaying Pages</h3><p>利用bootstrap的文档，利用快捷键nav>ul.pagination&gt;li.page-item>a.page-link 生成翻页标签</p>
<p>然后我们要动态渲染页面。我们已经知道了props中传入了总信息条数，和每页包含的信息数量，那么我们就可以通过计算的方式得出有多少页码</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">"lodash"</span>;</span><br><span class="line"><span class="keyword">const</span> Pagination = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; itemsCount, pageSize &#125; = props;</span><br><span class="line">    <span class="comment">//计算得出有多少页码，这个计算结果是一个浮点数</span></span><br><span class="line">  <span class="keyword">const</span> pagesCount =  itemsCount / pageSize ;</span><br><span class="line">    <span class="comment">//利用lodash包中的方法，可以生成一个页码的列表</span></span><br><span class="line">  <span class="keyword">const</span> pages = _.range(<span class="number">1</span>, pagesCount + <span class="number">1</span>);</span><br><span class="line">    <span class="comment">//如果当前的总信息条数小于单页信息条数，我们就不用渲染翻页按钮了</span></span><br><span class="line">  <span class="keyword">if</span> (pagesCount &lt;= <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;nav&gt;</span><br><span class="line">      &lt;ul className=<span class="string">"pagination"</span>&gt;</span><br><span class="line">          &#123;<span class="comment">/* 否则我们就渲染，利用map函数对每一个页码都生成一个翻页标签 */</span>&#125;</span><br><span class="line">        &#123;pages.map(<span class="function">(<span class="params">page</span>) =&gt;</span> (</span><br><span class="line">          &lt;li key=&#123;page&#125; className=<span class="string">"page-item"</span>&gt;</span><br><span class="line">            &lt;a className=<span class="string">"page-link"</span>&gt;&#123;page&#125;&lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>li&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>nav&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Pagination;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/2.png" style="zoom:80%;"></p>
<h3 id="Pagination-Handling-Page-Changes"><a href="#Pagination-Handling-Page-Changes" class="headerlink" title="Pagination- Handling Page Changes"></a>Pagination- Handling Page Changes</h3><p>接下来我们来实现当点击页码的时候，console会显示该页的页码，并且让其高亮。</p>
<p>那么我们就需要在点击页码的时候发起一个event，然后让父组件Movies去更新当前的页面，然后再通过props重新生成，传回给Pagination组件，实现页码更新+高亮</p>
<p>下面就是在pagination.jsx中修改的部分，我们首先解构props</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">const</span> &#123; itemsCount, pageSize, onPageChange, currentPage &#125; = props;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="comment">//  让当前的页码标签高亮</span></span><br><span class="line"> &lt;li</span><br><span class="line">     key=&#123;page&#125;</span><br><span class="line">     className=&#123;page === currentPage ? <span class="string">"page-item active"</span> : <span class="string">"page-item"</span>&#125;</span><br><span class="line"> &gt;</span><br><span class="line">    &#123;<span class="comment">/*再点击的时候，借助props发起一个onPageChange(page)事件，交给Movies去处理*/</span>&#125;</span><br><span class="line">    &lt;a className=<span class="string">"page-link"</span> onClick=&#123;() =&gt; onPageChange(page)&#125;&gt;</span><br><span class="line">      &#123;page&#125;</span><br><span class="line">    &lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>li&gt;</span><br></pre></td></tr></table></figure>
<p>在movies.jsx中我们也有要改的</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movies</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    movies: getMovies(),</span><br><span class="line">    pageSize: <span class="number">25</span>,</span><br><span class="line">    currentPage: <span class="number">1</span>,<span class="comment">//在这里新建一个currentPage的本地数据</span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="comment">// 新建一个handlePageChange来处理改变页码的功能，这里就是把state中currentPage改成当前page</span></span><br><span class="line">  handlePageChange = <span class="function">(<span class="params">page</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">currentPage</span>: page &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">length</span>: count &#125; = <span class="keyword">this</span>.state.movies;</span><br><span class="line">    <span class="comment">//解构state，简化代码</span></span><br><span class="line">    <span class="keyword">const</span> &#123; pageSize, currentPage &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">     &lt;Pagination</span><br><span class="line">          itemsCount=&#123;count&#125;</span><br><span class="line">          currentPage=&#123;currentPage&#125;</span><br><span class="line">          pageSize=&#123;pageSize&#125;</span><br><span class="line">         <span class="comment">// 接受Pagination发起的event，交给handlePageChange处理</span></span><br><span class="line">          onPageChange=&#123;<span class="keyword">this</span>.handlePageChange&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      &lt;<span class="regexp">/React.Fragment&gt;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/3.png" style="zoom:80%;"></p>
<p>这时候点击页码按钮，就会实现高亮</p>
<h3 id="Pagination-Paginating-Data"><a href="#Pagination-Paginating-Data" class="headerlink" title="Pagination- Paginating Data"></a>Pagination- Paginating Data</h3><p>接下来我们正式处理翻页，因为翻页功能可能在其他的app中也会有用，所以我们新建一个文件夹utils存放这类函数。我们在utils文件夹中 新建一个 paginate.js文件</p>
<p>现在我们要理解这段话的意思</p>
<p>slice(items,startIndex)这个方法，将从起始位置开始切割这个数组</p>
<p>take(pageSize) 这个方法 传入截取的信息条数</p>
<p>value() 就是把这个lodash wrapper转化成一个 常规的数组</p>
<p>然后把他return掉</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">"lodash"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">paginate</span>(<span class="params">items, pageNumber, pageSize</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//这就是计算每页起始位置的编号</span></span><br><span class="line">  <span class="keyword">const</span> startIndex = (pageNumber - <span class="number">1</span>) * pageSize;</span><br><span class="line">    <span class="comment">//进行切割</span></span><br><span class="line">  <span class="keyword">return</span> _(items).slice(startIndex).take(pageSize).value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在movies中引入import { paginate } from “../utils/paginate”;</p>
<p>接下来我们就需要在render渲染器中把原来的movies覆盖掉</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//length:count 是解构中的一个语法，就是说给movies中的length属性一个叫做count的别名</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="attr">length</span>: count &#125; = <span class="keyword">this</span>.state.movies;</span><br><span class="line"><span class="comment">//在这里我们需要给this.state.movies 一个别名，否则这里的movies会和下面的const movies冲突</span></span><br><span class="line"><span class="keyword">const</span> &#123; pageSize, currentPage, <span class="attr">movies</span>:allmovies &#125; = <span class="keyword">this</span>.state;</span><br><span class="line"><span class="keyword">if</span> (count === <span class="number">0</span>) <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>There are no movies in the database <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line"><span class="comment">//对原有的movies进行覆盖</span></span><br><span class="line"><span class="keyword">const</span> movies = paginate(allmovies, currentPage, pageSize);</span><br></pre></td></tr></table></figure>
<p>接下来就看看成效吧</p>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/1.gif" style="zoom:80%;"></p>
<h3 id="Pagination-Type-Checking-with-PropTypes"><a href="#Pagination-Type-Checking-with-PropTypes" class="headerlink" title="Pagination- Type Checking with PropTypes"></a>Pagination- Type Checking with PropTypes</h3><p>我们如果向props中传入了invalid 的参数，那么虽然不会报错，却会产生很严重的bug</p>
<p>这时候我们需要引入一个外部的库，来帮我们检查是否出现了参数类型错误</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm i prop-types@15.6.2</span><br></pre></td></tr></table></figure>
<p>在pagination.jsx 中引入这个包，然后做检测</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">"prop-types"</span>;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="comment">//注意，下面的格式必须要对，Pagination是组件名称</span></span><br><span class="line">Pagination.PropTypes = &#123;</span><br><span class="line">    <span class="comment">//后面的参数类型是可以多种多样的：number,string,bool,array,object,func,symbol</span></span><br><span class="line">    <span class="comment">// isRequirement 代表了 这个参数必须传入，不传入为空也会报错</span></span><br><span class="line">  itemsCount: PropTypes.number.isRequired,</span><br><span class="line">  pageSize: PropTypes.number.isRequired,</span><br><span class="line">  onPageChange: PropTypes.number.isRequired,</span><br><span class="line">  currentPage: PropTypes.func.isRequired,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/4.png" style="zoom:80%;"></p>
<p>当我们给itemsCount传入一个字符串的时候，就会得到上面的Warning</p>
<h3 id="Exercise-ListGroup-Component"><a href="#Exercise-ListGroup-Component" class="headerlink" title="Exercise- ListGroup Component"></a>Exercise- ListGroup Component</h3><p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/5.png" style="zoom:80%;"></p>
<p>接下来我们要做一个旁边的类型筛选器来是先筛选操作。</p>
<h3 id="Filtering-Component-Interface-组件接口"><a href="#Filtering-Component-Interface-组件接口" class="headerlink" title="Filtering- Component Interface 组件接口"></a>Filtering- Component Interface 组件接口</h3><p>我们首先在common文件夹中新建一个listGroup.jsx</p>
<p>imrc,cc,新建一个ListGroup组件</p>
<p>我们看到上面的效果，是左面一列，右边一列，所以说在一个div当中我们要做两列，第一列放ListGroup，第二列来放我们刚才的表</p>
<p>那么修改Movies 的render() ，通过快捷键 div.col-2+div.col快捷键新建</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=<span class="string">"col-2"</span>&gt;&#123;<span class="comment">/*存ListGroup*/</span>&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;div-col&gt;&#123;/</span>*存放电影的表格*<span class="regexp">/&#125;&lt;/</span>div-col&gt;</span><br></pre></td></tr></table></figure>
<p>然后在ListGroup中传入props</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;div className=<span class="string">"col-2"</span>&gt;</span><br><span class="line">  &lt;ListGroup</span><br><span class="line">      <span class="comment">//传入 items来传入电影的分类</span></span><br><span class="line">    items=&#123;<span class="keyword">this</span>.state.genres&#125;</span><br><span class="line">      <span class="comment">//传入 onItemSelect来处理ListGroup 发起的一个events</span></span><br><span class="line">    onItemSelect=&#123;<span class="keyword">this</span>.handleGenreSelect&#125;</span><br><span class="line">  /&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>
<p>同时新建一个handleGenreSelect来处理</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">handleGenreSelect = <span class="function"><span class="params">genre</span> =&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(genre);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>对了，我们这里只是在本地调用一些数据，以后我们将调用数据库中的数据，那么在state中直接声明就变得不可行了，所以我们修改一下state中的movies和genres，先声明一个空数组，然后通过componentDidMount这个hook来赋值</p>
<p>movies.jsx:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">state = &#123;</span><br><span class="line">  movies: [],</span><br><span class="line">  genres: [],</span><br><span class="line">  pageSize: <span class="number">4</span>,</span><br><span class="line">  currentPage: <span class="number">1</span>,</span><br><span class="line">  selectedGenre:<span class="literal">null</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">componentDidMount() &#123;</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123; <span class="attr">movies</span>: getMovies(), <span class="attr">genres</span>: getGenres() &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Filtering-Displaying-Items"><a href="#Filtering-Displaying-Items" class="headerlink" title="Filtering- Displaying Items"></a>Filtering- Displaying Items</h3><p>通过快捷键 ul.list-group>li.list-group-item来新建，然后用我们的genre来动态渲染</p>
<p>通过解构pros简化代码，其中两个props textProperty=”name”      valueProperty=”_id” 是为了降低代码的耦合度即不那么依赖Object的属性。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">const</span> ListGroup = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; items ,textProperty,valueProperty &#125; = props;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;ul className=<span class="string">"list-group"</span>&gt;</span><br><span class="line">      &#123;items.map(<span class="function">(<span class="params">item</span>) =&gt;</span> (</span><br><span class="line">        &lt;li key=&#123;item[valueProperty]&#125; className=<span class="string">"list-group-item"</span>&gt;</span><br><span class="line">          &#123;item[textProperty]&#125;</span><br><span class="line">        &lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">      ))&#125;</span></span><br><span class="line"><span class="regexp">    &lt;/u</span>l&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ListGroup;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/6.png" style="zoom: 67%;"></p>
<h3 id="Filtering-Default-Props"><a href="#Filtering-Default-Props" class="headerlink" title="Filtering- Default Props"></a>Filtering- Default Props</h3><p>这就涉及到代码简洁的问题了，当我们对一个组件的传入越少props，那么他就会好用，而我们对ListGroup组件传入了4个props，其中两个只是简单的字符串，那么我们就可以通过组件的defaultProps 进行对一些props设置默认值</p>
<p>我们在listGroup.jsx中加上这样一段代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ListGroup.defaultProps = &#123;</span><br><span class="line">  textProperty: <span class="string">"name"</span>,</span><br><span class="line">  valueProperty: <span class="string">"_id"</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这样Movies中ListGroup标签中的那两个props就可以删除了，因为他已经在defaultProps中定义了</p>
<h3 id="Filtering-Handling-Selection"><a href="#Filtering-Handling-Selection" class="headerlink" title="Filtering- Handling Selection"></a>Filtering- Handling Selection</h3><p>然后我们要处理的就是点击按钮，实现高亮，那么这应该怎么操作呢？</p>
<p>事实上和分页按钮是相似的。我们在Movies中实现props操作，在ListGroup中通过props判断当前的按钮是否应该被高亮</p>
<p>movie.jsx</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line">handleGenreSelect = <span class="function">(<span class="params">genre</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">selectedGenre</span>: genre &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//....</span></span><br><span class="line">&lt;ListGroup</span><br><span class="line">  items=&#123;<span class="keyword">this</span>.state.genres&#125;</span><br><span class="line">  <span class="comment">//当点击的时候，通过handleGenreSelect来更新当前的selectedGenre属性</span></span><br><span class="line">  onItemSelect=&#123;<span class="keyword">this</span>.handleGenreSelect&#125;</span><br><span class="line">  <span class="comment">//通过selectedItem 这个prop 将我们已经更行了的seletedGenre传回给ListGroup</span></span><br><span class="line">  selectedItem=&#123;<span class="keyword">this</span>.state.selectedGenre&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Filtering-Implementing-Filtering"><a href="#Filtering-Implementing-Filtering" class="headerlink" title="Filtering- Implementing Filtering"></a>Filtering- Implementing Filtering</h3><p>在movies组件的渲染器当中，我们通过 const movies = paginate(filtered, currentPage, pageSize);来进行分页操作。如果要实现分类，那么我们就需要在分页之前进行筛选才对</p>
<p>逻辑就是判断当前selectedGenre是否存在，如果存在，那么就筛选出_id和他相等的出来，如果不存在（我默认为null),那么我们就返回所有的电影</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> filtered =</span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">selectedGenre ? </span><br><span class="line">	allmovies.filter(<span class="function">(<span class="params">m</span>) =&gt;</span> m.genre._id === selectedGenre._id)  : allmovies;</span><br></pre></td></tr></table></figure>
<p>然后我们要对filter进行分页</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> movies = paginate(filtered, currentPage, pageSize);</span><br></pre></td></tr></table></figure>
<p>最后我们交给Pagination 的信息数量也要从count变成filtered.length</p>
<p>把 <em>&lt;</em>h2<em>&gt;</em>Showing {count} movies in the database<em>&lt;/</em>h2<em>&gt;</em> 中的count改成filtered.length</p>
<h3 id="Filtering-Adding-All-Genres"><a href="#Filtering-Adding-All-Genres" class="headerlink" title="Filtering- Adding All Genres"></a>Filtering- Adding All Genres</h3><p>我们现在要加一个All genre按钮,也就是说给genres多一个All genre对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">componentDidMount() &#123;</span><br><span class="line">  <span class="keyword">const</span> genres = [&#123; <span class="attr">_id</span>: <span class="string">""</span>, <span class="attr">name</span>: <span class="string">"All genre"</span> &#125;, ...getGenres()];</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123; <span class="attr">movies</span>: getMovies(), genres &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是当我们再次回到All genre 标签的时候，发现并没筛选出来什么东西。这是因为我们在一开始的判定条件是 selectedGenre? 当我们点了Action之类的genre的时候，react已经把 selectedGenre从null更新称Action了，所以再次回到All genre的时候， selectedGenre其实不是null了，而任何电影信息的id都不等于空，所以就返回了0</p>
<p>解决这个，我们可以加一个判断条件,需要满足 selectedGenre &amp;&amp; selectedGenre._id 不为零才进行筛选，否则就全部返回。这样这个问题就完美解决了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> filtered = selectedGenre &amp;&amp; selectedGenre._id ?</span><br><span class="line">allmovies.filter(<span class="function">(<span class="params">m</span>) =&gt;</span> m.genre._id === selectedGenre._id): allmovies;</span><br></pre></td></tr></table></figure>
<p>别高兴得太早，我们还是有bug没有解决。</p>
<p>我们如果翻到第二页，再点击Triller的话，并不会显示任何得电影</p>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/7.png" style="zoom: 67%;"></p>
<p>这是为什么呢？因为我们现在的页面其实停留在第2页，而第二页是没有得，电影信息都在第一页中。</p>
<p>所以我们无论何时改变分类，都应该重置页面回第一页</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">handleGenreSelect = <span class="function">(<span class="params">genre</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123; <span class="attr">selectedGenre</span>: genre, <span class="attr">currentPage</span>: <span class="number">1</span> &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>至此，我们已经完美解决了这个问题</p>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/2.gif" alt></p>
<p>完整代码如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getMovies &#125; <span class="keyword">from</span> <span class="string">"../services/fakeMovieService"</span>;</span><br><span class="line"><span class="keyword">import</span> Like <span class="keyword">from</span> <span class="string">"./common/like"</span>;</span><br><span class="line"><span class="keyword">import</span> Pagination <span class="keyword">from</span> <span class="string">"./common/pagination"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; paginate &#125; <span class="keyword">from</span> <span class="string">"../utils/paginate"</span>;</span><br><span class="line"><span class="keyword">import</span> ListGroup <span class="keyword">from</span> <span class="string">"./common/listGroup"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getGenres &#125; <span class="keyword">from</span> <span class="string">"../services/fakeGenreService"</span>;</span><br><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">"lodash"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movies</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    movies: [],</span><br><span class="line">    genres: [],</span><br><span class="line">    pageSize: <span class="number">4</span>,</span><br><span class="line">    currentPage: <span class="number">1</span>,</span><br><span class="line">    selectedGenre: <span class="literal">null</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    <span class="keyword">const</span> genres = [&#123; <span class="attr">_id</span>: <span class="string">""</span>, <span class="attr">name</span>: <span class="string">"All genre"</span> &#125;, ...getGenres()];</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">movies</span>: getMovies(), genres &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  handleDelete = <span class="function">(<span class="params">movie</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> movies = <span class="keyword">this</span>.state.movies.filter(<span class="function">(<span class="params">m</span>) =&gt;</span> m._id !== movie._id);</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; movies &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  handleLike = <span class="function">(<span class="params">movie</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> movies = [...this.state.movies];</span><br><span class="line">    <span class="keyword">const</span> index = movies.indexOf(movie);</span><br><span class="line">    movies[index] = &#123; ...movies[index] &#125;;</span><br><span class="line">    movies[index].liked = !movies[index].liked;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; movies &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  handlePageChange = <span class="function">(<span class="params">page</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">currentPage</span>: page &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  handleGenreSelect = <span class="function">(<span class="params">genre</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">selectedGenre</span>: genre, <span class="attr">currentPage</span>: <span class="number">1</span> &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">length</span>: count &#125; = <span class="keyword">this</span>.state.movies;</span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      pageSize,</span><br><span class="line">      currentPage,</span><br><span class="line">      selectedGenre,</span><br><span class="line">      movies: allmovies,</span><br><span class="line">    &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">    <span class="keyword">if</span> (count === <span class="number">0</span>) <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>There are no movies in the database <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> filtered =</span><br><span class="line">      selectedGenre &amp;&amp; selectedGenre._id</span><br><span class="line">        ? allmovies.filter(<span class="function">(<span class="params">m</span>) =&gt;</span> m.genre._id === selectedGenre._id)</span><br><span class="line">        : allmovies;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> movies = paginate(filtered, currentPage, pageSize);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"row"</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">"col-3"</span>&gt;</span><br><span class="line">          &lt;ListGroup</span><br><span class="line">            items=&#123;<span class="keyword">this</span>.state.genres&#125;</span><br><span class="line">            selectedItem=&#123;<span class="keyword">this</span>.state.selectedGenre&#125;</span><br><span class="line">            onItemSelect=&#123;<span class="keyword">this</span>.handleGenreSelect&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div className="col"&gt;</span></span><br><span class="line"><span class="regexp">          &lt;h2&gt;Showing &#123;filtered.length&#125; movies in the database&lt;/</span>h2&gt;</span><br><span class="line">          &lt;table className=<span class="string">"table"</span>&gt;</span><br><span class="line">            &lt;thead&gt;</span><br><span class="line">              &lt;tr&gt;</span><br><span class="line">                &lt;th&gt;Title&lt;<span class="regexp">/th&gt;</span></span><br><span class="line"><span class="regexp">                &lt;th&gt;Genre&lt;/</span>th&gt;</span><br><span class="line">                &lt;th&gt;Stock&lt;<span class="regexp">/th&gt;</span></span><br><span class="line"><span class="regexp">                &lt;th&gt;Rate&lt;/</span>th&gt;</span><br><span class="line">                &lt;th&gt;Like&lt;<span class="regexp">/th&gt;</span></span><br><span class="line"><span class="regexp">                &lt;th&gt;Delete&lt;/</span>th&gt;</span><br><span class="line">              &lt;<span class="regexp">/tr&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>thead&gt;</span><br><span class="line">            &lt;tbody&gt;</span><br><span class="line">              &#123;movies.map(<span class="function">(<span class="params">movie</span>) =&gt;</span> (</span><br><span class="line">                &lt;tr key=&#123;movie._id&#125;&gt;</span><br><span class="line">                  &lt;td&gt;&#123;movie.title&#125;&lt;<span class="regexp">/td&gt;</span></span><br><span class="line"><span class="regexp">                  &lt;td&gt;&#123;movie.genre.name&#125;&lt;/</span>td&gt;</span><br><span class="line">                  &lt;td&gt;&#123;movie.numberInStock&#125;&lt;<span class="regexp">/td&gt;</span></span><br><span class="line"><span class="regexp">                  &lt;td&gt;&#123;movie.dailyRentalRate&#125;&lt;/</span>td&gt;</span><br><span class="line">                  &lt;td&gt;</span><br><span class="line">                    &lt;Like</span><br><span class="line">                      liked=&#123;movie.liked&#125;</span><br><span class="line">                      onClick=&#123;() =&gt; <span class="keyword">this</span>.handleLike(movie)&#125;</span><br><span class="line">                    /&gt;</span><br><span class="line">                  &lt;<span class="regexp">/td&gt;</span></span><br><span class="line"><span class="regexp">                  &lt;td&gt;</span></span><br><span class="line"><span class="regexp">                    &lt;button</span></span><br><span class="line"><span class="regexp">                      onClick=&#123;() =&gt; this.handleDelete(movie)&#125;</span></span><br><span class="line"><span class="regexp">                      className="btn btn-danger btn-sm"</span></span><br><span class="line"><span class="regexp">                    &gt;</span></span><br><span class="line"><span class="regexp">                      Delete</span></span><br><span class="line"><span class="regexp">                    &lt;/</span>button&gt;</span><br><span class="line">                  &lt;<span class="regexp">/td&gt;</span></span><br><span class="line"><span class="regexp">                &lt;/</span>tr&gt;</span><br><span class="line">              ))&#125;</span><br><span class="line">            &lt;<span class="regexp">/tbody&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>table&gt;</span><br><span class="line">          &lt;Pagination</span><br><span class="line">            itemsCount=&#123;filtered.length&#125;</span><br><span class="line">            currentPage=&#123;currentPage&#125;</span><br><span class="line">            pageSize=&#123;pageSize&#125;</span><br><span class="line">            onPageChange=&#123;<span class="keyword">this</span>.handlePageChange&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Movies;</span><br></pre></td></tr></table></figure>
<p>listGroup.jsx</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">const</span> ListGroup = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123;</span><br><span class="line">    items,</span><br><span class="line">    textProperty,</span><br><span class="line">    valueProperty,</span><br><span class="line">    onItemSelect,</span><br><span class="line">    selectedItem,</span><br><span class="line">  &#125; = props;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;ul className=<span class="string">"list-group"</span>&gt;</span><br><span class="line">      &#123;items.map(<span class="function">(<span class="params">item</span>) =&gt;</span> (</span><br><span class="line">        &lt;li</span><br><span class="line">          key=&#123;item[valueProperty]&#125;</span><br><span class="line">          className=&#123;item===selectedItem?<span class="string">"list-group-item active"</span>:<span class="string">"list-group-item "</span>&#125;</span><br><span class="line">          onClick=&#123;() =&gt; onItemSelect(item)&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          &#123;item[textProperty]&#125;</span><br><span class="line">        &lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">      ))&#125;</span></span><br><span class="line"><span class="regexp">    &lt;/u</span>l&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ListGroup.defaultProps = &#123;</span><br><span class="line">  textProperty: <span class="string">"name"</span>,</span><br><span class="line">  valueProperty: <span class="string">"_id"</span>,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ListGroup;</span><br></pre></td></tr></table></figure>
<h3 id="Sorting-Extracting-MoviesTable-封装MoviesTable"><a href="#Sorting-Extracting-MoviesTable-封装MoviesTable" class="headerlink" title="Sorting- Extracting MoviesTable 封装MoviesTable"></a>Sorting- Extracting MoviesTable 封装MoviesTable</h3><p>我们之前把表格直接卸载了Movies组件当中，但其实电压表，分页器，筛选器都是属于一个层面的组件，所以我们现在来封装MoviesTable组件</p>
<p>在component文件夹中新建moviesTable.jsx, imr.sfc构建一个stateless functional component，然后把Movies中得table标签全部移到moviesTable中去，并且把this.handleLike ，this.handleDelete 都变成events，也就是说再点击的时候发起onLike,onDelete{在创建的时候先解构props}。最后在Movies中加入Movies Table组件,传入props处理这些事件。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;MoviesTable</span><br><span class="line">      movies=&#123;movies&#125;</span><br><span class="line">      onLike=&#123;<span class="keyword">this</span>.handleLike&#125;</span><br><span class="line">      onDelete=&#123;<span class="keyword">this</span>.handleDelete&#125;</span><br><span class="line">    /&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Sorting-Raising-the-Sort-Event"><a href="#Sorting-Raising-the-Sort-Event" class="headerlink" title="Sorting- Raising the Sort Event"></a>Sorting- Raising the Sort Event</h3><p>然后我们要在点击每一列的时候实现sort，那么必然要在moviesTable组件发起一个event，老样子</p>
<p>解构中加入onSort，每个tr标签加入onClick</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movies</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    movies: [],</span><br><span class="line">    genres: [],</span><br><span class="line">    pageSize: <span class="number">10</span>,</span><br><span class="line">    currentPage: <span class="number">1</span>,</span><br><span class="line">    selectedGenre: <span class="literal">null</span>,</span><br><span class="line">    sortColumn: &#123; <span class="attr">path</span>: <span class="string">"range"</span>, <span class="attr">order</span>: <span class="string">"asc"</span> &#125;,<span class="comment">//默认</span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>
<p>然后在Movies的<moviesTable \> 中加入onSort = this.handleSort 的prop</moviesTable></p>
<p>接下来我们实现handleSort</p>
<h3 id="Sorting-Implementing-Sorting"><a href="#Sorting-Implementing-Sorting" class="headerlink" title="Sorting- Implementing Sorting"></a>Sorting- Implementing Sorting</h3><p>我们想实现的是默认正序，点击反序，再点击又回到正序这样的功能</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">"lodash"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movies</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    movies: [],</span><br><span class="line">    genres: [],</span><br><span class="line">    pageSize: <span class="number">10</span>,</span><br><span class="line">    currentPage: <span class="number">1</span>,</span><br><span class="line">    selectedGenre: <span class="literal">null</span>,</span><br><span class="line">    sortColumn: &#123; <span class="attr">path</span>: <span class="string">"range"</span>, <span class="attr">order</span>: <span class="string">"asc"</span> &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">  handleSort = <span class="function">(<span class="params">path</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">//我们首先克隆sortColumn</span></span><br><span class="line">    <span class="keyword">const</span> sortColumn = &#123; ...this.state.sortColumn &#125;;</span><br><span class="line">      <span class="comment">//判断当前的列是否为排序列，如果是的话，再次点击就取反</span></span><br><span class="line">    <span class="keyword">if</span> (sortColumn.path === path)</span><br><span class="line">      sortColumn.order = sortColumn.order === <span class="string">"asc"</span> ? <span class="string">"desc"</span> : <span class="string">"asc"</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//如果不是的话，那么就默认正序排列</span></span><br><span class="line">      sortColumn.path = path;</span><br><span class="line">      sortColumn.order = <span class="string">"asc"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="comment">//实现setState更新</span></span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; sortColumn &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//那么我们真正用到排序的是这个地方</span></span><br><span class="line"><span class="comment">//这是一个lodash库，里面有orderBy函数</span></span><br><span class="line"><span class="comment">//第一个传进去的是筛选过的信息，第二个传入的是列，第三个参数是顺序</span></span><br><span class="line"> <span class="keyword">const</span> sorted = _.orderBy(filtered, [sortColumn.path], [sortColumn.order]);</span><br><span class="line"><span class="comment">//重新命名我们的movies为排序过后的信息</span></span><br><span class="line"><span class="keyword">const</span> movies = paginate(sorted, currentPage, pageSize);</span><br></pre></td></tr></table></figure>
<h3 id="Sorting-Moving-Responsibility"><a href="#Sorting-Moving-Responsibility" class="headerlink" title="Sorting- Moving Responsibility"></a>Sorting- Moving Responsibility</h3><p>但这样时显示有问题的，当在其他的地方使用这个moviestable实现排序的时候，我们需要把上面的handleSort放到新的程序当中，这样就变得麻烦起来了，所以我们还是选择把moviesTable变成一个class，在class中加一个raiseSort方法，把逻辑改成点击列的时候调用这个raiseSort方法，这个raiseSort方法处理好刚才的排序逻辑的以后，向Movies发起一个events，在Movies通过onSort 接收以后调用handleSort实现更新</p>
<p>moviesTable.jsx</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Like <span class="keyword">from</span> <span class="string">"./common/like"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MoviesTable</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="comment">//raiseSort 处理排序逻辑，然后向Movies发起event</span></span><br><span class="line">  raiseSort = <span class="function">(<span class="params">path</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> sortColumn = &#123; ...this.props.sortColumn &#125;;</span><br><span class="line">    <span class="keyword">if</span> (sortColumn.path === path)</span><br><span class="line">      sortColumn.order = sortColumn.order === <span class="string">"asc"</span> ? <span class="string">"desc"</span> : <span class="string">"asc"</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      sortColumn.path = path;</span><br><span class="line">      sortColumn.order = <span class="string">"asc"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.props.onSort(sortColumn);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; movies, onDelete, onLike &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;table className=<span class="string">"table"</span>&gt;</span><br><span class="line">        &lt;thead&gt;</span><br><span class="line">          &lt;tr&gt;</span><br><span class="line">              &#123;<span class="comment">/*通过点击调用类中方法*/</span>&#125;</span><br><span class="line">            &lt;th onClick=&#123;() =&gt; <span class="keyword">this</span>.raiseSort(<span class="string">"title"</span>)&#125;&gt;Title&lt;<span class="regexp">/th&gt;</span></span><br><span class="line"><span class="regexp">            &lt;th onClick=&#123;() =&gt; this.raiseSort("director")&#125;&gt;Director&lt;/</span>th&gt;</span><br><span class="line">            &lt;th onClick=&#123;() =&gt; <span class="keyword">this</span>.raiseSort(<span class="string">"actor"</span>)&#125;&gt;Actors&lt;<span class="regexp">/th&gt;</span></span><br><span class="line"><span class="regexp">            &lt;th onClick=&#123;() =&gt; this.raiseSort("country")&#125;&gt;Country&lt;/</span>th&gt;</span><br><span class="line">            &lt;th onClick=&#123;() =&gt; <span class="keyword">this</span>.raiseSort(<span class="string">"index"</span>)&#125;&gt;Range&lt;<span class="regexp">/th&gt;</span></span><br><span class="line"><span class="regexp">            &lt;th onClick=&#123;() =&gt; this.raiseSort("score")&#125;&gt;Score&lt;/</span>th&gt;</span><br><span class="line">            &lt;th onClick=&#123;() =&gt; <span class="keyword">this</span>.raiseSort(<span class="string">"sort"</span>)&#125;&gt;Sort&lt;<span class="regexp">/th&gt;</span></span><br><span class="line"><span class="regexp">            &lt;th onClick=&#123;() =&gt; this.raiseSort("time")&#125;&gt;Time&lt;/</span>th&gt;</span><br><span class="line">            &lt;th&gt;like&lt;<span class="regexp">/th&gt;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>tr&gt;</span><br><span class="line"><span class="comment">//...</span></span><br></pre></td></tr></table></figure>
<p>然后在movie.jsx中只需要 一句简单的更新即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">handleSort = <span class="function">(<span class="params">sortColumn</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123; sortColumn &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Sorting-Extracting-TableHeader封装表头"><a href="#Sorting-Extracting-TableHeader封装表头" class="headerlink" title="Sorting- Extracting TableHeader封装表头"></a>Sorting- Extracting TableHeader封装表头</h3><p>接下来我们要封装一个表头，也就是把这张表逐个拆解成几部分,在表头中实现排序逻辑，</p>
<p>表头的运行模式是</p>
<p>我们在common中新建一个tableHeader.jsx，tableHeader中的columns是从moviesTable给他的props中获得的，然后通过map渲染出表头来</p>
<p>tableHeader.jsx</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//columns:array</span></span><br><span class="line"><span class="comment">//sortColumn</span></span><br><span class="line"><span class="comment">//onSort：function</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TableHeader</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  raiseSort = <span class="function">(<span class="params">path</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> sortColumn = &#123; ...this.props.sortColumn &#125;;</span><br><span class="line">    <span class="keyword">if</span> (sortColumn.path === path)</span><br><span class="line">      sortColumn.order = sortColumn.order === <span class="string">"asc"</span> ? <span class="string">"desc"</span> : <span class="string">"asc"</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      sortColumn.path = path;</span><br><span class="line">      sortColumn.order = <span class="string">"asc"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.props.onSort(sortColumn);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;thead&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">          &#123;<span class="keyword">this</span>.props.columns.map(<span class="function">(<span class="params">column</span>) =&gt;</span> (</span><br><span class="line">            &lt;th</span><br><span class="line">                <span class="comment">//每个标签都要有他的key值，那么需要排列的就取path，不需要的就取key</span></span><br><span class="line">              key=&#123;column.path || column.key&#125;</span><br><span class="line">                <span class="comment">//在点击的时候，调用raiseSort方法，raiseSort向Moviecolumn发起一个event</span></span><br><span class="line">              onClick=&#123;() =&gt; <span class="keyword">this</span>.raiseSort(column.path)&#125;</span><br><span class="line">            &gt;</span><br><span class="line">              &#123;column.label&#125;</span><br><span class="line">            &lt;<span class="regexp">/th&gt;</span></span><br><span class="line"><span class="regexp">          ))&#125;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>tr&gt;</span><br><span class="line">      &lt;<span class="regexp">/thead&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default TableHeader;</span></span><br></pre></td></tr></table></figure>
<p>在moviesTable中传入columns(不是state)</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> columns = [</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">"title"</span>, <span class="attr">label</span>: <span class="string">"Title"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">"director"</span>, <span class="attr">label</span>: <span class="string">"Director"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">"actor"</span>, <span class="attr">label</span>: <span class="string">"Actors"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">"country"</span>, <span class="attr">label</span>: <span class="string">"Country"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">"index"</span>, <span class="attr">label</span>: <span class="string">"Range"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">"sort"</span>, <span class="attr">label</span>: <span class="string">"Score"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">path</span>: <span class="string">"time"</span>, <span class="attr">label</span>: <span class="string">"Time"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">key</span>: <span class="string">"like"</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">key</span>: <span class="string">"Delete"</span> &#125;,</span><br><span class="line">  ];</span><br><span class="line"><span class="comment">//...在table中传入 &lt;TableHeader/&gt;,把columns,sortColumn，onSort传给表头组件</span></span><br><span class="line"><span class="comment">// columns在MovieTable中定义，sortColumn和onSort则在Movies传给MovieTable的props中</span></span><br><span class="line"><span class="comment">//等于说，表头raise一个event，表再把这个event向Movies抛，然后Movies组件来解决</span></span><br><span class="line">        &lt;TableHeader</span><br><span class="line">          columns=&#123;<span class="keyword">this</span>.columns&#125;</span><br><span class="line">          sortColumn=&#123;sortColumn&#125;</span><br><span class="line">          onSort=&#123;onSort&#125;</span><br><span class="line">        /&gt;</span><br></pre></td></tr></table></figure>
<p>封装好后，代码变得干净很多，表的重复利用的概率也大大提升</p>
<h3 id="Sorting-Extracting-TableBody"><a href="#Sorting-Extracting-TableBody" class="headerlink" title="Sorting- Extracting TableBody"></a>Sorting- Extracting TableBody</h3><p>如法炮制，我们要封装表体</p>
<p>在common文件夹中新建 tableBody.jsx</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TableBody</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">  render() &#123;</span><br><span class="line">      <span class="comment">//解构从moviestable传过来的props</span></span><br><span class="line">    <span class="keyword">const</span> &#123; data, columns &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="comment">//生成表体，这里的data代表了movies，然后对于每一个movie，生成一行</span></span><br><span class="line">        <span class="comment">//在每一行中用渲染出每一列对应的数据</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        相当于把这些渲染出来</span></span><br><span class="line"><span class="comment">              &lt;td&gt;&#123;movie.title&#125;&lt;/td&gt;</span></span><br><span class="line"><span class="comment">              &lt;td&gt;&#123;movie.director&#125;&lt;/td&gt;</span></span><br><span class="line"><span class="comment">              &lt;td&gt;&#123;movie.actor&#125;&lt;/td&gt;</span></span><br><span class="line"><span class="comment">              &lt;td&gt;&#123;movie.time&#125;&lt;/td&gt;</span></span><br><span class="line"><span class="comment">              //.....</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">      &lt;tbody&gt;</span><br><span class="line">        &#123;data.map(<span class="function">(<span class="params">item</span>) =&gt;</span> (</span><br><span class="line">          &lt;tr&gt;</span><br><span class="line">            &#123;columns.map(<span class="function"><span class="params">column</span>=&gt;</span><span class="xml"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span>)&#125;</span><br><span class="line">          &lt;<span class="regexp">/tr&gt;</span></span><br><span class="line"><span class="regexp">        ))&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>tbody&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> TableBody;</span><br></pre></td></tr></table></figure>
<h3 id="Sorting-Rendering-Cell-Content"><a href="#Sorting-Rendering-Cell-Content" class="headerlink" title="Sorting- Rendering Cell Content"></a>Sorting- Rendering Cell Content</h3><p>现在我们对每一个<td\>标签渲染</td\></p>
<p>这里我们要用到lodash中的get方法_.get(item,column.path) 前面传入一个对象item，后面传入的目标属性是可以嵌套的，也就是说我们可以从item中提取出column.path来进行渲染</p>
<p>然后我们对moviesTable中的tbody进行修改,删除原来的行，并且把列和电影信息通过props传给表体</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;TableBody data=&#123;movies&#125; columns=&#123;<span class="keyword">this</span>.columns&#125; /&gt;</span><br></pre></td></tr></table></figure>
<p>但这样还是不够的，我们在上面定义的时候，like和delete两列只包含了key而没有具体的操作，如果我们盲目的把\<like \> 和 <button\> 标签删去，那么我们将失去这两个功能，所以我们要把这两个标签移动到columns数组中去。</button\></like></p>
<p>在这里需要理解一点，在jsx中编译的react元素实际上是JavaScript对象。比如说 const x=\<h1\><h1\> 那么这其实是一个对象，调用h1对象的jsx代码其实就是JavaScript对象。那么我们就可以对columns中的like和delete传入一个jsx表达式。实际上就是让渲染的时候，每一行都渲染出一个like对象和delete对象</h1\></h1\></p>
<p>那么问题又来了，我们如果直接复制到cotent后面，那么movie.liked中的movie实际上我们是没有定义的啊（本来是通过<em>movies.map((movie) =&gt; ()</em> 渲染的。所以我们还需要修改一下</p>
<p>我们把content设置成一个函数，传入movie，然后导出一个like对象和一个delete对象</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">columns = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">"title"</span>, <span class="attr">label</span>: <span class="string">"Title"</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">"director"</span>, <span class="attr">label</span>: <span class="string">"Director"</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">"actor"</span>, <span class="attr">label</span>: <span class="string">"Actors"</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">"country"</span>, <span class="attr">label</span>: <span class="string">"Country"</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">"index"</span>, <span class="attr">label</span>: <span class="string">"Range"</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">"sort"</span>, <span class="attr">label</span>: <span class="string">"Score"</span> &#125;,</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">"time"</span>, <span class="attr">label</span>: <span class="string">"Time"</span> &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    key: <span class="string">"like"</span>,</span><br><span class="line">    content: <span class="function"><span class="params">movie</span>=&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">Like</span> <span class="attr">liked</span>=<span class="string">&#123;movie.liked&#125;</span> <span class="attr">onClick</span>=<span class="string">&#123;()</span> =&gt;</span> this.props.onLike(movie)&#125; /&gt;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    key: <span class="string">"Delete"</span>,</span><br><span class="line">    content: <span class="function"><span class="params">movie</span>=&gt;</span>(</span><br><span class="line">      &lt;button onClick=&#123;() =&gt; <span class="keyword">this</span>.props.onDelete&#125; className=<span class="string">"btn btn-danger btn-sm"</span>&gt;</span><br><span class="line">        Delete</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">    ),</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">];</span></span><br></pre></td></tr></table></figure>
<p>现在我们要回到tableBody处理我们的渲染</p>
<p>为了代码简洁，我们在这里写一个函数renderCell，在td标签中调用renderCell。</p>
<p>这个函数的处理逻辑是这样，传入当前的item（电影信息），和column（当前列），然后我们看看这个列的content存在与否（我们知道只有like和delete存在）。</p>
<p>如果存在的话，那么就传入当前movie，让这个content渲染一个对象出来。</p>
<p>那么如果content不存在，我们就返回当前电影信息中名称等于column.path的属性</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">"lodash"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TableBody</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  renderCell = <span class="function">(<span class="params">item, column</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (column.content) <span class="keyword">return</span> column.content(item);</span><br><span class="line">    <span class="keyword">return</span> _.get(item, column.path);</span><br><span class="line">  &#125;;</span><br><span class="line">  state = &#123;&#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; data, columns &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;tbody&gt;</span><br><span class="line">        &#123;data.map(<span class="function">(<span class="params">item</span>) =&gt;</span> (</span><br><span class="line">          &lt;tr&gt;</span><br><span class="line">            &#123;columns.map(<span class="function">(<span class="params">column</span>) =&gt;</span> (</span><br><span class="line">              &lt;td&gt;&#123;<span class="keyword">this</span>.renderCell(item, column)&#125;&lt;<span class="regexp">/td&gt;</span></span><br><span class="line"><span class="regexp">            ))&#125;</span></span><br><span class="line"><span class="regexp">          &lt;/</span>tr&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;<span class="regexp">/tbody&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default TableBody;</span></span><br></pre></td></tr></table></figure>
<p>这就是我们的组件树了，代码的层次结构变得简单明了，这是我们始终追求的！</p>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/8.png" style="zoom:80%;"></p>
<h3 id="Sorting-Unique-Keys-Final"><a href="#Sorting-Unique-Keys-Final" class="headerlink" title="Sorting- Unique Keys - Final"></a>Sorting- Unique Keys - Final</h3><p>给每个迭代的标签加上单独键值，不需要多说</p>
<h3 id="Sorting-Adding-the-Sort-Icon"><a href="#Sorting-Adding-the-Sort-Icon" class="headerlink" title="Sorting- Adding the Sort Icon"></a>Sorting- Adding the Sort Icon</h3><p>加入一个箭头表示表示当前排序顺序，源码来自fontawesome（前提得npm啊！）</p>
<p>加在表头上 tablehead.jsx</p>
<p>如果当前的列不是被筛选列，那么我们就什么都不显示</p>
<p>如果是筛选列，那么如果是正序（asc),那就对应\<i class="fa fa-sort-asc">&lt;/i>;<i class="fa fa-sort-asc"></i>;</i></p>
<p>如果是逆序，那么就对应\<i classname="fa fa-sort-desc" \>&lt;/i><i classname="fa fa-sort-desc"></i></i></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  renderSortIcon = <span class="function">(<span class="params">column</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; sortColumn &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">if</span> (column.path !== <span class="keyword">this</span>.props.sortColumn.path) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (sortColumn.order === <span class="string">"asc"</span>) <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-sort-asc"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">i</span> <span class="attr">className</span>=<span class="string">"fa fa-sort-desc"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line">  &#125;;</span><br><span class="line">render() &#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">            &lt;th</span><br><span class="line">              key=&#123;column.path || column.key&#125;</span><br><span class="line">              onClick=&#123;() =&gt; <span class="keyword">this</span>.raiseSort(column.path)&#125;</span><br><span class="line">            &gt;</span><br><span class="line">              &#123;column.label&#125;</span><br><span class="line">              &#123;<span class="keyword">this</span>.renderSortIcon(column)&#125;</span><br><span class="line">            &lt;<span class="regexp">/th&gt;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/...</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/9.png" style="zoom:100%;"></p>
<h3 id="Sorting-Extracting-Table-封装表格组件"><a href="#Sorting-Extracting-Table-封装表格组件" class="headerlink" title="Sorting- Extracting Table    封装表格组件"></a>Sorting- Extracting Table    封装表格组件</h3><p>现在在我们的moviesTable组件当中，我们看到现在表中的组件</p>
<p>里面有一个表头组件，一个表体组件</p>
<p>我们可以再次优化，那就是吧这个表格抽象成一个组件，包含表头和表体</p>
<p>这样我们在movieTable中只要加入Table组件就可以了，movieTable用来做函数处理，剩下的结构都由子组件实现</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">   <span class="keyword">const</span> &#123; movies, onSort, sortColumn &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">     &lt;table className=<span class="string">"table"</span>&gt;</span><br><span class="line">       &lt;TableHeader</span><br><span class="line">         columns=&#123;<span class="keyword">this</span>.columns&#125;</span><br><span class="line">         sortColumn=&#123;sortColumn&#125;</span><br><span class="line">         onSort=&#123;onSort&#125;</span><br><span class="line">       /&gt;</span><br><span class="line">       &lt;TableBody data=&#123;movies&#125; columns=&#123;<span class="keyword">this</span>.columns&#125; /&gt;</span><br><span class="line">     &lt;<span class="regexp">/table&gt;</span></span><br><span class="line"><span class="regexp">   );</span></span><br><span class="line"><span class="regexp"> &#125;</span></span><br></pre></td></tr></table></figure>
<p>那么我们在common文件夹中新建一个table.jsx，把他创建成一个可以重复使用的表格组件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> TableHeader <span class="keyword">from</span> <span class="string">"./tableHead"</span>;</span><br><span class="line"><span class="keyword">import</span> TableBody <span class="keyword">from</span> <span class="string">"./tableBody"</span>;</span><br><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">const</span> Table = <span class="function">(<span class="params">props</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//解构props</span></span><br><span class="line">  <span class="keyword">const</span> &#123; columns, sortColum, onSort, data &#125; = props;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">      <span class="comment">//返回一张表所需要的部分：表头和表体</span></span><br><span class="line">    &lt;table className=<span class="string">"table"</span>&gt;</span><br><span class="line">      &lt;TableHeader</span><br><span class="line">        columns=&#123;columns&#125;</span><br><span class="line">        sortColumn=&#123;sortColumn&#125;</span><br><span class="line">        onSort=&#123;onSort&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;TableBody data=&#123;data&#125; columns=&#123;columns&#125; /&gt;</span><br><span class="line">    &lt;<span class="regexp">/table&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Table;</span></span><br></pre></td></tr></table></figure>
<p>这样我们在moviesTable的render中只要这样就可以了</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; movies, onSort, sortColumn &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">      <span class="comment">//像Table组件中传入他需要的props</span></span><br><span class="line">    &lt;Table</span><br><span class="line">      columns=&#123;<span class="keyword">this</span>.columns&#125;</span><br><span class="line">      data=&#123;movies&#125;</span><br><span class="line">      sortColumm=&#123;sortColumn&#125;</span><br><span class="line">      onSort=&#123;onSort&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>总结一下moviesTable组建的实现过程</p>
<p>这个组件定义了我们希望显示的列 columns，这个实现是针对电影的</p>
<p>在render中我渲染了一个Table组件，这个组件相当于一个Wrapper，他拥有这个表格所需要的所有数据</p>
<p>今后我如果想要渲染一个客户信息的表格，那么我需要做的只是重复利用这个表格组件，然后把我们想要渲染的列传进去就可以了</p>
<h3 id="Sorting-Extracting-a-Method"><a href="#Sorting-Extracting-a-Method" class="headerlink" title="Sorting- Extracting a Method"></a>Sorting- Extracting a Method</h3><p>我们现在的代码已经很简洁了，但是还是不完美在Movies组件中</p>
<p>因为我们写了很多行逻辑方法，filtered，sorted，movies=paginate(…) 那么我们现在把这些写成一个方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">getPagedData = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//先解构，重命名movies</span></span><br><span class="line">    <span class="keyword">const</span> &#123;</span><br><span class="line">      pageSize,</span><br><span class="line">      currentPage,</span><br><span class="line">      sortColumn,</span><br><span class="line">      selectedGenre,</span><br><span class="line">      movies: allMovies,</span><br><span class="line">    &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">	<span class="comment">// 里面封装我选择、排序的逻辑</span></span><br><span class="line">    <span class="comment">//这个选择器和老师的不太一样，因为我的数据库是自己爬取下来的豆瓣Top250。</span></span><br><span class="line">    <span class="keyword">const</span> filtered =</span><br><span class="line">      selectedGenre &amp;&amp; selectedGenre._id</span><br><span class="line">        ? allMovies.filter(<span class="function">(<span class="params">movie</span>)=&gt;</span><span class="keyword">this</span>.inSort(movie, selectedGenre))</span><br><span class="line">        : allMovies;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> sorted = _.orderBy(filtered, [sortColumn.path], [sortColumn.order]);</span><br><span class="line">    <span class="keyword">const</span> movies = paginate(sorted, currentPage, pageSize);</span><br><span class="line">	<span class="comment">// 把filtered.length当作totalCount，movies当作data，然后当成一个对象返回</span></span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">totalCount</span>: filtered.length, <span class="attr">data</span>: movies &#125;;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<p>在render中</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"> render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">length</span>: count &#125; = <span class="keyword">this</span>.state.movies;</span><br><span class="line">    <span class="keyword">const</span> &#123; pageSize, currentPage, sortColumn &#125; = <span class="keyword">this</span>.state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (count === <span class="number">0</span>) <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>There are no movies in the database.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line"><span class="comment">//用一个对象来接收getPageData 返回的数据，其中data还原成movies，为了直观</span></span><br><span class="line">    <span class="keyword">const</span> &#123; totalCount, <span class="attr">data</span>: movies &#125; = <span class="keyword">this</span>.getPagedData();</span><br><span class="line"><span class="comment">//把下面的filter.count 全部替换成totalCount，movies照常(因为我们把data有命名为movie)</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div className=<span class="string">"row"</span>&gt;</span><br><span class="line">        &lt;div className=<span class="string">"col-3"</span>&gt;</span><br><span class="line">          &lt;ListGroup</span><br><span class="line">            items=&#123;<span class="keyword">this</span>.state.genres&#125;</span><br><span class="line">            selectedItem=&#123;<span class="keyword">this</span>.state.selectedGenre&#125;</span><br><span class="line">            onItemSelect=&#123;<span class="keyword">this</span>.handleGenreSelect&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;div className="col"&gt;</span></span><br><span class="line"><span class="regexp">          &lt;p&gt;Showing &#123;totalCount&#125; movies in the database.&lt;/</span>p&gt;</span><br><span class="line">          &lt;MoviesTable</span><br><span class="line">            movies=&#123;movies&#125;</span><br><span class="line">            sortColumn=&#123;sortColumn&#125;</span><br><span class="line">            onLike=&#123;<span class="keyword">this</span>.handleLike&#125;</span><br><span class="line">            onDelete=&#123;<span class="keyword">this</span>.handleDelete&#125;</span><br><span class="line">            onSort=&#123;<span class="keyword">this</span>.handleSort&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">          &lt;Pagination</span><br><span class="line">            itemsCount=&#123;totalCount&#125;</span><br><span class="line">            pageSize=&#123;pageSize&#125;</span><br><span class="line">            currentPage=&#123;currentPage&#125;</span><br><span class="line">            onPageChange=&#123;<span class="keyword">this</span>.handlePageChange&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Destructuring-Arguments"><a href="#Destructuring-Arguments" class="headerlink" title="Destructuring Arguments"></a>Destructuring Arguments</h3><p>common文件夹下面的都是受控组件，我们没有必要再另写一行代码解构props</p>
<p>我们可以这么做</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//直接把属性名称写在括号内，就相当于在参数props中挑出了这些属性，然后直接=&gt;&#123;&#125; 即可</span></span><br><span class="line"><span class="keyword">const</span> Table = <span class="function">(<span class="params">&#123; columns, sortColumn, onSort, data &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>同样我们对其他的组件也相应改变</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">const</span> ListGroup = (&#123;</span><br><span class="line">  items,</span><br><span class="line">  textProperty,</span><br><span class="line">  valueProperty,</span><br><span class="line">  selectedItem,</span><br><span class="line">  onItemSelect</span><br><span class="line">&#125;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>…</p>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p> <img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/10.png" style="zoom:80%;"></p>
<h2 id="Routing"><a href="#Routing" class="headerlink" title="Routing"></a>Routing</h2><h3 id="Introduction-1"><a href="#Introduction-1" class="headerlink" title="Introduction"></a>Introduction</h3><p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/12.png" style="zoom:80%;"></p>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/11.png" style="zoom:80%;"></p>
<h3 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h3><p><a href="https://www.bilibili.com/video/BV1Sb411P79t?p=91" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1Sb411P79t?p=91</a></p>
<p>教程</p>
<p><a href="https://www.filepicker.io/api/file/zceY1kIhS66M1jfqd9Gu" target="_blank" rel="noopener">https://www.filepicker.io/api/file/zceY1kIhS66M1jfqd9Gu</a></p>
<p>下载</p>
<h3 id="Adding-Routing"><a href="#Adding-Routing" class="headerlink" title="Adding Routing"></a>Adding Routing</h3><p>添加插件：npm install react-router-dom@4.3.1</p>
<p>在index.js中做如下修改</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="comment">//引入BrowserRouter</span></span><br><span class="line"><span class="keyword">import</span> &#123; BrowserRouter &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line">ReactDOM.render(</span><br><span class="line">    <span class="comment">//用这个标签涵盖App，这样App中的组件就可以用路由了</span></span><br><span class="line">    <span class="comment">//BrewserRouter记录了浏览器的历史，并传入了各组件树的成员</span></span><br><span class="line">  &lt;BrowserRouter&gt;</span><br><span class="line">    &lt;App /&gt;</span><br><span class="line">  &lt;<span class="regexp">/BrowserRouter&gt;,</span></span><br><span class="line"><span class="regexp">  document.getElementById("root")</span></span><br><span class="line"><span class="regexp">);</span></span><br><span class="line"><span class="regexp">registerServiceWorker();</span></span><br></pre></td></tr></table></figure>
<p>然后再app.js中做如下修改</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入 Route</span></span><br><span class="line"><span class="keyword">import</span> &#123; Route &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;NavBar /&gt;</span><br><span class="line">        &lt;div className=<span class="string">"content"</span>&gt;</span><br><span class="line">            &#123;<span class="comment">/*</span></span><br><span class="line"><span class="comment">            我想要根据现在的URL渲染 给定的组件。这就是我们使用路由组件的地方</span></span><br><span class="line"><span class="comment">            接下来我们就注册一些路由，这个路由很想我们之前创建的组件，这些属性将作为props传递</span></span><br><span class="line"><span class="comment">            path代表地址，component就是路由的组件</span></span><br><span class="line"><span class="comment">            如果网页匹配了这个地址，那么他就会渲染出这个组件</span></span><br><span class="line"><span class="comment">            */</span>&#125;</span><br><span class="line">          &lt;Route path=<span class="string">"/products"</span> component=&#123;Products&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">"/posts"</span> component=&#123;Posts&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">"/admin"</span> component=&#123;Dashboard&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">"/"</span> component=&#123;Home&#125; /&gt;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/3.gif" style="zoom:80%;"></p>
<p>但是我们看到了当其他组件产生的时候，Home组件始终存在，这是为什么？</p>
<h3 id="Switch"><a href="#Switch" class="headerlink" title="Switch"></a>Switch</h3><p>router的检测算法，会检测当前的地址是否以给定的字符串开始，如果是，那么后面的组件就会被渲染。</p>
<p>也就是说 <a href="http://localhost:3000/products/news,这时候news，products，home会同时被渲染" target="_blank" rel="noopener">http://localhost:3000/products/news,这时候news，products，home会同时被渲染</a></p>
<p>要解决这方法，我们可以利用exact属性</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">"/"</span> exact component=&#123;Home&#125; /&gt;</span><br></pre></td></tr></table></figure>
<p>h或者利用Switch组件,用Switch 标签囊括所有的Route</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Route,Switch &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"> 		&lt;div className=<span class="string">"content"</span>&gt;</span><br><span class="line"> 		&lt;Switch&gt;</span><br><span class="line">          &lt;Route path=<span class="string">"/products"</span> component=&#123;Products&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">"/posts"</span> component=&#123;Posts&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">"/admin"</span> component=&#123;Dashboard&#125; /&gt;</span><br><span class="line">          &lt;Route path=<span class="string">"/"</span> component=&#123;Home&#125; /&gt;</span><br><span class="line">        &lt;<span class="regexp">/Switch&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br></pre></td></tr></table></figure>
<p>现在，问题已经解决了</p>
<h3 id="Link"><a href="#Link" class="headerlink" title="Link"></a>Link</h3><p>现在的情况就是，当我们点击一个链接的时候，我们会把整个页面全部重载，但是这样在大型程序中这样会非常慢，所以我们需要在点击的时候只重载需要重载的部分而不是整个页面。这个叫做单一页面程序。</p>
<p>我们需要Link组件来达成这个功能</p>
<p>在navbar.js中，我们做了以下修改</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="comment">//导入 Link 组件</span></span><br><span class="line"><span class="comment">// 把下面的 a 标签全换成 Link，把href全换成to</span></span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"><span class="keyword">const</span> NavBar = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li&gt;</span><br><span class="line">        &lt;Link to=<span class="string">"/"</span>&gt;Home&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>li&gt;</span><br><span class="line">      &lt;li&gt;</span><br><span class="line">        &lt;Link to=<span class="string">"/products"</span>&gt;Products&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>li&gt;</span><br><span class="line">      &lt;li&gt;</span><br><span class="line">        &lt;Link to=<span class="string">"/posts/2018/06"</span>&gt;Posts&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>li&gt;</span><br><span class="line">      &lt;li&gt;</span><br><span class="line">        &lt;Link to=<span class="string">"/admin"</span>&gt;Admin&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>li&gt;</span><br><span class="line">    &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default NavBar;</span></span><br></pre></td></tr></table></figure>
<p>然后，我们发现点击的时候并没有更新整个页面。因为这些页面的内容已经在一个叫做bundle的文件当中了</p>
<p>看到我们的Home组件，只是个简单的js函数而已。所有的组件都是bundle的一部分代码，在初始的 时候已经下载了，所以在用户更换页面的时候没有重新下载</p>
<h3 id="Route-Props"><a href="#Route-Props" class="headerlink" title="Route Props"></a>Route Props</h3><p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/13.png" style="zoom:80%;"></p>
<p>我们发现products有很多props，但是我们并没有传入这些props</p>
<p>这就是Route组件的功劳了，本质上Route组件时传入component属性组件的wrapper，所有在加载自身的props的时候，还会自动加上这三个props</p>
<p>history属性时浏览器的history对象，可以去往不同页面，location属性表示了现在在哪里，里面有很多属性</p>
<p>match则展现了我们的URL时如何匹配的，里面也有很多属性‘</p>
<p>通过阅读文档加以了解</p>
<p><a href="https://reacttraining.com/react-router/core/guides/philosophy" target="_blank" rel="noopener">https://reacttraining.com/react-router/core/guides/philosophy</a></p>
<h3 id="Passing-Props"><a href="#Passing-Props" class="headerlink" title="Passing Props"></a>Passing Props</h3><p>我们怎么传递其他的props呢？</p>
 <figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route</span><br><span class="line">  path=<span class="string">"/products"</span></span><br><span class="line">  render=&#123;() =&gt; <span class="xml"><span class="tag">&lt;<span class="name">Products</span> <span class="attr">sortBy</span>=<span class="string">"newest"</span> /&gt;</span></span>&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<p>我们可以改写成这样</p>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/14.png" style="zoom:80%;"></p>
<p>但是这样的话那三个默认的属性就不见了。为了修正这个问题我们需要在箭头函数中加入props</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route</span><br><span class="line">  path=<span class="string">"/products"</span></span><br><span class="line">  render=&#123;(props) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">Products</span> <span class="attr">sortBy</span>=<span class="string">"newest"</span> &#123;<span class="attr">...pros</span>&#125;/&gt;</span></span>&#125;</span><br><span class="line">    <span class="comment">//这里运用了特殊的jsx语法。通过spread，所有的props属性都会展开</span></span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/15.png" style="zoom:80%;"></p>
<h3 id="Route-Parameters"><a href="#Route-Parameters" class="headerlink" title="Route Parameters"></a>Route Parameters</h3><p>有时候我们需要给路由传递参数。比如说我们选择不同的商品，会在URL上显示不同的产品id；这就是路由参数</p>
<p><a href="http://localhost:3000/products/3" target="_blank" rel="noopener">http://localhost:3000/products/3</a></p>
<p><a href="http://localhost:3000/products/2" target="_blank" rel="noopener">http://localhost:3000/products/2</a></p>
<p><a href="http://localhost:3000/products/1" target="_blank" rel="noopener">http://localhost:3000/products/1</a></p>
<p>我们首先在App中定义一个新的产品详情页面/后面是可以加参数的地方，我们这里是:id。为了定义参数我们需要在参数面前加上冒号，然后这个组件属性写称ProductDetails</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">"/products/:id"</span> component=&#123;ProductDetails&#125;/&gt;</span><br><span class="line"><span class="comment">//我们也可以定义多个参数</span></span><br><span class="line">&lt;Route path=<span class="string">"/posts/:year/:month"</span> component=&#123;Posts&#125; /&gt;</span><br></pre></td></tr></table></figure>
<p>productDetails.jsx</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductDetails</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  handleSave = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Navigate to /products</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">           &#123;<span class="comment">/* 动态渲染当前的id */</span>&#125;</span><br><span class="line">        &lt;h1&gt;Product Details -&#123;<span class="keyword">this</span>.props.match.params.id&#125; &lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;this.handleSave&#125;&gt;Save&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default ProductDetails;</span></span><br></pre></td></tr></table></figure>
<h3 id="Optional-Parameters"><a href="#Optional-Parameters" class="headerlink" title="Optional Parameters"></a>Optional Parameters</h3><p>点击Posts的按钮显示的连接如下</p>
<p><a href="http://localhost:3000/posts/2018/06" target="_blank" rel="noopener">http://localhost:3000/posts/2018/06</a></p>
<p>如果只保留年，那么却显示home，这是为什么？</p>
<p><a href="http://localhost:3000/posts/2018" target="_blank" rel="noopener">http://localhost:3000/posts/2018</a></p>
<p>因为我们在定义路由的参数时默认情况时必须都要满足,这里我们年月都需要有才能匹配</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">"/posts/:year/:month"</span> component=&#123;Posts&#125; /&gt;</span><br></pre></td></tr></table></figure>
<p>那么怎么才能让月份变得可选？那么我们就需要这样写</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">"/posts/:year?/:month?"</span> component=&#123;Posts&#125; /&gt;</span><br></pre></td></tr></table></figure>
<p>这是JavaScript中的正则表达式，如果在这之前加入一个问号，那么这个参数就是可选的</p>
<p>回到post我们渲染这个年份和月份</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Posts = <span class="function">(<span class="params">&#123; match &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;Posts&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      Year: &#123;match.params.year&#125;, Month:&#123;match.params.month&#125;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Posts;</span><br></pre></td></tr></table></figure>
<p>当url=<a href="http://localhost:3000/posts的时候" target="_blank" rel="noopener">http://localhost:3000/posts的时候</a></p>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/16.png" style="zoom:80%;"></p>
<p>当url=<a href="http://localhost:3000/posts/2018的时候" target="_blank" rel="noopener">http://localhost:3000/posts/2018的时候</a></p>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/17.png" style="zoom:80%;"></p>
<h3 id="Query-String-Parameters"><a href="#Query-String-Parameters" class="headerlink" title="Query String Parameters"></a>Query String Parameters</h3><p>我们说可选参数需要尽量避免。与其在路由中使用可选参数，不如在查询字符串当中使用</p>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/18.png" style="zoom:80%;"></p>
<p>比如说我传入上面一个url，在react当中我们需要读取这个字符串的意思</p>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/19.png" style="zoom:80%;"></p>
<p>也就是search 属性后面的字符串，我们需要下载插件来完成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install query-string@6.1.0</span><br></pre></td></tr></table></figure>
<p>然后我们在posts.jsx中做如下改动</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> queryString <span class="keyword">from</span> <span class="string">'query-string'</span></span><br><span class="line"><span class="comment">//解构 location,也就是上面那个props</span></span><br><span class="line"><span class="keyword">const</span> Posts = <span class="function">(<span class="params">&#123; match,location &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> result= queryString.parse( location.search);</span><br><span class="line">  <span class="built_in">console</span>.log(result);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;Posts&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      Year: &#123;match.params.year&#125;, Month:&#123;match.params.month&#125;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Posts;</span><br></pre></td></tr></table></figure>
<p>打印结果如下：</p>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/20.png" style="zoom:80%;"></p>
<h3 id="Redirects-跳转"><a href="#Redirects-跳转" class="headerlink" title="Redirects 跳转"></a>Redirects 跳转</h3><p>我现在向让不存在的url跳转到404 Not Found 而不是Home页面，怎么办?</p>
<p>首先在home这个router中加入exact修饰</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">"/"</span> exact component=&#123;Home&#125; /&gt;</span><br></pre></td></tr></table></figure>
<p>然后从react-router-dom 中解构Redirect</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Route, Switch ,Redirect&#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br></pre></td></tr></table></figure>
<p>然后对return的内容进行修改</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;NavBar /&gt;</span><br><span class="line">        &lt;div className=<span class="string">"content"</span>&gt;</span><br><span class="line">          &lt;Switch&gt;</span><br><span class="line">            &lt;Route path=<span class="string">"/products/:id"</span> component=&#123;ProductDetails&#125; /&gt;</span><br><span class="line">            &lt;Route</span><br><span class="line">              path=<span class="string">"/products"</span></span><br><span class="line">              render=&#123;(props) =&gt; <span class="xml"><span class="tag">&lt;<span class="name">Products</span> <span class="attr">sortBy</span>=<span class="string">"newest"</span> &#123;<span class="attr">...props</span>&#125; /&gt;</span></span>&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">              &#123;<span class="comment">/* 首先加入一个not-found链接*/</span>&#125;</span><br><span class="line">            &lt;Route path=<span class="string">"/not-found"</span> component=&#123;NotFound&#125; /&gt;</span><br><span class="line">            &lt;Route path=<span class="string">"/posts/:year?/:month?"</span> component=&#123;Posts&#125; /&gt;</span><br><span class="line">            &lt;Route path=<span class="string">"/admin"</span> component=&#123;Dashboard&#125; /&gt;</span><br><span class="line">            &lt;Route path=<span class="string">"/"</span> exact component=&#123;Home&#125; /&gt;</span><br><span class="line">              &#123;<span class="comment">/*Redirect标签代表了如果都没有匹配到，那么就去to所代表的页面*/</span>&#125;</span><br><span class="line">            &lt;Redirect to=<span class="string">"/not-found"</span> /&gt;</span><br><span class="line">          &lt;<span class="regexp">/Switch&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>div&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br></pre></td></tr></table></figure>
<p>如果有时候我想把网页上的资源从一页转移到另外一页上去，我们用 Redirect from to实现。比如说我添加</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Redirect <span class="keyword">from</span>=<span class="string">"/messages"</span> to=<span class="string">"/posts"</span> /&gt;</span><br></pre></td></tr></table></figure>
<p>那么我们在浏览器输入messages的时候就会自动跳转到posts页面上去</p>
<h3 id="Programmatic-Navigation"><a href="#Programmatic-Navigation" class="headerlink" title="Programmatic Navigation"></a>Programmatic Navigation</h3><p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/21.png" style="zoom:80%;"></p>
<p>现在当我们点击保存按钮的时候，我们将用户转回列表页，这就是Programmatic Navigation。那么该如何操作？</p>
<p>这涉及到props.history中的连个属性：push 和 replace</p>
<p>这两个差别在于push会向浏览器添加历史地址，所以我可以通过后退按钮回到上一个页面。而replace是替换当前的页面，所以没有历史记录</p>
<p>如果在productsDetails.jsx中的handleSave方法中这样实现</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">handleSave = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Navigate to /products</span></span><br><span class="line">  <span class="keyword">this</span>.props.history.push(<span class="string">"/products"</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>那么在浏览器中，我们点击save按钮，回到produts目录页面。如果点击浏览器的返回，那么仍然返回到save页面。</p>
<p>那么如果我这样实现</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">handleSave = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// Navigate to /products</span></span><br><span class="line">  <span class="keyword">this</span>.props.history.replace(<span class="string">"/products"</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>那么我们将无法返回。这就是很多登陆页面做的逻辑，我们一旦登陆后就无法回到登陆时候的页面了</p>
<h3 id="Nested-Routing-嵌套路由"><a href="#Nested-Routing-嵌套路由" class="headerlink" title="Nested Routing 嵌套路由"></a>Nested Routing 嵌套路由</h3><p>我们想要在点击Admin的时候在弹出两个链接，一个是posts，一个是users 这就是嵌套路由了</p>
<p>我们先进入到dashboard.jsx，里面引入一个sidebar.jsx</p>
<p>sidebar.jsx代码如下</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> Users <span class="keyword">from</span> <span class="string">"./users"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SideBar = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &lt;li&gt;</span><br><span class="line">        &lt;Link to=<span class="string">"/admin/posts"</span>&gt;Posts&lt;<span class="regexp">/Link&gt;&#123;/</span>*点击Posts进行跳转*<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>li&gt;</span><br><span class="line">      &lt;li&gt;</span><br><span class="line">        &lt;Link to=<span class="string">"/admin/users"</span>&gt;Users&lt;<span class="regexp">/Link&gt;&#123;/</span>*点击Users进行跳转*<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>li&gt;</span><br><span class="line">    &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default SideBar;</span></span><br></pre></td></tr></table></figure>
<p>然后呢在dashboard.jsx中引入该引入的users,posts 文件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">const</span> Dashboard = <span class="function">(<span class="params">&#123; match &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;Admin Dashboard&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;SideBar /</span>&gt;</span><br><span class="line">          &#123;<span class="comment">/*引入Route组件，当链接为...时，渲染...组件*/</span>&#125;</span><br><span class="line">      &lt;Route path=<span class="string">"/admin/posts"</span> component=&#123;Posts&#125; /&gt;</span><br><span class="line">      &lt;Route path=<span class="string">"/admin/users"</span> component=&#123;Users&#125; /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Dashboard;</span></span><br></pre></td></tr></table></figure>
<h3 id="Exercises-NavBar-and-Routing"><a href="#Exercises-NavBar-and-Routing" class="headerlink" title="Exercises- NavBar and Routing"></a>Exercises- NavBar and Routing</h3><p>达到这个效果</p>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/12.png" style="zoom:80%;"></p>
<h3 id="Adding-React-Router"><a href="#Adding-React-Router" class="headerlink" title="Adding React Router"></a>Adding React Router</h3><p>首先在vidly文件夹下安装rrd</p>
<p>在index.js中 引入，包裹……</p>
<p>现在新建了几个组件，Customers，MovieForm，Rentals，NotFound，格式如下</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">const</span> MovieForm = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>MovieForm<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MovieForm</span><br></pre></td></tr></table></figure>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/22.png" style="zoom:80%;"></p>
<h3 id="Adding-Routes"><a href="#Adding-Routes" class="headerlink" title="Adding Routes"></a>Adding Routes</h3><p>在App.jsx中这样写路由</p>
<p>默认显示movies页面，如果未匹配，那么就跳转到notFound``</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;main className=<span class="string">"container"</span>&gt;</span><br><span class="line">        &lt;Switch&gt;</span><br><span class="line">        &lt;Route path=<span class="string">"/movies"</span> component=&#123;Movies&#125;&gt;&lt;<span class="regexp">/Route&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Route path="/</span>customers<span class="string">" component=&#123;Customers&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">        &lt;Route path="</span>/rentals<span class="string">" component=&#123;Rentals&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">        &lt;Route path="</span>/not-found<span class="string">" component=&#123;NotFound&#125;&gt;&lt;/Route&gt;</span></span><br><span class="line"><span class="string">        &lt;Redirect from="</span>/<span class="string">"exact to="</span>movies<span class="string">"/&gt;</span></span><br><span class="line"><span class="string">        &lt;Redirect to="</span>/not-found<span class="string">"/&gt;</span></span><br><span class="line"><span class="string">        &lt;/Switch&gt;</span></span><br><span class="line"><span class="string">      &lt;/main&gt;</span></span><br><span class="line"><span class="string">    );</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="Adding-the-NavBar"><a href="#Adding-the-NavBar" class="headerlink" title="Adding the NavBar"></a>Adding the NavBar</h3><p>从bootstrap上拷贝NavBar代码下来，新建一个NavBar 组件</p>
<p>把a全换成NavLink，除了第一个NavBar之外，这样标签就会自动调整样式，把href都换成 to，然后把地址，名称都渲染上去</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Link, NavLink &#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>;</span><br><span class="line"><span class="keyword">import</span> Movies <span class="keyword">from</span> <span class="string">"./movies"</span>;</span><br><span class="line"><span class="keyword">import</span> Customers <span class="keyword">from</span> <span class="string">"./customers"</span>;</span><br><span class="line"><span class="keyword">import</span> Rentals <span class="keyword">from</span> <span class="string">"./rentals"</span>;</span><br><span class="line"><span class="keyword">const</span> NavBar = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;nav className=<span class="string">"navbar navbar-expand-lg navbar-light bg-light"</span>&gt;</span><br><span class="line">      &lt;Link className=<span class="string">"navbar-brand"</span> to=<span class="string">"#"</span>&gt;</span><br><span class="line">        Navbar</span><br><span class="line">      &lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button</span></span><br><span class="line"><span class="regexp">        className="navbar-toggler"</span></span><br><span class="line"><span class="regexp">        type="button"</span></span><br><span class="line"><span class="regexp">        data-toggle="collapse"</span></span><br><span class="line"><span class="regexp">        data-target="#navbarNav"</span></span><br><span class="line"><span class="regexp">        aria-controls="navbarNav"</span></span><br><span class="line"><span class="regexp">        aria-expanded="false"</span></span><br><span class="line"><span class="regexp">        aria-label="Toggle navigation"</span></span><br><span class="line"><span class="regexp">      &gt;</span></span><br><span class="line"><span class="regexp">        &lt;span className="navbar-toggler-icon"&gt;&lt;/</span>span&gt;</span><br><span class="line">      &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div className="collapse navbar-collapse" id="navbarNav"&gt;</span></span><br><span class="line"><span class="regexp">        &lt;ul className="navbar-nav"&gt;</span></span><br><span class="line"><span class="regexp">          &lt;li className="nav-item "&gt;</span></span><br><span class="line"><span class="regexp">            &lt;NavLink className="nav-link" to="/m</span>ovies<span class="string">"&gt;</span></span><br><span class="line"><span class="string">              Movies &lt;span className="</span>sr-only<span class="string">"&gt;(current)&lt;/span&gt;</span></span><br><span class="line"><span class="string">            &lt;/NavLink&gt;</span></span><br><span class="line"><span class="string">          &lt;/li&gt;</span></span><br><span class="line"><span class="string">          &lt;li className="</span>nav-item<span class="string">"&gt;</span></span><br><span class="line"><span class="string">            &lt;NavLink className="</span>nav-link<span class="string">" to="</span>/customers<span class="string">"&gt;</span></span><br><span class="line"><span class="string">              Customers</span></span><br><span class="line"><span class="string">            &lt;/NavLink&gt;</span></span><br><span class="line"><span class="string">          &lt;/li&gt;</span></span><br><span class="line"><span class="string">          &lt;li className="</span>nav-item<span class="string">"&gt;</span></span><br><span class="line"><span class="string">            &lt;NavLink className="</span>nav-link<span class="string">" to="</span>/rentals<span class="string">"&gt;</span></span><br><span class="line"><span class="string">              Rentals</span></span><br><span class="line"><span class="string">            &lt;/NavLink&gt;</span></span><br><span class="line"><span class="string">          &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">      &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;/nav&gt;</span></span><br><span class="line"><span class="string">  );</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default NavBar;</span></span><br></pre></td></tr></table></figure>
<h3 id="Linking-to-the-MovieForm"><a href="#Linking-to-the-MovieForm" class="headerlink" title="Linking to the MovieForm"></a>Linking to the MovieForm</h3><p>连接到MovieForm，也就是给表格内容添加链接。</p>
<p>首先在MoviesTable的列中添加content内容,也就是说在渲染的时候，tableBody会渲染出一个Link组件。to属性就是我们渲染的文本模板，我们用它来动态添加字符</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// import&#123; Link &#125;from "react-router-dom";</span></span><br><span class="line">columns = [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">"title"</span>,</span><br><span class="line">      label: <span class="string">"Title"</span>,</span><br><span class="line">      content: <span class="function">(<span class="params">movie</span>) =&gt;</span> (</span><br><span class="line">        &lt;Link to=&#123;<span class="string">`/movies/<span class="subst">$&#123;movie._id&#125;</span>`</span>&#125;&gt;&#123;movie.title&#125;&lt;<span class="regexp">/Link&gt;</span></span><br><span class="line"><span class="regexp">      ),</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">   /</span><span class="regexp">/...</span></span><br><span class="line"><span class="regexp">  ];</span></span><br></pre></td></tr></table></figure>
<p>现在只完成了第一步，就是当我们点击电影的时候，网页链接后面会显示该电影id</p>
<p>如 <a href="http://localhost:3000/movies/5b21ca3eeb7f6fbccd47181a" target="_blank" rel="noopener">http://localhost:3000/movies/5b21ca3eeb7f6fbccd47181a</a></p>
<p>现在我们需要在App.js中加一条Route</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">"/movies/:id"</span> component=&#123;MovieForm&#125;&gt;&lt;<span class="regexp">/Route&gt;</span></span><br></pre></td></tr></table></figure>
<p>最后我们需要在MovieForm中动态渲染出当前电影的id,利用match属性中的id来渲染当前的电影id，再添加一个回退按钮，利用history.push 中记录着的历史记录来实现</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; saveMovie &#125; <span class="keyword">from</span> <span class="string">"./../services/fakeMovieService"</span>;</span><br><span class="line"><span class="keyword">const</span> MovieForm = <span class="function">(<span class="params">&#123; match, history &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;MovieForm &#123;match.params.id&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;button</span></span><br><span class="line"><span class="regexp">        className="btn btn-primarty"</span></span><br><span class="line"><span class="regexp">        onClick=&#123;() =&gt; history.push("/m</span>ovies<span class="string">")&#125;</span></span><br><span class="line"><span class="string">      &gt;</span></span><br><span class="line"><span class="string">        saveMovie</span></span><br><span class="line"><span class="string">      &lt;/button&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">  );</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">export default MovieForm;</span></span><br></pre></td></tr></table></figure>
<p>现在我把自己做的豆瓣表格也通过这种方式加入到了NavBar当中去了</p>
<p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/23.png" style="zoom:40%;"></p>
<h3 id="Summary-1"><a href="#Summary-1" class="headerlink" title="Summary"></a>Summary</h3><p><img src="/2020/06/02/react%E5%9F%BA%E7%A1%802/24.png" style="zoom:40%;"></p>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/" itemprop="url">幂级数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-05-31T23:16:00+08:00">
                2020-05-31
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2020-09-08T12:36:36+08:00">
                2020-09-08
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="幂级数"><a href="#幂级数" class="headerlink" title="幂级数"></a>幂级数</h1><h2 id="函数项级数的概念"><a href="#函数项级数的概念" class="headerlink" title="函数项级数的概念"></a>函数项级数的概念</h2><p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/1.png" style="zoom: 60%;"></p>
<p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/2.png" style="zoom: 60%;"></p>
<h3 id="例子："><a href="#例子：" class="headerlink" title="例子："></a>例子：</h3><p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/3.png" style="zoom: 60%;"></p>
<h2 id="幂级数及其收敛性"><a href="#幂级数及其收敛性" class="headerlink" title="幂级数及其收敛性"></a>幂级数及其收敛性</h2><p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/4.png" style="zoom: 60%;"></p>
<h3 id="Abel-定理"><a href="#Abel-定理" class="headerlink" title="Abel 定理"></a>Abel 定理</h3><p>$a_n$ 没有限定！</p>
<p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/5.png" style="zoom: 60%;"></p>
<p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/6.png" style="zoom: 60%;"></p>
<p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/7.png" style="zoom: 60%;"></p>
<p>因为在 $|x|&lt;|x_0|$ 的时候，幂级数是绝对收敛的，所以说条件收敛的点只可能是端点！</p>
<h3 id="定理二"><a href="#定理二" class="headerlink" title="定理二"></a>定理二</h3><p>$\Sigma<em>{n=0}^\infty a_nx^n$ 的收敛半径为$R =  \lim\limits</em>{n\rightarrow \infty} |\frac{a<em>n}{a</em>{n+1}}|$ </p>
<h3 id="例题："><a href="#例题：" class="headerlink" title="例题："></a>例题：</h3><p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/10.png" style="zoom: 60%;"></p>
<p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/11.png" style="zoom: 60%;"></p>
<h3 id="非标准型"><a href="#非标准型" class="headerlink" title="非标准型"></a>非标准型</h3><p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/12.png" style="zoom: 60%;"></p>
<h2 id="幂级数的运算"><a href="#幂级数的运算" class="headerlink" title="幂级数的运算"></a>幂级数的运算</h2><p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/12.png" style="zoom: 60%;"></p>
<h3 id="定理3"><a href="#定理3" class="headerlink" title="定理3"></a>定理3</h3><p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/13.png" style="zoom: 60%;"></p>
<p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/14.png" style="zoom: 60%;"></p>
<h3 id="定理4"><a href="#定理4" class="headerlink" title="定理4"></a>定理4</h3><p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/15.png" style="zoom: 60%;"></p>
<p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/16.png" style="zoom: 60%;"></p>
<h2 id="题型"><a href="#题型" class="headerlink" title="题型"></a>题型</h2><h3 id="收敛区间问题"><a href="#收敛区间问题" class="headerlink" title="收敛区间问题"></a>收敛区间问题</h3><p>首先拿到题目看看他是标准型还是非标准型</p>
<h4 id="如果是标准型"><a href="#如果是标准型" class="headerlink" title="如果是标准型"></a>如果是标准型</h4><p>那么计算<img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/21.png" style="zoom: 160%;">其中$a_n$是系数</p>
<p>计算出了R的值以后，我们就得到了收敛半径。但是我们仍需要验证端点。</p>
<p><strong>验证方法</strong></p>
<p>把端点带入，因为左右端点导致的结果可能不相同，所以需要分类讨论</p>
<p>端点带入后得到一个常数项级数，然后利用定义(趋向无穷是否等于0)或者常数项级数审敛法来判断是否收敛。</p>
<p>如果收敛那么就取闭，否则取开。</p>
<h4 id="如果是非标准型"><a href="#如果是非标准型" class="headerlink" title="如果是非标准型"></a>如果是非标准型</h4><p>那么就回到常数项级数审敛法，判断该用哪个审敛法：</p>
<p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/20.png" style="zoom: 160%;"></p>
<p>用完以后我们会得到一个带着x的式子，一般是$x^2$ 然后我们需要求这个式子等于1 的解，为什么？ 因为利用比值审敛法和根值审敛法得到的$\rho$ 都需要和1进行判断。</p>
<p>然后我们就解出x，这时候x就是端点。然后我们需要对端点带入进行判断验证</p>
<p>端点代入后得到一个常数项级数，然后利用定义(趋向无穷是否等于0)或者常数项级数审敛法来判断是否收敛。</p>
<h4 id="变量代换"><a href="#变量代换" class="headerlink" title="变量代换"></a>变量代换</h4><p>当形式不是$x^n$ 而是 $(ax+b)^n$ 形的时候，需要用一个变量代换。然后再按照上面的步骤解题</p>
<h3 id="和函数问题"><a href="#和函数问题" class="headerlink" title="和函数问题"></a>和函数问题</h3><p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/26.png" style="zoom: 67%;"></p>
<p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/27.png" style="zoom: 67%;"></p>
<p><strong>两个新的级数对应的收敛半径与原级数相同</strong></p>
<h4 id="解题步骤："><a href="#解题步骤：" class="headerlink" title="解题步骤："></a>解题步骤：</h4><ol>
<li>先求收敛半径-&gt;求得收敛区间</li>
<li>求和函数<ol>
<li>求导</li>
<li>积分</li>
<li>列项</li>
<li>题除公因子</li>
<li>化为等比数列后求和/或者化成常见的泰勒展开后代换</li>
</ol>
</li>
</ol>
<p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/40.png" style="zoom: 80%;"></p>
<h4 id="注意事项："><a href="#注意事项：" class="headerlink" title="注意事项："></a>注意事项：</h4><p>每个求和都写几项，要清楚是从n=几开始的！！！</p>
<p>分母或者系数中有 几的n次方之类的，可以和x^n 合并，然后极限改成 $\lim\limits_{x-&gt;\lambda x}…$  在解出和函数后把x带换成 $\lambda x$ （比如例题5）</p>
<h5 id="例一"><a href="#例一" class="headerlink" title="例一"></a>例一</h5><p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/36.png" style="zoom: 80%;"></p>
<p> <img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/31.png" style="zoom: 80%;"></p>
<p>我们通过乘一个x或者除一个x，让幂次等于分母，这样就可以刚好消除。当然，提取出一个$\frac{1}{x}$ 之前首先要说明当x=0 的时候是什么情况，最后写成分类函数的形式</p>
<h5 id="例二"><a href="#例二" class="headerlink" title="例二"></a>例二</h5><p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/29.png" style="zoom: 80%;"></p>
<p>没有分数，<strong>系数和幂次相差1(这里是n和n-1) 或者我们可以通过先提出一个数把格式化成能够积分的样子，然后用先积分再求导来做</strong></p>
<h5 id="例三"><a href="#例三" class="headerlink" title="例三"></a>例三</h5><p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/32.png" style="zoom: 80%;"></p>
<p>分母有n，同样用求导来做</p>
<p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/33.png" style="zoom: 80%;"></p>
<p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/34.png" style="zoom: 80%;"></p>
<h5 id="例四"><a href="#例四" class="headerlink" title="例四"></a>例四</h5><p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/37.png"></p>
<p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/38.png" style="zoom: 120%;"></p>
<h5 id="例五"><a href="#例五" class="headerlink" title="例五"></a>例五</h5><p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/41.png" style="zoom: 150%;"></p>
<p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/39.png" style="zoom: 120%;"></p>
<h2 id="练习册选题："><a href="#练习册选题：" class="headerlink" title="练习册选题："></a>练习册选题：</h2><p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/18.png" style="zoom: 200%;"></p>
<p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/23.png" style="zoom:120%;"></p>
<p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/17.png" style="zoom: 200%;"></p>
<p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/24.png" style="zoom:120%;"></p>
<p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/19.png" style="zoom: 200%;"></p>
<p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/25.png" style="zoom: 67%;"></p>
<h2 id="书本练习"><a href="#书本练习" class="headerlink" title="书本练习"></a>书本练习</h2><p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/11.jpg" style="zoom: 67%;"></p>
<p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/22.jpg" style="zoom: 67%;"></p>
<p><img src="/2020/05/31/%E5%B9%82%E7%BA%A7%E6%95%B0/33.jpg" style="zoom: 67%;"></p>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/30/react%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/30/react%E5%9F%BA%E7%A1%80/" itemprop="url">react基础</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-05-30T21:50:26+08:00">
                2020-05-30
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2021-09-30T11:03:56+08:00">
                2021-09-30
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index">
                    <span itemprop="name">react</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="react基础（组件-组合组件）"><a href="#react基础（组件-组合组件）" class="headerlink" title="react基础（组件+组合组件）"></a>react基础（组件+组合组件）</h1><p>这篇文章的教程</p>
<p><a href="https://www.bilibili.com/video/BV1Sb411P79t?p=23" target="_blank" rel="noopener">Mosh的react课程</a></p>
<p>假设我们已经了解一些JavaScript的基础和OOP编程思想了</p>
<p>vscode中ctrl+p 实现文件查找</p>
<p>下载自动优化插件prettier，在保存时自动优化代码增加可读性</p>
<h2 id="Component"><a href="#Component" class="headerlink" title="Component"></a>Component</h2><h3 id="Setting-Up-the-Project"><a href="#Setting-Up-the-Project" class="headerlink" title="Setting Up the Project"></a>Setting Up the Project</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create-react-app XXXX;</span><br><span class="line">npm start;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/1.png" style="zoom:67%;"></p>
<h3 id="Your-First-React-Component"><a href="#Your-First-React-Component" class="headerlink" title="Your First React Component"></a>Your First React Component</h3><p>我们接下来想做一个类似购物车的计数器</p>
<p>在src中新建文件夹components，里面新建counter.jsx</p>
<p>JSX是一种JavaScript的语法扩展，运用于 React 架构中，其格式比较像是模版语言，但事实上完全是在 JavaScript 内部实现的。元素是构成React应用的最小单位，JSX就是用来声明React当中的元素，React使用JSX来描述用户界面。</p>
<p>JSX可以使用引号来定义以字符串为值的属性：</p>
<p>const element = \<div tabindex\="\"0\"\\">\&lt;/div>;</div></p>
<p>也可以使用大括号来定义以JavaScript表达式为值的属性：</p>
<p>const element = \<img src\="\{user\.avatarUrl\}" \>;</p>
<p>下载 simple React Snippets 插件，imrc+cc即可生成代码</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span>  <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;  &#125;</span><br><span class="line">  render() &#123; </span><br><span class="line">    <span class="keyword">return</span> (  );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> ;</span><br></pre></td></tr></table></figure>
<p>修改一下即可</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Counter;</span><br></pre></td></tr></table></figure>
<p>index.js中做如下修改</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./index.css'</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> serviceWorker <span class="keyword">from</span> <span class="string">'./serviceWorker'</span>;</span><br><span class="line"><span class="comment">/*添加component*/</span><span class="keyword">import</span> Counter <span class="keyword">from</span> <span class="string">'./components/counter'</span>;</span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;React.StrictMode&gt;</span><br><span class="line"><span class="comment">/*修改APP*/</span>   &lt;Counter /&gt;</span><br><span class="line">  &lt;<span class="regexp">/React.StrictMode&gt;,</span></span><br><span class="line"><span class="regexp">  document.getElementById('root')</span></span><br><span class="line"><span class="regexp">);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ If you want your app to work offline and load faster, you can change</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ unregister() to register() below. Note this comes with some pitfalls.</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ Learn more about service workers: https:/</span><span class="regexp">/bit.ly/</span>CRA-PWA</span><br><span class="line">serviceWorker.unregister();</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/2.png" style="zoom:67%;"></p>
<h3 id="Specifying-Children"><a href="#Specifying-Children" class="headerlink" title="Specifying Children"></a>Specifying Children</h3><p>我如果想在h1后面放一个按钮，我可以这么写</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello World<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;<span class="name">button</span>&gt;</span>Increment<span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Counter;</span><br></pre></td></tr></table></figure>
<p>Babel 会 自动React.createElement(‘div’)</p>
<p>因为下载了prettier，所以在保存时自动优化成下列代码</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;h1&gt;Hello World&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button&gt;Increment&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Counter;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/3.png" style="zoom:100%;"></p>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/4.png" style="zoom:100%;"></p>
<p>观察源码我们可以发现我们生成的代码和刚才写的是一样的。当然我们也可以实现移除div标签。</p>
<p>通过把原来的div改成 React.Fragment即可</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line"><span class="comment">/*修改*/</span> &lt;React.Fragment&gt;</span><br><span class="line">        &lt;h1&gt;Hello World&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">/</span>*修改*<span class="regexp">/ &lt;button&gt;Increment&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/React.Fragment&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/5.png" style="zoom:167%;"></p>
<h3 id="Embedding-Expressions"><a href="#Embedding-Expressions" class="headerlink" title="Embedding Expressions"></a>Embedding Expressions</h3><p>我想在原来HelloWorld基础上变为动态文字，这时候我们在Counter类中添加一个新的属性state</p>
<p>此外我们需要把原来的h1 改成span 。在花括号中可以使用任何js的变量，包括表达式，或者这个类中的某个属性</p>
<p>现在我们只要修改count的值，网页会实现动态的变化。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    count: <span class="number">10</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;React.Fragment&gt;</span><br><span class="line"><span class="comment">/*修改*/</span> &lt;span&gt;&#123;<span class="keyword">this</span>.state.count&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button&gt;Increment&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/React.Fragment&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Counter;</span></span><br></pre></td></tr></table></figure>
<p>此外，花括号里还可以这样写：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;span&gt;&#123;<span class="number">2</span>+<span class="number">2</span>&#125;&lt;<span class="regexp">/span&gt;</span></span><br></pre></td></tr></table></figure>
<p>也可以传入一个<strong>函数</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    count: <span class="number">10</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;React.Fragment&gt;</span><br><span class="line">        &lt;span&gt;&#123;<span class="keyword">this</span>.formatCount()&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button&gt;Increment&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/React.Fragment&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  formatCount() &#123;</span></span><br><span class="line"><span class="regexp">    const &#123; count &#125; = this.state;/</span><span class="regexp">/ 对象解构</span></span><br><span class="line"><span class="regexp">    return count === 0 ? "Zero" : count; </span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Counter;</span></span><br></pre></td></tr></table></figure>
<p>那么count改成0，显示Zero</p>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/6.png" style="zoom:167%;"></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">formatCount() &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; count &#125; = <span class="keyword">this</span>.state;<span class="comment">// 对象解构</span></span><br><span class="line">  <span class="keyword">return</span> count === <span class="number">0</span> ? <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Zero<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span> : count; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们也可以直接输出一个标题，源码则变成了span中又一对h1</p>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/7.png" style="zoom:100%;"><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/8.png" style="zoom:100%;"></p>
<h3 id="Setting-Attributes"><a href="#Setting-Attributes" class="headerlink" title="Setting Attributes"></a>Setting Attributes</h3><p>怎么样给元素设置属性？</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">    imageUrl: <span class="string">"http://picsum.photos/200"</span>,<span class="comment">//一个随机获取图片的网站</span></span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;React.Fragment&gt;</span><br><span class="line">        &lt;img src=&#123;<span class="keyword">this</span>.state.imageUrl&#125; alt=<span class="string">""</span> /&gt;</span><br><span class="line">        &lt;span&gt;&#123;<span class="keyword">this</span>.formatCount()&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button&gt;Increment&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/React.Fragment&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  formatCount() &#123;</span></span><br><span class="line"><span class="regexp">    const &#123; count &#125; = this.state;</span></span><br><span class="line"><span class="regexp">    return count === 0 ? "Zero" : count;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Counter;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/9.png" style="zoom:100%;"></p>
<p>上面的代码放到一边，这里说一下 className 因为js中的class是关键词，所以jsx中class标签对应的名称就是className</p>
<p>利用bootstrap中的css样式我们可以做以下修改：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;React.Fragment&gt;</span><br><span class="line">        &lt;span className=<span class="string">"badge badge-primary m-2"</span>&gt;&#123;<span class="keyword">this</span>.formatCount()&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button className="btn btn-secondary btn-sm"&gt;Increment&lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/React.Fragment&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  formatCount() &#123;</span></span><br><span class="line"><span class="regexp">    const &#123; count &#125; = this.state;</span></span><br><span class="line"><span class="regexp">    return count === 0 ? "Zero" : count;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Counter;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/10.png" style="zoom:120%;"></p>
<p>有时候我想用一些确切的有针对性地样式，那么可以使用style</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  styles = &#123;</span><br><span class="line">    fontSize: <span class="number">10</span>,</span><br><span class="line">    fontWeight: <span class="string">"bold"</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;React.Fragment&gt;</span><br><span class="line">        &lt;span style=&#123;<span class="keyword">this</span>.styles&#125; className=<span class="string">"badge badge-primary m-2"</span>&gt;</span><br><span class="line">          &#123;<span class="keyword">this</span>.formatCount()&#125;</span><br><span class="line">        &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button style=&#123;this.styles&#125; className="btn btn-secondary btn-sm"&gt;</span></span><br><span class="line"><span class="regexp">          Increment</span></span><br><span class="line"><span class="regexp">        &lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/React.Fragment&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  formatCount() &#123;</span></span><br><span class="line"><span class="regexp">    const &#123; count &#125; = this.state;</span></span><br><span class="line"><span class="regexp">    return count === 0 ? "Zero" : count;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Counter;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/11.png" style="zoom:120%;"></p>
<p>这就是style的修改，我们先定义一个对象，然后在jsx中引用，当然我们如果用 行内样式表 。</p>
<h3 id="Rendering-Classes-Dynamically"><a href="#Rendering-Classes-Dynamically" class="headerlink" title="Rendering Classes Dynamically"></a>Rendering Classes Dynamically</h3><p>如何动态渲染css样式呢？现在0是蓝底的，我们想要在0的时候变成黄色的，其他情况是蓝色的，怎么办呢？</p>
<p>蓝色：badge badge-primary 黄色：badge badge-warning</p>
<p>通过{}的性质，我们可以新建一个classes字符串，然后对其做一个逻辑判断。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  styles = &#123;</span><br><span class="line">    fontSize: <span class="number">10</span>,</span><br><span class="line">    fontWeight: <span class="string">"bold"</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">let</span> classes = <span class="string">"badge m-2 badge-"</span>;</span><br><span class="line">    classes += <span class="keyword">this</span>.state.count === <span class="number">0</span> ? <span class="string">"warning"</span> : <span class="string">"primary"</span>;<span class="comment">//逻辑判断</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;React.Fragment&gt;</span><br><span class="line">        &lt;span style=&#123;<span class="keyword">this</span>.styles&#125; className=&#123;classes&#125;&gt;</span><br><span class="line">          &#123;<span class="keyword">this</span>.formatCount()&#125;</span><br><span class="line">        &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button style=&#123;this.styles&#125; className="btn btn-secondary btn-sm"&gt;</span></span><br><span class="line"><span class="regexp">          Increment</span></span><br><span class="line"><span class="regexp">        &lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/React.Fragment&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  formatCount() &#123;</span></span><br><span class="line"><span class="regexp">    const &#123; count &#125; = this.state;</span></span><br><span class="line"><span class="regexp">    return count === 0 ? "Zero" : count;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Counter;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/12.png" style="zoom:120%;"></p>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/13.png" style="zoom:120%;"></p>
<p>但是上面的写法有缺点，它污染了render()方法。更好的方法是把这两行放到单独的方法当中去这样计算的细节就不会和渲染耦合了</p>
<p>通过vscode中的重构，我们可以这样。ctrl+shift+R, 把那两行新建一个方法getBadgeClasses()。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    count: <span class="number">10</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  styles = &#123;</span><br><span class="line">    fontSize: <span class="number">10</span>,</span><br><span class="line">    fontWeight: <span class="string">"bold"</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;React.Fragment&gt;</span><br><span class="line">        &lt;span style=&#123;<span class="keyword">this</span>.styles&#125; className=&#123;<span class="keyword">this</span>.getBadgeClasses()&#125;&gt;</span><br><span class="line">          &#123;<span class="keyword">this</span>.formatCount()&#125;</span><br><span class="line">        &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button style=&#123;this.styles&#125; className="btn btn-secondary btn-sm"&gt;</span></span><br><span class="line"><span class="regexp">          Increment</span></span><br><span class="line"><span class="regexp">        &lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/React.Fragment&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  getBadgeClasses() &#123;</span></span><br><span class="line"><span class="regexp">    let classes = "badge m-2 badge-";</span></span><br><span class="line"><span class="regexp">    classes += this.state.count === 0 ? "warning" : "primary";</span></span><br><span class="line"><span class="regexp">    return classes;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  formatCount() &#123;</span></span><br><span class="line"><span class="regexp">    const &#123; count &#125; = this.state;</span></span><br><span class="line"><span class="regexp">    return count === 0 ? "Zero" : count;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Counter;</span></span><br></pre></td></tr></table></figure>
<h3 id="Rendering-Lists"><a href="#Rendering-Lists" class="headerlink" title="Rendering Lists"></a>Rendering Lists</h3><p>怎么渲染一个列表呢？可以利用map函数。同样的，想要动态渲染利用花括号</p>
<p>但是我们在每个列表项生成的时候，需要设置它的key属性。每个key的唯一性，只在当前列表有效。这样当react中的虚拟dom改变的时候，react能够迅速反应过来什么组件改变了，然后重新渲染浏览器dom以确保同步</p>
<p>在这里，我们直接把tag作为key值即可，因为tag是两两不同的</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">    tags: [<span class="string">"tag1"</span>, <span class="string">"tag2"</span>, <span class="string">"tag3"</span>],</span><br><span class="line">  &#125;;</span><br><span class="line">  styles = &#123;</span><br><span class="line">    fontSize: <span class="number">10</span>,</span><br><span class="line">    fontWeight: <span class="string">"bold"</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;React.Fragment&gt;</span><br><span class="line">        &lt;span style=&#123;<span class="keyword">this</span>.styles&#125; className=&#123;<span class="keyword">this</span>.getBadgeClasses()&#125;&gt;</span><br><span class="line">          &#123;<span class="keyword">this</span>.formatCount()&#125;</span><br><span class="line">        &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button style=&#123;this.styles&#125; className="btn btn-secondary btn-sm"&gt;</span></span><br><span class="line"><span class="regexp">          Increment</span></span><br><span class="line"><span class="regexp">        &lt;/</span>button&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">          &#123;<span class="keyword">this</span>.state.tags.map(<span class="function">(<span class="params">tag</span>) =&gt;</span> (</span><br><span class="line">            &lt;li key=&#123;tag&#125;&gt;&#123;tag&#125;&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">          ))&#125;</span></span><br><span class="line"><span class="regexp">        &lt;/u</span>l&gt;</span><br><span class="line">      &lt;<span class="regexp">/React.Fragment&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  getBadgeClasses() &#123;</span></span><br><span class="line"><span class="regexp">    let classes = "badge m-2 badge-";</span></span><br><span class="line"><span class="regexp">    classes += this.state.count === 0 ? "warning" : "primary";</span></span><br><span class="line"><span class="regexp">    return classes;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  formatCount() &#123;</span></span><br><span class="line"><span class="regexp">    const &#123; count &#125; = this.state;</span></span><br><span class="line"><span class="regexp">    return count === 0 ? "Zero" : count;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Counter;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/14.png" style="zoom:120%;"></p>
<h3 id="Conditional-Rendering"><a href="#Conditional-Rendering" class="headerlink" title="Conditional Rendering"></a>Conditional Rendering</h3><p>条件渲染</p>
<p>如果数组列表中至少有一项，那么我们就渲染它，否则我们就输出”No Tags”</p>
<p>在jsx中没有if之类的条件判断，因为jsx不是模板化引擎。所以我们要回到js层面构建这个方法</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">    <span class="comment">// tags: ["tag1", "tag2", "tag3"]</span></span><br><span class="line">    tags: [],</span><br><span class="line">  &#125;;</span><br><span class="line">  renderTags() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state.tags.length === <span class="number">0</span>) <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>There are No Tags!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">        &#123;<span class="keyword">this</span>.state.tags.map(<span class="function">(<span class="params">tag</span>) =&gt;</span> (</span><br><span class="line">          &lt;li key=&#123;tag&#125;&gt;&#123;tag&#125;&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">        ))&#125;</span></span><br><span class="line"><span class="regexp">      &lt;/u</span>l&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">React.Fragment</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;/*  我们也可以直接在这里判断，通过&amp;&amp;  */&#125;</span></span><br><span class="line"><span class="xml">       	&#123;this.state.tags.length ===0&amp;&amp;"Please create a new tag!"&#125;    </span></span><br><span class="line"><span class="xml">        &#123;this.renderTags()&#125;<span class="tag">&lt;/<span class="name">React.Fragment</span>&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Counter;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/15.png" style="zoom:120%;"></p>
<p>在render中我们用&amp;&amp;来进行简单的逻辑运算如果tags.length===0 才可以运行下面的代码。如果下面一个条件不是是非判断，而是字符串，那么如果是空串即false，非空串即为true</p>
<h3 id="Handling-Events"><a href="#Handling-Events" class="headerlink" title="Handling Events"></a>Handling Events</h3><p>所有的react元素都有基于dom事件的属性，例如按钮元素有一个onClick属性，还有双击事件、鼠标移入事件（onKey…）。</p>
<p>处理onClick事件：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">    state = &#123;</span><br><span class="line">        count: <span class="number">0</span>，</span><br><span class="line">    &#125;;</span><br><span class="line">    handleIncrement() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Increment Clicked'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123; </span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &lt;button </span><br><span class="line">                    onClick=&#123;<span class="keyword">this</span>.handleIncrement&#125; </span><br><span class="line">                    className=<span class="string">'btn btn-secondary btn-sm'</span>&gt;</span><br><span class="line">                    Increment</span><br><span class="line">                &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 值得注意的是，我们在”onClick={this.handleIncrement()}”中并没有调用方法，只是传入了一个引用。这与在js中的处理方式不同：在写行内代码的时候，我们直接调用 js 函数。</p>
<p>和下面的调用不同，因为我们需要一个返回值来给className赋值，所以我们要调用一个方法</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;span  className=&#123;<span class="keyword">this</span>.getBadgeClasses()&#125;&gt;</span><br><span class="line">  &#123;<span class="keyword">this</span>.formatCount()&#125;</span><br><span class="line">&lt;<span class="regexp">/span&gt;</span></span><br></pre></td></tr></table></figure>
<p>现在按按钮的时候console就会显示Increment Clicked了</p>
<p>现在我们要实现当鼠标点击Increment的时候，显示\<span\>标签中的数字。</span\></p>
<p>我们不能直接这么写!这样浏览器就爆炸了。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">handleIncrement() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Increment Clicked'</span>，<span class="keyword">this</span>.state.count);</span><br></pre></td></tr></table></figure>
<p>如果我们单单显示this，那么会指向一个undefined。 </p>
<h3 id="Binding-Event-Handlers"><a href="#Binding-Event-Handlers" class="headerlink" title="Binding Event Handlers"></a>Binding Event Handlers</h3><p>回到上面的问题。为什么会出现这个问题呢？明明是在类里面啊。</p>
<p>js中，调用函数的方式不同，this指代的对象也可能不同。如果一个函数被方法调用，那么this总是返回那个对象的引用。但是因为这个函数被以独立函数的方式引用，this会返回默认的全局对象(严格模式下为undefined)</p>
<p>那你会说我tm也没独立调用啊，我onClick={this.handleIncrement} 中有this啊。。</p>
<p>但是注意，这不是调用一个方法！！！</p>
<p>如果我们改成onClick={this.handleIncrement()} 那么我们会发现确实会显示  Increment Clicked 0（或者别的数字） 。而且点击按钮是没用的，因为他会默认你已经调用了这个方法了，而不是触发调用。</p>
<p>这就很矛盾了。如何解决，我们需要用下面这篇文章提到的bind()方法</p>
<p><a href="https://jasonxqh.github.io/2020/05/26/OOP-in-JavaScript/#more">https://jasonxqh.github.io/2020/05/26/OOP-in-JavaScript/#more</a> </p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="comment">// 在这里我们定义一个 Counter 的构造函数，因为Counter继承自Component，所以我们先要super一下</span></span><br><span class="line"><span class="comment">// 我们知道当调用bind的时候，会返回一个指向括号内对象的方法，我们再用handleIncrement接收</span></span><br><span class="line"><span class="comment">// 接受好以后我们就实现了让handleIncrement中的所有的this都指向了一个对象，也就是Counter对象</span></span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    <span class="keyword">this</span>.handleIncrement = <span class="keyword">this</span>.handleIncrement.bind(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  handleIncrement() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Increment Clicked"</span>, <span class="keyword">this</span>.state.count);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;React.Fragment&gt;</span><br><span class="line">        &lt;span className=&#123;<span class="keyword">this</span>.getBadgeClasses()&#125;&gt;&#123;<span class="keyword">this</span>.formatCount()&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button</span></span><br><span class="line"><span class="regexp">          onClick=&#123;this.handleIncrement&#125;</span></span><br><span class="line"><span class="regexp">          className="btn btn-secondary btn-sm"</span></span><br><span class="line"><span class="regexp">        &gt;</span></span><br><span class="line"><span class="regexp">          Increment</span></span><br><span class="line"><span class="regexp">        &lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/React.Fragment&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  getBadgeClasses() &#123;</span></span><br><span class="line"><span class="regexp">    let classes = "badge m-2 badge-";</span></span><br><span class="line"><span class="regexp">    classes += this.state.count === 0 ? "warning" : "primary";</span></span><br><span class="line"><span class="regexp">    return classes;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  formatCount() &#123;</span></span><br><span class="line"><span class="regexp">    const &#123; count &#125; = this.state;</span></span><br><span class="line"><span class="regexp">    return count === 0 ? "Zero" : count;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Counter;</span></span><br></pre></td></tr></table></figure>
<p>当然，我们也可以不适用constructor来实现这个功能，那就老样子，箭头函数，箭头函数中的this就继承自构造这个函数的对象。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">handleIncrement=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Increment Clicked"</span>, <span class="keyword">this</span>.state.count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而且我认为这种方式更加直观，能更好的帮助我们理解为什么调用引用而不是直接调用方法。</p>
<h3 id="Updating-the-State"><a href="#Updating-the-State" class="headerlink" title="Updating the State"></a>Updating the State</h3><p>现在我们要学习更新状态。也就是说当我们click的时候，要实现前面的数字+1</p>
<p>我们不能想的太简单，直接这么写.这是没有用的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">handleIncrement=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.state.count++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>事实上我们代码中的count确实++ 了，但是react不知道，所以视图并没有更新。为了解决这个问题，我们需要用到继承自component对象的一个方法setState() 这个方法告诉react state已经更新了，然后让react去同步视图</p>
<p>这里我们可以向setState方法传入我们需要实时修改的参数，我们传入一个对象，对象中的this.state.count属性会和state中的合并。或者当state中有相同的属性时，就会被覆盖</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">handleIncrement = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">this</span>.setState(&#123; <span class="attr">count</span>: <span class="keyword">this</span>.state.count + <span class="number">1</span> &#125;);</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/1.gif" style="zoom:80%;"></p>
<h3 id="What-Happens-When-State-Changes"><a href="#What-Happens-When-State-Changes" class="headerlink" title="What Happens When State Changes"></a>What Happens When State Changes</h3><p>原理就是当我们点击了increment按钮的时候，调用了setState方法。这个方法告诉react，state要变化了。react会计划调用一次render方法，也许未来某个时候会调用。这就是异步调用，他将在未来发生。所以在未来某一点调用render的时候 这个方法会返回新的react元素。</p>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/16.png" style="zoom:60%;"></p>
<p>就像这样，然后react会对比他们俩修改了什么地方。在这里，它会发现是span的内容变换了，因为span调用的是count属性的值。然后react会找到真实的DOM，找到对应的span，修改它让它与虚拟的DOM同步。所以除了span标签以外的所有地方都没有发生改变</p>
<h3 id="Passing-Event-Arguments"><a href="#Passing-Event-Arguments" class="headerlink" title="Passing Event Arguments"></a>Passing Event Arguments</h3><p>如何传递事件参数？现在我们的handleIncrement 没有参数，但事实上我们在日常生活中常常需要传入参数。 比如这里我们处理了装有商品的购物车。当我们点击增加按钮的时候想传入一个商品对象的id</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  handleIncrement = <span class="function">(<span class="params">product</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(product);</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">count</span>: <span class="keyword">this</span>.state.count + <span class="number">1</span> &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;React.Fragment&gt;</span><br><span class="line">        &lt;span className=&#123;<span class="keyword">this</span>.getBadgeClasses()&#125;&gt;&#123;<span class="keyword">this</span>.formatCount()&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button</span></span><br><span class="line"><span class="regexp">          onClick=&#123;() =&gt; this.handleIncrement(&#123; id: 1 &#125;) &#125;</span></span><br><span class="line"><span class="regexp">          className="btn btn-secondary btn-sm"</span></span><br><span class="line"><span class="regexp">        &gt;</span></span><br><span class="line"><span class="regexp">          Increment</span></span><br><span class="line"><span class="regexp">        &lt;/</span>button&gt;</span><br><span class="line">      &lt;<span class="regexp">/React.Fragment&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  getBadgeClasses() &#123;</span></span><br><span class="line"><span class="regexp">    let classes = "badge m-2 badge-";</span></span><br><span class="line"><span class="regexp">    classes += this.state.count === 0 ? "warning" : "primary";</span></span><br><span class="line"><span class="regexp">    return classes;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  formatCount() &#123;</span></span><br><span class="line"><span class="regexp">    const &#123; count &#125; = this.state;</span></span><br><span class="line"><span class="regexp">    return count === 0 ? "Zero" : count;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Counter;</span></span><br></pre></td></tr></table></figure>
<p>这样当我们渲染一组购物车商品的时候 我们可以用map方法访问商品的对象</p>
<p>我们当然可以新建一个doHandleIncrement 方法，但是这样会让代码更加凌乱，可读性不好，我们可以直接箭头函数。</p>
<p>当然我们可以不输出id:1 那么我们就直接传入商品对象</p>
<p>onClick = {() =&gt; this.handleIncrement(product)}即可</p>
<p>所以我们如果想对一个event handler  传递一个参数的话，我们就写一个<strong>箭头函数</strong>，在箭头函数中调用event handler并传入参数即可</p>
<h3 id="Setting-Up-the-Vidly-Project-新建vidly工程"><a href="#Setting-Up-the-Vidly-Project-新建vidly工程" class="headerlink" title="Setting Up the Vidly Project    新建vidly工程"></a>Setting Up the Vidly Project    新建vidly工程</h3><p> <a href="https://www.bilibili.com/video/BV1Sb411P79t?p=36" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1Sb411P79t?p=36</a></p>
<h3 id="Exercises"><a href="#Exercises" class="headerlink" title="Exercises"></a>Exercises</h3><p>在网页中做一张类似的表格。</p>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/17.png" style="zoom:60%;">re</p>
<p>我们需要在app.js中进行修改：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Movies <span class="keyword">from</span> <span class="string">"./components/Movies"</span>;</span><br><span class="line"><span class="comment">//把原来的&lt;app/&gt;换成新的元素&lt;Movies/&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;main role=<span class="string">"main"</span> className=<span class="string">"container"</span>&gt;</span><br><span class="line">      &lt;Movies/&gt;</span><br><span class="line">    &lt;<span class="regexp">/main&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure>
<h3 id="Building-the-Movies-Component"><a href="#Building-the-Movies-Component" class="headerlink" title="Building the Movies Component"></a>Building the Movies Component</h3><p>和上面一样，我们先从fakeMovieService中引入getMovies()方法。</p>
<p>然后建一个state来存放movies对象</p>
<p>然后见一张表格，可以用快捷键  table.table>thead>tr>th*4 (表头)和 tbody>tr>td*4 （表身）</p>
<p>利用map函数，对movies中的每一个movie对象进行渲染，每部电影生成一行</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getMovies &#125; <span class="keyword">from</span> <span class="string">"../services/fakeMovieService"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movies</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    movies: getMovies(),</span><br><span class="line">  &#125;;</span><br><span class="line">  handleDelete = <span class="function">(<span class="params">movie</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//..</span></span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;table className=<span class="string">"table"</span>&gt;</span><br><span class="line">        &lt;thead&gt;</span><br><span class="line">          &lt;tr&gt;</span><br><span class="line">            &lt;th&gt;Title&lt;<span class="regexp">/th&gt;</span></span><br><span class="line"><span class="regexp">            &lt;th&gt;Genre&lt;/</span>th&gt;</span><br><span class="line">            &lt;th&gt;Stock&lt;<span class="regexp">/th&gt;</span></span><br><span class="line"><span class="regexp">            &lt;th&gt;Rate&lt;/</span>th&gt;</span><br><span class="line">          &lt;<span class="regexp">/tr&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>thead&gt;</span><br><span class="line">        &lt;tbody&gt;</span><br><span class="line">          &#123;<span class="keyword">this</span>.state.movies.map(<span class="function">(<span class="params">movie</span>) =&gt;</span> (</span><br><span class="line">            &lt;tr key = &#123;movie._id&#125;&gt;</span><br><span class="line">              &lt;td&gt;&#123;movie.title&#125;&lt;<span class="regexp">/td&gt;</span></span><br><span class="line"><span class="regexp">              &lt;td&gt;&#123;movie.genre.name&#125;&lt;/</span>td&gt;</span><br><span class="line">              &lt;td&gt;&#123;movie.numberInStock&#125;&lt;<span class="regexp">/td&gt;</span></span><br><span class="line"><span class="regexp">              &lt;td&gt;&#123;movie.dailyRentalRate&#125;&lt;/</span>td&gt;</span><br><span class="line">            &lt;<span class="regexp">/tr&gt;</span></span><br><span class="line"><span class="regexp">          ))&#125;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>tbody&gt;</span><br><span class="line">      &lt;<span class="regexp">/table&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Movies;</span></span><br></pre></td></tr></table></figure>
<h3 id="Deleting-a-Movie"><a href="#Deleting-a-Movie" class="headerlink" title="Deleting a Movie"></a>Deleting a Movie</h3><p>要实现删除，也就是说我们在点击的时候要新建一张表格，新的这张表格不包含被删除的那行，然后再通过setState函数实现更新</p>
<p>我们在这里通过filter函数，对movies中的每一个元素进行判断是否与被删除id相等。然后用movies来接收filter函数返回一个新的列表。<br>利用setState,传入一个对象，然后和state中重复的属性会被新的属性覆盖，达到删除效果</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getMovies &#125; <span class="keyword">from</span> <span class="string">"../services/fakeMovieService"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movies</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    movies: getMovies(),</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  handleDelete = <span class="function">(<span class="params">movie</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> movies = <span class="keyword">this</span>.state.movies.filter(<span class="function">(<span class="params">m</span>) =&gt;</span> m._id !== movie._id);</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">movies</span>: movies &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;table className=<span class="string">"table"</span>&gt;</span><br><span class="line">        &lt;thead&gt;</span><br><span class="line">          &lt;tr&gt;</span><br><span class="line">            &lt;th&gt;Title&lt;<span class="regexp">/th&gt;</span></span><br><span class="line"><span class="regexp">            &lt;th&gt;Genre&lt;/</span>th&gt;</span><br><span class="line">            &lt;th&gt;Stock&lt;<span class="regexp">/th&gt;</span></span><br><span class="line"><span class="regexp">            &lt;th&gt;Rate&lt;/</span>th&gt;</span><br><span class="line">          &lt;<span class="regexp">/tr&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>thead&gt;</span><br><span class="line">        &lt;tbody&gt;</span><br><span class="line">          &#123;<span class="keyword">this</span>.state.movies.map(<span class="function">(<span class="params">movie</span>) =&gt;</span> (</span><br><span class="line">            &lt;tr key=&#123;movie._id&#125;&gt;</span><br><span class="line">              &lt;td&gt;&#123;movie.title&#125;&lt;<span class="regexp">/td&gt;</span></span><br><span class="line"><span class="regexp">              &lt;td&gt;&#123;movie.genre.name&#125;&lt;/</span>td&gt;</span><br><span class="line">              &lt;td&gt;&#123;movie.numberInStock&#125;&lt;<span class="regexp">/td&gt;</span></span><br><span class="line"><span class="regexp">              &lt;td&gt;&#123;movie.dailyRentalRate&#125;&lt;/</span>td&gt;</span><br><span class="line">              &lt;td&gt;</span><br><span class="line">                &lt;button</span><br><span class="line">                  onClick=&#123;() =&gt; <span class="keyword">this</span>.handleDelete(movie)&#125;</span><br><span class="line">                  className=<span class="string">"btn btn-danger btn-sm"</span></span><br><span class="line">                &gt;</span><br><span class="line">                  Delete</span><br><span class="line">                &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">              &lt;/</span>td&gt;</span><br><span class="line">            &lt;<span class="regexp">/tr&gt;</span></span><br><span class="line"><span class="regexp">          ))&#125;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>tbody&gt;</span><br><span class="line">      &lt;<span class="regexp">/table&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Movies;</span></span><br></pre></td></tr></table></figure>
<h3 id="Conditional-Rendering-1"><a href="#Conditional-Rendering-1" class="headerlink" title="Conditional Rendering"></a>Conditional Rendering</h3><p>怎么进行条件渲染呢？就是如果电影数是0，那么显示There are no movies in the database </p>
<p>否则显示Showing n(行数) movies in the database</p>
<p>注意，react中return一个component只能返回一个元素，如果想要把两个元素合并，需要用到\<React.Fragment\></React.Fragment\></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getMovies &#125; <span class="keyword">from</span> <span class="string">"../services/fakeMovieService"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Movies</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    movies: getMovies(),</span><br><span class="line">  &#125;;</span><br><span class="line">  handleDelete = <span class="function">(<span class="params">movie</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> movies = <span class="keyword">this</span>.state.movies.filter(<span class="function">(<span class="params">m</span>) =&gt;</span> m._id !== movie._id);</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; <span class="attr">movies</span>: movies &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.state.movies.length === <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>There are no movies in the database <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span>;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;React.Fragment&gt;</span><br><span class="line">        &lt;h2&gt;Showing &#123;<span class="keyword">this</span>.state.movies.length&#125; movies <span class="keyword">in</span> the database&lt;<span class="regexp">/h2&gt;</span></span><br><span class="line"><span class="regexp">        &lt;table className="table"&gt;</span></span><br><span class="line"><span class="regexp">          &lt;thead&gt;</span></span><br><span class="line"><span class="regexp">            &lt;tr&gt;</span></span><br><span class="line"><span class="regexp">              &lt;th&gt;Title&lt;/</span>th&gt;</span><br><span class="line">              &lt;th&gt;Genre&lt;<span class="regexp">/th&gt;</span></span><br><span class="line"><span class="regexp">              &lt;th&gt;Stock&lt;/</span>th&gt;</span><br><span class="line">              &lt;th&gt;Rate&lt;<span class="regexp">/th&gt;</span></span><br><span class="line"><span class="regexp">            &lt;/</span>tr&gt;</span><br><span class="line">          &lt;<span class="regexp">/thead&gt;</span></span><br><span class="line"><span class="regexp">          &lt;tbody&gt;</span></span><br><span class="line"><span class="regexp">            &#123;this.state.movies.map((movie) =&gt; (</span></span><br><span class="line"><span class="regexp">              &lt;tr key=&#123;movie._id&#125;&gt;</span></span><br><span class="line"><span class="regexp">                &lt;td&gt;&#123;movie.title&#125;&lt;/</span>td&gt;</span><br><span class="line">                &lt;td&gt;&#123;movie.genre.name&#125;&lt;<span class="regexp">/td&gt;</span></span><br><span class="line"><span class="regexp">                &lt;td&gt;&#123;movie.numberInStock&#125;&lt;/</span>td&gt;</span><br><span class="line">                &lt;td&gt;&#123;movie.dailyRentalRate&#125;&lt;<span class="regexp">/td&gt;</span></span><br><span class="line"><span class="regexp">                &lt;td&gt;</span></span><br><span class="line"><span class="regexp">                  &lt;button</span></span><br><span class="line"><span class="regexp">                    onClick=&#123;() =&gt; this.handleDelete(movie)&#125;</span></span><br><span class="line"><span class="regexp">                    className="btn btn-danger btn-sm"</span></span><br><span class="line"><span class="regexp">                  &gt;</span></span><br><span class="line"><span class="regexp">                    Delete</span></span><br><span class="line"><span class="regexp">                  &lt;/</span>button&gt;</span><br><span class="line">                &lt;<span class="regexp">/td&gt;</span></span><br><span class="line"><span class="regexp">              &lt;/</span>tr&gt;</span><br><span class="line">            ))&#125;</span><br><span class="line">          &lt;<span class="regexp">/tbody&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>table&gt;</span><br><span class="line">      &lt;<span class="regexp">/React.Fragment&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Movies;</span></span><br></pre></td></tr></table></figure>
<p>效果如下：<br><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/3.gif" style="zoom:150%;"></p>
<h2 id="Composing-Components-把组键组合"><a href="#Composing-Components-把组键组合" class="headerlink" title="Composing Components 把组键组合"></a>Composing Components 把组键组合</h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>react程序基本上就是一个组件树，我们可以将组件组合在一起，变成一个复杂的UI</p>
<h3 id="Composing-Components"><a href="#Composing-Components" class="headerlink" title="Composing Components"></a>Composing Components</h3><p>现在我们要通过一个组件来渲染一组counters<img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/18.png" style="zoom:50%;"></p>
<p>在component文件夹中新建counters.jsx</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Counter <span class="keyword">from</span> <span class="string">"./counter"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counters</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">      counters:[</span><br><span class="line">          &#123;<span class="attr">id</span>: <span class="number">1</span>,<span class="attr">value</span>:<span class="number">4</span>&#125;,</span><br><span class="line">          &#123;<span class="attr">id</span>: <span class="number">2</span>,<span class="attr">value</span>:<span class="number">0</span>&#125;,</span><br><span class="line">          &#123;<span class="attr">id</span>: <span class="number">3</span>,<span class="attr">value</span>:<span class="number">0</span>&#125;,</span><br><span class="line">          &#123;<span class="attr">id</span>: <span class="number">4</span>,<span class="attr">value</span>:<span class="number">0</span>&#125;</span><br><span class="line">      ]</span><br><span class="line">  &#125;;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">          &#123;<span class="keyword">this</span>.state.counters.map(<span class="function"><span class="params">counter</span>=&gt;</span><span class="xml"><span class="tag">&lt;<span class="name">Counter</span> <span class="attr">key</span> = <span class="string">&#123;counter.id&#125;/</span>&gt;</span></span>)&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Counters;</span></span><br></pre></td></tr></table></figure>
<p>但是我们现在如果修改counters列表中对象的value值，在Dom上并不会显示。接下来我们就要解决这个问题</p>
<h3 id="Passing-Data-to-Components"><a href="#Passing-Data-to-Components" class="headerlink" title="Passing Data to Components"></a>Passing Data to Components</h3><p>每个组件都有他的props属性他会用用我们向counter组件传递的所有属性,在\<Counter \> 中我们不仅可以添加key（key值不算在props属性内），还可以添加value值，selected值（默认为true），就像这样</Counter></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">          &#123;<span class="keyword">this</span>.state.counters.map(<span class="function"><span class="params">counter</span>=&gt;</span><span class="xml"><span class="tag">&lt;<span class="name">Counter</span> <span class="attr">key</span> = <span class="string">&#123;counter.id&#125;</span> <span class="attr">value</span> = <span class="string">&#123;counter.value&#125;</span> <span class="attr">selected</span> = <span class="string">&#123;true&#125;/</span>&gt;</span></span>)&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br></pre></td></tr></table></figure>
<p>然后我们回到counter,把state.value改成 this.props.value,即可显示</p>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/19.png" style="zoom:70%;"></p>
<h3 id="Passing-Children传递子元素"><a href="#Passing-Children传递子元素" class="headerlink" title="Passing Children传递子元素"></a>Passing Children传递子元素</h3><p>有个很特殊的props叫做children，也就是说当我们在传递组件的时候。有时候想要传递内容，比如说对话框等等。那么我们需要把原来的但标签\<counter \> 变成双标签，然后在里面传入我们想要传入的东西</counter></p>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/20.png" style="zoom:100%;"></p>
<p>这里有value属性，是之前设置的，还有children属性，type是h4</p>
<p>在counter的return中加上{<em>this</em>.props.children}，我们看到这样的ui</p>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/21.png" style="zoom:70%;"></p>
<p>当然，我们也可以把这个变成动态的,只要把原来的 Title 变成 Counter #{counter.id}即可</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">   <span class="keyword">return</span> (</span><br><span class="line">     &lt;div&gt;</span><br><span class="line">       &#123;<span class="keyword">this</span>.state.counters.map(<span class="function">(<span class="params">counter</span>) =&gt;</span> (</span><br><span class="line">         &lt;Counter key=&#123;counter.id&#125; value=&#123;counter.value&#125; selected=&#123;<span class="literal">true</span>&#125;&gt;</span><br><span class="line">           &lt;h4&gt;Counter #&#123;counter.id&#125;&lt;/h4&gt;</span><br><span class="line">         &lt;<span class="regexp">/Counter&gt;</span></span><br><span class="line"><span class="regexp">       ))&#125;</span></span><br><span class="line"><span class="regexp">     &lt;/</span>div&gt;</span><br><span class="line">   );</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/22.png" style="zoom:70%;"></p>
<p>事实上，我们可以直接把id当作一个props放在单个\<counter \> 标签当中去</counter></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Counter key=&#123;counter.id&#125; value=&#123;counter.value&#125; selected=&#123;<span class="literal">true</span>&#125; id=&#123;counter.id&#125;/&gt;</span><br></pre></td></tr></table></figure>
<p>然后呢在counter  的render中。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;h4&gt;&#123;<span class="keyword">this</span>.props.id&#125;&lt;<span class="regexp">/h4&gt;</span></span><br></pre></td></tr></table></figure>
<p>如下图</p>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/23.png" style="zoom:70%;"></p>
<h3 id="Props-vs-State"><a href="#Props-vs-State" class="headerlink" title="Props vs State"></a>Props vs State</h3><p>props 就是我们给组件的 数据。state是组件本地或者私有的数据容器，其他组件是没有办法访问的。他完全只能在组件内被访问。</p>
<p>换句话说我们在counters中给Counter标签设置的属性，都传入到了Counter的props中。但我们不能在Counters中访问Counter组建的state，因为他是私有和本地的。</p>
<p>类似的，Counters有着自己的组件state,这个state也是对其他组件完全不可见的。</p>
<p>有时候组件是没有state的，他用props处理所有的数据。</p>
<p>props 和state的区别还在于props是只读的。换句话说我们不能在组件内部改变传入的数据。如果我们想在组件声明周期 修改输入的数据，那么我们需要把输入的内容复制到state当中而不是修改props</p>
<h3 id="Raising-and-Handling-Events"><a href="#Raising-and-Handling-Events" class="headerlink" title="Raising and Handling Events"></a>Raising and Handling Events</h3><p>利用快捷键新建一个按钮  btn.btn.btn-danger.btn.m-2</p>
<p>效果如图</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">className</span>=<span class="string">"btn btn-danger m-2"</span>&gt;</span>Delete<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/24.png" style="zoom:70%;"></p>
<p>在这里我想实现点击Delete按钮，然后这行的\<Counter \>就被删除了，怎么实现？</Counter></p>
<p>这将引入一个react非常重要的原则</p>
<p>The component that owns a piece of state, should be the one modifying it</p>
<p>也就是说只有组件自己才能修改自己的state</p>
<p>所以我们没有办法在counter.jsx终实现，因为这四个\<Counter \> 是在\<Counters \>中实现的，所以我们也要在counters.jsx中实现删除操作</Counters></Counter></p>
<p>所以我们需要让Counter组件发起一个事件，我们把这个时间叫做onDelete事件。然后Counters组件将会处理这个事件，也就是说我们要在Counters组件当中实现一个handleDelete()的方法</p>
<p>理解了原理之后我们在Counters组件中添加一个方法(并非最终实现),然后通过props给Counter组件传递一个方法的引用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counters</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    counters: [</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">value</span>: <span class="number">4</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">value</span>: <span class="number">0</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">value</span>: <span class="number">0</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">value</span>: <span class="number">0</span> &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  handleDelete = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Event Handler Called"</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &#123;<span class="keyword">this</span>.state.counters.map(<span class="function">(<span class="params">counter</span>) =&gt;</span> (</span><br><span class="line">          &lt;Counter</span><br><span class="line">            key=&#123;counter.id&#125;</span><br><span class="line"><span class="comment">// 在这里加一个onDelete的prop, 我们把这个设置成&#123;this.handleDelete&#125;方法</span></span><br><span class="line">            onDelete=&#123;<span class="keyword">this</span>.handleDelete&#125;</span><br><span class="line">            value=&#123;counter.value&#125;</span><br><span class="line">            selected=&#123;<span class="literal">true</span>&#125;</span><br><span class="line">            id=&#123;counter.id&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>然后再Counter组件中刚刚实现的button标签中,通过this.props.onDelete来调用该方法</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;button </span><br><span class="line">    onClick=&#123;<span class="keyword">this</span>.props.onDelete&#125; </span><br><span class="line">    className=<span class="string">"btn btn-danger m-2"</span>&gt;</span><br><span class="line">    Delete</span><br><span class="line">&lt;<span class="regexp">/button&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/25.png" style="zoom:150%;"><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/26.png" style="zoom:100%;"></p>
<h3 id="Updating-the-State-1"><a href="#Updating-the-State-1" class="headerlink" title="Updating the State"></a>Updating the State</h3><p>接下来我们要正式做删除操作</p>
<p>向上文提及的，我们先测试一下handleDelete函数能不能正确打印counterID，如果能打印，那么我们可以放心删除</p>
<p>counters.jsx中做如下修改</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">handleDelete =  <span class="function"><span class="params">counterID</span>  =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Event Handler Called"</span>,counterID);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>counter.js 如下</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;button onClick=&#123;()=&gt;<span class="keyword">this</span>.props.onDelete(<span class="keyword">this</span>.props.id)&#125; className=<span class="string">"btn btn-danger m-2"</span>&gt;</span><br><span class="line">	Delete</span><br><span class="line">&lt;<span class="regexp">/button&gt;</span></span><br></pre></td></tr></table></figure>
<p>看来是成功的</p>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/27.png" style="zoom:100%;"></p>
<p>现在我们回去更新Counters组件中的元素了，像以前说的，我们不直接修改state，而是重新生成一个数组然后让setState去更新原来的数组</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">handleDelete = <span class="function">(<span class="params">counterID</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> counters = <span class="keyword">this</span>.state.counters.filter(<span class="function">(<span class="params">c</span>) =&gt;</span> c.id !== counterID);</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123; counters &#125;);</span><br><span class="line">    <span class="comment">//待更新的state.counters和我们新的counters 名称一样，所以可以简写</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>关于id和key，这里有一点要补充。</p>
<p>key是react组件内部的信息，我们在Counter组件的prop中是没有办法访问它的。但是id我们可以通过组件内部的props来读取。但是问题又出现了，我这里定义了很多props，每个props都是独立的，那么当随着我们传入props的增多，代码的管理会变得混乱不堪。所以我们直接把他们打包： counter = {counter} 这个counte 本来就包含了所有counter对象的数据。然后我们只需要在Counter组件中做如下修改</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  state = &#123;</span><br><span class="line">    value: <span class="keyword">this</span>.props.counter.value,</span><br><span class="line">  &#125;;</span><br><span class="line">&lt;button</span><br><span class="line">    onClick=&#123;() =&gt; <span class="keyword">this</span>.props.onDelete(<span class="keyword">this</span>.props.counter.id)&#125;</span><br><span class="line">    className=<span class="string">"btn btn-danger m-2"</span></span><br><span class="line">&gt;</span><br><span class="line">    Delete</span><br><span class="line">&lt;<span class="regexp">/button&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Single-Source-of-Truth"><a href="#Single-Source-of-Truth" class="headerlink" title="Single Source of Truth"></a>Single Source of Truth</h3><p>接下来我们想要做的是一个Reset按钮，按下以后所有现有的Counter的数值都会归零。那么，这时候我们就需要解决一个问题——</p>
<p>我们知道如果我们要重置，那么就要新建一个列表，把里面所有counter的value都置为0，然后setState，但是这对handleDelete和handleIncrement 都是可行的，因为Delete是直接对Counters进行修改，Increment则是通过调用Counters中\<counter \>标签对counter.value的修改。</counter></p>
<p>而对reset却不可以。</p>
<p>在counter中，他的value继承自我们传入的props属性，这个属性一旦传入就没有办法修改了，而我们一开始已经传入了四个counter的值分别是4，0，0，0 当我们尝试着重置的时候，counters中的state.counter已经被修改，但是counter中的state.value 却并没有得到修改。而当我们显示数字的时候，我们显示的是this.state.value,所以并不会改变。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">state = &#123;</span><br><span class="line">  value: <span class="keyword">this</span>.props.counter.value,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>所以问题就在这，我们对父子关系的组件（Counter是子组件，Counters是父组件）却有两套值得来源，这是万万不可的，所以我们要删除Counter的本地state数据，Counter中对本地state操作都转移到对父组件Counters操作中props的操作。</p>
<p>我们把Counter这种类型的组件 叫做受控组件，受控组件没有自己的state，他所有的数据都来自props，之后在数据需要要改变的时候发起事件。所以这种空间完全是被它的父控件控制的</p>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/28.png" style="zoom:80%;"></p>
<h3 id="Removing-the-Local-State"><a href="#Removing-the-Local-State" class="headerlink" title="Removing the Local State"></a>Removing the Local State</h3><p>修改过后的counter.jsx如下</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counter</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  	<span class="comment">//这里删去了state</span></span><br><span class="line">  	<span class="comment">//这里删去了handleIncrement方法，而改成在button中发起一个event</span></span><br><span class="line"> 	<span class="comment">//就是和onDelete一样</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.props);</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;React.Fragment&gt;</span><br><span class="line">        &lt;span className=&#123;<span class="keyword">this</span>.getBadgeClasses()&#125;&gt;&#123;<span class="keyword">this</span>.formatCount()&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button</span></span><br><span class="line"><span class="regexp">          onClick=&#123;() =&gt; this.props.onIncrement(this.props.counter)&#125;</span></span><br><span class="line"><span class="regexp">          className="btn btn-secondary btn-sm"</span></span><br><span class="line"><span class="regexp">        &gt;</span></span><br><span class="line"><span class="regexp">          Increment</span></span><br><span class="line"><span class="regexp">        &lt;/</span>button&gt;</span><br><span class="line">        &lt;button</span><br><span class="line">          onClick=&#123;() =&gt; <span class="keyword">this</span>.props.onDelete(<span class="keyword">this</span>.props.counter.id)&#125;</span><br><span class="line">          className=<span class="string">"btn btn-danger m-2"</span></span><br><span class="line">        &gt;</span><br><span class="line">          Delete</span><br><span class="line">        &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;p&gt;&lt;/</span>p&gt;</span><br><span class="line">      &lt;<span class="regexp">/React.Fragment&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  getBadgeClasses() &#123;</span></span><br><span class="line"><span class="regexp">    let classes = "badge m-2 badge-";</span></span><br><span class="line"><span class="regexp">      /</span><span class="regexp">/这里原本是this.state.value 我们把它改成了props中的value</span></span><br><span class="line"><span class="regexp">    classes += this.props.counter.value === 0 ? "warning" : "primary";</span></span><br><span class="line"><span class="regexp">    return classes;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  formatCount() &#123;</span></span><br><span class="line"><span class="regexp">    /</span><span class="regexp">/ 下面这行等于  const value = this.props.counter.value ;</span></span><br><span class="line"><span class="regexp">    const &#123; value &#125; = this.props.counter;</span></span><br><span class="line"><span class="regexp">    return value === 0 ? "Zero" : value;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Counter;</span></span><br></pre></td></tr></table></figure>
<p>然后我们在counters.jsx中处理counter发起的events</p>
<p>我们先在render中添加一个reset标签和一个onIncrement 的prop</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">  return (</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">onClick</span>=<span class="string">&#123;this.handleReset&#125;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">className</span>=<span class="string">"btn btn-primary btn-sm m-2"</span></span></span><br><span class="line"><span class="tag">      &gt;</span></span><br><span class="line">        Reset</span><br><span class="line">      <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;/<span class="name">br</span>&gt;</span></span><br><span class="line">      &#123;this.state.counters.map((counter) =&gt; (</span><br><span class="line">        <span class="tag">&lt;<span class="name">Counter</span></span></span><br><span class="line"><span class="tag">          <span class="attr">key</span>=<span class="string">&#123;counter.id&#125;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">onDelete</span>=<span class="string">&#123;this.handleDelete&#125;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">onIncrement</span>=<span class="string">&#123;this.handleIncrement&#125;//一个onIncrement的prop</span></span></span><br><span class="line"><span class="tag">          <span class="attr">counter</span>=<span class="string">&#123;counter&#125;</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line">      ))&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们来处理 handleIncrement</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">handleIncrement = <span class="function">(<span class="params">counter</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//首先我们通过 spread运算符来克隆一个和counters一模一样的数组</span></span><br><span class="line">  <span class="keyword">const</span> counters = [...this.state.counters];</span><br><span class="line">    <span class="comment">//然后我们获得传入的counter在counters数组当中的位置</span></span><br><span class="line">  <span class="keyword">const</span> index = counters.indexOf(counter);</span><br><span class="line">    <span class="comment">//然后我们再单独克隆一个该传入的counter对象，并把它赋值给新的counters</span></span><br><span class="line">  counters[index] = &#123; ...counter &#125;;</span><br><span class="line">    <span class="comment">//最后我们把这行的counter.value++</span></span><br><span class="line">  counters[index].value++;</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123; counters &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>最后我们写一个reset函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> handleReset = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"><span class="comment">//我们通过map函数把所有的counter.value都置为0，然后 用新的counters数组接收</span></span><br><span class="line">   <span class="keyword">const</span> counters = <span class="keyword">this</span>.state.counters.map(<span class="function">(<span class="params">c</span>) =&gt;</span> &#123;</span><br><span class="line">     c.value = <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">return</span> c;</span><br><span class="line">   &#125;);</span><br><span class="line">     <span class="comment">//利用setState更新</span></span><br><span class="line">   <span class="keyword">this</span>.setState(&#123; counters &#125;);</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/4.gif" style="zoom:80%;"></p>
<h3 id="Multiple-Components-in-Sync-多组件同步"><a href="#Multiple-Components-in-Sync-多组件同步" class="headerlink" title="Multiple Components in Sync 多组件同步"></a>Multiple Components in Sync 多组件同步</h3><p>现在我想在网页上加一个导航栏，里面记录当前有多少的counter，这样我们就需要把组件树改成这样子</p>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/29.png" style="zoom:80%;"></p>
<p>现在我们需要把index.js中的\<Counters \>改成\<App \> 然后再App.js中把这些组件放进去</App></Counters></p>
<p>当然了我们要在component当中新建一个navbar.jsx</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NavBar</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;nav className=<span class="string">"navbar navbar-light bg-light"</span>&gt;</span><br><span class="line">        &lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">"navbar-brand"</span> href=<span class="string">"#"</span>&gt;</span><br><span class="line">          Navbar</span><br><span class="line">        &lt;<span class="regexp">/a&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>nav&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> NavBar;</span><br></pre></td></tr></table></figure>
<p>然后对App.js做如下修改</p>
<p>App.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./App.css"</span>;</span><br><span class="line"><span class="keyword">import</span> NavBar <span class="keyword">from</span> <span class="string">"./components/navbar"</span>;</span><br><span class="line"><span class="keyword">import</span> Counters <span class="keyword">from</span> <span class="string">"./components/counters"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;React.Fragment&gt;</span><br><span class="line">      &lt;NavBar /&gt;</span><br><span class="line">      &lt;main className=<span class="string">"container"</span>&gt;</span><br><span class="line">        &lt;Counters /&gt;</span><br><span class="line">      &lt;<span class="regexp">/main&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>React.Fragment&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p>这就是我们结果了，我们看到组件树和我们要达到的是一致的</p>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/30.png" style="zoom:80%;"><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/31.png" style="zoom:80%;"></p>
<h3 id="Lifting-the-State-Up"><a href="#Lifting-the-State-Up" class="headerlink" title="Lifting the State Up"></a>Lifting the State Up</h3><p>我们现在想在导航栏中显示当前还有几个counter，那么问题就来了</p>
<p>之前我们是通过props的特性，把Counters组件当中的state传到Counter组件当中的，</p>
<p>因为Counters和Counter是上下层的关系。但是Counters组件和NavBar没有父子关系。怎么办呢？</p>
<p>当我们想要在两个没有上下父子级别的关系的组件中共享和同步数据的时候物品，我们就需要上移组件。在这里我们需要把Counters和NavBar组件上移到他们共同的父级App组件当中。然后我们在App的所有的子组件全部使用props。如下图</p>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/32.png" style="zoom: 67%;"></p>
<p>（奇怪，为什么app.js中的app还是function而不是class呢。。。所以我改了一下）</p>
<p>我们已经知道App.js中已经包含了我们的\<NavBar \> 那么我们现在就把Counters中的所有的方法都移到App组件当中，把Counters变成一个受控组件（就如当初Counter被变成受控组件一样） ，然后通过props来抛出一个event交给App来处理</NavBar></p>
<p>移动过后的counters.js(一滴都不剩了)</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Counter <span class="keyword">from</span> <span class="string">"./counter"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counters</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button</span><br><span class="line">            <span class="comment">//原来的onReset现在变成了一个prop</span></span><br><span class="line">          onClick=&#123;<span class="keyword">this</span>.props.onReset&#125;</span><br><span class="line">          className=<span class="string">"btn btn-primary btn-sm m-2"</span></span><br><span class="line">        &gt;</span><br><span class="line">          Reset</span><br><span class="line">        &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;br&gt;&lt;/</span>br&gt;</span><br><span class="line">            &#123;<span class="comment">/*原来的state.counters现在变成了一个prop.counters</span></span><br><span class="line"><span class="comment">            	原来的onDelete 变成了props.onDelete</span></span><br><span class="line"><span class="comment">            	....</span></span><br><span class="line"><span class="comment">            */</span>&#125;</span><br><span class="line">        &#123;<span class="keyword">this</span>.props.counters.map(<span class="function">(<span class="params">counter</span>) =&gt;</span> (</span><br><span class="line">          &lt;Counter</span><br><span class="line">            key=&#123;counter.id&#125;</span><br><span class="line">            onDelete=&#123;<span class="keyword">this</span>.props.onDelete&#125;</span><br><span class="line">            onIncrement=&#123;<span class="keyword">this</span>.props.onIncrement&#125;</span><br><span class="line">            counter=&#123;counter&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Counters;</span></span><br></pre></td></tr></table></figure>
<p>同样的我们在App.js中需要接受并处理这些events</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">"./App.css"</span>;</span><br><span class="line"><span class="keyword">import</span> NavBar <span class="keyword">from</span> <span class="string">"./components/navbar"</span>;</span><br><span class="line"><span class="keyword">import</span> Counters <span class="keyword">from</span> <span class="string">"./components/counters"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">"react-dom"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;&#125;;</span><br><span class="line">  state = &#123;</span><br><span class="line">    counters: [</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">value</span>: <span class="number">4</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">value</span>: <span class="number">0</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">value</span>: <span class="number">0</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">value</span>: <span class="number">0</span> &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  handleDelete = <span class="function">(<span class="params">counterID</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> counters = <span class="keyword">this</span>.state.counters.filter(<span class="function">(<span class="params">c</span>) =&gt;</span> c.id !== counterID);</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; counters &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  handleIncrement = <span class="function">(<span class="params">counter</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> counters = [...this.state.counters];</span><br><span class="line">    <span class="keyword">const</span> index = counters.indexOf(counter);</span><br><span class="line">    counters[index] = &#123; ...counter &#125;;</span><br><span class="line">    counters[index].value++;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; counters &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  handleReset = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> counters = <span class="keyword">this</span>.state.counters.map(<span class="function">(<span class="params">c</span>) =&gt;</span> &#123;</span><br><span class="line">      c.value = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span> c;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; counters &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="comment">//上边的，都是原来counters.js中的内容</span></span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;React.Fragment&gt;</span><br><span class="line">        &lt;NavBar</span><br><span class="line"><span class="comment">//在NavBar中，我们需要传入一个totalCounters 的prop供给NavBar组件显示</span></span><br><span class="line">          totalCounters=&#123;<span class="keyword">this</span>.state.counters.filter(<span class="function"><span class="params">c</span> =&gt;</span> c.value &gt; <span class="number">0</span>).length&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;main className=<span class="string">"container"</span>&gt;</span><br><span class="line">          &lt;Counters</span><br><span class="line">        <span class="comment">//给Counters几个props行行好吧。。让Counters的events能被处理吧</span></span><br><span class="line">            counters=&#123;<span class="keyword">this</span>.state.counters&#125;</span><br><span class="line">            onReset=&#123;<span class="keyword">this</span>.handleReset&#125;</span><br><span class="line">            onIncrement=&#123;<span class="keyword">this</span>.handleIncrement&#125;</span><br><span class="line">            onDelete=&#123;<span class="keyword">this</span>.handleDelete&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;<span class="regexp">/main&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>React.Fragment&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<p>最后在NavBar组件当中显示</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NavBar</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;nav className=<span class="string">"navbar navbar-light bg-light"</span>&gt;</span><br><span class="line">        &lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">"navbar-brand"</span> href=<span class="string">"#"</span>&gt;</span><br><span class="line">          Navbar&#123;<span class="string">" "</span>&#125;</span><br><span class="line">            &#123;<span class="comment">/*新建一个span标签来显示我们的数字*/</span>&#125;</span><br><span class="line">          &lt;span className=<span class="string">"badge badge-pill badge-secondary"</span>&gt;</span><br><span class="line">            &#123;<span class="keyword">this</span>.props.totalCounters&#125;</span><br><span class="line">          &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>a&gt;</span><br><span class="line">      &lt;<span class="regexp">/nav&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default NavBar;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/5.gif" style="zoom:80%;"></p>
<h3 id="Stateless-Functional-Components"><a href="#Stateless-Functional-Components" class="headerlink" title="Stateless Functional Components"></a>Stateless Functional Components</h3><p>我们回到NavBar组件，他没有state，没有方法，他只从props中获取数据，对于这种组件我们就可以把它变成</p>
<p>Stateless Functional Components，也就是我们说的无state的功能性属性</p>
<p>这时候我们就可以用function来定义了</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> NavBar = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;nav className=<span class="string">"navbar navbar-light bg-light"</span>&gt;</span><br><span class="line">      &lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">"navbar-brand"</span> href=<span class="string">"#"</span>&gt;</span><br><span class="line">        Navbar&#123;<span class="string">" "</span>&#125;</span><br><span class="line">        &lt;span className=<span class="string">"badge badge-pill badge-secondary"</span>&gt;</span><br><span class="line">          &#123;<span class="keyword">this</span>.props.totalCounters&#125;</span><br><span class="line">        &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>a&gt;</span><br><span class="line">    &lt;<span class="regexp">/nav&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">export default NavBar;</span></span><br></pre></td></tr></table></figure>
<p>原来如此，这就解决了刚才为什么App是一个函数的原因了</p>
<h3 id="Destructuring-Arguments"><a href="#Destructuring-Arguments" class="headerlink" title="Destructuring Arguments"></a>Destructuring Arguments</h3><p>现在我们来简化代码，我已经不想漫天打props了，我们怎么才能解决啊？</p>
<p>可以用解构（Destructuring）</p>
<h4 id="在函数中解构props"><a href="#在函数中解构props" class="headerlink" title="在函数中解构props"></a>在函数中解构props</h4><p>在NavBar中我们直接收了一个prop</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="comment">//那么我们就可以在传入参数的时候解构</span></span><br><span class="line"><span class="keyword">const</span> NavBar = <span class="function">(<span class="params">&#123;totalCounters&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;nav className=<span class="string">"navbar navbar-light bg-light"</span>&gt;</span><br><span class="line">      &lt;a <span class="class"><span class="keyword">class</span></span>=<span class="string">"navbar-brand"</span> href=<span class="string">"#"</span>&gt;</span><br><span class="line">        Navbar&#123;<span class="string">" "</span>&#125;</span><br><span class="line">        &lt;span className=<span class="string">"badge badge-pill badge-secondary"</span>&gt;</span><br><span class="line"> &#123;<span class="comment">/*这样在span里就可以不用打this.props.totalCounters了，直接totalCounters就完事了*/</span>&#125;</span><br><span class="line">          &#123;totalCounters&#125;</span><br><span class="line">        &lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>a&gt;</span><br><span class="line">    &lt;<span class="regexp">/nav&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp">export default NavBar;</span></span><br></pre></td></tr></table></figure>
<h4 id="在class中解构props"><a href="#在class中解构props" class="headerlink" title="在class中解构props"></a>在class中解构props</h4><p>那么在Counters组件中我们有多个props，我们也可以解构他</p>
<p>解构的顺序不要紧，只要名字对上即可</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> Counter <span class="keyword">from</span> <span class="string">"./counter"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counters</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">      <span class="comment">//那么这时候我们就直接用解构的语法来写了</span></span><br><span class="line">    <span class="keyword">const</span> &#123; onReset, counters, onDelete, onIncrement &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;onReset&#125; <span class="comment">/*简化*/</span>className=<span class="string">"btn btn-primary btn-sm m-2"</span>&gt;</span><br><span class="line">          Reset</span><br><span class="line">        &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;br&gt;&lt;/</span>br&gt;</span><br><span class="line">        &#123;<span class="comment">/*简化*/</span>counters.map(<span class="function">(<span class="params">counter</span>) =&gt;</span> (</span><br><span class="line">          &lt;Counter</span><br><span class="line">            key=&#123;counter.id&#125;</span><br><span class="line">            onDelete=&#123;onDelete&#125;<span class="comment">/*简化*/</span></span><br><span class="line">            onIncrement=&#123;onIncrement&#125;<span class="comment">/*简化*/</span></span><br><span class="line">            counter=&#123;counter&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Counters;</span></span><br></pre></td></tr></table></figure>
<h3 id="Lifecycle-Hooks"><a href="#Lifecycle-Hooks" class="headerlink" title="Lifecycle Hooks"></a>Lifecycle Hooks</h3><p>一个组件会经历很多的状态，在他的生命周期中，第一个状态是mount  状态，这是组件被实例化并被创建到DOM当中。这里有一些可以加入组件的特殊方法，react会自动调用这些方法</p>
<p>我们叫这些方法为Lifecycle Hooks。它们允许我们在整个生命周期中勾住某个特定的时刻，并做一些事情。</p>
<p>在Mount 状态中有三个 Lifecycle Hooks：constructor，render，componentDidMount，react会顺序调用这些方法</p>
<p>第二个状态是Update状态，他在state或者组件的props改变的时候发生。在这个状态中有render 和 componentDidUpdate两个Lifecycle Hooks。当我们改变state或者传入新的props的时候，会依次调用这两个Lifecycle Hooks</p>
<p>第三个状态是UnMount.这个状态是当一个组件被DOM移除（删除）的时候发生，里面有componentWillUnmount一个Lifecycle Hooks，当我们要删除一个组建的时候，会被react调用</p>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/34.png" style="zoom:80%;"></p>
<p>还有很多其他的Lifecycle Hooks，我们很少用到</p>
<h3 id="Mounting-Phase"><a href="#Mounting-Phase" class="headerlink" title="Mounting Phase"></a>Mounting Phase</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">	state = &#123;&#125;;</span><br><span class="line">	<span class="comment">//因为构造器只调用一次，所以这是设置属性的最佳时机</span></span><br><span class="line">	<span class="keyword">constructor</span>(props)&#123;</span><br><span class="line">		<span class="keyword">super</span>(props);</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'App-Constructor'</span>);</span><br><span class="line">		<span class="keyword">this</span>.state = <span class="keyword">this</span>.props.something;</span><br><span class="line">	&#125;;</span><br><span class="line">	componentDidMount()&#123;</span><br><span class="line">		<span class="comment">//Ajax Call</span></span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'App-Mounted'</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	handleIncrement = <span class="function"><span class="params">counter</span>=&gt;</span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;;</span><br><span class="line">	render()&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'App-Rendered'</span>);</span><br><span class="line">        <span class="comment">//....</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/33.png" style="zoom:80%;"></p>
<h3 id="Updating-Phase"><a href="#Updating-Phase" class="headerlink" title="Updating Phase"></a>Updating Phase</h3><p>//…</p>
<h3 id="Unmounting-Phase"><a href="#Unmounting-Phase" class="headerlink" title="Unmounting Phase"></a>Unmounting Phase</h3><p>//…</p>
<h3 id="Exercise-Decrement-Button"><a href="#Exercise-Decrement-Button" class="headerlink" title="Exercise- Decrement Button"></a>Exercise- Decrement Button</h3><p>加一个Decrement 按钮实现-1 操作</p>
<h3 id="Solution-Decrement-Button"><a href="#Solution-Decrement-Button" class="headerlink" title="Solution - Decrement Button"></a>Solution - Decrement Button</h3><p>在counter.jsx 中加一个按钮</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;button</span><br><span class="line">  onClick=&#123;()=&gt;<span class="keyword">this</span>.props.onDecrement(<span class="keyword">this</span>.props.counter)&#125;</span><br><span class="line">  className=<span class="string">"btn btn-secondary btn-sm m-2"</span></span><br><span class="line">&gt;</span><br><span class="line">  Decrement</span><br><span class="line">&lt;<span class="regexp">/button&gt;</span></span><br></pre></td></tr></table></figure>
<p>在counters.jsx中处理这个事件，向上(App)抛</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Counters</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; onReset, counters, onDelete, onIncrement ,onDecrement &#125; = <span class="keyword">this</span>.props;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;onReset&#125; className=<span class="string">"btn btn-primary btn-sm m-2"</span>&gt;</span><br><span class="line">          Reset</span><br><span class="line">        &lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;br&gt;&lt;/</span>br&gt;</span><br><span class="line">        &#123;counters.map(<span class="function">(<span class="params">counter</span>) =&gt;</span> (</span><br><span class="line">          &lt;Counter</span><br><span class="line">            key=&#123;counter.id&#125;</span><br><span class="line">            onDelete=&#123;onDelete&#125;</span><br><span class="line">            onIncrement=&#123;onIncrement&#125;</span><br><span class="line">            onDecrement=&#123;onDecrement&#125;</span><br><span class="line">            counter=&#123;counter&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p>在App.js中处理这个事件</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">  handleDerement = <span class="function">(<span class="params">counter</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> counters = [...this.state.counters];</span><br><span class="line">    <span class="keyword">const</span> index = counters.indexOf(counter);</span><br><span class="line">    counters[index] = &#123; ...counter &#125;;</span><br><span class="line">    counters[index].value--;</span><br><span class="line">    <span class="keyword">this</span>.setState(&#123; counters &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//....</span></span><br><span class="line">render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;React.Fragment&gt;</span><br><span class="line">        &lt;NavBar</span><br><span class="line">          totalCounters=&#123;<span class="keyword">this</span>.state.counters.filter(<span class="function">(<span class="params">c</span>) =&gt;</span> c.value &gt; <span class="number">0</span>).length&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">        &lt;main className=<span class="string">"container"</span>&gt;</span><br><span class="line">          &lt;Counters</span><br><span class="line">            counters=&#123;<span class="keyword">this</span>.state.counters&#125;</span><br><span class="line">            onReset=&#123;<span class="keyword">this</span>.handleReset&#125;</span><br><span class="line">            onIncrement=&#123;<span class="keyword">this</span>.handleIncrement&#125;</span><br><span class="line">            onDecrement=&#123;<span class="keyword">this</span>.handleDerement&#125;<span class="comment">//加一个功能</span></span><br><span class="line">            onDelete=&#123;<span class="keyword">this</span>.handleDelete&#125;</span><br><span class="line">          /&gt;</span><br><span class="line">        &lt;<span class="regexp">/main&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>React.Fragment&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="Exercise-Like-Component"><a href="#Exercise-Like-Component" class="headerlink" title="Exercise- Like Component"></a>Exercise- Like Component</h3><p>设计一个接口实现点赞操作</p>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/39.png" alt></p>
<h3 id="Solution-Like-Component"><a href="#Solution-Like-Component" class="headerlink" title="Solution- Like Component"></a>Solution- Like Component</h3><p>首先我们要在<a href="https://fontawesome.com/v4.7.0/icon/heart-o" target="_blank" rel="noopener">https://fontawesome.com/v4.7.0/icon/heart-o</a> 复制 心形代码，注意，实心的和空心的差了一个-o：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"fa fa-heart-o"</span> <span class="attr">aria-hidden</span>=<span class="string">"true"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后我们在components 中新建一个common文件夹，里面包含Like组件</p>
<p>like组件声明如下,Like是一个受控组件，我们也可以把它当成funtcion来写，但这里还是class</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; Component &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Input: liked:boolean</span></span><br><span class="line"><span class="comment">// Output: onClick</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Like</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">let</span> classes = <span class="string">"fa fa-heart"</span>;</span><br><span class="line"> <span class="comment">//如果不喜欢（liked=false） 那么就变成空心，这里liked是一个prop,是父组件传给Like的</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.props.liked) classes += <span class="string">"-o"</span>;</span><br><span class="line">      <span class="comment">//返回一个心型组件</span></span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;i</span><br><span class="line">          <span class="comment">//组件中有onClick方法，当点击的时候会调用props中的onClick属性</span></span><br><span class="line">        onClick=&#123;<span class="keyword">this</span>.props.onClick&#125;</span><br><span class="line">          <span class="comment">//当鼠标移动到心上的时候，会变成手状</span></span><br><span class="line">        style=&#123;&#123; <span class="attr">cursor</span>: <span class="string">"pointer"</span> &#125;&#125;</span><br><span class="line">          <span class="comment">//className 就不用我多说了8</span></span><br><span class="line">        className=&#123;classes&#125;</span><br><span class="line">        aria-hidden=<span class="string">"true"</span></span><br><span class="line">      &gt;&lt;<span class="regexp">/i&gt;</span></span><br><span class="line"><span class="regexp">    );</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Like;</span></span><br></pre></td></tr></table></figure>
<p>那么我们需要在Movies中添加一个onClick的props，然后新建一个handler处理这个event</p>
<p>首先新添加一列，让他囊括我Like组件，并且传入一个liked和一个onClick props</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;td&gt;</span><br><span class="line">  &lt;Like</span><br><span class="line">	liked=&#123;movie.liked&#125;</span><br><span class="line">      <span class="comment">// 其中 onClick因为是要把那行的心变成实心的，所以我们要通过箭头函数传入一个movie</span></span><br><span class="line">    onClick=&#123;() =&gt; <span class="keyword">this</span>.handleLike(movie)&#125;</span><br><span class="line">  /&gt;</span><br><span class="line">&lt;<span class="regexp">/td&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后我们开始处理handleLike，一样的套路我们新建一个movies列表，然后把对应的movies的liked属性取反。（原来喜欢的变成不喜欢，原来不喜欢的变成喜欢，因为我默认liked属性是不喜欢的，所以一开始都是空心的）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">handleLike = <span class="function">(<span class="params">movie</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> movies = [...this.state.movies];</span><br><span class="line">  <span class="keyword">const</span> number = movies.indexOf(movie);</span><br><span class="line">  movies[number] = &#123; ...movies[number] &#125;;</span><br><span class="line">  movies[number].liked = !movies[number].liked;</span><br><span class="line">  <span class="keyword">this</span>.setState(&#123; movies &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/30/react%E5%9F%BA%E7%A1%80/7.gif" style="zoom:120%;"></p>
<h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p>这一章节我们学了</p>
<p><strong>如何利用props传递数据</strong></p>
<p><strong>发起和处理时间</strong></p>
<p><strong>怎么上移state（利用这种技巧我可以让多个组件共享一个数据源）</strong></p>
<p><strong>Functional Component</strong> </p>
<p><strong>Lifecycle Hooks</strong></p>
<p>后文请移步</p>
<p><a href="https://jasonxqh.github.io/2020/06/02/react基础2/">react基础2</a></p>
<p><a href="https://jasonxqh.github.io/2020/06/04/react基础3/">react基础3表单与后端</a></p>
<p><a href="https://jasonxqh.github.io/2020/06/05/react基础4授权与部署/">react基础4授权与部署</a></p>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/30/sscanf%E5%92%8Csprintf/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/30/sscanf%E5%92%8Csprintf/" itemprop="url">sscanf和sprintf</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-05-30T14:25:46+08:00">
                2020-05-30
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2020-06-21T12:43:42+08:00">
                2020-06-21
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="sscanf和sprintf"><a href="#sscanf和sprintf" class="headerlink" title="sscanf和sprintf"></a>sscanf和sprintf</h1><p>这两个函数其实是C中的函数，所以操作的是字符数组，不是string类型，当然C++也能用。</p>
<p>还可以用streamstring 类实现</p>
<p>文章学习自</p>
<p><a href="https://www.cnblogs.com/hujunzheng/p/5042068.html" target="_blank" rel="noopener">博客</a></p>
<h2 id="常见的格式串"><a href="#常见的格式串" class="headerlink" title="常见的格式串"></a>常见的格式串</h2><p>　    %% 印出百分比符号，不转换。<br>　　%c 整数转成对应的 ASCII 字元。<br>　　%d 整数转成十进位。<br>　　%f 倍精确度数字转成浮点数。<br>　　%o 整数转成八进位。<br>　　%s 整数转成字符串。<br>　　%x 整数转成小写十六进位。<br>　　%X 整数转成大写十六进位。<br>　　%n sscanf(str, “%d%n”, &amp;dig, &amp;n)，%n表示一共转换了多少位的字符</p>
<h2 id="sprintf函数"><a href="#sprintf函数" class="headerlink" title="sprintf函数"></a>sprintf函数</h2><p>　　 sprintf函数原型为 int sprintf(char <em>str, const char </em>format, …)。作用是格式化字符串，具体功能如下所示：</p>
<p>　　（1）将数字变量转换为字符串。</p>
<p>　　（2）得到整型变量的16进制和8进制字符串。</p>
<p>　　（3）连接多个字符串。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> str[<span class="number">256</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="keyword">int</span> data = <span class="number">1024</span>;</span><br><span class="line">    <span class="comment">//将data转换为字符串</span></span><br><span class="line">    <span class="built_in">sprintf</span>(str,<span class="string">"%d"</span>,data);</span><br><span class="line">    <span class="comment">//获取data的十六进制</span></span><br><span class="line">    <span class="built_in">sprintf</span>(str,<span class="string">"0x%X"</span>,data);</span><br><span class="line">    <span class="comment">//获取data的八进制</span></span><br><span class="line">    <span class="built_in">sprintf</span>(str,<span class="string">"0%o"</span>,data);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *s1 = <span class="string">"Hello"</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *s2 = <span class="string">"World"</span>;</span><br><span class="line">    <span class="comment">//连接字符串s1和s2</span></span><br><span class="line">    <span class="built_in">sprintf</span>(str,<span class="string">"%s %s"</span>,s1,s2);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;str&lt;&lt;<span class="built_in">endl</span>; </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="sscanf函数"><a href="#sscanf函数" class="headerlink" title="sscanf函数"></a>sscanf函数</h2><p>sscanf函数原型为int sscanf(const char <em>str, const char </em>format, …)。将参数str的字符串根据参数format字符串来转换并格式化数据，转换后的结果存于对应的参数内。具体功能如下：</p>
<p>　　（1）根据格式从字符串中提取数据。如从字符串中取出整数、浮点数和字符串等。</p>
<p>　　（2）取指定长度的字符串</p>
<p>　　（3）取到指定字符为止的字符串</p>
<p>　　（4）取仅包含指定字符集的字符串</p>
<p>　　（5）取到指定字符集为止的字符串</p>
<p> 例子：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> s[<span class="number">15</span>] = <span class="string">"123.432,432"</span>;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">double</span> f1;</span><br><span class="line">    <span class="keyword">int</span> f2;</span><br><span class="line">    <span class="built_in">sscanf</span>(s, <span class="string">"%lf,%d%n"</span>, &amp;f1, &amp;f2, &amp;n);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;f1&lt;&lt;<span class="string">" "</span>&lt;&lt;f2&lt;&lt;<span class="string">" "</span>&lt;&lt;n;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> ch1[<span class="number">20</span>],ch2[<span class="number">20</span>],ch3[<span class="number">40</span>],str[<span class="number">20</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">   <span class="keyword">while</span>(gets(ch3))</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">if</span>(!<span class="built_in">strlen</span>(ch3))</span><br><span class="line">         <span class="keyword">break</span>;</span><br><span class="line">      <span class="built_in">sscanf</span>(ch3,<span class="string">"%s %s"</span>,ch1,ch2); </span><br><span class="line">       <span class="comment">//...</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/30/sstream/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/30/sstream/" itemprop="url">sstream</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-05-30T13:39:55+08:00">
                2020-05-30
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2020-05-30T14:17:10+08:00">
                2020-05-30
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="C-中的ssstream"><a href="#C-中的ssstream" class="headerlink" title="C++中的ssstream"></a>C++中的ssstream</h1><p>本文学习自</p>
<p><a href="https://www.cnblogs.com/wuchanming/p/3906176.html" target="_blank" rel="noopener">博客1</a></p>
<p><a href="https://blog.csdn.net/xw20084898/article/details/21939811" target="_blank" rel="noopener">博客2</a></p>
<p>C++引入了ostringstream、istringstream、stringstream这三个类，要使用他们创建对象就必须包含sstream.h头文件。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sstream&gt;</span></span></span><br></pre></td></tr></table></figure>
<p><strong>istringstream类</strong>用于执行C++风格的串流的输入操作。<br><strong>ostringstream</strong>类用于执行C风格的串流的输出操作。<br><strong>stringstream</strong>类同时可以支持C风格的串流的输入输出操作。</p>
<p>istringstream类是从istream和stringstreambase派生而来，</p>
<p>ostringstream是从ostream和 stringstreambase派生而来，</p>
<p> stringstream则是从iostream类和stringstreambase派生而来。</p>
<p>继承关系如下图</p>
<p><img src="/2020/05/30/sstream/1.gif" alt></p>
<h3 id="istringstream"><a href="#istringstream" class="headerlink" title="istringstream"></a>istringstream</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">istringstream</span> istr;</span><br><span class="line">    istr.str(<span class="string">"1 56.7"</span>);</span><br><span class="line">    <span class="comment">//上述两个过程可以简单写成 istringstream istr("1 56.7");</span></span><br><span class="line">	<span class="comment">//str()成员函数的使用可以让istringstream对象返回一个string字符串</span></span><br><span class="line">    <span class="comment">// 例如本例中的输出操作 cout&lt;&lt;istr.str(); 。</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; istr.str() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">float</span> b;</span><br><span class="line">    istr &gt;&gt; a;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; a &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    istr &gt;&gt; b;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; b &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">输出:</span></span><br><span class="line"><span class="comment">1 56.7</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">56.7</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>上例中，构造字符串流的时候，空格会成为字符串参数的内部分界，例子中对a,b对象的输入”赋值”操作证明了这一点，字符串的空格成为了整型数据与浮点型数据的分解点，利用分界获取的方法我们事实上完成了字符串到整型对象与浮点型对象的拆分转换过程。</p>
<h3 id="ostringstream"><a href="#ostringstream" class="headerlink" title="ostringstream"></a>ostringstream</h3><p>ostringstream同样是由一个string对象构造而来，ostringstream类向一个string插入字符。<br>ostringstream的构造函数原形如下：<br>ostringstream::ostringstream(string str); </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">ostringstream</span> ostr;</span><br><span class="line">    ostr.str(<span class="string">"abc"</span>);</span><br><span class="line"><span class="comment">//如果构造的时候设置了字符串参数,那么增长操作的时候不会从结尾开始增加,而是修改原有数据  </span></span><br><span class="line">    ostr.<span class="built_in">put</span>(<span class="string">'d'</span>);</span><br><span class="line">    ostr.<span class="built_in">put</span>(<span class="string">'e'</span>);</span><br><span class="line">    ostr.<span class="built_in">put</span>(<span class="string">'f'</span>);</span><br><span class="line">    ostr.<span class="built_in">put</span>(<span class="string">'g'</span>);</span><br><span class="line">    ostr&lt;&lt;<span class="string">"hi"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">string</span> gstr = ostr.str();</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;gstr;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出	defghi</span></span><br></pre></td></tr></table></figure>
<p>在上例代码中，我们通过put()或者左移操作符可以不断向ostr插入<strong>单个字符或者是字符串</strong>，通过str()函数返回增长过后的完整字符串数据</p>
<p>但值得注意的一点是，当构造的时候对象内已经存在字符串数据的时候，那么增长操作的时候不会从结尾开始增加,而是修改原有数据,超出的部分增长。</p>
<h3 id="stringstream"><a href="#stringstream" class="headerlink" title="stringstream"></a>stringstream</h3><p>它是用于C++风格的字符串的输入输出的。 stringstream的构造函数原形如下：</p>
<p>stringstream::stringstream(string str);</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function"><span class="built_in">stringstream</span> <span class="title">ostr</span><span class="params">(<span class="string">"ccc"</span>)</span></span>;</span><br><span class="line">ostr.<span class="built_in">put</span>(<span class="string">'d'</span>);</span><br><span class="line">ostr.<span class="built_in">put</span>(<span class="string">'e'</span>);</span><br><span class="line">ostr&lt;&lt;<span class="string">"fg"</span>;</span><br><span class="line"><span class="built_in">string</span> gstr = ostr.str();</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;gstr&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> a;</span><br><span class="line">ostr&gt;&gt;a;</span><br><span class="line"><span class="built_in">cout</span>&lt;&lt;a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">输出</span></span><br><span class="line"><span class="comment">defg</span></span><br><span class="line"><span class="comment">d</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h4 id="stringstream在题目中常常用来做字符串切割"><a href="#stringstream在题目中常常用来做字符串切割" class="headerlink" title="stringstream在题目中常常用来做字符串切割"></a>stringstream在题目中常常用来做字符串切割</h4><p>1.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//每次读取一行字符串，一直读到空串为止</span></span><br><span class="line"><span class="keyword">while</span>(getline(<span class="built_in">cin</span>,s))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(!s.<span class="built_in">size</span>())</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">    <span class="comment">//假设输入每行有两个单词，那么就可以利用stringstream的特性读入两个字符串，以空格为间</span></span><br><span class="line">    <span class="function"><span class="built_in">stringstream</span> <span class="title">ss</span><span class="params">(s)</span></span>;</span><br><span class="line">	ss&gt;&gt;word1&gt;&gt;word2;</span><br><span class="line">    <span class="comment">//.....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">//可以先用 clear( )以及 str( ) 將指定字串設定成一开始的內容，再用 &gt;&gt; 把个別的资料输出，例如：</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">string</span> s;</span><br><span class="line">    <span class="built_in">stringstream</span> ss;</span><br><span class="line">    <span class="keyword">int</span> a, b, c;</span><br><span class="line">    getline(<span class="built_in">cin</span>, s);</span><br><span class="line">    ss.<span class="built_in">clear</span>();</span><br><span class="line">    ss.str(s);</span><br><span class="line">    ss &gt;&gt; a &gt;&gt; b &gt;&gt; c;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;a&lt;&lt;<span class="string">" "</span>&lt;&lt;b&lt;&lt;<span class="string">" "</span>&lt;&lt;c&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="使用stringstream对象简化类型转换"><a href="#使用stringstream对象简化类型转换" class="headerlink" title="使用stringstream对象简化类型转换"></a>使用stringstream对象简化类型转换</h4><p>1.int 到string的转换</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt; </span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">stringstream</span> stream;</span><br><span class="line">    <span class="built_in">string</span> result;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">1000</span>;</span><br><span class="line">    stream &lt;&lt; i; <span class="comment">//将int输入流</span></span><br><span class="line">    stream &gt;&gt; result; <span class="comment">//从stream中抽取前面插入的int值</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; result &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// print the string "1000"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.string到int的转换</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> result=”<span class="number">10000</span>”;</span><br><span class="line"><span class="keyword">int</span> n=<span class="number">0</span>;</span><br><span class="line">stream&lt;&lt;result;</span><br><span class="line">stream&gt;&gt;n;<span class="comment">//n等于10000</span></span><br></pre></td></tr></table></figure>
<p>3.连接string和int，使其成为一个整体</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">string</span> name = <span class="string">"Bob"</span>;</span><br><span class="line">    <span class="keyword">int</span> age = <span class="number">22</span>;</span><br><span class="line">    <span class="built_in">stringstream</span>  ss;</span><br><span class="line">    ss&lt;&lt;<span class="string">"Name is : "</span>;		<span class="comment">//把"Name is : "字符串输入到ss中去</span></span><br><span class="line">    ss&lt;&lt;name;				<span class="comment">//把name输入到ss中去</span></span><br><span class="line">    ss&lt;&lt;<span class="string">"; Age is : "</span>;		<span class="comment">//把"; Age is : "字符串输入到ss中去</span></span><br><span class="line">    ss&lt;&lt;age;				<span class="comment">//把 int类型的age加入到ss中去</span></span><br><span class="line">    <span class="built_in">string</span> info = ss.str();</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;info&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment"> 我们可以直接用+连接两个字符串，但是没用办法用+ 连接int和string类型，stringstream帮我们做到了</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出: 	Name is : Bob; Age is : 22</span></span><br></pre></td></tr></table></figure>
<p>4.int 转换为char</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">stringstream</span> stream;</span><br><span class="line">    <span class="keyword">char</span> result[<span class="number">8</span>];</span><br><span class="line">    <span class="keyword">int</span> number = <span class="number">8888</span>;</span><br><span class="line">    stream &lt;&lt; number; <span class="comment">//向stream中插入8888</span></span><br><span class="line">    stream &gt;&gt; result; <span class="comment">//抽取stream中的值到result</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; result &lt;&lt; <span class="built_in">endl</span>; <span class="comment">// 屏幕显示 "8888"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5.进行多次转换，必须调用stringstream的成员函数clear()</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">stringstream</span> stream;</span><br><span class="line">    <span class="keyword">int</span> first,second;</span><br><span class="line">    stream &lt;&lt; <span class="string">"456"</span>;<span class="comment">//插入字符串</span></span><br><span class="line">    stream &gt;&gt; first;<span class="comment">//转换成int</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; first &lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    stream.<span class="built_in">clear</span>();<span class="comment">//在进行多次转换前，必须清除stream</span></span><br><span class="line">    stream &lt;&lt; <span class="literal">true</span>;<span class="comment">//插入bool值</span></span><br><span class="line">    stream &gt;&gt; second ;<span class="comment">//提取出int</span></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; second &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">输出:</span></span><br><span class="line"><span class="comment">456</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">如果没有clear</span></span><br><span class="line"><span class="comment">那么会出现下面的结果</span></span><br><span class="line"><span class="comment">456</span></span><br><span class="line"><span class="comment">43	//不知所云</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/30/Trie%E6%A0%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/30/Trie%E6%A0%91/" itemprop="url">Trie树</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-05-30T09:06:14+08:00">
                2020-05-30
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2020-06-21T12:44:04+08:00">
                2020-06-21
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%A0%91/" itemprop="url" rel="index">
                    <span itemprop="name">树</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Trie树"><a href="#Trie树" class="headerlink" title="Trie树"></a>Trie树</h1><p>​    字典树又称Trie树，是单词查找树，是一种树形结构，也是哈希书的变种。典型应用于统计中，排序和保存大量字符串（但不仅仅限于字符串），所以经常被搜索引擎系统用于文本字频统计。它的优点是：利用字符串的公共前缀来减少查询时间，最大限度地减少无所谓的字符串比较，查询效率要比哈系树高</p>
<p>Trie树地3个基本性质：</p>
<ol>
<li>根节点不包含字符，根节点外地每一个节点都只包含一个字符</li>
<li>从根节点到某一个节点，路径上经过的字符连接起来，为该点对应地字符串</li>
<li><strong>每个节点</strong>的所有子节点包含的<strong>字符都不相同</strong></li>
</ol>
<p>所以每一个节点最多可以有26个子节点，对应26个字母（假设全部都为小写）。可以利用指针存储（比较浪费空间），也可以利用孩子兄弟表示法，也就是说可以利用左孩子右兄弟（比较难以理解）。一般指针表示最简单最直观。</p>
<p><img src="/2020/05/30/Trie%E6%A0%91/1.png" style="zoom:80%;"></p>
<p>这里，我们如果只是想记录单词是否存在，那么end[]中可存放一个布尔值，如果我们想记录单词的个数，那么我们就需要存放一个数字，再次遇到的时候就++。所以我们要知道不一定是到了叶子，才是一个单词</p>
<p><img src="/2020/05/30/Trie%E6%A0%91/2.png" style="zoom:120%;"></p>
<h2 id="字典树的创建"><a href="#字典树的创建" class="headerlink" title="字典树的创建"></a>字典树的创建</h2><p><img src="/2020/05/30/Trie%E6%A0%91/3.png" style="zoom:120%;"></p>
<p><img src="/2020/05/30/Trie%E6%A0%91/4.png" style="zoom:120%;"></p>
<p>前一个[]中的数字是根的下标，后面一个是指针域。trie[1][1] = 2 的2是创建了第二个节点的意思，每个节点都是26个域。</p>
<p>然后判断第二个字符（i）s[1]-\’a\’ = 8 那么在 trie[2][8] 上判断是不是等于0，是等于0，我们把它改为3，表明创建了第三个节点</p>
<p>第三个字符（k）s[2]-‘a’ = 10 那么判断trie[3][10]  上判断是不是等于0，如果等于0，我们把它改成4，表明创建了第四个节点 </p>
<p>第四个字符（e）s[3]-‘a’ = 4 那么判断trie[4][4]  上判断是不是等于0，如果等于0，我们把它改成5，表明创建了第五个节点 </p>
<p>处理完毕后加上一个end[]标记，表示这是一个单词。</p>
<p>那么我如果再想要插入bin，那么发现trie[1][1] 不是0，那么说明b节点已经被创建过了，那么直接去找他就行了。</p>
<p>同样i也创建过了， n没创建过，那么就新建一个节点trie[3][13] = 4 ,同时加上end标记</p>
<h3 id="算法代码"><a href="#算法代码" class="headerlink" title="算法代码"></a>算法代码</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> insert(string s)</span><br><span class="line">&#123;</span><br><span class="line">    int len = s.length(),p=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(int i = <span class="number">0</span>;i&lt;len;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        int ch=s[i]-<span class="string">'a'</span>;</span><br><span class="line">        <span class="keyword">if</span>(!trie[p][ch])</span><br><span class="line">            trie[p][ch] = ++tot;</span><br><span class="line">        p=trie[p][ch];</span><br><span class="line">    &#125;</span><br><span class="line">    end[p] = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="字典树的查找"><a href="#字典树的查找" class="headerlink" title="字典树的查找"></a>字典树的查找</h2><p><img src="/2020/05/30/Trie%E6%A0%91/5.png" style="zoom:120%;"></p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">search</span><span class="params">(<span class="built_in">string</span> s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len = s.length(),p=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;len;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        p = trie[p][s[i]-<span class="string">'a'</span>];</span><br><span class="line">        <span class="keyword">if</span>(!p)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">end</span>[p];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="性能分析"><a href="#性能分析" class="headerlink" title="性能分析"></a>性能分析</h2><p><img src="/2020/05/30/Trie%E6%A0%91/6.png" style="zoom:120%;"></p>
<p>树高最高是len，那么假设树都是满的，那么就有26^len^ 级别的</p>
<p>但这是最基础的解法，我们是可以优化的。</p>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p><img src="/2020/05/30/Trie%E6%A0%91/7.png" style="zoom:100%;"></p>
<p><img src="/2020/05/30/Trie%E6%A0%91/8.png" style="zoom:100%;"></p>
<ol>
<li>我们可以利用哈希，对每一个单词统计，然后找最高的100个单词。还可以创建一棵字典树，然后找频率最高的100个词，利用end[]统计</li>
<li>过</li>
<li>过</li>
<li>可以利用end[]来标记，如果end=true 的话，什么也不用做即可。然后先序遍历即可； 如果要保留原来的顺序，那么可以碰到一单词，然后立即查询有没有，有的话立即删除；如果没有就保留</li>
<li>和第一题一样</li>
<li>去重+统计（把end[]改成 int型数组）</li>
</ol>
<p><img src="/2020/05/30/Trie%E6%A0%91/9.png" style="zoom:100%;"></p>
<p><img src="/2020/05/30/Trie%E6%A0%91/10.png" style="zoom:100%;"></p>
<h2 id="构建查找Trie树代码一览"><a href="#构建查找Trie树代码一览" class="headerlink" title="构建查找Trie树代码一览"></a>构建查找Trie树代码一览</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">100005</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxz=<span class="number">26</span>;<span class="comment">//不同字符个数，例如数字10，小写字母26</span></span><br><span class="line"><span class="keyword">int</span> trie[maxn][maxz];</span><br><span class="line"><span class="keyword">bool</span> endWord[maxn];<span class="comment">//标识单词结束</span></span><br><span class="line"><span class="keyword">int</span> n,tot;<span class="comment">//字符串数,下标</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="built_in">string</span> s)</span><span class="comment">//将字符串s插入到字典树中</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len=s.length(),p=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> ch=s[i]-<span class="string">'a'</span>;<span class="comment">//转换成数字</span></span><br><span class="line">        <span class="keyword">if</span>(!trie[p][ch])</span><br><span class="line">            trie[p][ch]=++tot;<span class="comment">//记录下标</span></span><br><span class="line">        p=trie[p][ch];</span><br><span class="line">    &#125;</span><br><span class="line">    endWord[p]=<span class="literal">true</span>;<span class="comment">//标记单词结束</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">search</span><span class="params">(<span class="built_in">string</span> s)</span><span class="comment">//在字典树中查找该字符串是否存在</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> len=s.length(),p=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        p=trie[p][s[i]-<span class="string">'a'</span>];</span><br><span class="line">        <span class="keyword">if</span>(!p)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> endWord[p];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">26</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(trie[p][i])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="keyword">char</span>(i+<span class="string">'a'</span>);</span><br><span class="line">            dfs(trie[p][i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">string</span> s;</span><br><span class="line">    <span class="built_in">memset</span>(trie,<span class="number">0</span>,<span class="keyword">sizeof</span>(trie));</span><br><span class="line">    <span class="built_in">memset</span>(endWord,<span class="literal">false</span>,<span class="keyword">sizeof</span>(endWord));</span><br><span class="line">    tot=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">    <span class="keyword">while</span>(n--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cin</span>&gt;&gt;s;</span><br><span class="line">        insert(s);</span><br><span class="line">    &#125;</span><br><span class="line">    dfs(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"输入要查询的字符串："</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;s;</span><br><span class="line">    <span class="keyword">if</span>(search(s))</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"查询成功！"</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"查询失败！"</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="例子："><a href="#例子：" class="headerlink" title="例子："></a>例子：</h2><p><img src="/2020/05/30/Trie%E6%A0%91/11.png" style="zoom:100%;"></p>
<p><img src="/2020/05/30/Trie%E6%A0%91/12.png" style="zoom:100%;"></p>
<p><img src="/2020/05/30/Trie%E6%A0%91/13.png" style="zoom:100%;"></p>
<h3 id="字典树实现"><a href="#字典树实现" class="headerlink" title="字典树实现"></a>字典树实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">500005</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxz=<span class="number">26</span>;<span class="comment">//不同字符个数，例如数字10，小写字母26</span></span><br><span class="line"><span class="keyword">int</span> trie[maxn][maxz];</span><br><span class="line"><span class="built_in">string</span> <span class="keyword">word</span>[maxn];<span class="comment">//翻译单词 存储英文!</span></span><br><span class="line"><span class="keyword">int</span> value[maxn];<span class="comment">//值的下标</span></span><br><span class="line"><span class="keyword">bool</span> <span class="built_in">end</span>[maxn];<span class="comment">//标记结束 </span></span><br><span class="line"><span class="keyword">int</span> n,tot;<span class="comment">//字符串数,下标 </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="built_in">string</span> s,<span class="keyword">int</span> k)</span><span class="comment">//将字符串s插入到字典树中,k的目的是记录单词的下标</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> len=s.length(),p=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> ch=s[i]-<span class="string">'a'</span>;<span class="comment">//转换成数字</span></span><br><span class="line">		<span class="keyword">if</span>(!trie[p][ch]) </span><br><span class="line">			trie[p][ch]=++tot;<span class="comment">//记录下标 </span></span><br><span class="line">		p=trie[p][ch];</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//插入完毕的时候，令插入的这个单词代表着第k个英语单词</span></span><br><span class="line">	value[p]=k;<span class="comment">//记录下标</span></span><br><span class="line">	<span class="built_in">end</span>[p]=<span class="number">1</span>; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="built_in">string</span> s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> len=s.length(),p=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> ch=s[i]-<span class="string">'a'</span>;<span class="comment">//转换成数字</span></span><br><span class="line">		p=trie[p][ch];</span><br><span class="line">		<span class="keyword">if</span>(!p)</span><br><span class="line">			<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(<span class="built_in">end</span>[p])</span><br><span class="line">		<span class="keyword">return</span> value[p];<span class="comment">//返回下标 </span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;	</span><br><span class="line">	<span class="built_in">string</span> s,s1;</span><br><span class="line">	<span class="built_in">memset</span>(trie,<span class="number">0</span>,<span class="keyword">sizeof</span>(trie));</span><br><span class="line">	tot=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int</span> i=<span class="number">1</span>;</span><br><span class="line">    <span class="comment">//输入一行，有两个单词，所以我们一次读一行，getline</span></span><br><span class="line">	<span class="keyword">while</span>(getline(<span class="built_in">cin</span>,s))</span><br><span class="line">	&#123;</span><br><span class="line">        <span class="comment">//如果s为空串，那么break</span></span><br><span class="line">		<span class="keyword">if</span>(!s.<span class="built_in">size</span>())</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">        <span class="comment">//从一个字符串流里面读取两个单词，一个英文单词存到数组word中，还有一个外文单词存到Trie树</span></span><br><span class="line">        <span class="comment">//还有一种办法就是判断空格，然后切分</span></span><br><span class="line">		<span class="function"><span class="built_in">stringstream</span> <span class="title">ss</span><span class="params">(s)</span></span>;</span><br><span class="line">		ss&gt;&gt;<span class="keyword">word</span>[i]&gt;&gt;s1;</span><br><span class="line">		insert(s1,i);</span><br><span class="line">		i++;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//查询</span></span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">cin</span>&gt;&gt;s)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> k=query(s);</span><br><span class="line">		<span class="keyword">if</span>(k)</span><br><span class="line">			<span class="built_in">cout</span>&lt;&lt;<span class="keyword">word</span>[k]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			<span class="built_in">cout</span>&lt;&lt;<span class="string">"eh"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Map实现"><a href="#Map实现" class="headerlink" title="Map实现"></a>Map实现</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="built_in">map</span>&lt;<span class="built_in">string</span>,<span class="built_in">string</span>&gt;mp;<span class="comment">//定义两个string的映射</span></span><br><span class="line"><span class="keyword">char</span> ch1[<span class="number">20</span>],ch2[<span class="number">20</span>],ch3[<span class="number">40</span>],str[<span class="number">20</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">   <span class="keyword">while</span>(gets(ch3))</span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">if</span>(!<span class="built_in">strlen</span>(ch3))</span><br><span class="line">         <span class="keyword">break</span>;</span><br><span class="line">      <span class="built_in">sscanf</span>(ch3,<span class="string">"%s %s"</span>,ch1,ch2);<span class="comment">//ch1是英语，ch2 是外文</span></span><br><span class="line">      mp.insert(make_pair(ch2,ch1));<span class="comment">//是根据外文查询英文的，所以ch2放前面当索引</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">while</span>(gets(str))	<span class="comment">// 读入需要查询的字符串</span></span><br><span class="line">   &#123;</span><br><span class="line">      <span class="built_in">map</span>&lt;<span class="built_in">string</span>,<span class="built_in">string</span>&gt;::iterator it;<span class="comment">//定义一个迭代器</span></span><br><span class="line">      it=mp.<span class="built_in">find</span>(str);<span class="comment">//在map中查询str，如果没查到，it = mp.end()</span></span><br><span class="line">      <span class="keyword">if</span>(it!=mp.<span class="built_in">end</span>())</span><br><span class="line">         <span class="built_in">cout</span>&lt;&lt;mp[str]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">         <span class="built_in">cout</span>&lt;&lt;<span class="string">"eh"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/25/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><span class="page-number current">26</span><a class="page-number" href="/page/27/">27</a><span class="space">&hellip;</span><a class="page-number" href="/page/44/">44</a><a class="extend next" rel="next" href="/page/27/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/%5Bobject%20Object%5D"
                alt="Jason" />
            
              <p class="site-author-name" itemprop="name">Jason</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20fa%20fa-archive">
              
                  <span class="site-state-item-count">435</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">61</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart" aria-hidden="true"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jason</span>
 <!--
  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>







-->
        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>




















  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v="></script>

  <script type="text/javascript" src="/js/src/motion.js?v="></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v="></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
