<!DOCTYPE html>
<html lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"jasonxqh.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Jason‘s Blog">
<meta property="og:url" content="https://jasonxqh.github.io/page/28/index.html">
<meta property="og:site_name" content="Jason‘s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Jason">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://jasonxqh.github.io/page/28/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Jason‘s Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Jason‘s Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/" class="post-title-link" itemprop="url">离散概率part3</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-22 11:21:05" itemprop="dateCreated datePublished" datetime="2020-05-22T11:21:05+08:00">2020-05-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-09-06 12:19:06" itemprop="dateModified" datetime="2020-09-06T12:19:06+08:00">2020-09-06</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="离散概率part3"><a href="#离散概率part3" class="headerlink" title="离散概率part3"></a>离散概率part3</h1><h2 id="Outline"><a href="#Outline" class="headerlink" title="Outline"></a>Outline</h2><p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/1.png" style="zoom:80%;"></p>
<h2 id="Expectation"><a href="#Expectation" class="headerlink" title="Expectation"></a>Expectation</h2><p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/2.png" style="zoom:80%;"></p>
<h3 id="期望的两种计算方法"><a href="#期望的两种计算方法" class="headerlink" title="期望的两种计算方法"></a>期望的两种计算方法</h3><p>期望的定义：所有的随机变量可能的取值乘以对应的概率，然后再求和。</p>
<p>但是我们要知道E(X)是一个加权的平均数。E(X)不再是一个随机变量了</p>
<p>定义一个偏差(deviation)为随机变量减去期望</p>
<h4 id="基于定义求"><a href="#基于定义求" class="headerlink" title="基于定义求"></a>基于定义求</h4><p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/3.png" style="zoom:80%;"></p>
<p>比如说我抛硬币100次，我们要看正面朝上的次数为多少，向上的概率为p</p>
<p>那么如果按照普通的算法，那么就要对每一个出现情况的概率进行求和，也就是对$2^{100}$个样本求和，那么我们如果对随机变量X求和，（X对应硬币朝上的个数）那么只要对0-100求和就行了。</p>
<p>只要知道分布，就知道期望了</p>
<h4 id="基于随机变量来求"><a href="#基于随机变量来求" class="headerlink" title="基于随机变量来求"></a>基于随机变量来求</h4><p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/4.png" style="zoom:80%;"></p>
<h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><h4 id="例一"><a href="#例一" class="headerlink" title="例一"></a>例一</h4><p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/5.png" style="zoom:80%;"></p>
<p>我们不仅仅可以算X的期望，也可以计算$X^2$ ,$X^3$的期望，直接用它的函数值带入即可 </p>
<h4 id="例二"><a href="#例二" class="headerlink" title="例二"></a>例二</h4><p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/6.png" style="zoom:80%;"></p>
<h3 id="贝努力分布和几何分布的期望"><a href="#贝努力分布和几何分布的期望" class="headerlink" title="贝努力分布和几何分布的期望"></a>贝努力分布和几何分布的期望</h3><h4 id="贝努力分布"><a href="#贝努力分布" class="headerlink" title="贝努力分布"></a>贝努力分布</h4><p>The expected number of successes when n mutually independent Bernoulli trials are performed, where p is the probability of success on each trial, is <strong>np</strong>.</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/7.png" style="zoom:80%;"></p>
<h4 id="几何分布"><a href="#几何分布" class="headerlink" title="几何分布"></a>几何分布</h4><p>The expected number of successes when a r.v. X follows a Geometric distribution is 1 p , where p is the probability of success on each trial.</p>
<p>也就是说第一次成功之前，已经做了多少次</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/8.png" style="zoom:80%;"></p>
<h2 id="Linearity-of-expectations"><a href="#Linearity-of-expectations" class="headerlink" title="Linearity of expectations"></a>Linearity of expectations</h2><h3 id="期望的线性性质"><a href="#期望的线性性质" class="headerlink" title="期望的线性性质"></a>期望的线性性质</h3><p>1.和的期望等于期望的和</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/9.png" style="zoom:150%;"></p>
<p>2.具有线性运算的性质$E(aX_i+b) = aE(X_i)+b$</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/10.png" style="zoom:170%;"></p>
<ol>
<li>线性可加性 ,比如</li>
</ol>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/30.png" style="zoom:170%;"></p>
<h3 id="证明："><a href="#证明：" class="headerlink" title="证明："></a>证明：</h3><p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/11.png" style="zoom:80%;"></p>
<h3 id="贝努力实验的期望"><a href="#贝努力实验的期望" class="headerlink" title="贝努力实验的期望"></a>贝努力实验的期望</h3><p>根据期望的线性性，我们很容易就能算出n次贝努力实验的期望了</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/12.png" style="zoom:60%;"></p>
<h3 id="例子："><a href="#例子：" class="headerlink" title="例子："></a>例子：</h3><h4 id="例一："><a href="#例一：" class="headerlink" title="例一："></a>例一：</h4><p>A new employee checks the hats of n people at a restaurant, forgetting to put claim check numbers on the hats. When customers return for their hats, the checker gives them back hats chosen at random from the remaining hats. What is the expected number of hats that are returned correctly?</p>
<p>就是说这个服务员是新来的，没有给顾客发取帽码，所以只能随便拿(帽子都一样)，问这个期望拿对的概率是多少</p>
<p>如果我们按照定义来算，那么就要算出来没有人能拿对的概率，一个人拿对的概率，。。。全部拿对的概率，也就是说先找分布，再计算期望。但这显然太麻烦了</p>
<p>所以 这样考虑：0个人拿对，那么n个人错排；1个人拿对，n-1个人错排。所以我们用期望的性质来做。我们来看第i个人是否拿对，拿对的概率 1/n,拿错的概率 n-1/n。求和即可</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/13.png" style="zoom:80%;"></p>
<h4 id="例二："><a href="#例二：" class="headerlink" title="例二："></a>例二：</h4><p>计算一个数列中逆排列的数字对，逆排列就是说a&lt;b 但是a在b的后面，如图中所举例</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/14.png" style="zoom:80%;"></p>
<p>那么对于一个数字对来说 $I_{i,j}$来说，他要么是逆序列，要么不是。所以说他的期望是 1/2</p>
<p>然后我们只要计算有几个这样的数字对即可，C(2,n) = n(n-1)/2 相乘得答案</p>
<h3 id="独立随机变量的期望"><a href="#独立随机变量的期望" class="headerlink" title="独立随机变量的期望"></a>独立随机变量的期望</h3><p>当X，Y相互独立的时候，期望的乘积就等于乘积的期望</p>
<p>$E(XY) = E(X)E(Y)$</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/15.png" style="zoom:80%;"></p>
<h2 id="Average-case-computational-complexity"><a href="#Average-case-computational-complexity" class="headerlink" title="Average-case computational complexity"></a>Average-case computational complexity</h2><p>通过期望来计算平均的算法复杂度，也就是一般情况下大概是什么复杂度</p>
<p>那么他的期望就是输入一个数字的 概率，乘以其对应的比较次数</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/16.png" style="zoom:100%;"></p>
<p>Finding the average-case computational complexity of an algorithm is usually much more diffcult than nding its worst-case computational complexity, and often involves the use of sophisticated methods.</p>
<h3 id="线性搜索算法"><a href="#线性搜索算法" class="headerlink" title="线性搜索算法"></a>线性搜索算法</h3><p><strong>Question:</strong> What is the average-case computational complexity of the linear search algorithm if the probability that x is in the list is p and it is equally likely that x is any of the n elements in the list?</p>
<p><strong>Solution:</strong> 也就是说，x和$a_i$ 去比较，那么需要比较 i 是否小于等于n 和 比较 x是否等于 $a_i$也就是说要比较两次，那么如果最终找到了，然后还要跳出循环，判断i是不是小于等于n，所以一共比较2i+1次</p>
<p>那么如果没找到，那么就是比较2n+2次</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/1.jpg" style="zoom:80%;"></p>
<p>The probability that x equals ai ,<br>the i-th element in the list, is p/n, and the probability that x is not in the list is q = 1 - p.</p>
<p>令p指的是这个x落在这n个数中的概率。因为每个数可能是均匀分布在这个序列里面的，所以如果有5个数字，那么概率就是p/5,如果有n个数字，那么就是p/n.</p>
<p>那么我们就可以进行计算了</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/17.png" style="zoom:60%;"></p>
<h3 id="插入排序算法"><a href="#插入排序算法" class="headerlink" title="插入排序算法"></a>插入排序算法</h3><p><strong>Question：</strong>What is the average number of comparisons used by the insertion sort to sort n distinct elements?</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/2.jpg" style="zoom:60%;"></p>
<p><strong>Solution:</strong>We first suppose that X is the r.v. equal to # comparisons used by the insertion sort to sort a list a1, a2, … ; an of n distinct elements.<br>Then E(X) is the average number of comparisons used.</p>
<p>记作$a_k$为前j个元素中最大的元素,$1\leq k \leq j$</p>
<p>所以关键是看k落在第几个位置。如果k在第一个，那么每一个后来的都比 $a_k$ 小</p>
<p>如果是落在最后一个，那么每个都要比较一下</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/18.png" style="zoom:70%;"></p>
<h2 id="方差"><a href="#方差" class="headerlink" title="方差"></a>方差</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>方差可以对定义求和，也可以对随机变量来求</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/19.png" style="zoom:70%;"></p>
<h3 id="定理"><a href="#定理" class="headerlink" title="定理"></a>定理</h3><p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/20.png" style="zoom:70%;"></p>
<p>也可以这样来计算：X偏离均值的平方的期望</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/21.png" style="zoom:70%;"></p>
<h3 id="各种分布的方差"><a href="#各种分布的方差" class="headerlink" title="各种分布的方差"></a>各种分布的方差</h3><h4 id="例一：贝努力实验的方差"><a href="#例一：贝努力实验的方差" class="headerlink" title="例一：贝努力实验的方差"></a>例一：贝努力实验的方差</h4><p><strong>Question:</strong> A coin is  flipped one time. Let $\Omega$ be the sample space of the possible outcomes, and let X be r.v. that assigns to an outcome # heads in this outcome. What is the variance of X if it is a biased coin with P({H}) = p?  </p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/24.png" style="zoom:90%;"></p>
<h4 id="例二：-二项分布的方差"><a href="#例二：-二项分布的方差" class="headerlink" title="例二： 二项分布的方差"></a>例二： 二项分布的方差</h4><p><strong>Question:</strong> Let r.v. X be the number of successes of n mutually independent Bernoulli trials, where p is the probability of success on each trial. What is the variance of X?</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/23.png" style="zoom:90%;"></p>
<h4 id="例三：几何分布的方差"><a href="#例三：几何分布的方差" class="headerlink" title="例三：几何分布的方差"></a>例三：几何分布的方差</h4><p><strong>Question: </strong>Let r.v. X be the rst occurrence of success requires n mutually independent Bernoulli trials, where p is the probability of success on each trial. What is the variance of X?</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/25.png" style="zoom:90%;"></p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/26.png" style="zoom:90%;"></p>
<h3 id="方差的非线性性"><a href="#方差的非线性性" class="headerlink" title="方差的非线性性"></a>方差的非线性性</h3><p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/28.png" style="zoom:90%;"></p>
<p>这说明什么道理呢？</p>
<p>说明对一列数进行平移，那么不会影响我的方差，如果对一列数进行拉伸a倍，那么方差就会扩大a的平方倍。</p>
<p>如果对一列数进行压缩，那么方差就会压缩的更厉害。</p>
<h3 id="Bienayme‘s-formula"><a href="#Bienayme‘s-formula" class="headerlink" title="Bienayme‘s formula"></a>Bienayme‘s formula</h3><p>当随机变量<strong>两两之间相互独立</strong>的时候，那么这时候方差的和就等于和的方差</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/29.png" style="zoom:90%;"></p>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/31.png" style="zoom:90%;"></p>
<p>因为$X_i$ 是独立的而且是同分布的随机变量（独立且分布函数相同），这意味着所有的$X_i$的期望是一样的，$X_i$ 的方差也是一样的（比如抛筛子两次，第一次X1和第二次X2）</p>
<p>这个例子告诉我们什么呢？</p>
<p>原来$X_i$的方差是 $\sigma^2$ 那么 现在我们把 所有的$X_i $加起来后取平均数的话 方差会随着数量的增加而逐渐趋向于0</p>
<p>$\lim\limits_{n-&gt;\infty}V(\overline{X_n}) = 0$</p>
<p>也就是说，随着随机变量数量的增加，当n越来越大的时候，最后随机变量会变成一个常数。均值的方差会变得很小很小。</p>
<p>举个例子，我们 利用标记重补法来估算池塘中的鱼，那么一次的话可能说明不了问题，那么我们可以做很多次，然后取一平均值，这时候根据上面的公式，方差（波动）不会很大</p>
<h2 id="Tail-probability尾概率"><a href="#Tail-probability尾概率" class="headerlink" title="Tail probability尾概率"></a>Tail probability尾概率</h2><p>比如果我抛出100次硬币，那么50是它的期望</p>
<p>那么我们如果想要计算$P_n(X&gt;90)$和$P_n(X&lt;10)$ 这两个概率，就是一种尾概率</p>
<p>如果我们硬算，会变得很麻烦，很难计算 $\sum<em>{k=91}^{100}C</em>{100}^k \frac{1}{2}^{100} $</p>
<p>所以我们给他一个上界，估计估计，但是我又让这个上界越接近越好。那么怎么计算一下呢？</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/3.jpg" style="zoom:90%;"></p>
<p>像上面这张图片，我们可以把这个看作抛了n次的模型，我们看到最后的概率接近0.5。这是因为Xi = {0,1},那么</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/32.png" style="zoom:150%;"></p>
<p>当n越大的时候，方差越小，方差越小，波动就越小。</p>
<p>回到上面的问题 $P<em>n(X&gt;90) = P_n(\sum</em>{1}^nX_i&gt;=90)$</p>
<h3 id="Markovs-inequality"><a href="#Markovs-inequality" class="headerlink" title="Markovs inequality"></a>Markovs inequality</h3><h4 id="Theorem"><a href="#Theorem" class="headerlink" title="Theorem"></a>Theorem</h4><p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/33.png" style="zoom:90%;"></p>
<p>也就是说刚才的尾概率可以通过这样的方法来进行计算</p>
<h4 id="Proof"><a href="#Proof" class="headerlink" title="Proof"></a>Proof</h4><p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/34.png" style="zoom:90%;"></p>
<p>就比如说，我投n次币  ，我计算正面朝上的概率大于0.9 </p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/35.png" style="zoom:150%;"></p>
<p>但这个上界有问题，放的太宽了。n=100,n=1000，n越来越大的时候，概率应该越来越稳定才对，所以偏离p=0.5的概率会越来越小，但是根据马尔可夫不等式，却发现上界始终不变。所以不科学，不太准确</p>
<h3 id="Chebyshevs-inequality"><a href="#Chebyshevs-inequality" class="headerlink" title="Chebyshevs inequality"></a>Chebyshevs inequality</h3><p>所以我们来看切比雪夫不等式。马尔科夫不等式用的是期望，切比雪夫不等式用的是方差。这个方差会随着n的增加而慢慢减小，但是期望是不会随着n的变化而变化的，所以这就导致了两者的区别，一个和n无关，一个和n有关</p>
<h4 id="Theorem-1"><a href="#Theorem-1" class="headerlink" title="Theorem"></a>Theorem</h4><p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/36.png" style="zoom:150%;"></p>
<h4 id="Proof-1"><a href="#Proof-1" class="headerlink" title="Proof"></a>Proof</h4><p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/37.png" style="zoom:150%;"></p>
<p>马尔可夫不等式，是单尾的，只能计算&gt; 某个值的上界，但是切比雪夫不等式是双尾的，</p>
<p>双尾的肯定要比单尾的概率要大，所以我们通过这个关系把单尾转化成双尾再进行计算。</p>
<p>通过下面两个例子计算出的结果，要比马尔可夫不等式更科学，当n趋向于无穷的时候，尾概率会趋向于0，符合上面方差趋向于0的判断。</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/38.png" style="zoom:150%;"></p>
<p>比如说我要计算刚才抛硬币的例子 </p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/39.png" style="zoom:100%;"></p>
<p>但是这样虽然符合观测结果，但也不能说切比雪夫不等式给出的上界，就是一个很好的上界，所以我们需要</p>
<p>Chernoff bound</p>
<h3 id="Chernoff-bound"><a href="#Chernoff-bound" class="headerlink" title="Chernoff bound"></a>Chernoff bound</h3><h4 id="Theorem-2"><a href="#Theorem-2" class="headerlink" title="Theorem"></a>Theorem</h4><p> <img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/40.png" style="zoom:80%;"></p>
<h4 id="Proof-2"><a href="#Proof-2" class="headerlink" title="Proof"></a>Proof</h4><p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/41.png" style="zoom:82%;"></p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/42.png" style="zoom:80%;"></p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/43.png" style="zoom:80%;"></p>
<h4 id="Theorem-for-upper-tail"><a href="#Theorem-for-upper-tail" class="headerlink" title="Theorem for upper tail"></a>Theorem for upper tail</h4><p>这是另外一个尾巴</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/49.png" style="zoom:80%;"></p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/44.png" style="zoom:80%;"></p>
<p>关于这里分母为什么是4，我一直没搞明白</p>
<p>其实这里分母可以为大于2的任何数，3，4都可以。因为我们通过泰勒展开得到的分母为2，而</p>
<p>$\frac{-\mu\delta^2}{4}$ &gt;$\frac{-\mu\delta^2}{2}$  ,所以事实上这个界比$e^{\frac{-\mu\delta^2}{2}}$ 要松</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/0.jpg" style="zoom: 67%;"></p>
<h4 id="example"><a href="#example" class="headerlink" title="example"></a>example</h4><p>比如说我们想要计算 $P(|x-\mu|&gt;\delta\mu)$ </p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/50.png" style="zoom:100%;"></p>
<p>这里的$\delta$ 是怎么求出来的呢？凑出来的。因为知道$\mu=\frac{n}{2}$（期望） 然后 根据我们要求的尾概率，提取出$\mu$ 来看他的系数即可</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/45.png" style="zoom:80%;"></p>
<p>像下面这个例子，对我们理解切诺夫界更有帮助</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/46.png" style="zoom:80%;"></p>
<p>这相当于一个不均匀的硬币，有$\frac{\pi}{4}$ 的概率正面（红色圆域） ，剩下的概率为反面（绿色部分）</p>
<p>Y就相当于抛出n次后打包在一起的一个随机变量。</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/47.png" style="zoom:80%;"></p>
<p>那么我如果要计算$Y&gt;\frac{\pi}{2}$ 的概率（事实上这个等于0）那么我们就可以按照上面的方法计算。</p>
<p>$P(Y-\frac{\pi}{4}&gt;\frac{\pi}{4})$ 的 意思，其实就是偏移方差量大于$\frac{\pi}{4}$ 的意思，概率肯定是随着n的增加而接近于0。</p>
<p>所以根据切比雪夫不等式我们可以得到了当n=100的时候，这个概率的上界是0.0025 但这还不是最准确的</p>
<p><img src="/2020/05/22/%E7%A6%BB%E6%95%A3%E6%A6%82%E7%8E%87part3/48.png" style="zoom:80%;"></p>
<p>当我们用切诺夫界来计算的时候，那么概率变成了e^(-75/4)^  也就是小数点后10个0的概率，而事实上的概率比这个还要小。所以说切诺夫界比切比雪夫不等式更加的准确</p>
<p>所以说我们想要达到一个精度（偏移期望的概率达到足够小） 对于切比雪夫来说，需要做的次数要远高于切诺夫界所需要的次数，因为切诺夫界是按照指数缩小的</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/" class="post-title-link" itemprop="url">无穷级数</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-20 21:14:28" itemprop="dateCreated datePublished" datetime="2020-05-20T21:14:28+08:00">2020-05-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-06-13 12:09:46" itemprop="dateModified" datetime="2020-06-13T12:09:46+08:00">2020-06-13</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="无穷级数"><a href="#无穷级数" class="headerlink" title="无穷级数"></a>无穷级数</h1><h2 id="常数项级数的概念"><a href="#常数项级数的概念" class="headerlink" title="常数项级数的概念"></a>常数项级数的概念</h2><h3 id="引例1-用圆内接正多边形面积逼近圆面积"><a href="#引例1-用圆内接正多边形面积逼近圆面积" class="headerlink" title="引例1.用圆内接正多边形面积逼近圆面积"></a>引例1.用圆内接正多边形面积逼近圆面积</h3><p>依次作圆内接正$3 \cdot 2^n(n=1,2,\Lambda)$ 边形，设$a_0$表示内接正三角形的面积，$a_k$表示边数增加时增加的面积，则圆内接正$3\cdot 2^n$边形的面积为</p>
<p>$a_0+a_1+a_2+\Lambda+a_n$</p>
<p>当$n-&gt;\infty$时，这个和逼近圆的面积A，即$A=a_0+a_1+a_2+\Lambda+a_n$</p>
<h3 id="引例2"><a href="#引例2" class="headerlink" title="引例2"></a>引例2</h3><p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/2.png" style="zoom: 50%;"></p>
<h3 id="引例3"><a href="#引例3" class="headerlink" title="引例3"></a>引例3</h3><p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/1.png" style="zoom: 50%;"></p>
<h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>给定一个数列$u<em>1,u_2,u_3..\Lambda,u_n,\Lambda$将各项依次相加。记为$\sum</em>{n=1}^{\infty}u_n$</p>
<p>即$\sum_{n=1}^{\infty}u_n = u_1,u_2,u_3..\Lambda,u_n,\Lambda$</p>
<p>称上式为无穷级数，其中第n项 $u<em>n$叫做级数的一般项，级数的前n项和$S_n=\sum</em>{k=1}^{n}u_k = u_1,u_2,u_3..\Lambda,u_n$ 称作级数的部分和</p>
<p>若$\lim\limits<em>{n-&gt;\infty}S_n = S$存在，则称无穷级数收敛，并称S为级数的和记作$S=\sum</em>{n=1}^{\infty}u_n$</p>
<p>若$\lim\limits_{n-&gt;\infty}S_n = S$不存在m,则称无穷级数发散</p>
<p>那么，当级数收敛时， $r<em>n = S-S_n = u</em>{n+1}+u<em>{n+2}+\Lambda$ 为级数的余项，显然 $\lim\limits</em>{n-&gt;\infty}r_n = 0$</p>
<h3 id="例一：讨论等比级数（几何级数）"><a href="#例一：讨论等比级数（几何级数）" class="headerlink" title="例一：讨论等比级数（几何级数）"></a>例一：讨论等比级数（几何级数）</h3><p>$\sum_{n=0}^{\infty}aq^n = a+aq+aq^2+\Lambda+aq^n+\Lambda(a\neq 0)$(q称为公比)的敛散性</p>
<p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/3.png" style="zoom: 55%;"></p>
<p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/4.png" style="zoom: 50%;"></p>
<h3 id="例二：判断下列级数的敛散性"><a href="#例二：判断下列级数的敛散性" class="headerlink" title="例二：判断下列级数的敛散性"></a>例二：判断下列级数的敛散性</h3><p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/5.png" style="zoom: 50%;"></p>
<p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/6.png" style="zoom: 50%;"></p>
<p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/7.png" style="zoom: 50%;"></p>
<p>现在，我们只能通过前n项的和来进行判断</p>
<p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/8.png" style="zoom: 50%;"></p>
<h2 id="无穷级数的基本性质"><a href="#无穷级数的基本性质" class="headerlink" title="无穷级数的基本性质"></a>无穷级数的基本性质</h2><h3 id="性质1"><a href="#性质1" class="headerlink" title="性质1"></a>性质1</h3><p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/9.png" style="zoom: 50%;"></p>
<p> 级数各项乘以非零常数后其敛散性不变</p>
<h3 id="性质2"><a href="#性质2" class="headerlink" title="性质2"></a>性质2</h3><p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/10.png" style="zoom: 60%;"></p>
<p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/11.png" style="zoom: 50%;"></p>
<h3 id="性质3"><a href="#性质3" class="headerlink" title="性质3"></a>性质3</h3><p>在级数前面加上或去掉有限项，都不会影响级数的敛散性</p>
<p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/12.png" style="zoom: 50%;"> </p>
<h3 id="性质4"><a href="#性质4" class="headerlink" title="性质4"></a>性质4</h3><p>收敛级数加括弧后所成的级数仍收敛于原级数的和 </p>
<p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/13.png" style="zoom: 50%;"></p>
<h2 id="级数收敛的必要条件"><a href="#级数收敛的必要条件" class="headerlink" title="级数收敛的必要条件"></a>级数收敛的必要条件</h2><p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/14.png" style="zoom: 50%;"></p>
<p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/15.png" style="zoom: 50%;"></p>
<h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/16.png" style="zoom: 50%;"></p>
<h3 id="例题-1"><a href="#例题-1" class="headerlink" title="例题"></a>例题</h3><p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/17.png" style="zoom: 50%;"></p>
<p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/18.png" style="zoom: 50%;"></p>
<p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/19.png" style="zoom: 50%;"></p>
<p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/20.png" style="zoom: 50%;"></p>
<h2 id="柯西审敛原理"><a href="#柯西审敛原理" class="headerlink" title="柯西审敛原理"></a>柯西审敛原理</h2><p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/21.png" style="zoom: 50%;"></p>
<p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/22.png" style="zoom: 50%;"></p>
<p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/23.png" style="zoom: 50%;"></p>
<h2 id="解题方法"><a href="#解题方法" class="headerlink" title="解题方法"></a>解题方法</h2><p>第一节的题目普遍比较简单。常常有这样的题形：</p>
<p><strong>请用级数收敛发散的性质(定义) 判别下列级数的敛散性</strong></p>
<p>那么我们可以用什么方法？</p>
<ul>
<li>首先看看是否满足必要性。 必要性就是当n趋向无穷大的时候，单项是否趋于0，如果趋于零那么再做判断，否则直接写：“不满足级数收敛的必要条件，原级数发散”<ul>
<li>这里还要注意，如果级数是周期波动的，比如 $\sin\frac{\pi}{n}$ ，是没有固定极限的，所以也发</li>
</ul>
</li>
<li>其次看看是不是可以拆分成两个级数，然后通过级数的性质判断：<ul>
<li>如果两个级数都是收敛的，其和其差一定是收敛的</li>
<li>如果两个级数有一个是收敛的有一个是发散的，那么其和其差一定是放散的</li>
<li>如果两个级数都是发散的，<strong>无法判断</strong></li>
</ul>
</li>
</ul>
<p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/1.jpg" style="zoom: 70%;"></p>
<p><img src="/2020/05/20/%E6%97%A0%E7%A9%B7%E7%BA%A7%E6%95%B0/2.jpg" style="zoom: 70%;"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/20/python%E5%8A%9E%E5%85%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/20/python%E5%8A%9E%E5%85%AC/" class="post-title-link" itemprop="url">python办公</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-20 12:38:27" itemprop="dateCreated datePublished" datetime="2020-05-20T12:38:27+08:00">2020-05-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-05-21 15:32:22" itemprop="dateModified" datetime="2020-05-21T15:32:22+08:00">2020-05-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="python办公"><a href="#python办公" class="headerlink" title="python办公"></a>python办公</h1><h2 id="Working-with-Paths"><a href="#Working-with-Paths" class="headerlink" title="Working with Paths"></a>Working with Paths</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line">path = Path(<span class="string">"__init__.py"</span>)</span><br><span class="line">path.exists()			<span class="comment">#让文件一直打开着</span></span><br><span class="line">print(path.is_file())	<span class="comment"># 判断该路径是否为文件 true</span></span><br><span class="line">print(path.is_dir())	<span class="comment"># 判断该路径是否为目录 false</span></span><br><span class="line">print(path.name)		<span class="comment"># 输出文件名称(包括扩展名)</span></span><br><span class="line">print(path.stem)		<span class="comment"># 输出主干名称(不包括扩展名)</span></span><br><span class="line">print(path.suffix)		<span class="comment"># 输出扩展名</span></span><br><span class="line">print(path.parent)		<span class="comment"># 输出上层目录</span></span><br><span class="line">path=path.with_name(<span class="string">"file.txt"</span>)	<span class="comment"># 修改文件的名称</span></span><br><span class="line">path=path.with_suffix(<span class="string">".txt"</span>)	<span class="comment"># 修改文杰的扩展名</span></span><br><span class="line">print(path)						</span><br><span class="line">print(path.absolute())			<span class="comment"># 输出绝对路径</span></span><br></pre></td></tr></table></figure>
<h2 id="Working-with-Directories"><a href="#Working-with-Directories" class="headerlink" title="Working with Directories"></a>Working with Directories</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line">path = Path(<span class="string">"D://"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> path.iterdir():</span><br><span class="line">    print(p)	<span class="comment">#输出目录中的文件</span></span><br><span class="line">paths = [p <span class="keyword">for</span> p <span class="keyword">in</span> path.iterdir()]</span><br><span class="line">print(paths)</span><br></pre></td></tr></table></figure>
<h2 id="Working-with-Files"><a href="#Working-with-Files" class="headerlink" title="Working with Files"></a>Working with Files</h2><h3 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h3><p>stat 系统调用时用来返回相关文件的系统状态信息的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line">path = Path(<span class="string">"D://"</span>)</span><br><span class="line"></span><br><span class="line">print(path.stat())</span><br></pre></td></tr></table></figure>
<h3 id="查看创建时间"><a href="#查看创建时间" class="headerlink" title="查看创建时间"></a>查看创建时间</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> ctime</span><br><span class="line">path = Path(<span class="string">"D://1.TXT"</span>)</span><br><span class="line">path2 = Path(<span class="string">"D://"</span>)</span><br><span class="line">print(ctime(path2.stat().st_ctime))<span class="comment"># Fri Apr 19 08:29:08 2019</span></span><br><span class="line">print(ctime(path.stat().st_ctime)) <span class="comment"># Wed May 20 13:24:21 2020</span></span><br><span class="line">print(path.read_text())	<span class="comment">#	My name is Jason</span></span><br><span class="line">path.write_text(<span class="string">""</span>)		<span class="comment"># 写点东西</span></span><br><span class="line">path.write_bytes()</span><br></pre></td></tr></table></figure>
<h3 id="文件拷贝"><a href="#文件拷贝" class="headerlink" title="文件拷贝"></a>文件拷贝</h3><p>如何把一个文件中的内容拷贝到另一个文件呢</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line">source = Path(<span class="string">"D://1.TXT"</span>)</span><br><span class="line">target = Path() / <span class="string">"xixi.py"</span></span><br><span class="line">shutil.copy(source,target)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/20/python%E5%8A%9E%E5%85%AC/1.png" style="zoom:;"></p>
<h2 id="Working-with-Zip-Files"><a href="#Working-with-Zip-Files" class="headerlink" title="Working with Zip Files"></a>Working with Zip Files</h2><h3 id="使用zipfile压缩文件"><a href="#使用zipfile压缩文件" class="headerlink" title="使用zipfile压缩文件"></a>使用zipfile压缩文件</h3><p> <strong>创建一个zip文件对象，压缩是需要把mode改为‘w’</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zfile=zipfile.ZipFile(<span class="string">"test.zip"</span>,<span class="string">"w"</span>)</span><br></pre></td></tr></table></figure>
<p> <strong>将文件写入zip文件中，即将文件压缩</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zfile.write(<span class="string">r"../test.py"</span>)</span><br></pre></td></tr></table></figure>
<p> <strong>将zip文件对象关闭</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zfile.close()</span><br></pre></td></tr></table></figure>
<p><strong>使用 zipfile 解压文件</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br></pre></td></tr></table></figure>
<p> <strong>解压</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">zfile=zipfile.ZipFile(<span class="string">"../test.zip"</span>,<span class="string">"r"</span>)</span><br><span class="line">zfile.extractall()</span><br></pre></td></tr></table></figure>
<h3 id="利用pathlib遍历目录Path-rglob"><a href="#利用pathlib遍历目录Path-rglob" class="headerlink" title="利用pathlib遍历目录Path().rglob"></a>利用pathlib遍历目录Path().rglob</h3><p> 因为*可以代表任何字符，所以<br>rglob(‘*.py’) 就代表后缀名为.py的所有文件<br>rglob(‘*.*‘)就代表不论什么后缀名的所有文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">from</span> zipfile <span class="keyword">import</span> ZipFile</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> ZipFile(<span class="string">"files.zip"</span>,<span class="string">"w"</span>) <span class="keyword">as</span> zip:</span><br><span class="line">    <span class="keyword">for</span> path <span class="keyword">in</span> Path(<span class="string">"D://untitled"</span>).rglob(<span class="string">"*.*"</span>):</span><br><span class="line">        zip.write(path)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/20/python%E5%8A%9E%E5%85%AC/2.png" style="zoom: 67%;"></p>
<h2 id="Working-with-CSV-Files"><a href="#Working-with-CSV-Files" class="headerlink" title="Working with CSV Files"></a>Working with CSV Files</h2><h3 id="写入文件"><a href="#写入文件" class="headerlink" title="写入文件"></a>写入文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"data.csv"</span>,<span class="string">"w"</span>,newline=<span class="string">''</span>) <span class="keyword">as</span> file:</span><br><span class="line">    writer = csv.writer(file)</span><br><span class="line">    writer.writerow ([<span class="string">"transaction_id"</span>,<span class="string">"product_id"</span>,<span class="string">"price"</span>])</span><br><span class="line">    writer.writerow ([<span class="number">1000</span>,<span class="number">1</span>,<span class="number">5</span>])</span><br><span class="line">    writer.writerow ([<span class="number">1000</span>,<span class="number">11</span>,<span class="number">52</span>])</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/20/python%E5%8A%9E%E5%85%AC/3.png" style="zoom:  %;"></p>
<h3 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h3><p>当我们通过迭代来输出的时候，会输出三个List。上面的迭代已经成功了，那么当我们再次想输出list的时候，就发现仅仅输出一个[]。因为后面没东西了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"data.csv"</span>) <span class="keyword">as</span> file:</span><br><span class="line">    reader = csv.reader(file)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> reader:</span><br><span class="line">        print(row)</span><br><span class="line">    print(list(reader))    </span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">['transaction_id', 'product_id', 'price']</span></span><br><span class="line"><span class="string">['1000', '1', '5']</span></span><br><span class="line"><span class="string">['1000', '11', '52']</span></span><br><span class="line"><span class="string">[]</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>但是，当我们先print(list(reader))的时候，再迭代输出的时候，就什么都输出不了。 输出的时候，文件已经读完了，再去读就读不到什么东西。所以只输出一个List</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"data.csv"</span>) <span class="keyword">as</span> file:</span><br><span class="line">    reader = csv.reader(file)</span><br><span class="line">    print(list(reader))</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> reader:</span><br><span class="line">        print(row)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">[['transaction_id', 'product_id', 'price'], ['1000', '1', '5'], ['1000', '11', '52']] </span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h2 id="Working-with-JSON-Files"><a href="#Working-with-JSON-Files" class="headerlink" title="Working with JSON Files"></a>Working with JSON Files</h2><h3 id="写入json文件"><a href="#写入json文件" class="headerlink" title="写入json文件"></a>写入json文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">movies = [</span><br><span class="line">    &#123;<span class="string">"id"</span>:<span class="number">1</span>,<span class="string">"title"</span>:<span class="string">"Terminator"</span>,<span class="string">"year"</span>:<span class="number">1989</span>&#125;,</span><br><span class="line">    &#123;<span class="string">"id"</span>:<span class="number">3</span>,<span class="string">"title"</span>:<span class="string">"Kindergarten Cop"</span>,<span class="string">"year"</span>:<span class="number">1993</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">data = json.dumps(movies)</span><br><span class="line">print(data)</span><br><span class="line"><span class="comment">#输出一个列表 [&#123;"id": 1, "title": "Terminator", "year": 1989&#125;, &#123;"id": 3, "title": "Kindergarten Cop", "year": 1993&#125;]</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/20/python%E5%8A%9E%E5%85%AC/4.png" style="zoom:80%;"></p>
<h3 id="读取json文件"><a href="#读取json文件" class="headerlink" title="读取json文件"></a>读取json文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"></span><br><span class="line">data = Path(<span class="string">"movies.json"</span>).read_text()</span><br><span class="line">movies = json.loads(data)</span><br><span class="line">print(movies)</span><br><span class="line">print(movies[<span class="number">0</span>])</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">输出: </span></span><br><span class="line"><span class="string">[&#123;'id': 1, 'title': 'Terminator', 'year': 1989&#125;, &#123;'id': 3, 'title': 'Kindergarten Cop', 'year': 1993&#125;]</span></span><br><span class="line"><span class="string">&#123;'id': 1, 'title': 'Terminator', 'year': 1989&#125;</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h2 id="Working-with-Timestamps"><a href="#Working-with-Timestamps" class="headerlink" title="Working with Timestamps"></a>Working with Timestamps</h2><p>输出秒数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_emails</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10000000</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">start = time.time()</span><br><span class="line">send_emails()</span><br><span class="line">end = time.time()</span><br><span class="line">duration = end-start</span><br><span class="line">print(duration)</span><br><span class="line"><span class="comment"># 0.14830493927001953</span></span><br></pre></td></tr></table></figure>
<h2 id="Working-with-Datetimes"><a href="#Working-with-Datetimes" class="headerlink" title="Working with Datetimes"></a>Working with Datetimes</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> _datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">dt2 = datetime(<span class="number">2018</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">dt = datetime.now()</span><br><span class="line">print(datetime.strptime(<span class="string">"19/01/01"</span>,<span class="string">"%y/%m/%d"</span>))	<span class="comment"># 2019-01-01 00:00:00</span></span><br><span class="line">dt=datetime.fromtimestamp(time.time())	</span><br><span class="line">print(dt)<span class="comment"># 2020-05-20 14:55:54.447580</span></span><br><span class="line">print(<span class="string">f"<span class="subst">&#123;dt.year&#125;</span>/<span class="subst">&#123;dt.month&#125;</span>"</span>)	<span class="comment"># 2020/05</span></span><br><span class="line">print(dt.strftime(<span class="string">"%Y/%m"</span>))		<span class="comment"># 2020/05</span></span><br><span class="line">print(dt&gt;dt2)					<span class="comment"># true</span></span><br></pre></td></tr></table></figure>
<h2 id="Working-with-Time-Deltas"><a href="#Working-with-Time-Deltas" class="headerlink" title="Working with Time Deltas"></a>Working with Time Deltas</h2><p>Time delta就相当于附加在datetime上的时间</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> _datetime <span class="keyword">import</span> datetime,timedelta</span><br><span class="line"> </span><br><span class="line">dt1 = datetime(<span class="number">2018</span>,<span class="number">1</span>,<span class="number">1</span>)+timedelta(days=<span class="number">23</span>,seconds=<span class="number">1000</span>)</span><br><span class="line">print(dt1)	<span class="comment">#2018-01-24 00:16:40</span></span><br><span class="line">duration = dt2-dt1</span><br><span class="line">print(duration)<span class="comment"># 847 days, 14:53:32.316273</span></span><br><span class="line">print(<span class="string">"days"</span>,duration.days)</span><br><span class="line">print(<span class="string">"seconds"</span>,duration.seconds)	<span class="comment"># 这算的是14:53:32.316273代表的秒数</span></span><br><span class="line">print(<span class="string">"total seconds"</span>,duration.total_seconds())<span class="comment"># 这算的是847 days, 14:53:32.316273的秒数</span></span><br><span class="line">print(<span class="string">""</span>)</span><br></pre></td></tr></table></figure>
<h2 id="Generating-Random-Values"><a href="#Generating-Random-Values" class="headerlink" title="Generating Random Values"></a>Generating Random Values</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line">print(random.random())		<span class="comment"># 生成一个0-1之间的随机数</span></span><br><span class="line">print(random.randint(<span class="number">1</span>,<span class="number">10</span>))	<span class="comment"># 生成一个1-10之间的整数</span></span><br><span class="line">print(random.choice([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]))<span class="comment"># 生成列表之间的一个数</span></span><br><span class="line">print(random.choices([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>],k=<span class="number">2</span>))	<span class="comment"># 生成两个从列表中选择的数字</span></span><br><span class="line">print(<span class="string">""</span>.join(random.choices( <span class="string">"abcdeusac8ui"</span>,k=<span class="number">4</span>)))<span class="comment">#生成4个，并合并成一个字符串</span></span><br><span class="line">print(<span class="string">""</span>.join(random.choices( string.ascii_letters+string.digits,k=<span class="number">4</span>)))</span><br><span class="line"><span class="comment"># ascii_letters是string类的一个属性，包含了所有大小写字母，通里digits包含了所有数字</span></span><br></pre></td></tr></table></figure>
<h2 id="Opening-the-Browser"><a href="#Opening-the-Browser" class="headerlink" title="Opening the Browser"></a>Opening the Browser</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import webbrowser</span><br><span class="line">print(&quot;Deplotment completed&quot;)</span><br><span class="line">webbrowser.open(&quot;http:&#x2F;&#x2F;google.com&quot;)</span><br></pre></td></tr></table></figure>
<h2 id="Sending-Emails"><a href="#Sending-Emails" class="headerlink" title="Sending Emails"></a>Sending Emails</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> email.mime.multipart <span class="keyword">import</span> MIMEMultipart</span><br><span class="line"><span class="keyword">from</span> email.mime.text <span class="keyword">import</span> MIMEText</span><br><span class="line"><span class="keyword">import</span> smtplib</span><br><span class="line">message = MIMEMultipart()</span><br><span class="line">message[<span class="string">"from"</span>] = <span class="string">"Jason"</span></span><br><span class="line">message[<span class="string">"to"</span>] = <span class="string">"目标邮箱"</span></span><br><span class="line">message[<span class="string">"subject"</span>] = <span class="string">"This is a test"</span></span><br><span class="line"></span><br><span class="line">message.attach(MIMEText(<span class="string">"Body"</span>))</span><br><span class="line"><span class="keyword">with</span> smtplib.SMTP(host=<span class="string">"smtp.gmail.com"</span>,port = <span class="number">587</span>) <span class="keyword">as</span> smtp:</span><br><span class="line">    smtp.ehlo()</span><br><span class="line">    smtp.starttls()</span><br><span class="line">    smtp.login(<span class="string">"邮箱"</span>,<span class="string">"密码"</span>)</span><br><span class="line">    smtp.send_message(message)</span><br><span class="line">    print(<span class="string">"Sent..."</span>)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/20/82-83%E5%88%A0%E9%99%A4%E9%93%BE%E8%A1%A8%E7%9A%84%E9%87%8D%E5%A4%8D%E5%85%83%E7%B4%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/20/82-83%E5%88%A0%E9%99%A4%E9%93%BE%E8%A1%A8%E7%9A%84%E9%87%8D%E5%A4%8D%E5%85%83%E7%B4%A0/" class="post-title-link" itemprop="url">82-83删除链表的重复元素</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-05-20 10:45:55 / Modified: 10:50:04" itemprop="dateCreated datePublished" datetime="2020-05-20T10:45:55+08:00">2020-05-20</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="82-删除排序链表中的重复元素-II"><a href="#82-删除排序链表中的重复元素-II" class="headerlink" title="82. 删除排序链表中的重复元素 II"></a>82. 删除排序链表中的重复元素 II</h1><h2 id="下面是题目"><a href="#下面是题目" class="headerlink" title="下面是题目"></a>下面是题目</h2><p><img src="/2020/05/20/82-83%E5%88%A0%E9%99%A4%E9%93%BE%E8%A1%A8%E7%9A%84%E9%87%8D%E5%A4%8D%E5%85%83%E7%B4%A0/1.png" alt></p>
<h3 id="下面是题目给出的模板"><a href="#下面是题目给出的模板" class="headerlink" title="下面是题目给出的模板"></a>下面是题目给出的模板</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">deleteDuplicates</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="这里给出两种放法，第一种是我通过模仿1171的思路通过unordered-map存储来实现的，第二种是更快的解题方法"><a href="#这里给出两种放法，第一种是我通过模仿1171的思路通过unordered-map存储来实现的，第二种是更快的解题方法" class="headerlink" title="这里给出两种放法，第一种是我通过模仿1171的思路通过unordered_map存储来实现的，第二种是更快的解题方法"></a>这里给出两种放法，第一种是我通过模仿1171的思路通过unordered_map存储来实现的，第二种是更快的解题方法</h3><h4 id="第一种"><a href="#第一种" class="headerlink" title="第一种"></a>第一种</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> 	这道题，我才用遍历两边的思路完成所有重复节点的删除</span></span><br><span class="line"><span class="comment"> 	拿123344556来做实验</span></span><br><span class="line"><span class="comment"> 	第一道遍历，将重复的节点删除，但保留重复的第一个节点，同时把3，4，5存储到set中</span></span><br><span class="line"><span class="comment">比如现在，链表已经变成123456了</span></span><br><span class="line"><span class="comment">	第二道遍历，判断节点值是否在set中出现过，如果出现，则删除，比如3，4，5已经在表中了。现在删除他们 最后的得到126</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">deleteDuplicates</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        ListNode*dummy = <span class="keyword">new</span> ListNode(<span class="number">0</span>);</span><br><span class="line">        dummy-&gt;next=head;</span><br><span class="line">        <span class="comment">//思路差不多，我也是利用unordered_map 来记录一个是否重复的元素</span></span><br><span class="line">        <span class="built_in">set</span>&lt;<span class="keyword">int</span>&gt;judge;</span><br><span class="line">        <span class="keyword">if</span>(!head) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">        ListNode *p = head;</span><br><span class="line">        <span class="keyword">while</span>( p-&gt;next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(p-&gt;next-&gt;val==p-&gt;val)</span><br><span class="line">            &#123;</span><br><span class="line">                p-&gt;next = p-&gt;next-&gt;next;</span><br><span class="line">                judge.insert(p-&gt;val);</span><br><span class="line">            &#125;<span class="keyword">else</span></span><br><span class="line">                p = p-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        p = dummy;</span><br><span class="line">        <span class="comment">//第二段遍历，删除存储在set中的节点</span></span><br><span class="line">        <span class="keyword">while</span>(p-&gt;next)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(judge.<span class="built_in">find</span>(p-&gt;next-&gt;val)!=judge.<span class="built_in">end</span>())</span><br><span class="line">              p-&gt;next = p-&gt;next-&gt;next;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">               p = p-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dummy-&gt;next;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="第二种解法"><a href="#第二种解法" class="headerlink" title="第二种解法"></a>第二种解法</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	这个方法也是遍历，但是没有依赖其他容器，而且只遍历了一遍</span></span><br><span class="line"><span class="comment">	思路：</span></span><br><span class="line"><span class="comment">		通过两个指针来实现遍历操作</span></span><br><span class="line"><span class="comment">		下面的题解以12333445为例</span></span><br><span class="line"><span class="comment">		</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">deleteDuplicates</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        ListNode* p = <span class="keyword">new</span> ListNode(<span class="number">0</span>);</span><br><span class="line">        p-&gt;next = head;</span><br><span class="line">        head = p;</span><br><span class="line">        <span class="keyword">while</span>(p-&gt;next)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!p-&gt;next-&gt;next) <span class="keyword">break</span>;</span><br><span class="line">            <span class="comment">//这里把p当作第一个重复节点的前一个结点进行运算，现在p为2，但是接下来是三个相同节点345</span></span><br><span class="line">            <span class="keyword">if</span>(p-&gt;next-&gt;val == p-&gt;next-&gt;next-&gt;val)&#123;</span><br><span class="line">                <span class="comment">//进入if语句后，把i指向第5个节点。如果第五个节点或者后面的节点还是和第3个节点的值一样，那就移动i，直到不一样位置，再把当前的p节点指向i，完成中间所有重复节点的删除</span></span><br><span class="line">                ListNode* i = p-&gt;next-&gt;next-&gt;next;</span><br><span class="line">                <span class="keyword">while</span>(i)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(i-&gt;val == p-&gt;next-&gt;val)&#123;</span><br><span class="line">                        i = i-&gt;next;</span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//更新p后面节点的值，也就是现在p-&gt;next =  4,开始下一轮遍历！</span></span><br><span class="line">                p-&gt;next = i;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//更新p的值，寻找下个重复的节点</span></span><br><span class="line">                p = p-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        head = head-&gt;next;</span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h1 id="83-删除排序链表中的重复元素"><a href="#83-删除排序链表中的重复元素" class="headerlink" title="83 删除排序链表中的重复元素"></a>83 删除排序链表中的重复元素</h1><p><img src="/2020/05/20/82-83%E5%88%A0%E9%99%A4%E9%93%BE%E8%A1%A8%E7%9A%84%E9%87%8D%E5%A4%8D%E5%85%83%E7%B4%A0/2.png" alt></p>
<h2 id="下面是题目给出的模板-1"><a href="#下面是题目给出的模板-1" class="headerlink" title="下面是题目给出的模板"></a>下面是题目给出的模板</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">deleteDuplicates</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ListNode* <span class="title">deleteDuplicates</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">    ListNode*cur = head;</span><br><span class="line">    ListNode*toDelete = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span>(!head) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">while</span>(cur-&gt;next)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(cur-&gt;next-&gt;val==cur-&gt;val)</span><br><span class="line">        &#123;</span><br><span class="line">            toDelete = cur -&gt;next;</span><br><span class="line">            cur-&gt;next= cur-&gt;next-&gt;next;</span><br><span class="line">            <span class="keyword">delete</span> toDelete;</span><br><span class="line">            toDelete = <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            cur=cur-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/20/1124%E8%A1%A8%E7%8E%B0%E8%89%AF%E5%A5%BD%E7%9A%84%E6%9C%80%E9%95%BF%E6%97%B6%E9%97%B4%E6%AE%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/20/1124%E8%A1%A8%E7%8E%B0%E8%89%AF%E5%A5%BD%E7%9A%84%E6%9C%80%E9%95%BF%E6%97%B6%E9%97%B4%E6%AE%B5/" class="post-title-link" itemprop="url">1124表现良好的最长时间段</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-05-20 09:22:20 / Modified: 09:24:04" itemprop="dateCreated datePublished" datetime="2020-05-20T09:22:20+08:00">2020-05-20</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1124表现良好的最长时间段"><a href="#1124表现良好的最长时间段" class="headerlink" title="1124表现良好的最长时间段"></a>1124表现良好的最长时间段</h1><p><img src="/2020/05/20/1124%E8%A1%A8%E7%8E%B0%E8%89%AF%E5%A5%BD%E7%9A%84%E6%9C%80%E9%95%BF%E6%97%B6%E9%97%B4%E6%AE%B5/1.png" alt></p>
<h3 id="解答"><a href="#解答" class="headerlink" title="解答"></a>解答</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">longestWPI</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; hours)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = hours.<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; count;</span><br><span class="line">        <span class="keyword">int</span> cur = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (hours[i] &gt; <span class="number">8</span>) &#123;</span><br><span class="line">                cur++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                cur--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (cur &gt; <span class="number">0</span>) res = i + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (count.count(cur<span class="number">-1</span>) &gt; <span class="number">0</span>) res = <span class="built_in">max</span>(res, i - count[cur<span class="number">-1</span>]);</span><br><span class="line">                <span class="keyword">if</span> (count.count(cur) &lt; <span class="number">1</span>) count[cur] = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/19/636%E5%87%BD%E6%95%B0%E7%8B%AC%E5%8D%A0%E6%97%B6%E9%97%B4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/19/636%E5%87%BD%E6%95%B0%E7%8B%AC%E5%8D%A0%E6%97%B6%E9%97%B4/" class="post-title-link" itemprop="url">636函数独占时间</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-05-19 23:23:50 / Modified: 23:35:32" itemprop="dateCreated datePublished" datetime="2020-05-19T23:23:50+08:00">2020-05-19</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="636函数独占时间"><a href="#636函数独占时间" class="headerlink" title="636函数独占时间"></a>636函数独占时间</h1><p><img src="/2020/05/19/636%E5%87%BD%E6%95%B0%E7%8B%AC%E5%8D%A0%E6%97%B6%E9%97%B4/1.png" alt></p>
<h3 id="下面是题目给出的模板"><a href="#下面是题目给出的模板" class="headerlink" title="下面是题目给出的模板"></a>下面是题目给出的模板</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">exclusiveTime</span><span class="params">(<span class="keyword">int</span> n, <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;&amp; logs)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><p>首先要明白，这是一个非抢占单线程CPU，也就是说每次只能执行一个函数，所以当第一个函数调用第二个函数之后，第一个函数就暂停执行了，只有当第二个函数执行完毕，才能会过来执行第一个函数</p>
<p>所以，我们自然可以用栈来模拟这个过程了</p>
<p>当一个函数开始的时候，入栈，所以多个函数调用的时候，栈顶就是当下正在运行的函数。</p>
<p>那么我们得到一个end命令的时候，很显然肯定是和栈顶元素匹配的，那么我们就计算出来这个栈顶函数运行的时间了</p>
<p>但是这还没完，如果栈非空，那么当下一个end命令的时候，如果不做些什么，那么计算得到的时间就包含了他调用的那个函数的执行时间，而事实上应该是 结束时的时间减去该函数的开始时间再减去中间调用函数的时间</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">exclusiveTime</span><span class="params">(<span class="keyword">int</span> n, <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;&amp; logs)</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">result</span><span class="params">(n, <span class="number">0</span>)</span></span>;</span><br><span class="line">        <span class="built_in">stack</span>&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&gt; stk;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">string</span> &amp;<span class="built_in">log</span> : logs) &#123;</span><br><span class="line">            <span class="comment">//这里对字符串进行一个切割操作</span></span><br><span class="line">            <span class="keyword">size_t</span> pos1 = <span class="built_in">log</span>.<span class="built_in">find</span>(<span class="string">':'</span>);</span><br><span class="line">            <span class="keyword">size_t</span> pos2 = <span class="built_in">log</span>.rfind(<span class="string">':'</span>);</span><br><span class="line">            <span class="comment">//这里通过stoi，得到这个函数的序号</span></span><br><span class="line">            <span class="keyword">int</span> currId = stoi(<span class="built_in">log</span>.substr(<span class="number">0</span>, pos1));</span><br><span class="line">            <span class="comment">//这里通过substr，得到了日志到底是start还是end</span></span><br><span class="line">            <span class="built_in">string</span> currAction = <span class="built_in">log</span>.substr(pos1+<span class="number">1</span>, pos2-pos1<span class="number">-1</span>);</span><br><span class="line">            <span class="comment">//这里得到了函数开始或结束的时间</span></span><br><span class="line">            <span class="keyword">int</span> currTimestamp = stoi(<span class="built_in">log</span>.substr(pos2+<span class="number">1</span>));</span><br><span class="line">            <span class="comment">//那么如果等于开始的话。就入栈</span></span><br><span class="line">            <span class="keyword">if</span> (currAction == <span class="string">"start"</span>) &#123;</span><br><span class="line">                stk.push(make_pair(currId, currTimestamp));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//否则，我们先计算栈顶的函数的执行时间</span></span><br><span class="line">                <span class="keyword">int</span> duration = currTimestamp - stk.top().second + <span class="number">1</span>;</span><br><span class="line">                result[currId] += duration;</span><br><span class="line">                stk.pop();</span><br><span class="line">                <span class="comment">//如果占非空，那么就要把占里面的函数的独占时间减去刚才计算的函数运行的时间</span></span><br><span class="line">                <span class="comment">//因为那些时间不是这些栈里面的函数的独占时间！</span></span><br><span class="line">                <span class="keyword">if</span> (!stk.empty()) &#123;</span><br><span class="line">                    result[stk.top().first] -= duration;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/19/C-%E5%A4%9A%E6%80%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/19/C-%E5%A4%9A%E6%80%81/" class="post-title-link" itemprop="url">C++多态</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-05-19 20:26:56 / Modified: 20:34:14" itemprop="dateCreated datePublished" datetime="2020-05-19T20:26:56+08:00">2020-05-19</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Day07总结"><a href="#Day07总结" class="headerlink" title="Day07总结"></a>Day07总结</h1><h2 id="静态联编和动态联编"><a href="#静态联编和动态联编" class="headerlink" title="静态联编和动态联编"></a>静态联编和动态联编</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"> * 静态联编和动态联编</span><br><span class="line"> *      静态多态——函数重载、运算符重载</span><br><span class="line"> *      动态多态——父子间继承+虚函数</span><br><span class="line"> *      动态多态满足条件</span><br><span class="line"> *           <span class="number">1.</span>父类中有虚函数</span><br><span class="line"> *           <span class="number">2.</span>子类重写父类的虚函数</span><br><span class="line"> *           <span class="number">3.</span> 父类的指针或者引用指向子类的对象</span><br><span class="line">                <span class="function"><span class="keyword">void</span> <span class="title">doSpeak</span><span class="params">(Animal &amp; animal)</span></span></span><br><span class="line"> *      重写的意义</span><br><span class="line"> *      子类重新实现父类中的虚函数，必须返回值，函数名，参数一致才称为重写</span><br><span class="line"> *		在子类中，重写函数前 <span class="keyword">virtual</span>可加可不加</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//加上virtual以后，变成了虚函数</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">speak</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"ANIMAL IS TALKING"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span>  <span class="title">eat</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"ANIMAL IS EATING"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span>:</span><span class="keyword">public</span> Animal</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">speak</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"THE CAT IS SPEAKING!!"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"THE CAT IS EATING!!"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span>:</span><span class="keyword">public</span> Animal</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">speak</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"THE DOG IS SPEAKING!!"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"THE DOG IS EATING!!"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">doSpeak</span><span class="params">(Animal &amp; animal)</span></span></span><br><span class="line"><span class="function"><span class="comment">//Animal &amp; animal = cat 父类的指针或者引用指向子类的对象</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    animal.speak();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">doeat</span><span class="params">(Animal &amp; animal)</span></span></span><br><span class="line"><span class="function"><span class="comment">//Animal &amp; animal = cat 父类的指针或者引用指向子类的对象</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    animal.eat();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//引用指向</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Cat cat;</span><br><span class="line">    doSpeak(cat);</span><br><span class="line">    Dog dog;</span><br><span class="line">    doSpeak(dog);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//指针指向</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Animal *animal = <span class="keyword">new</span> Cat;</span><br><span class="line">    Animal*animal1 =<span class="keyword">new</span> Dog;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="02多态原理"><a href="#02多态原理" class="headerlink" title="02多态原理"></a>02多态原理</h2><p> <img src="/2020/05/19/C-%E5%A4%9A%E6%80%81/1.png" style="zoom:67%;"></p>
<h2 id="03多态案例——计算器"><a href="#03多态案例——计算器" class="headerlink" title="03多态案例——计算器"></a>03多态案例——计算器</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">* 多态案例——计算器</span><br><span class="line">*    <span class="number">1.</span>  多态的好处：对拓展性的提高，组织性强，可读性强</span><br><span class="line">*    <span class="number">2.</span>  如果父类中有了虚函数，子类并没有重写父类的虚函数，那么这样的代码毫无意义</span><br><span class="line">*    <span class="number">3.</span>  如果子类不重写父类的虚函数，那么没有用到多态带来的好处 ，反而内部结构变化，复杂</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AbstractCal</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//纯虚函数</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">int</span> <span class="title">getResult</span><span class="params">()</span> </span>= <span class="number">0</span>;<span class="comment">//运行效果和原来一样</span></span><br><span class="line">    <span class="comment">//但是，如果一个类中有纯虚函数出现，这个类就无法实例化对象了</span></span><br><span class="line">    <span class="comment">//有纯虚函数的类，称为抽象类、</span></span><br><span class="line">    <span class="comment">//如果抽象类中有纯虚函数，子类中必须重写纯虚函数！！！否则子类也属于抽象类！！！也无法创造子类对象</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">int</span> <span class="title">getResult</span><span class="params">()</span></span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> m_A;</span><br><span class="line">    <span class="keyword">int</span> m_B;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//加法计算器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddCalculator</span>:</span><span class="keyword">public</span> AbstractCal</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">int</span> <span class="title">getResult</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  m_A+m_B;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//减法计算器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubCalculator</span>:</span><span class="keyword">public</span> AbstractCal</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">int</span> <span class="title">getResult</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  m_A-m_B;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//如果再加乘法，直接写子类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MultiCalculator</span>:</span><span class="keyword">public</span> AbstractCal</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">int</span> <span class="title">getResult</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  m_A*m_B;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//除法</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChuCalculator</span>:</span><span class="keyword">public</span> AbstractCal</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">int</span> <span class="title">getResult</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  m_A/m_B;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    AbstractCal *calculator = <span class="keyword">new</span> AddCalculator;</span><br><span class="line">    calculator-&gt;m_A = <span class="number">100</span>;</span><br><span class="line">    calculator-&gt;m_B= <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;calculator-&gt;<span class="built_in">getResult</span>()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    calculator = <span class="keyword">new</span> SubCalculator;<span class="comment">//让calculator重新指向减法</span></span><br><span class="line">    calculator-&gt;m_A = <span class="number">100</span>;</span><br><span class="line">    calculator-&gt;m_B= <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;calculator-&gt;<span class="built_in">getResult</span>()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="04抽象类和纯虚函数"><a href="#04抽象类和纯虚函数" class="headerlink" title="04抽象类和纯虚函数"></a>04抽象类和纯虚函数</h2><h3 id="纯虚函数语法"><a href="#纯虚函数语法" class="headerlink" title="纯虚函数语法"></a>纯虚函数语法</h3><ul>
<li>virtual void func() =0;</li>
<li>如果类中有了纯虚函数，那么这个类也称为抽象类</li>
<li>抽象类 是无法实例化对象的</li>
<li>如果抽象类中有纯虚函数，子类中必须重写纯虚函数！！！否则子类也属于抽象类！！！也无法创造子类对象</li>
<li>子类必须实现所有的纯虚函数！</li>
<li>virtual void func() =0;告诉编译器在vtable中为函数保留一个位置，但这个位置不放入地址</li>
</ul>
<h2 id="05虚析构和纯虚析构"><a href="#05虚析构和纯虚析构" class="headerlink" title="05虚析构和纯虚析构"></a>05虚析构和纯虚析构</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">*      如果子类中有属性创建在堆区，那么多态情况下，不会调用子类的析构代码，导致内存泄漏</span><br><span class="line">*      解决方案:虚析构或者纯虚析构</span><br><span class="line">*      虚析构：在析构前加关键词<span class="keyword">virtual</span>即可</span><br><span class="line">*      纯虚析构 <span class="keyword">virtual</span> ~函数名()=<span class="number">0</span>；</span><br><span class="line">*      纯虚析构::类内声明，类外实现</span><br><span class="line">*      如果一个类中有了纯虚析构函数后，那么这个类也属于抽象类型，不能实例化了</span><br><span class="line">*      但是有虚析构，不属于抽象类型，任然能实例化</span><br><span class="line">class Animal</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Animal()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"ANIMAL 的构造函数调用"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//	虚析构</span></span><br><span class="line">    <span class="keyword">virtual</span> ~Animal()<span class="comment">//有了虚析构，解决了</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"Animal 虚析构函数的调用"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">   &#125;</span><br><span class="line"><span class="comment">//  纯虚析构，类内实现</span></span><br><span class="line">      <span class="keyword">virtual</span> ~Animal() = <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//类外声明</span></span><br><span class="line">Animal::~Animal()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">"Animal 纯虚析构函数的调用"</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="06向上向下类型转换"><a href="#06向上向下类型转换" class="headerlink" title="06向上向下类型转换"></a>06向上向下类型转换</h2><p><img src="/2020/05/19/C-%E5%A4%9A%E6%80%81/2.png" style="zoom:67%;"></p>
<h2 id="07重写重载重定义"><a href="#07重写重载重定义" class="headerlink" title="07重写重载重定义"></a>07重写重载重定义</h2><p><img src="/2020/05/19/C-%E5%A4%9A%E6%80%81/3.png" style="zoom:67%;"></p>
<p><img src="/2020/05/19/C-%E5%A4%9A%E6%80%81/4.png" style="zoom:67%;"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/18/%E5%88%A9%E7%94%A8openpyxl%E6%93%8D%E4%BD%9C%E8%A1%A8%E6%A0%BC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/18/%E5%88%A9%E7%94%A8openpyxl%E6%93%8D%E4%BD%9C%E8%A1%A8%E6%A0%BC/" class="post-title-link" itemprop="url">利用openpyxl操作表格</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2020-05-18 10:55:57 / Modified: 11:02:24" itemprop="dateCreated datePublished" datetime="2020-05-18T10:55:57+08:00">2020-05-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="利用openpyxl操作表格"><a href="#利用openpyxl操作表格" class="headerlink" title="利用openpyxl操作表格"></a>利用openpyxl操作表格</h1><h3 id="下载openpyxl"><a href="#下载openpyxl" class="headerlink" title="下载openpyxl"></a>下载openpyxl</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install openpyxl</span><br></pre></td></tr></table></figure>
<h3 id="输出单元格信息"><a href="#输出单元格信息" class="headerlink" title="输出单元格信息"></a>输出单元格信息</h3><p><img src="/2020/05/18/%E5%88%A9%E7%94%A8openpyxl%E6%93%8D%E4%BD%9C%E8%A1%A8%E6%A0%BC/10.png" style="zoom:67%;"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> openpyxl <span class="keyword">as</span> xl</span><br><span class="line">wb = xl.load_workbook(<span class="string">'transactions.xlsx'</span>)</span><br><span class="line">sheet = wb[<span class="string">'Sheet1'</span>]</span><br><span class="line">cell = sheet[<span class="string">'a1'</span>]</span><br><span class="line"><span class="comment">#cell = sheet.cell(1,1) 这句代码和上一句是等价的，都指代A1单元格</span></span><br><span class="line">print(cell.value)</span><br></pre></td></tr></table></figure>
<p>这段代码，输出的就是 transaction_id这个信息</p>
<h3 id="打印一列的表格内容"><a href="#打印一列的表格内容" class="headerlink" title="打印一列的表格内容"></a>打印一列的表格内容</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> openpyxl <span class="keyword">as</span> xl</span><br><span class="line"><span class="keyword">from</span> openpyxl.chart <span class="keyword">import</span> BarChart ,Reference</span><br><span class="line">wb = xl.load_workbook(<span class="string">'transactions.xlsx'</span>)</span><br><span class="line">sheet = wb[<span class="string">'Sheet1'</span>]</span><br><span class="line">cell = sheet[<span class="string">'a1'</span>]</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> range(<span class="number">2</span>,sheet.max_row+<span class="number">1</span>):</span><br><span class="line">    cell = sheet.cell(row,<span class="number">3</span>)</span><br><span class="line">    correct_price = cell.value*<span class="number">0.9</span>			<span class="comment"># 计算新数据</span></span><br><span class="line">    correct_price_cell = sheet.cell(row,<span class="number">4</span>)	<span class="comment"># 每行的第四列上，指定一段区域</span></span><br><span class="line">    correct_price_cell.value = correct_price<span class="comment"># 然后再第四列中放入计算的新数据</span></span><br><span class="line">    print(correct_price)</span><br></pre></td></tr></table></figure>
<h3 id="对单元格计算并保存"><a href="#对单元格计算并保存" class="headerlink" title="对单元格计算并保存"></a>对单元格计算并保存</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wb.save(<span class="string">'transactions3.xlsx'</span>)	<span class="comment"># 运用save方法，在里面写新的文件名称</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/18/%E5%88%A9%E7%94%A8openpyxl%E6%93%8D%E4%BD%9C%E8%A1%A8%E6%A0%BC/11.png" style="zoom:67%;"></p>
<h3 id="制作图表"><a href="#制作图表" class="headerlink" title="制作图表"></a>制作图表</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> openpyxl <span class="keyword">as</span> xl</span><br><span class="line"><span class="comment"># 制作图表，要引进这两个模块</span></span><br><span class="line"><span class="keyword">from</span> openpyxl.chart <span class="keyword">import</span> BarChart ,Reference</span><br><span class="line">wb = xl.load_workbook(<span class="string">'transactions.xlsx'</span>)</span><br><span class="line">sheet = wb[<span class="string">'Sheet1'</span>]</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> range(<span class="number">2</span>,sheet.max_row+<span class="number">1</span>):</span><br><span class="line">    cell = sheet.cell(row,<span class="number">3</span>)</span><br><span class="line">    correct_price = cell.value*<span class="number">0.9</span></span><br><span class="line">    correct_price_cell = sheet.cell(row,<span class="number">4</span>)</span><br><span class="line">    correct_price_cell.value = correct_price</span><br><span class="line">    print(correct_price)</span><br><span class="line"><span class="comment"># 筛选我们的数据，数据范围是第二行到最后一行的第四列，也就是我们新建立的内容</span></span><br><span class="line">values = Reference(sheet,</span><br><span class="line">              min_row=<span class="number">2</span>,</span><br><span class="line">              max_row= sheet.max_row,</span><br><span class="line">              min_col=<span class="number">4</span>,</span><br><span class="line">              max_col=<span class="number">4</span>)</span><br><span class="line"><span class="comment"># 新建一个柱状图对象</span></span><br><span class="line">chart = BarChart()</span><br><span class="line"><span class="comment"># 把值添加到chart当中去</span></span><br><span class="line">chart.add_data(values)</span><br><span class="line"><span class="comment"># 把表添加到e2单元格中去</span></span><br><span class="line">sheet.add_chart(chart,<span class="string">'e2'</span>)</span><br><span class="line"><span class="comment"># 保存</span></span><br><span class="line">wb.save(<span class="string">'transactions3.xlsx'</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/18/%E5%88%A9%E7%94%A8openpyxl%E6%93%8D%E4%BD%9C%E8%A1%A8%E6%A0%BC/12.png" style="zoom:67%;"></p>
<h3 id="美化代码"><a href="#美化代码" class="headerlink" title="美化代码"></a>美化代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> openpyxl <span class="keyword">as</span> xl</span><br><span class="line"><span class="keyword">from</span> openpyxl.chart <span class="keyword">import</span> BarChart ,Reference</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_workbook</span><span class="params">(filename)</span>:</span></span><br><span class="line">    wb = xl.load_workbook(filename)</span><br><span class="line">    sheet = wb[<span class="string">'Sheet1'</span>]</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> range(<span class="number">2</span>,sheet.max_row+<span class="number">1</span>):</span><br><span class="line">        cell = sheet.cell(row,<span class="number">3</span>)</span><br><span class="line">        correct_price = cell.value*<span class="number">0.9</span></span><br><span class="line">        correct_price_cell = sheet.cell(row,<span class="number">4</span>)</span><br><span class="line">        correct_price_cell.value = correct_price</span><br><span class="line">        print(correct_price)</span><br><span class="line"></span><br><span class="line">    values = Reference(sheet,</span><br><span class="line">                  min_row=<span class="number">2</span>,</span><br><span class="line">                  max_row= sheet.max_row,</span><br><span class="line">                  min_col=<span class="number">4</span>,</span><br><span class="line">                  max_col=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">    chart = BarChart()</span><br><span class="line">    chart.add_data(values)</span><br><span class="line">    sheet.add_chart(chart,<span class="string">'e2'</span>)</span><br><span class="line">    wb.save(filename)</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">Mysql基础</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-16 18:52:44" itemprop="dateCreated datePublished" datetime="2020-05-16T18:52:44+08:00">2020-05-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-22 14:28:06" itemprop="dateModified" datetime="2022-11-22T14:28:06+08:00">2022-11-22</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Mysql基础"><a href="#Mysql基础" class="headerlink" title="Mysql基础"></a>Mysql基础</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>数据库分为 Relational 和 NoSQL 两种，也就是我们所说的关系型数据库和非关系型数据库。</p>
<p>Mysql是一个关系型数据库，可以通过sql语言进行各种操作。除此之外还有SQL server，Oracle等数据库</p>
<p>MongoDB是一个非关系型数据库，通过 键值对的方式来存储</p>
<p>SQL 的全称是 Structured English Query Language，</p>
<h2 id="SQL语法规则"><a href="#SQL语法规则" class="headerlink" title="SQL语法规则"></a>SQL语法规则</h2><ol>
<li>sql不区分大小写，但是关键词最好大写</li>
<li>每句sql语句必须以分号‘；’结束</li>
<li>WorkBench 上运行语句的快捷键： CTRL+Shift+ Enter，DataGrip上运行快捷键：Ctrl+Enter</li>
<li>sql中语句注释，运用 — 或者快捷键 CTRL+/</li>
<li>当sql语句太长的时候，可以运用锁紧换行的操作，来让语句更加美观简洁</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">       first_name,</span><br><span class="line">       last_name ,</span><br><span class="line">       points,</span><br><span class="line">       points*10+100</span><br><span class="line">FROM customers;</span><br></pre></td></tr></table></figure>
<h2 id="选择语句"><a href="#选择语句" class="headerlink" title="选择语句"></a>选择语句</h2><h3 id="SELECT-语句"><a href="#SELECT-语句" class="headerlink" title="SELECT 语句"></a>SELECT 语句</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM customers</span><br></pre></td></tr></table></figure>
<p>查询所有内容，*代表所有的列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM customers WHERE customer_id &#x3D; 1</span><br></pre></td></tr></table></figure>
<p>加了限制条件， 意思是customers中 customer_id 这列为1 的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM customers ORDER BY first_name;</span><br></pre></td></tr></table></figure>
<p>这句的意思是信息按照 first_name 的大小进行，排序，如果是字母，那就按照alphabet顺序排列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT first_name, last_name,points,points+10 FROM customers;</span><br></pre></td></tr></table></figure>
<p>此外还可以对数字列做四则运算的操作</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/1.png" style="zoom:67%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">	points*10+100 AS discount_factor </span><br><span class="line">FROM customers;</span><br></pre></td></tr></table></figure>
<p>把新操作的列重命名。</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/2.png" style="zoom:100%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT DISTINCT state FROM customers</span><br></pre></td></tr></table></figure>
<p>这能让表单内容不重复</p>
<h4 id="小练习："><a href="#小练习：" class="headerlink" title="小练习："></a>小练习：</h4><p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/3.png" style="zoom: 50%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line">SELECT  name , unit_price,unit_price*1.1 AS &#39;New Price&#39;</span><br><span class="line">FROM products;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/4.png" style="zoom: 80%;"></p>
<h3 id="WHERE语句"><a href="#WHERE语句" class="headerlink" title="WHERE语句"></a>WHERE语句</h3><p>where 语句可以用来进一步筛选</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">WHERE points&gt;3000</span><br></pre></td></tr></table></figure>
<p>此外还可以用 &gt; ,&lt;,&gt;=,&lt;=,=,!=,&lt;&gt; 其中&lt;&gt;也是不等于的意思</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">WHERE state &#x3D; &#39;VA&#39;</span><br></pre></td></tr></table></figure>
<p>或者可以让他等于一个字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">WHERE birth_date &gt; &#39;1990-01-01&#39;</span><br></pre></td></tr></table></figure>
<p>这是对date类型的列进行比较，这里是筛选在1990-01-01之后出生的信息，<strong>注意是之后！</strong> </p>
<h4 id="小练习"><a href="#小练习" class="headerlink" title="小练习"></a>小练习</h4><p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/5.png" style="zoom: 50%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM orders</span><br><span class="line">WHERE  order_date&gt;&#x3D;&#39;2019-01-01&#39;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/6.png" style="zoom: 100%;"></p>
<h3 id="利用and，or，not-实现多条件查询"><a href="#利用and，or，not-实现多条件查询" class="headerlink" title="利用and，or，not 实现多条件查询"></a>利用and，or，not 实现多条件查询</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">WHERE  birth_date&gt;&#39;1990-01-01&#39;AND points &gt;1000</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">WHERE  birth_date&gt;&#39;1990-01-01&#39; OR points &gt;1000</span><br></pre></td></tr></table></figure>
<p>上面的是都要满足，下面是择一满足即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">WHERE  birth_date&gt;&#39;1990-01-01&#39; OR points &gt;1000 AND state  &#x3D; &#39;VA&#39;</span><br></pre></td></tr></table></figure>
<p> birth_date&gt;’1990-01-01’ 是一个条件，points &gt;1000 AND state  = ‘VA’又是另外一个条件</p>
<p>也可以用(）修改逻辑</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">WHERE  NOT (birth_date&gt;&#39;1990-01-01&#39; OR points &gt;1000 )</span><br></pre></td></tr></table></figure>
<p>当我们用NOT 语句，就是对后面的条件进行否定  </p>
<h4 id="小练习-1"><a href="#小练习-1" class="headerlink" title="小练习"></a>小练习</h4><p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/7.png" style="zoom:  40%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM order_items where order_id &#x3D; 6</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/9.png" style="zoom: 80%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">USE store;</span><br><span class="line">SELECT *,quantity*unit_price as total_price</span><br><span class="line">FROM store.order_items WHERE quantity*unit_price &gt;30;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/8.png" style="zoom: 80%;"></p>
<h3 id="IN-操作符"><a href="#IN-操作符" class="headerlink" title="IN 操作符"></a>IN 操作符</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use store;</span><br><span class="line">SELECT *</span><br><span class="line">FROM customers where state &#x3D; &#39;VA&#39; OR state &#x3D; &#39;GA&#39; OR state &#x3D; &#39;FL&#39;</span><br></pre></td></tr></table></figure>
<p>如果我们要通过or语句选择很多信息，但是 不可以用 state = ‘VA’ or ‘GA’ or ‘FL’，那么我们就可以用 IN操作符，在 IN前也可以用 NOT 进行取反操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use store;</span><br><span class="line">SELECT *</span><br><span class="line">FROM customers where state IN (&#39;VA&#39;,&#39;FL&#39;,&#39;GA&#39;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use store;</span><br><span class="line">SELECT *</span><br><span class="line">FROM customers where state NOT IN (&#39;VA&#39;,&#39;FL&#39;,&#39;GA&#39;)</span><br></pre></td></tr></table></figure>
<h4 id="小练习-2"><a href="#小练习-2" class="headerlink" title="小练习"></a>小练习</h4><ol>
<li><p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/10.png" style="zoom: 40%;"></p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">use store;</span><br><span class="line">SELECT *</span><br><span class="line">FROM products where quantity_in_stock IN (49,38,72)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/11.png" style="zoom: 100%;"></p>
<p>因为没有 quantity_in_stock为72 的信息，所以只显示了2条</p>
<ol>
<li>SQLZOO nobel p14</li>
</ol>
<p><strong>Show the 1984 winners and subject ordered by subject and winner name; but list Chemistry and Physics last.</strong></p>
<p>表格如下所示，我们要对1984年的得奖者进行筛选，但是要求我们把Chemistry和Physics的获奖者列在最后，这要怎么实现？</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/106.png" style="zoom: 50%;"></p>
<p>这就要依赖与 IN 关键词了，它将符合条件的信息置为1，不符合条件的置为0，比如说：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> winner, subject, subject <span class="keyword">IN</span> (<span class="string">'Physics'</span>,<span class="string">'Chemistry'</span>)</span><br><span class="line"><span class="keyword">FROM</span> nobelwinner</span><br><span class="line"><span class="keyword">WHERE</span> yr=<span class="number">1984</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> subject,winner</span><br></pre></td></tr></table></figure>
<p>结果如下:</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/107.png" style="zoom: 50%;"></p>
<p>我们就可以根据这0和1来排序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> winner, subject</span><br><span class="line">  <span class="keyword">FROM</span> nobelwinner</span><br><span class="line"> <span class="keyword">WHERE</span> yr=<span class="number">1984</span></span><br><span class="line"> <span class="keyword">ORDER</span> <span class="keyword">BY</span> subject <span class="keyword">IN</span> (<span class="string">'Physics'</span>,<span class="string">'Chemistry'</span>),subject,winner</span><br></pre></td></tr></table></figure>
<p>按照01排好之后，别忘了题目说还是要按照subject和winner排列，因此最终排序的关键词有三个。</p>
<h3 id="BETWEEN-运算符"><a href="#BETWEEN-运算符" class="headerlink" title="BETWEEN 运算符"></a>BETWEEN 运算符</h3><p>当我们要写如下语句时</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers where points &gt;&#x3D; 1000 AND points&lt;&#x3D; 3000</span><br></pre></td></tr></table></figure>
<p>我们可以利用BETWEEN 操作符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers where points BETWEEN 1000 AND 3000</span><br></pre></td></tr></table></figure>
<p>注意，BETEWEEN 是大于等于和小于等于</p>
<h4 id="小练习：-1"><a href="#小练习：-1" class="headerlink" title="小练习："></a>小练习：</h4><p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/12.png" style="zoom: 40%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers where birth_date</span><br><span class="line">    BETWEEN &#39;1990-01-01&#39; AND &#39;2000-01-01&#39;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/13.png" style="zoom: 60%;"></p>
<h3 id="LIKE-运算符"><a href="#LIKE-运算符" class="headerlink" title="LIKE 运算符"></a>LIKE 运算符</h3><p>like操作符可以匹配字符串等操作，实现模糊查询</p>
<p>这里的 <code>%</code> 和 <code>_</code> 被称为 wildcard,也就是”癞子”，可以替代其他字符。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers where last_name LIKE &#39;b%&#39;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/14.png" style="zoom: 60%;"></p>
<p>就可以匹配到姓以大写或小写b开头信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers where last_name LIKE &#39;_____y&#39;</span><br></pre></td></tr></table></figure>
<p>这里是匹配第六个字母是y的信息，前面写 5个_ ，匹配随便五个字符</p>
<p>还可以这样，匹配以b开头，以y结尾，长度为6的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers where last_name LIKE &#39;b____y&#39;</span><br></pre></td></tr></table></figure>
<p>注意点来了</p>
<blockquote>
<p><code>%</code> 代表任意多个字符<br><code>_</code> 仅仅代表一个字符</p>
</blockquote>
<h4 id="小练习-3"><a href="#小练习-3" class="headerlink" title="小练习"></a>小练习</h4><p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/15.png" style="zoom: 40%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">    WHERE address LIKE &#39;%TRAIL%&#39; OR </span><br><span class="line">          address LIKE &#39;%AVENUE%&#39;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/16.png" style="zoom: 60%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">    WHERE phone LIKE &#39;%9&#39;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/17.png" style="zoom: 51%;"></p>
<p><strong>Equatorial Guinea</strong> and <strong>Dominican Republic</strong> have all of the vowels (a e i o u) in the name. They don’t count because they have more than one word in the name.</p>
<p>Find the country that has all the vowels and no spaces in its name.</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/105.png" style="zoom: 51%;"></p>
<p>这题让我们查询国名中包含五个元音字母且不包含空格的国家，我们这里不能用 REGEXP 因为我们不知道其排列顺序。 因此我们只能傻乎乎的一个一个找。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span> </span><br><span class="line"><span class="keyword">FROM</span> world</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> <span class="keyword">LIKE</span> <span class="string">'%a%'</span></span><br><span class="line">  <span class="keyword">AND</span> <span class="keyword">name</span> <span class="keyword">LIKE</span> <span class="string">'%e%'</span></span><br><span class="line">  <span class="keyword">AND</span> <span class="keyword">name</span> <span class="keyword">LIKE</span> <span class="string">'%i%'</span></span><br><span class="line">  <span class="keyword">AND</span> <span class="keyword">name</span> <span class="keyword">LIKE</span> <span class="string">'%o%'</span></span><br><span class="line">  <span class="keyword">AND</span> <span class="keyword">name</span> <span class="keyword">LIKE</span> <span class="string">'%u%'</span></span><br><span class="line">  <span class="keyword">AND</span> <span class="keyword">name</span> <span class="keyword">NOT</span> <span class="keyword">LIKE</span> <span class="string">'% %'</span></span><br></pre></td></tr></table></figure>
<h3 id="REGEXP-运算符"><a href="#REGEXP-运算符" class="headerlink" title="REGEXP 运算符"></a>REGEXP 运算符</h3><p>所谓REGEXP 就是正则表达式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">    WHERE last_name REGEXP &#39;field&#39;</span><br></pre></td></tr></table></figure>
<p>用正则表达式就不用再前面写%%这类的匹配符号了，如果想找field，mysql就会自动搜寻last_name 中包含field的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">WHERE last_name REGEXP &#39;^field&#39; -- 如果在前面加上 ^ 符号，代表必须以field开头</span><br><span class="line">WHERE last_name REGEXP &#39;field$&#39; -- 后面加上 $ 符号，代表必须以 field结束</span><br><span class="line">WHERE last_name REGEXP &#39;mac|field|rose&#39; -- 查询多个条件，运用 | 符号</span><br><span class="line">WHERE last_name REGEXP &#39;[gim]e&#39;	-- 包含 ge,ie,me 的信息</span><br><span class="line">WHERE last_name REGEXP &#39;[a-h]e&#39; -- e前面可为a-h的任意一个字符</span><br></pre></td></tr></table></figure>
<h4 id="小练习-4"><a href="#小练习-4" class="headerlink" title="小练习"></a>小练习</h4><p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/18.png" style="zoom: 40%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">    WHERE first_name REGEXP &#39;ELKA|AMBUR&#39;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/19.png" style="zoom: 80%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">    WHERE last_name REGEXP &#39;EY$|ON$&#39;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/20.png" style="zoom: 80%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">    WHERE last_name REGEXP &#39;^MY|SE&#39;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/21.png" style="zoom: 80%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">    WHERE last_name REGEXP &#39;B[RU]&#39;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/22.png" style="zoom: 80%;"></p>
<h3 id="IS-NULL-运算符"><a href="#IS-NULL-运算符" class="headerlink" title="IS NULL 运算符"></a>IS NULL 运算符</h3><p>IS NULL 可以筛选所有该列为值 NULL 的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">    WHERE phone IS NULL</span><br></pre></td></tr></table></figure>
<p>IS NOT NULL 可以筛选非空信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">    WHERE shipper_id IS NULL</span><br></pre></td></tr></table></figure>
<h4 id="小练习-5"><a href="#小练习-5" class="headerlink" title="小练习"></a>小练习</h4><p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/23.png" style="zoom: 40%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM orders</span><br><span class="line">    WHERE shipped_date IS NULL</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/24.png" style="zoom: 80%;"></p>
<h3 id="The-ORDER-BY-子句"><a href="#The-ORDER-BY-子句" class="headerlink" title="The ORDER BY 子句"></a>The ORDER BY 子句</h3><p>选择信息的排列方式</p>
<p><strong>按照first_name 正序排列</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">ORDER BY first_name</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/26.png" style="zoom: 80%;"></p>
<p><strong>按照first_name 逆序排列</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">ORDER BY first_name DESC</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/25.png" style="zoom: 80%;"></p>
<p><strong>多关键词排列</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">ORDER BY state,first_name</span><br></pre></td></tr></table></figure>
<p>先按照state排列，如果state相同，再按照first_name 进行排列</p>
<p><strong>Mysql 支持 不显示排序列，只显示选择列</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT first_name,last_name</span><br><span class="line">FROM customers</span><br><span class="line">ORDER BY birth_date</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/27.png" style="zoom: 80%;"></p>
<p><strong>mysql支持对零时新建列进行排序</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT first_name,last_name,10+customer_id AS points</span><br><span class="line">FROM customers</span><br><span class="line">ORDER BY points,birth_date</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/28.png" style="zoom: 80%;"></p>
<p><strong>也可以用1，2代替first_name和last_name </strong>(不推荐)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT first_name,last_name,10+customer_id AS points</span><br><span class="line">FROM customers</span><br><span class="line">ORDER BY 1,2</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/29.png" style="zoom: 80%;"></p>
<h4 id="小练习-6"><a href="#小练习-6" class="headerlink" title="小练习"></a>小练习</h4><p>筛选出 order_items 中 order_id =2,且总价降序排列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">USE store;</span><br><span class="line">SELECT *,quantity*unit_price AS total_price</span><br><span class="line">FROM order_items WHERE order_id &#x3D; 2</span><br><span class="line">ORDER BY total_price DESC</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/30.png" style="zoom: 80%;"></p>
<h3 id="LIMIT运算符"><a href="#LIMIT运算符" class="headerlink" title="LIMIT运算符"></a>LIMIT运算符</h3><p><strong>限制返回的信息数量</strong>，如果小于3，那么全返回，否则就返回三条</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">LIMIT 3</span><br></pre></td></tr></table></figure>
<p><strong>通过偏移量来选择</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">LIMIT 6,3</span><br></pre></td></tr></table></figure>
<p>这句话的意思就是跳过6条信息，然后从第七条开始返回3条信息，也就是7，8，9</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/31.png" style="zoom: 70%;"></p>
<h4 id="小测试"><a href="#小测试" class="headerlink" title="小测试"></a>小测试</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM customers</span><br><span class="line">ORDER BY points DESC</span><br><span class="line">LIMIT 3</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/33.png" style="zoom: 40%;"></p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/32.png" style="zoom: 80%;"></p>
<h3 id="TIPS"><a href="#TIPS" class="headerlink" title="TIPS"></a>TIPS</h3><p>学到这我总结几个小的细节点：</p>
<ul>
<li>BETWEEN  a AND b ; IN (a,b) 这两个语法要区分开来</li>
<li>在做限定的时候，如果是字符串，一定要用引号括起来</li>
<li>当字符串中有单引号<code>&#39;</code>时，将其替换成两个单引号。比如：<code>SELECT * FROM nobel WHERE winner LIKE &#39;Eugene O&#39;&#39;Neill&#39;</code>, 这个人原本的名字叫： <strong>Eugene O’Neill(尤金 奥尼尔)</strong></li>
</ul>
<h2 id="连接方式-在多张表各种检索"><a href="#连接方式-在多张表各种检索" class="headerlink" title="连接方式(在多张表各种检索)"></a>连接方式(在多张表各种检索)</h2><h3 id="Inner-Joins-内连接"><a href="#Inner-Joins-内连接" class="headerlink" title="Inner Joins 内连接"></a>Inner Joins 内连接</h3><p>到现在我们只筛选了一张表中的信息，那么如何筛选多张表中的信息呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM orders</span><br><span class="line">JOIN customers</span><br><span class="line">    ON orders.customer_id &#x3D; customers.customer_id</span><br></pre></td></tr></table></figure>
<p>这个意思是 把customers表格也加入进来，但是要让customer中的id和orders中的id一一对应，形成一张完整的表格</p>
<p>为了简化表格，我们只选择有需要的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order_id,first_name ,last_name</span><br></pre></td></tr></table></figure>
<p>当我们要在两张表中选择名字相同的列的时候，<strong>我们需要使用前缀</strong>，不然Mysql不知道我们到底想要那张表格中的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT order_id,orders.customer_id,customers.customer_id,first_name ,last_name</span><br></pre></td></tr></table></figure>
<p><strong>也可以通过缩写，简短我们的代码量</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT order_id,o.customer_id,c.customer_id,first_name ,last_name</span><br><span class="line">FROM orders o </span><br><span class="line">JOIN customers c</span><br><span class="line">    ON o.customer_id &#x3D; c.customer_id</span><br></pre></td></tr></table></figure>
<h4 id="小练习-7"><a href="#小练习-7" class="headerlink" title="小练习"></a>小练习</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT order_id,o.product_id,p.name, quantity, o.unit_price</span><br><span class="line">FROM order_items o</span><br><span class="line">JOIN products p on o.product_id &#x3D; p.product_id</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/34.png" style="zoom: 80%;"></p>
<h4 id="小练习2"><a href="#小练习2" class="headerlink" title="小练习2"></a>小练习2</h4><p>这是SQLZOO-JOIN上的题目，数据表如下：</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/109.png" style="zoom: 50%;"></p>
<p>1.<strong>For every match involving ‘POL’, show the matchid, date and the number of goals scored.</strong></p>
<p>要我们找出 所有关于波兰的比赛，并列出比赛中进的球数。</p>
<p>一开始我是这么写的：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> matchid,mdate,<span class="keyword">COUNT</span>(*)</span><br><span class="line"><span class="keyword">FROM</span> game </span><br><span class="line"><span class="keyword">JOIN</span> goal <span class="keyword">ON</span> (matchid = <span class="keyword">id</span> )</span><br><span class="line"><span class="keyword">WHERE</span> (team1 = <span class="string">'POL'</span> <span class="keyword">OR</span> team2 = <span class="string">'POL'</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> matchid</span><br></pre></td></tr></table></figure>
<p>结果报错了，说是</p>
<p>[42000][1055] Expression #2 of SELECT list is not in GROUP BY clause and contains nonaggregated column ‘nobel.game.mdate’ which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by</p>
<p>ONLY_FULL_GROUP_BY的意思是：对于GROUP BY聚合操作，如果在SELECT中的列，没有在GROUP BY中出现，那么这个SQL是不合法的，因为列不在GROUP BY从句中，<strong>也就是说查出来的列必须在group by后面出现</strong>，否则就会报错，或者这个字段出现在聚合函数里面。  </p>
<p>因此这里正确的做法是： `GROUP BY matchid,mdate</p>
<ol>
<li>同理，<strong>For every match where ‘GER’ scored, show matchid, match date and the number of goals scored by ‘GER’</strong></li>
</ol>
<p>的做法也是一样：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> matchid, mdate, <span class="keyword">COUNT</span>(*) </span><br><span class="line"><span class="keyword">FROM</span> game</span><br><span class="line"><span class="keyword">JOIN</span> goal <span class="keyword">ON</span> <span class="keyword">id</span>=matchid </span><br><span class="line"><span class="keyword">WHERE</span>  teamid = <span class="string">'GER'</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> matchid,mdate;</span><br></pre></td></tr></table></figure>
<h3 id="Joining-Across-Databases-跨数据库连接"><a href="#Joining-Across-Databases-跨数据库连接" class="headerlink" title="Joining Across Databases 跨数据库连接"></a>Joining Across Databases 跨数据库连接</h3><p>刚才是搜寻一个数据库中多张表的内容，现在搜寻多个数据库中的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">USE store;</span><br><span class="line">SELECT *</span><br><span class="line">FROM order_items oi</span><br><span class="line">JOIN sql_inventory.products p</span><br><span class="line">    ON oi.product_id &#x3D; p.product_id</span><br></pre></td></tr></table></figure>
<p>上面用的是在store数据库里的操作</p>
<p>那么如果我 改成sql_inventory 的话，就需要在order_items前加上前缀</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">USE sql_inventory;</span><br><span class="line">SELECT *</span><br><span class="line">FROM sql_store.order_items oi</span><br><span class="line">JOIN  products p</span><br><span class="line">    ON oi.product_id &#x3D; p.product_id</span><br></pre></td></tr></table></figure>
<h3 id="Self-Joining自连接"><a href="#Self-Joining自连接" class="headerlink" title="Self Joining自连接"></a>Self Joining自连接</h3><p>首先我们来分析一下这张表格</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/35.png" style="zoom: 67%;"></p>
<p>如果我们要找到这些员工的经理是谁，我们需要看reports_to 和 employee_id两列，那么我们知道第二行的员工是没有reports_to这一行的，而其他人的reports_to都指向了第二个人，所以说第二个人就是经理</p>
<p>现在我们要在mysql中筛选出所有员工的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">USE sql_hr;</span><br><span class="line">SELECT</span><br><span class="line">    e.employee_id,</span><br><span class="line">    e.first_name,</span><br><span class="line">    m.first_name AS manager</span><br><span class="line">FROM employees e</span><br><span class="line">JOIN employees m</span><br><span class="line">    ON e.reports_to &#x3D; m.employee_id</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/36.png" style="zoom: 67%;"></p>
<p>我们再来看几个例子：</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/112.png" style="zoom: 67%;"></p>
<ul>
<li>Execute the self join shown and observe that b.stop gives all the places you can get to from Craiglockhart, without changing routes. Change the query so that it shows the services from Craiglockhart(149) to London Road(149).</li>
</ul>
<p>这道题要我们使用自连接，给出从Craiglockhart到London Road 的公交路线。这里在匹配的时候注意要匹配两个字段，一个是company一个是num。因为要从Craiglock出发去LondonRoad， 但是公交线路一般是双向的，因此只要让<code>a.stop</code>和<code>b.stop</code>一个等于53 一个等于149即可(分别是两站的id)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.company, a.num, a.stop, b.stop</span><br><span class="line"><span class="keyword">FROM</span> route a <span class="keyword">JOIN</span> route b <span class="keyword">ON</span></span><br><span class="line">  (a.company=b.company <span class="keyword">AND</span> a.num=b.num)</span><br><span class="line"><span class="keyword">WHERE</span> a.stop=<span class="number">53</span> <span class="keyword">AND</span> b.stop=<span class="number">149</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Give a list of the services which connect the <strong>stops</strong> ‘Craiglockhart’ and ‘Tollcross’进阶一点，如果要让我们直接找出连接这两站的路线，那么除了自连接意外，还需要连接stops表，但是注意了stop表也要连两次，分别与a和b</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.company, a.num </span><br><span class="line"><span class="keyword">FROM</span> route a </span><br><span class="line"><span class="keyword">JOIN</span> route b </span><br><span class="line"><span class="keyword">ON</span> (a.company=b.company <span class="keyword">AND</span> a.num=b.num)</span><br><span class="line"><span class="keyword">JOIN</span> stops stopa <span class="keyword">ON</span> (a.stop=stopa.id)</span><br><span class="line"><span class="keyword">JOIN</span> stops stopb <span class="keyword">ON</span> (b.stop=stopb.id)</span><br><span class="line"><span class="keyword">WHERE</span> stopa.name=<span class="string">'Craiglockhart'</span> <span class="keyword">AND</span> stopb.name = <span class="string">'Tollcross'</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Find the routes involving two buses that can go from <strong>Craiglockhart</strong> to <strong>Lochend</strong>.<br>Show the bus no. and company for the first bus, the name of the stop for the transfer,<br>and the bus no. and company for the second bus.</li>
</ul>
<p>这道题让我们找出换乘路线，以及对应的换乘站点。即要找两路公交车，始发站是 Craiglockhart,终点站是Lochend，在当中的某一站换乘。</p>
<p>思路：做两次Self-Join，第一次自连接得到的结果v1是所有从Craiglockhart发出的公交车</p>
<p>第二次自连接得到的结果v2是所有可以到达Lochend 的公交车</p>
<p>然后把这两张表连接，连接条件是V1路线的末站等于V2路线的初站</p>
<p>得到结果</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> v1.num,v1.company, <span class="keyword">name</span>,v2.num,v2.company</span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">SELECT</span> r1.num ,r1.company ,r2.stop</span><br><span class="line">    <span class="keyword">FROM</span> route r1</span><br><span class="line">    <span class="keyword">JOIN</span> route r2 <span class="keyword">ON</span> r1.num=r2.num <span class="keyword">AND</span> r1.company=r2.company</span><br><span class="line">    <span class="keyword">JOIN</span> stops sa <span class="keyword">ON</span> r1.stop=sa.id</span><br><span class="line">    <span class="keyword">WHERE</span> sa.name=<span class="string">'Craiglockhart'</span> ) <span class="keyword">AS</span> v1</span><br><span class="line"><span class="keyword">JOIN</span></span><br><span class="line">(</span><br><span class="line">    <span class="keyword">SELECT</span> ra.num,ra.company ,ra.stop</span><br><span class="line">    <span class="keyword">FROM</span> route ra</span><br><span class="line">    <span class="keyword">JOIN</span> route rb <span class="keyword">ON</span> ra.num = rb.num <span class="keyword">AND</span> ra.company = rb.company</span><br><span class="line">    <span class="keyword">JOIN</span> stops sb <span class="keyword">ON</span> rb.stop = sb.id</span><br><span class="line">    <span class="keyword">WHERE</span> sb.name = <span class="string">'Lochend'</span>) <span class="keyword">AS</span> v2</span><br><span class="line"><span class="keyword">ON</span> v1.stop=v2.stop</span><br><span class="line"><span class="keyword">JOIN</span> stops <span class="keyword">ON</span> v1.stop=stops.id</span><br></pre></td></tr></table></figure>
<h3 id="Join-Multiple-tables-多表连接"><a href="#Join-Multiple-tables-多表连接" class="headerlink" title="Join Multiple tables 多表连接"></a>Join Multiple tables 多表连接</h3><p>比如我们要把 order_status ,orders,customers三张数据表联合</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line">SELECT</span><br><span class="line">    o.order_id,</span><br><span class="line">    o.order_date,</span><br><span class="line">    c.first_name,</span><br><span class="line">    c.last_name,</span><br><span class="line">    os.name AS status</span><br><span class="line">FROM orders o</span><br><span class="line">JOIN customers c</span><br><span class="line">    ON o.customer_id &#x3D; c.customer_id</span><br><span class="line">JOIN order_statuses as os</span><br><span class="line">    On o.status &#x3D; os.order_status_id</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/37.png" style="zoom: 67%;"></p>
<h4 id="小练习-8"><a href="#小练习-8" class="headerlink" title="小练习"></a>小练习</h4><p>请筛选出sql_invoicing 数据库中 clients，payments和payments_methods 三张数据表中的顾客，发票，付款方式等信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">USE sql_invoicing;</span><br><span class="line">SELECT</span><br><span class="line">    c.name,</span><br><span class="line">    c.phone,</span><br><span class="line">    p.invoice_id,</span><br><span class="line">    p.amount,</span><br><span class="line">    p.date ,</span><br><span class="line">    pm.name AS Methods</span><br><span class="line">FROM clients c</span><br><span class="line">JOIN payments p ON c.client_id &#x3D; p.client_id</span><br><span class="line">JOIN payment_methods pm on p.payment_method &#x3D; pm.payment_method_id</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/38.png" style="zoom: 67%;"></p>
<h3 id="Compound-Join-Conditions复合连接条件"><a href="#Compound-Join-Conditions复合连接条件" class="headerlink" title="Compound Join Conditions复合连接条件"></a>Compound Join Conditions复合连接条件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line">SELECT *</span><br><span class="line">FROM order_items oi</span><br><span class="line">JOIN order_item_notes oin</span><br><span class="line">    On oi.order_id &#x3D; oin.order_Id</span><br><span class="line">    AND oi.product_id &#x3D; oin.product_id</span><br></pre></td></tr></table></figure>
<h3 id="Implicit-Join-Syntax隐式连接语法（不建议）"><a href="#Implicit-Join-Syntax隐式连接语法（不建议）" class="headerlink" title="Implicit Join Syntax隐式连接语法（不建议）"></a>Implicit Join Syntax隐式连接语法（不建议）</h3><p>利用JOIN 语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">USE  store;</span><br><span class="line">SELECT *</span><br><span class="line">FROM orders o </span><br><span class="line">JOIN customers c on o.customer_id &#x3D; c.customer_id</span><br></pre></td></tr></table></figure>
<p>隐式联合语法，可以这样写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">USE  store;</span><br><span class="line">SELECT *</span><br><span class="line">FROM orders o,store.customers c</span><br><span class="line">WHERE o.customer_id &#x3D; c.customer_id</span><br></pre></td></tr></table></figure>
<p>因为如果不写where的话会交叉显示，所以不建议，还是写显示</p>
<h3 id="Outer-Joins外连接"><a href="#Outer-Joins外连接" class="headerlink" title="Outer Joins外连接"></a>Outer Joins外连接</h3><p>我们先来看看inner joins的效果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    c.customer_id,</span><br><span class="line">    c.first_name,</span><br><span class="line">    o.order_id</span><br><span class="line">FROM customers c</span><br><span class="line">JOIN orders o on c.customer_id &#x3D; o.customer_id</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/39.png" style="zoom: 67%;"></p>
<p>我们看到 customer_id 中没有1，3这种的信息，因为在orders表格中，customers_id并不是连续的，因为没有收到customer_id =1，3的客户的订单。所以我们要用Outer Joins</p>
<h4 id="LEFT-JOIN"><a href="#LEFT-JOIN" class="headerlink" title="LEFT JOIN"></a>LEFT JOIN</h4><p>所有在左半边的记录，这里是c.customer_id 不管有没有匹配到，都会返回</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    c.customer_id,</span><br><span class="line">    c.first_name,</span><br><span class="line">    o.order_id</span><br><span class="line">FROM customers c</span><br><span class="line">LEFT JOIN orders o on c.customer_id &#x3D; o.customer_id</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/40.png" style="zoom: 67%;"></p>
<h4 id="RIGHT-JOIN"><a href="#RIGHT-JOIN" class="headerlink" title="RIGHT JOIN"></a>RIGHT JOIN</h4><p>所有在右半边的记录，这里是o.customer_id 不管有没有匹配到，都会返回</p>
<p>在这种情况下RIGHT JOIN 和 JOIN的效果是一样的</p>
<p><strong>注意：</strong> LEFT OUTER JOIN 和 LEFT JOIN 是一样的，可选可不选</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    c.customer_id,</span><br><span class="line">    c.first_name,</span><br><span class="line">    o.order_id</span><br><span class="line">FROM customers c</span><br><span class="line">RIGHT JOIN orders o on c.customer_id &#x3D; o.customer_id</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/41.png" style="zoom: 80%;"></p>
<h4 id="小测试-1"><a href="#小测试-1" class="headerlink" title="小测试"></a>小测试</h4><p>我们要在sql_store 数据库中筛选出product_id 和 它对应的quantity，因为存在有些products还没有订购数量，所以我们也要把它囊括在内，这里我用了RIGHT JOIN,显示所走右边，也就是p.product_id 的所有内容，不管有没有匹配到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT p.product_id,name,quantity</span><br><span class="line">FROM order_items oi</span><br><span class="line">RIGHT JOIN  products p on oi.product_id &#x3D; p.product_id</span><br><span class="line">ORDER BY product_id</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/42.png" style="zoom: 80%;"></p>
<h3 id="Outer-Joins-Between-Multiple-Tables多表外连接"><a href="#Outer-Joins-Between-Multiple-Tables多表外连接" class="headerlink" title="Outer Joins Between Multiple Tables多表外连接"></a>Outer Joins Between Multiple Tables多表外连接</h3><p>我们先要分析几张表格 ：</p>
<p><strong>orders</strong></p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/43.png" style="zoom: 40%;"></p>
<p><strong>shippers:</strong></p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/44.png" style="zoom: 100%;"></p>
<p><strong>customers:</strong></p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/45.png" style="zoom: 60%;"></p>
<p>目标就是我们要找customer订购的订单信息和运送信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    c.customer_id,</span><br><span class="line">    c.first_name,</span><br><span class="line">    o.order_id,</span><br><span class="line">    s.name AS shipper</span><br><span class="line">FROM customers c</span><br><span class="line">LEFT JOIN orders o</span><br><span class="line">    ON c.customer_id &#x3D; o.customer_id</span><br><span class="line">LEFT JOIN  shippers s</span><br><span class="line">    ON o.shipper_id &#x3D; s.shipper_id</span><br><span class="line">ORDER BY c.customer_id</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/46.png" style="zoom: 60%;"></p>
<p><strong>注意，我们最好使用LEFT JOIN，否则太乱了</strong></p>
<h3 id="小练习-9"><a href="#小练习-9" class="headerlink" title="小练习"></a>小练习</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    o.order_date,</span><br><span class="line">    o.order_id,</span><br><span class="line">    c.first_name AS customer,</span><br><span class="line">    s.name AS shipper,</span><br><span class="line">    os.name AS status</span><br><span class="line">FROM orders o</span><br><span class="line">LEFT JOIN customers c</span><br><span class="line">    ON o.customer_id &#x3D; c.customer_id</span><br><span class="line">LEFT JOIN  shippers s</span><br><span class="line">    ON o.shipper_id &#x3D; s.shipper_id</span><br><span class="line">LEFT JOIN  order_statuses os</span><br><span class="line">    ON o.status &#x3D; os.order_status_id</span><br><span class="line">ORDER BY o.order_id</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/47.png" style="zoom: 80%;"></p>
<h3 id="Self-Outer-Joins-自外连接"><a href="#Self-Outer-Joins-自外连接" class="headerlink" title="Self Outer Joins 自外连接"></a>Self Outer Joins 自外连接</h3><p>我们之前在搜索manager的时候，有了员工的信息，但是没有manager的信息。为什么？因为我们的 Inner Join做的判断，会筛选掉Manager。这时候如果运用LEFT JOIN ，就会显示这个manager的信息了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">USE sql_hr;</span><br><span class="line">SELECT</span><br><span class="line">    e.employee_id,</span><br><span class="line">    e.first_name,</span><br><span class="line">    m.first_name AS manager</span><br><span class="line">FROM employees e</span><br><span class="line">LEFT JOIN  employees m</span><br><span class="line">    ON e.reports_to &#x3D; m.employee_id</span><br></pre></td></tr></table></figure>
<h3 id="USING-CLAUSE-（using子句）"><a href="#USING-CLAUSE-（using子句）" class="headerlink" title="USING CLAUSE （using子句）"></a>USING CLAUSE （using子句）</h3><p>原来我们可以这么查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line">SELECT</span><br><span class="line">    o.order_id,</span><br><span class="line">    c.first_name,</span><br><span class="line">    s.name AS shipper</span><br><span class="line">FROM orders o </span><br><span class="line">JOIN customers c </span><br><span class="line">    on o.customer_id &#x3D; c.customer_id</span><br><span class="line">LEFT JOIN shippers s </span><br><span class="line">    on o.shipper_id &#x3D; s.shipper_id</span><br></pre></td></tr></table></figure>
<p>现在，可以用using子句来减少代码量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line">SELECT</span><br><span class="line">    o.order_id,</span><br><span class="line">    c.first_name,</span><br><span class="line">    s.name AS shipper</span><br><span class="line">FROM orders o</span><br><span class="line">JOIN customers c</span><br><span class="line">    USING (customer_id)</span><br><span class="line">LEFT JOIN shippers s</span><br><span class="line">    USING (shipper_id)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/48.png" style="zoom: 80%;"></p>
<p>注意，USING 子句只能应用在不同表中的<strong>相同列名称</strong>中，如果这两列是不同名称的，那么我们将不能使用USING ，而只能使用ON语句</p>
<p>此外，USING 子句也可以多条件选择,避免了复杂的逻辑和代码量，比如，原来的代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM order_items oi </span><br><span class="line">JOIN order_item_notes oin </span><br><span class="line">    ON oi.order_id &#x3D; oin.order_Id </span><br><span class="line">    AND oi.product_id &#x3D; oin.product_id</span><br></pre></td></tr></table></figure>
<p>通过USING修改，可以变成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">USING(order_id,product_id)</span><br></pre></td></tr></table></figure>
<h4 id="小测验："><a href="#小测验：" class="headerlink" title="小测验："></a>小测验：</h4><p>produce something like this</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/49.png" style="zoom: 40%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">USE sql_invoicing</span><br><span class="line">SELECT</span><br><span class="line">    date,</span><br><span class="line">    c.name,</span><br><span class="line">    amount,</span><br><span class="line">    pm.name as name</span><br><span class="line">FROM payments p</span><br><span class="line">LEFT JOIN clients c</span><br><span class="line">USING (client_id)</span><br><span class="line">LEFT JOIN payment_methods pm on p.payment_method &#x3D; pm.payment_method_id</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/50.png" style="zoom: 80%;"></p>
<h3 id="NATURAL-JOIN"><a href="#NATURAL-JOIN" class="headerlink" title="NATURAL JOIN"></a>NATURAL JOIN</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line">SELECT</span><br><span class="line">    o.order_id,</span><br><span class="line">    c.first_name</span><br><span class="line">FROM orders o</span><br><span class="line">NATURAL JOIN customers c</span><br></pre></td></tr></table></figure>
<p>natrual join 会自动匹配不同table中相同的列名，但是会有危险。因为我们让数据库的搜索引擎猜想连接，我们无法控制。</p>
<h3 id="CROSS-JOIN交叉连接"><a href="#CROSS-JOIN交叉连接" class="headerlink" title="CROSS JOIN交叉连接"></a>CROSS JOIN交叉连接</h3><p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/51.png" style="zoom: 80%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line">SELECT</span><br><span class="line">    c.first_name AS  customer,</span><br><span class="line">    p.name AS product</span><br><span class="line">FROM customers c</span><br><span class="line">CROSS JOIN products p</span><br><span class="line">ORDER BY c.first_name</span><br></pre></td></tr></table></figure>
<p>我们看到这样就是对每一个名字都和每一个product名字做了一个组合。可以显示所有组合信息，即笛卡尔积</p>
<h4 id="CROSS-JOIN-的隐式写法"><a href="#CROSS-JOIN-的隐式写法" class="headerlink" title="CROSS JOIN 的隐式写法"></a>CROSS JOIN 的隐式写法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line">SELECT</span><br><span class="line">    c.first_name AS  customer,</span><br><span class="line">    p.name AS product</span><br><span class="line">FROM customers c,products p</span><br><span class="line">ORDER BY c.first_name</span><br></pre></td></tr></table></figure>
<h3 id="小练习-10"><a href="#小练习-10" class="headerlink" title="小练习"></a>小练习</h3><p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/52.png" style="zoom: 40%;"></p>
<p>隐式写法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line">SELECT</span><br><span class="line">    s.name AS shipper,</span><br><span class="line">    p.name AS product</span><br><span class="line">FROM shippers s,products p</span><br><span class="line">ORDER BY s.name</span><br></pre></td></tr></table></figure>
<p>显示写法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line">SELECT</span><br><span class="line">    s.name AS shipper,</span><br><span class="line">    p.name AS product</span><br><span class="line">FROM shippers s</span><br><span class="line">CROSS JOIN products p</span><br><span class="line">ORDER BY s.name</span><br></pre></td></tr></table></figure>
<h3 id="Union"><a href="#Union" class="headerlink" title="Union"></a>Union</h3><p>UNION运算符能把两个查询到的表格合并成一张表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line">SELECT</span><br><span class="line">    order_id,</span><br><span class="line">    order_date,</span><br><span class="line">    &#39;ACTIVE&#39; AS status</span><br><span class="line">FROM orders</span><br><span class="line">WHERE order_date &gt;&#x3D;&#39;2019-01-01&#39;</span><br><span class="line">UNION</span><br><span class="line">SELECT</span><br><span class="line">    order_id,</span><br><span class="line">    order_date,</span><br><span class="line">    &#39;Archived&#39; AS status</span><br><span class="line">FROM orders</span><br><span class="line">WHERE order_date &lt;&#39;2019-01-01&#39;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/53.png" style="zoom: 100%;"></p>
<p>又如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT first_name</span><br><span class="line">FROM customers</span><br><span class="line">UNION</span><br><span class="line">SELECT name</span><br><span class="line">FROM shippers</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/54.png" style="zoom: 100%;"></p>
<p><strong>注意</strong>：</p>
<ol>
<li><p>先查询到的先放在上面，后查询的放到下面</p>
</li>
<li><p>如果第一条sql语句返回的列数和第二条返回的列数不相等，这样会报错的！！</p>
</li>
</ol>
<h4 id="小练习-11"><a href="#小练习-11" class="headerlink" title="小练习"></a>小练习</h4><p>do something like this</p>
<p>其中要求如下</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>Points</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>&lt;2000</td>
<td>Bronze</td>
</tr>
<tr>
<td>2000&lt;=x&lt;3000</td>
<td>Silver</td>
</tr>
<tr>
<td>&gt;=3000</td>
<td>Gold</td>
</tr>
</tbody>
</table>
</div>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/55.png" style="zoom: 50%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    customer_id,</span><br><span class="line">    first_name,</span><br><span class="line">    points,</span><br><span class="line">    &#39;Bronze&#39; AS type</span><br><span class="line">FROM customers</span><br><span class="line">WHERE points &lt;2000</span><br><span class="line">UNION</span><br><span class="line">SELECT</span><br><span class="line">    customer_id,</span><br><span class="line">    first_name,</span><br><span class="line">    points,</span><br><span class="line">    &#39;silver&#39; AS type</span><br><span class="line">FROM customers</span><br><span class="line">WHERE points &gt;&#x3D;2000 and points&lt;3000</span><br><span class="line">UNION</span><br><span class="line">SELECT</span><br><span class="line">    customer_id,</span><br><span class="line">    first_name,</span><br><span class="line">    points,</span><br><span class="line">    &#39;Gold&#39; AS type</span><br><span class="line">FROM customers</span><br><span class="line">WHERE points &gt;3000</span><br><span class="line">ORDER BY customer_id</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/56.png" style="zoom: 100%;"></p>
<h2 id="数据表操作"><a href="#数据表操作" class="headerlink" title="数据表操作"></a>数据表操作</h2><h3 id="Column-Attributes-列属性"><a href="#Column-Attributes-列属性" class="headerlink" title="Column Attributes 列属性"></a>Column Attributes 列属性</h3><p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/57.png" style="zoom: 100%;"></p>
<p><strong>INT(11)</strong>代表只能存储数字</p>
<p><strong>VARCHAR(50)</strong> variable char，是动态的，是最多可以有50个字符，所以并不会浪费空间</p>
<p><strong>CHAR(50)</strong>，如果这样的话，多余的空间会用空白填满，造成空间浪费</p>
<p><strong>PK</strong>是主键的意思，选中的话会有黄钥匙图标</p>
<p><strong>NN</strong>是非空的意思，如果选中的话，这个单元格一定要有内容</p>
<p><strong>AI</strong>：auto increament 常常用在主键列中，会自动填充</p>
<p><strong>Default/Expression</strong> 默认值，如果你不填，mysql会自动帮你填充，默认内容</p>
<h3 id="Inseting-a-Single-Row-插入单行"><a href="#Inseting-a-Single-Row-插入单行" class="headerlink" title="Inseting a Single Row 插入单行"></a>Inseting a Single Row 插入单行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO customers</span><br><span class="line">VALUE (DEFAULT,</span><br><span class="line">       &#39;John&#39;,</span><br><span class="line">       &#39;Smith&#39;,</span><br><span class="line">       &#39;1990-01-01&#39;,</span><br><span class="line">       DEFAULT,</span><br><span class="line">      &#39;address&#39;,</span><br><span class="line">      &#39;city&#39;,</span><br><span class="line">      &#39;CA&#39;,</span><br><span class="line">      DEFAULT</span><br><span class="line">      )</span><br></pre></td></tr></table></figure>
<p>我们也可以指定特定列进行单行插入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO customers(first_name,</span><br><span class="line">                      last_name,</span><br><span class="line">                      birth_date,</span><br><span class="line">                      address,</span><br><span class="line">                      city,</span><br><span class="line">                      state)</span><br><span class="line">VALUE (</span><br><span class="line">       &#39;John&#39;,</span><br><span class="line">       &#39;Smith&#39;,</span><br><span class="line">       &#39;1990-01-01&#39;,</span><br><span class="line">      &#39;address&#39;,</span><br><span class="line">      &#39;city&#39;,</span><br><span class="line">      &#39;CA&#39;,</span><br><span class="line">      )</span><br></pre></td></tr></table></figure>
<p>这两种方法的效果是一样的，我们看到在表中的最后一列，已经显示了这条记录</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/58.png" style="zoom: 50%;"></p>
<h3 id="Inseting-multiple-Row-插入多行"><a href="#Inseting-multiple-Row-插入多行" class="headerlink" title="Inseting multiple Row 插入多行"></a>Inseting multiple Row 插入多行</h3><p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/59.png" style="zoom: 100%;"></p>
<h3 id="Inserting-Hierachical-Rows插入分层行"><a href="#Inserting-Hierachical-Rows插入分层行" class="headerlink" title="Inserting Hierachical Rows插入分层行"></a>Inserting Hierachical Rows插入分层行</h3><p>我们首先来看orders 和 order_items 这两张表格</p>
<p>orders</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/62.png" style="zoom: 100%;"></p>
<p>order_items</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/61.png" style="zoom: 100%;"></p>
<p>所以我们可以看到，一个订单号，可以订购很多产品，然后数量，价格，也可以不经相同，所以我们说orders是order_items的母表，了解了这个我们就可以做如下操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO orders(customer_id, order_date, status)</span><br><span class="line">VALUE (1,&#39;2019-01-02&#39;,1);</span><br><span class="line">INSERT INTO order_items</span><br><span class="line">VALUE</span><br><span class="line">-- LAST_INSERT_ID()获取的是插入到orders中的ID，也就是订单号</span><br><span class="line">    (LAST_INSERT_ID(),1,1,2.95),</span><br><span class="line">    (LAST_INSERT_ID(),2,1,3.95)</span><br></pre></td></tr></table></figure>
<h3 id="Creating-a-Copy-of-a-Table表赋值"><a href="#Creating-a-Copy-of-a-Table表赋值" class="headerlink" title="Creating a Copy of a Table表赋值"></a>Creating a Copy of a Table表赋值</h3><p>那么如何做一个数据表的备份呢？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE orders_archived AS SELECT * FROM orders</span><br></pre></td></tr></table></figure>
<p>单单这样写一下，是没有列属性中的主键之类的信息的。需要自己设置</p>
<p>那么如何复制部分表呢？</p>
<p>当orders_archived这张数据表存在时，（可用Truncate Table键删除所有行但保留字段值），可以用这样的方法插入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO orders_archived</span><br><span class="line">SELECT *</span><br><span class="line">FROM orders</span><br><span class="line">WHERE order_date &lt; &#39;2019-01-01&#39;</span><br></pre></td></tr></table></figure>
<h4 id="小练习-12"><a href="#小练习-12" class="headerlink" title="小练习"></a>小练习</h4><p>创建一份invoice部分记录的备份表，名字叫invoices archive 但是那张表里我们不想要客户的id列，我们要客户名列，另外，只选择有付款日期的发票进行操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE invoices_archive AS</span><br><span class="line">    SELECT</span><br><span class="line">        i.invoice_id,</span><br><span class="line">        i.number,</span><br><span class="line">        c.name AS client,</span><br><span class="line">        i.invoice_total,</span><br><span class="line">        i.payment_total,</span><br><span class="line">        i.invoice_date,</span><br><span class="line">        i.due_date,</span><br><span class="line">        i.payment_date</span><br><span class="line">    FROM invoices i</span><br><span class="line">    LEFT JOIN clients c on i.client_id &#x3D; c.client_id</span><br><span class="line">    WHERE payment_date IS NOT NULL</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/63.png" style="zoom: 60%;"></p>
<h3 id="Updating-a-Single-Row更新单行"><a href="#Updating-a-Single-Row更新单行" class="headerlink" title="Updating a Single Row更新单行"></a>Updating a Single Row更新单行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE invoices</span><br><span class="line">SET payment_total &#x3D; DEFAULT,payment_date &#x3D; NULL</span><br><span class="line">WHERE invoice_id &#x3D; 1</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">UPDATE invoices</span><br><span class="line">SET payment_total &#x3D; invoice_total*0.5,</span><br><span class="line">    payment_date &#x3D; due_date</span><br><span class="line">WHERE invoice_id &#x3D; 3</span><br></pre></td></tr></table></figure>
<h3 id="Updating-Multiple-rows更新多行"><a href="#Updating-Multiple-rows更新多行" class="headerlink" title="Updating  Multiple rows更新多行"></a>Updating  Multiple rows更新多行</h3><p>修改where 后面的语句即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">UPDATE invoices</span><br><span class="line">SET payment_total &#x3D; invoice_total*0.5,</span><br><span class="line">    payment_date &#x3D; due_date</span><br><span class="line">WHERE client_id &gt; 2</span><br><span class="line">-- WHERE client_id IN(3,4)</span><br></pre></td></tr></table></figure>
<h4 id="小测验"><a href="#小测验" class="headerlink" title="小测验"></a>小测验</h4><p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/64.png" style="zoom: 40%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE sql_store.customers</span><br><span class="line">SET points &#x3D; points+50</span><br><span class="line">WHERE birth_date &lt; &#39;1990-01-01&#39;</span><br></pre></td></tr></table></figure>
<h3 id="Using-Subqueries-in-Updates-在Updates中使用子查询"><a href="#Using-Subqueries-in-Updates-在Updates中使用子查询" class="headerlink" title="Using Subqueries in Updates 在Updates中使用子查询"></a>Using Subqueries in Updates 在Updates中使用子查询</h3><p>情景：比如我想修改 一个人的发票信息，但是呢我只有他的名字，而没有他的client_id,但是发票信息是根据client_id 存储的，所以我们要先根据他的名字找到他的client_id 然后再根据他的client_id 执行 UPDATE 操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">UPDATE sql_invoicing.invoices</span><br><span class="line">SET</span><br><span class="line">    payment_total &#x3D; invoice_total*0.5,</span><br><span class="line">    payment_date &#x3D; due_date</span><br><span class="line">WHERE client_id &#x3D;</span><br><span class="line">      (</span><br><span class="line">          SELECT client_id</span><br><span class="line">          FROM clients</span><br><span class="line">          WHERE name &#x3D; &#39;Myworks&#39;</span><br><span class="line">          )</span><br></pre></td></tr></table></figure>
<p>同时，这也可以进行多行更新 ,注意，这里要改两个地方，client_id后面因为多条信息，所以要用in</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">WHERE client_id IN</span><br><span class="line">      (</span><br><span class="line">          SELECT client_id</span><br><span class="line">          FROM clients</span><br><span class="line">          WHERE state IN (&#39;CA&#39;,&#39;NY&#39;)</span><br><span class="line">          )</span><br></pre></td></tr></table></figure>
<h4 id="小练习-13"><a href="#小练习-13" class="headerlink" title="小练习"></a>小练习</h4><p>在orders 数据表中，把金牌客户（clients中points分数大于3000的）下的订单备注改为 GOLD Customer</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">UPDATE orders</span><br><span class="line">SET comments &#x3D; &#39;GOLD Customers&#39;</span><br><span class="line">WHERE customer_id IN (</span><br><span class="line">SELECT</span><br><span class="line">    DISTINCT c.customer_id</span><br><span class="line">FROM customers c</span><br><span class="line">WHERE c.points&gt;3000)</span><br></pre></td></tr></table></figure>
<h3 id="Deleting-Rows删除行"><a href="#Deleting-Rows删除行" class="headerlink" title="Deleting Rows删除行"></a>Deleting Rows删除行</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM sql_invoicing.invoices</span><br><span class="line">WHERE client_id &#x3D; (</span><br><span class="line">SELECT *</span><br><span class="line">FROM clients</span><br><span class="line">WHERE name &#x3D; &#39;Myworks&#39;)</span><br></pre></td></tr></table></figure>
<h2 id="汇总数据"><a href="#汇总数据" class="headerlink" title="汇总数据"></a>汇总数据</h2><h3 id="Aggregate-function聚合函数"><a href="#Aggregate-function聚合函数" class="headerlink" title="Aggregate function聚合函数"></a>Aggregate function聚合函数</h3><p>我们需要把相同属性的数据聚合起来，这时候就要运用聚合函数了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">USE sql_invoicing;</span><br><span class="line">SELECT</span><br><span class="line">    MAX(invoice_total) AS highest,</span><br><span class="line">    MIN(invoice_total) AS lowest,</span><br><span class="line">    AVG(invoice_total) AS average,</span><br><span class="line">    MAX(payment_date) AS latest,</span><br><span class="line">    MIN(payment_date) AS earliest,</span><br><span class="line">    COUNT(invoice_total) AS number_of_invoices,</span><br><span class="line">    COUNT(payment_date) AS count_of_payments,#计算非空的数值个数</span><br><span class="line">    COUNT(*) AS total_records</span><br><span class="line">FROM invoices</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/66.png" style="zoom: 60%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">USE sql_invoicing;</span><br><span class="line">SELECT</span><br><span class="line">    MAX(invoice_total) AS highest,</span><br><span class="line">    MIN(invoice_total) AS lowest,</span><br><span class="line">    AVG(invoice_total) AS average,</span><br><span class="line">    SUM(invoice_total*1.1) AS total,</span><br><span class="line"> 	COUNT(DISTINCT client_id) AS total_records</span><br><span class="line"> 	# 存在客户下了很多单，我们只需要多少客户，所以用去重的属性</span><br><span class="line">FROM invoices</span><br><span class="line">WHERE invoice_date&gt;&#x3D;&#39;2019-07-01&#39;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/67.png" style="zoom: 100%;"></p>
<h3 id="小练习-14"><a href="#小练习-14" class="headerlink" title="小练习"></a>小练习</h3><p>做一张表格，计算上半年，下半年，全年的销售额，付款额，和差值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">       &#39;First half of 2019&#39; AS date_range,</span><br><span class="line">       SUM(invoice_total) AS total_sales,</span><br><span class="line">       SUM(payment_total) AS total_payments,</span><br><span class="line">       SUM(invoice_total-payment_total) AS What_we_expect</span><br><span class="line">FROM invoices</span><br><span class="line">WHERE invoice_date</span><br><span class="line">    BETWEEN &#39;2019-01-01&#39; AND &#39;2019-6-30&#39;</span><br><span class="line">UNION</span><br><span class="line">SELECT</span><br><span class="line">       &#39;Second half of 2019&#39; AS date_range,</span><br><span class="line">       SUM(invoice_total) AS total_sales,</span><br><span class="line">       SUM(payment_total) AS total_payments,</span><br><span class="line">       SUM(invoice_total-payment_total) AS What_we_expect</span><br><span class="line">FROM invoices</span><br><span class="line">WHERE invoice_date</span><br><span class="line">BETWEEN &#39;2019-6-30&#39; AND &#39;2019-12-31&#39;</span><br><span class="line">UNION</span><br><span class="line">SELECT</span><br><span class="line">	   &#39;total of 2019&#39; AS date_range,</span><br><span class="line">       SUM(invoice_total) AS total_sales,</span><br><span class="line">       SUM(payment_total) AS total_payments,</span><br><span class="line">       SUM(invoice_total-payment_total) AS What_we_expect</span><br><span class="line">FROM invoices</span><br><span class="line">WHERE invoice_date</span><br><span class="line">BETWEEN &#39;2019-01-01&#39; AND &#39;2019-12-31&#39;</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/68.png" style="zoom: 80%;"></p>
<h3 id="The-GROUO-BY-clause"><a href="#The-GROUO-BY-clause" class="headerlink" title="The GROUO BY clause"></a>The GROUO BY clause</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    client_id,</span><br><span class="line">    SUM(invoice_total)AS total_sales</span><br><span class="line">FROM invoices</span><br><span class="line">WHERE invoice_date&gt;&#x3D;&#39;2019-07-01&#39;</span><br><span class="line">GROUP BY client_id	#在这里，我们要先汇总再排序，所以GROUP BY 一定要在 ORDER BY前面</span><br><span class="line">ORDER BY total_sales DESC</span><br></pre></td></tr></table></figure>
<p>注意了，GROUP BY</p>
<h3 id="小练习-15"><a href="#小练习-15" class="headerlink" title="小练习"></a>小练习</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    date,</span><br><span class="line">    pm.name AS payment_methods,</span><br><span class="line">    SUM(amount)AS total_payments</span><br><span class="line">FROM payments</span><br><span class="line">LEFT JOIN payment_methods pm</span><br><span class="line">    on payments.payment_method &#x3D; pm.payment_method_id</span><br><span class="line"></span><br><span class="line">GROUP BY date,payment_method</span><br><span class="line">ORDER BY date</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/70.png" style="zoom: 80%;"></p>
<p>上图是正确结果</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/69.png" style="zoom: 80%;"></p>
<p>如果我们仅仅GROUP BY date,那么两个就如上图所示，两个2019-01-08的数值合并在了一起</p>
<h3 id="The-HAVING-clause"><a href="#The-HAVING-clause" class="headerlink" title="The HAVING clause"></a>The HAVING clause</h3><h4 id="问题导入"><a href="#问题导入" class="headerlink" title="问题导入"></a>问题导入</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT </span><br><span class="line">	client_id,</span><br><span class="line">	SUM(invoice_total) AS total_sales</span><br><span class="line">FROM invoices</span><br><span class="line">GROUP BY client_id</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/71.png" style="zoom: 80%;"></p>
<p>那么，我们如果只想筛选总销售量大于500的客户，那么应该如何选择呢？</p>
<p>因为一个客户可以买很多单，所以用了SUM，但是我们在这里无法使用WHERE语句，因为WHERE必须放在GROUP BY之前，所以在WHERE的时候，数据汇总还没有出来，这时候我们就需要用到HAVING 语句了。</p>
<h4 id="the-differences-between-HAVING-AND-WHERE"><a href="#the-differences-between-HAVING-AND-WHERE" class="headerlink" title="the differences between HAVING AND WHERE"></a>the differences between HAVING AND WHERE</h4><ol>
<li><p><strong>HAVING 语句用在GROUP BY的后面，而WHERE 必须用在 GROUP BY 的前面</strong></p>
</li>
<li><p>此外，HAVING 子句后选择的列，一定要是SELECT中的列，但是WHERE语句可以选择表中的任何一列</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">   client_id,</span><br><span class="line">   SUM(invoice_total) AS total_sales</span><br><span class="line">FROM invoices</span><br><span class="line">GROUP BY client_id</span><br><span class="line">HAVING total_sales&gt;500</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/72.png" style="zoom: 80%;"></p>
<h3 id="小练习-16"><a href="#小练习-16" class="headerlink" title="小练习"></a>小练习</h3><p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/73.png" style="zoom: 50%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    c.first_name,c.last_name,</span><br><span class="line">    c.state,</span><br><span class="line">    SUM(oi.quantity*unit_price) AS total_sales</span><br><span class="line">FROM customers c</span><br><span class="line">JOIN orders o on c.customer_id &#x3D; o.customer_id</span><br><span class="line">JOIN order_items oi on o.order_id &#x3D; oi.order_id</span><br><span class="line">WHERE c.state &#x3D; &#39;VA&#39;</span><br><span class="line">GROUP BY c.customer_id,</span><br><span class="line">         c.first_name,</span><br><span class="line">         c.last_name</span><br><span class="line">HAVING total_sales&gt;100</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/74.png" style="zoom: 100%;"></p>
<h3 id="The-ROLLUP-Operator"><a href="#The-ROLLUP-Operator" class="headerlink" title="The ROLLUP Operator"></a>The ROLLUP Operator</h3><p>RollUP就是对Group BY 汇聚起来的数据进行求和操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">USE sql_invoicing;</span><br><span class="line">SELECT</span><br><span class="line">    state,</span><br><span class="line">    city,</span><br><span class="line">    SUM(invoice_total) AS total_sales</span><br><span class="line">FROM invoices i</span><br><span class="line">JOIN clients c USING (client_id)</span><br><span class="line">GROUP BY client_id ,city WITH ROLLUP</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/75.png" style="zoom: 100%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    pm.name AS payment_method,</span><br><span class="line">    SUM(amount) AS total</span><br><span class="line">FROM payments p</span><br><span class="line">JOIN payment_methods pm</span><br><span class="line">    ON p.payment_method &#x3D; pm.payment_method_id</span><br><span class="line">GROUP BY pm.name WITH ROLLUP</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/76.png" style="zoom: 100%;"></p>
<h2 id="编写复杂查询"><a href="#编写复杂查询" class="headerlink" title="编写复杂查询"></a>编写复杂查询</h2><h3 id="Subqueries-子查询"><a href="#Subqueries-子查询" class="headerlink" title="Subqueries   子查询"></a>Subqueries   子查询</h3><p>— Find products that are more expensive than Lettuce(id=3)</p>
<p>那么其实我们就是在找比莴苣要贵的产品的信息</p>
<p>所以我们先要搜寻莴苣的信息，作为子查询。然后再拿道WHERE子句中，供母查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM products</span><br><span class="line">WHERE unit_price &gt;(</span><br><span class="line">        SELECT unit_price</span><br><span class="line">        FROM products</span><br><span class="line">        WHERE product_id&#x3D;3</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/77.png" style="zoom: 80%;"></p>
<h4 id="小练习-17"><a href="#小练习-17" class="headerlink" title="小练习"></a>小练习</h4><p>— In sql_hr database: Find employees whose earn more than average</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">USE sql_hr;</span><br><span class="line">SELECT</span><br><span class="line">       *</span><br><span class="line">FROM employees</span><br><span class="line">WHERE salary&gt;(</span><br><span class="line">        SELECT</span><br><span class="line">            AVG(salary)</span><br><span class="line">        FROM employees</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/78.png" style="zoom: 80%;"></p>
<h3 id="IN-Operator-IN操作符"><a href="#IN-Operator-IN操作符" class="headerlink" title="IN Operator IN操作符"></a>IN Operator IN操作符</h3><p>— Find the products that have never been ordered</p>
<p>我们知道再order items 表格里 有每个产品的订购次数。所以我们先要找到这张表里的产品，然后再返回没有在这张表中的产品，就是没有被订购过的产品</p>
<p>也就是说，刚才的子查询是返回一个值，但是现在是返回一个列表，所以用 IN 操作符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line"></span><br><span class="line">SELECT *</span><br><span class="line">FROM products</span><br><span class="line">WHERE product_id NOT IN (</span><br><span class="line">    SELECT DISTINCT product_id</span><br><span class="line">    FROM order_items</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/79.png" style="zoom: 80%;"></p>
<h4 id="小练习-18"><a href="#小练习-18" class="headerlink" title="小练习"></a>小练习</h4><p>— Find clients without invoices</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">USE invoicing;</span><br><span class="line">SELECT</span><br><span class="line">    *</span><br><span class="line">FROM clients</span><br><span class="line">WHERE client_id NOT IN (</span><br><span class="line">        SELECT</span><br><span class="line">            DISTINCT client_id</span><br><span class="line">        FROM invoices</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/80.png" style="zoom: 80%;"></p>
<h3 id="Suqueries-VS-Joins-子查询和连接"><a href="#Suqueries-VS-Joins-子查询和连接" class="headerlink" title="Suqueries VS Joins 子查询和连接"></a>Suqueries VS Joins 子查询和连接</h3><p>我们经常用连接来写一个子查询。比如我们对上衣个小练习用连接重写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">USE invoicing;</span><br><span class="line">SELECT</span><br><span class="line">    *</span><br><span class="line">FROM clients</span><br><span class="line"># 这里要用左连接，为什么呢，因为左连接能显示所有的客户信息</span><br><span class="line"># 只有这样我们才能筛选invoice_id is NULL</span><br><span class="line">LEFT JOIN invoices USING (client id)</span><br><span class="line">WHERE invoice_id is NULL</span><br></pre></td></tr></table></figure>
<p>子查询和连接都能达到我们的目标，但是子查询更加直观。</p>
<p>有时候子查询会过于繁杂，那么我们就要用连接</p>
<h3 id="小练习-19"><a href="#小练习-19" class="headerlink" title="小练习"></a>小练习</h3><p>— Find customers who have ordered lettuce(id=3)</p>
<p>— Select customer_id ,first_name,last_name</p>
<p>运用子查询，我们这么写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line">SELECT</span><br><span class="line">    DISTINCT c.customer_id,c.first_name,c.last_name</span><br><span class="line">FROM customers c</span><br><span class="line">WHERE customer_id IN (</span><br><span class="line">        SELECT o.customer_id</span><br><span class="line">        FROM order_items oi</span><br><span class="line">        JOIN orders o on oi.order_id &#x3D; o.order_id</span><br><span class="line">        WHERE product_id &#x3D; 3</span><br><span class="line">    )</span><br><span class="line">ORDER BY c.customer_id</span><br></pre></td></tr></table></figure>
<p>运用连接，我们这样写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line">SELECT</span><br><span class="line">    DISTINCT c.customer_id,c.first_name,c.last_name</span><br><span class="line">FROM customers c</span><br><span class="line">JOIN orders o on c.customer_id &#x3D; o.customer_id</span><br><span class="line">JOIN order_items oi on o.order_id &#x3D; oi.order_id</span><br><span class="line">WHERE product_id&#x3D;3</span><br><span class="line"></span><br><span class="line">ORDER BY customer_id</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/81.png" style="zoom: 80%;"></p>
<h3 id="The-ALL-Keyword"><a href="#The-ALL-Keyword" class="headerlink" title="The ALL Keyword"></a>The ALL Keyword</h3><p>— Select invoices larger than all invoices of client 3</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/82.png" style="zoom: 80%;"></p>
<p>也就是选择大于167.29的所有发票</p>
<p>原来，我们可以用<strong>MAX+子查询</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">USE sql_invoicing;</span><br><span class="line">SELECT *</span><br><span class="line">FROM invoices</span><br><span class="line">    WHERE invoice_total &gt;(</span><br><span class="line">        SELECT MAX(invoice_total)</span><br><span class="line">        FROM invoices</span><br><span class="line">        WHERE client_id&#x3D;3)</span><br></pre></td></tr></table></figure>
<p>现在我们用<strong>ALL关键字+子查询</strong>也可以达到</p>
<p>ALL关键字的原理就是把 invoice_total 把子查询中所有的返回值进行比较，然后全部符合的就为目标（听起来效率不是很高的样子）</p>
<p>怎么用ALL和MAX 看个人喜好</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">USE sql_invoicing;</span><br><span class="line">SELECT *</span><br><span class="line">FROM invoices</span><br><span class="line">    WHERE invoice_total &gt;ALL (</span><br><span class="line">        SELECT invoice_total</span><br><span class="line">        FROM invoices</span><br><span class="line">        WHERE client_id&#x3D;3</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/83.png" style="zoom: 70%;"></p>
<h3 id="The-ANY-Keyword"><a href="#The-ANY-Keyword" class="headerlink" title="The ANY Keyword"></a>The ANY Keyword</h3><p>还是拿发票来举例子，ANY 就是得到发票总额高于这段子查询返回的任意值的信息</p>
<p>— Select clients with at least two invoices</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM clients</span><br><span class="line">WHERE client_id &#x3D; ANY(</span><br><span class="line">    SELECT client_id</span><br><span class="line">    FROM invoices</span><br><span class="line">    GROUP BY client_id</span><br><span class="line">    HAVING COUNT(*) &gt;&#x3D;2</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>所以 =ANY 就等于 IN</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/84.png" style="zoom: 70%;"></p>
<h3 id="Correlated-Subqueries-相关查询"><a href="#Correlated-Subqueries-相关查询" class="headerlink" title="Correlated Subqueries  相关查询"></a>Correlated Subqueries  相关查询</h3><p>— Select employees whose salary is above the average in their office</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">USE sql_hr</span><br><span class="line">SELECT *</span><br><span class="line">FROM employees e</span><br><span class="line">WHERE salary&gt;(</span><br><span class="line">        SELECT AVG(salary)</span><br><span class="line">        FROM employees</span><br><span class="line">        WHERE office_id &#x3D; e.office_id</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p>这句话是说：对每一个员工进行子查询，子查询里面计算他所在部门的所有人的薪水的平均值。然后把这个员工的薪水和返回的平均值比较，如果大于平均值的就返回</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/85.png" style="zoom: 70%;"></p>
<h4 id="小练习-20"><a href="#小练习-20" class="headerlink" title="小练习"></a>小练习</h4><p>— Get invoices that are larger than the client’s average invoice amount</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">USE invoicing;</span><br><span class="line">SELECT *</span><br><span class="line">FROM invoices i</span><br><span class="line">WHERE invoice_total &gt;(</span><br><span class="line">    SELECT AVG(invoice_total)</span><br><span class="line">    FROM invoices</span><br><span class="line">    WHERE client_id &#x3D;i.client_id</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/86.png" style="zoom: 70%;"></p>
<h3 id="The-EXISTS-Operator"><a href="#The-EXISTS-Operator" class="headerlink" title="The EXISTS Operator"></a>The EXISTS Operator</h3><p>— Select clients that have an invoice</p>
<p>使用IN 操作符我们可以这么写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">USE invoicing;</span><br><span class="line">SELECT *</span><br><span class="line">FROM clients</span><br><span class="line">WHERE client_id IN (</span><br><span class="line">    SELECT DISTINCT client_id</span><br><span class="line">    FROM invoices</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>但是我们现在可以用EXISTS操作符完成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">USE invoicing;</span><br><span class="line">SELECT *</span><br><span class="line">FROM clients c</span><br><span class="line">WHERE EXISTS(</span><br><span class="line">    SELECT client_id</span><br><span class="line">    FROM invoices</span><br><span class="line">    WHERE client_id &#x3D; c.client_id</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>使用 IN 和 EXISTS的区别：</p>
<p>使用IN的时候，返回的个是一个可迭代的id列表，也就是说(1,2,3,4….)，然后再用clients_id 在这个列表中去取值，再查询返回</p>
<p>使用EXISTS的时候，再子查询中，判断子查询的client_id是否和母查询中的client_id 相匹配。如果匹配成功，直接进入返回信息当中</p>
<p>当数据量很大的时候，EXISTS的效率比IN要高</p>
<h4 id="小练习-21"><a href="#小练习-21" class="headerlink" title="小练习"></a>小练习</h4><p>— Find the products that have never been ordered</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line">SELECT *</span><br><span class="line">FROM products p</span><br><span class="line">WHERE NOT EXISTS(</span><br><span class="line">        SELECT product_id</span><br><span class="line">        FROM order_items</span><br><span class="line">        WHERE product_id &#x3D; p.product_id</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/87.png" style="zoom: 70%;"></p>
<h3 id="Subqueries-in-SELECT-clause"><a href="#Subqueries-in-SELECT-clause" class="headerlink" title="Subqueries in SELECT  clause"></a>Subqueries in SELECT  clause</h3><p>子查询不仅仅局限于 WHERE子句当中，还存在于SELECT子句和接下来要讲的FROM子句当中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    invoice_id,</span><br><span class="line">    invoice_total,</span><br><span class="line">    (SELECT AVG(invoice_total) FROM invoices) AS invoice_average,</span><br><span class="line">    -- 不能不写SELECT，因为语句不能直接用别名</span><br><span class="line">    (SELECT invoice_total - invoice_average) AS difference</span><br><span class="line">FROM invoices</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/88.png" style="zoom: 70%;"></p>
<h4 id="小练习-22"><a href="#小练习-22" class="headerlink" title="小练习"></a>小练习</h4><p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/89.png" style="zoom: 70%;"></p>
<p>制作出这张表格</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">USE sql_invoicing;</span><br><span class="line">SELECT</span><br><span class="line">       c.client_id,</span><br><span class="line">       name,</span><br><span class="line">       (SELECT SUM(invoice_total)FROM invoices WHERE client_id &#x3D; c.client_id) AS total_sales,</span><br><span class="line">       (SELECT AVG(invoice_total) FROM invoices) AS average,</span><br><span class="line">       (SELECT total_sales - average) AS difference</span><br><span class="line">FROM clients c</span><br><span class="line">LEFT JOIN invoices i on c.client_id &#x3D; i.client_id</span><br><span class="line">GROUP BY c.client_id</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/90.png" style="zoom: 100%;"></p>
<h3 id="Subqueries-in-FROM-clause"><a href="#Subqueries-in-FROM-clause" class="headerlink" title="Subqueries in FROM clause"></a>Subqueries in FROM clause</h3><p>也就是说，可以把我们选择的表格作为一张新的表格，然后在这张表格的基础上进行操作，但是这样或让子查询变得复杂，所以运用视图的方法会更加简化代码。关于视图，在接下来会讲到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM (</span><br><span class="line">         SELECT c.client_id,</span><br><span class="line">                name,</span><br><span class="line">                (SELECT SUM(invoice_total) FROM invoices WHERE client_id &#x3D; c.client_id) AS total_sales,</span><br><span class="line">                (SELECT AVG(invoice_total) FROM invoices)                               AS average,</span><br><span class="line">                (SELECT total_sales - average)                                          AS difference</span><br><span class="line">         FROM clients c</span><br><span class="line">                  LEFT JOIN invoices i on c.client_id &#x3D; i.client_id</span><br><span class="line">         GROUP BY c.client_id</span><br><span class="line">     ) as sales_summary</span><br><span class="line">WHERE total_sales IS NOT NULL</span><br></pre></td></tr></table></figure>
<h4 id="SQLZOO-练习"><a href="#SQLZOO-练习" class="headerlink" title="SQLZOO 练习"></a>SQLZOO 练习</h4><p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/108.png" style="zoom: 80%;"></p>
<p>有表如上图所示</p>
<p><strong>List each continent and the name of the country that comes first alphabetically.</strong></p>
<p>让我们筛选出每个大洲中字母表的第一顺位国家，那么肯定需要用 ORDER BY name , 只需要一个，那么需要 LIMIT 1</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> continent,<span class="keyword">name</span> </span><br><span class="line"><span class="keyword">FROM</span> world x</span><br><span class="line"><span class="keyword">WHERE</span> x.name = (<span class="keyword">SELECT</span> <span class="keyword">name</span> </span><br><span class="line">                <span class="keyword">FROM</span> world y </span><br><span class="line">               <span class="keyword">WHERE</span> y.continent = x.continent</span><br><span class="line">               <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">name</span> </span><br><span class="line">                <span class="keyword">LIMIT</span> <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p><strong>Find the continents where all countries have a population &lt;= 25000000. Then find the names of the countries associated with these continents. Show name ,continent and population </strong></p>
<p>这题要我们筛选出一个州的所有国家人数都小于25000000的国家信息，因此我们可以使用 ALL关键词：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">name</span>, continent,population </span><br><span class="line"><span class="keyword">from</span> world <span class="keyword">as</span> x </span><br><span class="line"><span class="keyword">where</span> <span class="number">25000000</span> &gt;= <span class="keyword">all</span>(<span class="keyword">select</span> population </span><br><span class="line">                      <span class="keyword">from</span> world <span class="keyword">as</span> y </span><br><span class="line">                      <span class="keyword">where</span> x.continent=y.continent);</span><br></pre></td></tr></table></figure>
<p><strong>Some countries have populations more than three times that of any of their neighbours (in the same continent). Give the countries and continents.</strong></p>
<p>这题要我们筛选出每个州内的一个国家，它的人口数量是这个州其他任何国家的人口数量的三倍。其实这也需要用到 ALL ，只是在写子查询的时候需注意，要添加 <code>x.name != y.name</code>  因为自己人数不能比自己的三倍还多</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span> ,continent </span><br><span class="line"><span class="keyword">FROM</span> world x</span><br><span class="line"><span class="keyword">WHERE</span> population &gt;= <span class="keyword">ALL</span>(</span><br><span class="line">  			<span class="keyword">SELECT</span> population*<span class="number">3</span> </span><br><span class="line">  			<span class="keyword">FROM</span> world y </span><br><span class="line">  			<span class="keyword">WHERE</span> y.continent = x.continent </span><br><span class="line">  			<span class="keyword">AND</span> x.name != y.name)</span><br></pre></td></tr></table></figure>
<h2 id="Mysql中的基本函数"><a href="#Mysql中的基本函数" class="headerlink" title="Mysql中的基本函数"></a>Mysql中的基本函数</h2><h3 id="Numeric-Function"><a href="#Numeric-Function" class="headerlink" title="Numeric Function"></a>Numeric Function</h3><p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/91.png" style="zoom: 100%;"></p>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/mathematical-functions.html" target="_blank" rel="noopener">详见官方文档：</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT ROUND(5.746,2);		# 四舍五入，后面是保留几位</span><br><span class="line">SELECT round(56789 ,-3)		# 四舍五入，复数代表前面保留几位，这里取到千位，为57000</span><br><span class="line">SELECT TRUNCATE(5.8964,2);	# 直接保留几位，不四舍五入</span><br><span class="line">SELECT CEILING(5.2);		# 取大于该数的最小整数</span><br><span class="line">SELECT FLOOR(5.2);			# 取小于该数的最大整数</span><br><span class="line">SELECT ABS(-6.4);			# 取绝对值</span><br><span class="line">SELECT RAND();				# 取随机值</span><br></pre></td></tr></table></figure>
<h3 id="String-Functions"><a href="#String-Functions" class="headerlink" title="String Functions"></a>String Functions</h3><p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/92.png" style="zoom: 80%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">SELECT UPPER(&#39;sky&#39;);					# 大写</span><br><span class="line">SELECT LOWER(&#39;sky&#39;);					# 小写</span><br><span class="line">SELECT LTRIM(&#39;   Sky&#39;);					# 去除左半边的空格</span><br><span class="line">SELECT RTRIM(&#39;Sky   &#39;);					# 去除右半边的空格</span><br><span class="line">SELECT TRIM(&#39;  Sky   &#39;);				# 去除所有空格</span><br><span class="line">SELECT LEFT(&#39;Kindergarten&#39;,4);			# 选择左边从开始的4个字符</span><br><span class="line">SELECT RIGHT(&#39;Kindergarten&#39;, 6);		# 选择从右边开始的6个字符</span><br><span class="line">SELECT SUBSTRING(&#39;Kindergarten&#39;, 3,5);	# 截取从第三个位置开始的长度为5的字串：nderg</span><br><span class="line">SELECT SUBSTRING(&#39;Kindergarten&#39;, 3 );	# 截取从3开始到结束的所有字符ndergarten</span><br><span class="line">SELECT LOCATE(&#39;n&#39;,&#39;Kindergarten&#39;);		# 返回第一个n所在的位置</span><br><span class="line">SELECT REPLACE(&#39;Kindergarten&#39;,&#39;en&#39;,&#39;dn&#39;);#找到en,把en替换成dn</span><br><span class="line">SELECT CONCAT(&#39;first&#39;,&#39;last&#39;);			# 合并：firstlast</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line">SELECT CONCAT(first_name,&#39;&#39;,last_name) AS full_name</span><br><span class="line">FROM customers</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/93.png" style="zoom: 80%;"></p>
<h4 id="小练习-23"><a href="#小练习-23" class="headerlink" title="小练习"></a>小练习</h4><p>有表如下：</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/101.png" style="zoom: 80%;"></p>
<ol>
<li><strong>Find the capital and the name where the capital includes the name of the country.</strong></li>
</ol>
<p>这一题需要用到 LIKE 以及 CONCAT 这两个关键字。因为我们不能直接 <code>LIKE &#39;%name%&#39;</code> 这样是查名字中有无name的信息了，因此我们要这么写：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span> , capital</span><br><span class="line"><span class="keyword">FROM</span> world</span><br><span class="line"><span class="keyword">WHERE</span> capital <span class="keyword">LIKE</span> <span class="keyword">CONCAT</span>(<span class="string">'%'</span>,<span class="keyword">name</span>,<span class="string">'%'</span>)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>用 CONCAT 将 name 和 % 连接起来</p>
</blockquote>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/104.png" style="zoom: 50%;"></p>
<ol>
<li><p>Find the capital and the name where the capital is an extension of name of the country.</p>
<p>You <em>should</em> include <strong>Mexico City</strong> as it is longer than <strong>Mexico</strong>. You <em>should not</em> include <strong>Luxembourg</strong> as the capital is the same as the country</p>
</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span> , capital</span><br><span class="line"><span class="keyword">FROM</span> world</span><br><span class="line"><span class="keyword">WHERE</span> capital <span class="keyword">LIKE</span> <span class="keyword">CONCAT</span>(<span class="string">'%'</span>,<span class="keyword">name</span>,<span class="string">'%'</span>) </span><br><span class="line"><span class="keyword">AND</span> capital != <span class="keyword">name</span></span><br></pre></td></tr></table></figure>
<p>这题要我们进一步找寻首都名字包含国家名且长于国家名的，因此只要加一个 <code>AND</code> 条件就行了</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/103.png" style="zoom: 50%;"></p>
<ol>
<li><p>For <strong>Monaco-Ville</strong> the name is <strong>Monaco</strong> and the extension is <strong>-Ville</strong>.</p>
<p>Show the name and the extension where the capital is an extension of name of the country.</p>
<p>You can use the SQL function <a href="https://sqlzoo.net/wiki/REPLACE" target="_blank" rel="noopener">REPLACE</a>.</p>
</li>
</ol>
<p>这一题要我们把后缀也筛选出来，于是我们可以使用REPLACE 函数，将capital中的name部分删除后生成一个新列 extension, 然后再进行刚才的筛选。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT name , capital ,REPLACE(capital,name,&#39;&#39;) AS extension</span><br><span class="line">FROM world</span><br><span class="line">WHERE capital LIKE CONCAT(name,&#39;%&#39;) </span><br><span class="line">AND capital !&#x3D; name</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/102.png" style="zoom: 50%;"></p>
<h3 id="Date-Functions-in-Mysql"><a href="#Date-Functions-in-Mysql" class="headerlink" title="Date Functions in Mysql"></a>Date Functions in Mysql</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT NOW(),CURDATE(),CURTIME();</span><br><span class="line">SELECT YEAR(NOW());</span><br><span class="line">SELECT SECOND(NOW());</span><br><span class="line">SELECT DAYNAME(NOW());</span><br><span class="line">SELECT MONTHNAME(NOW());</span><br><span class="line">SELECT EXTRACT(DAY FROM NOW());</span><br><span class="line">SELECT EXTRACT(YEAR FROM NOW());</span><br></pre></td></tr></table></figure>
<h4 id="小练习-24"><a href="#小练习-24" class="headerlink" title="小练习"></a>小练习</h4><p>改写下列查询语句，选择2019年开始的所订单</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM orders</span><br><span class="line">WHERE  order_date&gt;&#x3D;&#39;2019-01-01&#39;</span><br></pre></td></tr></table></figure>
<p>因为今年是2020，所以我减去了1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line">SELECT *</span><br><span class="line">FROM orders</span><br><span class="line">WHERE YEAR(order_date) &gt;&#x3D; YEAR(NOW())-1</span><br></pre></td></tr></table></figure>
<h3 id="Formatting-Dates-and-Times"><a href="#Formatting-Dates-and-Times" class="headerlink" title="Formatting Dates and Times"></a>Formatting Dates and Times</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT DATE_FORMAT(NOW(),&#39;%y&#39;);		# 20</span><br><span class="line">SELECT DATE_FORMAT(NOW(),&#39;%Y&#39;);		# 2020</span><br><span class="line">SELECT DATE_FORMAT(NOW(),&#39;%m&#39;);		# 5</span><br><span class="line">SELECT DATE_FORMAT(NOW(),&#39;%M&#39;);		# May</span><br><span class="line">SELECT DATE_FORMAT(NOW(),&#39;%d&#39;);		# 25</span><br><span class="line">SELECT DATE_FORMAT(NOW(),&#39;%D&#39;);		# 25th</span><br></pre></td></tr></table></figure>
<h3 id="Caculating-Dates-and-Times"><a href="#Caculating-Dates-and-Times" class="headerlink" title="Caculating Dates and Times"></a>Caculating Dates and Times</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT DATE_ADD(NOW(),INTERVAL 1 YEAR );	# 加1</span><br><span class="line">SELECT DATE_ADD(NOW(),INTERVAL -1 YEAR );	# 加-1</span><br><span class="line">SELECT DATE_SUB(NOW(),INTERVAL 1 YEAR );	# 减1</span><br><span class="line">SELECT DATE_SUB(NOW(),INTERVAL -1 YEAR );	# 减去-1</span><br><span class="line">SELECT DATEDIFF(&#39;2019-01-05 09:00&#39;,&#39;2019-01-01 17:00:00&#39;);# 4</span><br><span class="line">SELECT TIME_TO_SEC(&#39;09:00&#39;)-TIME_TO_SEC(&#39;09:02&#39;)	# -120</span><br></pre></td></tr></table></figure>
<h3 id="The-IFNULL-and-COALESCE-Function"><a href="#The-IFNULL-and-COALESCE-Function" class="headerlink" title="The IFNULL  and COALESCE Function"></a>The IFNULL  and COALESCE Function</h3><p>shipper_id 有的话，那就写。如果 shipper_id 没有的话，那就在这行上写上 Not assigned</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line">SELECT</span><br><span class="line">    order_id,</span><br><span class="line">    IFNULL(shipper_id,&#39;Not assigned&#39;) AS shipper</span><br><span class="line">FROM orders</span><br></pre></td></tr></table></figure>
<p>有shipper_id就写上， 如果 shipper_id 没有，那么就看看comment有没有，comment如果有的话就写上的话，那么才写 Not assigned</p>
<p>也就是说COALESCE 可以写多行，有多个选择。范围比 IFNULL 更大</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line">SELECT</span><br><span class="line">    order_id,</span><br><span class="line">    COALESCE(shipper_id,comments,&#39;Not assigned&#39;) AS shipper</span><br><span class="line">FROM orders</span><br></pre></td></tr></table></figure>
<h4 id="小练习-25"><a href="#小练习-25" class="headerlink" title="小练习"></a>小练习</h4><p>—制作下面这张表格</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/94.png" style="zoom: 80%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line">SELECT</span><br><span class="line">    CONCAT(first_name,&#39; &#39;,last_name) AS customer,</span><br><span class="line">    COALESCE(phone,&#39;Unknown&#39;) AS phone</span><br><span class="line">FROM customers</span><br></pre></td></tr></table></figure>
<h3 id="The-IF-Function"><a href="#The-IF-Function" class="headerlink" title="The IF Function"></a>The IF Function</h3><p>IF(expression,  first, second)</p>
<p>如果满足第一个expression，那么就把first的内容赋值给该信息，反之把second的内容赋值给该信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    order_id,</span><br><span class="line">    order_date,</span><br><span class="line">    IF(</span><br><span class="line">        YEAR(order_date) &#x3D; 2019,</span><br><span class="line">        &#39;ACTIVE&#39;,</span><br><span class="line">        &#39;ARCHIVED&#39;</span><br><span class="line">        )</span><br><span class="line">FROM orders</span><br></pre></td></tr></table></figure>
<h4 id="小练习-26"><a href="#小练习-26" class="headerlink" title="小练习"></a>小练习</h4><p>制作下列表格</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/95.png" style="zoom: 80%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    oi.product_id,</span><br><span class="line">    name,</span><br><span class="line">    COUNT(oi.product_id) AS orders,</span><br><span class="line">    IF((COUNT(oi.product_id)&gt;1),&#39;Many times&#39;,&#39;Once&#39;)</span><br><span class="line"></span><br><span class="line">FROM products</span><br><span class="line">JOIN order_items oi on products.product_id &#x3D; oi.product_id</span><br><span class="line">GROUP BY oi.product_id，name</span><br></pre></td></tr></table></figure>
<h3 id="The-CASE-Operator"><a href="#The-CASE-Operator" class="headerlink" title="The CASE Operator"></a>The CASE Operator</h3><p>那么，知道了IF能执行一个expression以后，怎么进行多个expression的赋值分配呢？</p>
<p>注意CASE 的语法结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CASE </span><br><span class="line">	WHEN .... THEN ...(末尾没有逗号)</span><br><span class="line">	WHEN .... THEN ...(末尾没有逗号)</span><br><span class="line">	WHEN .... THEN ...(末尾没有逗号)</span><br><span class="line">	ELES ...</span><br><span class="line">	END AS ...(列名)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SELECT</span><br><span class="line">    order_id,</span><br><span class="line">    CASE </span><br><span class="line">        WHEN YEAR(order_date)&#x3D;YEAR(NOW()) THEN &#39;Active&#39;</span><br><span class="line">        WHEN YEAR(order_date) &#x3D; YEAR(NOW())-1 THEN &#39;Last Year&#39;</span><br><span class="line">        WHEN YEAR(order_date) &lt; YEAR(NOW())-1 THEN &#39;Archived&#39;</span><br><span class="line">        ELSE &#39;Future&#39;</span><br><span class="line">        END AS category</span><br><span class="line">FROM orders</span><br></pre></td></tr></table></figure>
<h4 id="小练习-27"><a href="#小练习-27" class="headerlink" title="小练习"></a>小练习</h4><ol>
<li>写这张表格，利用CASE Operator</li>
</ol>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/96.png" style="zoom: 80%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">USE sql_store;</span><br><span class="line">SELECT</span><br><span class="line">    CONCAT(first_name,&#39; &#39;,last_name) AS customer,</span><br><span class="line">    points,</span><br><span class="line">    CASE</span><br><span class="line">        WHEN (points&gt;3000) THEN &#39;Gold&#39;</span><br><span class="line">        WHEN (points BETWEEN 2000 AND 3000) THEN &#39;Silver&#39;</span><br><span class="line">        ELSE &#39;Bronze&#39;</span><br><span class="line">        END AS category</span><br><span class="line"></span><br><span class="line">FROM customers</span><br><span class="line">ORDER BY points DESC</span><br></pre></td></tr></table></figure>
<ol>
<li><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/109.png" style="zoom: 40%;"></li>
</ol>
<p>有这样一张表格，我希望用 CASE WHEN 来制作出如下表格：</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/110.png" style="zoom: 80%;"></p>
<p>这时候为了计算每支队伍的进球个数，在用到CASE之外还需要使用 SUM，也就是先利用CASE将进球标位1，然后统计1的个数。</p>
<p>因此score1这一列可以这样写： <code>SUM(CASE WHEN teamid=team1 THEN 1 ELSE 0 END)</code> 说明如果team1进球了，那么这一球记为1，然后求和。</p>
<p>最终sql语句如下所示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">		mdate,</span><br><span class="line">		team1,</span><br><span class="line">    <span class="keyword">SUM</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> teamid = team1 <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) score1, </span><br><span class="line">		team2, </span><br><span class="line">		<span class="keyword">SUM</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> teamid = team2 <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) score2</span><br><span class="line"><span class="keyword">FROM</span> game ga </span><br><span class="line"><span class="keyword">JOIN</span> goal <span class="keyword">go</span> </span><br><span class="line"><span class="keyword">ON</span> (ga.id= go.matchid)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> mdate, team1, team2</span><br></pre></td></tr></table></figure>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><h3 id="Creating-views创建视图"><a href="#Creating-views创建视图" class="headerlink" title="Creating views创建视图"></a>Creating views创建视图</h3><p>视图就是一张子表格，我们把我们需要的信息筛选出来后创建成一张视图。然后就可以把这张视图当作一个表格，进行更多操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE VIEW sales_by_clients AS</span><br><span class="line">SELECT</span><br><span class="line">        c.client_id,</span><br><span class="line">        c.name,</span><br><span class="line">        SUM(invoice_total) AS total_sales,</span><br><span class="line">        (SELECT AVG(invoice_total) FROM invoices) AS average</span><br><span class="line">FROM clients c</span><br><span class="line">JOIN invoices i on c.client_id &#x3D; i.client_id</span><br><span class="line">GROUP BY c.client_id,name</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM sales_by_clients</span><br><span class="line">ORDER BY total_sales</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/97.png" style="zoom: 80%;"></p>
<h4 id="小练习：-2"><a href="#小练习：-2" class="headerlink" title="小练习："></a>小练习：</h4><p>Create a view to see the balance for each client called clients_balance,including client_id,name and balance</p>
<p>(balance = invoice_total - payment_total)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CREATE VIEW clients_balance AS</span><br><span class="line">SELECT</span><br><span class="line">        c.client_id,</span><br><span class="line">        c.name,</span><br><span class="line">        (i.invoice_total-i.payment_total) AS balance</span><br><span class="line">FROM clients c</span><br><span class="line">JOIN invoices i on c.client_id &#x3D; i.client_id</span><br><span class="line">GROUP BY c.client_id,name</span><br><span class="line">ORDER BY client_id</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT *</span><br><span class="line">FROM clients_balance</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/98.png" style="zoom: 80%;"></p>
<h3 id="Altering-or-Dropping-Views-更改或删除视图"><a href="#Altering-or-Dropping-Views-更改或删除视图" class="headerlink" title="Altering or Dropping Views    更改或删除视图"></a>Altering or Dropping Views    更改或删除视图</h3><p>删除视图后重新创建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DROP VIEW sales_by_clients</span><br></pre></td></tr></table></figure>
<p>所以我们需要把创建视图时候的源代码保存为sql文件</p>
<h3 id="Updatable-Views-可更新视图"><a href="#Updatable-Views-可更新视图" class="headerlink" title="Updatable Views    可更新视图"></a>Updatable Views    可更新视图</h3><p>当一张视图没有</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DISTINCT</span><br><span class="line">Aggregate Functions(MIN,MAX,SUM...)</span><br><span class="line">GROUP BY&#x2F; HAVING</span><br><span class="line">UNION</span><br></pre></td></tr></table></figure>
<p>这些函数或者关键词的时候，我们称这张视图为可更新视图</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CREATE OR REPLACE VIEW invoices_with_balance AS</span><br><span class="line">SELECT</span><br><span class="line">       invoice_id,</span><br><span class="line">       number,</span><br><span class="line">       client_id,</span><br><span class="line">       invoice_total,</span><br><span class="line">       payment_total,</span><br><span class="line">       invoice_total-payment_total AS balance,</span><br><span class="line">       invoice_date,</span><br><span class="line">       due_date,</span><br><span class="line">       payment_date</span><br><span class="line">FROM invoices</span><br><span class="line">WHERE (invoice_total-payment_total)&gt;0</span><br></pre></td></tr></table></figure>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/99.png" style="zoom: 60%;"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DELETE FROM invoices_with_balance</span><br><span class="line">WHERE invoice_id &#x3D; 1</span><br></pre></td></tr></table></figure>
<p>删除invoice_id =1 的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UPDATE invoices_with_balance</span><br><span class="line">SET due_date &#x3D; DATE_ADD(due_date, INTERVAL 2 DAY )</span><br><span class="line">WHERE client_id &#x3D; 2</span><br></pre></td></tr></table></figure>
<p>把due_date 调后两天</p>
<h3 id="WITH-OPTION-CHECK-Clause"><a href="#WITH-OPTION-CHECK-Clause" class="headerlink" title="WITH OPTION CHECK  Clause"></a>WITH OPTION CHECK  Clause</h3><p>WITH CHECK OPTION的作用?<br>1.对于update,有with check option，要保证update后，数据要被视图查询出来；<br>2.对于delete,有无with check option都一样；<br>4.对于insert,有with check option，要保证insert后，数据要被视图查询出来；<br>5.对于没有where 子句的视图，使用with check option是多余的。</p>
<p> 如果修改后的条件不满足在创建VIEW的时候给出的条件，那么就会报错。</p>
<p>否则就随便改了，不符合我们的条件</p>
<h3 id="Other-Benefits-of-Views"><a href="#Other-Benefits-of-Views" class="headerlink" title="Other Benefits of Views"></a>Other Benefits of Views</h3><p>如果需要经常执行某项复杂查询，可以基于这个复杂查询建立视图，此后查询此视图即可，简化复杂查询；<br>视图本质上就是一条SELECT语句，所以当访问视图时，只能访问到所对应的SELECT语句中涉及到的列，对基表中的其它列起到安全和保密的作用，可以限制数据访问。</p>
<p>1、数据库视图允许简化复杂查询：数据库视图由与许多基础表相关联的SQL语句定义。 您可以使用数据库视图来隐藏最终用户和外部应用程序的基础表的复杂性。 通过数据库视图，您只需使用简单的SQL语句，而不是使用具有多个连接的复杂的SQL语句。<br>2、数据库视图有助于限制对特定用户的数据访问。 您可能不希望所有用户都可以查询敏感数据的子集。可以使用数据库视图将非敏感数据仅显示给特定用户组。<br>3、数据库视图提供额外的安全层。 安全是任何关系数据库管理系统的重要组成部分。 数据库视图为数据库管理系统提供了额外的安全性。 数据库视图允许您创建只读视图，以将只读数据公开给特定用户。 用户只能以只读视图检索数据，但无法更新。<br>4、数据库视图启用计算列。 数据库表不应该具有计算列，但数据库视图可以这样。 假设在orderDetails表中有quantityOrder(产品的数量)和priceEach(产品的价格)列。 但是，orderDetails表没有一个列用来存储订单的每个订单项的总销售额。如果有，数据库模式不是一个好的设计。 在这种情况下，您可以创建一个名为total的计算列，该列是quantityOrder和priceEach的乘积，以表示计算结果。当您从数据库视图中查询数据时，计算列的数据将随机计算产生。<br>5、数据库视图实现向后兼容。 假设你有一个中央数据库，许多应用程序正在使用它。 有一天，您决定重新设计数据库以适应新的业务需求。删除一些表并创建新的表，并且不希望更改影响其他应用程序。在这种情况下，可以创建与将要删除的旧表相同的模式的数据库视图。</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/100.png" style="zoom: 60%;"></p>
<h2 id="SQLZOO练习"><a href="#SQLZOO练习" class="headerlink" title="SQLZOO练习"></a>SQLZOO练习</h2><h3 id="MORE-JOIN"><a href="#MORE-JOIN" class="headerlink" title="MORE JOIN"></a>MORE JOIN</h3><p><a href="https://sqlzoo.net/wiki/More_JOIN_operations" target="_blank" rel="noopener">https://sqlzoo.net/wiki/More_JOIN_operations</a></p>
<p>有数据表如下：</p>
<p><img src="/2020/05/16/Mysql%E5%9F%BA%E7%A1%80/111.png" style="zoom: 60%;"></p>
<ol>
<li>Obtain a list, in alphabetical order, of actors who’ve had at least 15 <strong>starring</strong> roles.</li>
</ol>
<p>这道题要我们列出主演过15部电影的电影明星并按照字母表顺序排列</p>
<p>首先要计算演过的电影数量，必然要使用到COUNT，其次如果明星主演了一部电影，那么它的ord=1。 这题不需要使用JOIN，可以使用子查询，先查询主演电影数超过15的actorid，然后再在actor中查询这些id即可</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span> </span><br><span class="line"><span class="keyword">FROM</span> actor </span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">id</span> <span class="keyword">IN</span></span><br><span class="line">    (<span class="keyword">SELECT</span> actorid </span><br><span class="line">     <span class="keyword">FROM</span> casting </span><br><span class="line">     <span class="keyword">WHERE</span> <span class="keyword">ord</span> = <span class="number">1</span> </span><br><span class="line">     <span class="keyword">GROUP</span> <span class="keyword">BY</span> actorid </span><br><span class="line">     <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*) &gt;= <span class="number">15</span>);</span><br></pre></td></tr></table></figure>
<ol>
<li>List the films released in the year 1978 ordered by the number of actors in the cast, then by title.</li>
</ol>
<p>这道题要我们查询1978年所有的电影的卡司数量，还是比较简单的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> title, <span class="keyword">COUNT</span>(actorid) <span class="keyword">AS</span> <span class="keyword">num</span></span><br><span class="line"><span class="keyword">FROM</span> casting </span><br><span class="line"><span class="keyword">JOIN</span> movie <span class="keyword">ON</span> <span class="keyword">id</span> = movieid</span><br><span class="line"><span class="keyword">WHERE</span> yr= <span class="number">1978</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> title</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">num</span> <span class="keyword">DESC</span>, title;</span><br></pre></td></tr></table></figure>
<ol>
<li>List all the people who have worked with ‘Art Garfunkel’.</li>
</ol>
<p>这道题要我们找出所有和演员Art Garfunkel共事过的人。</p>
<p>这题是比较难的，我们来层层深入分析</p>
<p>首先，因为这个人可能演过很多电影，我们先要将其找出。</p>
<p>为了找出这个人演的电影，需要用到子查询，也就是</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> movieid </span><br><span class="line"> 		 <span class="keyword">FROM</span> casting    </span><br><span class="line">     <span class="keyword">WHERE</span> actorid </span><br><span class="line">     				<span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">id</span> </span><br><span class="line">     						<span class="keyword">FROM</span> actor </span><br><span class="line">     						<span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'Art Garfunkel'</span>)</span><br></pre></td></tr></table></figure>
<p>然后，需要找到这些电影中所有的卡司人员，除了Art Garfunkel之外，因此外面还需要套一层选择语句。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span></span><br><span class="line"><span class="keyword">FROM</span> actor <span class="keyword">JOIN</span> casting <span class="keyword">ON</span> <span class="keyword">id</span> = actorid</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">name</span> &lt;&gt; <span class="string">'Art Garfunkel'</span></span><br><span class="line"><span class="keyword">AND</span> movieid <span class="keyword">IN</span>   </span><br><span class="line"> 		(<span class="keyword">SELECT</span> movieid </span><br><span class="line"> 		 <span class="keyword">FROM</span> casting    </span><br><span class="line">     <span class="keyword">WHERE</span> actorid </span><br><span class="line">     				<span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="keyword">id</span> </span><br><span class="line">     						<span class="keyword">FROM</span> actor </span><br><span class="line">     						<span class="keyword">WHERE</span> <span class="keyword">name</span> = <span class="string">'Art Garfunkel'</span>))</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2020/05/15/%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/15/%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/" class="post-title-link" itemprop="url">连通分量</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-05-15 23:42:35" itemprop="dateCreated datePublished" datetime="2020-05-15T23:42:35+08:00">2020-05-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-08 10:16:58" itemprop="dateModified" datetime="2021-01-08T10:16:58+08:00">2021-01-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%9B%BE/" itemprop="url" rel="index"><span itemprop="name">图</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="连通分量"><a href="#连通分量" class="headerlink" title="连通分量"></a>连通分量</h1><h2 id="1-连通图和连通分量："><a href="#1-连通图和连通分量：" class="headerlink" title="1.连通图和连通分量："></a>1.连通图和连通分量：</h2><p>连通图：无向图中，如果顶点vi到vj有路径，则称vi和vj是联通的，如果图中任意两个顶点都是连通的，则称G为连通图。</p>
<p><img src="/2020/05/15/%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/1.png" alt></p>
<p>连通分量：无向图G的极大连通子图称为G的连通分量。极大连通子图的意思是：该子图是G的连通子图，如果再加入一个顶点，该子图不连通。下图中该图有三个连通分量。 对于连通图，则其连通分量就是他自己，对于非连通图，则有2个以上的连通分量。</p>
<p><img src="/2020/05/15/%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/2.png" style="zoom:67%;"></p>
<p><img src="/2020/05/15/%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/3.png" style="zoom:80%;"></p>
<h2 id="2-强连通图和强连通分量"><a href="#2-强连通图和强连通分量" class="headerlink" title="2.强连通图和强连通分量"></a>2.强连通图和强连通分量</h2><p><img src="/2020/05/15/%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/4.png" style="zoom:80%;"></p>
<p><img src="/2020/05/15/%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/5.png" style="zoom:80%;"></p>
<p>弱连通或者单向连通就是指只有一个方向相连.</p>
<h2 id="3-无向图的桥与割点"><a href="#3-无向图的桥与割点" class="headerlink" title="3.无向图的桥与割点"></a>3.无向图的桥与割点</h2><p>在生活中，桥就是连接河两岸的交通要道，桥断了，河两岸不在连通。在图论中，桥有着同样的含义。如图所示，去掉该边（5，8）后图分裂成两个互不连通的子图，边（5，8）就为图G的桥，同样，边（5，7）也是图G的桥</p>
<p><img src="/2020/05/15/%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/6.png" style="zoom:80%;"></p>
<p><img src="/2020/05/15/%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/7.png" style="zoom:80%;"></p>
<p><img src="/2020/05/15/%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/8.png" style="zoom:80%;"></p>
<p><img src="/2020/05/15/%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/9.png" style="zoom:80%;"></p>
<h2 id="4-无向图的双连通分量"><a href="#4-无向图的双连通分量" class="headerlink" title="4. 无向图的双连通分量"></a>4. 无向图的双连通分量</h2><ul>
<li><p>如果无向图中不存在桥，则称它为边双连通图，边连通图中，任意两个点间，存在两条或以上的路径，且路径上的<strong>边不重复</strong></p>
<ul>
<li>比如说一个环路</li>
</ul>
</li>
<li><p>如果无向图中不存在割点，则称它为点双连通图，点连通图中，如果顶点数大于2，则任意两个点间，存在两条或以上的路径，且路径上的边不重复</p>
<ul>
<li>比如一个环路</li>
</ul>
</li>
<li><p>无向图的极大边双连通子图称为双连通分量，记为e-DCC</p>
</li>
<li><p>无向图的极大点双连通子图称为点双连通分量，记为v-DCC</p>
</li>
</ul>
<p>二者统称为<strong>双连通分量DCC</strong></p>
<h2 id="5-双连通分量的缩点"><a href="#5-双连通分量的缩点" class="headerlink" title="5. 双连通分量的缩点"></a>5. 双连通分量的缩点</h2><h3 id="e-DCC缩点"><a href="#e-DCC缩点" class="headerlink" title="e-DCC缩点"></a>e-DCC缩点</h3><p>把每一个边双连通分量e-DCC看作是一个点，把桥看作连接两个缩点的无向边，得到一个树，这种方法称为e-DCC缩点，如图，生成了一棵树</p>
<p><img src="/2020/05/15/%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/11.png" style="zoom:80%;"></p>
<p> <strong>注意：</strong>边双连通分量就是删除桥之后留下的连通块，但点双连通分量并不是删除割点后留下的连通块</p>
<h3 id="v-DCC缩点"><a href="#v-DCC缩点" class="headerlink" title="v-DCC缩点"></a>v-DCC缩点</h3><p>把每一个点双连通分量v-DCC看作是一个点，把割点看成一个点，每个割点向包含他的v-DCC连接一条边，得到一个树， 如图， 这种方法称为v-DCC缩点。</p>
<p>如图所示，图G的点双连通分量有4 个（没有割点才能叫点双连通分量)</p>
<p><img src="/2020/05/15/%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/13.png" style="zoom: 67%;"></p>
<p>那么，我们得到的树就是：</p>
<p><img src="/2020/05/15/%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/12.png" style="zoom:80%;"></p>
<h1 id="Tarjan算法"><a href="#Tarjan算法" class="headerlink" title="Tarjan算法"></a>Tarjan算法</h1><ol>
<li>无向图的桥．</li>
<li>无向图的割点</li>
<li>有向图的强连通分量</li>
</ol>
<p>Tarjan 计算机科学家， 以LCA，强连通分量等算法闻名。Tarjan设计了求解应用领域的许多问题的广泛有效的算法和数拆结构。他以在数据结构和图论上的开创性工作而闻名， 他的 些著名的算法包括Tarjan最近公共祖先离线算法，Tarjan的强连通分量算法以及Link-Cut-Trees环法等。其中Hopcroft-!Tarjan平面嵌入算法是第一个线性时间平面算法。Tarjan 也开创了重要的数据结构，如斐波纳契堆和splay树， 另一项重大贡献是分析了并查集。 他是第一个证明了计算反阿克曼函数的乐观时间复杂度的科学家。</p>
<p>在介绍算法之前，首先引入时间戳和追溯点的概念</p>
<p><strong>时间戳</strong>：dfn[u]表示u结点深度优先遍历的序号</p>
<p><strong>追溯点：</strong>low[u] 表示u结点或u的子孙能通过非父子边追溯到的dfn最小的节点序号。即回到最早的过去</p>
<p>例如，在深度优先搜索中。每个点的时间戳和追溯点求解过程如下。</p>
<p>初始时，dfn[u] = low[u] ,如果该节点的邻接点未被访问，则一直使用深度优先遍历，1-2-3-5-6-4，此时4的邻接点1已经被访问，且1不是4的父节点，4的父节点是6（深度优先搜索树上的父节点）</p>
<p><img src="/2020/05/15/%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/14.png"></p>
<p><img src="/2020/05/15/%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/15.png" style="zoom:;"></p>
<p>深度优先搜索书，起点就是根</p>
<h2 id="无向图的桥"><a href="#无向图的桥" class="headerlink" title="无向图的桥"></a>无向图的桥</h2><p>如何判断一条边是桥？</p>
<p>无向边(x,y) 是桥， 当且仅当搜索树上存在x的一个子节点y ，满足：</p>
<p>$low[y]&gt;dfn[x]$</p>
<p>上图中边(5,7), 5的子节点7，满足$low[7]&gt;dfn[5]$ ，因此这条边为桥。</p>
<h3 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">1000</span>+<span class="number">5</span>;<span class="comment">//节点数</span></span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">int</span> head[maxn],cnt;<span class="comment">//头节点</span></span><br><span class="line"><span class="comment">//定义边</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="keyword">int</span> to,next;</span><br><span class="line">&#125;e[maxn&lt;&lt;<span class="number">1</span>];</span><br><span class="line"><span class="comment">//定义low数组和dfn数组</span></span><br><span class="line"><span class="keyword">int</span> low[maxn],dfn[maxn],num;</span><br><span class="line"><span class="comment">//链式前向星</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	e[++cnt].next=head[u];</span><br><span class="line">	e[cnt].to=v;</span><br><span class="line">	head[u]=cnt;	</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">tarjan</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> fa)</span><span class="comment">//u是出发点，fa是u的父节点</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//num一开始是0，先把结点的dfn和low都等于1</span></span><br><span class="line">	dfn[u]=low[u]=++num;</span><br><span class="line">    <span class="comment">//访问u的所有邻接点（链式前向星）</span></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=head[u];i;i=e[i].next)</span><br><span class="line">	&#123;</span><br><span class="line">        <span class="comment">//v是u的第一个邻接点</span></span><br><span class="line">		<span class="keyword">int</span> v=e[i].to;</span><br><span class="line">        <span class="comment">//如果v是u的父亲(无向图中，父亲也是他的邻接点).那么什么也不做(不走回头路)</span></span><br><span class="line">		<span class="keyword">if</span>(v==fa)</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">        <span class="comment">//否则没有被访问的话，那么就从v开始深度优先遍历</span></span><br><span class="line">		<span class="keyword">if</span>(!dfn[v])</span><br><span class="line">		&#123;</span><br><span class="line">			tarjan(v,u);</span><br><span class="line">      <span class="comment">//一定要更新u节点的low值，因为孩子的low值可以当作父亲的low值。取得最小的low值</span></span><br><span class="line">			low[u]=<span class="built_in">min</span>(low[u],low[v]);</span><br><span class="line">       <span class="comment">//当low[v]&gt;dfn[u]那么就说 u-v是桥</span></span><br><span class="line">			<span class="keyword">if</span>(low[v]&gt;dfn[u])</span><br><span class="line">				<span class="built_in">cout</span>&lt;&lt;u&lt;&lt;<span class="string">"—"</span>&lt;&lt;v&lt;&lt;<span class="string">"是桥"</span>&lt;&lt;<span class="built_in">endl</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			low[u]=<span class="built_in">min</span>(low[u],dfn[v]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//初始化头节点数组，low数组，dfn数组</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(head,<span class="number">0</span>,<span class="keyword">sizeof</span>(head));</span><br><span class="line">	<span class="built_in">memset</span>(low,<span class="number">0</span>,<span class="keyword">sizeof</span>(low));</span><br><span class="line">	<span class="built_in">memset</span>(dfn,<span class="number">0</span>,<span class="keyword">sizeof</span>(dfn));</span><br><span class="line">	cnt=num=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">cin</span>&gt;&gt;n&gt;&gt;m)<span class="comment">//输入节点和边的数量</span></span><br><span class="line">	&#123;</span><br><span class="line">		init();</span><br><span class="line">		<span class="keyword">int</span> u,v;</span><br><span class="line">		<span class="keyword">while</span>(m--)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">cin</span>&gt;&gt;u&gt;&gt;v;</span><br><span class="line">			add(u,v);</span><br><span class="line">			add(v,u);</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="comment">//防止不连通节点的存在，查漏</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">			<span class="keyword">if</span>(!dfn[i])</span><br><span class="line">				tarjan(<span class="number">1</span>,<span class="number">0</span>);<span class="comment">//0是没有父亲的</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试数据：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>测试数据1</th>
<th></th>
<th>测试数据2</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>7</td>
<td>7</td>
<td>10</td>
<td>13</td>
</tr>
<tr>
<td>1</td>
<td>4</td>
<td>1</td>
<td>2</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>1</td>
<td>3</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>1</td>
<td>4</td>
</tr>
<tr>
<td>3</td>
<td>5</td>
<td>2</td>
<td>3</td>
</tr>
<tr>
<td>5</td>
<td>7</td>
<td>2</td>
<td>5</td>
</tr>
<tr>
<td>5</td>
<td>6</td>
<td>5</td>
<td>3</td>
</tr>
<tr>
<td>6</td>
<td>4</td>
<td>5</td>
<td>7</td>
</tr>
<tr>
<td></td>
<td></td>
<td>5</td>
<td>6</td>
</tr>
<tr>
<td>5-7是桥</td>
<td></td>
<td>5</td>
<td>8</td>
</tr>
<tr>
<td></td>
<td></td>
<td>6</td>
<td>4</td>
</tr>
<tr>
<td></td>
<td></td>
<td>8</td>
<td>9</td>
</tr>
<tr>
<td></td>
<td></td>
<td>8</td>
<td>10</td>
</tr>
<tr>
<td></td>
<td></td>
<td>9</td>
<td>10</td>
</tr>
<tr>
<td></td>
<td></td>
<td>5-8是桥</td>
<td>5-7是桥</td>
</tr>
</tbody>
</table>
</div>
<p><img src="https://logo-1302470102.cos.ap-shanghai.myqcloud.com/1.gif" style="zoom:140%;"></p>
<h2 id="割点判定法则"><a href="#割点判定法则" class="headerlink" title="割点判定法则"></a>割点判定法则</h2><p>若x不是根节点，则x是割点，当且仅当搜索树上存在<strong>x的一个子节点y</strong>，满足：</p>
<p>$low[y]\geq dfn[x]$ (<strong>注意</strong>，刚才求桥的是大于符号，这里是大于等于符号)</p>
<p>若x是根节点，则x是割点，当且仅当搜索树上存在<strong>至少两个子节点</strong>，满足上述条件。因为我们想一下，如果只有一个子节点满足上述条件，那么就如下图的1，2结点，那么1就不是割点。</p>
<p>图中，5的子节点7，满足low[7]&gt;dfn[5]因此5是割点</p>
<p><img src="/2020/05/15/%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/16.png" style="zoom: 67%;"></p>
<p><img src="/2020/05/15/%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/17.png" style="zoom: 67%;"></p>
<p>第二张图中，1是割点</p>
<p><img src="/2020/05/15/%E8%BF%9E%E9%80%9A%E5%88%86%E9%87%8F/18.png" style="zoom: 67%;"></p>
<h3 id="算法-1"><a href="#算法-1" class="headerlink" title="算法"></a>算法</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">1000</span>+<span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">int</span> head[maxn],cnt,root;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="keyword">int</span> to,next;</span><br><span class="line">&#125;e[maxn&lt;&lt;<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> low[maxn],dfn[maxn],num;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	e[++cnt].next=head[u];</span><br><span class="line">	e[cnt].to=v;</span><br><span class="line">	head[u]=cnt;	</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">tarjan</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> fa)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	dfn[u]=low[u]=++num;</span><br><span class="line">	<span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=head[u];i;i=e[i].next)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> v=e[i].to;</span><br><span class="line">		<span class="keyword">if</span>(v==fa)</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		<span class="keyword">if</span>(!dfn[v])</span><br><span class="line">		&#123;</span><br><span class="line">			tarjan(v,u);</span><br><span class="line">			low[u]=<span class="built_in">min</span>(low[u],low[v]);</span><br><span class="line">			<span class="keyword">if</span>(low[v]&gt;=dfn[u])</span><br><span class="line">			&#123;</span><br><span class="line">				count++;</span><br><span class="line">				<span class="keyword">if</span>(u!=root||count&gt;<span class="number">1</span>)</span><br><span class="line">					<span class="built_in">cout</span>&lt;&lt;u&lt;&lt;<span class="string">"是割点"</span>&lt;&lt;<span class="built_in">endl</span>; </span><br><span class="line">			&#125;	</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			low[u]=<span class="built_in">min</span>(low[u],dfn[v]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(head,<span class="number">0</span>,<span class="keyword">sizeof</span>(head));</span><br><span class="line">	<span class="built_in">memset</span>(low,<span class="number">0</span>,<span class="keyword">sizeof</span>(low));</span><br><span class="line">	<span class="built_in">memset</span>(dfn,<span class="number">0</span>,<span class="keyword">sizeof</span>(dfn));</span><br><span class="line">	cnt=num=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">cin</span>&gt;&gt;n&gt;&gt;m)</span><br><span class="line">	&#123;</span><br><span class="line">		init();</span><br><span class="line">		<span class="keyword">int</span> u,v;</span><br><span class="line">		<span class="keyword">while</span>(m--)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">cin</span>&gt;&gt;u&gt;&gt;v;</span><br><span class="line">			add(u,v);<span class="comment">//无向图等于双向图</span></span><br><span class="line">			add(v,u);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">			<span class="keyword">if</span>(!dfn[i])</span><br><span class="line">			&#123;</span><br><span class="line">				root=i;</span><br><span class="line">				tarjan(i,<span class="number">0</span>);</span><br><span class="line">			 &#125; </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="有向图的强连通分量"><a href="#有向图的强连通分量" class="headerlink" title="有向图的强连通分量"></a>有向图的强连通分量</h2><h3 id="算法步骤："><a href="#算法步骤：" class="headerlink" title="算法步骤："></a>算法步骤：</h3><ol>
<li>深度优先遍历结点，第一次访问结点x时，将x入栈，且dfn[x] = low[x] =++num</li>
<li>遍历x的所有邻接点y，<ul>
<li>若y没有被访问，则递归访问y，返回时更新low[x] = min(low[x],low[y])</li>
<li>若y已经被访问且在栈当中，则令low[x] = min(low[x],dfn[y]);</li>
</ul>
</li>
<li>x回溯之前，判断如果low[x] = dfn[x] ，则从栈中不断弹出节点，一直到x出栈为止。弹出的结点就是一个强连通分量</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> maxn=<span class="number">1000</span>+<span class="number">5</span>;</span><br><span class="line"><span class="keyword">int</span> n,m;</span><br><span class="line"><span class="keyword">int</span> head[maxn],cnt;</span><br><span class="line"><span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt;s;</span><br><span class="line"><span class="keyword">bool</span> ins[maxn];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="keyword">int</span> to,next;</span><br><span class="line">&#125;e[maxn&lt;&lt;<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> low[maxn],dfn[maxn],num;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> u,<span class="keyword">int</span> v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	e[++cnt].next=head[u];</span><br><span class="line">	e[cnt].to=v;</span><br><span class="line">	head[u]=cnt;	</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">tarjan</span><span class="params">(<span class="keyword">int</span> u)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	low[u]=dfn[u]=++num;</span><br><span class="line">    <span class="comment">//标记元素是否在栈中</span></span><br><span class="line">	ins[u]=<span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//定义一个栈把u放到栈中</span></span><br><span class="line">	s.push(u);</span><br><span class="line">    <span class="comment">//访问u的所有邻接点(发出边)</span></span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> i=head[u];i;i=e[i].next)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> v=e[i].to;</span><br><span class="line">		<span class="keyword">if</span>(!dfn[v])</span><br><span class="line">		&#123;</span><br><span class="line">            <span class="comment">//如果没有被访问，继续深度优先遍历</span></span><br><span class="line">			tarjan(v);</span><br><span class="line">            <span class="comment">//更新low[u]	</span></span><br><span class="line">			low[u]=<span class="built_in">min</span>(low[u],low[v]);</span><br><span class="line">		&#125;</span><br><span class="line">        <span class="comment">//如果已经访问过了，那么看看是否v结点在栈中</span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(ins[v])</span><br><span class="line">			low[u]=<span class="built_in">min</span>(low[u],dfn[v]);<span class="comment">//更新low值</span></span><br><span class="line">        <span class="comment">//因为u结点不止一个孩子，所以如果u的low值已经被很小的一个更新了，那么再次遇到dfn[v]</span></span><br><span class="line">        <span class="comment">//不一定比 当前的low[u]要小</span></span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">//判断low[u]是否等于dfn[u]</span></span><br><span class="line">	<span class="keyword">if</span>(low[u]==dfn[u])</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">int</span> v;</span><br><span class="line">		<span class="built_in">cout</span>&lt;&lt;<span class="string">"连通分量:"</span>;</span><br><span class="line">		<span class="keyword">do</span></span><br><span class="line">		&#123;</span><br><span class="line">			v=s.top();</span><br><span class="line">			s.pop();</span><br><span class="line">			<span class="built_in">cout</span>&lt;&lt;v&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">			ins[v]=<span class="literal">false</span>;</span><br><span class="line">		&#125;<span class="keyword">while</span>(v!=u);<span class="comment">//一直到把u出栈就停止</span></span><br><span class="line">		<span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(head,<span class="number">0</span>,<span class="keyword">sizeof</span>(head));</span><br><span class="line">	<span class="built_in">memset</span>(low,<span class="number">0</span>,<span class="keyword">sizeof</span>(low));</span><br><span class="line">	<span class="built_in">memset</span>(dfn,<span class="number">0</span>,<span class="keyword">sizeof</span>(dfn));</span><br><span class="line">	<span class="built_in">memset</span>(ins,<span class="number">0</span>,<span class="keyword">sizeof</span>(ins));</span><br><span class="line">	cnt=num=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(<span class="built_in">cin</span>&gt;&gt;n&gt;&gt;m)</span><br><span class="line">	&#123;</span><br><span class="line">		init();</span><br><span class="line">		<span class="keyword">int</span> u,v;</span><br><span class="line">		<span class="keyword">while</span>(m--)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">cin</span>&gt;&gt;u&gt;&gt;v;</span><br><span class="line">			add(u,v);</span><br><span class="line">            add(v,u);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">			<span class="keyword">if</span>(!dfn[i])</span><br><span class="line">				tarjan(i);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://logo-1302470102.cos.ap-shanghai.myqcloud.com/2.gif"></p>
<p>gif来自：<a href="https://visualgo.net/zh/dfsbfs" target="_blank" rel="noopener">https://visualgo.net/zh/dfsbfs</a></p>
<p>连通分量:    0</p>
<p>连通分量:    1,2,3,4</p>
<p>连通分量:    5,6,7</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/27/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/27/">27</a><span class="page-number current">28</span><a class="page-number" href="/page/29/">29</a><span class="space">&hellip;</span><a class="page-number" href="/page/44/">44</a><a class="extend next" rel="next" href="/page/29/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Jason</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">439</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">68</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jason</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

    

  

</body>
</html>
