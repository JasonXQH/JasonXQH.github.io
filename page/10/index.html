<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=">


  <link rel="mask-icon" href="/images/logo.svg?v=" color="#222">














<meta property="og:type" content="website">
<meta property="og:title" content="Jason‘s Blog">
<meta property="og:url" content="https://jasonxqh.github.io/page/10/index.html">
<meta property="og:site_name" content="Jason‘s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Jason">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '',
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    fancybox: false,
    tabs: ,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: 'undefined',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>







  <title>Jason‘s Blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', '[object Object]', 'auto');
  ga('send', 'pageview');
</script>





<meta name="generator" content="Hexo 4.2.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">
  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
<a href="https://github.com/JasonXQH/JasonXQH.github.io" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Jason‘s Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/%20" rel="section">
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/%20" rel="section">
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/%20" rel="section">
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2021/09/21/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/09/21/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/" itemprop="url">数据管理系统-文档数据库设计</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-09-21T21:28:23+08:00">
                2021-09-21
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2021-12-01T15:37:22+08:00">
                2021-12-01
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="文档数据库-索引"><a href="#文档数据库-索引" class="headerlink" title="文档数据库-索引"></a>文档数据库-索引</h1><p>文档数据库的索引采用的数据结构是B树。关于B树的创建、删除在这里就不说了，仅说说索引的创建与使用。</p>
<p>索引一般不会自动创建，需要我们手动为一个属性创建索引。创建了索引之后，查询的速度会快很多</p>
<p>mongodb创建索引的方式是：<code>db.myCollection.createIndex({&quot;name&quot;:1})</code></p>
<p>但是我们没有必要给所有的属性都加上索引，因为索引的每一个节点都是一个页，非常占用空间。此外，我们要保持索引和表中的数据一致。因此，更新索引的时候会增加不小的开销</p>
<p>我们适合在什么样的属性上添加索引呢？有几种原则：</p>
<ul>
<li>常用属性</li>
<li>不常被修改(稳定的属性)</li>
<li>索引要保证有效性。对一个有着名字、生日、性别属性的文档来说，把索引加在名字上式比较有效的。但是我们在性别上添加索引的话，不但不能提速，反而会变慢。因为性别的区分度很低，我们要找的数据是分散在各个地方的，每次对性别进行索引查找的代价甚至是不如直接扫描一遍文档来得快 </li>
</ul>
<p>有些时候我们会在不止一个属性上添加索引，这一部分我们放在关系数据库中去讨论</p>
<p><img src="/2021/09/21/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/6.png"></p>
<p><img src="/2021/09/21/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/7.png"></p>
<p>在这一题中，我们对 price进行了一个大于20而小于30的筛选，这使得筛选得到的数据是离散的分列的。效率并没有比不加索引的查询更快</p>
<h3 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h3><p>假设某文档数据库中有N个文档，被存放在硬盘的K个页中(N&gt;K)。 我们要对这N个文档添加一个新的属性，导致K个页无法再容纳这K个文档。假设属性添加完毕后，需要J个页来容纳文档(N&gt;J&gt;K)。那么，相对高效的处理方式是：</p>
<p>A. 在硬盘上分配J个新页，然后对文档逐个进行修改，完成一个文档的修改就将它写到硬盘上的新页中，最后将K个旧页挥手</p>
<p>B. 在硬盘上分配 J 个新页，然后对文档逐个进行修改，修改后的文档先放入内存中的缓冲区，每当缓冲区满一页后将它写到硬盘上的新页中，最后将K个旧页回收</p>
<p>C. 对文档逐个进行修改，修改后的文档先全部放入内存中的缓冲区，修改完成后，将缓冲区的文档写入到 J 个新页中，最后将K个旧页回收</p>
<p>D.直接在 K 个旧页上进行修改，将溢出的文档放入内存中的缓冲区，修改完成后再将缓冲区的文档写入到 J-K 个新页中</p>
<p>答案是 ： B</p>
<h1 id="数据管理系统-文档数据库设计"><a href="#数据管理系统-文档数据库设计" class="headerlink" title="数据管理系统-文档数据库设计"></a>数据管理系统-文档数据库设计</h1><p><img src="/2021/09/21/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/1.jpeg" style="zoom:67%;"></p>
<p>上面是设计一个数据库的基本流程</p>
<h2 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h2><p>我们用一个例子来考虑文档数据库的设计流程。首先，应该梳理出应用需要满足的功能。比如说博客应用</p>
<ol>
<li>所有人都可以成为博客网站的博主</li>
<li>所有人都可以写文章发表</li>
<li>所有人都可以看我发布的文章</li>
<li>博主和博主之间有粉丝的概念</li>
</ol>
<p>首先要设置一个界面，界面清晰了，功能就清晰了</p>
<p><img src="/2021/09/21/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/2.jpeg" style="zoom: 50%;"></p>
<p>第一个界面是登陆后的个人信息，右侧是博主关注的人的新文章</p>
<p>第二个界面是点击某一篇文章后显示的信息，包括文章的评论</p>
<p>第三个界面是点击第一个界面中的 NEW 按钮显示的，是创建一篇新的博客文章</p>
<p>第四个界面是点击作者信息后显示出来的其他人的信息</p>
<h2 id="概念设计"><a href="#概念设计" class="headerlink" title="概念设计"></a>概念设计</h2><p>对于这个应用我们的需求已经比较清晰了。现在我们开始概念设计</p>
<p>首先要解决的问题是：<strong>存什么</strong>, 也就是要保存几类对象的信息。很显然，有<strong>用户</strong>、<strong>文章</strong>、<strong>评论</strong>。 其关系如下：</p>
<p><img src="/2021/09/21/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/3.jpeg" style="zoom: 50%;"></p>
<p>理清关系之后，我们来解决<strong>怎么存</strong>的问题, 我们有两种典型的方式。</p>
<p>方式1：将所有信息存放到一个文档集合</p>
<p><img src="/2021/09/21/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/4.jpeg" style="zoom: 50%;"></p>
<p>这个文档是关于用户的，包含了用户本身的信息、粉丝的信息、文章的信息</p>
<p>方式2：对于每个对象，用一个文档集合来存放：</p>
<p><img src="/2021/09/21/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/5.jpeg" style="zoom: 50%;"></p>
<h2 id="不同文档结构设计的比较"><a href="#不同文档结构设计的比较" class="headerlink" title="不同文档结构设计的比较"></a>不同文档结构设计的比较</h2><p>上面我们用了两种方式来存放我们所需要的数据，那么那种方式更好呢？判断的标准是我们的应用如何访问数据库</p>
<p>首先，博主登录后看到的第一个页面，虽然可以很简单的获得个人信息，但是我们如果要获得用户关注的人所发的文章信息，会变得非常麻烦。因为我要扫描所有人的信息，找到其fans中ID与该用户相等的人的ID，并拿去找他发布的文章，其最终的结果是需要将整个文档集合扫描一遍，这个效率是很低的</p>
<p>如果是第二种方式，那么我们可以通过User文档来获得个人信息，我们可以扫描用户的fans的ID，去找到他们发布的文章。这样的代价低了很多</p>
<p>在这样一一比较之后，我们需要权衡利弊 来判断哪种方式是适合这个应用的。结果就是都不是太适合。下面我们给出一个较为适合的结构设计</p>
<h2 id="结构设计"><a href="#结构设计" class="headerlink" title="结构设计"></a>结构设计</h2><p><img src="/2021/09/21/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F-%E6%96%87%E6%A1%A3%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1/8.jpeg" style="zoom: 50%;"></p>
<p>最终我们设计出来的文档数据结构如上图所示，我们发现我们在存储了基础必要的信息之后又加了不少冗余信息，包括在文档里面添加了作者的各种信息、在评论中也增加了作者的名字和ID等。这是一种用空间换时间的方法，我们通过存入冗余信息，让应用的每个页面能更快的获取到其所需要的信息</p>
<h2 id="文档数据库设计方法"><a href="#文档数据库设计方法" class="headerlink" title="文档数据库设计方法"></a>文档数据库设计方法</h2><ol>
<li>概念设计：对象以及对象之前的联系</li>
<li>结构设计：对象 &lt;-&gt; 文档；多个对象&lt;——&gt;文档(嵌入式)</li>
</ol>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2021/09/15/%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80-%E5%B0%BE%E6%A6%82%E7%8E%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/09/15/%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80-%E5%B0%BE%E6%A6%82%E7%8E%87/" itemprop="url">数据科学算法基础-尾概率</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-09-15T16:14:48+08:00">
                2021-09-15
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2024-01-10T09:54:53+08:00">
                2024-01-10
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="数据科学算法基础-尾概率"><a href="#数据科学算法基础-尾概率" class="headerlink" title="数据科学算法基础-尾概率"></a>数据科学算法基础-尾概率</h1><h3 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h3><p>我们现在抛一枚均匀的硬币，正面和反面朝上的概率都是0.5，而且每次抛币都是独立的。知觉上，抛的次数越多正面朝上的概率越接近于0.5。如下图所示：</p>
<p><img src="/2021/09/15/%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80-%E5%B0%BE%E6%A6%82%E7%8E%87/1.jpg" style="zoom:67%;"></p>
<p>那么，如果我要计算到底抛多少次才能以$95\%$ 的概率保证正面朝上的频率和真实概率间的差距小于某个阈值(0.125)呢？</p>
<p>为了回答这个问题，我们要用到尾概率不等式来计算概率上界，这边有三个方法：</p>
<p>Markov不等式、Chebyshev不等式、和Chernoff不等式</p>
<h3 id="Markov-不等式"><a href="#Markov-不等式" class="headerlink" title="Markov 不等式"></a>Markov 不等式</h3><p>给定样本空间$\Omega$上的非负随机变量X，对 $\forall a\geq 0$ 有：</p>
<script type="math/tex; mode=display">
P(X>a)\leq \frac{E(X)}{a}</script><p>或者</p>
<script type="math/tex; mode=display">
P(X>aE(X))\leq \frac{1}{a}</script><h4 id="证明："><a href="#证明：" class="headerlink" title="证明："></a>证明：</h4><p>因为$X\geq 0$ ，我们得到：</p>
<script type="math/tex; mode=display">
E(X) = \int_0^\infty xp(x)dx = \int_0^a xp(x)dx +\int_a^\infty xp(x) dx\geq \int_0^\infty xp(x) dx\geq a\int_a^\infty p(x)dx = aP(X>a)</script><p>所以，我们得到 $P(X&gt;a)\leq \frac{E(X)}{a}$</p>
<p>但是，Markov不等式给出的尾概率上界可能非常宽松，比如说，我们要求均匀硬币抛掷n次之后，正面朝 上次数X大于$\frac{3}{4}n$​的概率是：</p>
<script type="math/tex; mode=display">
P(X\geq \frac{3}{4}n)\leq \frac{n/2}{3n/4} = \frac{2}{3}</script><p>用常识来判断，随着n的不断增大，正面朝上次数X 这个概率是很小的，但是用Markov不等式得出的结论是不管n多大，上界都是不变的。</p>
<h3 id="Chebyshev-不等式"><a href="#Chebyshev-不等式" class="headerlink" title="Chebyshev 不等式"></a>Chebyshev 不等式</h3><p>现在我们在马尔科夫不等式的基础上修改一下，令$Y = (X-\mu)^2$ ，带入Markov不等式可得：</p>
<script type="math/tex; mode=display">
P(Y > a^2)\leq \frac{E(Y)}{a^2}</script><p>然后，将概率中的$Y&gt;a^2$开平方，可以得到：</p>
<script type="math/tex; mode=display">
P(|X-\mu|\geq a)\leq \frac{\sigma^2}{a^2}</script><p>因此我们可以给出Chebshev不等式的定义：令X为定义在样本空间$\Omega$ 上的随机变量，对任意的一个正实数$\epsilon$，则：</p>
<script type="math/tex; mode=display">
P(|X-E(X)|\geq \epsilon) \leq \frac{Var(X)}{\epsilon^2}</script><p>切比雪夫不等式还可以写成如下形式：</p>
<script type="math/tex; mode=display">
P(|X-E(X)|<\varepsilon)\geq 1-\frac{Var(X)}{\varepsilon^2}</script><p>再分析一下抛硬币的例子，此时，概率P就变成了：</p>
<script type="math/tex; mode=display">
P(X>\frac34n)<P(|X-\frac{n}2|>\frac{n}{4})\leq \frac{Var(X)}{(n/4)^2}=\frac{16np(1-p)}{n^2}=\frac{4}{n}</script><p>如果抛掷均匀1000次，这一尾概率小于 0.004</p>
<p>这个上界就比Markov小很多了。 </p>
<h3 id="Chernoff-不等式"><a href="#Chernoff-不等式" class="headerlink" title="Chernoff 不等式"></a>Chernoff 不等式</h3><p>随着实验次数的增加，Chernoff 不等式将给出比Chebyshev不等式更紧的尾概率上界。</p>
<p>定理：</p>
<p>若$X<em>i$​ 为定义在样本空间$\Omega$​上的n个独立伯努利随机变量，且 $P(X_i=1)=p_i$​。 令 $X=\sum</em>{i=1}^nX<em>i$​和$\mu=\sum</em>{i=1}^np_i$​,对任意小的$\delta \in(0,1)$​ 有：</p>
<p>结论1：</p>
<script type="math/tex; mode=display">
P(X<(1-\delta)\mu)<(\frac{e^{-\delta}}{(1-\delta)^{(1-\delta)}})^\mu</script><p>结论2：</p>
<script type="math/tex; mode=display">
P(X>(1+\delta)\mu)<(\frac{e^{\delta}}{(1+\delta)^{(1+\delta)}})^\mu</script><p>然而，在不等式中计算$(1-\delta)^{1-\delta}$和$(1+\delta)^{1+\delta}$这两个数是比较麻烦的，因此我们可以用Taylor展开对其进行更进一步的简化。</p>
<p>已知：$\ln (1-\delta) = \sum_{i=1}^\infty -\frac{\delta^i}{i}$</p>
<p>所以：</p>
<script type="math/tex; mode=display">
(1-\delta)\ln(1-\delta) = (1-\delta)\sum_{i=1}^\infty -\frac{\delta^i}{i}=(-\delta+\delta^2-\delta^2/2+\delta^3/2-\cdots)>-\delta+\frac{\delta^2}{2}</script><p>因此</p>
<script type="math/tex; mode=display">
(1-\delta)^{(1-\delta)} >\exp(-\delta+\delta^2/2)\\</script><p>进一步：</p>
<script type="math/tex; mode=display">
P(X<(1-\delta)\mu)<(\frac{e^{-\mu}}{(1-\delta)^{1-\delta}})^\mu\\
<(\frac{e^{-\delta}}{\exp{(-\delta+\frac{\delta^2}{2})}})^\mu=\exp(\frac{-\mu\delta^2}{2})Z</script><p>同理，我们可以证明另外一种情况。</p>
<h4 id="简化后的Chernoff不等式"><a href="#简化后的Chernoff不等式" class="headerlink" title="简化后的Chernoff不等式"></a>简化后的Chernoff不等式</h4><p>结论1：</p>
<script type="math/tex; mode=display">
P(X<(1-\delta)\mu) < \exp (\frac{-\mu\delta^2}{2})\\
P(X>(1+\delta)\mu)<\exp (\frac{-\mu\delta^2}{4})</script><h2 id="Morris算法"><a href="#Morris算法" class="headerlink" title="Morris算法"></a>Morris算法</h2><p> 定义一个数据流, $i∈[1,m],a_i∈[1,n]$​​,频率向量$<fi>, i∈[1,n],f_i∈[1,m]$​​。  数据流是无限的，当数据流流过m个时，出现了N个$a_i$​。  请设计一个算法记录N的大小，要求空间复杂度为$loglog(N)$。</fi></p>
<h3 id="Morris算法-1"><a href="#Morris算法-1" class="headerlink" title="Morris算法"></a>Morris算法</h3><p><strong>算法</strong></p>
<p><img src="/2021/09/15/%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80-%E5%B0%BE%E6%A6%82%E7%8E%87/2.png" style="zoom:67%;"></p>
<ol>
<li><p>将X初始化为0</p>
</li>
<li><p>循环</p>
<p> 如果$a_ i$出现一次   就以$1/(2^X)$​的概率将X增加1</p>
</li>
<li><p>返回$\hat f=(2^X−1)$​</p>
</li>
</ol>
<h4 id="证明的目标"><a href="#证明的目标" class="headerlink" title="证明的目标"></a>证明的目标</h4><p>我们期望返回的值与N的差别尽量小，换句话说就是如果$\hat f$与N的差的绝对值大于某一个很小的值的概率很小，那么我们就可以用这种方法进行计数。说得更通俗一点就是使这个算法计算出的结果偏离N不多，或者偏离太多的概率特别小。</p>
<p>可以利用切比雪夫来证明这一点 $P{[|X - \mu| \geq \epsilon]} \leqslant \sigma^{2}/\epsilon^{2}$​​ </p>
<h4 id="证明"><a href="#证明" class="headerlink" title="证明"></a>证明</h4><p>计算期望：$E[2^{X_{N} } - 1] = N$​</p>
<script type="math/tex; mode=display">
E[2^{X_N}-1]=E[2^{X_N}]-1\\
E[2^{X_N}] = \sum_{i=0}^N 2^i\cdot P[X_n = i]\\
=\sum_{i=0}^N\{2^i\cdot P[X_{N-1}=i]+2P[X_{N-1}=i-1]-P[X_{N-1}=i]\}=E[2^{X_{N-1}}] +1\\
=E[2^{X_0}+N ]= N+1</script><p>因此 $E[2^{X_N}-1] = N$</p>
<p>计算方差：$var[2^{X_{N} } - 1] = \frac{1}{2}N^2-\frac{1}{2}N$</p>
<script type="math/tex; mode=display">
\sigma^2 = E[X^2]-E[x]^2\\
E[X^2] = E[4^{X_N}-2^{X_N+1}+1]=E[4^{X_N}]-(N^2+2N+1)\\
E[4^{X_N}] = \sum_{i=0}^N 4^i \cdot P[X_N=i]\\
=\sum_{i=0}^N\{4^i\cdot P[X_{N-1}=i] -2^i\cdot P[X_{N-1}=i]+2^{i+1}\cdot P[X_{N-1}=i-1]\}\\
=\sum_{i=0}^N\{4^i\cdot P[X_{N-1}=i] \}-\sum_{i=0}^N\{2^i\cdot P[X_{N-1}=i\}+\sum_{i=0}^{N-1}\{2^{i+2}\cdot P[X_{N-1}=i] \}\\
=E[4^{X_{N-1}}] +3N = \frac{3}{2}N^2+\frac{3}{2}N+1\\
\sigma^2 = \frac{3}{2}N^2+\frac{3}{2}N+1-(N^2+2N+1) = O(N^2)</script><p>我们令切比雪夫不等式中的 $X = 2^{X_N}-1$​</p>
<p>其中，$X_N$ 指的是$X$ 最终的值，是在这个计数器在流模型中经历了N个数字。则最终得到公式</p>
<script type="math/tex; mode=display">
P[|\hat N - N| \geq \epsilon N ] \leqslant\frac{n^2}{2\epsilon^2n^2}= \frac{1}{2\epsilon^{2} }</script><h4 id="评价"><a href="#评价" class="headerlink" title="评价"></a>评价</h4><p> Morris算法的优点是：输出结果是真实值的无偏估计</p>
<p>但显而易见，模型的正确性并不好，仅当$\epsilon\geq 1$ 时，尾概率上界不大于1/2, 并且<strong>随着N的增大误差和发生误差的概率也会变得越来越大</strong>。</p>
<p>关于近似计数有更加高效的算法morris+算法和morris++算法</p>
<h3 id="Morris-算法"><a href="#Morris-算法" class="headerlink" title="Morris+算法"></a>Morris+算法</h3><p>为了降低Morris算法数据结果的方差，我们提出了Morris+算法</p>
<p><img src="/2021/09/15/%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80-%E5%B0%BE%E6%A6%82%E7%8E%87/3.png" style="zoom:67%;"></p>
<p>用语言来描述就是：</p>
<ol>
<li>运行k次morris算法</li>
<li>记录记录结果$(X_1,\cdots,X_k)$</li>
<li>返回$\gamma = \frac{1}{k}\sum<em>{i = 1}^{k}(2^{X</em>{i} } - 1)$​</li>
</ol>
<h4 id="证明-1"><a href="#证明-1" class="headerlink" title="证明"></a>证明</h4><p> 直接获取各个$X_i$对应的期望和方差，这在证明morris算法的时候已经计算过了。</p>
<p> 于是可以直接根据期望的性质计算期望$E[γ]=N$</p>
<p> 因为各个变量之间是相互独立的，所以可以利用独立变量之间方差的性质计算方差$D[\gamma] = \frac{N^{2} - N}{2k}$</p>
<p>令切比雪夫不等式中的X为$\frac{1}{k}\sum<em>{i = 1}^{k}(2^{X</em>{i} } - 1)$​​，代入计算得到：$P[|\gamma - N| \geq \epsilon] \leqslant \frac{N^{2}-N}{2k\epsilon^{2} }\approx O(\frac{1}{k\epsilon^2})$​​, 换一种描述就是：</p>
<p>以1−c的概率，$\gamma = N \pm \sqrt{\frac{N^{2}-N}{2kc} }$​ 或者 $N\pm \frac{O(N)}{\sqrt k}$​</p>
<h4 id="评价-1"><a href="#评价-1" class="headerlink" title="评价"></a>评价</h4><p>Morris+算法的复杂度为$O(\frac{1}{\delta\epsilon^2})$</p>
<p>当N确定时，如果想以0.9的概率满足近似标准，使c=0.1，则有 ，我们会发现$k = \frac{5(N^{2} - N)}{\epsilon^{2} }$，这是你需要重复morris算法的次数。然而这么看代价也是不小的，因为这个算法为了保证准确性需要的k的个数并不少。</p>
<h3 id="Morris-算法-1"><a href="#Morris-算法-1" class="headerlink" title="Morris++算法"></a>Morris++算法</h3><p><img src="/2021/09/15/%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80-%E5%B0%BE%E6%A6%82%E7%8E%87/4.png" style="zoom:67%;"></p>
<p>用语言来描述，就是：</p>
<ol>
<li>重复morris+算法 $m = O(log(\frac{1}{\delta}))$​次</li>
<li>取m个结果的中位数</li>
</ol>
<p>为了得到$1−\delta$ 下的 $(1+\epsilon)$近似，使用morris+算法需要$k = O(\frac{1}{\epsilon^{2} \delta})$次计算，而morris++算法的工作就是将这一复杂度降低到了$O(\frac{1}{\epsilon^{2} }log(\frac{1}{\delta}))$​​​​说白了，也就是降低了计算次数。</p>
<h4 id="算法分析"><a href="#算法分析" class="headerlink" title="算法分析"></a>算法分析</h4><p>我们假设运行 t 个 Morris+ 实例，每一个都有 1/3 的失败概率，即：</p>
<script type="math/tex; mode=display">
P(\left|{\hat n-n}\right |>\epsilon n)<\frac{1}{k\epsilon^2} = \frac{1}{3},k = O(\frac{1}{\epsilon^2})</script><p>那么，输出所有 t 个 Morris+ 实例输出值的中位数的话，t个Morris+算法都失败的期望是不会超过$t/3$的。因此，Morris++如果输出了一个糟糕的估计，就会以为t个Morris+算法至少有一半都失败了。</p>
<p>我们定义随机变量 $Y_i = \cases{1, \text{if} \left|{\hat n_i-n}\right<br>|&gt;\epsilon n\~\0,\text{otherwise}}$​ 来表示的是第i次 Morris+ 算法失败与否</p>
<p>注意到：</p>
<script type="math/tex; mode=display">
\mu = E(\sum_{i} Y_i)\leq t/3</script><p>则根据Chernoff 不等式可以知道： </p>
<script type="math/tex; mode=display">
P(\sum_i Y_i > t/2) \leq P(\sum_i Y_i>(1+\frac{1}{2})\mu)\leq \exp(-\mu (1/2)^2/3)<\delta</script><p>也就是说得到了 $\exp (-\mu/12)&lt;\delta,\mu&lt;12\ln (1/\delta)$ </p>
<p>因此，需要运行 $t = O(\ln (1/\delta))$次 Morris+算法，其结果的中位数才能符合精度要求的近似估计。</p>
<h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><p>已知随机变量X的期望 $\mu = E(x)$ 和方差 $\sigma^2 = E[(X-\mu)^2]$. 如果定义随机变量 $X^* = \frac{X-\mu}{\sigma}$ ，证明 </p>
<script type="math/tex; mode=display">
P[|X^*|\geq c] \leq \frac{1}{c^2}</script><p>我们通过求变形后的 $X$ ，结合切比雪夫不等式，来实现</p>
<script type="math/tex; mode=display">
\begin{align}
&E(X^*) = 0\\
&Var(X^*) = \frac{1}{\sigma^2}Var(X) = 1\\
&P(|X^*-0|\geq c)\leq \frac{1}{c^2}
\end{align}</script><h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><p>假设抛一枚均匀的硬币n次，随机变量X定义为正面朝上的次数</p>
<ul>
<li>运用 Chebyshev 不等式给出事件 $X&lt;\frac{n}{4}$ 的概率上界</li>
</ul>
<script type="math/tex; mode=display">
P(|X-\frac{n}{2}|\geq \frac{n}{4}) = P(X\leq \frac{n}{4})\leq \frac{n/4}{n^2/16} =4/n</script><ul>
<li>运用 Chernoff 不等式给出事件 $X&lt;\frac{n}{4}$ 的概率上界</li>
</ul>
<script type="math/tex; mode=display">
P(X<(1-\frac{1}{2})\frac{n}{2})\leq \exp(-\frac{\frac{n}{2}\cdot \frac{1}{4}}{2}) =\exp(-\frac{n}{16})</script><h3 id="3"><a href="#3" class="headerlink" title="3"></a>3</h3><p>设一组独立随机变量 $X<em>i\sim Bernoulli(p)$ ,其中$i=1,\cdots,n$ ，令 $\overline X = \frac{1}{n}\sum</em>{i=1}^n X_i$ 试回答当$n$ 取多少时，使得</p>
<script type="math/tex; mode=display">
P(|\overline X-p|\leq \epsilon p)\geq 1-\delta</script><ol>
<li>首先，我们要改变符号</li>
</ol>
<script type="math/tex; mode=display">
P(|\overline X-p|>\epsilon p)<\delta</script><ol>
<li>同乘以n，得到：</li>
</ol>
<script type="math/tex; mode=display">
P(|\sum_{i=1}^n X_i-np|>\epsilon np)<\delta</script><ol>
<li>展开</li>
</ol>
<script type="math/tex; mode=display">
P(\sum_{i=1}^n X_i>(\epsilon+1) np)+P(\sum_{i=1}^nX_i<(1-\epsilon)np) <\delta</script><p>我们发现，式子左侧可以变成两个Chernoff 不等式</p>
<ol>
<li>利用切诺夫不等式进行放缩</li>
</ol>
<script type="math/tex; mode=display">
P(\sum_{i=1}^nX_i<(1-\epsilon)np)<\exp\{-\frac{np\epsilon^2}{2}\}\\
P(\sum_{i=1}^nX_i>(1+\epsilon)np)<\exp\{-\frac{np\epsilon^2}{3}\}</script><ol>
<li>反解</li>
</ol>
<script type="math/tex; mode=display">
\begin{align}
&2\exp\{-\frac{np\epsilon^2}{2}\}<\delta \\
&exp\{-\frac{np\epsilon^2}{2}\} <\frac \delta 2\\
&\frac{np\epsilon^2}{2}>\ln(\frac{2}{\delta})\\
&n>\frac{2\ln(2/\delta)}{p\epsilon^2}
\end{align}</script>
          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2021/09/14/%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80-%E6%8A%BD%E6%A0%B7%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/09/14/%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80-%E6%8A%BD%E6%A0%B7%E7%AE%97%E6%B3%95/" itemprop="url">数据科学算法基础-抽样算法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-09-14T22:02:27+08:00">
                2021-09-14
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2022-01-07T12:08:24+08:00">
                2022-01-07
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="抽样算法"><a href="#抽样算法" class="headerlink" title="抽样算法"></a>抽样算法</h1><p>在聊抽样算法之前，我们首先谈一下样本。</p>
<p>样本是总体的一个子集，对其进行观察以获得关于总体的信息。研究样本的目的在于得到有关总体的有效结论(概率论中学过，详见<a href="https://jasonxqh.github.io/2021/06/10/%E6%A6%82%E7%8E%87%E8%AE%BA%E7%AC%AC%E5%85%AD%E7%AB%A0/">参数估计博客</a>) </p>
<p>常见的抽样技术有：</p>
<ul>
<li>简单随机抽样</li>
<li>系统抽样</li>
<li>分层抽样</li>
<li>聚类抽样</li>
<li>多阶段抽样</li>
</ul>
<p>所有的这些方法都属于概率抽样</p>
<h2 id="常见抽样"><a href="#常见抽样" class="headerlink" title="常见抽样"></a>常见抽样</h2><h3 id="简单随机抽样"><a href="#简单随机抽样" class="headerlink" title="简单随机抽样"></a>简单随机抽样</h3><p>这是最简单的抽样算法。</p>
<p>在抽样过程中，若是有放回的抽样统计，那么选择每个对象的概率是相同的。</p>
<p>如果是无放回的抽样统计，在总体容量很大的时候，无放回抽样可以近似看做是等概率抽样。</p>
<p>方法： 令N 为总样本数，$X_i$ 为一随机变量。</p>
<script type="math/tex; mode=display">
X_i = \begin{cases} 1, ~~\text{第i个对象被选择}\\~\\0,~\text{否则}\end{cases}</script><p>其中$P(X_i=1)=p$​ ，为抽样率</p>
<h3 id="系统抽样"><a href="#系统抽样" class="headerlink" title="系统抽样"></a>系统抽样</h3><p><img src="/2021/09/14/%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80-%E6%8A%BD%E6%A0%B7%E7%AE%97%E6%B3%95/1.png" style="zoom:67%;"></p>
<p>假设我们要从容量为N的总体中抽取容量为n的样本，有两种系统抽样的策略：</p>
<h4 id="直线等距抽样"><a href="#直线等距抽样" class="headerlink" title="直线等距抽样"></a>直线等距抽样</h4><p>如果N能被n整除</p>
<ul>
<li>那么就可以确定样本大小n并计算<strong>跳跃间隔</strong> $k = \frac{N}{n}$</li>
<li>在1到k之间(包含1和K)随机选择一个起始点r。</li>
<li>然后，反复地在选定第$(r+k\cdot i)$ 个样本点，其中，$i = 1,2\cdots,n-1$</li>
</ul>
<p>相当于总体被分为n组，然后每组有k个样本，每个样本点被选择的概率为$\frac{1}{k}$ </p>
<p>在这种情况下，线性系统抽样方法是等概率的。</p>
<p>但N如果不能被n整除</p>
<ul>
<li>最后一组样本点个数不及k个</li>
<li>此时系统抽样就不是等概率的了。</li>
</ul>
<h4 id="循环系统抽样"><a href="#循环系统抽样" class="headerlink" title="循环系统抽样"></a>循环系统抽样</h4><ol>
<li><p>首先确定间隔 k, 使得 $k = \lfloor\frac{N}{n}\rfloor$</p>
</li>
<li><p>从1到N之间随机开始，选择第$(r+k\cdot i)/\mod N$，知道选择了n个样本为止。</p>
</li>
<li>因此，可能选择N个不同的样本集，而不是k个</li>
<li>在此时，这种抽样方法也是一种<strong>等概率抽样</strong>。</li>
</ol>
<p>系统抽样有以下优缺点：</p>
<ol>
<li>优点<ul>
<li>操作简单，容易取样</li>
<li>它使样本更均匀地分布在总体中</li>
<li>比简单随机抽样更有效，尤其是当列表中的样本点顺序与关注变量的特征无关时</li>
</ul>
</li>
<li>缺点<ul>
<li>一个不好的样本点排列可能会产生一个不具有代表性的样本集。比如我要统计公园一年来的客流量，那么如果起始点抽到了礼拜六，间隔又是一个礼拜，那么显然我采样得到的客流量要比平均客流量要多很多。</li>
<li>非严格等概率抽样，抽样误差计算复杂</li>
</ul>
</li>
</ol>
<h3 id="分层抽样"><a href="#分层抽样" class="headerlink" title="分层抽样"></a>分层抽样</h3><p>分层抽样是根据某种属性(比如性别、职称、院系、地域等)将总体分为多个不同的组。</p>
<p>然后，由满足分层变量值设定条件的样本点组成</p>
<p>这样做的好处是</p>
<ul>
<li>减少估计的标准误差</li>
<li>提供总体不同组别的单独估计(“域”估计)</li>
<li>对不同组别，可以使用不同的抽样方法并行地提高抽样效率</li>
</ul>
<h3 id="样本量分配方法"><a href="#样本量分配方法" class="headerlink" title="样本量分配方法"></a>样本量分配方法</h3><h2 id="水库抽样"><a href="#水库抽样" class="headerlink" title="水库抽样"></a>水库抽样</h2><p>水库抽样是一种针对流数据的高效等效率抽样方法</p>
<p>我们想象流数据应用场景：谷歌搜索引擎的关键词查询，电信骨干网络中转发的数据包。</p>
<p>那么如果想从流数据中抽取容量为1000的样本，怎么办？这是比较困难的，因为在流数据应用场景中，总体容量是无法事先知晓的。另外，可能需要随时返回样本。</p>
<p>现在，我们来介绍水库抽样：</p>
<p>首先，创建一个长度为1000的数组，作为水库。如果流数据不超过1000个元素，每个元素都存入该数组中。</p>
<p>那么，处理第i(i&gt;=1001)个元素，该如何做？</p>
<h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><p>设 $S = {59,100,2,30,63,\cdots}$ 且$k=3$</p>
<p>前k个项直接添加到水库中，即样本集合为 ${59,100,2}$</p>
<p>当第4个元素30到达时，程序会随机生成一个1到4之间的随机整数，假定生成随机数$x=4$, 因为 $x&gt;k$ ，则钙元素直接被忽略。</p>
<p>当第5个元素63到达时，程序会随机生成一个1到5之间的随机整数，假定生成随机数$x=2$，因为$x&lt;k$ ，元素63直接替换水库中的第2个元素100. 因此，最终的样本集合为${59,63,2}$</p>
<h4 id="分布式水库抽样方法"><a href="#分布式水库抽样方法" class="headerlink" title="分布式水库抽样方法"></a>分布式水库抽样方法</h4><p>假如说，利用多台机器，能否加快水库抽样的速度呢？水库抽样是否可以扩展成分布式算法呢？</p>
<p>我们可以在每台机器上维护同样大小的水库，分别执行水库抽样算法。然后，对每个水库的样本进行重抽样，逻辑如下：</p>
<p><img src="/2021/09/14/%E6%95%B0%E6%8D%AE%E7%A7%91%E5%AD%A6%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80-%E6%8A%BD%E6%A0%B7%E7%AE%97%E6%B3%95/2.png" style="zoom:67%;"></p>
<p>分布式水库抽样算法也非常高效，时间复杂度为$O(1)$</p>
<p>分布式水库抽样中，每个元素被重样的概率是相同的，且任意两个元素被抽样是相互独立的。</p>
<h2 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h2><h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><p>设总体有14个个体，按照1~14进行编号。欲以系统抽样法抽取容量为 $n=4$ 的样本，且第一个抽中的样本编号为1，则其余3个样本编号为多少？</p>
<p><strong>这是系统抽样问题</strong></p>
<p>首先，我们要计算间隔 $k = \lfloor \frac{14}{4} \rfloor = 3$  ，也就是要跳跃3个样本取下一个样本，因此取 $1,5,9,13$</p>
<h3 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h3><p>某校高一年级500名学生中，血型为O的有200人，血型为A的有125人，血型为B的有125人，血型为AB型的有50人．为了研究血型与色弱的关系，要从中抽取一个容量为40的样本，应如何抽样？写出血型为AB型的抽样过程．</p>
<p><strong>这是分层抽样算法</strong></p>
<p>首先，在500名学生中取40名样本，概率为 $\frac{2}{25}$ </p>
<p>所以，应用分层抽样法抽取</p>
<ul>
<li>血型为O型的： $\frac{2}{25}\times 200 = 16$ </li>
<li>血型为A型的: $\frac{2}{25}\times 125 = 10$</li>
<li>血型为B型的: $\frac{2}{25}\times 125 = 10$</li>
<li>血型为AB型的: $\frac{2}{25}\times 50 = 4$ </li>
</ul>
<p>AB型的4人可以这么抽取：</p>
<p>第一步：将50人随机编号，1~50</p>
<p>第二步：把以上50人的编号分别写在号签上</p>
<p>第三步：从袋子里抽取四个号签，找出对应的4人。</p>
<p>其余血型的人也可以用这种方法来抽取。</p>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2021/09/13/%E8%BD%AF%E4%BB%B6%E4%BC%98%E5%8C%96-%E5%AE%BE%E5%88%A9%E6%B3%95%E5%88%99/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/09/13/%E8%BD%AF%E4%BB%B6%E4%BC%98%E5%8C%96-%E5%AE%BE%E5%88%A9%E6%B3%95%E5%88%99/" itemprop="url">软件优化-宾利法则</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-09-13T11:35:33+08:00">
                2021-09-13
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2021-09-14T16:20:52+08:00">
                2021-09-14
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="软件优化-宾利法则"><a href="#软件优化-宾利法则" class="headerlink" title="软件优化-宾利法则"></a>软件优化-宾利法则</h1><p>现在我们来讲宾利法则，这个宾利不是车企，而是一个计算机学家。他提出了软件优化的若干法则。主要分为四个部分：数据结构，循环，逻辑，函数。每个部分又分为若干小点，现在我们来一一讲解</p>
<h2 id="Data-structures"><a href="#Data-structures" class="headerlink" title="Data structures"></a>Data structures</h2><h3 id="Packing-and-encoding-压缩和编码"><a href="#Packing-and-encoding-压缩和编码" class="headerlink" title="Packing and encoding 压缩和编码"></a>Packing and encoding 压缩和编码</h3><p>压缩的概念是用相同的机器语言表示尽可能多的数据，编码优化则是用尽可能少的bits去表示数据的值。</p>
<p>比如说，字符串”September 11,2018“ 能以18 bytes的大小被存储，这需要两个<code>double(64-bits) words</code> 才能放下。 这对于日期信息来说，是比较庞大的一段空间了。其实，要是计算公元前后4096年的日期，大概只要</p>
<script type="math/tex; mode=display">
\lceil\lg(365.25\times 8192)\rceil =22\text{bits}</script><p>就可以了，只需要 <code>single word(32-bit)</code> 就可以存储了</p>
<p>但是，修改了编码方式，并不意味着可以提升程序的性能。因为虽然空间上减少了很多。但是要计算得到这个编码，需要消耗更多的CPU性能，所以在这个情况下修改编码并不是一个很好地选择。</p>
<p>我们另辟蹊径，用另外一种数据结构来存储这些信息：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> year: <span class="number">13</span>;</span><br><span class="line">	<span class="keyword">int</span> month: <span class="number">4</span>;</span><br><span class="line">	<span class="keyword">int</span> day: <span class="number">5</span>;</span><br><span class="line">&#125; <span class="keyword">date_t</span>;</span><br></pre></td></tr></table></figure>
<p>用struct来存储这些信息，同样只要消耗22 bits(存储年份需要13位，一位表示公园前后)，但是计算速度要比上面那种编码快很多。</p>
<h3 id="Augmentation-扩充策略"><a href="#Augmentation-扩充策略" class="headerlink" title="Augmentation 扩充策略"></a>Augmentation 扩充策略</h3><p>有些时候，我们对一个普通的数据结构加上一些信息，来让数据结构做更少的计算。</p>
<p>比如说，现在有两个链表，我们需要将它们头尾相连：正常的方法是，我们要先找到一个链表的尾部，然后再将其连到一个拎一个链表的头部，如下图所示</p>
<p><img src="/2021/09/13/%E8%BD%AF%E4%BB%B6%E4%BC%98%E5%8C%96-%E5%AE%BE%E5%88%A9%E6%B3%95%E5%88%99/1.png" style="zoom:50%;"></p>
<p>但是，我们可以在链表中添加一点东西，比如说，在head节点添加一个tail指针，让其指向该链表的尾部。这样一来，就可以迅速地找到链表的尾部了，如下图所示：</p>
<p><img src="/2021/09/13/%E8%BD%AF%E4%BB%B6%E4%BC%98%E5%8C%96-%E5%AE%BE%E5%88%A9%E6%B3%95%E5%88%99/2.png" style="zoom:50%;"></p>
<h3 id="Precomputation-预计算"><a href="#Precomputation-预计算" class="headerlink" title="Precomputation 预计算"></a>Precomputation 预计算</h3><p>预计算就是在程序里面先将要算的值存储下来。比如说要计算二项式系数，我们可以用递归的方法来做：</p>
<p><img src="/2021/09/13/%E8%BD%AF%E4%BB%B6%E4%BC%98%E5%8C%96-%E5%AE%BE%E5%88%A9%E6%B3%95%E5%88%99/3.png" style="zoom:50%;"></p>
<p>但是递归可能会消耗很多CPU性能，因此我们可以使用动态规划的方法，将预计算得到的值存储起来，如下面的代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">define</span> CHOOSE_SIZE 100</span></span><br><span class="line"><span class="keyword">int</span> choose[CHOOSE_SIZE][CHOOSE_SIZE];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init_choose</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> n = <span class="number">0</span>;n &lt; CHOOSE_SIZE ;n++)&#123;</span><br><span class="line">		choose[n][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">		choose[n][n] = <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(<span class="keyword">int</span> n = <span class="number">1</span>;n &lt; CHOOSE_SIZE; ++n)&#123;</span><br><span class="line">		choose[<span class="number">0</span>][n] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>;k&lt;n;++k)&#123;</span><br><span class="line">			choose[n][k] = choose[n<span class="number">-1</span>][k<span class="number">-1</span>]+choose[n<span class="number">-1</span>][k];</span><br><span class="line">			choose[k][n] = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/09/13/%E8%BD%AF%E4%BB%B6%E4%BC%98%E5%8C%96-%E5%AE%BE%E5%88%A9%E6%B3%95%E5%88%99/4.png" style="zoom:50%;"></p>
<p>使用了动态规划以后，我们就不用做很深的递归了，只要在数组中取数即可。只要数组规模小于100x100即可</p>
<h3 id="Compile-time-initialization-编译时初始化"><a href="#Compile-time-initialization-编译时初始化" class="headerlink" title="Compile-time initialization 编译时初始化"></a>Compile-time initialization 编译时初始化</h3><p>编译时初始化就是在编译时存储一些常量，这样就可以减少计算的次数。还是以上面的pascal三角形为例，我们可以直接将二维数组存储起来。</p>
<p><img src="/2021/09/13/%E8%BD%AF%E4%BB%B6%E4%BC%98%E5%8C%96-%E5%AE%BE%E5%88%A9%E6%B3%95%E5%88%99/5.png" style="zoom:50%;"></p>
<h4 id="元编程"><a href="#元编程" class="headerlink" title="元编程"></a>元编程</h4><p>还有一种预计算的方法就是元编程(metaprogramming)。先看看 meta-data：</p>
<p>「我的电话是 +86 123 4567 8910」<br>  ——这是一条数据；<br>「+86 123 4567 8910 有十三个数字和一个字符，前两位是国家代码，后面是一个移动电话号码」   —— 这是关于前面那条数据的数据。</p>
<p>那么照猫画虎，怎样才算 meta-programming 呢？泛泛来说，只要是与编程相关的编程就算是 meta-programming 了——比如，若编程甲可以输出 A - Z，那么写程序甲算「编程」；而程序乙可以<strong>生成</strong>程序甲（也许还会连带着运行它输出 A - Z），那么编写程序乙的活动，就可以算作 meta-programming，「元编程」。注意，程序甲和程序乙并不一定是同一种语言.</p>
<p>比如说，要生成一张C语言的二维数组，可以这么编写C语言：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	init_choose();</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"int choose[10][10] = &#123;\n"</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> a = <span class="number">0</span>; a &lt; <span class="number">10</span>;++a)&#123;</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">" &#123;"</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> b = <span class="number">0</span>;b &lt; <span class="number">10</span>;++b)&#123;</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">"%3d, "</span>,choose[a][b]);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"&#125;,\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">"&#125;;\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Caching-缓存"><a href="#Caching-缓存" class="headerlink" title="Caching 缓存"></a>Caching 缓存</h3><p>缓存的想法就是将最近访问过的数据放到内存里，这样再次访问时就可以快速从内存里取出，而不用到磁盘里面去找。比如说求平方根的一个函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">hypotenuse</span><span class="params">(<span class="keyword">double</span> A,<span class="keyword">double</span> B)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">sqrt</span>(A*A+B*B);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以写成是</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">double</span> cached_A = <span class="number">0.0</span>;</span><br><span class="line"><span class="keyword">double</span> cached_B = <span class="number">0.0</span>;</span><br><span class="line"><span class="keyword">double</span> cached_C = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">double</span> <span class="title">hypotenuse</span><span class="params">(<span class="keyword">double</span> A,<span class="keyword">double</span> B)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (A == cached_A &amp;&amp; B == cashed_B)&#123;</span><br><span class="line">		<span class="keyword">return</span> cached_h;</span><br><span class="line">	&#125;</span><br><span class="line">	cached_A = A;</span><br><span class="line">	cached_B = B;</span><br><span class="line">	cached_h = <span class="built_in">sqrt</span>(A*A + B*B);</span><br><span class="line">	<span class="keyword">return</span> cached_h;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果缓存能有2/3的概率击中的话，那么就可以第一种方法快30%。但是这种缓存也不是很好，毕竟在现实情况下能击中的概率是很低的，还要进行判断等操作，弄不好就会得不偿失。</p>
<h3 id="Sparsity-稀疏"><a href="#Sparsity-稀疏" class="headerlink" title="Sparsity 稀疏"></a>Sparsity 稀疏</h3><h4 id="稀疏矩阵的存储"><a href="#稀疏矩阵的存储" class="headerlink" title="稀疏矩阵的存储"></a>稀疏矩阵的存储</h4><p>比如我们要做矩阵-向量乘法，如下：</p>
<p><img src="/2021/09/13/%E8%BD%AF%E4%BB%B6%E4%BC%98%E5%8C%96-%E5%AE%BE%E5%88%A9%E6%B3%95%E5%88%99/6.png" style="zoom:50%;"></p>
<p>如果我们就这样计算，那么需要计算36次乘法，还要很多次加法。但事实上我们看到系数矩阵有很多的值都是0，有效值只有14个，因此我们可以对其进行压缩。</p>
<p>我们采取CSR的方法，将稀疏矩阵变成这样的形式：</p>
<p><img src="/2021/09/13/%E8%BD%AF%E4%BB%B6%E4%BC%98%E5%8C%96-%E5%AE%BE%E5%88%A9%E6%B3%95%E5%88%99/7.png" style="zoom:50%;"></p>
<p>也就是说，采用三个一维数组来存储二维矩阵中的所有非零元素。这三个数组分别为：rows，cols和values。</p>
<ul>
<li>value数组存储所有的非零元素</li>
<li>column 数组存储所有非零元素的列下标</li>
<li>row 数组存储所有的非零数组的行下标。最原始的存储方式就是：<code>[0,0,1,1,1,1,2,2,3,3,4,5,5,5]</code>。 但是，我们通过row行可以看到，很多重复的数值，也就是每一行的多个元素，每个元素都对应着同样的行号，这样也浪费的空间，因此，我们引入csr稀疏矩阵存储方式，该存储方式将重复的行号压缩，只记录，开头和结尾元素的位置，也就变成了 <code>[0,2,6,8,10,11,14]</code></li>
</ul>
<p>其中，nnz就是整个稀疏矩阵中非零值的个数。 </p>
<p>这样，存储的空间复杂度就从$O(n^2)$ 变成了 $O(n+nnz)$ ，在n很大的时候，可以有效地减小复杂度。</p>
<p>代码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> n ,nnz;</span><br><span class="line">	<span class="keyword">int</span> *rows;			<span class="comment">// length n</span></span><br><span class="line">	<span class="keyword">int</span> *cols;			<span class="comment">// length nnz</span></span><br><span class="line">	<span class="keyword">double</span> *vals;		<span class="comment">// length nnz</span></span><br><span class="line">&#125; <span class="keyword">sparse_matrix_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">spmv</span><span class="params">(<span class="keyword">sparse_matrix_t</span> *A,<span class="keyword">double</span> *x,<span class="keyword">double</span> *y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt; A-&gt; n ; i++)&#123;</span><br><span class="line">		y[i] = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> k = A-&gt; row[i];k&lt;A-&gt;rows[i+<span class="number">1</span>];k++)&#123;</span><br><span class="line">			<span class="keyword">int</span> j = A-&gt;cols[k];</span><br><span class="line">			y[i] += A-&gt;vals[k]*x[j];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="稀疏图的存储"><a href="#稀疏图的存储" class="headerlink" title="稀疏图的存储"></a>稀疏图的存储</h4><p>在数据结构中，通常会用矩阵来存储图。如果这个图的边很少，那么显然这个矩阵就是一个稀疏矩阵了。因此，我们可以用CSR的方法来存稀疏图。如下图所示：</p>
<p><img src="/2021/09/13/%E8%BD%AF%E4%BB%B6%E4%BC%98%E5%8C%96-%E5%AE%BE%E5%88%A9%E6%B3%95%E5%88%99/8.png" style="zoom:50%;"></p>
<ul>
<li><p>节点0出来，指向1、3</p>
</li>
<li><p>节点1出来，指向2、3、4</p>
</li>
<li><p>节点2没有出度</p>
</li>
<li><p>节点3出来，指向2</p>
</li>
<li><p>节点4出来，指向2</p>
<p>如果这个边有权重的话，可以再添加一个和Edges长度一样的数组，记录每条边的权重。 </p>
</li>
</ul>
<h2 id="Logic"><a href="#Logic" class="headerlink" title="Logic"></a>Logic</h2><h3 id="Constant-folding-and-propagation-常量折叠与常量传播"><a href="#Constant-folding-and-propagation-常量折叠与常量传播" class="headerlink" title="Constant folding and propagation 常量折叠与常量传播"></a>Constant folding and propagation 常量折叠与常量传播</h3><p>常量折叠与常量传播的想法就是在编译的过程中，用常量表达式去替换在代码中要用到的表达式。</p>
<p>比如下面几个例子，我们已经申请了一系列常量</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">orrery</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">double</span> radius = <span class="number">6371000.0</span>;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">double</span> diameter = <span class="number">2</span>*radius;</span><br><span class="line">	<span class="keyword">const</span> <span class="keyword">double</span> circumference = M_PI * disameter;</span><br><span class="line">	<span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>多数的现代编译器不会真的产生计算的指令再将结果储存下来，取而代之的，他们会辨识出语句的结构，并在编译时期将数值计算出来（在这个例子，在处理diameter的时候，就会直接计算得到其值为12742000）</p>
<h3 id="Common-subexpression-elimination-公共子表达式消除"><a href="#Common-subexpression-elimination-公共子表达式消除" class="headerlink" title="Common-subexpression elimination 公共子表达式消除"></a>Common-subexpression elimination 公共子表达式消除</h3><p>公共子表达式消除是一项启发式的查询转换技术，它将反意连接词（如 OR）连接的谓词进行合并，消除不必要的子表达式。如果两个表达式等价但是复杂度不一样，我们就可以用低复杂度的表达式替换掉高复杂度的表达式</p>
<p>任何一个编译器都遵循两个原则：语义等价原则和保守原则。保守原则是说，如果不能确定能不能做，那么编译器就不会去做。</p>
<p>那么我们看到这个例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = b+c;											a = b+c;</span><br><span class="line">b = a-d;						——&gt;				b = a-d;</span><br><span class="line">c = b+c;						——&gt; 			c = b+c;</span><br><span class="line">d = a-d;											d = b;</span><br></pre></td></tr></table></figure>
<p>我们可以用赋值语句替换掉原来的加运算。这样可以减少cpu的计算次数。但是要注意，在上例中第三句不能写成是<code>c=a</code>因为在第二句中，b的值进行了修改。</p>
<h3 id="Algebraic-identities-代数恒等式"><a href="#Algebraic-identities-代数恒等式" class="headerlink" title="Algebraic identities 代数恒等式"></a>Algebraic identities 代数恒等式</h3><p>代数恒等式的想法就是将代数等价的低复杂度表达式替换掉高复杂度的式子。</p>
<p>比如说，我要判断两个圆形是否相交，原始的代码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">	<span class="keyword">double</span> x;			<span class="comment">// x-coordinate</span></span><br><span class="line">	<span class="keyword">double</span> y;			<span class="comment">// y-coordinate</span></span><br><span class="line">	<span class="keyword">double</span> z;			<span class="comment">// z-coordinate</span></span><br><span class="line">	<span class="keyword">double</span> r;			<span class="comment">// radius of ball</span></span><br><span class="line">&#125; <span class="keyword">ball_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">square</span><span class="params">(<span class="keyword">double</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x*x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">collides</span><span class="params">(<span class="keyword">ball_t</span> *b1, <span class="keyword">ball_t</span> *b2)</span></span>&#123;</span><br><span class="line">	<span class="keyword">double</span> d = <span class="built_in">sqrt</span>(square(b1-&gt;x-b2-&gt;x)+square(b1-&gt;y - b2-&gt;y)+square(b1-&gt;z-b2-&gt;z));</span><br><span class="line">	<span class="keyword">return</span> d &lt;= b1-&gt;r + b2-&gt;r;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也就是判断一下是否两个球圆心之间的距离是否大于两个球的半径之和。若大于说明未相交，反之则相交</p>
<p>但是这样的代数式比较复杂的，因为sqrt函数会消耗更大的计算机新能。因为$\sqrt u\leq v \text{~~~完全等价于} ~~u\leq v^2$我们可以用更简单的代数恒等式来替代上面这个逻辑：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">	<span class="keyword">double</span> x;			<span class="comment">// x-coordinate</span></span><br><span class="line">	<span class="keyword">double</span> y;			<span class="comment">// y-coordinate</span></span><br><span class="line">	<span class="keyword">double</span> z;			<span class="comment">// z-coordinate</span></span><br><span class="line">	<span class="keyword">double</span> r;			<span class="comment">// radius of ball</span></span><br><span class="line">&#125; <span class="keyword">ball_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">square</span><span class="params">(<span class="keyword">double</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x*x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">collides</span><span class="params">(<span class="keyword">ball_t</span> *b1, <span class="keyword">ball_t</span> *b2)</span></span>&#123;</span><br><span class="line">	<span class="keyword">double</span> d =  square(b1-&gt;x-b2-&gt;x)+square(b1-&gt;y - b2-&gt;y)+square(b1-&gt;z-b2-&gt;z) ;</span><br><span class="line">	<span class="keyword">return</span> d &lt;= square(b1-&gt;r + b2-&gt;r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Short-circuiting-抄近路"><a href="#Short-circuiting-抄近路" class="headerlink" title="Short-circuiting 抄近路"></a>Short-circuiting 抄近路</h3><p>Short-circuiting 的想法是当我知道了答案以后，我们就没必要把整套逻辑都做完，直接返回答案即可</p>
<p>比如说：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="comment">//All elements of A are nonnegative</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">sum_exceeds</span><span class="params">(<span class="keyword">int</span> *A,<span class="keyword">int</span> n,<span class="keyword">int</span> limit)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">		sum += A[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> sum &gt; limit;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以把最后的判断逻辑放到循环里面，一旦发现sum大于limit，直接跳出循环返回，如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="comment">//All elements of A are nonnegative</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">sum_exceeds</span><span class="params">(<span class="keyword">int</span> *A,<span class="keyword">int</span> n,<span class="keyword">int</span> limit)</span></span>&#123;</span><br><span class="line">	<span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">		sum += A[i];</span><br><span class="line">		<span class="keyword">if</span> (sum &gt; limit) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是这两个程序都存在明显的逻辑漏洞。因为整数相加后有溢出的风险。</p>
<p>同样的，修改了这个逻辑之后，也不一定会拿到好处。因为我们在每一次循环中都要做if判断，如果前面很多数都很小，没有到达limit，那么程序就会一直执行if判断，运行速度反而会变慢。</p>
<h3 id="Ordering-tests-判断条件的顺序"><a href="#Ordering-tests-判断条件的顺序" class="headerlink" title="Ordering tests 判断条件的顺序"></a>Ordering tests 判断条件的顺序</h3><p>我们知道代码是根据顺序逻辑执行的。 Ordering tests的思想是在很少成功的case之前执行那些更经常“成功”的case（测试选择了特定的替代方案）。同样，代价少的测试应该先于代价高的测试。比如说下面这个例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">is_whitespace</span><span class="params">(<span class="keyword">char</span> c)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (c == <span class="string">'\r'</span> || c==<span class="string">'\t'</span> || c==<span class="string">' '</span>||c == <span class="string">'\n'</span>)&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在一篇文章里面，最常见的肯定是空格，换行回车符是比较少的。若采用上面这个策略，那么大多数字符要经过前两个比较才能成功判断为空格并退出判断。因此我们可以修改case的顺序：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">is_whitespace</span><span class="params">(<span class="keyword">char</span> c)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (c == <span class="string">' '</span> || c==<span class="string">'\r'</span> || c==<span class="string">'\t'</span>||c == <span class="string">'\n'</span>)&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样大多数字符已进入if-case就会落入<code>c==&#39; &#39;</code>的判断并跳出判断，节省了判断次数 </p>
<h3 id="Creating-a-fast-path"><a href="#Creating-a-fast-path" class="headerlink" title="Creating a fast path"></a>Creating a fast path</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">	<span class="keyword">double</span> x;			<span class="comment">// x-coordinate</span></span><br><span class="line">	<span class="keyword">double</span> y;			<span class="comment">// y-coordinate</span></span><br><span class="line">	<span class="keyword">double</span> z;			<span class="comment">// z-coordinate</span></span><br><span class="line">	<span class="keyword">double</span> r;			<span class="comment">// radius of ball</span></span><br><span class="line">&#125; <span class="keyword">ball_t</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">square</span><span class="params">(<span class="keyword">double</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x*x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">collides</span><span class="params">(<span class="keyword">ball_t</span> *b1, <span class="keyword">ball_t</span> *b2)</span></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (</span><br><span class="line">	(<span class="built_in">abs</span>(b1-&gt;x - b2-&gt;x)&gt;(b1-&gt;r + b2-&gt;r))||</span><br><span class="line">	(<span class="built_in">abs</span>(b1-&gt;y - b2-&gt;y)&gt;(b1-&gt;r + b2-&gt;r))||</span><br><span class="line">	(<span class="built_in">abs</span>(b1-&gt;z - b2-&gt;z)&gt;(b1-&gt;r + b2-&gt;r))</span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">double</span> d =  square(b1-&gt;x-b2-&gt;x)+square(b1-&gt;y - b2-&gt;y)+square(b1-&gt;z-b2-&gt;z) ;</span><br><span class="line">	<span class="keyword">return</span> d &lt;= square(b1-&gt;r + b2-&gt;r);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Combining-tests"><a href="#Combining-tests" class="headerlink" title="Combining tests"></a>Combining tests</h3><p>Combining tests的想法就是用一个if-case或者switch case 来替换多分支的if判断</p>
<p>比如我们要实现下面这张逻辑表。用if-case 来写，会非常非常复杂：</p>
<p><img src="/2021/09/13/%E8%BD%AF%E4%BB%B6%E4%BC%98%E5%8C%96-%E5%AE%BE%E5%88%A9%E6%B3%95%E5%88%99/9.png" style="zoom:50%;"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">full_add</span> <span class="params">(	<span class="keyword">int</span> a,</span></span></span><br><span class="line"><span class="function"><span class="params">								<span class="keyword">int</span> b,</span></span></span><br><span class="line"><span class="function"><span class="params">								<span class="keyword">int</span> c,</span></span></span><br><span class="line"><span class="function"><span class="params">								<span class="keyword">int</span> *sum,</span></span></span><br><span class="line"><span class="function"><span class="params">								<span class="keyword">int</span> *carry)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>( a == <span class="number">0</span>)&#123;</span><br><span class="line">			<span class="keyword">if</span>(b == <span class="number">0</span>)&#123;</span><br><span class="line">				<span class="keyword">if</span>(c == <span class="number">0</span>)&#123;</span><br><span class="line">					*sum = <span class="number">0</span>;</span><br><span class="line">					*carry = <span class="number">0</span>;</span><br><span class="line">				&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">					*sum = <span class="number">1</span>;</span><br><span class="line">					*carry = <span class="number">0</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">if</span>(c == <span class="number">0</span>)&#123;</span><br><span class="line">					*sum = <span class="number">1</span>;</span><br><span class="line">					*carry = <span class="number">0</span>;</span><br><span class="line">				&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">					*sum = <span class="number">0</span>;</span><br><span class="line">					*carry = <span class="number">1</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">if</span>(b == <span class="number">0</span>)&#123;</span><br><span class="line">					<span class="keyword">if</span>(c == <span class="number">0</span>)&#123;</span><br><span class="line">						*sum = <span class="number">1</span>;</span><br><span class="line">						*carry = <span class="number">0</span>;</span><br><span class="line">					&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">						*sum = <span class="number">0</span>;</span><br><span class="line">						*carry = <span class="number">1</span>;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="keyword">if</span> (c == <span class="number">0</span>)&#123;</span><br><span class="line">						*sum = <span class="number">0</span>;</span><br><span class="line">						*carry = <span class="number">1</span>;</span><br><span class="line">					&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">						*sum = <span class="number">1</span>；</span><br><span class="line">						*carry = <span class="number">1</span>；</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为计算机会进行预测，会把预测得到的结果拿到内存里，但是这样的预测的正确性是很低的，因此会导致执行效率大大降低。为了解决这个问题，我们可以采用switch-case</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">full_add</span> <span class="params">(	<span class="keyword">int</span> a,</span></span></span><br><span class="line"><span class="function"><span class="params">								<span class="keyword">int</span> b,</span></span></span><br><span class="line"><span class="function"><span class="params">								<span class="keyword">int</span> c,</span></span></span><br><span class="line"><span class="function"><span class="params">								<span class="keyword">int</span> *sum,</span></span></span><br><span class="line"><span class="function"><span class="params">								<span class="keyword">int</span> *carry)</span></span>&#123;</span><br><span class="line">			<span class="keyword">int</span> <span class="built_in">text</span> = ((a==<span class="number">1</span>)&lt;&lt;<span class="number">2</span>)((b == <span class="number">1</span>)&lt;&lt;<span class="number">1</span>)(c == <span class="number">1</span>);</span><br><span class="line">			<span class="keyword">switch</span>(<span class="built_in">text</span>)&#123;</span><br><span class="line">				<span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">					*sum = <span class="number">0</span>;</span><br><span class="line">					*carry = <span class="number">0</span>;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">					*sum = <span class="number">1</span>;</span><br><span class="line">					*carrt = <span class="number">0</span>;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">					*sum = <span class="number">1</span>;</span><br><span class="line">					*carrt = <span class="number">0</span>;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">					*sum = <span class="number">0</span>;</span><br><span class="line">					*carrt = <span class="number">1</span>;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">					*sum = <span class="number">1</span>;</span><br><span class="line">					*carrt = <span class="number">0</span>;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">					*sum = <span class="number">0</span>;</span><br><span class="line">					*carrt = <span class="number">1</span>;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">					*sum = <span class="number">0</span>;</span><br><span class="line">					*carrt = <span class="number">1</span>;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				<span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">					*sum = <span class="number">1</span>;</span><br><span class="line">					*carrt = <span class="number">1</span>;</span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Loops"><a href="#Loops" class="headerlink" title="Loops"></a>Loops</h2><h3 id="Hoisting"><a href="#Hoisting" class="headerlink" title="Hoisting"></a>Hoisting</h3><p>hoisting 也叫做循环不变式的代码移动，就是将循环中不变的式子移动到循环外。这样就不用每次循环都进行计算了。比如下面这个例子：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">scale</span><span class="params">(<span class="keyword">double</span> *X,<span class="keyword">double</span> *Y,<span class="keyword">int</span> N)</span></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;N;i++)&#123;</span><br><span class="line">		Y[i] = X[i]*<span class="built_in">exp</span>(<span class="built_in">sqrt</span>(M_PI/<span class="number">2</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们发现这个 <code>exp(sqrt(M_PI/2))</code>是一个不变的量，但是放在循环里面每次都要计算一遍，很浪费，所以可以这样改</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="meta-keyword">include</span> <span class="meta-string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">scale</span><span class="params">(<span class="keyword">double</span> *X,<span class="keyword">double</span> *Y,<span class="keyword">int</span> N)</span></span>&#123;</span><br><span class="line">	<span class="keyword">double</span> factor = <span class="built_in">exp</span>(<span class="built_in">sqrt</span>(M_PI/<span class="number">2</span>))</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;N;i++)&#123;</span><br><span class="line">		Y[i] = X[i]*factor;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Sentinels-哨兵"><a href="#Sentinels-哨兵" class="headerlink" title="Sentinels  哨兵"></a>Sentinels  哨兵</h3><p>哨兵是一些在数据结构中的dummy value，用来简化边界条件的一些逻辑。</p>
<p>这是一个判断是否溢出的程序，如果sum变成了负数，说明溢出了，那么返回真。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#includer <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">overflow</span> <span class="params">(<span class="keyword">int64_t</span> *A, <span class="keyword">size_t</span> n)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// All elements of A are nonnegative</span></span><br><span class="line">  <span class="keyword">int64_t</span> sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( <span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; n; ++i ) &#123;</span><br><span class="line">    sum += A[i];</span><br><span class="line">    <span class="keyword">if</span> ( sum &lt; A[i] ) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们对这个程序进行优化，如果说sum加到最后发现小于<code>A[i]</code>了，说明溢出了，这时候i肯定是小于n的，所以返回true；如果加到<code>A[n-1]</code>之后，没有溢出，那么下一次就落入<code>sum &lt;= A[n]</code>的判断，必为真，此时i=n返回false</p>
<p>我们需要给这个程序添加一个哨兵，也就是 <code>A[n+1]=1</code> ，为了防止 <code>A[0]</code>到<code>A[n-1]</code>都是0的情况。否则加到<code>A[n]</code>后无法跳出循环，设定 <code>A[n+1]=1</code> 是为了<code>sum=INT64_MAX</code>之后再+1变为负值，跳出循环</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#includer <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="comment">//  Assumes that A[n] and A[n+1] exist and can be clobbered</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">overflow</span> <span class="params">(<span class="keyword">int64_t</span> *A, <span class="keyword">size_t</span> n)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// All elements of A are nonnegative</span></span><br><span class="line">  A[n] = INT64_MAX;</span><br><span class="line">  A[n+<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">size_t</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">int64_t</span> sum = A[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">while</span>( sum &gt;= A[i])&#123;</span><br><span class="line">  	sum += A[++i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (i &lt;n) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Loop-unrolling-循环展开"><a href="#Loop-unrolling-循环展开" class="headerlink" title="Loop unrolling 循环展开"></a>Loop unrolling 循环展开</h3><p>循环展开尝试在一次迭代中执行多次迭代的内容。因此可以减少迭代的次数，因为迭代的过程需要消耗更多的机器指令。并且能让编译器优化更多内容。</p>
<p>但是，也不要展开太多。否则会导致指令缓存的滥用。因此，我们有两种展开方式，全展开和部分展开</p>
<h4 id="Full-Loop-unrolling"><a href="#Full-Loop-unrolling" class="headerlink" title="Full Loop unrolling"></a>Full Loop unrolling</h4><p>所有循环展开对于次数不多的循环是有效的，比如：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">	sum += A[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以换成：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">sum += A[<span class="number">0</span>];</span><br><span class="line">sum += A[<span class="number">1</span>];</span><br><span class="line">sum += A[<span class="number">2</span>];</span><br><span class="line">sum += A[<span class="number">3</span>];</span><br><span class="line">sum += A[<span class="number">4</span>];</span><br><span class="line">sum += A[<span class="number">5</span>];</span><br><span class="line">sum += A[<span class="number">6</span>];</span><br><span class="line">sum += A[<span class="number">7</span>];</span><br><span class="line">sum += A[<span class="number">8</span>];</span><br><span class="line">sum += A[<span class="number">9</span>];</span><br><span class="line">sum += A[<span class="number">10</span>];</span><br></pre></td></tr></table></figure>
<h4 id="Partial-Loop-unrolling"><a href="#Partial-Loop-unrolling" class="headerlink" title="Partial Loop unrolling"></a>Partial Loop unrolling</h4><p>部分循环展开更好一些，我们可以这样写：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> j ;</span><br><span class="line"><span class="keyword">for</span>(j = <span class="number">0</span>;j &lt; n<span class="number">-3</span>;j+=<span class="number">4</span>)&#123;</span><br><span class="line">	sum += A[j];</span><br><span class="line">	sum += A[j+<span class="number">1</span>];</span><br><span class="line">	sum += A[j+<span class="number">2</span>];</span><br><span class="line">	sum += A[j+<span class="number">3</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = j ; i&lt; n;++i)&#123;</span><br><span class="line">	sum += A[i]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Loop-fusion-循环融合"><a href="#Loop-fusion-循环融合" class="headerlink" title="Loop fusion 循环融合"></a>Loop fusion 循环融合</h3><p>Loop fusion是将循环次数相同的若干循环给放到一个循环当中，同样是用来减少循环次数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;n;++i)&#123;</span><br><span class="line">	C[i] = (A[i] &lt;= B[i])? A[i]:B[i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;n;++i)&#123;</span><br><span class="line">	D[i] = (A[i] &lt;= B[i])? B[i]:A[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以把上述两个循环合并</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;n;++i)&#123;</span><br><span class="line">	C[i] = (A[i] &lt;= B[i])? A[i]:B[i];</span><br><span class="line">	D[i] = (A[i] &lt;= B[i])? B[i]:A[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Eliminating-wasted-iteration"><a href="#Eliminating-wasted-iteration" class="headerlink" title="Eliminating wasted iteration"></a>Eliminating wasted iteration</h3><p>消除多余迭代同样是要减少迭代的次数。比如说在下面这个例子中，我们可以将双重循环和ifcase结合起来</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;n; ++i)&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>;j &lt; n; ++j)&#123;</span><br><span class="line">		<span class="keyword">if</span>(i &gt; j)&#123;</span><br><span class="line">			<span class="keyword">int</span> temp = A[i][j];</span><br><span class="line">			A[i][j] = A[j][i];</span><br><span class="line">			A[j][i] = temp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以写成是：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>;i &lt; n;++i)&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>;j&lt;i;++j)&#123;</span><br><span class="line">		<span class="keyword">int</span> temp = A[i][j];</span><br><span class="line">		A[i][j] = A[j][i];</span><br><span class="line">		A[j][i] = temp;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h2><h3 id="Inlining-内联函数"><a href="#Inlining-内联函数" class="headerlink" title="Inlining 内联函数"></a>Inlining 内联函数</h3><p>内联函数也是在编译上下功夫，和宏不一样，宏是直接替换代码，不做语义上的检测。但是内联函数的话，编译器会在编译时进行语义上的检测，比用宏更加安全。</p>
<p>比如说：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">square</span> <span class="params">(<span class="keyword">double</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x*x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">sum_of_squares</span> <span class="params">(<span class="keyword">double</span> *A,<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">	<span class="keyword">double</span> sum = <span class="number">0.0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;n;++i)&#123;</span><br><span class="line">		sum += square(A[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以将square变成内联函数，可以在编译时进行替换。减少调用所花费的指令</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">double</span> <span class="keyword">inline</span> <span class="title">square</span> <span class="params">(<span class="keyword">double</span> x)</span></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x*x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Tail-recursion-elimination"><a href="#Tail-recursion-elimination" class="headerlink" title="Tail-recursion elimination"></a>Tail-recursion elimination</h3><h3 id="Coarsening-recursion"><a href="#Coarsening-recursion" class="headerlink" title="Coarsening recursion"></a>Coarsening recursion</h3>
          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2021/09/10/%E5%8D%95%E5%9B%A0%E5%AD%90%E6%96%B9%E5%B7%AE%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/09/10/%E5%8D%95%E5%9B%A0%E5%AD%90%E6%96%B9%E5%B7%AE%E5%88%86%E6%9E%90/" itemprop="url">单因子方差分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-09-10T08:13:39+08:00">
                2021-09-10
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2022-01-05T10:44:02+08:00">
                2022-01-05
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="单因子方差分析"><a href="#单因子方差分析" class="headerlink" title="单因子方差分析"></a>单因子方差分析</h1><h2 id="Review-二样本独立t检验"><a href="#Review-二样本独立t检验" class="headerlink" title="Review:二样本独立t检验"></a>Review:二样本独立t检验</h2><p>首先我们复习一下<strong>二样本独立t检验</strong>，因为这时单因子方差分析的一种特殊情况。</p>
<p>目的： 比较两个<strong>方差相等</strong>的独立正态分布的均值是否相等。</p>
<p>数据：</p>
<script type="math/tex; mode=display">
\text{样本1:~~}x_{11},x_{12},\cdots,x_{1m_1}\\
\text{样本2:~~}x_{21},x_{22},\cdots,x_{2m_2}</script><p>假定$x_{ij}$是独立的随机变量，其分布为 $N(\mu_i,\sigma^2)$,那么</p>
<ul>
<li>$\mu_i$ 表示第 i 组的总体均值</li>
<li>$\sigma^2$ 表示总体方差，是一个未知常数</li>
<li>$i=1,2$</li>
<li>$j=1,2\cdots,m$ </li>
</ul>
<p>我们的假设检验问题是：</p>
<script type="math/tex; mode=display">
H_0:\mu_1 = \mu_2 ~~vs~~ H_1:\mu_1\neq\mu_2</script><p>随后我们构造检验统计量t。检验统计量可以用枢轴量法导出来：</p>
<p><strong>第一步</strong>： 求 $\theta$ 的点估计 $\hat\theta=\overline x-\overline y = \mu_1-\mu_2$</p>
<p><strong>第二步：</strong>  $\overline x\sim N(\mu_1,\frac{\sigma^2}{m}),\overline y \sim N(\mu_2,\frac{\sigma^2}{n})$​ </p>
<script type="math/tex; mode=display">
\hat\theta = \overline x-\overline y \sim N(\mu_1-\mu_2,(\frac1m+\frac1n)\sigma^2)</script><p><strong>第三步</strong> 标准化</p>
<script type="math/tex; mode=display">
\frac{\overline x-\overline y-\theta}{\sqrt{(\frac1m+\frac1n)\sigma^2}}\sim N(0,1)</script><p>显然这并不是一个枢轴量，因为存在位置变量$\sigma^2$ ,我们需要把 $\sigma^2$​ 换成样本方差。</p>
<p> <strong>第四步：</strong></p>
<p>那么在两样本的时候由于样本量是不同的，样本方差就要用合方差来替换：</p>
<script type="math/tex; mode=display">
\hat\sigma^2 = s_w^2 = (\frac{1}{m_1+m_2-2})^{-1}((m_1-1)s_1^2+(m_2-1)s_2^2))</script><p>可以看做是$s_1^2$和$s_2^2$​​​的加权平均数。检验统计量可以写为：</p>
<script type="math/tex; mode=display">
\frac{\overline x-\overline y-\theta}{s_w\sqrt{(\frac1m+\frac1n)}}</script><p>又因为：</p>
<script type="math/tex; mode=display">
\frac{(m_1-1)s_x^2+(m_2-1)s_y^2}{\sigma^2}\sim\mathcal{X}^2(m_1+m_2-2)</script><p>所以当满足$H_0$ 成立时，</p>
<script type="math/tex; mode=display">
t = \frac{\overline x-\overline y}{s_w\sqrt{(\frac1{m_1}+\frac1{m_2})}}\sim t(m_1+m_2-2)</script><p>当$m_1=m_2=m$​ 时，检验统计量可简化为：检验统计量t服从自由度为$2(m-1)$ </p>
<script type="math/tex; mode=display">
t = \frac{\overline x-\overline y}{\sqrt{\frac{1}{m}(s_1^2+s_2^2)}}\sim t(m_1+m_2-2)</script><h3 id="拒绝域法"><a href="#拒绝域法" class="headerlink" title="拒绝域法"></a>拒绝域法</h3><p>我们令：</p>
<script type="math/tex; mode=display">
W = \{|t|\geq t_{1-\alpha/2}(2(m-1))\}</script><p>$t_\alpha(2(m-1))$   为自由度为$2(m-1)$的t分布的$\alpha$分位数</p>
<p>如果落在拒绝域，那么拒绝原假设，接收备择假设。$\mu_1\neq \mu_2$</p>
<p>如果未落在拒绝域，那么接受原假设，$\mu_1=\mu_2$​</p>
<h3 id="p值法"><a href="#p值法" class="headerlink" title="p值法"></a>p值法</h3><script type="math/tex; mode=display">
p = 2P(t>|t_0|)</script><p>t表示自由度为$2(m-1)$ 的t分布的随机变量，$t_0$​ 是通过样本计算的检验统计量。</p>
<h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><p><img src="/2021/09/10/%E5%8D%95%E5%9B%A0%E5%AD%90%E6%96%B9%E5%B7%AE%E5%88%86%E6%9E%90/1.png" style="zoom:33%;"></p>
<p>这里是一张减肥前后的差异变化表。我们令$x<em>{1j}$ 为减肥计划A六周前后的体重差异，$x</em>{2j}$​ 表示减肥计划B六周前后的体重差异，$j=1,\cdots,24$</p>
<p>我们假设在$x_{ij}$独立的情况下：</p>
<script type="math/tex; mode=display">
x_{ij}\sim N(\mu_i,\sigma^2) ,~~i = 1,2,j=1,2,\cdots,24</script><p>那么我们给出假设检验：</p>
<script type="math/tex; mode=display">
H_0 : \mu_1 = \mu_2~~~ vs ~~~H_1:\mu_1\neq \mu_2</script><p>同时计算得到：</p>
<script type="math/tex; mode=display">
\overline x_1 = -3.3 ,s_1^2 = 5.0183 \\~\\
\overline x_2 = -3.1125,s_2^2 = 5.7072\\~\\
s_w^2 = 5.3627</script><p>检验统计量为：</p>
<script type="math/tex; mode=display">
t = \frac{\overline x_1-\overline x_2}{s_w\sqrt{2/m}} = -0.2805</script><p>取显著性水平 $\alpha = 0.05$，则拒绝域为：</p>
<script type="math/tex; mode=display">
\{|t|\geq t_{1-\alpha/2}(2m-2)\} = \{|t|\geq 2.0129\}</script><p>我们发现计算得到的t并为落在拒绝域，因此我们接收原假设，两种减肥计划的效果是一致的</p>
<h2 id="单因子方差分析的模型及假设"><a href="#单因子方差分析的模型及假设" class="headerlink" title="单因子方差分析的模型及假设"></a>单因子方差分析的模型及假设</h2><h3 id="基本定义"><a href="#基本定义" class="headerlink" title="基本定义"></a>基本定义</h3><p>那么问题来了，如果现在有三种减肥方式，我们又该怎么处理呢？两两做一次二样本独立t检验吗？显然这样比较耗费时间。因此我们提出了单因子方差分析模型</p>
<p>响应变量：我们关心的随机变量，一般用  y 来表示</p>
<p>因子：引发响应变量y大小变化的因素，一般用大写字母表示，例如：A，有a种不同的取值，通常 $a\geq 2$; 称因子A的一种取值为一个水平或者一个处理。</p>
<p>重复次数：在因子A每个水平下，随机变量的个数，记为m</p>
<p>在减肥方案的比较这个例子中：</p>
<ul>
<li>减肥计划前后的体重差作为响应变量</li>
<li>减肥计划为所关心的因子，$a=2$</li>
<li>每组有24名志愿者，即 $m=24$</li>
<li>样本量： $n = a\cdot m = 48$​</li>
</ul>
<p>现在，我们来定义一下这个模型中要用到的数据结构：</p>
<p><img src="/2021/09/10/%E5%8D%95%E5%9B%A0%E5%AD%90%E6%96%B9%E5%B7%AE%E5%88%86%E6%9E%90/2.png" style="zoom: 50%;"></p>
<p>其中：</p>
<ul>
<li>$y_{ij}$ 表示在第i个水平下观测到的第j个响应变量</li>
<li>$y_{i\cdot}$  表示在第i个水平下响应变量的总和</li>
<li>$\overline y_{i\cdot}$ 表示在第i个水平下响应变量的均值</li>
<li>$y_{\cdot\cdot}$ 表示所有响应变量的总和</li>
<li>$\overline y_{\cdot\cdot}$ 表示所有响应变量的均值</li>
</ul>
<p>也就是说我们可以列出如下关系：</p>
<script type="math/tex; mode=display">
\begin{align}
&y_{i\cdot} = \sum_{j=1}^m y_{ij}\\
&\overline y_{i\cdot}  = \frac{y_{i\cdot}}{m} ~~i = 1,2\cdots,a\\~\\
&y_{\cdot\cdot}  = \sum^a_{i=1}\sum_{j=1}^m y_{ij} \\
&\overline y_{\cdot\cdot} = \frac{y_{\cdot\cdot}}{n}
\end{align}</script><h3 id="均值模型"><a href="#均值模型" class="headerlink" title="均值模型"></a>均值模型</h3><p>现在我们来定义两种模型：均值模型和效应模型</p>
<p>均值模型如下：</p>
<p>首先给出假设，</p>
<script type="math/tex; mode=display">
H_0 : \mu_1 = \mu_2 = \cdots = \mu_a\\~\\
H_1 : \text{存在 在两种水平i,j下的均值不相等，即}\mu_i\neq\mu_j</script><p>给出模型定义：</p>
<script type="math/tex; mode=display">
y_{ij} = \mu_i+\varepsilon_{ij}, \begin{cases}
   i=1,2\cdots,a   \\ j=1,2\cdots,m \end{cases}</script><p>其中，</p>
<ul>
<li>$\mu_i$ 表示因子的第i个水平下的均值</li>
<li>$\varepsilon<em>{ij}$ 是随机误差，通常认为随机误差的期望为零，即 $E(\varepsilon </em>{ij})=0$​  。因为如果 $E(y_{ij})$ 不为0，那么这个期望我们是看不到的，在估计的时候就会有两个期望，我们没有办法分开 $E(y)$和$E(\varepsilon)$ ，导致识别不了参数。</li>
</ul>
<p>我们可以明显的看出：$E(y_{ij}) = \mu_i,j=1,2\cdots,m$​</p>
<p>这个模型就被称为<strong>均值模型</strong>，因为这个模型只和均值有关系</p>
<h3 id="效应模型"><a href="#效应模型" class="headerlink" title="效应模型"></a>效应模型</h3><p>除了均值模型之外，方差分析里面还有一个模型叫做效应模型。</p>
<p>在因子的第i个水平下的均值可以划分成两部分：</p>
<ul>
<li>其一为总体均值 $\mu = \frac{1}{a}\sum_{i=1}^a \mu_i$​ </li>
<li>其二维第i个水平效应$\alpha_i$，也就是说，各个水平的效应是各个水平的均值与总体均值的偏差。</li>
</ul>
<script type="math/tex; mode=display">
\mu_i = \mu+\alpha_i,~i = 1,2\cdots,a</script><p>也就是有一个和组别没有关系的值加上一个和组别有关系的效应值。</p>
<p>然后可以写出效应模型的形式：</p>
<script type="math/tex; mode=display">
y_{ij} = \mu+\alpha_i+\varepsilon_{ij}, \begin{cases}
   i=1,2\cdots,a   \\ j=1,2\cdots,m \end{cases}</script><p>相对于均值模型，效应模型参数个数有所增加。但是这样会存在一种状况，$\alpha$ 取不同的几组值可能会得到相同的结果。因此为了避免参数无法识别的问题，我们通常需要对参数给出一个合理的约束。最常见的为：</p>
<script type="math/tex; mode=display">
\sum_{i=1}^n \alpha_i = 0</script><p>这表明了，因子A的各个水平的效应在零的附近波动，且所有的效应总和为0</p>
<p>此外，还有一种条件是： $\alpha<em>1=0$, 这个方程会导致参数的含义发生了变化。使用$\sum</em>{i=1}^n \alpha_i = 0$​，$\alpha$表示效应；而$\alpha_1 = 0$​​ <code>/**TODO:思考此时参数是什么含义**/.</code> </p>
<p>现在给出效应模型的假设，</p>
<script type="math/tex; mode=display">
H_0 : \alpha_1 = \alpha_2 = \cdots = \alpha_a\\~\\
H_1 : \text{存在第i个水平不为0，即} \alpha_i\neq 0</script><p>在效应模型中：</p>
<script type="math/tex; mode=display">
\mu_i = \mu+\alpha_i,i=1,2\cdots,a</script><p>总之，无论是均值模型还是效应模型，<strong>都仅考虑了一个因子</strong>，所以，称这两个模型为<strong>单因子方差分析模型</strong></p>
<h4 id="误差假定"><a href="#误差假定" class="headerlink" title="误差假定"></a>误差假定</h4><p>现在我们来假定随机误差：独立同分布条件下，随机误差是以均值为0，方差为$\sigma^2$的正态分布的随机变量</p>
<script type="math/tex; mode=display">
\varepsilon \sim N(0,\sigma^2)</script><p>这表明：在不同水平下，响应变量的波动大小是一致的；观测到的数据是相互独立且均服从正态分布，即：</p>
<script type="math/tex; mode=display">
y_{ij}\sim N(\mu+\alpha_i,\sigma^2)</script><p><strong>注意！</strong>： 观测到的数据是相互独立的，但并不是同分布的，因为每组的均值可能是不相等的。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>单因子方差的模型为：</p>
<script type="math/tex; mode=display">
y_{ij} = \mu+\alpha_i+\varepsilon_{ij},\varepsilon_{ij}\sim N(0,\sigma^2),\begin{cases}
   i=1,2\cdots,a   \\ j=1,2\cdots,m \end{cases}\\~\\
   \text{s.t. } \sum_{i=1}^a \alpha_i = 0</script><p>现在我们可以用单因子方差分析去写一个二样本t检验的模型，如下：</p>
<script type="math/tex; mode=display">
y_{ij} = \mu+\alpha_i+\varepsilon_{ij},\varepsilon_{ij}\sim N(0,\sigma^2),\begin{cases}
   i=1,2 \\ j=1,2,\cdots,m \end{cases}\\~\\
   \text{s.t. } \sum_{i=1}^2 \alpha_i = 0</script><h2 id="单因子方差分析的检验"><a href="#单因子方差分析的检验" class="headerlink" title="单因子方差分析的检验"></a>单因子方差分析的检验</h2><p>我们再回到二样本t检验，我们在检验两组均值是否相等的本质就是比较两组样本均值差异与数据波动的大小。</p>
<p>所以，相比与数据的波动，两组样本均值的差异要大得多，那么我们才有足够的证据支撑说明这两组数据的均值是不一致的。</p>
<p>用一张图可以很清楚的解释：</p>
<p><img src="/2021/09/10/%E5%8D%95%E5%9B%A0%E5%AD%90%E6%96%B9%E5%B7%AE%E5%88%86%E6%9E%90/1.jpg" style="zoom: 50%;"></p>
<p>A和B是两组样本，如果取自两个黑圈，那么显然两组样本的均值是不相等的。但是如果取自两个红圈，那么相比于数据的波动，两组样本均值差异不明显，因此可以认为两组均值相等。</p>
<h3 id="偏差平方和"><a href="#偏差平方和" class="headerlink" title="偏差平方和"></a>偏差平方和</h3><p>那么当$a\geq3$时，我们又该怎么分析呢？如下图：</p>
<p><img src="/2021/09/10/%E5%8D%95%E5%9B%A0%E5%AD%90%E6%96%B9%E5%B7%AE%E5%88%86%E6%9E%90/3.png" style="zoom: 70%;"></p>
<p>观测这张图，我们发现，不同组别的均值是和对应的效应值$\alpha_i$相关的。此外，我们将所有数据看成一个整体，那么这个整体的波动又是和整体的方差有关的。 </p>
<p>为了分清楚这两者，我们需要推导一下偏差平方和的分解公式。</p>
<p>总偏差平方和等于所有点到所有响应变量的均值的偏差平方和</p>
<script type="math/tex; mode=display">
SS_T = \sum_{i=1}^a\sum_{j=1}^m(y_{ij}-\overline y_{..})^2</script><p>$SS_T$​ 可以拆分成两部分，也就是在里面加一项减一项，这是概率论的常见技巧。</p>
<script type="math/tex; mode=display">
\sum_{i=1}^a\sum_{j=1}^m(y_{ij}-\overline y_{..})^2  = \sum_{i=1}^a\sum_{j=1}^m((\overline y_{i\cdot}-\overline y_{\cdot\cdot})+(y_{ij}-\overline y_{i\cdot}))^2\\~\\</script><p>然后，第一部分是和j没有关系的，因此可以写为：</p>
<script type="math/tex; mode=display">
= m\sum_{i=1}^a(\overline y_{i\cdot}-\overline y_{\cdot\cdot})^2+\sum_{i=1}^a\sum_{j=1}^m(y_{ij}-\overline y_{i\cdot})^2+2\sum_{i=1}^a\sum_{j=1}^m(\overline y_{i\cdot}-\overline y_{\cdot\cdot})(y_{ij}-\overline y_{i\cdot})</script><p>再来，我们要敏锐的发现，交叉项是0，这是因为：</p>
<script type="math/tex; mode=display">
2\sum_{i=1}^a\sum_{j=1}^m(\overline y_{i\cdot}-\overline y_{\cdot\cdot})(y_{ij}-\overline y_{i\cdot}) = 2\sum_i(\overline y_{i\cdot}-\overline y_{\cdot\cdot})\sum_{j}^m(y_{ij}-\overline y_{i\cdot})\\~\\

\sum_{j}^m(y_{ij}-\overline y_{i\cdot}) = y_{i\cdot}-m\overline y_{i\cdot} = y_{i\cdot}-y_{i\cdot} = 0</script><p>因此，平方和分解公式的最终结果如下：</p>
<script type="math/tex; mode=display">
\sum_{i=1}^a\sum_{j=1}^m(y_{ij}-\overline y_{..})^2 = m\sum_{i=1}^a(\overline y_{i\cdot}-\overline y_{\cdot\cdot})^2+\sum_{i=1}^a\sum_{j=1}^m(y_{ij}-\overline y_{i\cdot})^2</script><h4 id="SS-A"><a href="#SS-A" class="headerlink" title="$SS_A$"></a>$SS_A$</h4><p>其中，第一项为<strong>组间偏差平方和$SS_A$</strong> ,即</p>
<script type="math/tex; mode=display">
SS_A = m\sum_{i=1}^a(\overline y_{i\cdot}-\overline y_{\cdot\cdot})^2</script><p>$SS_A$ 表示了不同水平下，数据的平均值与所有数据的总平均值之间的偏差平方和，既包含了因子A取不同水平引起的数据差异，又包含了随机误差对其的影响。</p>
<h4 id="SS-E"><a href="#SS-E" class="headerlink" title="$SS_E$"></a>$SS_E$</h4><p>第二项为组内偏差平方和 $SS_E$, 即：</p>
<script type="math/tex; mode=display">
SS_E =\sum_{i=1}^a\sum_{j=1}^m(y_{ij}-\overline y_{i\cdot})^2</script><p>$SS<em>E$ 表示同一水平下数据$y</em>{ij}$与其平均值 $\overline y_{i\cdot}$的差异，是实验误差引起的</p>
<h3 id="检验统计量"><a href="#检验统计量" class="headerlink" title="检验统计量"></a>检验统计量</h3><p>平方和分解公式可以简记为：</p>
<script type="math/tex; mode=display">
SS_T = SS_A+SS_E</script><p>对于给定的一组数据，总偏差平方和$SS<em>T$ 是不变的。如果原假设成立，$SS_A$仅仅收到随机误差方差的影响，取值应该不大。是因为每组的样本均值 $\overline y</em>{i\cdot}$ 是$\mu_i$的一个合理的估计。</p>
<p>因此一个直观的想法是比较$SS_A/SS_T$ 。如果这个比值越大，说明$SS_A$ 不仅仅受到误差的影响，因此我们越有证据支持备择假设；反之，我们认为原假设更合理</p>
<p>但是在单因子反差分析模型中，我们所构造的检验统计量是基于： $SS_A/SS_E$  的。其实将$SS_E$ 带换掉，我们发现$SS_A/SS_E$是随着 $SS_A/SS_T$的增大而增大的。</p>
<h3 id="定理1"><a href="#定理1" class="headerlink" title="定理1"></a>定理1</h3><p>在单因子方差分析模型中，有：</p>
<ul>
<li>组内偏差平方和$SS_E$ 的分布为：</li>
</ul>
<script type="math/tex; mode=display">
\frac{SS_E}{\sigma^2} \sim \mathcal{X}^2(n-a)</script><h4 id="证明"><a href="#证明" class="headerlink" title="证明"></a>证明</h4><p>根据单因子方差分析模型： $y<em>{ij} = \mu+\alpha_i+\varepsilon</em>{ij}$​​ ，将其带入$SS_E$公式可得</p>
<script type="math/tex; mode=display">
SS_E = \sum_{i=1}^a\sum_{j=1}^m(y_{ij}-\overline y_{i\cdot})^2 \\
=\sum_{i=1}^a\sum_{j=1}^m ((\mu+\alpha_i+\varepsilon_{ij})-\frac{1}{m}\sum_{j=1}^m(\mu+\alpha+\varepsilon_{ij}))^2</script><p>我们将求和符号打散，发现前两项可以保持不变(m消掉)，最后一项变为 $\frac{1}{m}\sum<em>{j=1}^m\varepsilon</em>{ij}$​ ，也就是每组的误差均值</p>
<script type="math/tex; mode=display">
SS_E=\sum_{i=1}^a\sum_{j=1}^m ((\mu+\alpha_i+\varepsilon_{ij})-\mu-\alpha-\frac{1}{m}\sum_{j=1}^m\varepsilon_{ij})^2\\~\\
=\sum_{i=1}^a\sum_{j=1}^m(\varepsilon_{ij}-\overline \varepsilon_{i\cdot})^2</script><p>同时，我们要知道 $\varepsilon_{ij}$是独立同分布的正态随机变量，即：</p>
<script type="math/tex; mode=display">
\varepsilon_{ij} \sim N(0,\sigma^2)</script><p>那么，在因子 A 的第i个水平下，$\varepsilon<em>{i1},\cdots,\varepsilon</em>{im}$ 可以看做来自正态总体 $N(0,\sigma^2)$的一组样本量为m的样本，而$\overline\varepsilon<em>{i\cdot} = m^{-1}\sum</em>{j=1}^m\varepsilon_{ij}$​可以看做是这组样本的样本均值。那么构造卡方就呼之欲出了。</p>
<script type="math/tex; mode=display">
\frac{SS_E}{\sigma^2}=\sum_{i=1}^a[\frac{1}{\sigma^2}\sum_{j=1}^m(\varepsilon_{ij}-\overline \varepsilon_{i\cdot})^2],i=1,2\cdots,a\\~\\
\text{其中:}\frac{1}{\sigma^2}\sum_{j=1}^m(\varepsilon_{ij}-\overline \varepsilon_{i\cdot})^2\sim\mathcal{X}^2(m-1)</script><p>又由于不同水平下的偏差平方和是相互独立的，因此根据卡方分布的可加性，有：</p>
<script type="math/tex; mode=display">
\frac{SS_E}{\sigma^2} \sim \mathcal{X}^2(a(m-1))\\~\\
\text{注意到：~~} a(m-1) = am-a = n-a</script><h3 id="定理2"><a href="#定理2" class="headerlink" title="定理2"></a>定理2</h3><p>在单因子方差分析模型中，有：</p>
<ul>
<li>组间偏差平方和的期望为:</li>
</ul>
<script type="math/tex; mode=display">
E(SS_A) = (a-1)\sigma^2+m\sum_{i=1}^a\alpha_i^2</script><p>特别的，在原假设 $H_0$成立时，有：</p>
<script type="math/tex; mode=display">
\frac{SS_A}{\sigma^2} \sim \mathcal{X}^2(a-1)</script><h4 id="证明-1"><a href="#证明-1" class="headerlink" title="证明"></a>证明</h4><p>证明策略与定理1类似，也是将$y<em>{ij} = \mu+\alpha_i+\varepsilon</em>{ij}$​ 代入</p>
<script type="math/tex; mode=display">
\begin{align}
SS_A &= m\sum_{i=1}^a(\overline y_{i\cdot}-\overline y_{\cdot\cdot})^2\\
&=m\sum_{i=1}^a (\frac{1}{m}\sum_{j=1}^m(\mu+\alpha_i+\varepsilon_{ij})-\frac{1}{n}\sum_{i=1}^a\sum_{j=1}^m(\mu+\alpha_i+\epsilon_{ij}))^2\\
&= m\sum_{i=1}^a (\alpha_i+\overline \varepsilon_{i\cdot}-\overline\varepsilon_{\cdot\cdot})^2
\end{align}</script><p>到这一步都很顺利。 现在我们看到括号里面有 $\alpha_i$ 和$\varepsilon$ ，这两个参数分别是确定的和随机的，我们要做的就是拆分他们。</p>
<script type="math/tex; mode=display">
=m\sum_{i=1}^a\alpha_i^2+m\sum_{i=1}^a(\overline\varepsilon_{i\cdot}-\overline\varepsilon_{\cdot\cdot})+2m\sum_{i=1}^a\alpha_i(\overline\varepsilon_{i\cdot}-\overline \varepsilon_{\cdot\cdot})</script><p>对于交叉项，这是一个数我们没办法再化成0了，但是我们可以求交叉项的期望。</p>
<p>因为 $\varepsilon_{ij}\sim N(0,\sigma^2)$ 且相互独立，所以：</p>
<script type="math/tex; mode=display">
\overline\varepsilon_{i\cdot} = \frac{1}{m}\sum_{j=1}^m\varepsilon_{ij}\sim N(0,\frac{\sigma^2}{m})\\
\overline \varepsilon_{\cdot\cdot} = \frac{1}{n}\sum_{i=1}^a\sum_{j=1}^m\varepsilon_{ij}\sim N(0,\frac{\sigma^2}{n})</script><p>因此：</p>
<script type="math/tex; mode=display">
E(2m\sum_{i=1}^a\alpha_i(\overline\varepsilon_{i\cdot}-\overline \varepsilon_{\cdot\cdot})) = 2m\sum_{i=1}^a\alpha_iE(\overline\varepsilon_{i\cdot}-\overline \varepsilon_{\cdot\cdot})=0</script><p>但这样一来就需要对整个$SS_A$​求期望。</p>
<script type="math/tex; mode=display">
E(SS_A) = m \sum_{i=1}^a\alpha_i^2+mE(\sum_{i=1}^a(\overline\varepsilon_{i\cdot}-\overline \varepsilon_{\cdot\cdot})^2)</script><p>现在我们又要来凑卡方了</p>
<ul>
<li>首先，$\overline \varepsilon<em>{i\cdot}$ 是第i个水平下随机误差的样本均值，因为不同水平下的随机误差是相互独立的，所以，这些随机误差的样本均值 $\overline\varepsilon</em>{1\cdot},\overline\varepsilon<em>{2\cdot},\cdots,\overline\varepsilon</em>{a\cdot}$是相互独立的。</li>
<li>又因为 </li>
</ul>
<script type="math/tex; mode=display">
\overline\varepsilon_{\cdot\cdot} = \frac{1}{n}\sum_{i=1}^a\sum_{j=1}^m\varepsilon_{ij}=\frac{1}{a}\sum_{i=1}^a\overline\varepsilon_{i\cdot}</script><p>可以看成是 a个$\overline\varepsilon<em>{1\cdot},\overline\varepsilon</em>{2\cdot},\cdots,\overline\varepsilon_{a\cdot}$ 的样本均值，因此卡方分布就呼之欲出了。</p>
<script type="math/tex; mode=display">
m(\sum_{i=1}^a(\overline\varepsilon_{i\cdot}-\overline \varepsilon_{\cdot\cdot})^2)/\sigma^2 \sim\mathcal{X}^2(a-1)\\
\sigma^2 E(m(\sum_{i=1}^a(\overline\varepsilon_{i\cdot}-\overline\varepsilon_{\cdot\cdot})^2)/\sigma^2 ) = \sigma^2(a-1)</script><p>综上，原式可以化简为：</p>
<script type="math/tex; mode=display">
E(SS_A) = m\sum_{i=1}^a\alpha_i^2+(a-1)\sigma^2</script><p>那么，当原假设 $H_0$成立时，因为 $\alpha_1=\alpha_2\cdots=\alpha_a =0$,我们有：</p>
<script type="math/tex; mode=display">
SS_A =m\sum_{i=1}^a(\overline\varepsilon_{i\cdot}-\overline \varepsilon_{\cdot\cdot})^2\\
SS_A/\sigma^2 =m\sum_{i=1}^a(\overline\varepsilon_{i\cdot}-\overline \varepsilon_{\cdot\cdot})^2/\sigma^2\sim\mathcal{X}^2(a-1)</script><h3 id="定理3"><a href="#定理3" class="headerlink" title="定理3"></a>定理3</h3><p>在单因子方差分析模型中，有：</p>
<ul>
<li>组间偏差平方和与组内偏差平方和独立。即</li>
</ul>
<script type="math/tex; mode=display">
SS_A \bot~ SS_E</script><p>这是因为，</p>
<script type="math/tex; mode=display">
SS_A = m\sum_{i=1}^a(\alpha_i+\overline\varepsilon_{i\cdot}-\overline\varepsilon_{i\cdot})^2</script><p>这是关于$\overline\varepsilon<em>{1\cdot},\overline\varepsilon</em>{2\cdot},\cdots,\overline\varepsilon_{a\cdot}$ 的函数。</p>
<p>同时，我们也要知道 $\sum<em>{j=1}^m(\varepsilon</em>{ij}-\overline\varepsilon<em>{i\cdot})^2$ 与 $\overline\varepsilon</em>{i\cdot}$是相互独立的，而且因子不同水平下的随机误差是相互独立的。</p>
<p>所以，$SS_A$ 和 $SS_E$ 独立</p>
<p>由于$SS_E$​和$SS_A$ 都可以化成卡方分布的形式，那么我们就可以这样来确定检验统计量</p>
<script type="math/tex; mode=display">
F_A = \frac{SS_A}{a-1}/\frac{SS_E}{n-a}</script><p>在原假设 $H_0$成立下服从自由度分别为$a-1$和n-a 的F分布，即 $F_A\sim F(a-1,n-a)$</p>
<h4 id="拒绝域法-1"><a href="#拒绝域法-1" class="headerlink" title="拒绝域法"></a>拒绝域法</h4><p>在显著性水平 $\alpha$下，如果：</p>
<script type="math/tex; mode=display">
F_A\geq F_{1-\alpha}(a-1,n-a)</script><p>那么，我们会拒绝原假设。<br><img src="/2021/09/10/%E5%8D%95%E5%9B%A0%E5%AD%90%E6%96%B9%E5%B7%AE%E5%88%86%E6%9E%90/4.png" style="zoom: 70%;"></p>
<h4 id="p值法-1"><a href="#p值法-1" class="headerlink" title="p值法"></a>p值法</h4><p>计算p值来进行判断，即</p>
<script type="math/tex; mode=display">
p_A = P(F\geq F_A)</script><p>其中，$F_A$是通过样本计算而得的检验统计量，F为一个自由度为$a-1$和$n-a$的卡方分布的随机变量。如果 $p_A\leq \alpha$ 那么，我们会 拒绝原假设，否则我们无法拒绝原假设</p>
<h2 id="单因子方差分析的参数估计"><a href="#单因子方差分析的参数估计" class="headerlink" title="单因子方差分析的参数估计"></a>单因子方差分析的参数估计</h2><h3 id="点估计"><a href="#点估计" class="headerlink" title="点估计"></a>点估计</h3><p>由于</p>
<script type="math/tex; mode=display">
y_{ij}\sim N(\mu+\alpha_i,\sigma^2)~~i=1,2\cdots,a ,j=1,2\cdots,m</script><p>我们可以用极大似然估计来估计参数</p>
<script type="math/tex; mode=display">
(\mu,\alpha_1,\alpha_2,\cdots,\alpha_a,\sigma^2)</script><p>似然估计为：</p>
<script type="math/tex; mode=display">
L(\mu,\alpha_1,\alpha_2\cdots,\alpha_a,\sigma^2) = \prod_{i=1}^a\prod_{j=1}\bigg\{\frac{1}{\sqrt{2\pi\sigma^2}}\exp\big\{-\frac{(y_{ij}-\mu-\alpha_i)^2}{2\sigma^2}\big\}\bigg\}</script><p>其对数似然函数为：</p>
<script type="math/tex; mode=display">
l(\mu,\alpha_1,\alpha_2\cdots,\alpha_a,\sigma^2) = \ln L(\mu,\alpha_1,\alpha_2\cdots,\alpha_a,\sigma^2)\\
=-\frac{n}{2}\ln(2\pi\sigma^2)-\sum_{i=1}^a\sum_{j=1}^m\frac{(y_{ij}-\mu-\alpha_i)^2}{2\sigma^2}</script><p>接下来对各个参数求偏导，得到似然方程为：</p>
<script type="math/tex; mode=display">
\begin{cases} \frac{\partial l}{\partial \mu}=\frac{1}{\sigma^2}\sum_{i=1}^a\sum_{i=1}^m(y_{ij}-\mu-\alpha_i)=0  \\~\\\frac{\partial l}{\partial\alpha_i} =\frac{1}{\sigma^2}\sum_{j=1}^m(y_{ij}-\mu-\alpha_i)=0 ~~i=1,2\cdots,a \\~\\

\frac{\partial l}{\partial\sigma^2} = -\frac{n}{2\sigma^2}+\frac{1}{2\sigma^4}\sum_{i=1}^a\sum_{j=1}^m(y_{ij}-\mu-\alpha_i)^2 = 0
\end{cases}</script><p>其中，第一个方程式多余的，因为第二行中，a个方程组相加以后，就等于第一个方程式。因此我们还需要加上一个条件才能解出来，这个条件就是 $\sum_{i=1}^a\alpha_i=0$</p>
<p>于是，我们可以求出各个参数的极大似然估计为：</p>
<script type="math/tex; mode=display">
\begin{cases} 
\hat\mu=\overline y_{\cdot\cdot}
\\~\\
\hat\alpha_i = \overline y_{i\cdot}-\overline y_{\cdot\cdot},i=1,2\cdots,a
\\~\\
\hat\sigma^2_{MLE} = \frac{1}{n} \sum_{i=1}^a\sum_{j=1}^m(y_{ij}-\overline y_{i\cdot})^2 = \frac{SS_E}{n}
\end{cases}</script><p>由极大似然估计的不变性，各个水平的均值$\mu_i$的极大似然估计为：</p>
<script type="math/tex; mode=display">
\hat\mu_i =\overline y_{i\cdot}</script><p>因为 $E(SS<em>E)=\sigma^2(n-a)$ ，所以 $\hat\sigma^2</em>{MLE}$ 并不是$\sigma^2$的一个无偏估计。</p>
<h4 id="区间估计"><a href="#区间估计" class="headerlink" title="区间估计"></a>区间估计</h4><p><img src="/2021/09/10/%E5%8D%95%E5%9B%A0%E5%AD%90%E6%96%B9%E5%B7%AE%E5%88%86%E6%9E%90/5.png" style="zoom:120%;"></p>
<p><img src="/2021/09/10/%E5%8D%95%E5%9B%A0%E5%AD%90%E6%96%B9%E5%B7%AE%E5%88%86%E6%9E%90/6.png" style="zoom:120%;"></p>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2021/09/08/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F1-2%E7%AB%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/09/08/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F1-2%E7%AB%A0/" itemprop="url">数据管理系统1-2章</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-09-08T06:27:56+08:00">
                2021-09-08
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2021-09-09T13:41:12+08:00">
                2021-09-09
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="数据管理系统1-2章"><a href="#数据管理系统1-2章" class="headerlink" title="数据管理系统1-2章"></a>数据管理系统1-2章</h1><h2 id="预备知识"><a href="#预备知识" class="headerlink" title="预备知识"></a>预备知识</h2><h3 id="什么是系统"><a href="#什么是系统" class="headerlink" title="什么是系统"></a>什么是系统</h3><p>系统要拥有的性能：</p>
<ol>
<li>通用性</li>
<li>隔离性</li>
<li>精巧性</li>
</ol>
<h3 id="什么是数据管理系统"><a href="#什么是数据管理系统" class="headerlink" title="什么是数据管理系统"></a>什么是数据管理系统</h3><p>首先，数据管理系统要有<strong>数据存放</strong>功能，这是最基本的要求。其次，要有<strong>数据组织</strong>的功能，因为一个系统里面有很多结构复杂的数据，该系统要能够在需要时迅速找到这些数据。再来，要有<strong>数据正确</strong>的功能，比如说银行的数据系统，或者是淘宝的数据系统，数据的安全非常重要。最后，要提供一个数据处理的平台，大量的数据并不会拿到云上的服务器去处理，而是在数据管理系统处理完之后再输出</p>
<h3 id="课程内容"><a href="#课程内容" class="headerlink" title="课程内容"></a>课程内容</h3><ol>
<li>如何使用数据管理系统</li>
<li>构建思想</li>
<li>数据管理系统的实现原理<ul>
<li>RDBMS-PostgreSQL</li>
<li>NoSQL-Mongodb</li>
</ul>
</li>
</ol>
<h3 id="如何模块化"><a href="#如何模块化" class="headerlink" title="如何模块化"></a>如何模块化</h3><p>现在有一个程序，我们要他实现这样一个功能：</p>
<p>输入：一张表，每行为一个单词序列</p>
<p>输出：对每一行实施”位移“，并按照字母顺序输出所有”位移”</p>
<p>比如说：“A good day” -&gt;”good day A”和”day A good”</p>
<p>为了解决这个问题我们可以设计如下套方案：</p>
<p><img src="/2021/09/08/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F1-2%E7%AB%A0/1.png" style="zoom:67%;"></p>
<p>第一套方案是：设计5个模块，一个是总控模块；然后每个模块各自负责输入、位移、排序和输出操作，前一个模块处理完后，后一个模块接着处理，它们都访问的是同一片地址上的数据。</p>
<p>方案1 是一套非常自然的想法，是比较朴素的。</p>
<p>第二套方案是：设计6个模块，一个是总控模块，输入模块将数据存放到存储器中，存储器向上给出一个接口，供位移模块进行操作，位移操作完成后，由向上伸出一个接口，供排序模块操作，最后输出调用排序模块的接口输出数据。</p>
<p>直观来看，第一种更能让人理解，但是第二种更好。方案一中的四个模块有一个共同的接口，就是内存中的数据，那么当出现数据量过大导致存储器结构发生改变的时候，方案1中的四个模块都需要进行代码结构上的修改。而对于方案2，内存中的数据只需要排序模块来负责，其他模块只要调用更为底层的接口即可，因此出了问题可以只对存储器进行修改。</p>
<p>这就牵扯到模块化的一个重要原则：<strong>信息隐藏</strong>, 它可以用来衡量一个系统的模块化是否合理</p>
<h3 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h3><p>请为以下程序做模块设计</p>
<blockquote>
<p>输入：若干文件，每个文件是一篇文章，由若干英文单词组成。<br>例如：file1.txt, file2.txt, file5.txt，….</p>
<p>输出：一个单词文件列表，记录了出现在文件中的每一个单词以及包含这个单词的所有文件的文件名。<br>例如： apple 出现于 file1.txt, file5.txt, ….<br>      fish 出现于 file2.txt, file5.txt, ….<br>      computer 出现于 file1.txt, file8.txt, …<br>      … …</p>
</blockquote>
<p><img src="/2021/09/08/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F1-2%E7%AB%A0/2.jpg" style="zoom:67%;"></p>
<ul>
<li>首先还是输入模块读入数据，放到存储器当中</li>
<li>然后，切词模块会把文章的单词一一提取，成为一个字符串数组。</li>
<li>接着打标签模块调用切词给出的接口，得到了字符串数组并为其打上了属于哪一篇文章的标签</li>
<li>最后交给输出模块输出。</li>
</ul>
<h2 id="文档数据库"><a href="#文档数据库" class="headerlink" title="文档数据库"></a>文档数据库</h2><h3 id="数据库系统的基本理念"><a href="#数据库系统的基本理念" class="headerlink" title="数据库系统的基本理念"></a>数据库系统的基本理念</h3><p>首先，基本所有数据库系统都有CRUD四种操作，分别代表：Create，Read，Update,Delete。</p>
<p>然后，我们要来介绍OOP(Object Oriented Programming) 也就是面向对象的程序设计，通常对于数据库中的一张数据表，我们要对其进行操作，就要设计一个于其相对应的数据模型。里面包含了个字段的名称、类型、限制以及字段之间的关系。</p>
<p>我们在Django教程中，对Mysql创建数据模型有着详细的介绍：<a href="https://jasonxqh.github.io/2021/07/05/Django学习1/#Build-a-Data-Model">Build a Data Model</a></p>
<p>在NodeJs教程中，对Mongodb数据库创建数据模型也有介绍：<a href="https://jasonxqh.github.io/2020/06/08/Express框架在后端的应用/#models目录">models目录</a> 以及 <a href="https://jasonxqh.github.io/2020/06/07/Nodejs基础2/#CRUD-Operations-Using-Mongoose">CRUD Operations Using Mongoose</a></p>
<p>在数据库中，每一张表其实也是一个数据模型。数据模型不同，数据库的使用功能也有不同。比如说关系数据库、文档数据库. 数据库里存档的数据可以看成是一个个对象。</p>
<h3 id="文档模型"><a href="#文档模型" class="headerlink" title="文档模型"></a>文档模型</h3><p>对于文档数据库而言，对象就是一个个文档。数据最终是存放在文档里面的。其结构如下：</p>
<p>database：数据库</p>
<p>Collection：文档集</p>
<p>document：文档</p>
<p>文档的组织结构是什么呢？在Mongodb中我们看到过这种形式：以一件淘宝商品为例：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"_id"</span>:&#123;<span class="attr">"$oid"</span>:<span class="string">"61133c8f94924b702a3b0d85"</span>&#125;,</span><br><span class="line">	<span class="attr">"url"</span>:<span class="string">"https://detail.tmall.com/item.htm?"</span>,</span><br><span class="line">	<span class="attr">"price"</span>:<span class="string">"¥98.00"</span>,</span><br><span class="line">	<span class="attr">"deal"</span>:<span class="string">"月成交 1000+笔 评价 8"</span>,</span><br><span class="line">	<span class="attr">"title"</span>:<span class="string">"纯棉学生宿舍三件套床上用品全棉床单被套四单人床被子套装全套六"</span>,</span><br><span class="line">	<span class="attr">"shop"</span>:<span class="string">"艾格妮斯旗舰店"</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>这是一个 key-value 的集合。key代表属性而value则代表取值。</p>
<p>文档里面也可以嵌套文档，这叫做子文档，比如：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"name"</span> : Jason,</span><br><span class="line">	<span class="attr">"birthday"</span>: &#123;</span><br><span class="line">		<span class="attr">"year"</span>: <span class="number">2001</span> , <span class="attr">"Mon"</span>: <span class="number">5</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"gender"</span>: male</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从几何的角度来看，这是一个树状的结构</p>
<h3 id="文档数据库的基本功能"><a href="#文档数据库的基本功能" class="headerlink" title="文档数据库的基本功能"></a>文档数据库的基本功能</h3><p>对于文档数据库，增删改查的指令是怎么实现的呢？</p>
<p>以mongodb为例：</p>
<p>插入操作(Create)：<code>db.myCollection.insertOne({...})</code></p>
<blockquote>
<p>db是数据库的名字</p>
<p>myCollection是文档集的名字</p>
<p>insertOne是方法</p>
</blockquote>
<p>查找操作(Read): <code>db.myCollection.find({...})</code></p>
<blockquote>
<p>find里面是该信息的描述信息。比如说</p>
<p><code>find({&quot;gender&quot;:&quot;male&quot;,&quot;birthday.year&quot;:&quot;2001&quot;})</code> 的查找条件就是：找到文档中包含gender、birthday.year属性的信息，并且要满足gender的值为male，bithday.year的值为2001</p>
</blockquote>
<p>其实在查询语句中的信息也是一个小文档，可以形象为一棵小树。观察小文档和大树的信息，可以发现小树是大树的一部分。因此说大树和小树是匹配的，大树是小数的查询结果。数据库系统所做的就是返回所有和小树匹配的大树。</p>
<p>修改操作(update): <code>db.myCollection.updateOne({&quot;name&quot;:&quot;Jason&quot;},{$set:{&quot;birthday.year&quot;:&quot;2002&quot;}})</code></p>
<blockquote>
<p>这条语句中包含了两个小文档，一个小文档是目标，即要查询的信息；第二个小文档是要修改的内容。<code>$set</code>是修改操作符，格式如下： <code>{ $set: { &lt;field1&gt;: &lt;value1&gt;, ... } }</code></p>
</blockquote>
<p>删除操作(delete)：<code>db.myCollection.deleteOne({&quot;name&quot;:&quot;Jason})</code></p>
<p>关于查找，我们可以使用<code>_id</code> 来查找某一个特定的文档</p>
<h3 id="文档是如何存储的"><a href="#文档是如何存储的" class="headerlink" title="文档是如何存储的"></a>文档是如何存储的</h3><p>现在我们知道了文档是放在数据库里面的，但这只是软件层面的，怎么从硬件层面来了解文档的存储、组织与管理呢？</p>
<p>文档数据是存放在硬盘(SSD/HDD)里面的。但是对于内存可以用来当做缓存，经常被使用的数据会存放在内存里，以便于CPU去使用。</p>
<p>那么文档是怎么放在硬盘里面的？要知道硬盘是一块连续的空间。连续紧挨着肯定不行，因为如果我要更新文档的时候，需要整体移动，导致空间管理很混乱。更合理的方式是将空间划分称一页一页的，页与页之间互相独立，每一页是固定的大小(4MB),我们可以将文档放在页里，当需要修改文档的时候，只需要调整页即可。</p>
<p>当要访问文档时，首先会将页提出并存放到内存里面，当使用完毕之后，会写回到硬盘里面。</p>
<h3 id="文档集的物理知识"><a href="#文档集的物理知识" class="headerlink" title="文档集的物理知识"></a>文档集的物理知识</h3><p>我们上面讲了，文档 是存放在页里面的，那么文档的集合是怎么将这些页组织、打包的呢？</p>
<p>在操作系统中我们学过，在文件系统中我们使用inode，结构如下：</p>
<p><img src="/2021/09/08/%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F1-2%E7%AB%A0/3.png" style="zoom:67%;"></p>
<p>同样的，在数据库系统中也可以这样来组织。这里直接指针会直接指向数据存放的页，而间接指针指向的是存放有指针的扩展页。</p>
<p>当我们想要插入文档时，可以找到最后一页，然后再里面插入。</p>
<p>对于读取、更新、删除文档的操作，首先要找到文档在哪。首先要根据文档集合的名字，找到对应的inode，然后将文档集合中的页面存放到内存里面。然后要扫描整个文档集合来找到匹配项。显然，这种方法是不太理想的，因为要扫描整个文档会浪费大量的时间。</p>
<p>因此，还需要有一个索引函数，当我给其一个查询的条件之后，索隐函数会返回满足条件的文档所在的地址(页)，然后我们直接去页里读取、修改。这样的效率就会大大提高。</p>
<p>这种索引函数怎么实现？ 我们需要用到B树这个数据结构</p>
<h3 id="B树索引"><a href="#B树索引" class="headerlink" title="B树索引"></a>B树索引</h3><p>关于B树，我写了一篇博客，详细讲述了查找、插入以及删除的操作：<a href="https://jasonxqh.github.io/2020/06/17/B树/#B树">B树</a></p>
<h3 id="B树索引的特性"><a href="#B树索引的特性" class="headerlink" title="B树索引的特性"></a>B树索引的特性</h3><h3 id="B树索引的插入与删除"><a href="#B树索引的插入与删除" class="headerlink" title="B树索引的插入与删除"></a>B树索引的插入与删除</h3><h2 id="文档数据库设计"><a href="#文档数据库设计" class="headerlink" title="文档数据库设计"></a>文档数据库设计</h2><h3 id="数据库设计的基本概念"><a href="#数据库设计的基本概念" class="headerlink" title="数据库设计的基本概念"></a>数据库设计的基本概念</h3><h3 id="文档数据库设计实例：需求分析"><a href="#文档数据库设计实例：需求分析" class="headerlink" title="文档数据库设计实例：需求分析"></a>文档数据库设计实例：需求分析</h3><h3 id="实例：概念设计"><a href="#实例：概念设计" class="headerlink" title="实例：概念设计"></a>实例：概念设计</h3><h3 id="不同文档结构设计的比较"><a href="#不同文档结构设计的比较" class="headerlink" title="不同文档结构设计的比较"></a>不同文档结构设计的比较</h3><h3 id="实例：结构设计"><a href="#实例：结构设计" class="headerlink" title="实例：结构设计"></a>实例：结构设计</h3><h3 id="文档数据库设计方法"><a href="#文档数据库设计方法" class="headerlink" title="文档数据库设计方法"></a>文档数据库设计方法</h3><h2 id="实验课"><a href="#实验课" class="headerlink" title="实验课"></a>实验课</h2><p><a href="https://jasonxqh.github.io/2020/06/07/Nodejs基础2/#CRUD-Operations-Using-Mongoose">1.2. CRUD Operations Using Mongoose</a></p>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/" itemprop="url">h5c3-网页制作</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-08-27T19:05:04+08:00">
                2021-08-27
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2022-08-22T11:10:24+08:00">
                2022-08-22
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Part3-网页制作"><a href="#Part3-网页制作" class="headerlink" title="Part3 -网页制作"></a>Part3 -网页制作</h1><p>现在我们的目标就是做一个网站。我们将学习网站制作的步骤流程以及如何让我们的网站变得更加好看</p>
<ol>
<li>我们需要会的技能：</li>
</ol>
<blockquote>
<ul>
<li>Semantic HTML</li>
<li>Basic CSS properties</li>
<li>Selectors &amp; pseudo-selectors</li>
<li>CSS box model</li>
<li>Absolute &amp; relative position</li>
<li>Flex &amp; Grid layout</li>
<li>Media queries</li>
<li>Responsive images</li>
<li>Transformations</li>
<li>Transitions</li>
</ul>
</blockquote>
<ol>
<li>需要的工具：</li>
</ol>
<ul>
<li><p>Firefox Developer Edition </p>
</li>
<li><p>Chrome</p>
</li>
<li><p>VSCode</p>
<ul>
<li>HTML CSS Support 可以自动提示编写过的类。</li>
</ul>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/1.png" style="zoom: 33%;"></p>
<ul>
<li>Prettier   可以美化我们的代码, 注意要在设置中确认 format on save开启。</li>
</ul>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/2.png" style="zoom:67%;"></p>
<ul>
<li>CSS Peek 有了这个插件我们就可以command+点击html中的class/id，直接跳到css中对应的定义</li>
<li>Highlight Matching Tag 会帮助我们高亮一对tag</li>
<li>Auto Rename Tag          当我们修改一个tag的时候，会一起修改于其对应的tag</li>
<li>Todo Hightlight              会高亮TODO和FIXME，如下：</li>
</ul>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/3.png" style="zoom:67%;"></p>
<ul>
<li>Command+Shift+p 打开 控制面板</li>
</ul>
</li>
<li><p>Git</p>
</li>
</ul>
<ol>
<li>准备工作</li>
</ol>
<blockquote>
<ol>
<li>创建工作区域</li>
</ol>
</blockquote>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/4.png" style="zoom:67%;"></p>
<blockquote>
<ol>
<li>下载字体</li>
</ol>
</blockquote>
<h3 id="Identifying-the-Components"><a href="#Identifying-the-Components" class="headerlink" title="Identifying the Components"></a>Identifying the Components</h3><p>首先我们要对我们做的网页有一个整体的认识。就像庖丁解牛一样来剖析网页的各个组成部分。</p>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/5.png" style="zoom:67%;"></p>
<blockquote>
<p>一开始有一个Navigation Bar  我们应该将其抽象出来专门做成一个组件</p>
<p>然后是一张 Hero image (banner) ,是用来放在网站开头，用来一下子告诉你这家公司是做什么的，这样能更快的吸引到访问者。通常 banner 都是满幅的，已达到视觉冲击的效果。</p>
<p>banner上还有一些文本、按钮等元素.可以采用两列grid的方式来组织，左边放文字信息和按钮右边放图片。</p>
</blockquote>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/6.png" style="zoom:67%;"></p>
<blockquote>
<p>接下来的主题是一个搜索框。搜索框应该被独立做成一个组件。</p>
<p>搜索框下方是一排小标记，这些标记的样式都是相同的，除了主标记有背景之外。我们应该用<code>inline-list</code>来实现它</p>
</blockquote>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/7.png" style="zoom:67%;"></p>
<blockquote>
<p>接下来看到的组件是呈一行三列 grid 呈现的 Card Component. </p>
<p>每一个Card Component里面都有价格、列表、按钮等元素，还有标记组件。</p>
</blockquote>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/8.png" style="zoom:67%;"></p>
<blockquote>
<p>接下来是一组三个竖直排列的组件。同样可以采用两列grid的方式来编排。可以直接用开头banner的组件。</p>
</blockquote>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/9.png" style="zoom:67%;"></p>
<blockquote>
<p>接下来是 Control Panel 部分</p>
</blockquote>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/10.png" style="zoom:67%;"></p>
<blockquote>
<p>然后是一个任务介绍部分，同样采用两列grid的方式，左边是图片，右边是任务介绍。注意字体的选择和样式</p>
<p>我们可以将图片和照片都放在一个 Card Component里面</p>
</blockquote>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/11.png" style="zoom:67%;"></p>
<blockquote>
<p>再然后是一个 Callout Component ，同样是两列式布局，左边是文本右边是按钮，用来刺激消费者购买我们的服务</p>
</blockquote>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/12.png" style="zoom:67%;"></p>
<blockquote>
<p>最后是脚注部分，后面四个都是以列表形式呈现，我们即可以采用grid的方式也可以采用行内列表的方式将它们水平排列起来。</p>
</blockquote>
<h3 id="Color-Palette"><a href="#Color-Palette" class="headerlink" title="Color Palette"></a>Color Palette</h3><p>首先我们来确定网站主体部分的颜色。关于颜色的选择，我们可以在PS中找出网站的预览图，然后用墨笔工具来选择颜色。由于这些颜色在网站的很多地方都出现，因此可以以变量的形式写在<code>root</code>里面</p>
<p>不难发现整个网站的主题颜色是蓝色，有不同种类的蓝。因此可以把两种蓝色设置成primary color和secondary color。</p>
<p>此外我们要设置一些针对文本的颜色。由于标题和文本的紫色是不同的，所以我们设置两个变量。如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">  <span class="attribute">--color-primary</span>: <span class="number">#2584ff</span>;</span><br><span class="line">  <span class="attribute">--color-secondary</span>: <span class="number">#00d9ff</span>;</span><br><span class="line">  <span class="attribute">--color-accent</span>: <span class="number">#ff3400</span>;</span><br><span class="line">  <span class="attribute">--color-headings</span>: <span class="number">#1b0760</span>;</span><br><span class="line">  <span class="attribute">--color-body</span>: <span class="number">#918ca4</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后我们要设置一下全体元素的性质：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*,</span><br><span class="line">*<span class="selector-pseudo">::after</span>,</span><br><span class="line">*<span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">box-sizing</span>: border-box; <span class="comment">/* 1 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这是告诉浏览器：你想要设置的边框和内边距的值是包含在 width 内的。也就是说，如果你将一个元素的 width 设为 100px，那么这 100px 会包含它的 border 和 padding，内容区的实际宽度是 width 减 去(border + padding) 的值。大多数情况下，这使得我们更容易地设定一个元素的宽高。</p>
<h3 id="Typography"><a href="#Typography" class="headerlink" title="Typography"></a>Typography</h3><p> 接下来我们要设字体了。一般我们把字体都放在<code>body{}</code>中，这样body里面的子元素就可以继承这些字体了。</p>
<p>在PS中利用文本工具可以获得网站上不同部分的字体格式、大小。如图：</p>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/13.png" style="zoom:67%;"></p>
<p>这个网站的字体大部分都是 Inter 家族的，我们可以到<a href="https://fonts.google.com/specimen/Inter?query=Inter" target="_blank" rel="noopener">Chrome font</a>上去把这个字体下载过来</p>
<p>然后我我们就要设计字体了。首先将 html整体的字体大小设置成10px：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">62.5%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后给 h1、h2、h3设计大小。注意了，我们先设计窄屏上的字体样式。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span>,</span><br><span class="line"><span class="selector-tag">h2</span>,</span><br><span class="line"><span class="selector-tag">h3</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--color-headings);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">7rem</span>;</span><br><span class="line">	<span class="attribute">margin-bottom</span>: <span class="number">1rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h2</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">4rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">h3</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">3rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">p</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>除了设置字体大小，我们为什么还要设置边距呢？这是因为三级标题一般就放在文本上面，它们之间的距离不能太大。因此要将段落p的上边距调为0，同时将三个标题的下边距都调为1rem</p>
<p>然后我们要做 media query,也就是电脑版本的字体样式。同样的到PS中打开standart.psd，查找对应字体即可。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@media screen and (<span class="built_in">min</span>-width: 1024px) &#123;</span><br><span class="line">  body &#123;</span><br><span class="line">    font-size: <span class="number">1</span>.8rem;</span><br><span class="line">  &#125;</span><br><span class="line">  h1 &#123;</span><br><span class="line">    font-size: 8rem;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  h2 &#123;</span><br><span class="line">    font-size: 4rem;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  h3 &#123;</span><br><span class="line">    font-size: <span class="number">2</span>.4rem;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/1.gif" style="zoom:67%;"></p>
<h3 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h3><p>现在我们在只做第一个组件——Link ，也就是下面这个小东西：</p>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/14.png" style="zoom:67%;"></p>
<p>首先，这个组件很简单，只是一个链接元素。而这个链接元素是没有下划线的，因此要设置<code>text-decoration: none</code></p>
<p>其次，要设置字体样式，颜色使用之前定义的<code>color-accent</code> , 且全是大写粗体。大小为2rem</p>
<p>再然后我们要在连接之后加上一个箭头(之后可以替换成一个图标)，然后设置一个过渡动画：当鼠标移动到连接上的时候，箭头会向右移动</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.link-arrow</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--color-accent);</span><br><span class="line">  <span class="attribute">text-transform</span>: uppercase;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">2rem</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.link-arrow</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">"--&gt;"</span>;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">transition</span>: margin-left <span class="number">0.15s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.link-arrow</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">margin-left</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后，要设置在宽屏模式下的样式。注意，我们最好在每个组件下面写一个独立的media query，不要集中在一起，否则会显得很乱。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@media screen and (<span class="built_in">min</span>-width: 1024px) &#123;</span><br><span class="line">  .link-arrow &#123;</span><br><span class="line">    font-size: <span class="number">1</span>.5rem;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/2.gif" style="zoom:67%;"></p>
<p>最后我们新建一个conmoent文件夹，把 link 组件放进去</p>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/15.png" style="zoom:67%;"></p>
<h3 id="Badges"><a href="#Badges" class="headerlink" title="Badges"></a>Badges</h3><p>现在我们来做 Badge 小组件，也就是这些东西：</p>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/16.png" style="zoom:67%;"></p>
<p>我们看到不同的badge有不同的大小、背景颜色。那么，我们应该怎么设计呢？</p>
<p>我们可以设计几个class，一个class用来渲染最基本的样式：字体、边距、边框角度。另一些class则是客制化的，用来设定不同的背景颜色、大小等样式。如下：</p>
<p>这边有四个class，后三个分别是客制化的class，这样一来我就能自由搭配不同大小、不同颜色的bages了。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Badges */</span></span><br><span class="line"><span class="selector-class">.badge</span> &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">20px</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">2rem</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0.5rem</span> <span class="number">2rem</span>;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.badge--primary</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--color-primary);</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.badge--secondary</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--color-secondary);</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.badge--small</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.6rem</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/17.png" style="zoom:67%;"></p>
<p>同样的，我们要设计一个宽屏版的：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@media screen and (<span class="built_in">min</span>-width: 1024px)&#123;</span><br><span class="line">  .badge&#123;</span><br><span class="line">    font-size: <span class="number">1</span>.5rem;</span><br><span class="line">  &#125;</span><br><span class="line">  .badge--small&#123;</span><br><span class="line">    font: size <span class="number">1</span>.2rem;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后新建一个<code>badges.html</code>然后把这个badge组件系列放进去：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;span class="badge badge--primary"&gt;10% Off&lt;/span&gt;</span><br><span class="line">&lt;span class="badge badge--secondary"&gt;10% Off&lt;/span&gt;</span><br><span class="line">&lt;span class="badge badge--primary badge--small"&gt;10% Off&lt;/span&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h3><p>接下来我们再设计一个列表组件。列表的呈现一共有两种形式：一种是正常的，一种是行内的。我们可以设计不同的class来实现</p>
<p>首先，设计一个通用的样式, 也就是确定最基本的颜色、边距。 注意，这里可以不设置字体，因为我们发现在网站中有不同大小的list。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.list</span> &#123;</span><br><span class="line">  <span class="attribute">list-style</span>: none;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--color-headings);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么行内的样式怎么设计呢？我们采用BEM的设计法则：inline是一个修饰器，用<code>--</code> ; 列表中的元素是元素，用<code>__</code> </p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.list--inline</span> <span class="selector-class">.list__item</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">margin-right</span>: <span class="number">2rem</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/18.png" style="zoom:67%;"></p>
<p>网页中正常的列表，左边都有一个√ ，这属于渲染器，我们可以这么写：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.list--tick</span> &#123;</span><br><span class="line">  <span class="attribute">list-style-image</span>: <span class="built_in">url</span>(/images/tick.svg);</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">3rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.list--tick</span> <span class="selector-class">.list__item</span> &#123;</span><br><span class="line">  <span class="attribute">padding-left</span>: <span class="number">0.5rem</span>; </span><br><span class="line">  <span class="attribute">margin-bottom</span>: <span class="number">1rem</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/19.png" style="zoom:67%;"></p>
<p>最后设计一下 media query：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">min-width:</span> <span class="number">1024px</span>)&#123;</span><br><span class="line">  <span class="selector-class">.list--tick</span> <span class="selector-class">.list__item</span> &#123;</span><br><span class="line">    <span class="attribute">padding-left</span>: <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Icons"><a href="#Icons" class="headerlink" title="Icons"></a>Icons</h3><p>现在我们要创建图标样式。 首先，我们有很多svg图标，一个一个拖入比较烦杂，我们可以通过一种方法将它们都整合到一起，可到这个网站上去进行转换：<a href="https://svgsprit.es/" target="_blank" rel="noopener">https://svgsprit.es/</a> 只要将所有svg拖入，就会自动生成一个svg文件</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;symbol id="growth" enable-background="new 0 0 512 512" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"&gt;</span><br></pre></td></tr></table></figure>
<p>其中每一个svg用一个 symbol 标签显示，id就是它的名字</p>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/20.png" style="zoom:67%;"></p>
<p>那么怎么引用呢？我们需要用到 use标签，然后正在<code>xlink:href</code>属性中填写引用svg的路径。井号后面跟id名</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;svg class="class"&gt;</span><br><span class="line">  &lt;use xlink:href="images/sprite.svg#wordpress"&gt;&lt;/use&gt;</span><br><span class="line">&lt;/svg&gt;</span><br></pre></td></tr></table></figure>
<p>现在我们来设置icon样式,网站里面用的图标大小都是一样的，因此我们可以先创建一个class来规定基本大小：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.icon</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">40px</span>;</span><br><span class="line">	<span class="attribute">height</span>: <span class="number">40px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后设置颜色，</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.icon--primary</span> &#123;</span><br><span class="line">  <span class="attribute">fill</span>: <span class="built_in">var</span>(--color-primary);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后我们要设计背景阴影：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.icon-container</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#f3f9f3</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">64px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">64px</span>;</span><br><span class="line">  border-radius: 100%; // 这样相当于将正方形变成圆形</span><br><span class="line">  <span class="selector-tag">display</span>: <span class="selector-tag">inline-flex</span>; </span><br><span class="line">  justify-content: center; // 设置或检索弹性盒子元素在主轴方向上居中</span><br><span class="line">  align-items: center; 		// 设置或检索弹性盒子元素在侧轴方向上居中</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/21.png" style="zoom:67%;"></p>
<h3 id="Buttons"><a href="#Buttons" class="headerlink" title="Buttons"></a>Buttons</h3><p>网站中一共有这几类按钮，我们发现它们有空桶的设计语言，知识背景颜色、字体颜色有相差。那么基于这个出发我们可以先创建基本类</p>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/22.png" style="zoom:67%;"></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.btn</span> &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">2rem</span> <span class="number">3rem</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.8rem</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">  <span class="attribute">text-transform</span>: uppercase;</span><br><span class="line">  white-space: nowrap; //不换行</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后给每一类按钮都用 BEM格式创建一个类：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.btn</span> &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">2rem</span> <span class="number">3rem</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.8rem</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">  <span class="attribute">text-transform</span>: uppercase;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btn--accent</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--color-accent);</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn--secondary</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--color-secondary);</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btn--primary</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--color-primary);</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn--outline</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--color-headings);</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid <span class="built_in">var</span>(--color-headings)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn--block</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后一个<code>btn--block</code>是以块状呈现的按钮，宽度设为占满容器</p>
<p>结果如下：</p>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/23.png" style="zoom:67%;"></p>
<p>但是现在只是做出了一个样子罢了，并没有写鼠标移动到按钮上会触发什么变化，因此我们还需要对每一类按钮设计鼠标样式。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="selector-class">.btn</span> &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">40px</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">2rem</span> <span class="number">3rem</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">1.8rem</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: <span class="number">600</span>;</span><br><span class="line">  <span class="attribute">text-transform</span>: uppercase;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btn--accent</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--color-accent);</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn--accent</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#fd4516</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btn--secondary</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--color-secondary);</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btn--secondary</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#00c8eb</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btn--primary</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--color-primary);</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btn--primary</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#3a8ffd</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn--outline</span> &#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--color-headings);</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">2px</span> solid <span class="built_in">var</span>(--color-headings);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn--outline</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">  <span class="attribute">background</span>: <span class="built_in">var</span>(--color-headings);</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.btn--block</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/3.gif" style="zoom:67%;"></p>
<h3 id="Inputs"><a href="#Inputs" class="headerlink" title="Inputs"></a>Inputs</h3><p>现在我们来做输入表单：</p>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/24.png" style="zoom:67%;"></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.input</span> &#123;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">var</span>(--color-headings);</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">2rem</span>;</span><br><span class="line">  <span class="attribute">outline</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">1.5rem</span> <span class="number">3.5rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-pseudo">::placeholder</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#cdcbd7</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">min-width:</span> <span class="number">1024px</span>) &#123;</span><br><span class="line">  <span class="selector-class">.input</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">1.5rem</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果如下：</p>
<p><img src="/2021/08/27/h5c3-%E7%BD%91%E9%A1%B5%E5%88%B6%E4%BD%9C/25.png" style="zoom:67%;"></p>
<p>那么怎么把button放到这个input文本框中去呢？</p>
<h3 id="Input-Groups"><a href="#Input-Groups" class="headerlink" title="Input Groups"></a>Input Groups</h3><h3 id="Cards"><a href="#Cards" class="headerlink" title="Cards"></a>Cards</h3><h3 id="Plans"><a href="#Plans" class="headerlink" title="Plans"></a>Plans</h3><h3 id="Popular-Badge"><a href="#Popular-Badge" class="headerlink" title="Popular Badge"></a>Popular Badge</h3><h3 id="Media-Objects"><a href="#Media-Objects" class="headerlink" title="Media Objects"></a>Media Objects</h3><h3 id="Quotes"><a href="#Quotes" class="headerlink" title="Quotes"></a>Quotes</h3><h3 id="Grids"><a href="#Grids" class="headerlink" title="Grids"></a>Grids</h3><h3 id="Testimonials"><a href="#Testimonials" class="headerlink" title="Testimonials"></a>Testimonials</h3><h3 id="Callouts"><a href="#Callouts" class="headerlink" title="Callouts"></a>Callouts</h3><h3 id="Collapsibles"><a href="#Collapsibles" class="headerlink" title="Collapsibles"></a>Collapsibles</h3><h3 id="Blocks"><a href="#Blocks" class="headerlink" title="Blocks"></a>Blocks</h3><h3 id="Navigation-Bars"><a href="#Navigation-Bars" class="headerlink" title="Navigation Bars"></a>Navigation Bars</h3><h3 id="Hero"><a href="#Hero" class="headerlink" title="Hero"></a>Hero</h3><h3 id="Optimizing-Images"><a href="#Optimizing-Images" class="headerlink" title="Optimizing Images"></a>Optimizing Images</h3><h3 id="Domain-Block"><a href="#Domain-Block" class="headerlink" title="Domain Block"></a>Domain Block</h3><h3 id="Plans-Block"><a href="#Plans-Block" class="headerlink" title="Plans Block"></a>Plans Block</h3><h3 id="Features-Block"><a href="#Features-Block" class="headerlink" title="Features Block"></a>Features Block</h3><h3 id="Showcase-Block"><a href="#Showcase-Block" class="headerlink" title="Showcase Block"></a>Showcase Block</h3><h3 id="Testimonials-Block"><a href="#Testimonials-Block" class="headerlink" title="Testimonials Block"></a>Testimonials Block</h3><h3 id="Foote"><a href="#Foote" class="headerlink" title="Foote"></a>Foote</h3><h3 id="Putting-it-All-Together"><a href="#Putting-it-All-Together" class="headerlink" title="Putting it All Together"></a>Putting it All Together</h3><h3 id="Troubleshooting-Layout-Issues"><a href="#Troubleshooting-Layout-Issues" class="headerlink" title="Troubleshooting Layout Issues"></a>Troubleshooting Layout Issues</h3><h3 id="Animations"><a href="#Animations" class="headerlink" title="Animations"></a>Animations</h3><h3 id="Search-Engine-Optimization"><a href="#Search-Engine-Optimization" class="headerlink" title="Search Engine Optimization"></a>Search Engine Optimization</h3><h3 id="HTML-and-CSS-Validation"><a href="#HTML-and-CSS-Validation" class="headerlink" title="HTML and CSS Validation"></a>HTML and CSS Validation</h3><h3 id="Building-for-Production"><a href="#Building-for-Production" class="headerlink" title="Building for Production"></a>Building for Production</h3><h3 id="Pushing-to-GitHub"><a href="#Pushing-to-GitHub" class="headerlink" title="Pushing to GitHub"></a>Pushing to GitHub</h3><h3 id="Deployment"><a href="#Deployment" class="headerlink" title="Deployment"></a>Deployment</h3><h3 id="Measuring-the-Sites-Performance"><a href="#Measuring-the-Sites-Performance" class="headerlink" title="Measuring the Sites Performance"></a>Measuring the Sites Performance</h3><h3 id="Course-Wrap-Up"><a href="#Course-Wrap-Up" class="headerlink" title="Course Wrap Up"></a>Course Wrap Up</h3>
          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2021/08/25/New-Bullseye/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/08/25/New-Bullseye/" itemprop="url">New-Bullseye</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-08-25T15:22:29+08:00">
                2021-08-25
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2021-09-05T12:36:30+08:00">
                2021-09-05
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="New-Bullseye"><a href="#New-Bullseye" class="headerlink" title="New-Bullseye"></a>New-Bullseye</h1><p>之前我写过一片博客来搭建一个很简单的 Bullseye游戏。但是由于XCode版本更新的缘故，现在我们再重新创建一个Bullseye。重复的语法问题我们就不再做探讨了，我们现在着重来学习一下软件架构的建立、软件的单元测试，以及软件界面的再优化。</p>
<p> 因为之前已经写过这个游戏了，因此我们直接从基本功能都已实现开始学习。</p>
<h3 id="Intro-to-App-Architecture"><a href="#Intro-to-App-Architecture" class="headerlink" title="Intro to App Architecture"></a>Intro to App Architecture</h3><p>之前我们的这个游戏的代码都放在一个<code>ContentView.swift</code>的文件里，导致代码很多，可读性极差。因此规划一下代码的组织架构是很必要的。</p>
<p>首先，ContentView Struct只是负责内容呈现，不负责游戏性。然后创建一个新的结构叫做 Game ,用来实现随机目标、轮次、计算分数这些功能。</p>
<p><img src="/2021/08/25/New-Bullseye/1.png" style="zoom:50%;"></p>
<p>我们要知道一个实例的背后是一个struct模型。比如说ContentView就是View的一个实例。而要创建一个Game结构，也需要一个对应的Model。这个关系就好比是java中的object与class的关系。</p>
<p>架构清楚明了之后，对于代码的维护、测试都会比较方便。 </p>
<p>因此我们要创建一些group(文件夹)： Model用来存放模型，Views用来存放实例，App则存放app文件。</p>
<p><img src="/2021/08/25/New-Bullseye/2.png" style="zoom:50%;"></p>
<p>需要注意的是，在将<code>info.plist</code> 移到App中去之后，我们需要到 Bullseye的Build Settings中修改其路径。否则会报错。</p>
<p><img src="/2021/08/25/New-Bullseye/3.png" style="zoom:50%;"></p>
<h3 id="Create-a-Model"><a href="#Create-a-Model" class="headerlink" title="Create a Model"></a>Create a Model</h3><p>现在我们来创建 Game Model：这个Model现在很简单，只有3个变量，之后可以向里面添加一些方法 </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Game</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> target: <span class="type">Int</span> = <span class="number">42</span></span><br><span class="line">    <span class="keyword">var</span> score: <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> round: <span class="type">Int</span> = <span class="number">1</span></span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">points</span><span class="params">(sliderValue: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">999</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么怎么在ContentView中创建这个模型的实例呢？</p>
<p>很简单：<code>@State private var game : Game = Game()</code></p>
<p>然后，当需要引用Game中的成员变量时，可以这么写：<code>Text(String(game.target))</code></p>
<p>当需要引用 Game中的方法时，可以这么写：<code>Text(&quot;You scored\(self.game.points(sliderValue: roundedValue)) points this round.&quot;)</code></p>
<p>都是用 <code>.</code> 来引用变量或方法。</p>
<h3 id="Intro-to-Unit-Testing"><a href="#Intro-to-Unit-Testing" class="headerlink" title="Intro to Unit Testing"></a>Intro to Unit Testing</h3><p>众所周知，一个app要上线肯定是要经过无数次测试的。有些是手动测试，就是把app装到自己的手机里然后运行找bug，还有一种叫做unit testing，就是让我们用测试代码来检查另一部分代码。</p>
<p>写一个测试文件需要有以下几步：</p>
<ol>
<li>Create Test Case</li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YourTestCaseName</span> : <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>Add Set Up / Tear Down</li>
</ol>
<p>对于每一个Case我们都要设计两个方法，一个是Set up,也就是为测试做一些准备，Tear down则是在测试结束之后要做的事情。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YourTestCase</span> <span class="title">Name</span> : <span class="title">XCTestCase</span></span>&#123;</span><br><span class="line">	<span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">setUpWithError</span><span class="params">()</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">		<span class="comment">//Your Code Here</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">tearDownWithError</span><span class="params">()</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">		<span class="comment">//Your Code Here</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>Add Tests</li>
</ol>
<p>最后一步就是正式写测试了</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YourTestCase</span> <span class="title">Name</span> : <span class="title">XCTestCase</span></span>&#123;</span><br><span class="line">	<span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">setUpWithError</span><span class="params">()</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">		<span class="comment">//Your Code Here</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">tearDownWithError</span><span class="params">()</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">		<span class="comment">//Your Code Here</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">func</span> <span class="title">yourTestName</span><span class="params">()</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">		<span class="comment">//Your Code Here</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>Add Asserts</li>
</ol>
<p>在我们写自己的测试代码的时候，同时也需要用到XCode中的内置方法，用来显示测试结果与理想结果之间的对比。这些方法就叫Asserts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">XCTAssertTrue</span><br><span class="line">XCTAssertEqual</span><br><span class="line">XCTAssertGreatThan</span><br><span class="line">....</span><br></pre></td></tr></table></figure>
<p>现在我们来给Bullseye写测试程序。首先创建单元测试文件：</p>
<p><img src="/2021/08/25/New-Bullseye/1.gif" style="zoom: 67%;"></p>
<p>然后我们来写这个文件 ：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> XCTest</span><br><span class="line"><span class="meta">@testable</span> <span class="keyword">import</span> Bullseye</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BullseyeTests</span>: <span class="title">XCTestCase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> game : <span class="type">Game!</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">setUpWithError</span><span class="params">()</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        game = <span class="type">Game</span>()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">tearDownWithError</span><span class="params">()</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        game =  <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">testExample</span><span class="params">()</span></span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="type">XCTAssertEqual</span>(game.points(sliderValue: <span class="number">50</span>),<span class="number">999</span>)</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们的目标就是，输入50以后，得到的值为999. </p>
<p>可以直接在测试菜单中点击右边的运行来执行测试文件，也可以上拉Product菜单-Test执行</p>
<p>测试成功的表现</p>
<p><img src="/2021/08/25/New-Bullseye/4.png" style="zoom: 67%;"></p>
<p>测试失败的结果</p>
<p><img src="/2021/08/25/New-Bullseye/5.png" style="zoom: 67%;"></p>
<h3 id="Intro-to-Test-Driven-Development"><a href="#Intro-to-Test-Driven-Development" class="headerlink" title="Intro to Test Driven Development"></a>Intro to Test Driven Development</h3><p>现在我们来介绍一种测试驱动开发的策略。也就是我们先写测试再写代码。</p>
<p> 这样做有什么好处呢？</p>
<blockquote>
<ol>
<li>它能强迫我们在开发的前期认真思考</li>
<li>能保证我们不会漏掉测试</li>
<li>能提升代码质量</li>
<li>能提高开发速率</li>
</ol>
</blockquote>
<p>比如说我要实现一个计算分数的功能，要写一个<code>points</code>方法。那么我就可以先写几个这个方法的测试</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testScorePositive</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">let</span> guess = game.target+<span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> score = game.points(sliderValue: guess)</span><br><span class="line">    <span class="type">XCTAssertEqual</span>(score, <span class="number">95</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">testScoreNegative</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">let</span> guess = game.target-<span class="number">5</span>;</span><br><span class="line">    <span class="keyword">let</span> score = game.points(sliderValue: guess)</span><br><span class="line">    <span class="type">XCTAssertEqual</span>(score, <span class="number">95</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在运行肯定是错的，但是我们可以根据我们的测试要求来实现我们的方法: </p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">points</span><span class="params">(sliderValue: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">   <span class="keyword">var</span> difference: <span class="type">Int</span> = <span class="keyword">self</span>.target - sliderValue</span><br><span class="line">   <span class="keyword">if</span> difference &lt; <span class="number">0</span> &#123;</span><br><span class="line">       difference = difference * -<span class="number">1</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">var</span> awardedPoints : <span class="type">Int</span> = <span class="number">100</span> - difference</span><br><span class="line">   <span class="keyword">return</span> awardedPoints</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>写好方法以后我们就能根据测试来调整代码并最后通过测试。</p>
<p><img src="/2021/08/25/New-Bullseye/6.png" style="zoom: 67%;"></p>
<h2 id="Polishing-The-App"><a href="#Polishing-The-App" class="headerlink" title="Polishing The App"></a>Polishing The App</h2><h3 id="Dark-Mode"><a href="#Dark-Mode" class="headerlink" title="Dark Mode"></a>Dark Mode</h3><p>现在的手机、电脑都有深色模式，那么可不可以让我们的游戏也搞一个深色模式呢？首先我们要搞一张深色模式的背景。我们到Assets文件中创建背景颜色。然后将Appearance从Any改成Any,Dark。并设置Dark Appearance的颜色。</p>
<p><img src="/2021/08/25/New-Bullseye/7.png" style="zoom: 67%;"></p>
<p>接着我们到<code>ContentView.swift</code>中，在预览模式中多添加几个<code>ContentView()</code></p>
<p>我这边添加了4个，分别是竖版白天模式，横版白天模式；竖版黑夜模式，横版黑夜模式。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView_Previews</span>: <span class="title">PreviewProvider</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">var</span> previews: some <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">ContentView</span>()</span><br><span class="line">    <span class="type">ContentView</span>()</span><br><span class="line">        .previewLayout(.fixed(width: <span class="number">568</span>, height: <span class="number">320</span>))</span><br><span class="line">    <span class="type">ContentView</span>()</span><br><span class="line">        .preferredColorScheme(.dark)</span><br><span class="line">    <span class="type">ContentView</span>()</span><br><span class="line">        .previewLayout(.fixed(width: <span class="number">568</span>, height: <span class="number">320</span>))</span><br><span class="line">        .preferredColorScheme(.dark)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/25/New-Bullseye/8.png"></p>
<h3 id="Challenge-Colors-and-Dark-Mode"><a href="#Challenge-Colors-and-Dark-Mode" class="headerlink" title="Challenge- Colors and Dark Mode"></a>Challenge- Colors and Dark Mode</h3><p>我们接下来要给字体不同的颜色。因为在明亮模式下我们不希望字是全黑的(黑色背景为#191919)</p>
<p><img src="/2021/08/25/New-Bullseye/9.png"></p>
<p>然后给需要的字体设置<code>foregroundColor(Color(&quot;TextColor&quot;))</code>属性即可</p>
<h3 id="Extract-Views"><a href="#Extract-Views" class="headerlink" title="Extract Views"></a>Extract Views</h3><p>还是回到代码重构的问题上来，虽然我们把一部分代码分给了 Game Struct，但是 ContentView上还是有很长的代码。不过，Xcode给我们提供了很多重构工具。</p>
<p>比如说，我们可以把 target 数字抽象出来，成为一个View类型的实例。如下：</p>
<p><img src="/2021/08/25/New-Bullseye/10.png" style="zoom:67%;"></p>
<p>现在我们来实操一下。首先创建一个<code>TextViews.swift</code>文件，用来专门存放对文本的样式：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">InstructionText</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> text: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(text.uppercased())</span><br><span class="line">          .bold()</span><br><span class="line">          .kerning(<span class="number">2.0</span>)</span><br><span class="line">          .multilineTextAlignment(.center)</span><br><span class="line">          .lineSpacing(<span class="number">4.0</span>)</span><br><span class="line">          .font(.footnote)</span><br><span class="line">          .foregroundColor(<span class="type">Color</span>(<span class="string">"TextColor"</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BigNumberText</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> target: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(target)</span><br><span class="line">          .kerning(-<span class="number">1.0</span>)</span><br><span class="line">          .font(.largeTitle)</span><br><span class="line">          .fontWeight(.black)</span><br><span class="line">          .foregroundColor(<span class="type">Color</span>(<span class="string">"TextColor"</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在设置字体大小的时候我们用到了<code>.font(.footnote)</code> 这边的.footnote其实对应了一种大小。我们可以在<a href="https://developer.apple.com/design/human-interface-guidelines/ios/visual-design/typography" target="_blank" rel="noopener">这个网站</a>找到字体大小以及与其对应的名字。</p>
<p>然后，我们在ContentView中可以直接调用这些结构。需要注意的是，在结构中我们定义了成员变量，因此在调用的时候需要传入需要被渲染的文本。如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span> &#123;</span><br><span class="line">       <span class="type">InstructionText</span>(text: <span class="string">"🎯🎯🎯\nPut the Bullseye as close as you can to"</span>)</span><br><span class="line">           .padding(.leading, <span class="number">30.0</span>)</span><br><span class="line">           .padding(.trailing, <span class="number">30.0</span>)</span><br><span class="line">       <span class="type">BigNumberText</span>(target:<span class="type">String</span>(game.target))</span><br><span class="line">       <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是这样我们仍然觉得不够结构化。我们还可以将这一部分抽象出来组成一个struct</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">InstructionView</span>: <span class="title">View</span></span>&#123;</span><br><span class="line">  	@<span class="type">Binding</span> <span class="keyword">var</span> game : <span class="type">Game</span> <span class="comment">//这边要定义一个Game类型的game，用来和传入的实例绑定</span></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span>&#123;</span><br><span class="line">        <span class="type">VStack</span>&#123;</span><br><span class="line">            <span class="type">InstructionText</span>(text: <span class="string">"🎯🎯🎯\nPut the Bullseye as close as you can to"</span>)</span><br><span class="line">                .padding(.leading, <span class="number">30.0</span>)</span><br><span class="line">                .padding(.trailing, <span class="number">30.0</span>)</span><br><span class="line">            <span class="type">BigNumberText</span>(target:<span class="type">String</span>(game.target))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里要注意了，因为我们引用了<code>game.target</code>,而game是在ContentView这个结构中定义的。因此我们要利用绑定的技巧，向该结构传入一个 <code>Game()</code>实例。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="type">VStack</span> &#123;</span><br><span class="line">        <span class="type">InstructionView</span>(game: $game)</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同理，我们对slider以及button也做这样的重构。最终结构如下，ContentView瘦身巨大。整个代码的结构看起来也十分整洁</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> alertIsVisible = <span class="literal">false</span></span><br><span class="line">  @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> sliderValue = <span class="number">50.0</span></span><br><span class="line">  @<span class="type">State</span> <span class="keyword">private</span> <span class="keyword">var</span> game = <span class="type">Game</span>()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">ZStack</span> &#123;</span><br><span class="line">        <span class="type">Color</span>(<span class="string">"BackgroundColor"</span>)</span><br><span class="line">        .edgesIgnoringSafeArea(.all)</span><br><span class="line">      <span class="type">VStack</span> &#123;</span><br><span class="line">        <span class="type">InstructionView</span>(game: $game)</span><br><span class="line">        <span class="type">SliderView</span>(sliderValue: $sliderValue)</span><br><span class="line">        <span class="type">HitMeButton</span>(game: $game, alertIsVisible: $alertIsVisible, sliderValue: $sliderValue)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">InstructionView</span>: <span class="title">View</span></span>&#123;</span><br><span class="line">    @<span class="type">Binding</span> <span class="keyword">var</span> game : <span class="type">Game</span></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span>&#123;</span><br><span class="line">        <span class="type">VStack</span>&#123;</span><br><span class="line">            <span class="type">InstructionText</span>(text: <span class="string">"🎯🎯🎯\nPut the Bullseye as close as you can to"</span>)</span><br><span class="line">                .padding(.leading, <span class="number">30.0</span>)</span><br><span class="line">                .padding(.trailing, <span class="number">30.0</span>)</span><br><span class="line">            <span class="type">BigNumberText</span>(target:<span class="type">String</span>(game.target))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SliderView</span>: <span class="title">View</span></span>&#123;</span><br><span class="line">    @<span class="type">Binding</span> <span class="keyword">var</span> sliderValue : <span class="type">Double</span></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span>&#123;</span><br><span class="line">        <span class="type">HStack</span>&#123;</span><br><span class="line">            <span class="type">SliderLabelText</span>(target: <span class="string">"1"</span>)</span><br><span class="line">            <span class="type">Slider</span>(value: $sliderValue, <span class="keyword">in</span>: <span class="number">1.0</span>...<span class="number">100.0</span>)</span><br><span class="line">            <span class="type">SliderLabelText</span>(target: <span class="string">"100"</span>)</span><br><span class="line">                .padding()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">HitMeButton</span>: <span class="title">View</span></span>&#123;</span><br><span class="line">    @<span class="type">Binding</span> <span class="keyword">var</span> game : <span class="type">Game</span></span><br><span class="line">    @<span class="type">Binding</span> <span class="keyword">var</span> alertIsVisible : <span class="type">Bool</span></span><br><span class="line">    @<span class="type">Binding</span> <span class="keyword">var</span> sliderValue : <span class="type">Double</span></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span>&#123;</span><br><span class="line">        <span class="type">VStack</span>&#123;</span><br><span class="line">            <span class="type">Button</span>(action: &#123;</span><br><span class="line">              <span class="built_in">print</span>(<span class="string">"Hello, SwiftUI!"</span>)</span><br><span class="line">              alertIsVisible = <span class="literal">true</span></span><br><span class="line">            &#125;) &#123;</span><br><span class="line">              <span class="type">Text</span>(<span class="string">"Hit me"</span>.uppercased())</span><br><span class="line">                .bold()</span><br><span class="line">                .font(.title3)</span><br><span class="line">            &#125;</span><br><span class="line">              .padding(<span class="number">20.0</span>)</span><br><span class="line">              .background(</span><br><span class="line">                <span class="type">ZStack</span> &#123;</span><br><span class="line">                  <span class="type">Color</span>(<span class="string">"ButtonColor"</span>)</span><br><span class="line">                  <span class="type">LinearGradient</span>(gradient: <span class="type">Gradient</span>(colors: [<span class="type">Color</span>.white.opacity(<span class="number">0.3</span>), <span class="type">Color</span>.clear]), startPoint: .top, endPoint: .bottom)</span><br><span class="line">                &#125;</span><br><span class="line">              )</span><br><span class="line">              .foregroundColor(<span class="type">Color</span>.white)</span><br><span class="line">              .cornerRadius(<span class="number">21.0</span>)</span><br><span class="line">              .alert(isPresented: $alertIsVisible, content: &#123;</span><br><span class="line">                <span class="keyword">let</span> roundedValue = <span class="type">Int</span>(sliderValue.rounded())</span><br><span class="line">                <span class="keyword">return</span> <span class="type">Alert</span>(title: <span class="type">Text</span>(<span class="string">"Hello there!"</span>),</span><br><span class="line">                             message: <span class="type">Text</span>(<span class="string">"The slider's value is \(roundedValue).\n"</span> + </span><br><span class="line">                                           <span class="string">"You scored \(game.points(sliderValue: roundedValue)) points this round."</span>), </span><br><span class="line">                             dismissButton: .<span class="keyword">default</span>(<span class="type">Text</span>(<span class="string">"Awesome!"</span>)))</span><br><span class="line">              &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//....</span></span><br></pre></td></tr></table></figure>
<h3 id="Fill-and-Stroke-Shapes"><a href="#Fill-and-Stroke-Shapes" class="headerlink" title="Fill and Stroke Shapes"></a>Fill and Stroke Shapes</h3><p>现在我们来学习关于形状的知识——如何画形状？如何对边框进行操作？</p>
<h4 id="fill"><a href="#fill" class="headerlink" title="fill"></a>fill</h4><p>fill顾名思义就是填充的意思。比如下面这段代码，用fill可以将圆形填充为蓝色</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Shapes</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>&#123;</span><br><span class="line">            <span class="type">Circle</span>()</span><br><span class="line">                .fill(<span class="type">Color</span>.blue)</span><br><span class="line">                .frame(width: <span class="number">200</span>, height: <span class="number">100</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .background(<span class="type">Color</span>.green)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/25/New-Bullseye/11.png" style="zoom: 33%;"></p>
<h4 id="stroke"><a href="#stroke" class="headerlink" title="stroke"></a>stroke</h4><p>和fill不一样, storke是设置边线的样式。比如说这里我设置了变线的颜色和宽度。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span>&#123;</span><br><span class="line">            <span class="type">Circle</span>()</span><br><span class="line">                .stroke(<span class="type">Color</span>.blue,lineWidth: <span class="number">20</span>)</span><br><span class="line">                .frame(width: <span class="number">200</span>, height: <span class="number">100</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .background(<span class="type">Color</span>.green)</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/25/New-Bullseye/12.png" style="zoom: 67%;"></p>
<p>但是这个边框很丑，长出去了一截，我们可以通过两种方法让其缩回去</p>
<ol>
<li><code>.inset(by: 10.0)</code> ，因为边框长20，中点是刚好在框架上的.那么就可以让这个圈缩回去10，就刚好在边框里面了</li>
<li>直接用另一个方法<code>.strokeBorder(Color.blue,lineWidth:20.0)</code> 这个方法中不管设置宽为多少，圆始终在边框里</li>
</ol>
<h4 id="other-shape"><a href="#other-shape" class="headerlink" title="other shape"></a>other shape</h4><p>除了单纯的圆形，还有圆角矩形，椭圆形，胶囊形等形状。</p>
<p><img src="/2021/08/25/New-Bullseye/13.png" style="zoom: 67%;"></p>
<h4 id="HitButton边框"><a href="#HitButton边框" class="headerlink" title="HitButton边框"></a>HitButton边框</h4><p>我们想给Hit Button设计一个白色的边框，以让其在黑色背景下更为突出。可以再按钮的样式中写：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.foregroundColor(<span class="type">Color</span>.white)</span><br><span class="line">.cornerRadius(<span class="number">21.0</span>)</span><br><span class="line">.overlay(</span><br><span class="line">  <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">21.0</span>)</span><br><span class="line">      .strokeBorder(<span class="type">Color</span>.white ,lineWidth: <span class="number">2.0</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>这个<code>overlay</code>方法，就是在原有的元素上添加样式。这里我添加了一个白色，宽度为2.0的边框线。效果如下：</p>
<p><img src="/2021/08/25/New-Bullseye/14.png" style="zoom: 67%;"></p>
<h3 id="SF-Symbols"><a href="#SF-Symbols" class="headerlink" title="SF Symbols"></a>SF Symbols</h3><p>现在我希望在app的顶部放置两个按钮，如下图所示：</p>
<p><img src="/2021/08/25/New-Bullseye/16.png" style="zoom: 67%;"></p>
<p>左边的按钮代表重新开始，右边的是关于游戏的介绍。这两个按钮在白昼模式和黑夜模式下式不一样的。</p>
<p>那么这种小图标去哪里找呢？Apple为我们提供了很多实用美观的图标，我们可以拿来直接用。我们可以到<a href="https://developer.apple.com/sf-symbols/" target="_blank" rel="noopener">SF Symbols官网</a> 上去下载app，现在已经出到第三版了。</p>
<p><img src="/2021/08/25/New-Bullseye/15.png" style="zoom: 50%;"></p>
<p>当我们想用的时候，只需要这样就可以了：<code>Image(&quot;square.and.arrow.up.fill&quot;)</code> 就可以显示了。</p>
<p>我这里选中的两个图标是： <code>arrow.counterclockwise</code> 和 <code>list.dash</code></p>
<p>接着，我们创建一个<code>RoundViews.swift</code>的文件，用来存放不同类型的图标：</p>
<p>为了实现图标的样式，我们需要3中特定的颜色：边线颜色、背景填充情况下背景的颜色、背景填充情况下的图标颜色。</p>
<blockquote>
<p>ButtonStrokeColor: 浅色背景为淡蓝色，深色背景为白色</p>
<p>ButtonFilledBackgroundColor: 浅色背景为黑色，深色背景为白色</p>
<p>ButtonFilledTextColor: 浅色背景为白色，深色背景为黑色</p>
</blockquote>
<p>比如说，下面是一个没有背景的图标样式(浅色模式下使用的)</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RoundedImageStroked</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> systemName: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Image</span>(systemName: systemName)</span><br><span class="line">            .font(.title)</span><br><span class="line">            .foregroundColor(<span class="type">Color</span>(<span class="string">"TextColor"</span>))<span class="comment">//设置前景颜色(字体颜色)</span></span><br><span class="line">            .frame(width: <span class="number">56.0</span>, height: <span class="number">56.0</span>)</span><br><span class="line">      			<span class="comment">// 设置覆盖元素，是一个环</span></span><br><span class="line">            .overlay(</span><br><span class="line">                <span class="type">Circle</span>()</span><br><span class="line">                    .strokeBorder(<span class="type">Color</span>(<span class="string">"ButtonStrokeColor"</span>),lineWidth: <span class="number">2.0</span>)</span><br><span class="line">            )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RoundedImageViewFilled</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> systemName: <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Image</span>(systemName: systemName)</span><br><span class="line">            .font(.title)</span><br><span class="line">      		<span class="comment">// 设置字体颜色</span></span><br><span class="line">            .foregroundColor(<span class="type">Color</span>(<span class="string">"ButtonFilledTextColor"</span>))</span><br><span class="line">            .frame(width: <span class="number">56.0</span>, height: <span class="number">56.0</span>)</span><br><span class="line">      		<span class="comment">// 设置背景</span></span><br><span class="line">            .background(</span><br><span class="line">                <span class="type">Circle</span>()</span><br><span class="line">                    .fill(<span class="type">Color</span>(<span class="string">"ButtonFilledBackgroundColor"</span>))</span><br><span class="line">            )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PreviewView</span>:<span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>&#123;</span><br><span class="line">            <span class="type">RoundedImageStroked</span>(systemName: <span class="string">"arrow.counterclockwise"</span>)</span><br><span class="line">            <span class="type">RoundedImageStroked</span>(systemName: <span class="string">"list.dash"</span>)</span><br><span class="line">            <span class="type">RoundedImageViewFilled</span>(systemName: <span class="string">"arrow.counterclockwise"</span>)</span><br><span class="line">            <span class="type">RoundedImageViewFilled</span>(systemName: <span class="string">"list.dash"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/25/New-Bullseye/17.png" style="zoom: 70%;"></p>
<h3 id="Put-it-All-Together"><a href="#Put-it-All-Together" class="headerlink" title="Put it All Together"></a>Put it All Together</h3><p>现在我们来设计一个 <code>BackgroundView</code> 用来存放背景、上面写的按钮以及底部的分数、轮次信息。效果如图所示：</p>
<p><img src="/2021/08/25/New-Bullseye/18.png" style="zoom:67%;"></p>
<p>为了实现下面这行现实的内容(Score,Round),我们需要再写两个struct：</p>
<ul>
<li>TextViews:</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LabelText</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> title : <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span>&#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="type">String</span>(title))</span><br><span class="line">            .bold()</span><br><span class="line">            .font(.caption)</span><br><span class="line">            .kerning(<span class="number">1.5</span>)</span><br><span class="line">            .foregroundColor(<span class="type">Color</span>(<span class="string">"TextColor"</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>RoundViews</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RoundedRectTextView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> systemName: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="type">String</span>(systemName))</span><br><span class="line">            .font(.title3)</span><br><span class="line">            .bold()</span><br><span class="line">            .foregroundColor(<span class="type">Color</span>(<span class="string">"TextColor"</span>))</span><br><span class="line">            .frame(width: <span class="number">68.0</span>, height: <span class="number">56.0</span>)</span><br><span class="line">            .overlay(</span><br><span class="line">                <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">21.0</span>)</span><br><span class="line">                    .strokeBorder(<span class="type">Color</span>(<span class="string">"ButtonStrokeColor"</span>),lineWidth: <span class="number">2.0</span>)</span><br><span class="line">                    .foregroundColor(<span class="type">Color</span>(<span class="string">"ButtonStrokeColor"</span>))</span><br><span class="line">            )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后在background中将它们都联合起来：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> SwiftUI</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BackgroundView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    @<span class="type">Binding</span> <span class="keyword">var</span> game : <span class="type">Game</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>&#123;</span><br><span class="line">            <span class="type">TopView</span>(game: $game)</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">            <span class="type">BottomView</span>(game: $game)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">        .background(</span><br><span class="line">            <span class="type">Color</span>(<span class="string">"BackgroundColor"</span>)</span><br><span class="line">                .edgesIgnoringSafeArea(.all)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TopView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    @<span class="type">Binding</span> <span class="keyword">var</span> game : <span class="type">Game</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span>&#123;</span><br><span class="line">            <span class="type">RoundedImageStroked</span>(systemName: <span class="string">"arrow.counterclockwise"</span>)</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">            <span class="type">RoundedImageViewFilled</span>(systemName: <span class="string">"list.dash"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">NumberView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> title : <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> text : <span class="type">String</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span>&#123;</span><br><span class="line">            <span class="type">LabelText</span>(title: title)</span><br><span class="line">            <span class="type">RoundedRectTextView</span>(systemName: text)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BottomView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    @<span class="type">Binding</span> <span class="keyword">var</span> game : <span class="type">Game</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">HStack</span>&#123;</span><br><span class="line">            <span class="type">NumberView</span>(title: <span class="string">"Score"</span>, text: <span class="type">String</span>(game.score))</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">            <span class="type">NumberView</span>(title: <span class="string">"Round"</span>, text: <span class="type">String</span>(game.round))</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BackgroundView_Previews</span>: <span class="title">PreviewProvider</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">BackgroundView</span>(game: .constant(<span class="type">Game</span>()))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="A-Custom-Alert"><a href="#A-Custom-Alert" class="headerlink" title="A Custom Alert"></a>A Custom Alert</h2><p>现在我们已经实现了计算分数(包括Bonus)、Start Over按钮的功能，我们再来美化一下背景，以及美化一下弹出窗口。效果如下：</p>
<p><img src="/2021/08/25/New-Bullseye/19.png" style="zoom:67%;"></p>
<h3 id="Draw-the-Rings"><a href="#Draw-the-Rings" class="headerlink" title="Draw the Rings"></a>Draw the Rings</h3><p>那么背景的圆环怎么画呢？ </p>
<p>我们可以用<code>ForEach</code>语句来实现。</p>
<p>首先来说说 <code>ForEach</code> ，其格式如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> numberWords = [<span class="string">"one"</span>, <span class="string">"two"</span>, <span class="string">"three"</span>]</span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> numberWords &#123;</span><br><span class="line">    <span class="built_in">print</span>(word)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Prints "one"</span></span><br><span class="line"><span class="comment">// Prints "two"</span></span><br><span class="line"><span class="comment">// Prints "three"</span></span><br><span class="line"></span><br><span class="line">numberWords.forEach &#123; word <span class="keyword">in</span></span><br><span class="line">    <span class="built_in">print</span>(word)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Same as above</span></span><br></pre></td></tr></table></figure>
<p>我们想要的一系列圆环是呈同心圆分布的，且中间到外围越来越透明。要达到这种渐变的效果，有两种方法：</p>
<p><img src="/2021/08/25/New-Bullseye/20.png" style="zoom:80%;"></p>
<p>这里我们使用辐射型渐变，从100开始向外辐射到500未知。</p>
<p>Todo List：</p>
<blockquote>
<ul>
<li>Create a color in the Asset Catalogue</li>
<li>Apply a fill modifier to your circle shape</li>
<li>Put a radial gradient inside the fill modifier</li>
<li>Start Color: The color you set up ,but with opacity = 0.8 * 3</li>
<li>End Color: The color you set up, but with opacity = 0</li>
<li>Start Radius = 100 ; End Radius = 300</li>
</ul>
</blockquote>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">RingsView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ZStack</span>&#123;</span><br><span class="line">            <span class="type">Color</span>(<span class="string">"BackgroundColor"</span>)</span><br><span class="line">                    .edgesIgnoringSafeArea(.all)</span><br><span class="line">            <span class="type">ForEach</span>(<span class="number">1</span>..&lt;<span class="number">5</span>) &#123; ring <span class="keyword">in</span></span><br><span class="line">                <span class="comment">// 一共五个换，从100直径开始，到500直径结束</span></span><br><span class="line">                <span class="comment">//CGFloat是浮点值的基本类型,更加精确。这样就可以放在frame里面</span></span><br><span class="line">                <span class="keyword">let</span> size  =  <span class="type">Float</span>(ring * <span class="number">100</span>)</span><br><span class="line">                <span class="type">Circle</span>()</span><br><span class="line">                    .stroke(lineWidth: <span class="number">20.0</span>)</span><br><span class="line">                    .fill(</span><br><span class="line">                        <span class="type">RadialGradient</span>(gradient: <span class="type">Gradient</span>(colors:  [<span class="type">Color</span>(<span class="string">"RingsColor"</span>).opacity(<span class="number">0.3</span>*<span class="number">0.8</span>), <span class="type">Color</span>(<span class="string">"RingsColor"</span>).opacity(<span class="number">0</span>)]), </span><br><span class="line">                                       <span class="comment">// 上面是设置渐变色段，我们这是同一个颜色的渐变。</span></span><br><span class="line">                                       center: .center, </span><br><span class="line">                                       startRadius: <span class="number">100</span>, </span><br><span class="line">                                       endRadius: <span class="number">300</span>)</span><br><span class="line">                    )</span><br><span class="line">                    .frame(width: size, height: size)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/25/New-Bullseye/21.png" style="zoom:80%;"></p>
<h3 id="Environment-Property-Wrapper"><a href="#Environment-Property-Wrapper" class="headerlink" title="Environment Property Wrapper"></a>Environment Property Wrapper</h3><p>我们看白昼模式下好像还挺正常的，但是一旦到了黑暗模式下，画风就变得很奇怪：</p>
<p><img src="/2021/08/25/New-Bullseye/22.png" style="zoom:80%;"></p>
<p>很显然，这是因为在黑暗模式下，我们不可以将透明度设置成0.3那么高，一般0.1就足够了。那么怎么适配呢？这就需要用到 Environment Property Wrapper 了。</p>
<p>如果一个属性被<code>@Environment</code> 属性包装器修饰了，那么我们就可以通过这个属性来获得当前环境的一些信息。</p>
<p>比如说我定义了：<code>@Environment(\.colorScheme) var colorScheme</code></p>
<p>那么，现在的colorScheme就能反映出当前环境信息。</p>
<p>于是，我们就可以定义一个<code>opacity</code>变量，若是白昼模式则设其为0.3,黑夜模式则设为0.1</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> opacity = colorScheme == .dark ? <span class="number">0.1</span> : <span class="number">0.3</span></span><br></pre></td></tr></table></figure>
<p>这里我们采用了调减运算符来定义透明度 。结果如下：</p>
<p><img src="/2021/08/25/New-Bullseye/23.png" style="zoom:80%;"></p>
<h3 id="Center-the-Slider"><a href="#Center-the-Slider" class="headerlink" title="Center the Slider"></a>Center the Slider</h3><p>虽然现在看起来已经有模有样了，但是现在有一个大无语事件就是这个滑动条的中心好像没有位于圆圈的中心。怎么修改呢？</p>
<p>我们可以将原来放在 ContentView-VStack 中的slider移动到ZStack中。因为放在ZStack中的组件会默认放在整个页面的居中位置。</p>
<p>然后，由于放到ZStack之后，Instruction和HitME Button之间的空隙就变短了，因此我们还需要在里面加上一些间距。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">ZStack</span> &#123;</span><br><span class="line">        <span class="type">BackgroundView</span>(game: $game)</span><br><span class="line">      <span class="type">VStack</span> &#123;</span><br><span class="line">        <span class="type">InstructionView</span>(game: $game)</span><br><span class="line">            .padding(.bottom,<span class="number">100</span>)</span><br><span class="line">        <span class="type">HitMeButton</span>(game: $game, alertIsVisible: $alertIsVisible, sliderValue: $sliderValue)</span><br><span class="line">      &#125;</span><br><span class="line">        <span class="type">SliderView</span>(sliderValue: $sliderValue)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/25/New-Bullseye/24.png" style="zoom:80%;"></p>
<h3 id="Challenge-More-Text-Styles"><a href="#Challenge-More-Text-Styles" class="headerlink" title="Challenge- More Text Styles"></a>Challenge- More Text Styles</h3><p>现在我们为这个提示设计更多的文本样式：</p>
<p><img src="/2021/08/25/New-Bullseye/25.png" style="zoom:80%;"></p>
<p>这个弹出式窗口一共有四种文本样式。前两种都是现成可以拿来使用的，后面两种需要我们创建一下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AlertBodyText</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> title : <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span>&#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="type">String</span>(title))</span><br><span class="line">            .font(.subheadline)</span><br><span class="line">            .fontWeight(.semibold)</span><br><span class="line">            .multilineTextAlignment(.center)</span><br><span class="line">            .lineSpacing(<span class="number">10.0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">AlertButtonText</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> title : <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span>&#123;</span><br><span class="line">        <span class="type">Text</span>(<span class="type">String</span>(title))</span><br><span class="line">            .bold()</span><br><span class="line">            .padding()</span><br><span class="line">            .font(.callout)</span><br><span class="line">            .foregroundColor(.white)</span><br><span class="line">            .frame(maxWidth:.infinity)<span class="comment">//这边我们令宽度为整个屏幕的宽度。边距另外再加</span></span><br><span class="line">            .background(<span class="type">Color</span>.accentColor)</span><br><span class="line">            .cornerRadius(<span class="number">12.0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/25/New-Bullseye/26.png" style="zoom:80%;"></p>
<h3 id="Display-a-Custom-Alert"><a href="#Display-a-Custom-Alert" class="headerlink" title="Display a Custom Alert"></a>Display a Custom Alert</h3><p>答案：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span>&#123;</span><br><span class="line">           <span class="type">InstructionText</span>(text: <span class="string">"THE SLIDER'S VALUE IS"</span>)</span><br><span class="line">           <span class="type">BigNumberText</span>(target: <span class="string">"50"</span>)</span><br><span class="line">           <span class="type">AlertBodyText</span>(title: <span class="string">"You Scored 82 Points\n🎉🎉🎉"</span>)</span><br><span class="line">           <span class="type">AlertButtonText</span>(title: <span class="string">"Start New Round"</span>)</span><br><span class="line">       &#125;</span><br><span class="line">       .padding()</span><br><span class="line">       .frame(maxWidth:<span class="number">300</span>)</span><br><span class="line">       .background(<span class="type">Color</span>(<span class="string">"BackgroundColor"</span>))</span><br><span class="line">       .cornerRadius(<span class="number">21.0</span>)</span><br><span class="line">       .shadow(radius: <span class="number">10</span>, x: <span class="number">5</span>,y: <span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<p>我自己写的：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span>&#123;</span><br><span class="line">          <span class="type">InstructionText</span>(text: <span class="string">"THE SLIDER'S VALUE IS"</span>)</span><br><span class="line">          <span class="type">BigNumberText</span>(target: <span class="string">"50"</span>)</span><br><span class="line">          <span class="type">AlertBodyText</span>(title: <span class="string">"You Scored 82 Points\n🎉🎉🎉"</span>)</span><br><span class="line">          <span class="type">AlertButtonText</span>(title: <span class="string">"Start New Round"</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      .padding()</span><br><span class="line">      .frame(width: <span class="number">350</span>, height: <span class="number">220</span>, alignment: .center)</span><br><span class="line">      .background(</span><br><span class="line">          <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">25.0</span>)</span><br><span class="line">              .fill(<span class="type">Color</span>(<span class="string">"BackgroundColor"</span>))</span><br><span class="line">              .shadow(radius: <span class="number">20</span>)</span><br><span class="line">      )</span><br></pre></td></tr></table></figure>
<p>其实效果是差不多的，但是我们如果不做图标的话，没必要用一个RoundedRectangle区表示边角弧度，而可以直接用<code>.cornerRadius()</code> 来设置边角弧度。</p>
<p><img src="/2021/08/25/New-Bullseye/27.png" style="zoom:80%;"></p>
<p>那怎么呈现这个Alert呢？首先要把原来的默认Alert去掉。然后做一个 if-else case。如果当前flag为真，那么就显示刚才写好的PointsView, 同时隐藏掉移动条和点击按钮。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ZStack</span> &#123;</span><br><span class="line">    <span class="type">BackgroundView</span>(game: $game)</span><br><span class="line">  <span class="type">VStack</span> &#123;</span><br><span class="line">    <span class="type">InstructionView</span>(game: $game)</span><br><span class="line">        .padding(.bottom,alertIsVisible ? <span class="number">0</span> : <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">if</span>  alertIsVisible&#123;</span><br><span class="line">        <span class="type">PointsView</span>()</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="type">HitMeButton</span>(game: $game, alertIsVisible: $alertIsVisible, sliderValue: $sliderValue)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="keyword">if</span>(!alertIsVisible)&#123;</span><br><span class="line">        <span class="type">SliderView</span>(sliderValue: $sliderValue)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/25/New-Bullseye/2.gif" style="zoom:80%;"></p>
<p>但是现在这个button的按钮功能还没有显示出来。同样的得到的分数也没有渲染上去。完整的结果如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">PointsView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    @<span class="type">Binding</span> <span class="keyword">var</span> game : <span class="type">Game</span></span><br><span class="line">    @<span class="type">Binding</span> <span class="keyword">var</span> alertIsVisible : <span class="type">Bool</span></span><br><span class="line">    @<span class="type">Binding</span> <span class="keyword">var</span> sliderValue : <span class="type">Double</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> rounded = <span class="type">Int</span>(sliderValue.rounded())</span><br><span class="line">        <span class="keyword">let</span> points = game.points(sliderValue: roundedValue)</span><br><span class="line">        <span class="type">VStack</span>&#123;</span><br><span class="line">            <span class="type">InstructionText</span>(text: <span class="string">"THE SLIDER'S VALUE IS"</span>)</span><br><span class="line">            <span class="type">BigNumberText</span>(target: <span class="string">"\(roundedValue)"</span>)</span><br><span class="line">            <span class="type">AlertBodyText</span>(title: <span class="string">"You Scored \(points) Points\n🎉🎉🎉"</span>)</span><br><span class="line">            <span class="type">Button</span>(action: &#123;</span><br><span class="line">                alertIsVisible = <span class="literal">false</span></span><br><span class="line">                game.startNewRound(points:points)</span><br><span class="line">            &#125;, label: &#123;</span><br><span class="line">                <span class="type">AlertButtonText</span>(title: <span class="string">"Start New Round"</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        .padding()</span><br><span class="line">        .frame(width: <span class="number">350</span>, height: <span class="number">220</span>, alignment: <span class="comment">/*@START_MENU_TOKEN@*/</span>.center<span class="comment">/*@END_MENU_TOKEN@*/</span>)</span><br><span class="line">        .background(</span><br><span class="line">            <span class="type">RoundedRectangle</span>(cornerRadius: <span class="comment">/*@START_MENU_TOKEN@*/</span><span class="number">25.0</span><span class="comment">/*@END_MENU_TOKEN@*/</span>)</span><br><span class="line">                .fill(<span class="type">Color</span>(<span class="string">"BackgroundColor"</span>))</span><br><span class="line">                .shadow(radius: <span class="number">20</span>)</span><br><span class="line">        )</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Intro-to-SwiftUI-Animation"><a href="#Intro-to-SwiftUI-Animation" class="headerlink" title="Intro to SwiftUI Animation"></a>Intro to SwiftUI Animation</h3><p>但是iOS的特点是动画流畅 ，我们现在的弹出窗口非常生硬，那么怎么做的更流畅一点呢？</p>
<p><img src="/2021/08/25/New-Bullseye/3.gif" style="zoom:80%;"></p>
<p>我们要做的就是设计一些动画。SwiftUI中，设计动画是很简单的。我们先拿Shapes结构练练手：</p>
<p>首先我们创建一个@State修饰的变量用来启动动画<code>@State private var wideShapes = true</code></p>
<p>我们的设计思路是：当我点击按钮Animate的时候，形状由宽到窄，再按一下恢复。同时原本的环形会以动画的形式消失。我们要做的只是在wideShapes不同时设置两个不同尺寸的形状，然后用<code>withAnimation()</code> 将点击后的形变用动画联系起来即可。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> 			</span><br><span class="line"><span class="keyword">if</span> !wideShapes &#123;</span><br><span class="line">            <span class="type">Circle</span>()</span><br><span class="line">                .strokeBorder(<span class="type">Color</span>.blue, lineWidth: <span class="number">20.0</span>)</span><br><span class="line">                .frame(width: <span class="number">200</span>, height: <span class="number">100.0</span>)</span><br><span class="line">  <span class="comment">// 透明淡出，此外还有.slide(滑出)</span></span><br><span class="line">                .transition(.opacity)</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="type">RoundedRectangle</span>(cornerRadius: <span class="number">20.0</span>)</span><br><span class="line">        .fill(<span class="type">Color</span>.blue)</span><br><span class="line">        .frame(width: wideShapes ? <span class="number">200</span> : <span class="number">100</span>, height: <span class="number">100.0</span>)</span><br><span class="line">      <span class="type">Capsule</span>()</span><br><span class="line">        .fill(<span class="type">Color</span>.blue)</span><br><span class="line">        .frame(width: wideShapes ? <span class="number">200</span> : <span class="number">100</span>, height: <span class="number">100.0</span>)</span><br><span class="line">      <span class="type">Ellipse</span>()</span><br><span class="line">        .fill(<span class="type">Color</span>.blue)</span><br><span class="line">        .frame(width: wideShapes ? <span class="number">200</span> : <span class="number">100</span>, height: <span class="number">100.0</span>)</span><br><span class="line">        <span class="type">Button</span>(action: &#123;</span><br><span class="line">            withAnimation&#123;</span><br><span class="line">                wideShapes.toggle()<span class="comment">//即取反</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, label: &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">"Animate"</span>)</span><br><span class="line">        &#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/25/New-Bullseye/4.gif" style="zoom:80%;"></p>
<p>现在我们为自定义的alert动画，逻辑如下图所示：</p>
<p><img src="/2021/08/25/New-Bullseye/28.png" style="zoom:80%;"></p>
<p>首先要将两个按钮(Hit Me和Start New Round) 设置为<code>withAnimation</code></p>
<p>然后给几个View都加上动画：PointsView、HitMeButton、SliderView</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">ZStack</span> &#123;</span><br><span class="line">      <span class="type">BackgroundView</span>(game: $game)</span><br><span class="line">      <span class="type">VStack</span> &#123;</span><br><span class="line">        <span class="type">InstructionsView</span>(game: $game)</span><br><span class="line">          .padding(.bottom, alertIsVisible ? <span class="number">0</span> : <span class="number">100</span>)</span><br><span class="line">        <span class="keyword">if</span> alertIsVisible &#123;</span><br><span class="line">          <span class="type">PointsView</span>(alertIsVisible: $alertIsVisible, sliderValue: $sliderValue, game: $game)</span><br><span class="line">            .transition(.scale)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="type">HitMeButton</span>(alertIsVisible: $alertIsVisible, sliderValue: $sliderValue, game: $game)</span><br><span class="line">            .transition(.scale)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> !alertIsVisible &#123;</span><br><span class="line">        <span class="type">SliderView</span>(sliderValue: $sliderValue)</span><br><span class="line">          .transition(.scale)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/25/New-Bullseye/5.gif" style="zoom:80%;"></p>
<h3 id="Avoid-Magic-Numbers"><a href="#Avoid-Magic-Numbers" class="headerlink" title="Avoid Magic Numbers"></a>Avoid Magic Numbers</h3><p>我们在编程的过程中，有些数字是要重复使用的。比如说按钮的宽为56.0，按钮的边角弧度为21.0，这样不但难记而且显得很hard coding 因此，我们可以创建一个文件来将它们固定下来。</p>
<p>我们在Models中创建一个文件，用枚举结构来存放这些常量：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Foundation</span><br><span class="line"><span class="keyword">import</span> UIKit</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Constants</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">enum</span> <span class="title">General</span> </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> strokeWidth = <span class="type">CGFloat</span>(<span class="number">2.0</span>)</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> roundedViewLength = <span class="type">CGFloat</span>(<span class="number">56.0</span>)</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> roundRectViewWidth = <span class="type">CGFloat</span>(<span class="number">68.0</span>)</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> roundRectViewHeight = <span class="type">CGFloat</span>(<span class="number">56.0</span>)</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">let</span> roundRectCornerRadius = <span class="type">CGFloat</span>(<span class="number">21.0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需引用时，只要 <code>Constants.General.XXX</code> 即可</p>
<h3 id="Intro-to-Xcode-Shortcuts"><a href="#Intro-to-Xcode-Shortcuts" class="headerlink" title="Intro to Xcode Shortcuts"></a>Intro to Xcode Shortcuts</h3><div class="table-container">
<table>
<thead>
<tr>
<th>快捷键</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>Command+B</td>
<td>Build your app</td>
</tr>
<tr>
<td>Command+R</td>
<td>Run your app</td>
</tr>
<tr>
<td>Command+U</td>
<td>Unit test your app</td>
</tr>
<tr>
<td>Option+Command+p</td>
<td>Preview your app in SwiftUI Canvas</td>
</tr>
<tr>
<td>Option+Command+[</td>
<td>Move a line of code up</td>
</tr>
<tr>
<td>Option+Command+]</td>
<td>Move a line of code down</td>
</tr>
<tr>
<td>Option+Command+0</td>
<td>打开/关闭 右侧栏</td>
</tr>
<tr>
<td>Command+0</td>
<td>打开/关闭 左侧栏</td>
</tr>
<tr>
<td>Shift+Command+O</td>
<td>快速定位/ 类似VSCode中的comman+p</td>
</tr>
<tr>
<td>Command+ ,(逗号)</td>
<td>打开preference</td>
</tr>
</tbody>
</table>
</div>
<h2 id="A-Second-Screen"><a href="#A-Second-Screen" class="headerlink" title="A Second Screen"></a>A Second Screen</h2><h3 id="Challenge-Create-a-Leaderboard-View"><a href="#Challenge-Create-a-Leaderboard-View" class="headerlink" title="Challenge- Create a Leaderboard View"></a>Challenge- Create a Leaderboard View</h3><p>这个部分我们要做一个新的页面，叫做Leaderboard View，里面是一个记录着最高记录的列表。</p>
<p><img src="/2021/08/25/New-Bullseye/30.png" style="zoom:80%;"></p>
<p><img src="/2021/08/25/New-Bullseye/29.png" style="zoom:80%;"></p>
<p>设计思维： 首先我们要实现一个小组件，也就是分数栏。这一行可以通过HStack来实现。然后通过VStack将分数栏叠放。</p>
<h3 id="Intro-to-Size-Classes"><a href="#Intro-to-Size-Classes" class="headerlink" title="Intro to Size Classes"></a>Intro to Size Classes</h3><h3 id="Display-a-Second-Screen"><a href="#Display-a-Second-Screen" class="headerlink" title="Display a Second Screen"></a>Display a Second Screen</h3><h3 id="Intro-to-Swift-Arrays"><a href="#Intro-to-Swift-Arrays" class="headerlink" title="Intro to Swift Arrays"></a>Intro to Swift Arrays</h3><h3 id="Challenge-Leaderboard-Data-Model"><a href="#Challenge-Leaderboard-Data-Model" class="headerlink" title="Challenge- Leaderboard Data Model"></a>Challenge- Leaderboard Data Model</h3><h3 id="Connect-the-Leaderboard"><a href="#Connect-the-Leaderboard" class="headerlink" title="Connect the Leaderboard"></a>Connect the Leaderboard</h3>
          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/" itemprop="url">HtmlandCss基础4-第二部分余下</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-08-21T22:27:07+08:00">
                2021-08-21
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2022-08-22T11:11:06+08:00">
                2022-08-22
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="HtmlandCss基础4"><a href="#HtmlandCss基础4" class="headerlink" title="HtmlandCss基础4"></a>HtmlandCss基础4</h1><h2 id="Forms"><a href="#Forms" class="headerlink" title="Forms"></a>Forms</h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><blockquote>
<ul>
<li>Build forms</li>
<li>Style forms</li>
<li>Text fields</li>
<li>Data lists</li>
<li>Drop-down lists</li>
<li>Check boxes</li>
<li>Radio buttons</li>
<li>Sliders</li>
<li>File inputs</li>
<li>Hidden fields</li>
</ul>
</blockquote>
<h3 id="Creating-a-Basic-Form"><a href="#Creating-a-Basic-Form" class="headerlink" title="Creating a Basic Form"></a>Creating a Basic Form</h3><p>现在我们来创建一个基本的表单。</p>
<p>首先表单的标签是<code>&lt;form&gt;</code> ，在一个表单里面还可以有多个 <code>&lt;input&gt;</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"name"</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">label</span>&gt;</span>     </span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"text"</span>  <span class="attr">name</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们这里之所以使用<code>label</code>是因为<code>lable</code>是行内块，而用<code>&lt;p&gt;</code>元素是段落块，导致Name会出现在文本框上面，不美观。</p>
<p>此外，这里将label与input联系起来了，<code>for=&#39;name&#39;,id=&#39;name&#39;</code> 匹配之后，直接点击label就可以将光标锁定到文本框，如下所示</p>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/2.gif" style="zoom:150%;"></p>
<p>此外还有<code>email</code>类型的，这样，当提交表单的时候如果输入的不是email，就会报错，能提供一定程度上的数值验证。</p>
<p>最后我们写两个button，很简单：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> &gt;</span>Register<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"reset"</span> &gt;</span>Clear<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/2.png" style="zoom:100%;"></p>
<h3 id="Styling-Forms"><a href="#Styling-Forms" class="headerlink" title="Styling Forms"></a>Styling Forms</h3><p>我们发现这个表单太丑了，怎么美化一下呢？</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line">  // 首先改一下字体，设置一下例页边距</span><br><span class="line">    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;</span><br><span class="line">    <span class="selector-tag">line-height</span>: 1<span class="selector-class">.5</span>;</span><br><span class="line">    <span class="selector-tag">padding</span>: 1<span class="selector-tag">rem</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">form</span> &#123;</span><br><span class="line">   // 修改表单的页边距</span><br><span class="line">    <span class="selector-tag">padding</span>: 10<span class="selector-tag">px</span> 20<span class="selector-tag">px</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">label</span>&#123;</span><br><span class="line">  // 将label设置为块呈现</span><br><span class="line">    <span class="selector-tag">display</span>: <span class="selector-tag">block</span>;</span><br><span class="line">&#125;</span><br><span class="line">// 可以用这种语法来选择input类型</span><br><span class="line"><span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">'text'</span>]</span>,</span><br><span class="line"><span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">'email'</span>]</span>&#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ccc</span>;</span><br><span class="line">    <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0.5rem</span> <span class="number">0.7rem</span>;</span><br><span class="line">  //设置一下小动画，让点击效果更圆润</span><br><span class="line">    <span class="selector-tag">transition</span>: <span class="selector-tag">border-color</span> 0<span class="selector-class">.15s</span>,<span class="selector-tag">box-shadow</span> 0<span class="selector-class">.15s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">'text'</span>]</span><span class="selector-pseudo">:focus</span>,</span><br><span class="line"><span class="selector-tag">input</span><span class="selector-attr">[type=<span class="string">'email'</span>]</span><span class="selector-pseudo">:focus</span>&#123;</span><br><span class="line">    <span class="attribute">border-color</span>: <span class="number">#7db0fb</span>;</span><br><span class="line">  // 去掉外轮廓</span><br><span class="line">    <span class="selector-tag">outline</span>: 0; </span><br><span class="line">  // 添加一些阴影</span><br><span class="line">    <span class="selector-tag">box-shadow</span>: 0 0 0 4<span class="selector-tag">px</span> <span class="selector-tag">rgba</span>(24,117,255,0<span class="selector-class">.25</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">button</span>&#123;</span><br><span class="line">  // 对按钮设置背景、字体颜色、边框等</span><br><span class="line">    <span class="selector-tag">background</span>: <span class="selector-id">#0d6efd</span>;</span><br><span class="line">    <span class="selector-tag">color</span>: <span class="selector-id">#fff</span>;</span><br><span class="line">    <span class="selector-tag">padding</span>: 0<span class="selector-class">.5rem</span> 0<span class="selector-class">.7rem</span>;</span><br><span class="line">    <span class="selector-tag">border</span>: 0;</span><br><span class="line">    <span class="selector-tag">border-radius</span>: 5<span class="selector-tag">px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.form-group</span> &#123;</span><br><span class="line">  //设置底部间隙</span><br><span class="line">    <span class="selector-tag">margin-bottom</span>: 1<span class="selector-tag">rem</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/3.png" style="zoom:100%;"></p>
<p>但是如果所有css都我们自己写，这未免也太过繁琐了。因此接下来我们来学CSS Framework</p>
<h3 id="CSS-Frameworks"><a href="#CSS-Frameworks" class="headerlink" title="CSS Frameworks"></a>CSS Frameworks</h3><p>CSS 框架其实就是一个已经写好了的CSS代码库。我们常用的CSS库如下：</p>
<blockquote>
<ul>
<li>Bootstrap</li>
<li>Foundation</li>
<li>UI Kit</li>
<li>Semantic UI</li>
<li>Materialize</li>
<li>Miligram</li>
</ul>
</blockquote>
<p>这里我们要使用Bootstrap来美化表单。要下载Bootstrap,访问：<a href="https://getbootstrap.com/docs/5.1/getting-started/download/即可。我们采用CDN这种下载方式，只要在html文件中引入一个连接即可：" target="_blank" rel="noopener">https://getbootstrap.com/docs/5.1/getting-started/download/即可。我们采用CDN这种下载方式，只要在html文件中引入一个连接即可：</a></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span></span></span><br><span class="line"><span class="tag">      <span class="attr">href</span>=<span class="string">"https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">rel</span>=<span class="string">"stylesheet"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">integrity</span>=<span class="string">"sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">crossorigin</span>=<span class="string">"anonymous"</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后我们就可以使用Bootstrap了。</p>
<p>比如说我要用Bootstrap中的 Email 文本框，就可以模仿bootstrap的写法来修改我们的html页面。因为Bootstrap中对于email有其特殊的class名字,Bootstrap内置的CSS文件就会渲染这些类。</p>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/4.png" style="zoom:100%;"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-label"</span> <span class="attr">for</span>=<span class="string">"name"</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">id</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"text"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"form-label"</span> <span class="attr">for</span>=<span class="string">"email"</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">id</span>=<span class="string">"email"</span> <span class="attr">type</span>=<span class="string">"email"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>对于按钮，Bootstrap也有自己的一套代码库：</p>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/5.png" style="zoom:100%;"></p>
<p>我们发现文本框太长了，而且间距也不是很好，我们可以这样来调整</p>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/6.png" style="zoom:100%;"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"w-50"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"mb-3"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>w-50</code>就是说，这个表单占据页面宽度的一半</p>
<p><code>mb-3</code> 就是说 margin bottom，第三档次的间隙(一共5档，越大越宽)</p>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/7.png" style="zoom: 33%;"></p>
<p>此外bootstrap还有很多组件，我们可以自行调用。</p>
<p>然而当我们使用CDN方法时，可能会导致下载css文件的时间过长从而对用户体验造成影响。因此我们再介绍一个CSS框架：Milligram</p>
<p>milligram不需要我们记下很多class(像bootstrap一样)，只要引入一个链接，其他照常写html即可，如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./css/normalize.css"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"./css/form.css"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/milligram/1.4.1/milligram.css"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"name"</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"text"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"email"</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">"email"</span> <span class="attr">type</span>=<span class="string">"email"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span>  <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>Register<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span>  <span class="attr">type</span>=<span class="string">"reset"</span>&gt;</span>Clear<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/8.png" style="zoom: 33%;"></p>
<p>而且这个css是很轻量级的，下载只需要2.5KB. 只是文本框长度啥的还需要自己调一下</p>
<h3 id="Text-Fields"><a href="#Text-Fields" class="headerlink" title="Text Fields"></a>Text Fields</h3><p>现在我们来研究文本框。文本框有很多类型，比如说最简单的就是</p>
<p><code>&lt;input type =&quot;text&quot; /&gt;</code></p>
<p>如果我们想限制填入文本的类型，比如我们只想输入的是数字，可以这么写：</p>
<p><code>&lt;input type = &quot;number&quot; /&gt;</code></p>
<p>比如我希望输入的是密码，需要隐藏，可以这么写：</p>
<p><code>&lt;input type = &quot;password&quot; /&gt;</code></p>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/9.png" style="zoom: 33%;"></p>
<p>如果需要填写日期，可以这么写：</p>
<p><code>&lt;input type=&quot;date&quot;/&gt;</code></p>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/10.png" style="zoom: 33%;"></p>
<p>以及之前我们介绍过的： <code>&lt;input type = &quot;email&quot; /&gt;</code></p>
<p>如果我们不想要文本框，而是一个文本块。可以这么写：</p>
<p><code>&lt;textarea cols=&quot;30&quot;  row=&quot;10&quot;&gt;&lt;/textarea&gt;</code> 说明这个文本块可以容纳十行三十列的文本：</p>
<p>我们还可以为每一个文本框(块)设置占位符。设置<code>placeholder</code>属性即可</p>
<p>此外我们可以设置文本框只读，只要设置<code>readonly</code>或者<code>disable</code>即可。readonly是可以选中文本框，但是disable连选中都不可以。<code>&lt;input type=&quot;email&quot; readonly value=&quot;111&quot;&gt;</code></p>
<p>如果我们要设置文本框的最大输入个数，可以设置<code>maxlength</code>属性。比如<code>&lt;input type=&quot;email&quot; maxvalue=&quot;5&quot;&gt;</code></p>
<p>如果我们要设置自动选中，可以设置<code>autofocus</code>属性。<code>&lt;input type=&quot;email&quot; autofocus&gt;</code> 这样当刷新页面时会自动选中该文本框。</p>
<p>需要注意的是，<code>textarea</code>并没有value这个属性，若要设置占位符，可以直接在标签内写 <code>&lt;textarea cols=&quot;30&quot;  row=&quot;10&quot;&gt;Comment...&lt;/textarea&gt;</code></p>
<p>这节课我们主要学了这几种属性：</p>
<blockquote>
<p>type : text | email | password | date | number</p>
<p>cols, rows </p>
<p>placeholder</p>
<p>maxlength</p>
<p>布尔属性，不需要为其设置值： readonly | disable | autofoucus</p>
</blockquote>
<h3 id="Data-Lists"><a href="#Data-Lists" class="headerlink" title="Data Lists"></a>Data Lists</h3><p>现在我们来学习如何做一个下拉式选择表单：</p>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/11.png" style="zoom: 67%;"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">list</span> = <span class="string">"countries"</span> <span class="attr">autocomplete</span>=<span class="string">"off"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">datalist</span> <span class="attr">id</span> = <span class="string">"countries"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span>&gt;</span>Austria<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span>&gt;</span>Canada<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span>&gt;</span>America<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">option</span>&gt;</span>China<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">datalist</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>首先我们要放一个文本框，让其list属性等于datalist的id属性。然后再在datalist下设置<code>&lt;option&gt;</code></p>
<p><code>&lt;option data-value=&quot;1&quot;&gt;Austria&lt;/option&gt;</code> 此外我们最好设置一下<code>data-value</code>属性以便后台知道我们提交时到底选中的是几号选项。</p>
<p>需要注意的是，这个下拉列表的样式并不是我们说了算的，而是chrome的默认样式，我们可以通过自己写css来修改这个样式。</p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/datalist" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/HTML/Element/datalist</a></p>
<p>访问上面的网站我们可以找到一些样式。</p>
<h3 id="Drop-down-Lists"><a href="#Drop-down-Lists" class="headerlink" title="Drop-down Lists"></a>Drop-down Lists</h3><p>因为虽然我们有选择列表，但是用户还是可以填入它们想写的任何文本。因此我们还需要对其做一定的限制。这就要用到 Drop-down List了</p>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/12.png" style="zoom: 67%;"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">select</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">""</span>&gt;</span>Select a Course<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"1"</span> <span class="attr">selected</span> &gt;</span>HTML<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"2"</span>&gt;</span>CSS<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"3"</span>&gt;</span>JAVASCRIPT<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Drop-down List 是不能自行填写其他内容的。和Data List 的区别在于将<code>&lt;datalist&gt;</code>替换成<code>&lt;select&gt;</code> 即可。</p>
<p>此外我们还可以设置布尔属性：<code>selected</code> 即自动选中。</p>
<hr>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/13.png" style="zoom: 67%;"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">select</span> <span class="attr">multiple</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"1"</span> <span class="attr">selected</span> &gt;</span>HTML<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"2"</span>&gt;</span>CSS<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"3"</span>&gt;</span>JAVASCRIPT<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>只要我们给select标签设置multiple属性，那么就没有弹出式表单了。直接可以在文本框里选，就是比较丑。</p>
<hr>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/14.png" style="zoom: 67%;"></p>
<p>最后，select标签里面还可以以组为单位设置选项。组标签为<code>&lt;optgroup&gt;</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">select</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">optgroup</span> <span class="attr">label</span> = <span class="string">"Front-end Courses"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span>HTML<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"2"</span>&gt;</span>CSS<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"3"</span>&gt;</span>JAVASCRIPT<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">optgroup</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">optgroup</span> <span class="attr">label</span> = <span class="string">"Back-end Courses"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"1"</span> &gt;</span>Node.js<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"2"</span>&gt;</span>ASP.Net<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">"3"</span>&gt;</span>Django<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">optgroup</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Check-Boxes"><a href="#Check-Boxes" class="headerlink" title="Check Boxes"></a>Check Boxes</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"label-inline"</span> <span class="attr">for</span>=<span class="string">"front-end"</span>&gt;</span>Front-end<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">id</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"label-inline"</span> <span class="attr">for</span>=<span class="string">"back-end"</span>&gt;</span>Back-end<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/15.png" style="zoom: 67%;"></p>
<p>这个类型的表单叫做复选框。类型为 checkbox</p>
<p>但是单独的<code>&lt;input type=&quot;checkbox&quot; id=&quot;&quot;&gt;</code>仅仅是一个可以打钩的框框。如果我们想在旁边加上文字，需要写一个label元素。且class属性需要填写<code>label-inline</code> 。这样milligram就会将这个label渲染成行内呈现而不是块呈现。</p>
<p>此外，checkbox也有<code>disable</code>、<code>checked</code> 这类布尔属性</p>
<h3 id="Radio-Buttons"><a href="#Radio-Buttons" class="headerlink" title="Radio Buttons"></a>Radio Buttons</h3><p>说完了复选框，现在我们来说单选按钮。</p>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/16.png" style="zoom:80%;"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"membership"</span> <span class="attr">id</span>=<span class="string">"silver"</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"silver"</span> <span class="attr">class</span> = <span class="string">"label-inline"</span> &gt;</span>silver<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"membership"</span> <span class="attr">id</span>=<span class="string">"gold"</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"gold"</span> <span class="attr">class</span> = <span class="string">"label-inline"</span> &gt;</span>gold<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>和checkbox 大差不差。</p>
<p>当然，Radio Buttons也有<code>disable</code>、<code>checked</code> 这类布尔属性</p>
<h3 id="Sliders"><a href="#Sliders" class="headerlink" title="Sliders"></a>Sliders</h3><p>现在我们来创建滑动条- 类型是<code>range</code>。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"range"</span> <span class="attr">min</span>=<span class="string">"0"</span> <span class="attr">max</span> = <span class="string">"100"</span> <span class="attr">value</span> = <span class="string">"90"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/1.gif" style="zoom:150%;"></p>
<p>但是现在无法将滑动条的数值显示出来，这是JavaScript需要做的事情。</p>
<h3 id="File-Inputs"><a href="#File-Inputs" class="headerlink" title="File Inputs"></a>File Inputs</h3><p>现在我们来看文件选择按钮。</p>
<p>最基础的是这样的：<code>&lt;input type = &quot;file&quot; /&gt;</code></p>
<p>此外还可以加上 <code>multiple</code>这个布尔属性，允许选择多个文件</p>
<p>也可以设置<code>accept=&quot;&quot;</code>属性，用来指定选择文件的类型。</p>
<blockquote>
<ul>
<li><code>.jpg</code> 只能选择jpg</li>
<li><code>.jpg, .png</code> 可以选择jpg或者png</li>
<li><code>image/*</code> 可以选择所有类型的图片，还有<code>audio/*</code>和<code>video/*</code></li>
</ul>
</blockquote>
<h3 id="Grouping-Related-Fields"><a href="#Grouping-Related-Fields" class="headerlink" title="Grouping Related Fields"></a>Grouping Related Fields</h3><p>fieldset 元素可将表单内的相关元素分组。</p>
<p><code>&lt;fieldset&gt;</code>标签将表单内容的一部分打包，生成一组相关表单的字段。当一组表单元素放到 <code>&lt;fieldset&gt;</code> 标签内时，浏览器会以特殊方式来显示它们，它们可能有特殊的边界、3D 效果，或者甚至可创建一个子表单来处理这些元素。</p>
<p>比如：</p>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/17.png" style="zoom: 33%;"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">legend</span>&gt;</span>Billing Address<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">fieldset</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">legend</span>&gt;</span>Payment<span class="tag">&lt;/<span class="name">legend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">fieldset</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Hidden-Fields"><a href="#Hidden-Fields" class="headerlink" title="Hidden Fields"></a>Hidden Fields</h3><p>HiddenField控件顾名思义就是隐藏输入框的服务器控件，它能让你保存那些不需要显示在页面上的且对安全性要求不高的数据。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span> = <span class="string">"course-id"</span> <span class="attr">value</span> = <span class="string">"1234"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="Data-Validation"><a href="#Data-Validation" class="headerlink" title="Data Validation"></a>Data Validation</h3><p>数据验证其实是一项很重要的功能，否则会带来千奇百怪的bug。那么怎么保证客户输入的数据符合规范呢？</p>
<p>数据验证既可以在后端做(<a href="https://jasonxqh.github.io/2020/06/07/Nodejs基础3/#Mongo-Data-Validation">Mongo - Data Validation</a>) 也可在前端用 html完成一些简单的数据验证。</p>
<p>最基本的，就是规定某个文本框一定要填写：</p>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/7.gif"></p>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">required</span> &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>SUBMIT<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>​      <code>&lt;input type=&quot;text&quot; required minlength=&quot;3&quot; maxlength=&quot;10&quot; /&gt;</code> 还可以设置最少填入字数以及最大填入字数</p>
</blockquote>
<h3 id="Submitting-the-Form"><a href="#Submitting-the-Form" class="headerlink" title="Submitting the Form"></a>Submitting the Form</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"Name"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"Email"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这是最简单的一张表单。对于提交按钮有两种写法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">input</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>但是第二种不能给其另外添加icon了</p>
<p>设计完表单之后我们就要提交了。一般来说提交到我们自己写的后台，如Node、Django之类的。但是这里为了方便起见，我们用一个网站来实现后台功能：<a href="https://formspree.io/forms" target="_blank" rel="noopener">https://formspree.io/forms</a></p>
<p>注册以后，我们创建一个新的 Form，与此同时该网站会自动生成一个后台。我们只需要复制一个连接到我们的HTML文件中即可：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"https://formspree.io/f/xzbykqky"</span> <span class="attr">method</span> = <span class="string">"POST"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"Name"</span> <span class="attr">name</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"Email"</span> <span class="attr">name</span>=<span class="string">"email"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>Submit<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意，这边要成功提交，需要设置 name属性以及method属性</p>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/8.gif"></p>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/18.png"></p>
<p>现在我们来解释一下 GET和POST有什么区别：</p>
<p>当我们设置Method为POST的时候，数据是放在请求体里的。</p>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/19.png"></p>
<p>而当我们设置Method为GET的时候，数据是放在URL中的</p>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/20.png"></p>
<blockquote>
<p>Google搜索都是用GET方式的。</p>
</blockquote>
<h2 id="Transformations-Transitions-and-Animation"><a href="#Transformations-Transitions-and-Animation" class="headerlink" title="Transformations,Transitions,and Animation"></a>Transformations,Transitions,and Animation</h2><p>这一章我们要学习一些关于变形、过渡动画的内容。</p>
<h3 id="Transformations"><a href="#Transformations" class="headerlink" title="Transformations"></a>Transformations</h3><p>CSS中有一个专门的属性叫 <code>transform</code> 里面有很多方法,最基本的有：</p>
<blockquote>
<ol>
<li><code>rotate(angle)</code> :  定义 2D 旋转，在参数中规定角度。</li>
<li><code>skew(x-angle,y-angle)</code> :    定义沿着 X 和 Y 轴的 2D 倾斜转换。</li>
<li><code>scale(x[,y]?)</code>    定义 2D 缩放转换。</li>
<li><code>translate(x,y)</code>    定义 2D 转换。</li>
</ol>
</blockquote>
<p>比如说我设置了一个Box，然后设置了CSS格式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">60deg</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样当我的鼠标移动到box上去，box就会正向旋转60°。当这个变化是瞬时的，并不是一个动画。如果是<code>-60deg</code> ，那么就是反向旋转60°</p>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/9.gif"></p>
<p>scale是放缩，可大可小，括号内写的是放大或缩小的倍数</p>
 <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1.5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/10.gif"></p>
<p>如果是<code>skew</code>那么就是斜线变换, 若是负数就是反向变换：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    <span class="attribute">transform </span>: <span class="built_in">skew</span>(<span class="number">15deg</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/11.gif"></p>
<p>如果是<code>translate(10px)</code>那么就会让box沿着水平线正向移动10px，如果是<code>translate(10px,10px)</code>，那么就会在水平移动的时候同时在垂直方向移动。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">10px</span>,<span class="number">10px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/12.gif"></p>
<p>此外，还可以安排多个转变。比如先移动，然后旋转：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">50px</span>) <span class="built_in">rotate</span>(<span class="number">45deg</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/13.gif"></p>
<p>需要注意的是，变形的顺序不同对最终的结果影响也是很大的，比如我把 rotate 和 translate 交换位置：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">45deg</span>) <span class="built_in">translate</span>(<span class="number">50px</span>) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/14.gif"></p>
<h3 id="3D-Transformations"><a href="#3D-Transformations" class="headerlink" title="3D Transformations"></a>3D Transformations</h3><p>上面我们说的都是关于x、y轴的变换，其实每一种变换都是可以在3维空间中进行的 </p>
<div class="table-container">
<table>
<thead>
<tr>
<th>translateX(<em>x</em>)</th>
<th>定义 3D 转化，仅使用用于 X 轴的值。</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>translateY(y)</code></td>
<td>定义 3D 转化，仅使用用于 Y 轴的值。</td>
</tr>
<tr>
<td><code>translateZ(z)</code></td>
<td>定义 3D 转化，仅使用用于 Z 轴的值。</td>
</tr>
<tr>
<td><code>scale3d(x,y,z)</code></td>
<td>定义 3D 缩放转换。</td>
</tr>
<tr>
<td><code>scaleX(x)</code></td>
<td>定义 3D 缩放转换，通过给定一个 X 轴的值。</td>
</tr>
<tr>
<td><code>scaleY(y)</code></td>
<td>定义 3D 缩放转换，通过给定一个 Y 轴的值。</td>
</tr>
<tr>
<td><code>scaleZ(z)</code></td>
<td>定义 3D 缩放转换，通过给定一个 Z 轴的值。</td>
</tr>
<tr>
<td><code>rotate3d(x,y,z,angle)</code></td>
<td>定义 3D 旋转。</td>
</tr>
<tr>
<td><code>rotateX(angle)</code></td>
<td>定义沿 X 轴的 3D 旋转。</td>
</tr>
<tr>
<td><code>rotateY(angle)</code></td>
<td>定义沿 Y 轴的 3D 旋转。</td>
</tr>
<tr>
<td><code>rotateZ(angle)</code></td>
<td>定义沿 Z 轴的 3D 旋转。</td>
</tr>
<tr>
<td><code>perspective(n)</code></td>
<td>定义 3D 转换元素的透视视图。</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>translate </li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> <span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">	<span class="attribute">transform</span>: <span class="built_in">perspective</span>(<span class="number">200px</span>) <span class="built_in">translateZ</span>(-<span class="number">50px</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>perspective()</code>    规定 3D 元素的透视效果。 </p>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/15.gif"></p>
<ul>
<li>rotate</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> <span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">	<span class="attribute">transform</span>: <span class="built_in">perspective</span>(<span class="number">200px</span>) <span class="built_in">rotateY</span>(<span class="number">45deg</span>)</span><br><span class="line">	transform-origin: <span class="number">0</span> <span class="number">50%</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中<code>transform-Origin</code>属性允许我更改转换元素的位置。其中两参数分别代表视图被放在x轴、y轴的何处。</p>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/16.gif"></p>
<h3 id="Transitions"><a href="#Transitions" class="headerlink" title="Transitions"></a>Transitions</h3><p>上面我们展示的都是“突变”，那么是时候在它们之间加点过渡了。</p>
<p>transition 属性设置元素当过渡效果，四个简写属性为：</p>
<ul>
<li>transition-property</li>
<li>transition-duration</li>
<li>transition-timing-function</li>
<li>transition-delay</li>
</ul>
<p>语法：<code>transition:  property duration timing-function delay;</code></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">值</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">transition-property</td>
<td style="text-align:left">指定CSS属性的name，transition效果</td>
</tr>
<tr>
<td style="text-align:left">transition-duration</td>
<td style="text-align:left">transition效果需要指定多少秒或毫秒才能完成</td>
</tr>
<tr>
<td style="text-align:left">transition-timing-function</td>
<td style="text-align:left">指定transition效果的转速曲线</td>
</tr>
<tr>
<td style="text-align:left">transition-delay</td>
<td style="text-align:left">定义transition效果开始的时候</td>
</tr>
</tbody>
</table>
</div>
<p>比如我要对一个旋转做过渡效果：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background</span>: gold;</span><br><span class="line">    <span class="attribute">transition</span>: transform <span class="number">0.5s</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">	<span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">45deg</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/17.gif"></p>
<p>此外我们可以设置运动的快慢：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">transition: transform 0.5s ease-in; //先快后慢</span><br><span class="line">transition: transform 0.5s ease-out;//先慢后快</span><br></pre></td></tr></table></figure>
<p>还可以设置<code>cubic-bezier()</code>函数，来自定义变换速度：<a href="https://cubic-bezier.com/#.17,.67,.83,.67" target="_blank" rel="noopener">到这里去定制</a></p>
<p>我设置 <code>transition-delay</code> 为1s，那么就说嘛我鼠标移动到box后一秒才出发过渡。</p>
<p>此外我们还可以设置颜色渐变:</p>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/18.gif"></p>
<h3 id="Animation"><a href="#Animation" class="headerlink" title="Animation"></a>Animation</h3><ul>
<li>语法</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">animation: name duration timing-function delay iteration-count direction fill-mode play-state;</span><br><span class="line">或者一个一个标签定义。</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">值</th>
<th style="text-align:left">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><em><a href="https://www.runoob.com/cssref/css3-pr-animation-name.html" target="_blank" rel="noopener">animation-name</a></em></td>
<td style="text-align:left">指定要绑定到选择器的关键帧的名称</td>
</tr>
<tr>
<td style="text-align:left"><em><a href="https://www.runoob.com/cssref/css3-pr-animation-duration.html" target="_blank" rel="noopener">animation-duration</a></em></td>
<td style="text-align:left">动画指定需要多少秒或毫秒完成</td>
</tr>
<tr>
<td style="text-align:left"><em><a href="https://www.runoob.com/cssref/css3-pr-animation-timing-function.html" target="_blank" rel="noopener">animation-timing-function</a></em></td>
<td style="text-align:left">设置动画将如何完成一个周期</td>
</tr>
<tr>
<td style="text-align:left"><em><a href="https://www.runoob.com/cssref/css3-pr-animation-delay.html" target="_blank" rel="noopener">animation-delay</a></em></td>
<td style="text-align:left">设置动画在启动前的延迟间隔。</td>
</tr>
<tr>
<td style="text-align:left"><em><a href="https://www.runoob.com/cssref/css3-pr-animation-iteration-count.html" target="_blank" rel="noopener">animation-iteration-count</a></em></td>
<td style="text-align:left">定义动画的播放次数。</td>
</tr>
<tr>
<td style="text-align:left"><em><a href="https://www.runoob.com/cssref/css3-pr-animation-direction.html" target="_blank" rel="noopener">animation-direction</a></em></td>
<td style="text-align:left">指定是否应该轮流反向播放动画。</td>
</tr>
<tr>
<td style="text-align:left"><a href="https://www.runoob.com/cssref/css3-pr-animation-fill-mode.html" target="_blank" rel="noopener">animation-fill-mode</a></td>
<td style="text-align:left">规定当动画不播放时（当动画完成时，或当动画有一个延迟未开始播放时），要应用到元素的样式。</td>
</tr>
<tr>
<td style="text-align:left"><em><a href="https://www.runoob.com/cssref/css3-pr-animation-play-state.html" target="_blank" rel="noopener">animation-play-state</a></em></td>
<td style="text-align:left">指定动画是否正在运行或已暂停。</td>
</tr>
<tr>
<td style="text-align:left">initial</td>
<td style="text-align:left">设置属性为其默认值。 <a href="https://www.runoob.com/cssref/css-initial.html" target="_blank" rel="noopener">阅读关于 <em>initial</em>的介绍。</a></td>
</tr>
<tr>
<td style="text-align:left">inherit</td>
<td style="text-align:left">从父元素继承属性。 <a href="https://www.runoob.com/cssref/css-inherit.html" target="_blank" rel="noopener">阅读关于 <em>initinherital</em>的介绍。</a></td>
</tr>
</tbody>
</table>
</div>
<p>首先，我们创建了一个animation，叫做pop。在pop中我们要定义一些关键帧，比如这里我设置了在一开始是不懂得，到了四分之一的时候会变大，到了一半的时候会旋转，到了最后会变回原样。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> pop &#123;</span><br><span class="line">    0% &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">scale</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    25%  &#123;</span><br><span class="line">        <span class="attribute">transform</span>:<span class="built_in">scale</span>(<span class="number">1.3</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    50% &#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">45deg</span>);</span><br><span class="line">        <span class="attribute">background</span>: tomato;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    100%&#123;</span><br><span class="line">        <span class="attribute">transform</span>: <span class="built_in">rotate</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100px</span>;</span><br><span class="line">    <span class="attribute">background</span>: gold;</span><br><span class="line">    <span class="attribute">animation-name</span>: pop;</span><br><span class="line">    <span class="attribute">animation-duration</span>: <span class="number">4s</span>;</span><br><span class="line">    <span class="attribute">animation-delay</span>: <span class="number">1s</span>;</span><br><span class="line">    <span class="attribute">animation-iteration-count</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">animation-timing-function</span>: ease-out;</span><br><span class="line">    <span class="attribute">animation-direction</span>: alternate;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/21/HtmlandCss%E5%9F%BA%E7%A1%804-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E4%BD%99%E4%B8%8B/19.gif"></p>
<h3 id="Reusable-Animations"><a href="#Reusable-Animations" class="headerlink" title="Reusable Animations"></a>Reusable Animations</h3><p>如果我写了一个很好地动画，想给很多的元素用，但是又不想写这么多的重复代码，怎么办？ </p>
<p>我们可以直接对一个类进行渲染，比如：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.animation-pop</span> &#123;</span><br><span class="line"> 		<span class="attribute">animation-name</span>: pop;</span><br><span class="line">    <span class="attribute">animation-duration</span>: <span class="number">4s</span>;</span><br><span class="line">    <span class="attribute">animation-delay</span>: <span class="number">1s</span>;</span><br><span class="line">    <span class="attribute">animation-iteration-count</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">animation-timing-function</span>: ease-out;</span><br><span class="line">    <span class="attribute">animation-direction</span>: alternate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样，当某个元素要用这套动画的时候，只要在class中加上<code>animation-pop</code>即可。</p>
<p>最后来介绍一下<a href="https://animate.style/" target="_blank" rel="noopener">Animate</a>网站，它有很多现成的动画供我们使用。只要在HTTP文件中引入一个链接即可</p>
<p>然后，只要给想要动画的元素加一个类，就可以获得该动画了</p>
<h2 id="Writing-Clean-Maintainable-CSS"><a href="#Writing-Clean-Maintainable-CSS" class="headerlink" title="Writing Clean,Maintainable CSS"></a>Writing Clean,Maintainable CSS</h2><h3 id="CSS-Best-Practices"><a href="#CSS-Best-Practices" class="headerlink" title="CSS Best Practices"></a>CSS Best Practices</h3><p>接下来我们来介绍几个能让CSS简洁、可维护的好习惯</p>
<ol>
<li>Follw a naming convention         命名要符合规范<blockquote>
<p>通常有这样几种CSS命名规范： </p>
<ul>
<li>.nav-bar {}     Kebab case  词与词之间用<code>-</code> 隔开</li>
<li>.navBar {}      Camel case</li>
<li>.NavBar {}     Pascal case</li>
<li>.nav_bar{}     Snake case</li>
</ul>
</blockquote>
</li>
</ol>
<ol>
<li>Create logical section in your stylesheet </li>
</ol>
<p>写一个CSS文件需要组织得富有逻辑。比如说：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Basic styles */</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">/* Typography */</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">/* Forms */</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">/* Navigation Bar */</span></span><br></pre></td></tr></table></figure>
<ol>
<li>Avoid over-specific selectors ： 不要写特别具体的选择器</li>
</ol>
<p>比如说有一个列表：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class="nav"&gt;</span><br><span class="line">    &lt;ul class="item"&gt;</span><br><span class="line">        &lt;li class = "item"&gt;Link 1&lt;/li&gt;</span><br><span class="line">        &lt;li class = "item"&gt;Link 2&lt;/li&gt;</span><br><span class="line">        &lt;li class = "item"&gt;Link 3&lt;/li&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<p>理想的选择器是这样的：<code>.nav .item</code></p>
<p>我们不要搞得很复杂比如：<code>div.nav &gt; ul.items &gt; li</code> ,这样耦合度太高了</p>
<ol>
<li>合理的类命名。</li>
</ol>
<p>我们同样举这个例子，如果有一个针对 <code>.item</code>的一般性的css样式，那么很可能其样式会覆盖我们上面指定的<code>.nav .item</code>.因此，我们可以将 <code>&lt;li class = &quot;item&quot;&gt;Link 1&lt;/li&gt;</code> 改为<code>&lt;li class = &quot;nav-item&quot;&gt;Link 1&lt;/li&gt;</code>。用来表明该item是在nav中的。</p>
<ol>
<li><p>不要使用<code>!important</code></p>
</li>
<li><p>Sort CSS properties ： 对于乱糟糟的CSS属性，我们最好按照一定顺序排列一下(可以使字母表顺序)</p>
</li>
</ol>
<p>比如：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.nav-item</span> &#123;</span><br><span class="line">	<span class="attribute">color</span>: tomato;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">	<span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">	<span class="attribute">font-weight</span>:bold;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以shift+command+p 呼唤出控制面板，搜索sort后排序。</p>
<ol>
<li>Take advantage of style inheritance</li>
</ol>
<p>对于字体这类的作用范围比较广的样式，我们可以对总体设置，这样细枝末节的字体就会自动继承其父元素的字体，就不需要我们再去设置了。</p>
<ol>
<li>Extract repetitive patterns</li>
<li>Keep code DRY(Don’t repeat your code)</li>
</ol>
<h3 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h3><p>对于一些常用的样式，比如说常见的颜色，我们不需要一遍一遍得打rbg，而是可以用变量将它们存储起来：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:root</span>&#123;</span><br><span class="line">    <span class="attribute">--primary-color </span>: <span class="number">#ffdd36</span>;</span><br><span class="line">    <span class="attribute">--border-size</span>: <span class="number">2px</span>;</span><br><span class="line">    <span class="attribute">--border-radius</span>: <span class="number">10px</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.one</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--primary-color);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.two</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">var</span>(--primary-color);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意变量书写和引用的格式</p>
<h3 id="Object-oriented-CSS"><a href="#Object-oriented-CSS" class="headerlink" title="Object-oriented CSS"></a>Object-oriented CSS</h3><h3 id="BEM"><a href="#BEM" class="headerlink" title="BEM"></a>BEM</h3><p>BEM的全称是：Block Element Modifier</p>
<p>BEM是一个非常有用，强大，简单的命名约定，可以让你的前端代码更容易阅读和理解，更容易协作，更容易控制。</p>
<p>当然，通常人们会认为BEM写法难看，但是他的好处远远超过它外观上的那点瑕疵。</p>
<ol>
<li>BEM命名约定</li>
</ol>
<p>BEM：块（block）、元素（element）、修饰符（modifier）下面是命名约定的模式</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.block</span>&#123;&#125;</span><br><span class="line"><span class="selector-class">.block__element</span>&#123;&#125;</span><br><span class="line"><span class="selector-class">.block--modifier</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>其中块可以用单个连字符来界定：如</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.site-search&#123;&#125; //块</span><br><span class="line">.site-search__field&#123;&#125; //元素</span><br><span class="line">.site-search--full&#123;&#125; //修饰符</span><br></pre></td></tr></table></figure>
<ol>
<li>如何使用BEM</li>
</ol>
<p>Block:一个独立的，可以复用而不依赖其他组件的部分，可作为一个块<br>Element:属于块的某部分，可作为一个元素<br>Modifier:用于修饰块或元素，体现出外形行为状态等特征的，可作为一个修饰器</p>
<p>规范：</p>
<p>1）保证各个部分只有一级<code>B__E–M</code>，修饰器需要和对应的块或元素一起使用，避免单独使用。<br>2）仅以类名作为选择器，不使用ID或标签名来约束选择器，且css中的选择器嵌套不超过2层<br>3）避免 <code>.block__el1__el2</code> 的格式</p>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jasonxqh.github.io/2021/08/18/iOS01-FirstiOSapp/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/%5Bobject%20Object%5D">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Jason‘s Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/08/18/iOS01-FirstiOSapp/" itemprop="url">iOS01-FirstiOSapp</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2021-08-18T21:13:38+08:00">
                2021-08-18
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified&#58;</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2021-08-27T08:50:00+08:00">
                2021-08-27
              </time>
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="第一个-Swift-App"><a href="#第一个-Swift-App" class="headerlink" title="第一个 Swift App"></a>第一个 Swift App</h1><h2 id="Getting-Started-with-SwiftUI"><a href="#Getting-Started-with-SwiftUI" class="headerlink" title="Getting Started with SwiftUI"></a>Getting Started with SwiftUI</h2><h3 id="Getting-Started-with-SwiftUI-1"><a href="#Getting-Started-with-SwiftUI-1" class="headerlink" title="Getting Started with SwiftUI"></a>Getting Started with SwiftUI</h3><p>我们第一个app要做一个小游戏叫做 Bullseye，其实就是一个猜数字的游戏。游戏会随机指定一个数字，然后我们可以拖动进度条来猜一个数字。游戏会判断我们移动的数字是否和随机数相等。如下图所示：</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/1.png" style="zoom:67%;"></p>
<p>在第一部分，我们列出了一个<code>to-do list</code></p>
<blockquote>
<ul>
<li>Add the “Hit Me” button</li>
<li>Show a popup when the user taps it</li>
<li>Put game info on screen</li>
<li>Put slider on screen : 1 -&gt; 100</li>
<li>Read value of the slider</li>
</ul>
</blockquote>
<p>首先，进入 xcode，我们可以在右上角选择预览的机型，这里我选择了iphone12，然后点击run就可以在一个虚拟的iphone中跑app了，如下图所示：</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/2.png" style="zoom:67%;"></p>
<p>在代码的编写过程中，我们同时可以预览代码的效果，甚至可以直接在预览中对元素进行调整，xcode会自动进行相应的代码修改：用<code>command+鼠标点击</code>就能对这个中间的文字元素进行各方面的修改。我将字体设为绿色，半粗，发现xcode已经修改好了代码。</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/3.png" style="zoom: 33%;"></p>
<p>此外，我们还可以通过右上角的<code>+</code>来给我们的程序添加其他元素组件。直接拖入到我们想要的位置即可。如下：</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/4.png" style="zoom: 33%;"></p>
<p>我在文字下面添加了一个按钮，并修改了按钮和文字的内容。结果如下：</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/5.png" style="zoom: 33%;"></p>
<h3 id="Objects-Data-and-Methods"><a href="#Objects-Data-and-Methods" class="headerlink" title="Objects, Data, and Methods"></a>Objects, Data, and Methods</h3><p>在swift中，构成app的基本要素也是对象。有些对象是iOS提供给我们的(button之类的)，有些则需要我们自己去写。在上面展示的手机页面中，一共有三个对象—— Text Object、Button Object 和 ContentView Object(可理解为画布)。对象可以调用不同方法(用<code>.</code>) </p>
<p>现在我们来分析一下这段代码：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">"welcome to my first swift app"</span>)</span><br><span class="line">                .fontWeight(.semibold)</span><br><span class="line">                .foregroundColor(<span class="type">Color</span>.green)</span><br><span class="line">                .padding()</span><br><span class="line">            <span class="type">Button</span>(action:&#123;&#125;<span class="comment">/*@END_MENU_TOKEN@*/</span>) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"Hit me"</span>)</span><br><span class="line">                    .foregroundColor(<span class="type">Color</span>.blue)<span class="comment">/*@END_MENU_TOKEN@*/</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>首先，<code>ContentView</code> 申明了一个变量属性body 。body相当于一个容器，将屏幕中的<code>data</code>都包含在内。在body后面写着<code>some View</code>，这其实是告诉 <code>ContentView</code>在body中要呈现的东西是一些view。</p>
<p>在body中首先是一个 <code>VStack</code>, 其作用就是垂直地把对象堆叠起来的一个栈。在这个栈中有两个对象，分别是 Text和 Button。然后，Text调用了三个方法：<code>fontWeight</code>、<code>foregroundColor(Color.green)</code>、<code>padding()</code> ；同理，在Button中设置了一个 Text属性，并调用了<code>foregroundColor</code> .</p>
<h3 id="Buttons-and-Actions"><a href="#Buttons-and-Actions" class="headerlink" title="Buttons and Actions"></a>Buttons and Actions</h3><p>细心地我们可能已经发现了，Button虽然已经放在页面上了，但在点击后没有为其编写事件。所以现在我们来做这个事。比如说我希望再点击后打印”Button pressed”, 在模拟手机中点击后，于Xcode中的<code>All Output</code>界面就会显示打印结果</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span>(action: &#123;</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"Button pressed"</span>)</span><br><span class="line">            &#125;) &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"Hit me"</span>)</span><br><span class="line">                    .foregroundColor(<span class="type">Color</span>.blue)<span class="comment">/*@END_MENU_TOKEN@*/</span></span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/6.png"></p>
<p><code>print()</code>是一个很好的debug工具。</p>
<h3 id="SwiftUI-State"><a href="#SwiftUI-State" class="headerlink" title="SwiftUI State"></a>SwiftUI State</h3><p>现在我们来介绍一个很重要的概念： State</p>
<p>我们用汽车仪表盘来举例。一辆汽车中有很多数据，数值类的有：时速、油量、里程数，布尔值有：是否低油量、是否需要保养等。这些数据构成了车的 State.</p>
<p>那么，当司机开始踩油门时，时速会发生变化 ；车内部这时候在燃油，因此油量也会发生变化。那么如果dashbord没有更新这些数据，则会引发很严重的事故。这就是我们需要及时更新state的原因。</p>
<p>那么采用及时更新的策略，可以实现什么功能呢？比如说：点击按钮后会出现弹窗(pop-up)，或者是点击后整个页面发生了一些变化之类的。如下：</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/1.gif" style="zoom:67%;"></p>
<p>实现代码如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@<span class="type">State</span> <span class="keyword">var</span> alertIsVisible : <span class="type">Bool</span> = <span class="literal">false</span></span><br><span class="line"><span class="type">VStack</span> &#123;     </span><br><span class="line">   <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">   <span class="type">Text</span>(<span class="string">"welcome to my first swift app"</span>)</span><br><span class="line">       .fontWeight(.semibold)</span><br><span class="line">       .foregroundColor(<span class="type">Color</span>.green)</span><br><span class="line">       </span><br><span class="line">   <span class="type">Button</span>(action: &#123;</span><br><span class="line">       <span class="built_in">print</span>(<span class="string">"Button pressed"</span>)</span><br><span class="line">       <span class="keyword">self</span>.alertIsVisible = <span class="literal">true</span></span><br><span class="line">   &#125;) &#123;</span><br><span class="line">       <span class="type">Text</span>(<span class="string">"Hit me"</span>)</span><br><span class="line">           .foregroundColor(<span class="type">Color</span>.blue)<span class="comment">/*@END_MENU_TOKEN@*/</span></span><br><span class="line">   &#125;</span><br><span class="line">   .alert(isPresented: $alertIsVisible)&#123;()-&gt;</span><br><span class="line">       <span class="type">Alert</span> <span class="keyword">in</span></span><br><span class="line">       <span class="keyword">return</span> <span class="type">Alert</span>(title: <span class="type">Text</span>(<span class="string">"Hello there"</span>),</span><br><span class="line">                    message: <span class="type">Text</span>(<span class="string">"This is my first pop-up."</span>),</span><br><span class="line">                    dismissButton: .<span class="keyword">default</span>(<span class="type">Text</span>(<span class="string">"Awesome!"</span>)))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>现在我来解释一下代码：</p>
<p>首先，我们用<code>@State</code>修饰了一个变量 <code>alertIsVisible</code>  并将其置为false。<br>然后 ，当我点击button的时，会出发一个效果：将<code>alertIsVisible</code>置为True.<br>因为这个变量是 <code>@state</code>修饰的，因此会重新刷新view。<br>此时便落入到<code>.alert</code> 判定中，由于<code>alertIsVisible = True</code>，触发了弹窗。这个弹窗由三部分组成：<code>title</code>，<code>message</code>和<code>dismisButton</code>。观察gif可以很清楚的找到对应。</p>
<p>总结：</p>
<blockquote>
<p> 当 State 更新的时候，view将重新校验UI，并且更新自身。也就是说，我们只要改变了 <strong>view</strong> 里面被关键词 <code>@State</code> 修饰的属性，整个 <strong>view</strong> 的 <strong>body</strong> 就会被重新渲染。</p>
</blockquote>
<h3 id="Challenge"><a href="#Challenge" class="headerlink" title="Challenge"></a>Challenge</h3><p>要求：现在我们要设计一个名为：”Knock Knock“ 的按钮。然后点击后会显示 ”Who’s Here？“。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    @<span class="type">State</span> <span class="keyword">var</span> alertIsVisible : <span class="type">Bool</span> = <span class="literal">false</span></span><br><span class="line">    @<span class="type">State</span> <span class="keyword">var</span> secondFlag : <span class="type">Bool</span> = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line"> </span><br><span class="line">        </span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">"Button pressed"</span>)</span><br><span class="line">                    <span class="keyword">self</span>.alertIsVisible = <span class="literal">true</span></span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">"Hit me"</span>)</span><br><span class="line">                        .foregroundColor(<span class="type">Color</span>.blue)<span class="comment">/*@END_MENU_TOKEN@*/</span></span><br><span class="line">                &#125;</span><br><span class="line">                .alert(isPresented: $alertIsVisible)&#123;()-&gt;</span><br><span class="line">                    <span class="type">Alert</span> <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="type">Alert</span>(title: <span class="type">Text</span>(<span class="string">"Hello there"</span>),message: <span class="type">Text</span>(<span class="string">"This is my first pop-up."</span>),dismissButton: .<span class="keyword">default</span>(<span class="type">Text</span>(<span class="string">"Awesome!"</span>)))</span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">Button</span>(action: &#123;<span class="keyword">self</span>.secondFlag = <span class="literal">true</span>&#125;) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">"Knock Knock!"</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                .alert(isPresented: $secondFlag)&#123;()-&gt;</span><br><span class="line">                    <span class="type">Alert</span> <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="type">Alert</span>(title: <span class="type">Text</span>(<span class="string">"Who's There"</span>), message: <span class="type">Text</span>(<span class="string">"This is my seconde pop-up"</span>), dismissButton:.<span class="keyword">default</span>(<span class="type">Text</span>(<span class="string">"Nice!"</span>)))</span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><blockquote>
<ol>
<li>我们学会了用canvas来写swift语言</li>
<li>我们学会了如何写一个button</li>
<li>我们学会了<code>@State</code>的作用</li>
</ol>
</blockquote>
<h2 id="Creating-User-Interfaces-with-SwiftUI"><a href="#Creating-User-Interfaces-with-SwiftUI" class="headerlink" title="Creating User Interfaces with SwiftUI"></a>Creating User Interfaces with SwiftUI</h2><p>现在我们要写用户界面了。我们列出了我们的To-Do List</p>
<blockquote>
<ol>
<li>Add the “Hit Me” button</li>
<li>Show a popup when the user taps it</li>
<li>Put game info on screen</li>
<li>Put slider on screen :1-&gt;100</li>
<li>Read value of the slider</li>
</ol>
</blockquote>
<h3 id="Portrait-vs-Landscape"><a href="#Portrait-vs-Landscape" class="headerlink" title="Portrait vs. Landscape"></a>Portrait vs. Landscape</h3><p>Portrait和landscape分别对应着iphone的竖屏和横屏模式。</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/7.png" style="zoom:67%;"></p>
<p>在不同的手机代数上，每一个点所拥有的像素数也是不一样的。随着苹果手机的屏幕不断升级，像素也会越来越高。</p>
<p>直接点击左上角<code>Bullseye</code>项目 ，在 Deployment Info中选择是否要竖屏模式。因为我们这个游戏是横屏的，所以我们直接取消勾选<code>Portrait</code>即可</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/8.png" style="zoom:67%;"></p>
<p>然后再模拟器右上角可以转变手机的方向：</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/9.png" style="zoom:67%;"></p>
<p>但是在preview界面我们仍然保持着竖屏，这是我因为因为preview使用的是另外一套逻辑，我们可以这样修改：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView_Previews</span>: <span class="title">PreviewProvider</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">var</span> previews: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">ContentView</span>().previewLayout(.fixed(width: <span class="number">896</span>, height: <span class="number">414</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如下所示</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/10.png" style="zoom:33%;"></p>
<h3 id="SwiftUI-Views"><a href="#SwiftUI-Views" class="headerlink" title="SwiftUI Views"></a>SwiftUI Views</h3><p>现在我们要来写出Bullseye的基本页面元素：</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/11.png"></p>
<p>这些框出来的都是 <code>Views</code></p>
<p>我们现在已经接触到了一些<code>Views</code>: 比如 Text,Button 以及VStack。但是我们发现上面的元素并不是都是垂直分布的，有些是水平分布的，因此除了Vstack还需要HSTack</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/12.png"></p>
<p>这个结构就是我们在 Vstack中一共要放下四行，每行又是一个HStack。如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span> &#123;</span><br><span class="line">    <span class="comment">//Target row</span></span><br><span class="line">    	...</span><br><span class="line">    <span class="comment">//Slider row</span></span><br><span class="line">    	...</span><br><span class="line">    <span class="comment">//Button row</span></span><br><span class="line">    	...</span><br><span class="line">    <span class="comment">// Score row</span></span><br><span class="line">    	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="SwiftUI-Layout"><a href="#SwiftUI-Layout" class="headerlink" title="SwiftUI Layout"></a>SwiftUI Layout</h3><h4 id="Target-row"><a href="#Target-row" class="headerlink" title="Target row"></a>Target row</h4><p>我们可以在preview界面，将一个单独的Text元素嵌入到一个HStack当中，如下：</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/2.gif" style="zoom:50%;"></p>
<p>接下来，我们可以拖动一个新的Text对象放到Text旁边，注意不要放到整个Vstack的旁边</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/13.png"></p>
<p>然后对内容进行修改即可：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span> &#123;</span><br><span class="line">           <span class="comment">//Target row</span></span><br><span class="line">           <span class="type">HStack</span> &#123;</span><br><span class="line">               <span class="type">Text</span>(<span class="string">"Put the bullseye as close as you can to:"</span>)</span><br><span class="line">               <span class="type">Text</span>(<span class="string">"100"</span>)</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//....</span></span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/14.png"></p>
<h4 id="Slider-row"><a href="#Slider-row" class="headerlink" title="Slider row"></a>Slider row</h4><p>现在我们来制作拖动条这一行。首先在拖动条左右各有刻度1，100，我们需要做的就是在中间加一个拖动条。其实也很简单，只要到对象库中把slider拖到Text中间即可：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HStack</span>&#123;</span><br><span class="line">              <span class="type">Text</span>(<span class="string">"1"</span>)</span><br><span class="line">              <span class="type">Slider</span>(value: .constant(<span class="number">10</span>))</span><br><span class="line">              <span class="type">Text</span>(<span class="string">"100"</span>)</span><br><span class="line">          &#125;</span><br></pre></td></tr></table></figure>
<p>但是现在这样我们是无法拖动的。 我们过一会来解决这个问题</p>
<h4 id="Score-row"><a href="#Score-row" class="headerlink" title="Score row"></a>Score row</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HStack</span>&#123;</span><br><span class="line">      	<span class="type">Button</span>(action: &#123;&#125;) &#123;</span><br><span class="line">      	    <span class="type">Text</span>(<span class="string">"Start Over"</span>)</span><br><span class="line">      	&#125;</span><br><span class="line">      	<span class="type">Text</span>(<span class="string">"Score:"</span>)</span><br><span class="line">      	<span class="type">Text</span>(<span class="string">"999999"</span>)</span><br><span class="line">      	<span class="type">Text</span>(<span class="string">"Round"</span>)</span><br><span class="line">      	<span class="type">Text</span>(<span class="string">"999"</span>)</span><br><span class="line">      	<span class="type">Button</span>(action: &#123;&#125;) &#123;</span><br><span class="line">      	    <span class="type">Text</span>(<span class="string">"info"</span>)</span><br><span class="line">      	&#125;</span><br><span class="line">     	&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/15.png"></p>
<p>这样算是写好了(Button row)之前已经写好了。但这和我们预想的界面还是有差，所以我们接下来要调整间隙。</p>
<h3 id="Spacers-and-Padding"><a href="#Spacers-and-Padding" class="headerlink" title="Spacers and Padding"></a>Spacers and Padding</h3><p>填入间隙也很简单——因为有个object就叫<code>Spacer</code>，拖进去即可：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">VStack</span> &#123;</span><br><span class="line">         <span class="type">Spacer</span>()</span><br><span class="line">         <span class="comment">//Target row</span></span><br><span class="line">         <span class="type">HStack</span> &#123;</span><br><span class="line">             <span class="type">Text</span>(<span class="string">"Put the bullseye as close as you can to:"</span>)</span><br><span class="line">             <span class="type">Text</span>(<span class="string">"100"</span>)</span><br><span class="line">         &#125;</span><br><span class="line">         </span><br><span class="line">         <span class="comment">//Slider row</span></span><br><span class="line">         <span class="type">Spacer</span>()</span><br><span class="line">         <span class="type">HStack</span>&#123;</span><br><span class="line">             <span class="type">Text</span>(<span class="string">"1"</span>)</span><br><span class="line">             <span class="type">Slider</span>(value: .constant(<span class="number">10</span>))</span><br><span class="line">             <span class="type">Text</span>(<span class="string">"100"</span>)</span><br><span class="line">         &#125;</span><br><span class="line">         </span><br><span class="line">         <span class="comment">//Button row</span></span><br><span class="line">         <span class="type">Spacer</span>()</span><br><span class="line">             <span class="type">Button</span>(action: &#123;</span><br><span class="line">                 <span class="built_in">print</span>(<span class="string">"Button pressed"</span>)</span><br><span class="line">                 <span class="keyword">self</span>.alertIsVisible = <span class="literal">true</span></span><br><span class="line">             &#125;) &#123;</span><br><span class="line">                 <span class="type">Text</span>(<span class="string">"Hit me"</span>)</span><br><span class="line">                     .foregroundColor(<span class="type">Color</span>.blue)</span><br><span class="line">             &#125;</span><br><span class="line">             .alert(isPresented: $alertIsVisible)&#123;()-&gt;</span><br><span class="line">                 <span class="type">Alert</span> <span class="keyword">in</span></span><br><span class="line">                 <span class="keyword">return</span> <span class="type">Alert</span>(title: <span class="type">Text</span>(<span class="string">"Hello there"</span>),message: <span class="type">Text</span>(<span class="string">"This is my first pop-up."</span>),dismissButton: .<span class="keyword">default</span>(<span class="type">Text</span>(<span class="string">"Awesome!"</span>)))</span><br><span class="line">                 </span><br><span class="line">             &#125;</span><br><span class="line">         <span class="comment">// Score row</span></span><br><span class="line">         <span class="type">Spacer</span>()</span><br><span class="line">         <span class="type">HStack</span>&#123;</span><br><span class="line"></span><br><span class="line">             <span class="type">Button</span>(action: &#123;&#125;) &#123;</span><br><span class="line">                 <span class="type">Text</span>(<span class="string">"Start Over"</span>)</span><br><span class="line">             &#125;</span><br><span class="line">             <span class="type">Spacer</span>()</span><br><span class="line">             <span class="type">Text</span>(<span class="string">"Score:"</span>)</span><br><span class="line">             <span class="type">Text</span>(<span class="string">"999999"</span>)</span><br><span class="line">             <span class="type">Spacer</span>()</span><br><span class="line">             <span class="type">Text</span>(<span class="string">"Round"</span>)</span><br><span class="line">             <span class="type">Text</span>(<span class="string">"999"</span>)</span><br><span class="line">             <span class="type">Spacer</span>()</span><br><span class="line">             <span class="type">Button</span>(action: &#123;&#125;) &#123;</span><br><span class="line">                 <span class="type">Text</span>(<span class="string">"info"</span>)</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         .padding(.bottom,<span class="number">20</span>)</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
<p>swift()会根据spacer()的大小来自动调整间距。如果觉得离边框太近，还可以使用<code>.padding()</code>这里用来调整score row距离底部的位置，大小为20个点位</p>
<p>除了<code>.bottom</code>之外还有：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.top</span><br><span class="line">.horizental</span><br><span class="line">.vertical</span><br><span class="line">.all</span><br></pre></td></tr></table></figure>
<p>字面意思，应该不难理解。</p>
<p>整体效果如下</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/16.png"></p>
<h3 id="Bindings"><a href="#Bindings" class="headerlink" title="Bindings"></a>Bindings</h3><p>之前我们埋下了一个雷：就是这个滚动条是无法拖动的。那这个问题怎么解决呢？</p>
<p>我们可以使用binding这个小技巧。所谓绑定，就是将一个用<code>@state</code>修饰的变量与用户界面实时绑定，实时更新。在这里我们就可以将slider与一个 state variable绑定在一起。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@<span class="type">State</span> <span class="keyword">var</span> sliderValue: <span class="type">Double</span>  = <span class="number">50.0</span></span><br><span class="line"><span class="type">VStack</span>&#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">	 <span class="type">HStack</span>&#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"1"</span>)</span><br><span class="line">                <span class="type">Slider</span>(value: <span class="keyword">self</span>.$sliderValue,<span class="keyword">in</span>:<span class="number">1</span>...<span class="number">100</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"100"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>value:self.$sliderValue</code> 代表这个slider与<code>sliderValue</code>成功绑定在了一起，拖动slider时会实时更新<code>sliderValue</code></p>
<p>需要注意的是，当使用Binding时，State变量前面一定要加一个<code>$</code> </p>
<p><code>in: 1...100</code> 代表从1开始到100</p>
<h3 id="Strings"><a href="#Strings" class="headerlink" title="Strings"></a>Strings</h3><p>相信我们对Strings已不再陌生。那么在strings中引用变量该怎么办呢？</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"Hello ,\(name)!"</span></span><br></pre></td></tr></table></figure>
<p>比如在这个字符串中就引用了<code>name</code>变量，只要在前面加个反斜杠，再用括号将变量括起来就可以了。</p>
<p>现在我们要让我们的app在点击Hit Me之后渲染出滑动条的数值：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span>(action: &#123;</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">"Button pressed"</span>)</span><br><span class="line">                    <span class="keyword">self</span>.alertIsVisible = <span class="literal">true</span></span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">"Hit me"</span>)</span><br><span class="line">                        .foregroundColor(<span class="type">Color</span>.blue) </span><br><span class="line">                &#125;</span><br><span class="line">                .alert(isPresented: $alertIsVisible)&#123;()-&gt;</span><br><span class="line">                    <span class="type">Alert</span> <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="type">Alert</span>(title: <span class="type">Text</span>(<span class="string">"Hello there"</span>),</span><br><span class="line">                    message: <span class="type">Text</span>(<span class="string">"The slider's value is \(self.sliderValue)"</span>),</span><br><span class="line">                    dismissButton: .<span class="keyword">default</span>(<span class="type">Text</span>(<span class="string">"Awesome!"</span>)))</span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/3.gif"></p>
<p>但是现在显示的是一个小数，接下来我们要用四舍五入的方式来取到一个整数</p>
<h3 id="Variables"><a href="#Variables" class="headerlink" title="Variables"></a>Variables</h3><p>在Swift中，这是一个创建变量的基本模板：（@State是可选项)</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="type">State</span> <span class="keyword">var</span> variableName : <span class="type">Type</span> = <span class="type">InitialValue</span></span><br></pre></td></tr></table></figure>
<p>一般变量的命名法是骆驼命名法。</p>
<p>那么如果X是浮点数，我新命名一个y为整数。怎么对x进行强制类型转换呢？</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x : <span class="type">Float</span> = <span class="number">3.14</span></span><br><span class="line"><span class="keyword">var</span> y : <span class="type">Int</span> = <span class="type">Int</span>(x)</span><br></pre></td></tr></table></figure>
<p> 我们可以在Button中申请一个临时变量用来存放四舍五入后的<code>sliderValue</code></p>
<p>那有没有能将浮点数四舍五入的函数呢？我们可以<code>command</code>+点击Double查看快速帮助。里面确实有<code>rounded()</code>的用法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span>(action: &#123;</span><br><span class="line">                   <span class="built_in">print</span>(<span class="string">"Button pressed"</span>)</span><br><span class="line">                   <span class="keyword">self</span>.alertIsVisible = <span class="literal">true</span></span><br><span class="line">               &#125;) &#123;</span><br><span class="line">                   <span class="type">Text</span>(<span class="string">"Hit me"</span>)</span><br><span class="line">                       .foregroundColor(<span class="type">Color</span>.blue) </span><br><span class="line">               &#125;</span><br><span class="line">               .alert(isPresented: $alertIsVisible)&#123;()-&gt;</span><br><span class="line">                   <span class="type">Alert</span> <span class="keyword">in</span></span><br><span class="line">                   <span class="keyword">var</span> roundedValue : <span class="type">Int</span> = <span class="type">Int</span>(<span class="keyword">self</span>.sliderValue.rounded())</span><br><span class="line">                   <span class="keyword">return</span> <span class="type">Alert</span>(title: <span class="type">Text</span>(<span class="string">"Hello there"</span>),</span><br><span class="line">                                message: <span class="type">Text</span>(<span class="string">"The slider's value is \(roundedValue)"</span>),</span><br><span class="line">                                dismissButton: .<span class="keyword">default</span>(<span class="type">Text</span>(<span class="string">"Awesome!"</span>)))</span><br><span class="line">                   </span><br><span class="line">               &#125;</span><br></pre></td></tr></table></figure>
<p>细心地我们也许会发现，为什么有些时候我们要用<code>self.</code>来引用一个变量，有时候又可以直接用呢？使用<code>self.</code>有三个层次：</p>
<ol>
<li>当我们想在一个闭包中设置<code>self.property</code>的时候，我们<strong>必须</strong>使用<code>self.</code> </li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dispatch_async(dispatch_get_main_queue(), &#123;</span><br><span class="line">    <span class="comment">// we cannot assign to properties of self</span></span><br><span class="line">    <span class="keyword">self</span>.view = <span class="literal">nil</span> </span><br><span class="line"></span><br><span class="line">    <span class="comment">// but can access properties</span></span><br><span class="line">    someFunc(view)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol>
<li>当我们想区分<code>class property</code>和<code>local variable</code>时，我们应该要用<code>self.</code></li>
</ol>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> someVar: <span class="type">String</span> = <span class="string">"class property"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">setProperty</span><span class="params">(someVar:String = <span class="string">"method attribute"</span>)</span></span> -&gt; () &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="keyword">self</span>.someVar) <span class="comment">// Output: class property</span></span><br><span class="line">        <span class="built_in">print</span>(someVar) <span class="comment">// Output: method attribute</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>当我们想表明常量/变量是从哪里来的时候，我们可加可不加。</li>
</ol>
<p>在我们写的Bullseye中，<code>self.</code>的情况基本属于第二种。在Button这个对象中，对<code>sliderValue</code>，<code>alertIsVisible</code>这类变量，使用self可以说明这些变量是属于前实例(content value)的。如果我们这样写：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span>(action: &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;) &#123;</span><br><span class="line">  <span class="comment">//..</span></span><br><span class="line">&#125;</span><br><span class="line">.alert(isPresented: $alertIsVisible)&#123;()-&gt;</span><br><span class="line">    <span class="type">Alert</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">var</span> sliderValue : <span class="type">Int</span> = <span class="type">Int</span>(<span class="keyword">self</span>.sliderValue.rounded())</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Alert</span>(title: <span class="type">Text</span>(<span class="string">"Hello there"</span>),</span><br><span class="line">                 message: <span class="type">Text</span>(<span class="string">"The slider's value is \(sliderValue)"</span>),</span><br><span class="line">                 dismissButton: .<span class="keyword">default</span>(<span class="type">Text</span>(<span class="string">"Awesome!"</span>)))</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>swift也是不会报错的，因为我们定义了两个sliderValue，一个是作用于contentView全局的，一个只是在Button中生效的。我在message中引用的时候，如果写<code>self.sliderValue()</code>那么就是引用Double类型的、作用于全局的sliderValue，但是如果我直接写<code>sliderValue()</code>那么引用的是Int类型的，作用于Button的sliderValue。但这样太搞脑子了，我们还是恢复原来的写法：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.alert(isPresented: $alertIsVisible)&#123;()-&gt;</span><br><span class="line">       <span class="type">Alert</span> <span class="keyword">in</span></span><br><span class="line">       <span class="keyword">var</span> roundedValue : <span class="type">Int</span> = <span class="type">Int</span>(<span class="keyword">self</span>.sliderValue.rounded())</span><br><span class="line">       <span class="keyword">return</span> <span class="type">Alert</span>(title: <span class="type">Text</span>(<span class="string">"Hello there"</span>),</span><br><span class="line">                    message: <span class="type">Text</span>(<span class="string">"The slider's value is \(roundedValue)"</span>),</span><br><span class="line">                    dismissButton: .<span class="keyword">default</span>(<span class="type">Text</span>(<span class="string">"Awesome!"</span>)))</span><br></pre></td></tr></table></figure>
<p>但是这样我们就不能使用<code>self.roundedValue</code>了，因为我们在全局中并没有定义<code>roundedValue</code>，swift到前实例当中去找的时候是不会发现有这个变量的。</p>
<h2 id="Swift-Basics"><a href="#Swift-Basics" class="headerlink" title="Swift Basics"></a>Swift Basics</h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>在这部分我们会学习一些Swift的基本语法。这是我们的To-Do List：</p>
<blockquote>
<ul>
<li>The Swift Standard Library</li>
<li>Writing Methods</li>
<li>If/Else Statements</li>
<li>Variables Vs. Constants</li>
<li>Type Inference</li>
<li>Variable Scope</li>
</ul>
</blockquote>
<h3 id="The-Swift-Standard-Library"><a href="#The-Swift-Standard-Library" class="headerlink" title="The Swift Standard Library"></a>The Swift Standard Library</h3><p>Xcode中自带了swift文档。对于不懂的语法可以直接按住 <code>Option(⌥)</code> 后点击该词，或者直接搜索也可以。还有一个好办法就是利用alfred中的Dash工作流。比如我想生成一个随机整数，怎么搜呢？</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/17.png" style="zoom: 33%;"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@<span class="type">State</span> <span class="keyword">var</span> target: <span class="type">Int</span> = <span class="type">Int</span>.random(<span class="keyword">in</span>: <span class="number">1</span>...<span class="number">100</span>)</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"\(self.target)"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<p>这样就可以每次都生成一个整数了</p>
<h3 id="Writing-Methods"><a href="#Writing-Methods" class="headerlink" title="Writing Methods"></a>Writing Methods</h3><p>我们写到现在还没有写过函数，那么现在我们就来写我们第一个swift方法</p>
<p>基本格式：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">yourMethodName</span><span class="params">()</span></span> -&gt; <span class="type">ReturnType</span>&#123;</span><br><span class="line">	<span class="comment">//	Write our code</span></span><br><span class="line">	<span class="keyword">return</span> yourReturnValue</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一般方法写在整个body之后。swift会自动查找全局的方法，所以不用像C语言那样在一开始就声明。</p>
<p>那么怎么调用函数呢？</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span>(action: &#123;</span><br><span class="line">   <span class="comment">//...</span></span><br><span class="line">&#125;) &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line">.alert(isPresented: $alertIsVisible)&#123;()-&gt;</span><br><span class="line">    <span class="type">Alert</span> <span class="keyword">in</span></span><br><span class="line">    <span class="keyword">var</span> sliderValue : <span class="type">Int</span> = <span class="type">Int</span>(<span class="keyword">self</span>.sliderValue.rounded())</span><br><span class="line">        <span class="keyword">return</span> <span class="type">Alert</span>(title: <span class="type">Text</span>(<span class="string">"Hello there"</span>),</span><br><span class="line">                     message: <span class="type">Text</span>(<span class="string">"The slider's value is \(sliderValue).\n"</span></span><br><span class="line">                     +<span class="string">"You scored \(self.pointsForCurrentRound()) points this round"</span>),</span><br><span class="line">                     dismissButton: .<span class="keyword">default</span>(<span class="type">Text</span>(<span class="string">"Awesome!"</span>)))</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>和调用成员变量一样，可以用<code>self.yourMethodName()</code>来调用我们写好的方法。</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/4.gif"></p>
<h3 id="Challenge-How-To-Calculate-the-Difference"><a href="#Challenge-How-To-Calculate-the-Difference" class="headerlink" title="Challenge- How To Calculate the Difference"></a>Challenge- How To Calculate the Difference</h3><p><img src="/2021/08/18/iOS01-FirstiOSapp/18.png"></p>
<p>现在我们要修改刚才那个<code>pointForCurrentRound()</code>函数，让其返回目标和滑动条之间的差值。</p>
<p>这是我的解决方案：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pointsForCurrentRound</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> absolute = <span class="number">100</span>-<span class="built_in">abs</span>(<span class="type">Int</span>(<span class="keyword">self</span>.sliderValue.rounded())-<span class="keyword">self</span>.target)</span><br><span class="line">        <span class="keyword">return</span> absolute</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>如下图所示：</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/5.gif"></p>
<h3 id="If-Else-Statements"><a href="#If-Else-Statements" class="headerlink" title="If-Else Statements"></a>If-Else Statements</h3><p>之前我们讨了个巧，直接用 <code>abs()</code>来计算差的绝对值。其实最朴素的方法就是用if-else语句来写：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> sth_is_true &#123;</span><br><span class="line">	then_do_this</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> sth_else_is_true &#123;</span><br><span class="line">	then_do_that</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">	do_something_when_neither_of_the_above_are_true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么根据这个模板我们可以这样写逻辑：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pointsForCurrentRound</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> difference : <span class="type">Int</span></span><br><span class="line">        <span class="keyword">var</span> roundedValue : <span class="type">Int</span> = <span class="type">Int</span>(<span class="keyword">self</span>.sliderValue.rounded())</span><br><span class="line">        <span class="keyword">if</span> roundedValue &gt; <span class="keyword">self</span>.target &#123;</span><br><span class="line">            difference = roundedValue-<span class="keyword">self</span>.target</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">self</span>.target &gt; roundedValue&#123;</span><br><span class="line">            difference = <span class="keyword">self</span>.target-roundedValue</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            difference = <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> difference</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>也可以这么写：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pointsForCurrentRound</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> roundedValue : <span class="type">Int</span> = <span class="type">Int</span>(<span class="keyword">self</span>.sliderValue.rounded())</span><br><span class="line">    <span class="keyword">var</span> difference : <span class="type">Int</span> = <span class="keyword">self</span>.target-roundedValue</span><br><span class="line">    <span class="keyword">if</span> difference &lt; <span class="number">0</span> &#123;</span><br><span class="line">        difference = difference * -<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> awardedPoints : <span class="type">Int</span> = <span class="number">100</span>-difference</span><br><span class="line">    <span class="keyword">return</span> awardedPoints</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Variables-and-Constants"><a href="#Variables-and-Constants" class="headerlink" title="Variables and Constants"></a>Variables and Constants</h3><p><img src="/2021/08/18/iOS01-FirstiOSapp/19.png" style="zoom:50%;"></p>
<p>相信我们对常量和变量已经足够了解了。事实上我们之前都是用 var来声明常量和变量的。但Xcode会给我们warning：</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/20.png" style="zoom:50%;"></p>
<p>事实上，常量一般是不允许改变的，而变量是可以一直改变的。</p>
<p>因此我们要养成好习惯： 用 var来声明变量而用let来声明常量</p>
<h3 id="Type-Inference"><a href="#Type-Inference" class="headerlink" title="Type Inference"></a>Type Inference</h3><p>当我们能确定一个变量(常量)它的数值类型的时候，我们可以直接用等于号赋值：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sliderValueRounded : <span class="type">Int</span> = <span class="type">Int</span>(<span class="keyword">self</span>.sliderValue.rounded())</span><br><span class="line"><span class="comment">//可写为：</span></span><br><span class="line"><span class="keyword">let</span> sliderValueRounded = <span class="type">Int</span>(<span class="keyword">self</span>.sliderValue.rounded())</span><br></pre></td></tr></table></figure>
<h3 id="Variable-Scope"><a href="#Variable-Scope" class="headerlink" title="Variable Scope"></a>Variable Scope</h3><p>Swift有三种 变量作用域：Global scope, Instance scope, Local scope</p>
<ul>
<li>Global scope 就是可以在整个项目中都可以引用</li>
<li>Instance scope 就是可以在一整个实例中可以使用。比如<code>target</code>,<code>sliderValue</code> 就作用于整个ContentView</li>
<li>Local scope 则是在一个作用于一个method的变量。比如我们上面写的<code>sliderValueRounded</code>只作用于<code>pointsForCurrentRound()</code>这个方法</li>
</ul>
<h3 id="Clean-Code"><a href="#Clean-Code" class="headerlink" title="Clean Code"></a>Clean Code</h3><p>无论用什么语言写程序，我们都要遵守一个原则：Dry(Don’t Repeat Your Code)。因此我们可以把重复的代码提取出来成为一个Method</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pointsForCurrentRound</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">     <span class="number">100</span> - <span class="built_in">abs</span>(target - sliderValueRounded())</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">func</span> <span class="title">sliderValueRounded</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">     <span class="type">Int</span>(sliderValue.rounded())</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="More-Swift-Basics"><a href="#More-Swift-Basics" class="headerlink" title="More Swift Basics"></a>More Swift Basics</h2><h3 id="Challenge-Showing-the-Total-Score"><a href="#Challenge-Showing-the-Total-Score" class="headerlink" title="Challenge- Showing the Total Score"></a>Challenge- Showing the Total Score</h3><p>现在我们想在底部的 Score row 显示我们游戏的总分。怎么办？</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">		<span class="comment">//...</span></span><br><span class="line">    @<span class="type">State</span> <span class="keyword">var</span> totalScore : <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="comment">// Score row</span></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">            <span class="type">HStack</span>&#123;</span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">                <span class="type">Text</span>(<span class="string">"Score:"</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"\(totalScore)"</span>)</span><br><span class="line">          	<span class="comment">//...</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/6.gif"></p>
<h3 id="Your-First-Bug"><a href="#Your-First-Bug" class="headerlink" title="Your First Bug"></a>Your First Bug</h3><p>现在我们的游戏出了点小问题，就是说我每次点击后目标数值并不会重新刷新。</p>
<p>最朴素的解决方式就是在点击Hit Me按钮的时候重置target </p>
<p>但是我们要注意，不能在Button的action作用域中写刷新语句。因为计算、呈现都发生在action之后，如果我们在action时就刷新了target，那么计算时就会以新的target为标准。</p>
<p>就如同下图，本来的target是20，但是在我点按钮的时候刷新到了66，那么游戏计算得到的分数就不是100而是$100-|66-20|=54$</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/21.png"></p>
<p>那么怎么解决这个问题呢？我们可以把逻辑设置成当点击 dismiss button时更新分数以及target，因为dismiss button也是按钮，因此swift允许在点击按钮之后再运行一些代码。因此我们可以在<code>.default()</code>之后打一个大括号，括号中写需要执行的代码</p>
<p>如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span>(action: &#123;</span><br><span class="line">     <span class="keyword">self</span>.alertIsVisible = <span class="literal">true</span></span><br><span class="line">     <span class="keyword">self</span>.totalScore = <span class="keyword">self</span>.totalScore + pointsForCurrentRound()</span><br><span class="line"> &#125;) &#123;</span><br><span class="line">     <span class="type">Text</span>(<span class="string">"Hit me"</span>)</span><br><span class="line">         .foregroundColor(<span class="type">Color</span>.blue)<span class="comment">/*@END_MENU_TOKEN@*/</span></span><br><span class="line"> &#125;</span><br><span class="line"> .alert(isPresented: $alertIsVisible)&#123;()-&gt;</span><br><span class="line">     <span class="type">Alert</span> <span class="keyword">in</span></span><br><span class="line">         <span class="keyword">return</span> <span class="type">Alert</span>(title: <span class="type">Text</span>(<span class="string">"Hello there"</span>),</span><br><span class="line">                      message: <span class="type">Text</span>(<span class="string">"The slider's value is \(sliderValueRounded()).\n"</span>+</span><br><span class="line">                      					<span class="string">"You scored \(self.pointsForCurrentRound()) points this round"</span>),</span><br><span class="line">                      dismissButton: .<span class="keyword">default</span>(<span class="type">Text</span>(<span class="string">"Awesome!"</span>))&#123;</span><br><span class="line">                         target = <span class="type">Int</span>.random(<span class="keyword">in</span>: <span class="number">1</span>...<span class="number">100</span>)</span><br><span class="line">                         <span class="keyword">self</span>.totalScore = <span class="keyword">self</span>.totalScore + pointsForCurrentRound()</span><br><span class="line">                      &#125;)</span><br><span class="line">     </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/22.png" style="zoom: 50%;"></p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/23.png" style="zoom:50%;"></p>
<h3 id="Challenge-Tracking-Rounds"><a href="#Challenge-Tracking-Rounds" class="headerlink" title="Challenge- Tracking Rounds"></a>Challenge- Tracking Rounds</h3><p>现在我们还要把轮次写上去。同样的我们要把逻辑加载 Dismiss Button 之后：</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/7.gif"></p>
<h3 id="Better-Alert-Title"><a href="#Better-Alert-Title" class="headerlink" title="Better Alert Title"></a>Better Alert Title</h3><p>现在我们要设计一个更好的弹出提示。</p>
<p>比如说当我们刚好击中了target，弹出的文本可以是”Perfect”<br>,当离target很近的时候，可以是”You almost had it”<br>一般近的时候，可以是”Not Bad”<br>最差一档是：”Are you even trying ?”</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ContentView</span>: <span class="title">View</span> </span>&#123;</span><br><span class="line">    @<span class="type">State</span> <span class="keyword">var</span> alertIsVisible : <span class="type">Bool</span> = <span class="literal">false</span></span><br><span class="line">    @<span class="type">State</span> <span class="keyword">var</span> sliderValue: <span class="type">Double</span>  = <span class="number">50.0</span></span><br><span class="line">    @<span class="type">State</span> <span class="keyword">var</span> target: <span class="type">Int</span> = <span class="type">Int</span>.random(<span class="keyword">in</span>: <span class="number">1</span>...<span class="number">100</span>)</span><br><span class="line">    @<span class="type">State</span> <span class="keyword">var</span> totalScore : <span class="type">Int</span> = <span class="number">0</span></span><br><span class="line">    @<span class="type">State</span> <span class="keyword">var</span> round : <span class="type">Int</span> = <span class="number">1</span></span><br><span class="line">    <span class="keyword">var</span> body: some <span class="type">View</span> &#123;</span><br><span class="line"> </span><br><span class="line">        </span><br><span class="line">        <span class="type">VStack</span> &#123;</span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">            <span class="comment">//Target row</span></span><br><span class="line">            <span class="type">HStack</span> &#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"Put the bullseye as close as you can to:"</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"\(self.target)"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//Slider row</span></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">            <span class="type">HStack</span>&#123;</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"1"</span>)</span><br><span class="line">                <span class="type">Slider</span>(value: <span class="keyword">self</span>.$sliderValue,<span class="keyword">in</span>:<span class="number">1</span>...<span class="number">100</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"100"</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//Button row</span></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    <span class="keyword">self</span>.alertIsVisible = <span class="literal">true</span></span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">"Hit me"</span>)</span><br><span class="line">                        .foregroundColor(<span class="type">Color</span>.blue)<span class="comment">/*@END_MENU_TOKEN@*/</span></span><br><span class="line">                &#125;</span><br><span class="line">                .alert(isPresented: $alertIsVisible)&#123;()-&gt;</span><br><span class="line">                    <span class="type">Alert</span> <span class="keyword">in</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="type">Alert</span>(title: <span class="type">Text</span>(<span class="keyword">self</span>.alertTitle()),</span><br><span class="line">                                     message: <span class="type">Text</span>(<span class="string">"The slider's value is \(sliderValueRounded()).\n"</span>+<span class="string">"You scored \(self.pointsForCurrentRound()) points this round"</span>),</span><br><span class="line">                                     dismissButton: .<span class="keyword">default</span>(<span class="type">Text</span>(<span class="string">"Awesome!"</span>))&#123;</span><br><span class="line">                                        target = <span class="type">Int</span>.random(<span class="keyword">in</span>: <span class="number">1</span>...<span class="number">100</span>)</span><br><span class="line">                                        <span class="keyword">self</span>.totalScore = <span class="keyword">self</span>.totalScore + pointsForCurrentRound()</span><br><span class="line">                                        <span class="keyword">self</span>.round = <span class="keyword">self</span>.round+<span class="number">1</span></span><br><span class="line">                                     &#125;)</span><br><span class="line">                    </span><br><span class="line">                &#125;</span><br><span class="line">            <span class="comment">// Score row</span></span><br><span class="line">            <span class="type">Spacer</span>()</span><br><span class="line">            <span class="type">HStack</span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="type">Button</span>(action: &#123;</span><br><span class="line">                    totalScore = <span class="number">0</span></span><br><span class="line">                &#125;) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">"Start Over"</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"Score:"</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"\(totalScore)"</span>)</span><br><span class="line">                </span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"Round"</span>)</span><br><span class="line">                <span class="type">Text</span>(<span class="string">"\(round)"</span>)</span><br><span class="line">                <span class="type">Spacer</span>()</span><br><span class="line">                <span class="type">Button</span>(action: <span class="comment">/*@START_MENU_TOKEN@*/</span><span class="comment">/*@PLACEHOLDER=Action@*/</span>&#123;&#125;<span class="comment">/*@END_MENU_TOKEN@*/</span>) &#123;</span><br><span class="line">                    <span class="type">Text</span>(<span class="string">"info"</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding(.bottom,<span class="number">20</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">amountOff</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="built_in">abs</span>(target - sliderValueRounded())</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">pointsForCurrentRound</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="number">100</span> - amountOff()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sliderValueRounded</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">        <span class="type">Int</span>(sliderValue.rounded())</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">alertTitle</span><span class="params">()</span></span> -&gt; <span class="type">String</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> difference = amountOff()</span><br><span class="line">        <span class="keyword">let</span> title : <span class="type">String</span></span><br><span class="line">        <span class="keyword">if</span> difference == <span class="number">0</span>&#123;</span><br><span class="line">            title = <span class="string">"Perfect!"</span></span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> difference&lt;<span class="number">5</span>&#123;</span><br><span class="line">            title = <span class="string">"You almost had it!"</span></span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> difference &lt;= <span class="number">10</span> &#123;</span><br><span class="line">            title = <span class="string">"Not Bad."</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            title = <span class="string">"Are You even trying?"</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> title</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/8.gif"></p>
<h3 id="Challenge-Bonus-Points"><a href="#Challenge-Bonus-Points" class="headerlink" title="Challenge- Bonus Points"></a>Challenge- Bonus Points</h3><p>现在我们再加入一个机制。就是当我们完美击中目标时，会获得额外的奖励100分。而离目标仅有1时，会获得额外50分</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">pointsForCurrentRound</span><span class="params">()</span></span> -&gt; <span class="type">Int</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> maximumScore = <span class="number">100</span></span><br><span class="line">    <span class="keyword">let</span> difference = amountOff()</span><br><span class="line">    <span class="keyword">let</span> bonus : <span class="type">Int</span></span><br><span class="line">    <span class="keyword">if</span> difference == <span class="number">0</span> &#123;</span><br><span class="line">        bonus = <span class="number">100</span></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> difference == <span class="number">1</span>&#123;</span><br><span class="line">        bonus = <span class="number">50</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        bonus=<span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> maximumScore - difference + bonuså</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Challenge-Starting-Over"><a href="#Challenge-Starting-Over" class="headerlink" title="Challenge- Starting Over"></a>Challenge- Starting Over</h3><p>这个很简单，直接重置Score、Round、sliderValue为初始值即可,同时要刷新一个随机值。我们可以写一个没有返回值的函数来是现这些功能</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span>(action: &#123;</span><br><span class="line">            <span class="keyword">self</span>.startNewGame()</span><br><span class="line">        &#125;) &#123;</span><br><span class="line">            <span class="type">Text</span>(<span class="string">"Start Over"</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">startNewGame</span><span class="params">()</span></span> &#123;</span><br><span class="line">    totalScore = <span class="number">0</span></span><br><span class="line">    round = <span class="number">1</span></span><br><span class="line">    sliderValue = <span class="number">50.0</span></span><br><span class="line">    target = <span class="type">Int</span>.random(<span class="keyword">in</span>: <span class="number">1</span>...<span class="number">100</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/9.gif"></p>
<h2 id="Styling-the-App"><a href="#Styling-the-App" class="headerlink" title="Styling the App"></a>Styling the App</h2><h3 id="Introduction-1"><a href="#Introduction-1" class="headerlink" title="Introduction"></a>Introduction</h3><p>到现在为止app的基本框架我们已经搭好了，但是还需要美化一下。因此<a href="https://files.betamax.raywenderlich.com/attachments/videos/3058/493dee13-a606-4c14-8fbc-f05a3ecf3928.zip" target="_blank" rel="noopener">点击这里</a> 下载需要的图片</p>
<h3 id="Images"><a href="#Images" class="headerlink" title="Images"></a>Images</h3><p>首先我们要把要用的照片都拖动到 Assets 文件夹当中：</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/24.png"></p>
<p>我们会发现图片分为三个档次-1x,2x,3x 其实这和图片的分辨率有关系。</p>
<blockquote>
<p>1x 适合最早没有视网膜屏的手机</p>
<p>2x 适合视网膜屏的手机</p>
<p>3x 适合高清视网膜屏的手机(10代以后)</p>
</blockquote>
<p>对于不同的手机像素我们可以上<a href="https://www.paintcodeapp.com/news/ultimate-guide-to-iphone-resolutions" target="_blank" rel="noopener">这个网站</a>查看</p>
<p>那么怎么给我们的app设置背景呢？可以搜索apple 文档</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/25.png" style="zoom:67%;"></p>
<p>然后到body的最后面设置整个body的背景</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.background(<span class="type">Image</span>(<span class="string">"Background"</span>),alignment: .center)</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/26.png" style="zoom:67%;"></p>
<h3 id="View-Modifiers"><a href="#View-Modifiers" class="headerlink" title="View Modifiers"></a>View Modifiers</h3><p>但是这个背景并不适合黑体字，而且字体也不太好看。因此我们还需要修改一下。对于文字，我们可以之间用command+click修改，但是如果要修改字体、添加阴影，那么直接写代码反而会变得方便。关于苹果可以用哪些字体，我们可以上<a href="http://iosfonts.com/" target="_blank" rel="noopener">这个网站</a> 查看. 我们使用的是 <code>Arial Rounded MT Bold</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Text</span>(<span class="string">"Put the bullseye as close as you can to:"</span>) </span><br><span class="line">								.foregroundColor(<span class="type">Color</span>.white)</span><br><span class="line">               .shadow(color: <span class="type">Color</span>.black, radius: <span class="number">5</span>, x: <span class="number">2</span>, y: <span class="number">2</span>)</span><br><span class="line">               .font(<span class="type">Font</span>.custom(<span class="string">"Arial Rounded MT Bold"</span>, size: <span class="number">18</span>))</span><br></pre></td></tr></table></figure>
<p>对于Text的修改如上. 聪明的你可能会问：这么多Text,难道对于每一条我们都要修改这么多吗? 其实我们有更好的方法。那就是创建一个<code>ViewModifier</code>类型的结构，其作用就是对view进行格式修改。如下：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">LabelStyle</span>: <span class="title">ViewModifier</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">func</span> <span class="title">body</span><span class="params">(content: Content)</span></span> -&gt; some <span class="type">View</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> content</span><br><span class="line">                .foregroundColor(<span class="type">Color</span>.white)</span><br><span class="line">                .shadow(color: <span class="type">Color</span>.black, radius: <span class="number">5</span>, x: <span class="number">2</span>, y: <span class="number">2</span>)</span><br><span class="line">                .font(<span class="type">Font</span>.custom(<span class="string">"Arial Rounded MT Bold"</span>, size: <span class="number">18</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//然后对于每一个Text，只要在后面加上 .modifier(LabelStyle())即可。如：</span></span><br><span class="line"> <span class="type">Text</span>(<span class="string">"Put the bullseye as close as you can to:"</span>).modifier(<span class="type">LabelStyle</span>())</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/27.png" style="zoom:67%;"></p>
<h3 id="Challenge-1"><a href="#Challenge-1" class="headerlink" title="Challenge"></a>Challenge</h3><p>现在我们要修改值得样式，因为值需要看起来更大一些，更好辨认一些。我们的要求是：</p>
<blockquote>
<ul>
<li>Create a ViewModifier named ValueStyle<ul>
<li>Foreground color: Yellow</li>
<li>Font: Arial Rounded MT Bold , size 24</li>
<li>Shadow: The same as in LabelStyle</li>
</ul>
</li>
<li>Bonus : Can you make the code DRY</li>
<li>Hint: ViewModifiers can use other ViewModifiers!</li>
</ul>
</blockquote>
<p>第一个任务很简单，就是创建一个基本一模一样的struct</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ValueStyle</span>: <span class="title">ViewModifier</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">body</span><span class="params">(content: Content)</span></span> -&gt; some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> content</span><br><span class="line">            .foregroundColor(<span class="type">Color</span>.yellow)</span><br><span class="line">            .shadow(color: <span class="type">Color</span>.black, radius: <span class="number">5</span>, x: <span class="number">2</span>, y: <span class="number">2</span>)</span><br><span class="line">            .font(<span class="type">Font</span>.custom(<span class="string">"Arial Rounded MT Bold"</span>, size: <span class="number">24</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是问题是，我们发现两个struct的shadow是重复的，因此我们是否可以利用dry原则进行进一步优化呢？我们可以将shadow样式的语句单独提出来再做成一个ViewModifier，因为ViewModifier本身也可以调用其他ViewModifier</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LabelStyle</span>: <span class="title">ViewModifier</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">body</span><span class="params">(content: Content)</span></span> -&gt; some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> content</span><br><span class="line">            .foregroundColor(<span class="type">Color</span>.white)</span><br><span class="line">            .modifier(<span class="type">ShadowStyle</span>())</span><br><span class="line">            .font(<span class="type">Font</span>.custom(<span class="string">"Arial Rounded MT Bold"</span>, size: <span class="number">18</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ValueStyle</span>: <span class="title">ViewModifier</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">body</span><span class="params">(content: Content)</span></span> -&gt; some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> content</span><br><span class="line">            .foregroundColor(<span class="type">Color</span>.yellow)</span><br><span class="line">            .modifier(<span class="type">ShadowStyle</span>())</span><br><span class="line">            .font(<span class="type">Font</span>.custom(<span class="string">"Arial Rounded MT Bold"</span>, size: <span class="number">24</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ShadowStyle</span>: <span class="title">ViewModifier</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">body</span><span class="params">(content: Content)</span></span> -&gt; some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> content</span><br><span class="line">            .shadow(color: <span class="type">Color</span>.black, radius: <span class="number">5</span>, x: <span class="number">2</span>, y: <span class="number">2</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Styling-the-Buttons-and-Slider"><a href="#Styling-the-Buttons-and-Slider" class="headerlink" title="Styling the Buttons and Slider"></a>Styling the Buttons and Slider</h3><p>现在我们来修改按钮以及滑动条的样式。</p>
<p>首先是给按钮加一个背景。这个很简单就不说了</p>
<p>其次是我们想给按钮的字体换一个颜色换一个大小。于是我们仍需要创建一个 ViewModifier :</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ButtonLargeTextStyle</span>: <span class="title">ViewModifier</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">body</span><span class="params">(content: Content)</span></span> -&gt; some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> content</span><br><span class="line">            .foregroundColor(<span class="type">Color</span>.black)</span><br><span class="line">            .font(<span class="type">Font</span>.custom(<span class="string">"Arial Rounded MT Bold"</span>, size: <span class="number">18</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ButtonSmallTextStyle</span>: <span class="title">ViewModifier</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">func</span> <span class="title">body</span><span class="params">(content: Content)</span></span> -&gt; some <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> content</span><br><span class="line">            .foregroundColor(<span class="type">Color</span>.black)</span><br><span class="line">            .font(<span class="type">Font</span>.custom(<span class="string">"Arial Rounded MT Bold"</span>, size: <span class="number">12</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/28.png" style="zoom:67%;"></p>
<p>现在还需要把返回图表和信息图表加到按钮上去。为了实现这个操作，我们可以在按钮中添加一个HStack。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span>(action: &#123;</span><br><span class="line">     <span class="keyword">self</span>.startNewGame()</span><br><span class="line"> &#125;) &#123;</span><br><span class="line">     <span class="type">HStack</span> &#123;</span><br><span class="line">         <span class="type">Image</span>(<span class="string">"StartOverIcon"</span>)</span><br><span class="line">         <span class="type">Text</span>(<span class="string">"Start Over"</span>).modifier(<span class="type">ButtonSmallTextStyle</span>())</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;.background(<span class="type">Image</span>(<span class="string">"Button"</span>)).modifier(<span class="type">ShadowStyle</span>())</span><br></pre></td></tr></table></figure>
<p>最后，我们将默认颜色设置成自定义的深空蓝</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> midnightblue = <span class="type">Color</span>(red: <span class="number">0.0</span>/<span class="number">255.0</span>, green: <span class="number">51.0</span>/<span class="number">255.0</span> ,blue: <span class="number">102.0</span>/<span class="number">255.0</span>)</span><br><span class="line">.accentColor(midnightblue)</span><br></pre></td></tr></table></figure>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/29.png" style="zoom:67%;"></p>
<h3 id="App-Icon-and-Display-Name"><a href="#App-Icon-and-Display-Name" class="headerlink" title="App Icon and Display Name"></a>App Icon and Display Name</h3><p>现在我们要给我们的Bullseye添加一个图标</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/30.png" style="zoom:67%;"></p>
<p>很简单的操作</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/31.png" style="zoom: 25%;"></p>
<h3 id="Running-the-App-on-Your-Device"><a href="#Running-the-App-on-Your-Device" class="headerlink" title="Running the App on Your Device"></a>Running the App on Your Device</h3><p> 最后我们要在手机上运行这个app。首先用手机连上电脑，在Window菜单下拉找到devices and simulators界面。然后打开手机信任电脑</p>
<p>之后，在preference中需要写上与手机上一致的Apple ID</p>
<p><img src="/2021/08/18/iOS01-FirstiOSapp/32.png" style="zoom: 67%;"></p>
<p>最后，在最上面的设备栏将 simulator改成自己的手机。点击运行就可以了。</p>

          
        
      
    </div>
    
    
    
    <div>
      
    </div>
    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/">&lt;i class&#x3D;&quot;fa fa-angle-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/44/">44</a><a class="extend next" rel="next" href="/page/11/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/%5Bobject%20Object%5D"
                alt="Jason" />
            
              <p class="site-author-name" itemprop="name">Jason</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20fa%20fa-archive">
              
                  <span class="site-state-item-count">435</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">61</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart" aria-hidden="true"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jason</span>
 <!--
  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>







-->
        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>




















  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v="></script>

  <script type="text/javascript" src="/js/src/motion.js?v="></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v="></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
